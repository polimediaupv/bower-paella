/*
	Paella HTML5 Multistream Player v.4.1.0
	Copyright (C) 2013  Universitat Politècnica de València
	File generated at 30-06-2015
*/
function initPaellaEngage(playerId,initDelegate){initDelegate||(initDelegate=new paella.InitDelegate),paella.initDelegate=initDelegate;navigator.language||window.navigator.userLanguage;paellaPlayer=new PaellaPlayer(playerId,paella.initDelegate)}function DeprecatedClass(name,replacedBy,p){Class(name,p,{initialize:function(){base.log.warning(name+" is deprecated, use "+replacedBy+" instead."),this.parent.apply(this,arguments)}})}function DeprecatedFunc(name,replacedBy,func){function ret(){base.log.warning(name+" is deprecated, use "+replacedBy+" instead."),func.apply(this,arguments)}return ret}var GlobalParams={video:{zIndex:1},background:{zIndex:0}},paella={};paella.player=null,paella.events={play:"paella:play",pause:"paella:pause",next:"paella:next",previous:"paella:previous",seeking:"paella:seeking",seeked:"paella:seeked",timeupdate:"paella:timeupdate",timeUpdate:"paella:timeupdate",seekTo:"paella:setseek",endVideo:"paella:endvideo",seekToFrame:"paella:seektotime",seekToTime:"paella:seektotime",setTrim:"paella:settrim",showEditor:"paella:showeditor",hideEditor:"paella:hideeditor",setPlaybackRate:"paella:setplaybackrate",setVolume:"paella:setVolume",setComposition:"paella:setComposition",loadStarted:"paella:loadStarted",loadComplete:"paella:loadComplete",loadPlugins:"paella:loadPlugins",error:"paella:error",setProfile:"paella:setprofile",documentChanged:"paella:documentChanged",didSaveChanges:"paella:didsavechanges",controlBarWillHide:"paella:controlbarwillhide",controlBarDidHide:"paella:controlbardidhide",controlBarDidShow:"paella:controlbardidshow",hidePopUp:"paella:hidePopUp",showPopUp:"paella:showPopUp",enterFullscreen:"paella:enterFullscreen",exitFullscreen:"paella:exitFullscreen",resize:"paella:resize",singleVideoReady:"paella:singleVideoReady",singleVideoUnloaded:"paella:singleVideoUnloaded",videoReady:"paella:videoReady",videoUnloaded:"paella:videoUnloaded",controlBarLoaded:"paella:controlBarLoaded",flashVideoEvent:"paella:flashVideoEvent",captionAdded:"paella:caption:add",captionsEnabled:"paella:caption:enabled",captionsDisabled:"paella:caption:disabled",trigger:function(event,params){$(document).trigger(event,params)},bind:function(event,callback){$(document).bind(event,function(event,params){callback(event,params)})},setupExternalListener:function(){window.addEventListener("message",function(event){paella.events.trigger(event.data.event,event.data.params)},!1)}},paella.events.setupExternalListener(),Class("paella.MouseManager",{targetObject:null,initialize:function(){var thisClass=this;paella.events.bind("mouseup",function(event){thisClass.up(event)}),paella.events.bind("mousemove",function(event){thisClass.move(event)}),paella.events.bind("mouseover",function(event){thisClass.over(event)})},down:function(targetObject,event){return this.targetObject=targetObject,this.targetObject&&this.targetObject.down&&(this.targetObject.down(event,event.pageX,event.pageY),event.cancelBubble=!0),!1},up:function(event){return this.targetObject&&this.targetObject.up&&(this.targetObject.up(event,event.pageX,event.pageY),event.cancelBubble=!0),this.targetObject=null,!1},out:function(event){return this.targetObject&&this.targetObject.out&&(this.targetObject.out(event,event.pageX,event.pageY),event.cancelBubble=!0),!1},move:function(event){return this.targetObject&&this.targetObject.move&&(this.targetObject.move(event,event.pageX,event.pageY),event.cancelBubble=!0),!1},over:function(event){return this.targetObject&&this.targetObject.over&&(this.targetObject.over(event,event.pageX,event.pageY),event.cancelBubble=!0),!1}}),paella.utils={mouseManager:new paella.MouseManager,styleSheet:{removeById:function(id){var outStyleSheet=$(document.head).find("#"+id)[0];outStyleSheet&&document.head.removeChild(outStyleSheet)},remove:function(){for(var links=document.head.getElementsByTagName("link"),i=0;i<links.length;++i)if(links[i].href){document.head.removeChild(links[i]);break}},add:function(fileName,id){var link=document.createElement("link");link.rel="stylesheet",link.href=fileName,link.type="text/css",link.media="screen",link.charset="utf-8",id&&(link.id=id),document.head.appendChild(link)},swap:function(outFile,inFile){this.remove(outFile),this.add(inFile)}},skin:{set:function(skinName){var skinId="paellaSkin";paella.utils.styleSheet.removeById(skinId),paella.utils.styleSheet.add("resources/style/style_"+skinName+".css"),base.cookies.set("skin",skinName)},restore:function(defaultSkin){var storedSkin=base.cookies.get("skin");this.set(storedSkin&&""!=storedSkin?storedSkin:defaultSkin)}},timeParse:{timeToSeconds:function(timeString){var hours=0,minutes=0,seconds=0;return/([0-9]+)h/i.test(timeString)&&(hours=60*parseInt(RegExp.$1)*60),/([0-9]+)m/i.test(timeString)&&(minutes=60*parseInt(RegExp.$1)),/([0-9]+)s/i.test(timeString)&&(seconds=parseInt(RegExp.$1)),hours+minutes+seconds},secondsToTime:function(seconds){var hrs=~~(seconds/3600);10>hrs&&(hrs="0"+hrs);var mins=~~(seconds%3600/60);10>mins&&(mins="0"+mins);var secs=Math.floor(seconds%60);return 10>secs&&(secs="0"+secs),hrs+":"+mins+":"+secs},secondsToText:function(secAgo){if(1>=secAgo)return base.dictionary.translate("1 second ago");if(60>secAgo)return base.dictionary.translate("{0} seconds ago").replace(/\{0\}/g,secAgo);var minAgo=Math.round(secAgo/60);if(1>=minAgo)return base.dictionary.translate("1 minute ago");if(60>minAgo)return base.dictionary.translate("{0} minutes ago").replace(/\{0\}/g,minAgo);var hourAgo=Math.round(secAgo/3600);if(1>=hourAgo)return base.dictionary.translate("1 hour ago");if(24>hourAgo)return base.dictionary.translate("{0} hours ago").replace(/\{0\}/g,hourAgo);var daysAgo=Math.round(secAgo/86400);if(1>=daysAgo)return base.dictionary.translate("1 day ago");if(24>daysAgo)return base.dictionary.translate("{0} days ago").replace(/\{0\}/g,daysAgo);var monthsAgo=Math.round(secAgo/2592e3);if(1>=monthsAgo)return base.dictionary.translate("1 month ago");if(12>monthsAgo)return base.dictionary.translate("{0} months ago").replace(/\{0\}/g,monthsAgo);var yearsAgo=Math.round(secAgo/31536e3);return 1>=yearsAgo?base.dictionary.translate("1 year ago"):base.dictionary.translate("{0} years ago").replace(/\{0\}/g,yearsAgo)},matterhornTextDateToDate:function(mhdate){var d=new Date;return d.setFullYear(parseInt(mhdate.substring(0,4),10)),d.setMonth(parseInt(mhdate.substring(5,7),10)-1),d.setDate(parseInt(mhdate.substring(8,10),10)),d.setHours(parseInt(mhdate.substring(11,13),10)),d.setMinutes(parseInt(mhdate.substring(14,16),10)),d.setSeconds(parseInt(mhdate.substring(17,19),10)),d}}},Class("paella.DataDelegate",{read:function(context,params,onSuccess){"function"==typeof onSuccess&&onSuccess({},!0)},write:function(context,params,value,onSuccess){"function"==typeof onSuccess&&onSuccess({},!0)},remove:function(context,params,onSuccess){"function"==typeof onSuccess&&onSuccess({},!0)}}),paella.dataDelegates={},Class("paella.dataDelegates.CookieDataDelegate",paella.DataDelegate,{initialize:function(){},serializeKey:function(context,params){return"object"==typeof params&&(params=JSON.stringify(params)),context+"|"+params},read:function(context,params,onSuccess){var key=this.serializeKey(context,params),value=base.cookies.get(key);try{value=unescape(value),value=JSON.parse(value)}catch(e){}"function"==typeof onSuccess&&onSuccess(value,!0)},write:function(context,params,value,onSuccess){var key=this.serializeKey(context,params);"object"==typeof value&&(value=JSON.stringify(value)),value=escape(value),base.cookies.set(key,value),"function"==typeof onSuccess&&onSuccess({},!0)},remove:function(context,params,onSuccess){var key=this.serializeKey(context,params);"object"==typeof value&&(value=JSON.stringify(value)),base.cookies.set(key,""),"function"==typeof onSuccess&&onSuccess({},!0)}}),paella.dataDelegates.DefaultDataDelegate=paella.dataDelegates.CookieDataDelegate,Class("paella.Data",{enabled:!1,dataDelegates:{},initialize:function(config){this.enabled=config.data.enabled;for(var key in config.data.dataDelegates)try{var delegateName=config.data.dataDelegates[key],DelegateClass=paella.dataDelegates[delegateName],delegateInstance=new DelegateClass;this.dataDelegates[key]=delegateInstance}catch(e){base.log.debug("Warning: delegate not found - "+delegateName)}this.dataDelegates["default"]||(this.dataDelegates["default"]=new paella.dataDelegates.DefaultDataDelegate)},read:function(context,key,onSuccess){var del=this.getDelegate(context);del.read(context,key,onSuccess)},write:function(context,key,params,onSuccess){var del=this.getDelegate(context);del.write(context,key,params,onSuccess)},remove:function(context,key,onSuccess){var del=this.getDelegate(context);del.remove(context,key,onSuccess)},getDelegate:function(context){return this.dataDelegates[context]?this.dataDelegates[context]:this.dataDelegates["default"]}}),paella.data=null,Class("paella.MessageBox",{modalContainerClassName:"modalMessageContainer",frameClassName:"frameContainer",messageClassName:"messageContainer",errorClassName:"errorContainer",currentMessageBox:null,messageContainer:null,onClose:null,initialize:function(){var thisClass=this;$(window).resize(function(){thisClass.adjustTop()})},showFrame:function(src,params){var closeButton=!0,width="80%",height="80%",onClose=null;params&&(closeButton=params.closeButton,width=params.width,height=params.height,onClose=params.onClose),this.doShowFrame(src,closeButton,width,height,onClose)},doShowFrame:function(src,closeButton,width,height,onClose){this.onClose=onClose,this.currentMessageBox&&this.close(),width||(width="80%"),height||(height="80%");var modalContainer=document.createElement("div");modalContainer.className=this.modalContainerClassName,modalContainer.style.position="fixed",modalContainer.style.top="0px",modalContainer.style.left="0px",modalContainer.style.right="0px",modalContainer.style.bottom="0px",modalContainer.style.zIndex=999999;var messageContainer=document.createElement("div");messageContainer.className=this.frameClassName,messageContainer.style.width=width,messageContainer.style.height=height,messageContainer.style.position="relative",modalContainer.appendChild(messageContainer);var iframeContainer=document.createElement("iframe");iframeContainer.src=src,iframeContainer.setAttribute("frameborder","0"),iframeContainer.style.width="100%",iframeContainer.style.height="100%",messageContainer.appendChild(iframeContainer),$("body")[0].appendChild(modalContainer),this.currentMessageBox=modalContainer,this.messageContainer=messageContainer;this.adjustTop(),closeButton&&this.createCloseButton()},showElement:function(domElement,params){var closeButton=!0,width="60%",height="40%",onClose=null,className=this.messageClassName;params&&(className=params.className,closeButton=params.closeButton,width=params.width,height=params.height,onClose=params.onClose),this.doShowElement(domElement,closeButton,width,height,className,onClose)},showMessage:function(message,params){var closeButton=!0,width="60%",height="40%",onClose=null,className=this.messageClassName;params&&(className=params.className,closeButton=params.closeButton,width=params.width,height=params.height,onClose=params.onClose),this.doShowMessage(message,closeButton,width,height,className,onClose)},doShowElement:function(domElement,closeButton,width,height,className,onClose){this.onClose=onClose,this.currentMessageBox&&this.close(),className||(className=this.messageClassName),width||(width="80%"),height||(height="30%");var modalContainer=document.createElement("div");modalContainer.className=this.modalContainerClassName,modalContainer.style.position="fixed",modalContainer.style.top="0px",modalContainer.style.left="0px",modalContainer.style.right="0px",modalContainer.style.bottom="0px",modalContainer.style.zIndex=999999;var messageContainer=document.createElement("div");messageContainer.className=className,messageContainer.style.width=width,messageContainer.style.height=height,messageContainer.style.position="relative",messageContainer.appendChild(domElement),modalContainer.appendChild(messageContainer),$("body")[0].appendChild(modalContainer),this.currentMessageBox=modalContainer,this.messageContainer=messageContainer;this.adjustTop(),closeButton&&this.createCloseButton()},doShowMessage:function(message,closeButton,width,height,className,onClose){this.onClose=onClose,this.currentMessageBox&&this.close(),className||(className=this.messageClassName),width||(width="80%"),height||(height="30%");var modalContainer=document.createElement("div");modalContainer.className=this.modalContainerClassName,modalContainer.style.position="fixed",modalContainer.style.top="0px",modalContainer.style.left="0px",modalContainer.style.right="0px",modalContainer.style.bottom="0px",modalContainer.style.zIndex=999999;var messageContainer=document.createElement("div");messageContainer.className=className,messageContainer.style.width=width,messageContainer.style.height=height,messageContainer.style.position="relative",messageContainer.innerHTML=message,modalContainer.appendChild(messageContainer),$("body")[0].appendChild(modalContainer),this.currentMessageBox=modalContainer,this.messageContainer=messageContainer;this.adjustTop(),closeButton&&this.createCloseButton()},showError:function(message,params){var closeButton=!1,width="60%",height="20%",onClose=null;params&&(closeButton=params.closeButton,width=params.width,height=params.height,onClose=params.onClose),this.doShowError(message,closeButton,width,height,onClose)},doShowError:function(message,closeButton,width,height,onClose){this.doShowMessage(message,closeButton,width,height,this.errorClassName,onClose)},createCloseButton:function(){if(this.messageContainer){var thisClass=this,closeButton=document.createElement("div");this.messageContainer.appendChild(closeButton),closeButton.className="paella_messageContainer_closeButton",$(closeButton).click(function(){thisClass.onCloseButtonClick()})}},adjustTop:function(){if(this.currentMessageBox){var msgHeight=$(this.messageContainer).outerHeight(),containerHeight=$(this.currentMessageBox).height(),top=containerHeight/2-msgHeight/2;this.messageContainer.style.marginTop=top+"px"}},close:function(){if(this.currentMessageBox&&this.currentMessageBox.parentNode){var msgBox=this.currentMessageBox,parent=msgBox.parentNode;$(msgBox).animate({opacity:0},300,function(){parent.removeChild(msgBox)}),this.onClose&&this.onClose()}},onCloseButtonClick:function(){this.close()}}),paella.messageBox=new paella.MessageBox,paella.AntiXSS={htmlEscape:function(str){return String(str).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlUnescape:function(value){return String(value).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}},Class("paella.Node",{identifier:"",nodeList:null,initialize:function(id){this.nodeList={},this.identifier=id},addTo:function(parentNode){parentNode.addNode(this)},addNode:function(childNode){return this.nodeList[childNode.identifier]=childNode,childNode},getNode:function(id){return this.nodeList[id]},removeNode:function(childNode){return this.nodeList[childNode.identifier]?(delete this.nodeList[childNode.identifier],!0):!1}}),Class("paella.DomNode",paella.Node,{domElement:null,initialize:function(elementType,id,style){this.parent(id),this.domElement=document.createElement(elementType),this.domElement.id=id,style&&$(this.domElement).css(style)},addNode:function(childNode){var returnValue=this.parent(childNode);return this.domElement.appendChild(childNode.domElement),returnValue},onresize:function(){},removeNode:function(childNode){this.parent(childNode)&&this.domElement.removeChild(childNode.domElement)}}),Class("paella.Button",paella.DomNode,{isToggle:!1,initialize:function(id,className,action,isToggle){this.isToggle=isToggle;var style={};if(this.parent("div",id,style),this.domElement.className=className,isToggle){var thisClass=this;$(this.domElement).click(function(){thisClass.toggleIcon()})}$(this.domElement).click("click",action)},isToggled:function(){if(this.isToggle){var element=$("#"+this.identifier)[0];return/([a-zA-Z0-9_]+)_active/.test(element.className)}return!1},toggle:function(){this.toggleIcon()},toggleIcon:function(){var element=$("#"+this.identifier)[0];element.className=/([a-zA-Z0-9_]+)_active/.test(element.className)?RegExp.$1:element.className+"_active"},show:function(){$(this.domElement).show()},hide:function(){$(this.domElement).hide()},visible:function(){return this.domElement.visible()}}),paella.Profiles={profileList:null,loadProfile:function(profileName,onSuccessFunction){var defaultProfile;paella.player&&paella.player.config&&paella.player.config.defaultProfile&&(defaultProfile=paella.player.config.defaultProfile),this.loadProfileList(function(data){var profileData;if(data[profileName])profileData=data[profileName];else{if(!data[defaultProfile])return base.log.debug("Error loading the default profile. Check your Paella Player configuration"),!1;profileData=data[defaultProfile],base.cookies.set("lastProfile",defaultProfile)}onSuccessFunction(profileData)})},loadProfileList:function(onSuccessFunction){var thisClass=this;if(null==this.profileList){var params={url:"config/profiles/profiles.json"};base.ajax.get(params,function(data){"string"==typeof data&&(data=JSON.parse(data)),thisClass.profileList=data,onSuccessFunction(thisClass.profileList)},function(){base.log.debug("Error loading video profiles. Check your Paella Player configuration")})}else onSuccessFunction(thisClass.profileList)}},Class("paella.RelativeVideoSize",{w:1280,h:720,proportionalHeight:function(newWidth){return Math.floor(this.h*newWidth/this.w)},proportionalWidth:function(newHeight){return Math.floor(this.w*newHeight/this.h)},percentVSize:function(pxSize){return 100*pxSize/this.h},percentWSize:function(pxSize){return 100*pxSize/this.w},aspectRatio:function(){return this.w/this.h}}),Class("paella.VideoElementBase",paella.DomNode,{ready:!1,_metadata:null,_rect:null,_autoplay:!1,initialize:function(id,containerType,left,top,width,height){this._rect={left:left,top:top,width:width,height:height};var relativeSize=new paella.RelativeVideoSize,percentTop=relativeSize.percentVSize(top)+"%",percentLeft=relativeSize.percentWSize(left)+"%",percentWidth=relativeSize.percentWSize(width)+"%",percentHeight=relativeSize.percentVSize(height)+"%",style={top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,position:"absolute",zIndex:GlobalParams.video.zIndex};this.parent(containerType,id,style)},callReadyEvent:function(){paella.events.trigger(paella.events.singleVideoReady,{sender:this})},callUnloadEvent:function(){paella.events.trigger(paella.events.singleVideoUnloaded,{sender:this})},isReady:function(){return this.ready},setAutoplay:function(autoplay){this._autoplay=autoplay},play:function(){base.log.debug("TODO: implement play() function in your VideoElementBase subclass")},pause:function(){base.log.debug("TODO: implement pause() function in your VideoElementBase subclass")},isPaused:function(){return base.log.debug("TODO: implement isPaused() function in your VideoElementBase subclass"),!1},duration:function(){return base.log.debug("TODO: implement duration() function in your VideoElementBase subclass"),-1},setCurrentTime:function(){base.log.debug("TODO: implement setCurrentTime() function in your VideoElementBase subclass")},currentTime:function(){return base.log.debug("TODO: implement currentTime() function in your VideoElementBase subclass"),0},setVolume:function(){return base.log.debug("TODO: implement setVolume() function in your VideoElementBase subclass"),!1},volume:function(){return base.log.debug("TODO: implement volume() function in your VideoElementBase subclass"),-1},setPlaybackRate:function(){base.log.debug("TODO: implement setPlaybackRate() function in your VideoElementBase subclass")},addSource:function(){base.log.debug("TODO: implement addSource() function in your VideoElementBase subclass")},setPosterFrame:function(){base.log.debug("TODO: implement setPosterFrame() function")},unload:function(){this.callUnloadEvent()},setClassName:function(className){this.domElement.className=className},setMetadata:function(data){this._metadata=data},getDimensions:function(){return this._metadata&&this._metadata.res?{width:this._metadata.res.w,height:this._metadata.res.h}:{width:this.domElement.videoWidth,height:this.domElement.videoHeight}},setRect:function(rect,animate){this._rect=JSON.parse(JSON.stringify(rect));var relativeSize=new paella.RelativeVideoSize,percentTop=relativeSize.percentVSize(rect.top)+"%",percentLeft=relativeSize.percentWSize(rect.left)+"%",percentWidth=relativeSize.percentWSize(rect.width)+"%",percentHeight=relativeSize.percentVSize(rect.height)+"%",style={top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,position:"absolute"};if(animate){this.disableClassName();var thisClass=this;$(this.domElement).animate(style,400,function(){thisClass.enableClassName(),paella.events.trigger(paella.events.setComposition,{video:thisClass})}),this.enableClassNameAfter(400)}else $(this.domElement).css(style),paella.events.trigger(paella.events.setComposition,{video:this})},getRect:function(){return this._rect},disableClassName:function(){this.classNameBackup=this.domElement.className,this.domElement.className=""},enableClassName:function(){this.domElement.className=this.classNameBackup},enableClassNameAfter:function(millis){setTimeout("$('#"+this.domElement.id+"')[0].className = '"+this.classNameBackup+"'",millis)},setVisible:function(visible,animate){"true"==visible&&animate?($(this.domElement).show(),$(this.domElement).animate({opacity:1},300)):"true"!=visible||animate?"false"==visible&&animate?$(this.domElement).animate({opacity:0},300):"false"!=visible||animate||$(this.domElement).hide():$(this.domElement).show()},setLayer:function(layer){this.domElement.style.zIndex=layer}});var paella_flash_VideoContainers={};Class("paella.FlashVideo",paella.VideoElementBase,{classNameBackup:"",flashVideo:null,paused:!0,streamingMode:!0,flashId:"",_isReady:!1,_duration:0,initialize:function(id,left,top,width,height){var This=this;this.parent(id,"div",left,top,width,height),this.flashId=id+"Movie",paella_flash_VideoContainers[this.flashId]=this,paella.events.bind(paella.events.flashVideoEvent,function(event,params){This.flashId==params.source&&This.eventReceived(params.eventName,params.values)})},isReady:function(){return this._isReady},eventReceived:function(eventName,params){params=params.split(",");for(var processedParams={},i=0;i<params.length;++i){var splitted=params[i].split(":"),key=splitted[0],value=splitted[1];"NaN"==value?value=0/0:/^true$/i.test(value)?value=!0:/^false$/i.test(value)?value=!1:isNaN(parseFloat(value))||(value=parseFloat(value)),processedParams[key]=value}this.processEvent(eventName,processedParams)},setAutoplay:function(autoplay){this._autoplay=autoplay},processEvent:function(eventName,params){if("loadedmetadata"==eventName||"pause"==eventName||this._isReady||(this._isReady=!0,this._duration=params.duration,this.callReadyEvent()),"progress"==eventName){try{this.flashVideo.setVolume(this._volume)}catch(e){}base.log.debug("Flash video event: "+eventName+", progress: "+this.flashVideo.currentProgress())}else"ended"==eventName?(base.log.debug("Flash video event: "+eventName),paella.events.trigger(paella.events.pause),paella.player.controls.showControls()):base.log.debug("Flash video event: "+eventName)},setPosterFrame:function(url){if(void 0===this._posterFrame){this._posterFrame=url;var posterFrame=document.createElement("img");posterFrame.src=url,posterFrame.className="videoPosterFrameImage",posterFrame.alt="poster frame",this.domElement.appendChild(posterFrame),this._posterFrameElement=posterFrame}},addParameter:function(swf,name,value){var param=document.createElement("param");param.setAttribute("name",name),param.setAttribute("value",value),swf.appendChild(param)},createSwf:function(url,params){var ieobject=document.createElement("object");ieobject.setAttribute("id",this.flashId+"IE"),ieobject.setAttribute("classid","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"),ieobject.setAttribute("codebase",'"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=5,0,0,0"'),ieobject.setAttribute("width","100%"),ieobject.setAttribute("height","100%"),ieobject.setAttribute("playerId",this.flashId),this.addParameter(ieobject,"movie",url),this.addParameter(ieobject,"quality","high"),this.addParameter(ieobject,"bgcolor","#efefef"),this.addParameter(ieobject,"play","true"),this.addParameter(ieobject,"loop","true"),this.addParameter(ieobject,"wmode","window"),this.addParameter(ieobject,"scale","default"),this.addParameter(ieobject,"menu","true"),this.addParameter(ieobject,"devicefont","false"),this.addParameter(ieobject,"salign",""),this.addParameter(ieobject,"allowScriptAccess","sameDomain");var object=document.createElement("object");object.setAttribute("id",this.flashId),object.setAttribute("type","application/x-shockwave-flash"),object.setAttribute("data",url),object.setAttribute("width","100%"),object.setAttribute("height","100%"),object.setAttribute("playerId",this.flashId),this.addParameter(object,"movie",url),this.addParameter(object,"quality","high"),this.addParameter(object,"bgcolor","#efefef"),this.addParameter(object,"play","true"),this.addParameter(object,"loop","true"),this.addParameter(object,"wmode","window"),this.addParameter(object,"scale","default"),this.addParameter(object,"menu","true"),this.addParameter(object,"devicefont","false"),this.addParameter(object,"salign",""),this.addParameter(object,"allowScriptAccess","sameDomain"),ieobject.appendChild(object);var flashVars="playerId="+this.playerId,separator="&";for(var key in params)flashVars+=separator+key+"="+encodeURIComponent(params[key]);this.addParameter(ieobject,"flashvars",flashVars),this.addParameter(object,"flashvars",flashVars);var link=document.createElement("a");return link.setAttribute("href","http://www.adobe.com/go/getflash"),link.innerHTML='<img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',object.appendChild(link),ieobject},play:function(){if(this.flashVideo)try{return this.flashVideo.play(),this.paused=!1,this._posterFrameElement&&$(this._posterFrameElement).hide(),!0}catch(e){}return!1},pause:function(){if(this.flashVideo)try{return this.flashVideo.pause(),this.paused=!0,!0}catch(e){}return!1},isPaused:function(){return this.paused},duration:function(){return this._duration},setCurrentTime:function(time){if(this.flashVideo)try{this.flashVideo.seekToTime(time)}catch(e){}},currentTime:function(){if(this.flashVideo)try{return this.flashVideo.getCurrentTime()}catch(e){return 0}return-1},setDefaultVolume:function(vol){this._defaultVolume=vol,this._volume=vol},setVolume:function(volume){if(this.flashVideo){this._volume=volume;var thisClass=this;try{return this.flashVideo.setVolume(volume),!0}catch(e){new Timer(function(timer){try{thisClass.flashVideo.setVolume(volume),timer.repeat=!1}catch(e2){base.log.debug("Fail to set volume on "+thisClass.identifier),timer.repeat=!0}},100)}}return!1},volume:function(){var volume=0;if(this.flashVideo)try{volume=this.flashVideo.getVolume()}catch(e){}return volume},setPlaybackRate:function(){},createSwfObject:function(swfFile,flashVars){var id=this.identifier,parameters={wmode:"transparent"},domElement=document.createElement("div");if(this.domElement.appendChild(domElement),domElement.id=id+"Movie",swfobject.hasFlashPlayerVersion("9.0.0"))swfobject.embedSWF(swfFile,domElement.id,"100%","100%","9.0.0","",flashVars,parameters,null,function(e){if(0==e.success){var message=document.createElement("div"),header=document.createElement("h3");header.innerHTML=base.dictionary.translate("Flash player problem");var text=document.createElement("div");text.innerHTML=base.dictionary.translate("A problem occurred trying to load flash player.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>")+"<br>"+base.dictionary.translate("If the problem presist, contant us.");var link=document.createElement("a");link.setAttribute("href","http://www.adobe.com/go/getflash"),link.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',message.appendChild(header),message.appendChild(text),message.appendChild(link),paella.messageBox.showError(message.innerHTML)}});else{var message=document.createElement("div"),header=document.createElement("h3");header.innerHTML=base.dictionary.translate("Flash player 9 nedded");var text=document.createElement("div");text.innerHTML=base.dictionary.translate("You need at least Flash player 9 installed.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>");var link=document.createElement("a");link.setAttribute("href","http://www.adobe.com/go/getflash"),link.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',message.appendChild(header),message.appendChild(text),message.appendChild(link),paella.messageBox.showError(message.innerHTML)}var flashObj=$("#"+domElement.id)[0];return flashObj},addSourceProgresiveDownload:function(sourceData){var parameters={};this._autoplay&&(parameters.autoplay=this._autoplay),"true"==base.parameters.get("debug")&&(parameters.debugMode=!0),"video/mp4"==sourceData.type?/rtmp:\/\//.test(sourceData.src)||(parameters.url=sourceData.src,parameters.playerId=this.flashId,parameters.isLiveStream=!1,this.flashVideo=this.createSwfObject("player.swf",parameters)):"video/x-flv"==sourceData.type&&(parameters.url=sourceData.src,parameters.playerId=this.flashId,parameters.isLiveStream=!1,this.flashVideo=this.createSwfObject("player.swf",parameters))},addSourceStreaming:function(sourceData){var subscription=!1;if(!sourceData||!sourceData.src)return void base.log.debug("Invalid source data: expecting src");if("string"==typeof sourceData.src)return void base.log.debug("Invalid RTMP source format, expecting an object with the format: { server:'rtmp://server', stream:'video-stream' }");if(!sourceData.src.server||!sourceData.src.stream)return void base.log.debug("Invalid RTMP source configuration: expecting { server:'rtmp://server', stream:'video-stream' }");void 0===sourceData.src.requiresSubscription&&paella.player.config.player.rtmpSettings?subscription=paella.player.config.player.rtmpSettings.requiresSubscription||!1:sourceData.src.requiresSubscription&&(subscription=sourceData.src.requiresSubscription);var parameters={},swfName="player_streaming.swf";this._autoplay&&(parameters.autoplay=this._autoplay),"true"==base.parameters.get("debug")&&(parameters.debugMode=!0),parameters.playerId=this.flashId,parameters.isLiveStream=void 0!==sourceData.isLiveStream?sourceData.isLiveStream:!1,parameters.server=sourceData.src.server,parameters.stream=sourceData.src.stream,parameters.subscribe=subscription,paella.player.config.player.rtmpSettings&&void 0!==paella.player.config.player.rtmpSettings.bufferTime&&(parameters.bufferTime=paella.player.config.player.rtmpSettings.bufferTime),this.flashVideo=this.createSwfObject(swfName,parameters)},addSource:function(sourceData){this.streamingMode?this.addSourceStreaming(sourceData):this.addSourceProgresiveDownload(sourceData)},unload:function(){this.flashVideo&&(this.domElement.innerHTML="",this.flashVideo=null,this._isReady=!1),this.parent()},getDimensions:function(){var dim={width:640,height:480};if(this._metadata&&this._metadata.res)dim.width=this._metadata.res.w,dim.height=this._metadata.res.h;else try{dim.width=this.flashVideo.getWidth(),dim.height=this.flashVideo.getHeight()
}catch(e){base.log.debug("Warning: flash video is not loaded")}return dim}}),Class("paella.Html5Video",paella.VideoElementBase,{classNameBackup:"",ready:!1,_initialCurrentTime:0,_posterFrame:null,initialize:function(id,left,top,width,height){this.parent(id,"video",left,top,width,height);var thisClass=this;$(this.domElement).bind("progress",function(event){thisClass.onVideoProgress(event)}),$(this.domElement).bind("loadstart",function(event){thisClass.onVideoProgress(event)}),$(this.domElement).bind("loadedmetadata",function(event){thisClass.onVideoProgress(event)}),$(this.domElement).bind("canplay",function(event){thisClass.onVideoProgress(event)})},onVideoProgress:function(){this.ready||4!=this.domElement.readyState||(this.ready=!0,0!=this._initialCurrentTime&&(this.domElement.currentTime=this._initialCurrentTime,delete this._initialCurrentTime),this.callReadyEvent())},isReady:function(){return this.ready},setPosterFrame:function(url){this._posterFrame=url,this.domElement&&this.domElement.setAttribute("poster",url)},setAutoplay:function(auto){this._autoplay=auto,auto&&this.domElement.setAttribute("autoplay",auto)},play:function(){this.domElement&&this.domElement.play&&(this.domElement.play(),this._initialCurrentTime&&4==this.domElement.readyState&&(this.domElement.currentTime=this._initialCurrentTime,delete this._initialCurrentTime))},pause:function(){this.domElement&&this.domElement.pause&&this.domElement.pause()},isPaused:function(){return this.domElement.paused},duration:function(){return this.domElement&&this.domElement.duration?this.domElement.duration:void 0},setCurrentTime:function(time){this.ready||(this._initialCurrentTime=time),this.domElement&&this.domElement.currentTime?this.domElement.currentTime=time:this.domElement&&(this._initialCurrentTime=time)},currentTime:function(){return this.domElement&&this.domElement.currentTime?this.domElement.currentTime:0},setDefaultVolume:function(vol){this.setVolume(vol)},setVolume:function(volume){return 0==volume?this.domElement.setAttribute("muted",!0):this.domElement.removeAttribute("muted"),this.domElement.volume=volume,!0},volume:function(){return this.domElement.muted?0:this.domElement.volume},setPlaybackRate:function(rate){this.domElement.playbackRate=rate},addSource:function(sourceData){var source=document.createElement("source");source.src=sourceData.src+"?caches="+Math.random(),source.type=sourceData.type,this.domElement.appendChild(source)},unload:function(){this.ready=!1;for(var sources=$(this.domElement).find("source"),i=0;i<sources.length;++i)this.domElement.removeChild(sources[i]),sources[i].src="";this.domElement.src="",this.domElement.load(),this.parent()},getDimensions:function(){return this._metadata&&this._metadata.res?{width:this._metadata.res.w,height:this._metadata.res.h}:{width:this.domElement.videoWidth,height:this.domElement.videoHeight}},disableClassName:function(){this.classNameBackup=this.domElement.className,this.domElement.className=""},enableClassName:function(){this.domElement.className=this.classNameBackup},enableClassNameAfter:function(millis){setTimeout("$('#"+this.domElement.id+"')[0].className = '"+this.classNameBackup+"'",millis)},setVisible:function(visible,animate){"true"==visible&&animate?($(this.domElement).show(),$(this.domElement).animate({opacity:1},300)):"true"!=visible||animate?"false"==visible&&animate?$(this.domElement).animate({opacity:0},300):"false"!=visible||animate||$(this.domElement).hide():$(this.domElement).show()},setLayer:function(layer){this.domElement.style.zIndex=layer}}),Class("paella.SlideshowVideo",paella.VideoElementBase,{ready:!1,img:null,_frames:null,_duration:0,_currentTime:0,_playTime:0,_lastFrame:-1,updateTimer:null,initialize:function(id,left,top,width,height){this.parent(id,"div",left,top,width,height),this.img=document.createElement("img"),this.img.style.width="100%",this.img.style.height="100%",this.domElement.appendChild(this.img);var thisClass=this;thisClass.ready=!1},isReady:function(){return this.ready},checkFrame:function(){for(var src=null,alt="",lastFrame=-1,i=0;i<this._frames.length;++i){var frameData=this._frames[i];if(this._currentTime<frameData.time)break;src=frameData.image,alt="frame_"+frameData.time,lastFrame=frameData.time}this._lastFrame!=lastFrame&&(this.img.src=src,this.img.alt=alt,this._lastFrame=lastFrame)},play:function(){this.updateTimer||(this._playTime=(new Date).getTime(),this.updateTimer=new Timer(function(timer,params){var time=(new Date).getTime(),elapsed=Math.round((time-params.player._playTime)/1e3);params.player._currentTime+=elapsed,params.player._playTime=time,params.player.checkFrame(),params.player_currentTime>=params.player._duration&&params.player.pause()},1e3,{player:this}),this.updateTimer.repeat=!0)},pause:function(){this.updateTimer&&(this.updateTimer.cancel(),this.updateTimer=null)},isPaused:function(){return null==this.updateTimer},duration:function(){return _duration},setCurrentTime:function(time){this._duration>=time&&(this._currentTime=time,this.checkFrame())},currentTime:function(){return this._currentTime},setVolume:function(){return!1},setDefaultVolume:function(){},volume:function(){return-1},setPlaybackRate:function(){},addSource:function(sourceData){this._duration=sourceData.duration,this._currentTime=0,this.loadFrames(sourceData.frames,sourceData.duration);var frameZero=new Image,thisClass=this;frameZero.onload=function(){thisClass.ready=!0,thisClass.checkFrame()},frameZero.src=this._frames[0].image},unload:function(){this.domElement.innerHTML="",this.parent()},loadFrames:function(frames,duration){this._frames=[];for(var i=0;duration>=i;++i){var frame=frames["frame_"+i];frame&&this._frames.push({time:i,image:frame})}}}),Class("paella.BackgroundContainer",paella.DomNode,{initialize:function(id,image){this.parent("img",id,{position:"relative",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:GlobalParams.background.zIndex}),this.domElement.setAttribute("src",image),this.domElement.setAttribute("alt",""),this.domElement.setAttribute("width","100%"),this.domElement.setAttribute("height","100%")},setImage:function(image){this.domElement.setAttribute("src",image)}}),Class("paella.VideoOverlay",paella.DomNode,{size:{w:1280,h:720},initialize:function(){var style={position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden",zIndex:10};this.parent("div","overlayContainer",style),this.domElement.setAttribute("role","main")},enableBackgroundMode:function(){this.domElement.className="overlayContainer background"},disableBackgroundMode:function(){this.domElement.className="overlayContainer"},clear:function(){this.domElement.innerHTML=""},getMasterRect:function(){return paella.player.videoContainer.getMasterVideoRect()},getSlaveRect:function(){return paella.player.videoContainer.getSlaveVideoRect()},addText:function(text,rect,isDebug){var textElem=document.createElement("div0");return textElem.innerHTML=text,textElem.className="videoOverlayText",isDebug&&(textElem.style.backgroundColor="red"),this.addElement(textElem,rect)},addElement:function(element,rect){return this.domElement.appendChild(element),element.style.position="absolute",element.style.left=this.getHSize(rect.left)+"%",element.style.top=this.getVSize(rect.top)+"%",element.style.width=this.getHSize(rect.width)+"%",element.style.height=this.getVSize(rect.height)+"%",element},removeElement:function(element){if(element)try{this.domElement.removeChild(element)}catch(e){}},getVSize:function(px){return 100*px/this.size.h},getHSize:function(px){return 100*px/this.size.w}}),Class("paella.VideoContainerBase",paella.DomNode,{trimming:{enabled:!1,start:0,end:0},timeupdateEventTimer:null,timeupdateInterval:250,masterVideoData:null,slaveVideoData:null,currentMasterVideoData:null,currentSlaveVideoData:null,_force:!1,initialize:function(id){var self=this,style={position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden"};this.parent("div",id,style),$(this.domElement).click(function(){self.firstClick&&base.userAgent.browser.IsMobileVersion||($(document).trigger(paella.player.videoContainer.paused()?paella.events.play:paella.events.pause),self.firstClick=!0)}),this.domElement.addEventListener("touchstart",function(){paella.player.controls&&paella.player.controls.restartHideTimer()})},triggerTimeupdate:function(){var thisClass=this;(!this.paused()||thisClass._force)&&(paella.events.trigger(paella.events.timeupdate,{videoContainer:thisClass,currentTime:thisClass.currentTime()}),thisClass._force=!1)},startTimeupdate:function(){var thisClass=this;this.timeupdateEventTimer=new Timer(function(){thisClass.triggerTimeupdate()},this.timeupdateInterval),this.timeupdateEventTimer.repeat=!0},stopTimeupdate:function(){this.timeupdateEventTimer&&(this.timeupdateEventTimer.repeat=!1),this.timeupdateEventTimer=null},play:function(){this.startTimeupdate()},pause:function(){this.stopTimeupdate()},seekTo:function(newPositionPercent){var thisClass=this;this.setCurrentPercent(newPositionPercent),thisClass._force=!0,this.triggerTimeupdate()},seekToTime:function(time){var thisClass=this;this.setCurrentTime(time),thisClass._force=!0,this.triggerTimeupdate()},setPlaybackRate:function(){},setVolume:function(){},volume:function(){return 1},trimStart:function(){return 0},trimEnd:function(){return this.duration()},trimEnabled:function(){return!1},enableTrimming:function(){this.trimming.enabled=!0},disableTrimming:function(){this.trimming.enabled=!1},setTrimming:function(start,end){this.trimming.start=start,this.trimming.end=end,this.currentTime()<this.trimming.start&&this.setCurrentTime(this.trimming.start),this.currentTime()>this.trimming.end&&this.setCurrentTime(this.trimming.end)},setTrimmingStart:function(start){this.setTrimming(start,this.trimming.end)},setTrimmingEnd:function(end){this.setTrimming(this.trimming.start,end)},setCurrentPercent:function(percent){var start=this.trimStart(),end=this.trimEnd(),duration=end-start,trimedPosition=percent*duration/100,realPosition=parseFloat(trimedPosition)+parseFloat(start);this.setCurrentTime(realPosition)},setCurrentTime:function(time){base.log.debug("VideoContainerBase.setCurrentTime("+time+")")},currentTime:function(){return base.log.debug("VideoContainerBase.currentTime()"),0},duration:function(){return base.log.debug("VideoContainerBase.duration()"),0},paused:function(){return base.log.debug("VideoContainerBase.paused()"),!0},setupVideo:function(){base.log.debug("VideoContainerBase.setupVide()")},isReady:function(){return base.log.debug("VideoContainerBase.isReady()"),!0},onresize:function(){this.parent(onresize)}}),Class("paella.ProfileFrameStrategy",{valid:function(){return!0},adaptFrame:function(videoDimensions,frameRect){return frameRect}}),Class("paella.LimitedSizeProfileFrameStrategy",paella.ProfileFrameStrategy,{adaptFrame:function(videoDimensions,frameRect){if(videoDimensions.width<frameRect.width||videoDimensions.height<frameRect.height){var frameRectCopy=JSON.parse(JSON.stringify(frameRect));frameRectCopy.width=videoDimensions.width,frameRectCopy.height=videoDimensions.height;var diff={w:frameRect.width-videoDimensions.width,h:frameRect.height-videoDimensions.height};return frameRectCopy.top=frameRectCopy.top+diff.h/2,frameRectCopy.left=frameRectCopy.left+diff.w/2,frameRectCopy}return frameRect}}),Class("paella.VideoQualityStrategy",{getStream:function(source){return source.length>0?source[0]:source}}),Class("paella.BestFitVideoQualityStrategy",paella.VideoQualityStrategy,{getStream:function(source,stream,userSelection){if(source.length>0){for(var selected=source[0],win_w=$(window).width(),win_h=$(window).height(),win_res=win_w*win_h,selected_res=parseInt(selected.res.w)*parseInt(selected.res.h),selected_diff=Math.abs(win_res-selected_res),i=0;i<source.length;++i){var res=source[i].res;if(res)if(void 0!=userSelection){if(res=res.w+"x"+res.h,res==userSelection){selected=source[i];break}}else{var m_res=parseInt(source[i].res.w)*parseInt(source[i].res.h),m_diff=Math.abs(win_res-m_res);selected_diff>m_diff&&(selected_diff=m_diff,selected=source[i])}}return selected}return source}}),Class("paella.VideoContainer",paella.VideoContainerBase,{containerId:"",video1Id:"",video2Id:"",backgroundId:"",container:null,profileFrameStrategy:null,videoClasses:{master:"video masterVideo",slave:"video slaveVideo"},isHidden:!1,maxSyncDelay:.5,logos:null,isMasterReady:!1,isSlaveReady:!1,isMonostream:!1,sourceData:null,overlayContainer:null,videoSyncTimeMillis:5e3,currentMasterVideoRect:{},currentSlaveVideoRect:{},_masterQuality:null,_slaveQuality:null,_firstLoad:!1,_playOnLoad:!1,_seekToOnLoad:0,_defaultMasterVolume:1,_defaultSlaveVolume:1,_showPosterFrame:!0,initialize:function(id){this.parent(id);var thisClass=this;this.sourceData=[],this.containerId=id+"_container",this.video1Id=id+"_1",this.video2Id=id+"_2",this.backgroundId=id+"_bkg",this.logos=[],this._videoQualityStrategy=new paella.VideoQualityStrategy,this.container=new paella.DomNode("div",this.containerId,{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",width:"1024px",height:"567px"}),this.container.domElement.setAttribute("role","main"),this.addNode(this.container),this.overlayContainer=new paella.VideoOverlay(this.domElement),this.container.addNode(this.overlayContainer);var overlayLoader=document.createElement("div");overlayLoader.className="videoLoaderOverlay",this.overlayContainer.addElement(overlayLoader,{left:0,top:0,width:1280,height:720}),paella.events.bind(paella.events.loadComplete,function(){thisClass.overlayContainer.removeElement(overlayLoader)}),this.container.addNode(new paella.BackgroundContainer(this.backgroundId,"config/profiles/resources/default_background_paella.jpg")),paella.events.bind(paella.events.timeupdate,function(){thisClass.checkVideoTrimming()}),paella.events.bind(paella.events.singleVideoReady,function(evt,params){thisClass.onVideoLoaded(params.sender)}),paella.events.bind(paella.events.singleVideoUnloaded,function(evt,params){thisClass.onVideoUnloaded(params.sender)});var timer=new base.Timer(function(){thisClass.syncVideos()},thisClass.videoSyncTimeMillis);timer.repeat=!0;var config=paella.player.config;try{var StrategyClass=config.player.profileFrameStrategy,ClassObject=Class.fromString(StrategyClass),strategy=new ClassObject;dynamic_cast("paella.ProfileFrameStrategy",strategy)&&this.setProfileFrameStrategy(strategy)}catch(e){}},setVideoQualityStrategy:function(strategy){this._videoQualityStrategy=strategy},setProfileFrameStrategy:function(strategy){this.profileFrameStrategy=strategy},getMasterVideoRect:function(){return this.currentMasterVideoRect},getSlaveVideoRect:function(){return this.currentSlaveVideoRect},createVideoPlayers:function(){var masterVideo=new paella.FlashVideo(this.video1Id,850,140,360,550);masterVideo.setClassName(this.video1ClassName),this.container.addNode(masterVideo);var slaveVideo=new paella.FlashVideo(this.video2Id,10,40,800,600);slaveVideo.setClassName(this.video2ClassName),this.container.addNode(slaveVideo)},setHidden:function(hidden){this.isHidden=hidden},hideVideo:function(){this.setHidden(!0)},publishVideo:function(){this.setHidden(!1)},syncVideos:function(){var masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo();if(!this.isMonostream&&masterVideo&&slaveVideo&&masterVideo.currentTime&&slaveVideo.currentTime){var diff=Math.abs(masterVideo.currentTime()-slaveVideo.currentTime());diff>this.maxSyncDelay&&(base.log.debug("Sync videos performed, diff="+diff),slaveVideo.setCurrentTime(masterVideo.currentTime()))}},checkVideoTrimming:function(){var current=this.currentTime(),end=this.duration(),start=0;if(this.trimming.enabled&&(end=this.trimming.end,start=parseFloat(this.trimming.start)),current>=Math.floor(end)&&!this.paused()){var thisClass=this;paella.events.trigger(paella.events.endVideo,{videoContainer:thisClass}),this.pause()}else start>current&&this.setCurrentTime(start+1)},play:function(){this._firstLoad?this._playOnLoad=!0:this._firstLoad=!0;var masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo();masterVideo&&masterVideo.play(),slaveVideo&&slaveVideo.play(),this.parent()},pause:function(){var masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo();masterVideo&&masterVideo.pause(),slaveVideo&&slaveVideo.pause(),this.parent()},next:function(){this.setCurrentTime(0!==this.trimming.end?this.trimming.end:this.duration(!0)),this.parent()},previous:function(){this.setCurrentTime(this.trimming.start),this.parent()},setCurrentTime:function(time){0>=time&&(time=1),this.trimming.enabled&&(time<this.trimming.start&&(time=this.trimming.start),time>this.trimming.end&&(time=this.trimming.end));var masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo();masterVideo&&masterVideo.setCurrentTime(time),slaveVideo&&slaveVideo.setCurrentTime(time),this.parent()},currentTime:function(){var masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo();return masterVideo?masterVideo.currentTime():slaveVideo?slaveVideo.currentTime():0},setPlaybackRate:function(rate){var masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo();masterVideo&&masterVideo.setPlaybackRate(rate),slaveVideo&&slaveVideo.setPlaybackRate(rate),this.parent()},setVolume:function(params){var masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo();masterVideo&&params.master?masterVideo.setVolume(params.master):masterVideo&&masterVideo.setVolume(0),slaveVideo&&params.slave?slaveVideo.setVolume(params.slave):slaveVideo&&slaveVideo.setVolume(0),this.parent()},volume:function(video){return!video&&this.masterVideo()?this.masterVideo().volume():"master"==video&&this.masterVideo()?this.masterVideo().volume():"slave"==video&&this.slaveVideo()?this.slaveVideo().volume():0},setDefaultMasterVolume:function(vol){this._defaultMasterVolume=vol},setDefaultSlaveVolume:function(vol){this._defaultSlaveVolume=vol},masterVideo:function(){return this.container.getNode(this.video1Id)},slaveVideo:function(){return this.container.getNode(this.video2Id)},duration:function(ignoreTrimming){return this.trimming.enabled&&!ignoreTrimming?this.trimming.end-this.trimming.start:(this.videoDuration||(this.videoDuration=this.masterVideo().duration()),this.videoDuration)},paused:function(){return this.masterVideo()?this.masterVideo().isPaused():!0},trimEnabled:function(){return this.trimming.enabled},trimStart:function(){return this.trimming.enabled?this.trimming.start:0},trimEnd:function(){return this.trimming.enabled?this.trimming.end:this.duration()},setMasterQuality:function(quality){this._masterQuality=quality},setSlaveQuality:function(quality){this._slaveQuality=quality},setStartTime:function(time){this.seekToTime(time)},reloadVideos:function(masterQuality,slaveQuality){var isPaused=paella.player.videoContainer.paused();this._showPosterFrame=!1;var memoizedCurrentTime=this.currentTime(),masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo(),masterVolume=masterVideo.volume(),slaveVolume=slaveVideo&&slaveVideo.volume();this.setMasterQuality(masterQuality),this.setSlaveQuality(slaveQuality);var currentMastr=this.currentMasterVideoData,newMasterSrc=(this.currentSlaveVideoData,this._videoSourceData.master?this.selectSource(this._videoSourceData.master.data,this._videoSourceData.master.type.name):null),newSlaveSrc=this._videoSourceData.slave?this.selectSource(this._videoSourceData.slave.data,this._videoSourceData.slave.type.name):null;newMasterSrc&&(newMasterSrc=this.getVideoQuality(newMasterSrc,"master")),newSlaveSrc&&(newSlaveSrc=this.getVideoQuality(newSlaveSrc,"slave")),(currentMastr.res.w!=newMasterSrc.res.w||currentMastr.res.h!=newMasterSrc.res.h||currentMastr.res.w!=newMasterSrc.res.w||currentMastr.res.h!=newMasterSrc.res.h)&&(masterVideo&&masterVideo.unload(),slaveVideo&&slaveVideo.unload(),this._seekToOnLoad=memoizedCurrentTime,this.setSources(this._videoSourceData.master,this._videoSourceData.slave),masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo(),masterVideo&&masterVideo.setVolume(masterVolume),slaveVideo&&slaveVideo.setVolume(slaveVolume),this.seekToTime(this._seekToOnLoad),this._playOnLoad=!1,isPaused||($(document).trigger(paella.events.play),this._playOnLoad=!0))},setSources:function(master,slave){var masterRect={x:850,y:140,w:360,h:550},slaveRect={x:10,y:40,w:800,h:600};if(this._unloadVideos(),!(master&&master.data&&master.type&&master.type.name))throw new Error("Error in video configuration. Master video data not found");this._setSource(master.data,this.video1Id,master.type,"master",masterRect),this._videoSourceData={master:master},slave&&slave.data&&slave.type?(this._setSource(slave.data,this.video2Id,slave.type,"slave",slaveRect),this._videoSourceData.slave=slave):this.setMonoStreamMode(!0)},setAutoplay:function(){this._autoplay=!0,this.masterVideo()&&this.masterVideo().setAutoplay(!0),this.slaveVideo()&&this.slaveVideo().setAutoplay(!0)},onVideoLoaded:function(){(this.isMonostream&&this.masterVideo()&&this.masterVideo().isReady()||this.masterVideo()&&this.masterVideo().isReady()&&this.slaveVideo()&&this.slaveVideo().isReady())&&this._playOnLoad&&$(document).trigger(paella.events.play)},onVideoUnloaded:function(){this.isMonostream?paella.events.trigger(paella.events.videoUnloaded):this.masterVideo()&&!this.masterVideo().isReady()&&this.slaveVideo()&&!this.slaveVideo().isReady()&&paella.events.trigger(paella.events.videoUnloaded)},_unloadVideos:function(){var master=this.masterVideo(),slave=this.slaveVideo();master&&this.container.removeNode(master),slave&&this.container.removeNode(slave),this.isMasterReady=!1,this.isSlaveReady=!1,this.masterVideoData=null,this.slaveVideoData=null,this.sourceData=[]},_setSource:function(data,videoNodeId,type,target,rect){var videoNode=null;switch(type.name){case"html":videoNode=new paella.Html5Video(videoNodeId,rect.x,rect.y,rect.w,rect.h);break;case"flash":videoNode=new paella.FlashVideo(videoNodeId,rect.x,rect.y,rect.w,rect.h),videoNode.streamingMode=!1;break;case"streaming":videoNode=this.supportHLS()&&data.sources.hls?new paella.Html5Video(videoNodeId,rect.x,rect.y,rect.w,rect.h):new paella.FlashVideo(videoNodeId,rect.x,rect.y,rect.w,rect.h),videoNode.streamingMode=!0;break;case"image":videoNode=new paella.SlideshowVideo(videoNodeId,rect.x,rect.y,rect.w,rect.h)}return this._autoplay&&videoNode.setAutoplay(!0),"master"==target?(videoNode.setDefaultVolume(this._defaultMasterVolume),this.masterVideoData=data):(videoNode.setDefaultVolume(this._defaultSlaveVolume),this.slaveVideoData=data),this._showPosterFrame&&videoNode.setPosterFrame(data.preview),videoNode.setClassName(this.videoClasses[target]),this.container.addNode(videoNode),this.sourceData.push(data),this.setupVideo(videoNode,data,type.name,target),!0},selectSource:function(videoData,type){var mp4Source=videoData.sources.mp4,oggSource=videoData.sources.ogg,webmSource=videoData.sources.webm,flvSource=videoData.sources.flv,rtmpSource=videoData.sources.rtmp,hlsSource=videoData.sources.hls,imageSource=videoData.sources.image,selectedSource=null;return"html"==type?(mp4Source&&(selectedSource=mp4Source),oggSource&&(selectedSource=oggSource),webmSource&&(selectedSource=webmSource)):flvSource&&"flash"==type?selectedSource=flvSource:mp4Source&&"flash"==type?selectedSource=mp4Source:rtmpSource&&!this.supportHLS()&&"streaming"==type?selectedSource=rtmpSource:hlsSource&&this.supportHLS()&&"streaming"==type?selectedSource=hlsSource:imageSource&&"image"==type&&(selectedSource=imageSource),selectedSource},supportHLS:function(){return base.userAgent.system.iOS},setMonoStreamMode:function(){this.isMonostream=!0,this.isSlaveReady=!0},getVideoQuality:function(source,stream){var userSelection=null;return"master"==stream?userSelection=this._masterQuality:"slave"==stream&&(userSelection=this._slaveQuality),this._videoQualityStrategy.getStream(source,stream,userSelection)},setupVideo:function(videoNode,videoData,type,stream){if(videoNode&&videoData){var selectedSource=this.selectSource(videoData,type);selectedSource=this.getVideoQuality(selectedSource,stream),"master"==stream?this.currentMasterVideoData=selectedSource:"slave"==stream&&(this.currentSlaveVideoData=selectedSource),videoNode.addSource(selectedSource),videoNode.setMetadata(selectedSource),paella.userTracking.log("paella:VideoContainer:setupVideo:"+stream,selectedSource)}},numberOfStreams:function(){return this.sourceData.length},getMonostreamMasterProfile:function(){return{content:"presenter",visible:!0,layer:1,rect:[{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720}]}},getMonostreamSlaveProfile:function(){return{content:"slides",visible:!1,layer:0,rect:[{aspectRatio:"16/9",left:0,top:0,width:0,height:0},{aspectRatio:"4/3",left:0,top:0,width:0,height:0}]}},setProfile:function(profileName,onSuccess,animate){var thisClass=this,Animate=base.userAgent.browser.Explorer?!1:animate;paella.Profiles.loadProfile(profileName,function(profileData){1==thisClass.numberOfStreams()&&(profileData.masterVideo=thisClass.getMonostreamMasterProfile(),profileData.slaveVideo=thisClass.getMonostreamSlaveProfile()),thisClass.applyProfileWithJson(profileData,Animate),onSuccess(profileName),base.cookies.set("lastProfile",profileName)})},isReady:function(){return this.isMasterReady&&this.isSlaveReady},hideAllLogos:function(){for(var i=0;i<this.logos.length;++i){var logoId=this.logos[i],logo=this.container.getNode(logoId);$(logo.domElement).hide()}},showLogos:function(logos){if(void 0!=logos)for(var relativeSize=new paella.RelativeVideoSize,i=0;i<logos.length;++i){var logo=logos[i],logoId=logo.content,logoNode=this.container.getNode(logoId),rect=logo.rect;logoNode?$(logoNode.domElement).show():(style={},logoNode=this.container.addNode(new paella.DomNode("img",logoId,style)),logoNode.domElement.setAttribute("src","config/profiles/resources/"+logoId),logoNode.domElement.setAttribute("src","config/profiles/resources/"+logoId));var percentTop=relativeSize.percentVSize(rect.top)+"%",percentLeft=relativeSize.percentWSize(rect.left)+"%",percentWidth=relativeSize.percentWSize(rect.width)+"%",percentHeight=relativeSize.percentVSize(rect.height)+"%",style={top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,position:"absolute",zIndex:logo.zIndex};$(logoNode.domElement).css(style)}},applyProfileWithJson:function(profileData,animate){void 0==animate&&(animate=!0);var video1=this.container.getNode(this.video1Id),video2=this.container.getNode(this.video2Id);if(video1){var background=this.container.getNode(this.backgroundId),rectMaster=profileData.masterVideo.rect[0],rectSlave=profileData.slaveVideo.rect[0],masterDimensions=video1.getDimensions(),slaveDimensions={width:360,height:240};video2&&(slaveDimensions=video2.getDimensions());for(var masterAspectRatio=0==masterDimensions.height?1.3333:masterDimensions.width/masterDimensions.height,slaveAspectRatio=0==slaveDimensions.height?1.3333:slaveDimensions.width/slaveDimensions.height,profileMasterAspectRatio=1.333,profileSlaveAspectRatio=1.333,minMasterDiff=10,i=0;i<profileData.masterVideo.rect.length;++i){var profileMaster=profileData.masterVideo.rect[i];/([0-9]+)\/([0-9]+)/.test(profileMaster.aspectRatio)&&(profileMasterAspectRatio=Number(RegExp.$1)/Number(RegExp.$2));var masterDiff=Math.abs(profileMasterAspectRatio-masterAspectRatio);minMasterDiff>masterDiff&&(minMasterDiff=masterDiff,rectMaster=profileMaster)}var minSlaveDiff=10;for(i=0;i<profileData.slaveVideo.rect.length;++i){var profileSlave=profileData.slaveVideo.rect[i];/([0-9]+)\/([0-9]+)/.test(profileSlave.aspectRatio)&&(profileSlaveAspectRatio=Number(RegExp.$1)/Number(RegExp.$2));var slaveDiff=Math.abs(profileSlaveAspectRatio-slaveAspectRatio);minSlaveDiff>slaveDiff&&(minSlaveDiff=slaveDiff,rectSlave=profileSlave)}if(this.hideAllLogos(),this.showLogos(profileData.logos),dynamic_cast("paella.ProfileFrameStrategy",this.profileFrameStrategy)){var containerSize={width:$(this.domElement).width(),height:$(this.domElement).height()},scaleFactor=rectMaster.width/containerSize.width,scaledMaster={width:masterDimensions.width*scaleFactor,height:masterDimensions.height*scaleFactor};if(rectMaster.left=Number(rectMaster.left),rectMaster.top=Number(rectMaster.top),rectMaster.width=Number(rectMaster.width),rectMaster.height=Number(rectMaster.height),rectMaster=this.profileFrameStrategy.adaptFrame(scaledMaster,rectMaster),video2){var scaledSlave={width:slaveDimensions.width*scaleFactor,height:slaveDimensions.height*scaleFactor};rectSlave.left=Number(rectSlave.left),rectSlave.top=Number(rectSlave.top),rectSlave.width=Number(rectSlave.width),rectSlave.height=Number(rectSlave.height),rectSlave=this.profileFrameStrategy.adaptFrame(scaledSlave,rectSlave)}}video1.setRect(rectMaster,animate),this.currentMasterVideoRect=rectMaster,video1.setVisible(profileData.masterVideo.visible,animate),this.currentMasterVideoRect.visible=/true/i.test(profileData.masterVideo.visible)?!0:!1,this.currentMasterVideoRect.layer=parseInt(profileData.masterVideo.layer),video2&&(video2.setRect(rectSlave,animate),this.currentSlaveVideoRect=rectSlave,this.currentSlaveVideoRect.visible=/true/i.test(profileData.slaveVideo.visible)?!0:!1,this.currentSlaveVideoRect.layer=parseInt(profileData.slaveVideo.layer),video2.setVisible(profileData.slaveVideo.visible,animate),video2.setLayer(profileData.slaveVideo.layer)),video1.setLayer(profileData.masterVideo.layer),background.setImage("config/profiles/resources/"+profileData.background.content)}},resizePortrail:function(){var width=1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width(),relativeSize=new paella.RelativeVideoSize,height=relativeSize.proportionalHeight(width);this.container.domElement.style.width=width+"px",this.container.domElement.style.height=height+"px";var containerHeight=1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height(),newTop=containerHeight/2-height/2;this.container.domElement.style.top=newTop+"px"},resizeLandscape:function(){var height=1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height(),relativeSize=new paella.RelativeVideoSize,width=relativeSize.proportionalWidth(height);this.container.domElement.style.width=width+"px",this.container.domElement.style.height=height+"px",this.container.domElement.style.top="0px"},onresize:function(){this.parent();var relativeSize=new paella.RelativeVideoSize,aspectRatio=relativeSize.aspectRatio(),width=1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width(),height=1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height(),containerAspectRatio=width/height;containerAspectRatio>aspectRatio?this.resizeLandscape():this.resizePortrail()}}),Class("paella.PluginManager",{targets:null,pluginList:[],eventDrivenPlugins:[],enabledPlugins:[],setupPlugin:function(plugin){plugin.setup(),this.enabledPlugins.push(plugin),dynamic_cast("paella.UIPlugin",plugin)&&plugin.checkVisibility()},checkPluginsVisibility:function(){this.enabledPlugins.forEach(function(plugin){dynamic_cast("paella.UIPlugin",plugin)&&plugin.checkVisibility()})},initialize:function(){this.targets={};var thisClass=this;paella.events.bind(paella.events.loadPlugins,function(){thisClass.loadPlugins("paella.DeferredLoadPlugin")})},setTarget:function(pluginType,target){target.addPlugin&&(this.targets[pluginType]=target)},getTarget:function(pluginType){if("eventDriven"==pluginType)return this;var target=this.targets[pluginType];return target},registerPlugin:function(plugin){this.importLibraries(plugin),this.pluginList.push(plugin),this.pluginList.sort(function(a,b){return a.getIndex()-b.getIndex()})},importLibraries:function(plugin){plugin.getDependencies().forEach(function(lib){var script=document.createElement("script");script.type="text/javascript",script.src="javascript/"+lib+".js",document.head.appendChild(script)})},loadPlugins:function(pluginBaseClass){if(void 0!=pluginBaseClass){var This=this;this.foreach(function(plugin,config){null!=dynamic_cast(pluginBaseClass,plugin)&&config.enabled&&(base.log.debug("Load plugin ("+pluginBaseClass+"): "+plugin.getName()),plugin.config=config,plugin.load(This))
})}},foreach:function(callback){var enablePluginsByDefault=!1,pluginsConfig={};try{enablePluginsByDefault=paella.player.config.plugins.enablePluginsByDefault}catch(e){}try{pluginsConfig=paella.player.config.plugins.list}catch(e){}this.pluginList.forEach(function(plugin){var name=plugin.getName(),config=pluginsConfig[name];config||(config={enabled:enablePluginsByDefault}),callback(plugin,config)})},addPlugin:function(plugin){var thisClass=this;plugin.checkEnabled(function(isEnabled){if("eventDriven"==plugin.type&&isEnabled){paella.pluginManager.setupPlugin(plugin),thisClass.eventDrivenPlugins.push(plugin);for(var events=plugin.getEvents(),eventBind=function(event,params){plugin.onEvent(event.type,params)},i=0;i<events.length;++i){var eventName=events[i];paella.events.bind(eventName,eventBind)}}})},getPlugin:function(name){for(var i=0;i<this.pluginList.length;++i)if(this.pluginList[i].getName()==name)return this.pluginList[i];return null}}),paella.pluginManager=new paella.PluginManager,Class("paella.Plugin",{type:"",initialize:function(){paella.pluginManager.registerPlugin(this)},getDependencies:function(){return[]},load:function(pluginManager){var target=pluginManager.getTarget(this.type);target&&target.addPlugin&&target.addPlugin(this)},getRootNode:function(){return null},checkEnabled:function(onSuccess){onSuccess(!0)},setup:function(){},getIndex:function(){return 0},getName:function(){return""}}),Class("paella.FastLoadPlugin",paella.Plugin,{}),Class("paella.EarlyLoadPlugin",paella.Plugin,{}),Class("paella.DeferredLoadPlugin",paella.Plugin,{}),Class("paella.PopUpContainer",paella.DomNode,{containers:null,currentContainerId:-1,initialize:function(id,className){var This=this,style={};this.parent("div",id,style),this.domElement.className=className,this.containers={},paella.events.bind(paella.events.hidePopUp,function(event,params){This.hideContainer(params.identifier,params.button)}),paella.events.bind(paella.events.showPopUp,function(event,params){This.showContainer(params.identifier,params.button)})},hideContainer:function(identifier){var container=this.containers[identifier];container&&this.currentContainerId==identifier&&(container.plugin.willHideContent(),$(container.element).hide(),container.button.className=container.button.className.replace(" selected",""),$(this.domElement).css({width:"0px"}),this.currentContainerId=-1,container.plugin.didHideContent())},showContainer:function(identifier,button){function hideContainer(container){container.plugin.willHideContent(),$(container.element).hide(),$(thisClass.domElement).css({width:"0px"}),container.button.className=container.button.className.replace(" selected",""),thisClass.currentContainerId=-1,container.plugin.didHideContent()}function showContainer(container){if(container.plugin.willShowContent(),container.button.className=container.button.className+" selected",$(container.element).show(),width=$(container.element).width(),"right"==container.plugin.getAlignment()){var right=$(button.parentElement).width()-$(button).position().left-$(button).width();$(thisClass.domElement).css({width:width+"px",right:right+"px",left:""})}else{var left=$(button).position().left;$(thisClass.domElement).css({width:width+"px",left:left+"px",right:""})}thisClass.currentContainerId=identifier,container.plugin.didShowContent()}var thisClass=this,width=0,container=this.containers[identifier];if(container&&this.currentContainerId!=identifier&&-1!=this.currentContainerId){var prevContainer=this.containers[this.currentContainerId];hideContainer(prevContainer),showContainer(container)}else container&&this.currentContainerId==identifier?hideContainer(container):container&&showContainer(container)},registerContainer:function(identifier,domElement,button,plugin){var containerInfo={button:button,element:domElement,plugin:plugin};this.containers[identifier]=containerInfo,$(domElement).hide(),button.popUpIdentifier=identifier,button.sourcePlugin=plugin,$(button).click(function(){this.plugin.isPopUpOpen()?paella.events.trigger(paella.events.hidePopUp,{identifier:this.popUpIdentifier,button:this}):paella.events.trigger(paella.events.showPopUp,{identifier:this.popUpIdentifier,button:this})}),$(button).keyup(function(event){13!=event.keyCode||this.plugin.isPopUpOpen()?27==event.keyCode&&paella.events.trigger(paella.events.hidePopUp,{identifier:this.popUpIdentifier,button:this}):paella.events.trigger(paella.events.showPopUp,{identifier:this.popUpIdentifier,button:this})}),plugin.containerManager=this}}),Class("paella.TimelineContainer",paella.PopUpContainer,{hideContainer:function(identifier){var container=this.containers[identifier];container&&this.currentContainerId==identifier&&(container.plugin.willHideContent(),$(container.element).hide(),container.button.className=container.button.className.replace(" selected",""),this.currentContainerId=-1,$(this.domElement).css({height:"0px"}),container.plugin.didHideContent())},showContainer:function(identifier){var height=0,container=this.containers[identifier];if(container&&this.currentContainerId!=identifier&&-1!=this.currentContainerId){var prevContainer=this.containers[this.currentContainerId];prevContainer.button.className=prevContainer.button.className.replace(" selected",""),container.button.className=container.button.className+" selected",prevContainer.plugin.willHideContent(),$(prevContainer.element).hide(),prevContainer.plugin.didHideContent(),container.plugin.willShowContent(),$(container.element).show(),this.currentContainerId=identifier,height=$(container.element).height(),$(this.domElement).css({height:height+"px"}),container.plugin.didShowContent()}else container&&this.currentContainerId==identifier?(container.plugin.willHideContent(),$(container.element).hide(),container.button.className=container.button.className.replace(" selected",""),$(this.domElement).css({height:"0px"}),this.currentContainerId=-1,container.plugin.didHideContent()):container&&(container.plugin.willShowContent(),container.button.className=container.button.className+" selected",$(container.element).show(),this.currentContainerId=identifier,height=$(container.element).height(),$(this.domElement).css({height:height+"px"}),container.plugin.didShowContent())}}),Class("paella.UIPlugin",paella.DeferredLoadPlugin,{ui:null,checkVisibility:function(){var modes=this.config.visibleOn||[paella.PaellaPlayer.mode.standard,paella.PaellaPlayer.mode.fullscreen,paella.PaellaPlayer.mode.embed],visible=!1;modes.forEach(function(m){m==paella.player.getPlayerMode()&&(visible=!0)}),visible?this.showUI():this.hideUI()},hideUI:function(){this.ui.setAttribute("aria-hidden","true"),$(this.ui).hide()},showUI:function(){var thisClass=this;paella.pluginManager.enabledPlugins.forEach(function(p){p==thisClass&&(thisClass.ui.setAttribute("aria-hidden","false"),$(thisClass.ui).show())})}}),Class("paella.ButtonPlugin",paella.UIPlugin,{type:"button",subclass:"",container:null,containerManager:null,getAlignment:function(){return"left"},getSubclass:function(){return"myButtonPlugin"},addSubclass:function($subclass){$(this.container).addClass($subclass)},removeSubclass:function($subclass){$(this.container).removeClass($subclass)},action:function(){},getName:function(){return"ButtonPlugin"},getMinWindowSize:function(){return 0},buildContent:function(){},willShowContent:function(){base.log.debug(this.getName()+" willDisplayContent")},didShowContent:function(){base.log.debug(this.getName()+" didDisplayContent")},willHideContent:function(){base.log.debug(this.getName()+" willHideContent")},didHideContent:function(){base.log.debug(this.getName()+" didHideContent")},getButtonType:function(){return paella.ButtonPlugin.type.actionButton},getText:function(){return""},setText:function(text){this.container.innerHTML=text},hideButton:function(){this.hideUI()},showButton:function(){this.showUI()},changeSubclass:function(newSubclass){this.subclass=newSubclass,this.container.className=this.getClassName()},getClassName:function(){return paella.ButtonPlugin.kClassName+" "+this.getAlignment()+" "+this.subclass},getContainerClassName:function(){return this.getButtonType()==paella.ButtonPlugin.type.timeLineButton?paella.ButtonPlugin.kTimeLineClassName+" "+this.getSubclass():this.getButtonType()==paella.ButtonPlugin.type.popUpButton?paella.ButtonPlugin.kPopUpClassName+" "+this.getSubclass():void 0},setToolTip:function(message){this.button.setAttribute("title",message),this.button.setAttribute("aria-label",message)},getDefaultToolTip:function(){return""},isPopUpOpen:function(){return this.button.popUpIdentifier==this.containerManager.currentContainerId}}),paella.ButtonPlugin.alignment={left:"left",right:"right"},paella.ButtonPlugin.kClassName="buttonPlugin",paella.ButtonPlugin.kPopUpClassName="buttonPluginPopUp",paella.ButtonPlugin.kTimeLineClassName="buttonTimeLine",paella.ButtonPlugin.type={actionButton:1,popUpButton:2,timeLineButton:3},paella.ButtonPlugin.buildPluginButton=function(plugin,id){function onAction(self){paella.userTracking.log("paella:button:action",self.plugin.getName()),self.plugin.action(self)}plugin.subclass=plugin.getSubclass();var elem=document.createElement("div");return elem.className=plugin.getClassName(),elem.id=id,elem.innerHTML=plugin.getText(),elem.setAttribute("tabindex",1e3+plugin.getIndex()),elem.setAttribute("alt",""),elem.setAttribute("role","button"),elem.plugin=plugin,plugin.button=elem,plugin.container=elem,plugin.ui=elem,plugin.setToolTip(plugin.getDefaultToolTip()),$(elem).click(function(){onAction(this)}),$(elem).keyup(function(event){13==event.keyCode&&onAction(this)}),elem},paella.ButtonPlugin.buildPluginPopUp=function(parent,plugin,id){plugin.subclass=plugin.getSubclass();var elem=document.createElement("div");return parent.appendChild(elem),elem.className=plugin.getContainerClassName(),elem.id=id,elem.plugin=plugin,plugin.buildContent(elem),elem},Class("paella.VideoOverlayButtonPlugin",paella.ButtonPlugin,{type:"videoOverlayButton",getSubclass:function(){return"myVideoOverlayButtonPlugin"},action:function(){},getName:function(){return"VideoOverlayButtonPlugin"}}),Class("paella.EventDrivenPlugin",paella.EarlyLoadPlugin,{type:"eventDriven",initialize:function(){this.parent();for(var events=this.getEvents(),i=0;i<events.length;++i){var event=events[i];event==paella.events.loadStarted&&this.onEvent(paella.events.loadStarted)}},getEvents:function(){return[]},onEvent:function(){},getName:function(){return"EventDrivenPlugin"}}),function(){var captionParserManager=new(Class({_formats:{},addPlugin:function(plugin){var self=this,ext=plugin.ext;0==(Array.isArray&&Array.isArray(ext)||ext instanceof Array)&&(ext=[ext]),0==ext.length?base.log.debug("No extension provided by the plugin "+plugin.getName()):(base.log.debug("New captionParser added: "+plugin.getName()),ext.forEach(function(f){self._formats[f]=plugin}))},initialize:function(){paella.pluginManager.setTarget("captionParser",this)}})),SearchCallback=Class(base.AsyncLoaderCallback,{initialize:function(caption,text){this.name="captionSearchCallback",this.caption=caption,this.text=text},load:function(onSuccess,onError){var self=this;this.caption.search(this.text,function(err,result){err?onError():(self.result=result,onSuccess())})}});paella.captions={parsers:{},_captions:{},_activeCaption:void 0,addCaptions:function(captions){var cid=captions._captionsProvider+":"+captions._id;this._captions[cid]=captions,paella.events.trigger(paella.events.captionAdded,cid)},getAvailableLangs:function(){var ret=[],self=this;return Object.keys(this._captions).forEach(function(k){var c=self._captions[k];ret.push({id:k,lang:c._lang})}),ret},getCaptions:function(cid){return cid&&this._captions[cid]?this._captions[cid]:void 0},getActiveCaptions:function(){return this._activeCaption},setActiveCaptions:function(cid){return this._activeCaption=this.getCaptions(cid),void 0!=this._activeCaption?paella.events.trigger(paella.events.captionsEnabled,cid):paella.events.trigger(paella.events.captionsDisabled),this._activeCaption},getCaptionAtTime:function(cid,time){var c=this.getCaptions(cid);return void 0!=c?c.getCaptionAtTime(time):void 0},search:function(text,next){var self=this,asyncLoader=new base.AsyncLoader;this.getAvailableLangs().forEach(function(l){asyncLoader.addCallback(new SearchCallback(self.getCaptions(l.id),text))}),asyncLoader.load(function(){var res=[];Object.keys(asyncLoader.callbackArray).forEach(function(k){res=res.concat(asyncLoader.getCallback(k).result)}),next&&next(!1,res)},function(){next&&next(!0)})}},Class("paella.captions.Caption",{initialize:function(id,format,url,lang,next){this._id=id,this._format=format,this._url=url,this._captions=void 0,this._index=lunr(function(){this.ref("id"),this.field("content",{boost:10})}),"string"==typeof lang&&(lang={code:lang,txt:lang}),this._lang=lang,this._captionsProvider="downloadCaptionsProvider",this.reloadCaptions(next)},canEdit:function(next){next(!1,!1)},goToEdit:function(){},reloadCaptions:function(next){var self=this;base.ajax.get({url:self._url},function(data,contentType,returnCode,dataRaw){var parser=captionParserManager._formats[self._format];void 0==parser?(base.log.debug("Error adding captions: Format not supported!"),next&&next(!0)):parser.parse(dataRaw,self._lang.code,function(err,c){err||(self._captions=c,self._captions.forEach(function(cap){self._index.add({id:cap.id,content:cap.content})})),next&&next(err)})},function(){base.log.debug("Error loading captions: "+url),next&&next(!0)})},getCaptions:function(){return this._captions},getCaptionAtTime:function(time){if(void 0!=this._captions)for(var i=0;i<this._captions.length;++i)if(l_cap=this._captions[i],l_cap.begin<=time&&l_cap.end>=time)return l_cap;return void 0},getCaptionById:function(id){if(void 0!=this._captions)for(var i=0;i<this._captions.length;++i)if(l_cap=this._captions[i],l_cap.id==id)return l_cap;return void 0},search:function(txt,next){var self=this;if(void 0==this._index)next&&next(!0,"Error. No captions found.");else{var results=[];this._index.search(txt).forEach(function(s){var c=self.getCaptionById(s.ref);results.push({time:c.begin,content:c.content,score:s.score})}),next&&next(!1,results)}}}),Class("paella.CaptionParserPlugIn",paella.FastLoadPlugin,{type:"captionParser",getIndex:function(){return-1},ext:[],parse:function(){throw new Error("paella.CaptionParserPlugIn#parse must be overridden by subclass")}})}(),function(){var searchServiceManager=new(Class({_plugins:[],addPlugin:function(plugin){this._plugins.push(plugin)},initialize:function(){paella.pluginManager.setTarget("SearchServicePlugIn",this)}})),SearchCallback=Class(base.AsyncLoaderCallback,{initialize:function(plugin,text){this.name="searchCallback",this.plugin=plugin,this.text=text},load:function(onSuccess,onError){var self=this;this.plugin.search(this.text,function(err,result){err?onError():(self.result=result,onSuccess())})}});paella.searchService={search:function(text,next){var asyncLoader=new base.AsyncLoader;paella.userTracking.log("paella:searchService:search",text),searchServiceManager._plugins.forEach(function(p){asyncLoader.addCallback(new SearchCallback(p,text))}),asyncLoader.load(function(){var res=[];Object.keys(asyncLoader.callbackArray).forEach(function(k){res=res.concat(asyncLoader.getCallback(k).result)}),next&&next(!1,res)},function(){next&&next(!0)})}},Class("paella.SearchServicePlugIn",paella.FastLoadPlugin,{type:"SearchServicePlugIn",getIndex:function(){return-1},search:function(){throw new Error("paella.SearchServicePlugIn#search must be overridden by subclass")}})}(),function(){var userTrackingManager=new(Class({_plugins:[],addPlugin:function(plugin){var self=this;plugin.checkEnabled(function(isEnabled){isEnabled&&(plugin.setup(),self._plugins.push(plugin))})},initialize:function(){paella.pluginManager.setTarget("userTrackingSaverPlugIn",this)}}));paella.userTracking={},Class("paella.userTracking.SaverPlugIn",paella.FastLoadPlugin,{type:"userTrackingSaverPlugIn",getIndex:function(){return-1},checkEnabled:function(onSuccess){onSuccess(!0)},log:function(){throw new Error("paella.userTracking.SaverPlugIn#log must be overridden by subclass")}});var evsentsToLog={};paella.userTracking.log=function(event,params){void 0!=evsentsToLog[event]&&evsentsToLog[event].cancel(),evsentsToLog[event]=new base.Timer(function(){userTrackingManager._plugins.forEach(function(p){p.log(event,params)}),delete evsentsToLog[event]},500)},[paella.events.play,paella.events.pause,paella.events.endVideo,paella.events.showEditor,paella.events.hideEditor,paella.events.enterFullscreen,paella.events.exitFullscreen,paella.events.loadComplete].forEach(function(event){paella.events.bind(event,function(){paella.userTracking.log(event)})}),[paella.events.showPopUp,paella.events.hidePopUp].forEach(function(event){paella.events.bind(event,function(ev,params){paella.userTracking.log(event,params.identifier)})}),[paella.events.captionsEnabled,paella.events.captionsDisabled].forEach(function(event){paella.events.bind(event,function(ev,params){var log;if(void 0!=params){var c=paella.captions.getCaptions(params);log={id:params,lang:c._lang,url:c._url}}paella.userTracking.log(event,log)})}),[paella.events.setProfile].forEach(function(event){paella.events.bind(event,function(ev,params){paella.userTracking.log(event,params.profileName)})}),[paella.events.seekTo,paella.events.seekToTime].forEach(function(event){paella.events.bind(event,function(ev,params){var log;try{JSON.stringify(params),log=params}catch(e){}paella.userTracking.log(event,log)})}),[paella.events.setVolume,paella.events.resize,paella.events.setPlaybackRate].forEach(function(event){paella.events.bind(event,function(ev,params){var log;try{JSON.stringify(params),log=params}catch(e){}paella.userTracking.log(event,log)})})}(),Class("paella.TimeControl",paella.DomNode,{initialize:function(id){this.parent("div",id,{left:"0%"}),this.domElement.className="timeControlOld",this.domElement.className="timeControl";var thisClass=this;paella.events.bind(paella.events.timeupdate,function(event,params){thisClass.onTimeUpdate(params)})},onTimeUpdate:function(memo){var videoContainer=memo.videoContainer,trimmed=({start:0,end:videoContainer.duration},{start:videoContainer.trimStart(),end:videoContainer.trimEnd()}),currentTime=memo.currentTime-trimmed.start,duration=trimmed.end-trimmed.start,percent=100*currentTime/duration;"timeControlOld"==this.domElement.className&&(this.domElement.style.left=percent+"%"),this.domElement.innerHTML=this.secondsToHours(parseInt(currentTime))},secondsToHours:function(sec_numb){var hours=Math.floor(sec_numb/3600),minutes=Math.floor((sec_numb-3600*hours)/60),seconds=sec_numb-3600*hours-60*minutes;return 10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),10>seconds&&(seconds="0"+seconds),hours+":"+minutes+":"+seconds}}),Class("paella.PlaybackBar",paella.DomNode,{playbackFullId:"",updatePlayBar:!0,timeControlId:"",_images:null,_keys:null,_ant:null,_next:null,_videoLength:null,_lastSrc:null,_aspectRatio:1.777777778,_hasSlides:null,_imgNode:null,initialize:function(id){var self=this;self.imageSetup();var style={};this.parent("div",id,style),this.domElement.className="playbackBar",this.domElement.setAttribute("alt",""),this.domElement.setAttribute("aria-label","Timeline Slider"),this.domElement.setAttribute("role","slider"),this.domElement.setAttribute("aria-valuemin","0"),this.domElement.setAttribute("aria-valuemax","100"),this.domElement.setAttribute("aria-valuenow","0"),this.domElement.setAttribute("tabindex","1100"),$(this.domElement).keyup(function(event){var curr,selectedPosition;switch(event.keyCode){case 37:curr=100*paella.player.videoContainer.currentTime()/paella.player.videoContainer.duration(),selectedPosition=curr-5,paella.events.trigger(paella.events.seekTo,{newPositionPercent:selectedPosition});break;case 39:curr=100*paella.player.videoContainer.currentTime()/paella.player.videoContainer.duration(),selectedPosition=curr+5,paella.events.trigger(paella.events.seekTo,{newPositionPercent:selectedPosition})}}),this.playbackFullId=id+"_full",this.timeControlId=id+"_timeControl";var playbackFull=new paella.DomNode("div",this.playbackFullId,{width:"0%"});playbackFull.domElement.className="playbackBarFull",this.addNode(playbackFull),this.addNode(new paella.TimeControl(this.timeControlId));var thisClass=this;paella.events.bind(paella.events.timeupdate,function(event,params){thisClass.onTimeUpdate(params)}),$(this.domElement).bind("mousedown",function(event){paella.utils.mouseManager.down(thisClass,event),event.stopPropagation()}),$(playbackFull.domElement).bind("mousedown",function(event){paella.utils.mouseManager.down(thisClass,event),event.stopPropagation()}),base.userAgent.browser.IsMobileVersion||($(this.domElement).bind("mousemove",function(event){thisClass.movePassive(event),paella.utils.mouseManager.move(event)}),$(playbackFull.domElement).bind("mousemove",function(event){paella.utils.mouseManager.move(event)}),$(this.domElement).bind("mouseout",function(event){thisClass.mouseOut(event)})),$(this.domElement).bind("mouseup",function(event){paella.utils.mouseManager.up(event)}),$(playbackFull.domElement).bind("mouseup",function(event){paella.utils.mouseManager.up(event)}),paella.player.isLiveStream()&&$(this.domElement).hide()},mouseOut:function(){var self=this;self._hasSlides?$("#divTimeImageOverlay").remove():$("#divTimeOverlay").remove()},movePassive:function(event){var self=this,p=$("#playerContainer_controls_playback_playbackBar"),pos=p.offset(),width=$("#playerContainer_controls_playback_playbackBar").width(),left=event.clientX-pos.left;left=0>left?0:left;var position=100*left/width,time=paella.player.videoContainer.duration("");time=position*time/100;var hou=Math.floor(time/3600)%24;hou=("00"+hou).slice(hou.toString().length);var min=Math.floor(time/60)%60;min=("00"+min).slice(min.toString().length);var sec=Math.floor(time%60);sec=("00"+sec).slice(sec.toString().length);var timestr=hou+":"+min+":"+sec;if(self._hasSlides?(0==$("#divTimeImageOverlay").length?self.setupTimeImageOverlay(timestr,pos.top,width):$("#divTimeOverlay")[0].innerHTML=timestr,self.imageUpdate(time)):0==$("#divTimeOverlay").length?self.setupTimeOnly(timestr,pos.top,width):$("#divTimeOverlay")[0].innerHTML=timestr,self._hasSlides){var ancho=$("#divTimeImageOverlay").width(),posx=event.clientX-ancho/2;event.clientX>ancho/2+pos.left&&event.clientX<pos.left+width-ancho/2?$("#divTimeImageOverlay").css("left",posx):event.clientX<width/2?$("#divTimeImageOverlay").css("left",pos.left):$("#divTimeImageOverlay").css("left",pos.left+width-ancho)}var ancho2=$("#divTimeOverlay").width(),posx2=event.clientX-ancho2/2;event.clientX>ancho2/2+pos.left&&event.clientX<pos.left+width-ancho2/2?$("#divTimeOverlay").css("left",posx2):event.clientX<width/2?$("#divTimeOverlay").css("left",pos.left):$("#divTimeOverlay").css("left",pos.left+width-ancho2-2),self._hasSlides&&(p=$("#divTimeImageOverlay").height(),$("#divTimeImageOverlay").css("top",pos.top-p))},imageSetup:function(){var self=this;this._images={};var n=paella.initDelegate.initParams.videoLoader.frameList;return n&&0!==Object.keys(n).length?(self._hasSlides=!0,this._images=n,this._videoLength=paella.player.videoContainer.duration(""),this._keys=Object.keys(this._images),this._keys=this._keys.sort(function(a,b){return parseInt(a)-parseInt(b)}),this._next=0,void(this._ant=0)):void(self._hasSlides=!1)},imageUpdate:function(sec){var self=this,src=$("#imgOverlay").attr("src");if($(self._imgNode).show(),sec>this._next||sec<this._ant)src=self.returnSrc(sec),src?(self._lastSrc=src,$("#imgOverlay").attr("src",src)):self.hideImg();else{if(void 0!=src)return;$("#imgOverlay").attr("src",self._lastSrc)}},hideImg:function(){var self=this;$(self._imgNode).hide()},returnSrc:function(sec){var thisClass=this,keys=Object.keys(thisClass._images);keys.push(sec),keys.sort(function(a,b){return parseInt(a)-parseInt(b)});var n=keys.indexOf(sec)-1;n=n>0?n:0;var i=keys[n],next=keys[n+2],ant=keys[n];return next=void 0==next?keys.length-1:parseInt(next),thisClass._next=next,ant=void 0==ant?0:parseInt(ant),thisClass._ant=ant,i=parseInt(i),thisClass._images[i]?thisClass._images[i].thumb:!1},setupTimeImageOverlay:function(time_str,top,width){var self=this,div=document.createElement("div");div.className="divTimeImageOverlay",div.id="divTimeImageOverlay";var aux=Math.round(width/10);if(div.style.width=Math.round(aux*self._aspectRatio)+"px",self._hasSlides){var img=document.createElement("img");img.className="imgOverlay",img.id="imgOverlay",self._imgNode=img,div.appendChild(img)}var div2=document.createElement("div");div2.className="divTimeOverlay",div2.style.top=top-20+"px",div2.id="divTimeOverlay",div2.innerHTML=time_str,div.appendChild(div2);var controlBar=document.getElementById("playerContainer_controls_playback");controlBar.appendChild(div)},setupTimeOnly:function(time_str,top){var div2=document.createElement("div");div2.className="divTimeOverlay",div2.style.top=top-20+"px",div2.id="divTimeOverlay",div2.innerHTML=time_str;var controlBar=document.getElementById("playerContainer_controls_playback");controlBar.appendChild(div2)},playbackFull:function(){return this.getNode(this.playbackFullId)},timeControl:function(){return this.getNode(this.timeControlId)},setPlaybackPosition:function(percent){this.playbackFull().domElement.style.width=percent+"%"},isSeeking:function(){return!this.updatePlayBar},onTimeUpdate:function(memo){if(this.updatePlayBar){var videoContainer=memo.videoContainer,trimmed=({start:0,end:videoContainer.duration},{start:videoContainer.trimStart(),end:videoContainer.trimEnd()}),currentTime=memo.currentTime-trimmed.start,duration=trimmed.end-trimmed.start;this.setPlaybackPosition(100*currentTime/duration)}},down:function(event,x,y){this.updatePlayBar=!1,this.move(event,x,y)},move:function(event,x){var width=$(this.domElement).width(),selectedPosition=x-$(this.domElement).offset().left;selectedPosition=0>selectedPosition?0:selectedPosition>width?100:100*selectedPosition/width,this.setPlaybackPosition(selectedPosition)},up:function(event,x){var width=$(this.domElement).width(),selectedPosition=x-$(this.domElement).offset().left;selectedPosition=0>selectedPosition?0:selectedPosition>width?100:100*selectedPosition/width,paella.events.trigger(paella.events.seekTo,{newPositionPercent:selectedPosition}),this.updatePlayBar=!0}}),Class("paella.PlaybackControl",paella.DomNode,{playbackBarId:"",pluginsContainer:null,popUpPluginContainer:null,timeLinePluginContainer:null,playbackPluginsWidth:0,popupPluginsWidth:0,minPlaybackBarSize:120,playbackBarInstance:null,buttonPlugins:[],addPlugin:function(plugin){var thisClass=this,id="buttonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(plugin);var button=paella.ButtonPlugin.buildPluginButton(plugin,id);plugin.button=button,this.pluginsContainer.domElement.appendChild(button),$(button).hide(),plugin.checkEnabled(function(isEnabled){var parent;if(isEnabled){$(plugin.button).show(),paella.pluginManager.setupPlugin(plugin);var id="buttonPlugin"+thisClass.buttonPlugins.length;if(plugin.getButtonType()==paella.ButtonPlugin.type.popUpButton){parent=thisClass.popUpPluginContainer.domElement;var popUpContent=paella.ButtonPlugin.buildPluginPopUp(parent,plugin,id+"_container");thisClass.popUpPluginContainer.registerContainer(plugin.getName(),popUpContent,button,plugin)}else if(plugin.getButtonType()==paella.ButtonPlugin.type.timeLineButton){parent=thisClass.timeLinePluginContainer.domElement;var timeLineContent=paella.ButtonPlugin.buildPluginPopUp(parent,plugin,id+"_timeline");thisClass.timeLinePluginContainer.registerContainer(plugin.getName(),timeLineContent,button,plugin)}}else thisClass.pluginsContainer.domElement.removeChild(plugin.button)})},initialize:function(id){var style={};this.parent("div",id,style),this.domElement.className="playbackControls",this.playbackBarId=id+"_playbackBar";this.pluginsContainer=new paella.DomNode("div",id+"_playbackBarPlugins"),this.pluginsContainer.domElement.className="playbackBarPlugins",this.pluginsContainer.domElement.setAttribute("role","toolbar"),this.addNode(this.pluginsContainer),this.popUpPluginContainer=new paella.PopUpContainer(id+"_popUpPluginContainer","popUpPluginContainer"),this.addNode(this.popUpPluginContainer),this.timeLinePluginContainer=new paella.TimelineContainer(id+"_timelinePluginContainer","timelinePluginContainer"),this.addNode(this.timeLinePluginContainer),this.addNode(new paella.PlaybackBar(this.playbackBarId)),paella.pluginManager.setTarget("button",this)},playbackBar:function(){return null==this.playbackBarInstance&&(this.playbackBarInstance=this.getNode(this.playbackBarId)),this.playbackBarInstance},onresize:function(){var windowSize=$(this.domElement).width();base.log.debug("resize playback bar (width="+windowSize+")");for(var i=0;i<this.buttonPlugins.length;++i){var plugin=this.buttonPlugins[i],minSize=plugin.getMinWindowSize();minSize>0&&minSize>windowSize?plugin.hideUI():plugin.checkVisibility()}}}),Class("paella.ControlsContainer",paella.DomNode,{playbackControlId:"",editControlId:"",isEnabled:!0,autohideTimer:null,hideControlsTimeMillis:3e3,playbackControlInstance:null,videoOverlayButtons:null,buttonPlugins:[],_hidden:!1,addPlugin:function(plugin){var id="videoOverlayButtonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(plugin);var button=paella.ButtonPlugin.buildPluginButton(plugin,id);this.videoOverlayButtons.domElement.appendChild(button),plugin.button=button,$(button).hide(),plugin.checkEnabled(function(isEnabled){isEnabled&&($(plugin.button).show(),paella.pluginManager.setupPlugin(plugin))})},initialize:function(id){this.parent("div",id),this.viewControlId=id+"_view",this.playbackControlId=id+"_playback",this.editControlId=id+"_editor",this.addNode(new paella.PlaybackControl(this.playbackControlId));var thisClass=this;paella.events.bind(paella.events.showEditor,function(){thisClass.onShowEditor()}),paella.events.bind(paella.events.hideEditor,function(){thisClass.onHideEditor()}),paella.events.bind(paella.events.play,function(){thisClass.onPlayEvent()}),paella.events.bind(paella.events.pause,function(){thisClass.onPauseEvent()}),$(document).mousemove(function(){paella.player.controls.restartTimerEvent()}),paella.events.bind(paella.events.endVideo,function(){thisClass.onEndVideoEvent()}),paella.events.bind("keydown",function(){thisClass.onKeyEvent()}),this.videoOverlayButtons=new paella.DomNode("div",id+"_videoOverlayButtonPlugins"),this.videoOverlayButtons.domElement.className="videoOverlayButtonPlugins",this.videoOverlayButtons.domElement.setAttribute("role","toolbar"),this.addNode(this.videoOverlayButtons),paella.pluginManager.setTarget("videoOverlayButton",this)},onShowEditor:function(){var editControl=this.editControl();editControl&&$(editControl.domElement).hide()},onHideEditor:function(){var editControl=this.editControl();editControl&&$(editControl.domElement).show()},enterEditMode:function(){var playbackControl=this.playbackControl(),editControl=this.editControl();playbackControl&&editControl&&$(playbackControl.domElement).hide()},exitEditMode:function(){var playbackControl=this.playbackControl(),editControl=this.editControl();playbackControl&&editControl&&$(playbackControl.domElement).show()},playbackControl:function(){return null==this.playbackControlInstance&&(this.playbackControlInstance=this.getNode(this.playbackControlId)),this.playbackControlInstance},editControl:function(){return this.getNode(this.editControlId)},disable:function(){this.isEnabled=!1,this.hide()},enable:function(){this.isEnabled=!0,this.show()},isHidden:function(){return this._hidden},hide:function(){function hideIfNotCanceled(){This._doHide&&($(This.domElement).css({opacity:0}),$(This.domElement).hide(),This.domElement.setAttribute("aria-hidden","true"),This._hidden=!0,paella.events.trigger(paella.events.controlBarDidHide))}var This=this;this._doHide=!0,paella.events.trigger(paella.events.controlBarWillHide),This._doHide&&(base.userAgent.browser.IsMobileVersion||base.userAgent.browser.Explorer?hideIfNotCanceled():$(this.domElement).animate({opacity:0},{duration:300,complete:hideIfNotCanceled}))
},show:function(){this.isEnabled&&($(this.domElement).stop(),this._doHide=!1,this.domElement.style.opacity=1,this.domElement.setAttribute("aria-hidden","false"),this._hidden=!1,$(this.domElement).show(),paella.events.trigger(paella.events.controlBarDidShow))},autohideTimeout:function(){var playbackBar=this.playbackControl().playbackBar();playbackBar.isSeeking()?paella.player.controls.restartHideTimer():paella.player.controls.hideControls()},hideControls:function(){this.hide()},showControls:function(){this.show()},onPlayEvent:function(){this.restartHideTimer()},onPauseEvent:function(){this.clearAutohideTimer()},onEndVideoEvent:function(){this.show(),this.clearAutohideTimer()},onKeyEvent:function(){this.showControls(),paella.player.videoContainer.isReady()&&!paella.player.videoContainer.paused()&&paella.player.controls.restartHideTimer()},cancelHideBar:function(){this.restartTimerEvent()},restartTimerEvent:function(){this.isHidden()&&this.showControls(),this._doHide=!1;var paused=paella.player.videoContainer.paused();paused||this.restartHideTimer()},clearAutohideTimer:function(){null!=this.autohideTimer&&(this.autohideTimer.cancel(),this.autohideTimer=null)},restartHideTimer:function(){this.clearAutohideTimer();var thisClass=this;this.autohideTimer=new base.Timer(function(){thisClass.autohideTimeout()},this.hideControlsTimeMillis)},onresize:function(){this.playbackControl().onresize()}}),Class("paella.LoaderContainer",paella.DomNode,{timer:null,loader:null,loaderPosition:0,initialize:function(id){this.parent("div",id,{position:"fixed",backgroundColor:"white",opacity:"0.7",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:1e4}),this.loader=this.addNode(new paella.DomNode("div","",{position:"fixed",width:"128px",height:"128px",top:"50%",left:"50%",marginLeft:"-64px",marginTop:"-64px",backgroundImage:"url(resources/images/loader.png)"}));var thisClass=this;paella.events.bind(paella.events.loadComplete,function(event,params){thisClass.loadComplete(params)}),this.timer=new base.Timer(function(){thisClass.loaderPosition-=128,thisClass.loader.domElement.style.backgroundPosition=thisClass.loaderPosition+"px"},1e3),this.timer.repeat=!0},loadComplete:function(){$(this.domElement).hide(),this.timer.repeat=!1}}),Class("paella.KeyManager",{isPlaying:!1,Keys:{Space:32,Left:37,Up:38,Right:39,Down:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},enabled:!0,initialize:function(){var thisClass=this;paella.events.bind(paella.events.loadComplete,function(event,params){thisClass.loadComplete(event,params)}),paella.events.bind(paella.events.play,function(){thisClass.onPlay()}),paella.events.bind(paella.events.pause,function(){thisClass.onPause()})},loadComplete:function(){var thisClass=this;paella.events.bind("keyup",function(event){thisClass.keyUp(event)})},onPlay:function(){this.isPlaying=!0},onPause:function(){this.isPlaying=!1},keyUp:function(event){this.enabled&&(event.altKey&&event.ctrlKey?event.which==this.Keys.P?this.togglePlayPause():event.which==this.Keys.S?this.pause():event.which==this.Keys.M?this.mute():event.which==this.Keys.U?this.volumeUp():event.which==this.Keys.D&&this.volumeDown():event.which==this.Keys.Space?this.togglePlayPause():event.which==this.Keys.Up?this.volumeUp():event.which==this.Keys.Down?this.volumeDown():event.which==this.Keys.M&&this.mute())},togglePlayPause:function(){paella.events.trigger(this.isPlaying?paella.events.pause:paella.events.play)},pause:function(){paella.events.trigger(paella.events.pause)},mute:function(){var videoContainer=paella.player.videoContainer,newVolume=0;0==videoContainer.volume()&&(newVolume=1),paella.events.trigger(paella.events.setVolume,{master:newVolume,slave:0})},volumeUp:function(){var videoContainer=paella.player.videoContainer,volume=videoContainer.volume();volume+=.1,volume=volume>1?1:volume,paella.events.trigger(paella.events.setVolume,{master:volume,slave:0})},volumeDown:function(){var videoContainer=paella.player.videoContainer,volume=videoContainer.volume();volume-=.1,volume=0>volume?0:volume,paella.events.trigger(paella.events.setVolume,{master:volume,slave:0})}}),paella.keyManager=new paella.KeyManager,Class("paella.AccessControl",{permissions:{canRead:!1,canContribute:!1,canWrite:!1,loadError:!0,isAnonymous:!1},userData:{username:"",name:"",lastname:"",avatar:""},checkAccess:function(onSuccess){onSuccess(this.permissions)},getAuthenticationUrl:function(){return""}}),Class("paella.DefaultAccessControl",paella.AccessControl,{checkAccess:function(onSuccess){var This=this;this.getUserData(function(data){This.permissions=data.permissions,This.userData=data.userData,onSuccess(This.permissions)})},getUserData:function(onSuccess){var status=!1;if(paella.player.config.auth){var callback=paella.player.config.auth.userDataCallbackName?window[paella.player.config.auth.userDataCallbackName]:null;"function"==typeof callback&&(status=!0,callback(onSuccess))}status||onSuccess({permissions:{canRead:!0,canContribute:!1,canWrite:!1,loadError:!1,isAnonymous:!0},userData:{username:"anonymous",name:"Anonymous",avatar:"resources/images/default_avatar.png"}})},getAuthenticationUrl:function(callbackParams){if(paella.player.config.auth){var callback=paella.player.config.auth.authCallbackName?window[paella.player.config.auth.authCallbackName]:null;if("function"==typeof callback)return callback(callbackParams)}return""}}),Class("paella.VideoLoader",{streams:[],frameList:[],loadStatus:!1,codecStatus:!1,isH264Capable:function(){var videoElement=document.createElement("video"),h264=videoElement.canPlayType('video/mp4; codecs="avc1.42E01E"');return""==h264&&(h264=videoElement.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),h264="probably"==h264},isOggCapable:function(){if(base.userAgent.browser.IsMobileVersion)return!1;var videoElement=document.createElement("video"),ogg=videoElement.canPlayType('video/ogg; codecs="theora"');return ogg="probably"==ogg},isWebmCapable:function(){if(base.userAgent.browser.IsMobileVersion)return!1;var videoElement=document.createElement("video"),webm=videoElement.canPlayType('video/webm; codecs="vp8, vorbis"');return webm="probably"==webm},isImageCapable:function(){return!0},isHtmlVideoCompatible:function(streamIndex){var status=!1;if(this.streams.length>streamIndex){var stream=this.streams[streamIndex],h264=this.isH264Capable(),ogg=this.isOggCapable(),webm=this.isWebmCapable();base.log.debug("Browser video capabilities: mp4="+(h264?"yes":"no")+", ogg="+(ogg?"yes":"no")+", webm="+(webm?"yes":"no")),stream.sources.mp4&&h264&&!/rtmp:\/\//.test(stream.sources.mp4.src)?status=!0:stream.sources.ogg&&ogg?status=!0:stream.sources.webm&&webm&&(status=!0)}return status},isImageCompatible:function(streamIndex){var status=!1;if(this.streams.length>streamIndex){var stream=this.streams[streamIndex];stream.sources.image&&(status=!0)}return status},isFlashCompatible:function(streamIndex){var status=!1;if(this.streams.length>streamIndex){var stream=this.streams[streamIndex];stream.sources.mp4?status=!0:stream.sources.flv&&(status=!0)}return status&&!base.userAgent.browser.IsMobileVersion},isStreamingCompatible:function(streamIndex){var status=!1;if(this.streams.length>streamIndex){var stream=this.streams[streamIndex];status=base.userAgent.browser.IsMobileVersion&&stream.sources.hls?!0:!base.userAgent.browser.IsMobileVersion&&stream.sources.rtmp?!0:!1}return status},isStreamCompatible:function(streamIndex,method){var status=!1;return method.enabled&&("html"==method.name&&this.isHtmlVideoCompatible(streamIndex)?status=!0:"flash"==method.name&&this.isFlashCompatible(streamIndex)?status=!0:"streaming"==method.name&&this.isStreamingCompatible(streamIndex)?status=!0:"image"==method.name&&this.isImageCompatible(streamIndex)&&(status=!0)),status},getPreferredMethod:function(streamIndex){var i,preferredMethod=null,methods=paella.player.config.player.methods;if(base.userAgent.browser.IsMobileVersion&&streamIndex>=1)for(i=0;i<methods.length;++i)"image"==methods[i].name&&methods[i].enabled&&this.isStreamCompatible(streamIndex,methods[i])&&(preferredMethod=methods[i]);else for(i=0;i<methods.length;++i)if(this.isStreamCompatible(streamIndex,methods[i])){preferredMethod=methods[i];break}return preferredMethod},loadVideo:function(videoId,onSuccess){onSuccess()}}),Class("paella.PlayerBase",{config:null,playerId:"",mainContainer:null,videoContainer:null,controls:null,accessControl:null,checkCompatibility:function(){var message="";if(base.parameters.get("ignoreBrowserCheck"))return!0;if(base.userAgent.browser.IsMobileVersion)return!0;if(base.userAgent.browser.Chrome||base.userAgent.browser.Safari||base.userAgent.browser.Firefox||base.userAgent.browser.Opera||base.userAgent.browser.Explorer&&base.userAgent.browser.Version.major>=9)return!0;var errorMessage=base.dictionary.translate("It seems that your browser is not HTML 5 compatible");return paella.events.trigger(paella.events.error,{error:errorMessage}),message=errorMessage+'<div style="display:block;width:470px;height:140px;margin-left:auto;margin-right:auto;font-family:Verdana,sans-sherif;font-size:12px;"><a href="http://www.google.es/chrome" style="color:#004488;float:left;margin-right:20px;"><img src="resources/images/chrome.png" style="width:80px;height:80px" alt="Google Chrome"></img><p>Google Chrome</p></a><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home" style="color:#004488;float:left;margin-right:20px;"><img src="resources/images/explorer.png" style="width:80px;height:80px" alt="Internet Explorer 9"></img><p>Internet Explorer 9</p></a><a href="http://www.apple.com/safari/" style="float:left;margin-right:20px;color:#004488"><img src="resources/images/safari.png" style="width:80px;height:80px" alt="Safari"></img><p>Safari 5</p></a><a href="http://www.mozilla.org/firefox/" style="float:left;color:#004488"><img src="resources/images/firefox.png" style="width:80px;height:80px" alt="Firefox"></img><p>Firefox 12</p></a></div>',message+='<div style="margin-top:30px;"><a id="ignoreBrowserCheckLink" href="#" onclick="window.location = window.location + \'&ignoreBrowserCheck=true\'">'+base.dictionary.translate("Continue anyway")+"</a></div>",paella.messageBox.showError(message,{height:"40%"}),!1},initialize:function(playerId){if(this.checkCompatibility()){paella.player=this,this.playerId=playerId,this.mainContainer=$("#"+this.playerId)[0],this.accessControl=paella.initDelegate.initParams.accessControl;var thisClass=this;paella.events.bind(paella.events.loadComplete,function(event,params){thisClass.loadComplete(event,params)})}else base.log.debug("It seems that your browser is not HTML 5 compatible")},loadComplete:function(){},auth:{login:function(redirect){redirect=redirect||window.location.href;var url=paella.initDelegate.initParams.accessControl.getAuthenticationUrl(redirect);url&&(window.location.href=url)},permissions:function(){return paella.initDelegate.initParams.accessControl.permissions},userData:function(){return paella.initDelegate.initParams.accessControl.userData}}}),Class("paella.InitDelegate",{initParams:{configUrl:"config/config.json",dictionaryUrl:"localization/paella",accessControl:new paella.DefaultAccessControl,videoLoader:new paella.VideoLoader},initialize:function(params){if(params)for(var key in params)this.initParams[key]=params[key]},getId:function(){return base.parameters.get("id")||"noid"},loadDictionary:function(onSuccess){var asyncLoader=new base.AsyncLoader;asyncLoader.addCallback(new base.DictionaryCallback(this.initParams.dictionaryUrl)),asyncLoader.load(function(){onSuccess()},function(){onSuccess()})},loadConfig:function(onSuccess){var configUrl=this.initParams.configUrl,params={};params.url=configUrl,base.ajax.get(params,function(data){if("string"==typeof data)try{data=JSON.parse(data)}catch(e){onSuccess({})}base.dictionary.addDictionary(data),onSuccess(data)},function(){paella.messageBox.showError(base.dictionary.translate("Error! Config file not found. Please configure paella!"))})},loadEditorConfig:function(onSuccess){var data={cssPath:"resources/ui/jquery-ui.css"};onSuccess(data)}});var paellaPlayer=null;paella.plugins={},paella.plugins.events={},paella.initDelegate=null,Class("paella.PaellaPlayer",paella.PlayerBase,{player:null,selectedProfile:"",videoIdentifier:"",editor:null,loader:null,videoData:null,getPlayerMode:function(){return paella.player.isFullScreen()?paella.PaellaPlayer.mode.fullscreen:window.self!==window.top?paella.PaellaPlayer.mode.embed:paella.PaellaPlayer.mode.standard},checkFullScreenCapability:function(){var fs=document.getElementById(paella.player.mainContainer.id);return fs.webkitRequestFullScreen||fs.mozRequestFullScreen||fs.msRequestFullscreen||fs.requestFullScreen?!0:base.userAgent.browser.IsMobileVersion&&paella.player.videoContainer.isMonostream?!0:!1},addFullScreenListeners:function(){var thisClass=this,onFullScreenChangeEvent=function(){paella.pluginManager.checkPluginsVisibility();var fs=document.getElementById(paella.player.mainContainer.id);paella.player.isFullScreen()?(fs.style.width="100%",fs.style.height="100%"):(fs.style.width="",fs.style.height=""),paella.events.trigger(thisClass.isFullScreen()?paella.events.enterFullscreen:paella.events.exitFullscreen)};this.eventFullScreenListenerAdded||(this.eventFullScreenListenerAdded=!0,document.addEventListener("fullscreenchange",onFullScreenChangeEvent,!1),document.addEventListener("webkitfullscreenchange",onFullScreenChangeEvent,!1),document.addEventListener("mozfullscreenchange",onFullScreenChangeEvent,!1),document.addEventListener("MSFullscreenChange",onFullScreenChangeEvent,!1))},isFullScreen:function(){var webKitIsFullScreen=document.webkitIsFullScreen===!0,msIsFullScreen=void 0!==document.msFullscreenElement&&null!==document.msFullscreenElement,mozIsFullScreen=document.mozFullScreen===!0,stdIsFullScreen=void 0!==document.fullScreenElement&&null!==document.fullScreenElement;return webKitIsFullScreen||msIsFullScreen||mozIsFullScreen||stdIsFullScreen},goFullScreen:function(){if(this.addFullScreenListeners(),!this.isFullScreen())if(base.userAgent.browser.IsMobileVersion&&paella.player.videoContainer.isMonostream){var video=paella.player.videoContainer.masterVideo().domElement;video.webkitSupportsFullscreen&&video.webkitEnterFullscreen()}else{var fs=document.getElementById(paella.player.mainContainer.id);fs.webkitRequestFullScreen?fs.webkitRequestFullScreen():fs.mozRequestFullScreen?fs.mozRequestFullScreen():fs.msRequestFullscreen?fs.msRequestFullscreen():fs.requestFullScreen&&fs.requestFullScreen()}},exitFullScreen:function(){this.addFullScreenListeners(),this.isFullScreen()&&(document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen()?document.msExitFullscreen():document.cancelFullScreen&&document.cancelFullScreen())},setProfile:function(profileName,animate){var thisClass=this;this.videoContainer.setProfile(profileName,function(newProfileName){thisClass.selectedProfile=newProfileName},animate)},initialize:function(playerId){if(this.parent(playerId),this.playerId==playerId){this.loadPaellaPlayer();var thisClass=this;paella.events.bind(paella.events.setProfile,function(event,params){thisClass.setProfile(params.profileName)})}},loadPaellaPlayer:function(){var thisClass=this;this.loader=new paella.LoaderContainer("paellaPlayer_loader"),$("body")[0].appendChild(this.loader.domElement),paella.events.trigger(paella.events.loadStarted),paella.initDelegate.loadDictionary(function(){paella.initDelegate.loadConfig(function(config){var skin=config.skin&&config.skin["default"]?config.skin["default"]:"dark";paella.utils.skin.restore(skin),thisClass.onLoadConfig(config)})})},onLoadConfig:function(configData){if(paella.data=new paella.Data(configData),this.config=configData,this.videoIdentifier=paella.initDelegate.getId(),this.videoIdentifier){if(this.mainContainer){this.videoContainer=new paella.VideoContainer(this.playerId+"_videoContainer");var videoQualityStrategy=new paella.BestFitVideoQualityStrategy;try{var StrategyClass=this.config.player.videoQualityStrategy,ClassObject=Class.fromString(StrategyClass);videoQualityStrategy=new ClassObject}catch(e){base.log.warning("Error selecting video quality strategy: strategy not found")}this.videoContainer.setVideoQualityStrategy(videoQualityStrategy),this.mainContainer.appendChild(this.videoContainer.domElement)}$(window).resize(function(){paella.player.onresize()}),this.onload()}paella.pluginManager.loadPlugins("paella.FastLoadPlugin")},onload:function(){var thisClass=this;this.accessControl.checkAccess(function(permissions){var errorMessage;permissions.loadError?permissions.isAnonymous?(errorMessage=base.dictionary.translate("You are not logged in"),thisClass.unloadAll(errorMessage),paella.events.trigger(paella.events.error,{error:errorMessage})):(errorMessage=base.dictionary.translate("You are not authorized to view this resource"),thisClass.unloadAll(errorMessage),paella.events.trigger(paella.events.error,{error:errorMessage})):(base.log.debug("read:"+permissions.canRead+", contribute:"+permissions.canContribute+", write:"+permissions.canWrite),permissions.canWrite&&(paella.events.bind(paella.events.showEditor,function(){thisClass.showEditor()}),paella.events.bind(paella.events.hideEditor,function(){thisClass.hideEditor()})),permissions.canRead?(thisClass.loadVideo(),thisClass.videoContainer.publishVideo()):thisClass.unloadAll(base.dictionary.translate("You are not authorized to view this resource")))})},initVideoEvents:function(){var thisClass=this;paella.events.bind(paella.events.play,function(){thisClass.play()}),paella.events.bind(paella.events.pause,function(){thisClass.pause()}),paella.events.bind(paella.events.seekTo,function(event,params){paella.player.videoContainer.seekTo(params.newPositionPercent)}),paella.events.bind(paella.events.seekToTime,function(event,params){paella.player.videoContainer.seekToTime(params.time)}),paella.events.bind(paella.events.setPlaybackRate,function(event,params){paella.player.videoContainer.setPlaybackRate(params)}),paella.events.bind(paella.events.setVolume,function(event,params){paella.player.videoContainer.setVolume(params)}),paella.events.bind(paella.events.setTrim,function(event,params){params.trimEnabled?paella.player.videoContainer.enableTrimming():paella.player.videoContainer.disableTrimming(),paella.player.videoContainer.setTrimming(params.trimStart,params.trimEnd)})},onresize:function(){this.videoContainer.onresize(),this.controls&&this.controls.onresize(),this.editor&&this.editor.resize();var cookieProfile=paella.utils.cookies.get("lastProfile");cookieProfile?this.setProfile(cookieProfile,!1):this.setProfile(this.config.defaultProfile,!1),paella.events.trigger(paella.events.resize,{width:$(this.videoContainer.domElement).width(),height:$(this.videoContainer.domElement).height()})},unloadAll:function(message){$("#playerContainer")[0].innerHTML="";$("#paellaPlayer_loader")[0];paella.messageBox.showError(message)},showEditor:function(){new paella.editor.Editor},hideEditor:function(){},reloadVideos:function(masterQuality,slaveQuality){this.videoContainer&&(this.videoContainer.reloadVideos(masterQuality,slaveQuality),this.onresize())},loadVideo:function(){if(this.videoIdentifier){this.initVideoEvents();var This=this,loader=paella.initDelegate.initParams.videoLoader;this.onresize(),loader.loadVideo(this.videoIdentifier,function(){var playOnLoad=!1;"true"==base.parameters.get("autoplay")&&paella.player.config.experimental&&paella.player.config.experimental.autoplay&&!base.userAgent.browser.IsMobileVersion&&(paella.player.videoContainer.setAutoplay(),playOnLoad=!0),paella.player.videoContainer.setMasterQuality(base.parameters.list.resmaster),paella.player.videoContainer.setSlaveQuality(base.parameters.list.resslave);var master=loader.streams[0],slave=loader.streams[1],playerConfig=paella.player.config.player;playerConfig&&playerConfig.audio&&void 0!==playerConfig.audio.master&&paella.player.videoContainer.setDefaultMasterVolume(playerConfig.audio.master),playerConfig&&playerConfig.audio&&void 0!==playerConfig.audio.slave&&paella.player.videoContainer.setDefaultSlaveVolume(playerConfig.audio.slave),slave&&slave.data&&0==Object.keys(slave.data.sources).length&&(slave=null);var errorMessage,frames=loader.frameList;if(loader.loadStatus){var preferredMethodMaster=loader.getPreferredMethod(0),preferredMethodSlave=loader.getPreferredMethod(1);if(!preferredMethodMaster)return message="This video is not compatible with any codec installed in your system",paella.messageBox.showError(base.dictionary.translate(message)),!1;var h264WarningMessage=!0;if((master.sources.ogv||master.sources.webm)&&(slave.sources.ogv||slave.sources.webm)&&(h264WarningMessage=!1),h264WarningMessage){var minFirefoxVersion=base.userAgent.system.MacOS?35:base.userAgent.system.Windows?25:26;if(base.userAgent.browser.Firefox&&base.userAgent.browser.Version.major<minFirefoxVersion)return message="You are using Firefox version, and some required video playback capabilities are not available until Firefox min_version. Please, update your browser and try again.",message=base.dictionary.translate(message),message=message.replace("version",base.userAgent.browser.Version.major),message=message.replace("min_version",minFirefoxVersion),paella.messageBox.showError(message),!1}paella.player.videoContainer.setSources({data:master,type:preferredMethodMaster},{data:slave,type:preferredMethodSlave}),setTimeout(function(){paella.events.trigger(paella.events.loadComplete,{masterVideo:master,slaveVideo:slave,frames:frames})},10),paella.player.isLiveStream()?This.showPlaybackBar():playOnLoad&&This.play(),This.onresize()}else errorMessage=base.dictionary.translate("Error loading video data"),paella.messageBox.showError(errorMessage),paella.events.trigger(paella.events.error,{error:errorMessage})})}},showPlaybackBar:function(){this.controls||(this.controls=new paella.ControlsContainer(this.playerId+"_controls"),this.mainContainer.appendChild(this.controls.domElement),this.controls.onresize(),paella.events.trigger(paella.events.loadPlugins,{pluginManager:paella.pluginManager}))},isLiveStream:function(){if(void 0===this._isLiveStream){var loader=paella.initDelegate.initParams.videoLoader,checkSource=function(sources,index){if(sources.length>index){var source=sources[index];for(var key in source.sources)if("object"==typeof source.sources[key])for(var i=0;i<source.sources[key].length;++i){var stream=source.sources[key][i];if(stream.isLiveStream)return!0}}return!1};this._isLiveStream=checkSource(loader.streams,0)||checkSource(loader.streams,1)}return this._isLiveStream},loadPreviews:function(){var streams=paella.initDelegate.initParams.videoLoader.streams,slavePreviewImg=null,masterPreviewImg=streams[0].preview;if(streams.length>=2&&(slavePreviewImg=streams[1].preview),masterPreviewImg){var masterRect=paella.player.videoContainer.overlayContainer.getMasterRect();this.masterPreviewElem=document.createElement("img"),this.masterPreviewElem.src=masterPreviewImg,paella.player.videoContainer.overlayContainer.addElement(this.masterPreviewElem,masterRect)}if(slavePreviewImg){var slaveRect=paella.player.videoContainer.overlayContainer.getSlaveRect();this.slavePreviewElem=document.createElement("img"),this.slavePreviewElem.src=slavePreviewImg,paella.player.videoContainer.overlayContainer.addElement(this.slavePreviewElem,slaveRect)}paella.events.bind(paella.events.timeUpdate,function(){paella.player.unloadPreviews()})},unloadPreviews:function(){this.masterPreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.masterPreviewElem),this.masterPreviewElem=null),this.slavePreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.slavePreviewElem),this.slavePreviewElem=null)},loadComplete:function(){var getProfile=(paella.player.videoContainer.masterVideo(),base.parameters.get("profile")),cookieProfile=base.cookies.get("lastProfile");getProfile?this.setProfile(getProfile,!1):cookieProfile?this.setProfile(cookieProfile,!1):this.setProfile(this.config.defaultProfile,!1),paella.pluginManager.loadPlugins("paella.EarlyLoadPlugin")},play:function(){if(!this.controls){this.showPlaybackBar();var urlParamTime=base.parameters.get("time"),hashParamTime=base.hashParams.get("time"),timeString=hashParamTime?hashParamTime:urlParamTime?urlParamTime:"0s",startTime=paella.utils.timeParse.timeToSeconds(timeString);startTime&&paella.player.videoContainer.setStartTime(startTime),paella.events.trigger(paella.events.controlBarLoaded),paella.events.trigger(paella.events.play),this.controls.onresize()}this.videoContainer.play()},pause:function(){this.videoContainer.pause()},playing:function(){return this.paused()},paused:function(){return this.videoContainer.paused()}});var PaellaPlayer=paella.PaellaPlayer;paella.PaellaPlayer.mode={standard:"standard",fullscreen:"fullscreen",embed:"embed"},Class("paella.DefaultVideoLoader",paella.VideoLoader,{_url:null,initialize:function(data){if("object"==typeof data)this._data=data;else try{this._data=JSON.parse(data)}catch(e){this._url=data}},loadVideo:function(videoId,onSuccess){if(this._data)this.loadVideoData(this._data,onSuccess);else if(this._url){var This=this;this._url=(/\/$/.test(this._url)?this._url:this._url+"/")+videoId+"/",paella.ajax.get({url:this._url+"data.json"},function(data){if("string"==typeof data)try{data=JSON.parse(data)}catch(e){}This._data=data,This.loadVideoData(This._data,onSuccess)},function(){})}},loadVideoData:function(data,onSuccess){var This=this;data.streams&&data.streams.forEach(function(stream){This.loadStream(stream)}),data.frameList&&this.loadFrameData(data),data.captions&&this.loadCaptions(data.captions),data.blackboard&&this.loadBlackboard(data.streams[0],data.blackboard),this.streams=data.streams,this.frameList=data.frameList,this.loadStatus=this.streams.length>0,onSuccess()},loadFrameData:function(data){var This=this;if(data.frameList&&data.frameList.forEach){var newFrames={};data.frameList.forEach(function(frame){/^[a-zA-Z]+:\/\//.test(frame.url)||(frame.url=This._url+frame.url),frame.thumb&&!/^[a-zA-Z]+:\/\//.test(frame.thumb)&&(frame.thumb=This._url+frame.thumb);var id=frame.time;newFrames[id]=frame}),data.frameList=newFrames}},loadStream:function(stream){var This=this;stream.preview&&!/^[a-zA-Z]+:\/\//.test(stream.preview)&&(stream.preview=This._url+stream.preview),stream.sources.image&&stream.sources.image.forEach(function(image){if(image.frames.forEach){var newFrames={};image.frames.forEach(function(frame){frame.src&&!/^[a-zA-Z]+:\/\//.test(frame.src)&&(frame.src=This._url+frame.src),frame.thumb&&!/^[a-zA-Z]+:\/\//.test(frame.thumb)&&(frame.thumb=This._url+frame.thumb);var id="frame_"+frame.time;newFrames[id]=frame.src}),image.frames=newFrames}});for(var type in stream.sources)if(stream.sources[type]){if("image"!=type){var source=stream.sources[type];source.forEach(function(sourceItem){var pattern=/^[a-zA-Z\:]+\:\/\//gi;"string"==typeof sourceItem.src&&null==sourceItem.src.match(pattern)&&(sourceItem.src=This._url+sourceItem.src),sourceItem.type=sourceItem.mimetype})}}else delete stream.sources[type]},loadCaptions:function(captions){if(captions)for(var i=0;i<captions.length;++i){var url=captions[i].url;/^[a-zA-Z]+:\/\//.test(url)||(url=this._url+url);var c=new paella.captions.Caption(i,captions[i].format,url,{code:captions[i].lang,txt:captions[i].text});paella.captions.addCaptions(c)}},loadBlackboard:function(stream,blackboard){var This=this;stream.sources.image||(stream.sources.image=[]);var imageObject={count:blackboard.frames.length,duration:blackboard.duration,mimetype:blackboard.mimetype,res:blackboard.res,frames:{}};blackboard.frames.forEach(function(frame){var id="frame_"+Math.round(frame.time);/^[a-zA-Z]+:\/\//.test(frame.src)||(frame.src=This._url+frame.src),imageObject.frames[id]=frame.src}),stream.sources.image.push(imageObject)}}),Class("paella.DefaultInitDelegate",paella.InitDelegate,{initialize:function(){1==arguments.length?this.parent(arguments[0]):2==arguments.length&&(this._config=arguments[0],this.parent(arguments[1]))},loadConfig:function(onSuccess){this._config?onSuccess(this._config):this.parent(onSuccess)}}),paella.load=function(playerContainer,params){var initObjects={accessControl:new paella.DefaultAccessControl,videoLoader:new paella.DefaultVideoLoader(params.data||params.url)};paella.initDelegate=params.config?new paella.DefaultInitDelegate(params.config,initObjects):new paella.DefaultInitDelegate(initObjects),new PaellaPlayer(playerContainer,paella.initDelegate)},Class("paella.RightBarPlugin",paella.DeferredLoadPlugin,{type:"rightBarPlugin",getName:function(){return"es.upv.paella.RightBarPlugin"},buildContent:function(){}}),Class("paella.TabBarPlugin",paella.DeferredLoadPlugin,{type:"tabBarPlugin",getName:function(){return"es.upv.paella.TabBarPlugin"},getTabName:function(){return"New Tab"},action:function(){},buildContent:function(){},setToolTip:function(message){this.button.setAttribute("title",message),this.button.setAttribute("aria-label",message)},getDefaultToolTip:function(){return""}}),Class("paella.ExtendedAdapter",{rightContainer:null,bottomContainer:null,rightBarPlugins:[],tabBarPlugins:[],currentTabIndex:0,bottomContainerTabs:null,bottomContainerContent:null,initialize:function(){this.rightContainer=document.createElement("div"),this.rightContainer.className="rightPluginContainer",this.bottomContainer=document.createElement("div"),this.bottomContainer.className="tabsPluginContainer";var tabs=document.createElement("div");tabs.className="tabsLabelContainer",this.bottomContainerTabs=tabs,this.bottomContainer.appendChild(tabs);var bottomContent=document.createElement("div");bottomContent.className="tabsContentContainer",this.bottomContainerContent=bottomContent,this.bottomContainer.appendChild(bottomContent),this.initPlugins()},initPlugins:function(){paella.pluginManager.setTarget("rightBarPlugin",this),paella.pluginManager.setTarget("tabBarPlugin",this)},addPlugin:function(plugin){var thisClass=this;plugin.checkEnabled(function(isEnabled){isEnabled&&(paella.pluginManager.setupPlugin(plugin),"rightBarPlugin"==plugin.type&&(thisClass.rightBarPlugins.push(plugin),thisClass.addRightBarPlugin(plugin)),"tabBarPlugin"==plugin.type&&(thisClass.tabBarPlugins.push(plugin),thisClass.addTabPlugin(plugin)))})},showTab:function(tabIndex){var i=0,labels=this.bottomContainer.getElementsByClassName("tabLabel"),contents=this.bottomContainer.getElementsByClassName("tabContent");for(i=0;i<labels.length;++i)labels[i].className=labels[i].getAttribute("tab")==tabIndex?"tabLabel enabled":"tabLabel disabled";for(i=0;i<contents.length;++i)contents[i].className=contents[i].getAttribute("tab")==tabIndex?"tabContent enabled":"tabContent disabled"},addTabPlugin:function(plugin){var thisClass=this,tabIndex=this.currentTabIndex,tabItem=document.createElement("div");tabItem.setAttribute("tab",tabIndex),tabItem.className="tabLabel disabled",tabItem.innerHTML=plugin.getTabName(),tabItem.plugin=plugin,$(tabItem).click(function(){/disabled/.test(this.className)&&(thisClass.showTab(tabIndex),this.plugin.action(this))}),$(tabItem).keyup(function(event){13==event.keyCode&&/disabledTabItem/.test(this.className)&&(thisClass.showTab(tabIndex),this.plugin.action(this))}),this.bottomContainerTabs.appendChild(tabItem);var tabContent=document.createElement("div");tabContent.setAttribute("tab",tabIndex),tabContent.className="tabContent disabled "+plugin.getSubclass(),this.bottomContainerContent.appendChild(tabContent),plugin.buildContent(tabContent),plugin.button=tabItem,plugin.container=tabContent,plugin.button.setAttribute("tabindex",3e3+plugin.getIndex()),plugin.button.setAttribute("alt",""),plugin.setToolTip(plugin.getDefaultToolTip()),void 0===this.firstTabShown&&(this.showTab(tabIndex),this.firstTabShown=!0),++this.currentTabIndex},addRightBarPlugin:function(plugin){var container=document.createElement("div");
container.className="rightBarPluginContainer "+plugin.getSubclass(),this.rightContainer.appendChild(container),plugin.buildContent(container)}}),paella.extendedAdapter=new paella.ExtendedAdapter,paella.editor={},paella.editor.utils={mouse:{mouseDownTarget:""}};var bootstrapUtils={elem:function(type,params,inner){var elem=document.createElement(type);for(var attr in params)elem.setAttribute(attr,params[attr]);return inner&&(elem.innerHTML=inner),elem},append:function(parent,child){return parent.appendChild(child),child},navbar:function(title,subclass){var nav=this.elem("div",{"class":"navbar tiny "+subclass}),navInner=this.append(nav,this.elem("div",{"class":"navbar-inner tiny"}));return title&&this.append(navInner,this.elem("div",{"class":"brand",href:"javascript:void(0);"},title)),nav},dropdown:function(title,subclass,items,size,icon,alignRight){return this.dropButton(title,subclass,items,size,icon,alignRight,"")},dropup:function(title,subclass,items,size,icon,alignRight){return this.dropButton(title,subclass,items,size,icon,alignRight,"dropup")},dropButton:function(title,subclass,items,size,icon,alignRight,type){var align="";alignRight&&(align="pull-right");var dropup=this.elem("div",{"class":"btn-group "+type+" "+subclass+" "+align});title=icon?'<i class="'+icon+'"></i>&nbsp;<span class="text">'+title+"</span>&nbsp;":'&nbsp;<span class="text">'+title+"</span>&nbsp;";var ul=(this.append(dropup,this.elem("a",{"class":"btn dropdown-toggle "+size,"data-toggle":"dropdown",href:"JavaScript:void(0);"},title+'<span class="caret"></span>')),this.append(dropup,this.elem("ul",{"class":"dropdown-menu"})));for(var key in items){var action=items[key],li=this.append(ul,this.elem("li"));this.append(li,this.elem("a",{href:"JavaScript:void(0);",onclick:action,"class":"listItem"},key))}return dropup},buttonGroup:function(buttons,btnSubclass,isPushButton){var group=document.createElement("div");group.className="btn-group";for(var i=0;i<buttons.length;++i){var button=document.createElement("button");button.className="btn "+btnSubclass,button.innerHTML=buttons[i].label,button.buttonData=buttons[i],button.buttonData.disabledClass=button.className,button.title=buttons[i].hint,$(button).click(isPushButton?function(){this.buttonData.onclick(this.buttonData)}:function(){for(var j=0;j<this.parentNode.childNodes.length;++j)this.parentNode.childNodes[j].className=this.buttonData.disabledClass;this.className=this.className+" active",this.buttonData.onclick(this.buttonData)}),group.appendChild(button)}return group},button:function(label,className,hint,onclick){var button=document.createElement("button");return button.className="btn "+className,button.innerHTML=label,button.title=hint,$(button).click(function(){onclick(this)}),button}};Class("paella.editor.PluginSaveCallback",base.AsyncLoaderCallback,{plugin:null,initialize:function(plugin){this.parent("pluginSaveCallback"),this.plugin=plugin},load:function(onSuccess){this.plugin.onSave(function(){onSuccess()})}}),Class("paella.editor.PluginDiscardCallback",base.AsyncLoaderCallback,{plugin:null,initialize:function(plugin){this.parent("pluginDiscardCallback"),this.plugin=plugin},load:function(onSuccess){this.plugin.onDiscard(function(){onSuccess()})}}),Class("paella.editor.PluginManager",{trackPlugins:[],rightBarPlugins:[],toolbarPlugins:[],initialize:function(){this.initPlugins()},initPlugins:function(){paella.pluginManager.setTarget("editorTrackPlugin",this),paella.pluginManager.setTarget("editorRightBarPlugin",this),paella.pluginManager.setTarget("editorToolbarPlugin",this)},addPlugin:function(plugin){var thisClass=this;plugin.checkEnabled(function(isEnabled){isEnabled&&(paella.pluginManager.setupPlugin(plugin),"editorTrackPlugin"==plugin.type&&thisClass.trackPlugins.push(plugin),"editorRightBarPlugin"==plugin.type&&thisClass.rightBarPlugins.push(plugin),"editorToolbarPlugin"==plugin.type&&thisClass.toolbarPlugins.push(plugin))})},onTrackChanged:function(newTrack){var i,plugin;for(i=0;i<this.rightBarPlugins.length;++i)plugin=this.rightBarPlugins[i],plugin.onTrackSelected(newTrack);for(i=0;i<this.toolbarPlugins.length;++i)plugin=this.toolbarPlugins[i],plugin.onTrackSelected(newTrack)},onSave:function(onDone){var i,asyncLoader=new paella.AsyncLoader;for(i=0;i<this.trackPlugins.length;++i)asyncLoader.addCallback(new paella.editor.PluginSaveCallback(this.trackPlugins[i]));for(i=0;i<this.rightBarPlugins.length;++i)asyncLoader.addCallback(new paella.editor.PluginSaveCallback(this.rightBarPlugins[i]));for(i=0;i<this.toolbarPlugins.length;++i)asyncLoader.addCallback(new paella.editor.PluginSaveCallback(this.toolbarPlugins[i]));asyncLoader.load(function(){paella.events.trigger(paella.events.didSaveChanges),onDone(!0)},function(){onDone(!1)})},onDiscard:function(onDone){var i,asyncLoader=new paella.AsyncLoader;for(i=0;i<this.trackPlugins.length;++i)asyncLoader.addCallback(new paella.editor.PluginDiscardCallback(this.trackPlugins[i]));for(i=0;i<this.rightBarPlugins.length;++i)asyncLoader.addCallback(new paella.editor.PluginDiscardCallback(this.rightBarPlugins[i]));for(i=0;i<this.toolbarPlugins.length;++i)asyncLoader.addCallback(new paella.editor.PluginDiscardCallback(this.toolbarPlugins[i]));asyncLoader.load(function(){onDone(!0)},function(){onDone(!1)})}}),paella.editor.pluginManager=new paella.editor.PluginManager,Class("paella.editor.EditorPlugin",paella.DeferredLoadPlugin,{onTrackSelected:function(newTrack){base.log.debug(newTrack?this.getName()+": New track selected "+newTrack.getName():"No track selected")},onSave:function(onDone){onDone()},onDiscard:function(onDone){onDone()},contextHelpString:function(){return""}}),Class("paella.editor.TrackPlugin",paella.editor.EditorPlugin,{type:"editorTrackPlugin",getIndex:function(){return 1e4},getName:function(){return"editorTrackPlugin"},getTrackName:function(){return"My Track"},getColor:function(){return"#5500FF"},getTextColor:function(){return"#F0F0F0"},getTrackType:function(){return"secondary"},getTrackItems:function(){var exampleTracks=[{id:1,s:10,e:70},{id:2,s:110,e:340}];return exampleTracks},allowResize:function(){return!0},allowDrag:function(){return!0},allowEditContent:function(){return!0},onTrackChanged:function(){paella.events.trigger(paella.events.documentChanged)},onTrackContentChanged:function(){paella.events.trigger(paella.events.documentChanged)},onSelect:function(){base.log.debug("Track list selected: "+this.getTrackName())},onUnselect:function(){base.log.debug("Track list unselected: "+this.getTrackName())},onDblClick:function(){},getTools:function(){return[]},onToolSelected:function(){paella.events.trigger(paella.events.documentChanged)},isToolEnabled:function(){return!0},buildToolTabContent:function(){},getSettings:function(){return null}}),Class("paella.editor.MainTrackPlugin",paella.editor.TrackPlugin,{getTrackType:function(){return"master"},getTrackItems:function(){var exampleTracks=[{id:1,s:30,e:470}];return exampleTracks},getName:function(){return"editorMainTrackPlugin"}}),Class("paella.editor.RightBarPlugin",paella.editor.EditorPlugin,{type:"editorRightBarPlugin",getIndex:function(){return 1e4},getName:function(){return"editorRightbarPlugin"},getTabName:function(){return"My Rightbar Plugin"},getContent:function(){var container=document.createElement("div");return container.innerHTML="Rightbar plugin",container},onLoadFinished:function(){}}),Class("paella.editor.EditorToolbarPlugin",paella.editor.EditorPlugin,{type:"editorToolbarPlugin",trackList:[],getIndex:function(){return 1e4},getName:function(){return"editorToolbarPlugin"},getButtonName:function(){return"Toolbar Plugin"},getIcon:function(){return"icon-edit"},getOptions:function(){return[]},onOptionSelected:function(){}}),Class("paella.editor.Tabbar",{navbar:null,container:null,initialize:function(parent){this.navbar=bootstrapUtils.navbar("","navbar-inverse"),parent.appendChild(this.navbar),this.container=$(this.navbar).find(".navbar-inner")[0]}}),Class("paella.editor.Toolbar",{navbar:null,container:null,toolButton:null,selectedToolUtils:null,editorMenu:null,toolbarPlugins:null,initialize:function(parent){this.navbar=bootstrapUtils.navbar("","navbar-inverse"),parent.appendChild(this.navbar),this.container=$(this.navbar).find(".navbar-inner")[0],this.buildTrackTools(),this.buildPlaybackControls(),this.buildEditorMenu(),this.buildPlugins()},buildTrackTools:function(){var selectionTrackName=base.dictionary.translate("Selection"),tools={};tools[selectionTrackName]="paella.editor.instance.bottomBar.toolbar.onToolChanged('select','"+selectionTrackName+"')";var trackPlugins=paella.editor.pluginManager.trackPlugins;trackPlugins.forEach(function(plugin){var label=plugin.getTrackName(),action="paella.editor.instance.bottomBar.toolbar.onToolChanged('"+plugin.getName()+"','"+plugin.getTrackName()+"')";tools[label]=action});var defaultText=base.dictionary.translate("Tool")+": "+base.dictionary.translate("Selection");this.toolButton=bootstrapUtils.dropdown(defaultText,"toolDropdown",tools,"btn-mini","",!1),this.container.appendChild(this.toolButton),this.selectedToolUtils=document.createElement("span"),this.selectedToolUtils.className="editorToolbar_selectedToolUtils",this.container.appendChild(this.selectedToolUtils)},buildPlaybackControls:function(){var playbackControls=document.createElement("span");playbackControls.className="editorToolbarPlaybackControls",this.container.appendChild(playbackControls);var buttonData=[];buttonData.push({label:'<i class="icon-step-backward icon-white"></i>',hint:"",onclick:function(){$(document).trigger(paella.events.seekTo,{newPositionPercent:0})}}),buttonData.push({label:'<i class="icon-play icon-white"></i>',hint:"",onclick:function(){$(document).trigger(paella.events.play)}}),buttonData.push({label:'<i class="icon-pause icon-white"></i>',hint:"",onclick:function(){$(document).trigger(paella.events.pause)}}),buttonData.push({label:'<i class="icon-step-forward icon-white"></i>',hint:"",onclick:function(){$(document).trigger(paella.events.seekTo,{newPositionPercent:99})}}),playbackControls.appendChild(bootstrapUtils.buttonGroup(buttonData,"btn-mini",!0))},buildPlugins:function(){var This=this;this.toolbarPlugins?this.toolbarPlugins.innerHTML="":(this.toolbarPlugins=document.createElement("span"),this.container.appendChild(this.toolbarPlugins));var plugins=paella.editor.pluginManager.toolbarPlugins;plugins.forEach(function(plugin){var pluginName=(plugins.indexOf(plugin),plugin.getName()),name=plugin.getButtonName(),options=plugin.getOptions(),optionsObject={},icon=plugin.getIcon();icon&&(icon+=" icon-white");for(var j=0;j<options.length;++j)optionsObject[options[j]]="paella.editor.instance.bottomBar.toolbar.selectPluginOption('"+pluginName+"',"+j+")";var button=bootstrapUtils.dropdown(name,"editorDropdown",optionsObject,"btn-mini",icon,!0);This.toolbarPlugins.appendChild(button)})},buildEditorMenu:function(){var tools={};tools[base.dictionary.translate("Save and close editor")]="paella.editor.instance.bottomBar.toolbar.saveAndClose();",tools[base.dictionary.translate("Save changes")]="paella.editor.instance.bottomBar.toolbar.save();",tools[base.dictionary.translate("Discard changes and close")]="paella.editor.instance.bottomBar.toolbar.discardAndClose();",this.editorMenu=bootstrapUtils.dropdown(base.dictionary.translate("Paella Editor"),"editorDropdown",tools,"btn-mini","icon-edit icon-white",!0),this.container.appendChild(this.editorMenu)},selectPluginOption:function(pluginName,optionIndex){var plugins=paella.editor.pluginManager.toolbarPlugins;plugins.forEach(function(plugin){plugin.getName()==pluginName&&plugin.onOptionSelected(optionIndex)}),this.buildPlugins()},onToolChanged:function(toolName,trackName){paella.editor.instance.bottomBar.timeline.selectTrackList(toolName);var textElem=$(this.toolButton).find(".text")[0];textElem.innerHTML=base.dictionary.translate("Tool")+": "+trackName,this.setupTrackTool(toolName)},setupTrackTool:function(toolName){this.selectedToolUtils.innerHTML="";var i,plugin=null;for(i=0;i<paella.editor.pluginManager.trackPlugins.length&&(plugin=paella.editor.pluginManager.trackPlugins[i],toolName!=plugin.getName());++i)plugin=null;if(plugin){var buttonData=[],tools=plugin.getTools();for(i=0;i<tools.length;++i)buttonData.push({label:tools[i].label,plugin:plugin,toolName:tools[i].name,hint:tools[i].hint,onclick:function(buttonData){buttonData.plugin.onToolSelected(buttonData.toolName)&&(paella.editor.instance.bottomBar.timeline.rebuildTrack(plugin.getName()),paella.editor.pluginManager.onTrackChanged(plugin),paella.editor.instance.rightBar.updateCurrentTab())}});if(buttonData.length>0){var toolLabel=document.createElement("span");toolLabel.innerHTML="&nbsp;"+base.dictionary.translate("Options")+":",this.selectedToolUtils.appendChild(toolLabel),this.selectedToolUtils.appendChild(bootstrapUtils.buttonGroup(buttonData,"btn-mini"))}}},saveAndClose:function(){paella.editor.pluginManager.onSave(function(){paella.editor.instance.unloadEditor()})},save:function(){paella.editor.pluginManager.onSave(function(){})},discardAndClose:function(){paella.editor.pluginManager.onDiscard(function(){base.log.debug("Discard changes"),paella.editor.instance.unloadEditor()})}}),Class("paella.editor.Timeline",{container:null,containerMinHeight:133,content:null,timeMarks:null,tracks:null,zoom:100,trackItemList:null,trackItemIndex:{back:5,front:10},trackItemOpacity:{back:.5,front:.9},currentTrackList:null,initialize:function(parent){var defaultHeight=this.containerMinHeight;this.trackItemList=[],this.container=document.createElement("div"),this.container.className="editorTimelineContainer",$(this.container).css({height:defaultHeight+"px"}),parent.appendChild(this.container),this.content=document.createElement("div"),this.content.className="editorTimelineContent",$(this.content).css({width:this.zoom+"%",height:"100%"}),this.container.appendChild(this.content),this.timeMarks=document.createElement("div"),this.timeMarks.className="editorTimeLineTimeMarks",this.content.appendChild(this.timeMarks),this.buildTimeMarks(),this.tracks=document.createElement("div"),this.tracks.className="editorTimeLineTracks",this.tracks.style.minHeight=this.containerMinHeight+"px",this.content.appendChild(this.tracks),this.loadPlugins(),this.setupCursors()},setupCursors:function(){var cursor=document.createElement("div");cursor.className="editorTimelineCursor",this.container.appendChild(cursor);var content=this.content;$(this.container).mousemove(function(event){var duration=paella.player.videoContainer.duration(!0),contentWidth=$(content).width(),position=$(content).position().left,left=event.pageX-position;$(cursor).css({left:left+"px"});var time=left*duration/contentWidth;cursor.innerHTML=paella.utils.timeParse.secondsToTime(time)});var currentTimeCursor=document.createElement("div");currentTimeCursor.className="editorTimelineCursor currentTime",this.container.appendChild(currentTimeCursor),$(document).bind(paella.events.timeUpdate,function(event,params){var duration=paella.player.videoContainer.duration(!0),contentWidth=$(content).width(),currentTime=params.currentTime,left=currentTime*contentWidth/duration;$(currentTimeCursor).css({left:left+"px"}),currentTimeCursor.innerHTML=paella.utils.timeParse.secondsToTime(currentTime)}),$(document).bind(paella.events.seekToTime,function(event,params){var duration=paella.player.videoContainer.duration(!0),contentWidth=$(content).width(),currentTime=params.time,left=currentTime*contentWidth/duration;$(currentTimeCursor).css({left:left+"px"}),currentTimeCursor.innerHTML=paella.utils.timeParse.secondsToTime(currentTime)}),$(this.container).mouseup(function(event){if("track"!=paella.editor.utils.mouse.mouseDownTarget){var contentWidth=(paella.player.videoContainer.duration(!0),$(content).width()),position=$(content).position().left,left=event.pageX-position,time=100*left/contentWidth;$(document).trigger(paella.events.seekTo,{newPositionPercent:time})}})},loadPlugins:function(){var thisClass=this,container=this.tracks;container.innerHTML="";var plugins=paella.editor.pluginManager.trackPlugins,secTrackIndex=0,subclass="";plugins.forEach(function(plugin){"secondary"==plugin.getTrackType()?(subclass="track"+secTrackIndex,++secTrackIndex):subclass="";var track=new paella.editor.Track(container,plugin,subclass);thisClass.trackItemList.push(track)}),this.selectTrackList(this.currentTrackList)},rebuildTrack:function(pluginName){for(var i=(paella.editor.pluginManager.trackPlugins,0);i<this.trackItemList.length;++i){var track=this.trackItemList[i];track.getName()==pluginName&&track.rebuild()}},getHeight:function(){return $(this.container).height()<this.containerMinHeight?this.containerMinHeight:$(this.container).height()},buildTimeMarks:function(){this.zoom;this.timeMarks.innerHTML="";for(var barWidth=$(this.timeMarks).width(),duration=paella.player.videoContainer.duration(!0),markWidth=70,numberOfMarks=Math.ceil(barWidth/markWidth),timeIncrement=duration/numberOfMarks,remainder=barWidth%markWidth,odd=!0,currentTime=0,i=0;numberOfMarks>i;++i){var mark=document.createElement("div");mark.className="editorTimeLineMark",odd&&(mark.className=mark.className+" odd"),i==numberOfMarks-1&&(markWidth=remainder,mark.className+=" last"),mark.style.width=markWidth+"px",mark.innerHTML=paella.utils.timeParse.secondsToTime(currentTime),currentTime+=timeIncrement,this.timeMarks.appendChild(mark);var padding=0,finalWidth=markWidth-padding;mark.style.width=finalWidth+"px",odd=!odd}},setZoom:function(percent){var thisClass=this;this.zoom=percent,this.timeMarks.innerHTML="",$(this.content).animate({width:percent+"%"},{complete:function(){thisClass.buildTimeMarks()}})},onresize:function(){this.buildTimeMarks();var height=$(this.tracks).outerHeight();if(base.userAgent.system.Windows){var padding=$(this.tracks).outerHeight()-$(this.tracks).height();height=height+padding-3}$(this.container).css("height",height+"px")},selectTrackList:function(trackItem,noEvent,selectTrackItem){if("select"==trackItem)this.currentTrackList=null;else for(var i=0;i<this.trackItemList.length;++i){var trackItemObj=this.trackItemList[i],container=trackItemObj.container;trackItemObj.getName()==trackItem?(this.currentTrackList=trackItemObj,$(container).css({"z-index":this.trackItemIndex.front,opacity:this.trackItemOpacity.front})):$(container).css({"z-index":this.trackItemIndex.back,opacity:this.trackItemOpacity.back})}var plugin=null;this.currentTrackList&&(plugin=this.currentTrackList.plugin,selectTrackItem>0&&this.currentTrackList.selectTrack(selectTrackItem,noEvent)),noEvent||(paella.editor.pluginManager.onTrackChanged(plugin),paella.editor.instance.rightBar.updateCurrentTab())},focusTrackListItem:function(trackItemName,itemId){this.selectTrackList(trackItemName,!0,itemId);var trackElement=$("#"+paella.editor.TrackUtils.buildTrackItemId(trackItemName,itemId))[0];if(trackElement){var scrollLeft=paella.editor.instance.bottomBar.timeline.container.scrollLeft,itemOffset=$(trackElement).offset().left-10,newScroll=scrollLeft+itemOffset;$(paella.editor.instance.bottomBar.timeline.container).animate({scrollLeft:newScroll},{duration:100})}}}),Class("paella.editor.BottomToolbar",{container:null,content:null,initialize:function(parent){this.container=document.createElement("div"),this.container.className="editorBottomToolbarContainer",parent.appendChild(this.container),this.content=document.createElement("div"),this.container.appendChild(this.content),this.content.appendChild(bootstrapUtils.dropup("Zoom","zoomDropup",{"100%":"paella.editor.instance.bottomBar.timeline.setZoom(100)","200%":"paella.editor.instance.bottomBar.timeline.setZoom(200)","500%":"paella.editor.instance.bottomBar.timeline.setZoom(200)","1000%":"paella.editor.instance.bottomBar.timeline.setZoom(1000)","3000%":"paella.editor.instance.bottomBar.timeline.setZoom(3000)","5000%":"paella.editor.instance.bottomBar.timeline.setZoom(5000)"},"btn-mini","icon-search",!0))}}),Class("paella.editor.BottomBar",base.AsyncLoaderCallback,{editor:null,container:null,toolbar:null,timeline:null,bottomToolbar:null,initialize:function(){this.editor=paella.editor.instance},load:function(onSuccess){this.container=document.createElement("div"),this.container.className="paellaEditorBottomBar",this.editor.editorContainer.appendChild(this.container),this.build(),onSuccess()},build:function(){this.toolbar=new paella.editor.Toolbar(this.container),this.timeline=new paella.editor.Timeline(this.container),this.bottomToolbar=new paella.editor.BottomToolbar(this.container)},getHeight:function(){return $(this.container).height()},onresize:function(){this.timeline.onresize()}}),Class("paella.editor.RightBar",base.AsyncLoaderCallback,{editor:null,container:null,tabBar:null,selectedTab:0,tabContent:null,initialize:function(){this.editor=paella.editor.instance},load:function(onSuccess){this.container=document.createElement("div"),this.container.className="paellaEditorRightBar",this.container.style.width=this.getWidth()+"px",this.container.style.bottom=this.editor.bottomBar.getHeight()+"px",this.editor.editorContainer.appendChild(this.container),this.tabBar=new paella.editor.Tabbar(this.container),this.tabContent=document.createElement("div"),this.tabContent.className="paellaEditorRightBarContent",this.container.appendChild(this.tabContent),this.loadPlugins(),onSuccess()},loadPlugins:function(){var thisClass=this,container=this.tabBar.container;container.innerHTML="";var ul=document.createElement("ul");ul.className="nav";var plugins=paella.editor.pluginManager.rightBarPlugins;if(plugins.length>0){plugins.forEach(function(plugin){var i=plugins.indexOf(plugin);ul.appendChild(thisClass.getTab(plugin,i))}),container.appendChild(ul);var currentTab=plugins[this.selectedTab];this.tabContent.innerHTML="",this.tabContent.appendChild(currentTab.getContent()),currentTab.onLoadFinished()}},getTab:function(plugin,index){var thisClass=this,active="";index==this.selectedTab&&(active="active");var li=document.createElement("li");li.className=active;var a=document.createElement("a");return a.className="rightBarPlugin",a.setAttribute("href","JavaScript:void(0);"),a.innerHTML='<span class="editorRightBarTabIcon '+plugin.getName()+'"></span>'+plugin.getTabName(),a.tabIndex=index,$(a).click(function(){thisClass.loadTab(this.tabIndex)}),li.appendChild(a),li},updateCurrentTab:function(){this.tabBar&&this.loadPlugins()},getWidth:function(){return 300},loadTab:function(index){this.selectedTab=index,this.loadPlugins()},onresize:function(){this.container.style.bottom=this.editor.bottomBar.getHeight()+"px"}}),paella.editor.TrackUtils={buildTrackItemId:function(trackName,trackItemId){return"paellaEditorTrack_"+trackName+"_"+trackItemId}},Class("paella.editor.Track",{container:null,plugin:null,trackIndex:{back:10,front:20},trackOpacity:{back:.7,front:1},trackElemList:null,buildTrackItemId:function(trackName,trackItemId){return paella.editor.TrackUtils.buildTrackItemId(trackName,trackItemId)},initialize:function(parentContainer,plugin,subclass){this.trackElemList=[],this.plugin=plugin;var newTrackGroup=document.createElement("div");this.container=newTrackGroup,parentContainer.appendChild(newTrackGroup),this.buildTracks(newTrackGroup),type=plugin.getTrackType(),"master"==type?newTrackGroup.className="editorTrackListItem master "+subclass:"secondary"==type&&(newTrackGroup.className="editorTrackListItem secondary "+subclass)},getName:function(){return this.plugin.getName()},rebuild:function(){this.container.innerHTML="",this.buildTracks(this.container)},buildTracks:function(){for(var plugin=this.plugin,trackList=plugin.getTrackItems(),i=0;i<trackList.length;++i){var trackItem=this.getTrack(trackList[i]);this.trackElemList.push(trackItem),this.container.appendChild(trackItem)}},getTrack:function(trackData){var thisClass=this,plugin=this.plugin,duration=paella.player.videoContainer.duration(!0);trackData.d=trackData.e-trackData.s;var track=document.createElement("div");track.className="editorTrackItem "+plugin.getName(),track.id=this.buildTrackItemId(plugin.getName(),trackData.id);var start=100*trackData.s/duration,width=100*trackData.d/duration;$(track).css({left:start+"%",width:width+"%","background-color":plugin.getColor(),opacity:this.trackOpacity.back}),track.trackInfo={trackData:trackData,plugin:plugin};var label=document.createElement("div");if(label.innerHTML=trackData.name&&""!=trackData.name?trackData.name:plugin.getTrackName(),label.className="editorTrackItemLabel "+this.plugin.getTrackType(),label.style.color=plugin.getTextColor(),track.appendChild(label),trackData.lock){var lockIcon=document.createElement("i");lockIcon.className="editorTrackItemLock icon-lock icon-white",track.appendChild(lockIcon)}else{if(plugin.allowResize()){var resizerL=document.createElement("div");resizerL.className="editorTrackItemResizer left",resizerL.track=track,track.appendChild(resizerL);var resizerR=document.createElement("div");resizerR.className="editorTrackItemResizer right",resizerR.track=track,track.appendChild(resizerR),$(resizerL).mousedown(function(event){paella.editor.utils.mouse.mouseDownTarget="track",thisClass.onResizerDown(this.track,"L",event)}),$(resizerR).mousedown(function(event){paella.editor.utils.mouse.mouseDownTarget="track",thisClass.onResizerDown(this.track,"R",event)})}if(plugin.allowDrag()){var moveArea=document.createElement("div");moveArea.className="editorTrackItemMoveArea",moveArea.track=track,track.appendChild(moveArea),$(moveArea).mousedown(function(event){paella.editor.utils.mouse.mouseDownTarget="track",thisClass.onResizerDown(this.track,"M",event)})}}return $(track).mousedown(function(event){paella.editor.utils.mouse.mouseDownTarget="track",thisClass.onTrackDown(this,event)}),$(document).mousemove(function(event){thisClass.onResizerMove(event)}),$(document).mouseup(function(event){paella.editor.utils.mouse.mouseDownTarget="",thisClass.onResizerUp(this.track,event)}),$(track).dblclick(function(event){thisClass.onDblClick(this.trackInfo,event)}),track},currentTrack:null,resizeTrack:null,currentResizer:null,lastPos:{x:0,y:0},selectTrack:function(requestedTrack,noEvents){var i,trackElem;if("number"==typeof requestedTrack)for(i=0;i<this.trackElemList.length;++i)if(trackElem=this.trackElemList[i],trackElem.trackInfo.trackData.id==requestedTrack){requestedTrack=trackElem;break}if("number"!=typeof requestedTrack&&this.currentTrack!=requestedTrack)for(noEvents||this.onUnselect(),i=0;i<this.trackElemList.length;++i)trackElem=this.trackElemList[i],trackElem==requestedTrack?(this.currentTrack=trackElem,noEvents||this.onSelect(trackElem.trackInfo),$(trackElem).css({"z-index":this.trackIndex.front,opacity:this.trackOpacity.front})):$(trackElem).css({"z-index":this.trackIndex.back,opacity:this.trackOpacity.back})},onSelect:function(trackInfo){this.plugin.onSelect(trackInfo.trackData)},onDblClick:function(track){this.plugin.onDblClick(track.trackData)},onUnselect:function(){this.plugin.onUnselect()},onTrackDown:function(track){this.selectTrack(track),paella.editor.instance.bottomBar.toolbar.onToolChanged(this.plugin.getName(),this.plugin.getTrackName())},onResizerDown:function(track,resizer,event){event&&(this.resizeTrack=track,this.currentResizer=resizer,this.lastPos.x=event.clientX,this.lastPos.y=event.clientY)},onResizerUp:function(){if(this.resizeTrack){var duration=paella.player.videoContainer.duration(!0),totalWidth=$(this.container).width(),left=$(this.resizeTrack).position().left,width=$(this.resizeTrack).width();left=100*left/totalWidth,width=100*width/totalWidth;var start=left*duration/100,end=(left+width)*duration/100,plugin=this.resizeTrack.trackInfo.plugin,trackData=this.resizeTrack.trackInfo.trackData;plugin.onTrackChanged(trackData.id,start,end),paella.editor.pluginManager.onTrackChanged(plugin),paella.editor.instance.rightBar.updateCurrentTab(),paella.editor.instance.bottomBar.timeline.rebuildTrack(plugin.getName()),$(this.resizeTrack).css({left:left+"%",width:width+"%"})}this.resizeTrack=null},onResizerMove:function(event){if(this.resizeTrack){var diff={x:event.clientX-this.lastPos.x,y:event.clientY-this.lastPos.y},left=(paella.player.videoContainer.duration(!0),$(this.resizeTrack).position().left),width=$(this.resizeTrack).width();"L"==this.currentResizer?(left+=diff.x,width-=diff.x,$(this.resizeTrack).css({left:left+"px",width:width+"px"})):"R"==this.currentResizer?(width+=diff.x,$(this.resizeTrack).css({width:width+"px"})):"M"==this.currentResizer&&(left+=diff.x,$(this.resizeTrack).css({left:left+"px"})),this.lastPos.x=event.clientX,this.lastPos.y=event.clientY}}}),Class("paella.editor.EmbedPlayer",base.AsyncLoaderCallback,{editar:null,initialize:function(){this.editor=paella.editor.instance},load:function(onSuccess){var barHeight=this.editor.bottomBar.getHeight()+20,rightBarWidth=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:barHeight+"px",right:rightBarWidth+"px",left:"20px",top:"20px"}),paella.player.mainContainer.className="paellaMainContainerEditorMode",new Timer(function(){paella.player.controls.disable(),paella.player.onresize(),onSuccess&&onSuccess()},500)},restorePlayer:function(){$("body")[0].appendChild(paella.player.mainContainer),paella.player.controls.enable(),paella.player.mainContainer.className="",$(paella.player.mainContainer).css({position:"",width:"",bottom:"",left:"",right:"",top:""}),paella.player.onresize()},onresize:function(){var barHeight=this.editor.bottomBar.getHeight()+20,rightBarWidth=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:barHeight+"px",right:rightBarWidth+"px",left:"20px",top:"20px"})}}),Class("paella.editor.Editor",{config:null,editorContainer:null,isLoaded:!1,bottomBar:null,rightBar:null,embedPlayer:null,loader:null,initialize:function(){if(paella.player.accessControl.permissions.canWrite){var thisClass=this;paella.editor.instance=this,paella.initDelegate.loadEditorConfig(function(config){thisClass.config=config,thisClass.loadEditor()})}},loadEditor:function(){paella.keyManager.enabled=!1;var thisClass=this;this.editorContainer=document.createElement("div"),$("body")[0].appendChild(this.editorContainer),this.editorContainer.className="editorContainer",this.editorContainer.id="editorContainer",this.editorContainer.appendChild(paella.player.mainContainer),$("body")[0].style.backgroundImage="url(resources/images/editor_video_bkg.png)",this.loader=new paella.AsyncLoader,this.bottomBar=this.loader.addCallback(new paella.editor.BottomBar),this.rightBar=this.loader.addCallback(new paella.editor.RightBar),this.embedPlayer=this.loader.addCallback(new paella.editor.EmbedPlayer),this.loader.load(function(){thisClass.onLoadSuccess()},function(){thisClass.onLoadFail()})},onLoadSuccess:function(){this.isLoaded=!0;var thisClass=this;this.onresize(),$(window).resize(function(){thisClass.onresize()}),$(document).trigger(paella.events.play),new Timer(function(){$(document).trigger(paella.events.pause)},100),paella.events.bind(paella.events.documentChanged,function(){window.onbeforeunload=function(){return base.dictionary.translate("There are unsaved changes")}}),paella.events.bind(paella.events.didSaveChanges,function(){window.onbeforeunload=null})},onLoadFail:function(){},unloadEditor:function(){paella.keyManager.enabled=!0,this.embedPlayer.restorePlayer(),$("body")[0].removeChild(this.editorContainer),$("body")[0].style.backgroundImage="",this.editorContainer=null,this.isLoaded=!1,$(document).trigger(paella.events.pause),$(document).trigger(paella.events.hideEditor)},onresize:function(){this.isLoaded&&(this.bottomBar.onresize(),this.rightBar.onresize(),this.embedPlayer.onresize())}}),DeprecatedClass("paella.Dictionary","base.Dictionary",base.Dictionary),paella.dictionary=base.dictionary,DeprecatedClass("paella.AsyncLoaderCallback","base.AsyncLoaderCallback",base.AsyncLoaderCallback),DeprecatedClass("paella.AjaxCallback","base.AjaxCallback",base.AjaxCallback),DeprecatedClass("paella.JSONCallback","base.JSONCallback",base.JSONCallback),DeprecatedClass("paella.DictionaryCallback","base.DictionaryCallback",base.DictionaryCallback),DeprecatedClass("paella.AsyncLoader","base.AsyncLoader",base.AsyncLoader),DeprecatedClass("paella.Timer","base.Timer",base.Timer),DeprecatedClass("paella.utils.Timer","base.Timer",base.Timer),paella.ajax={},paella.ajax.send=DeprecatedFunc("paella.ajax.send","base.ajax.send",base.ajax.send),paella.ajax.get=DeprecatedFunc("paella.ajax.get","base.ajax.get",base.ajax.get),paella.ajax.put=DeprecatedFunc("paella.ajax.put","base.ajax.put",base.ajax.put),paella.ajax.post=DeprecatedFunc("paella.ajax.post","base.ajax.post",base.ajax.post),paella.ajax["delete"]=DeprecatedFunc("paella.ajax.delete","base.ajax.delete",base.ajax.send),paella.ui={},paella.ui.Container=function(params){var elem=document.createElement("div");
return params.id&&(elem.id=params.id),params.className&&(elem.className=params.className),params.style&&$(elem).css(params.style),elem},paella.utils.ajax=base.ajax,paella.utils.cookies=base.cookies,paella.utils.parameters=base.parameters,paella.utils.require=base.require,paella.utils.importStylesheet=base.importStylesheet,paella.utils.language=base.dictionary.currentLanguage,paella.utils.uuid=base.uuid,paella.utils.userAgent=base.userAgent,paella.debug={log:function(msg){base.log.warning("paella.debug.log is deprecated, use base.debug.[error/warning/debug/log] instead."),base.log.log(msg)}},Class("paella.plugins.FlexSkipPlugin",paella.ButtonPlugin,{getAlignment:function(){return"left"},getName:function(){return"edu.harvard.dce.paella.flexSkipPlugin"},getIndex:function(){return 121},getSubclass:function(){return"flexSkip_Rewind_10"},formatMessage:function(){return"Rewind 10 seconds"},getDefaultToolTip:function(){return base.dictionary.translate(this.formatMessage())},getMinWindowSize:function(){return 510},checkEnabled:function(onSuccess){onSuccess(!paella.player.isLiveStream())},action:function(){var newTime=paella.player.videoContainer.currentTime()-10;paella.events.trigger(paella.events.seekToTime,{time:newTime})}}),paella.plugins.flexSkipPlugin=new paella.plugins.FlexSkipPlugin,Class("paella.plugins.FlexSkipForwardPlugin",paella.plugins.FlexSkipPlugin,{getIndex:function(){return 122},getName:function(){return"edu.harvard.dce.paella.flexSkipForwardPlugin"},getSubclass:function(){return"flexSkip_Forward_30"},formatMessage:function(){return"Forward 30 seconds"},action:function(){var newTime=paella.player.videoContainer.currentTime()+30;paella.events.trigger(paella.events.seekToTime,{time:newTime})}}),paella.plugins.flexSkipForwardPlugin=new paella.plugins.FlexSkipForwardPlugin,paella.plugins.TrimmingTrackPlugin=Class.create(paella.editor.MainTrackPlugin,{trimmingTrack:null,trimmingData:{s:0,e:0},getTrackItems:function(){null==this.trimmingTrack&&(this.trimmingTrack={id:1,s:0,e:0},this.trimmingTrack.s=paella.player.videoContainer.trimStart(),this.trimmingTrack.e=paella.player.videoContainer.trimEnd(),this.trimmingData.s=this.trimmingTrack.s,this.trimmingData.e=this.trimmingTrack.e);var tracks=[];return tracks.push(this.trimmingTrack),tracks},getName:function(){return"es.upv.paella.editor.trimmingTrackPlugin"},getTrackName:function(){return base.dictionary.translate("Trimming")},getColor:function(){return"rgb(0, 51, 107)"},onSave:function(onDone){paella.player.videoContainer.enableTrimming(),paella.player.videoContainer.setTrimmingStart(this.trimmingTrack.s),paella.player.videoContainer.setTrimmingEnd(this.trimmingTrack.e),paella.data.write("trimming",{id:paella.initDelegate.getId()},{start:this.trimmingTrack.s,end:this.trimmingTrack.e},function(data,status){onDone(status)})},onDiscard:function(onDone){this.trimmingTrack.s=this.trimmingData.s,this.trimmingTrack.e=this.trimmingData.e,onDone(!0)},allowDrag:function(){return!1},onTrackChanged:function(id,start,end){this.trimmingTrack.s=start,this.trimmingTrack.e=end,this.parent(id,start,end)},contextHelpString:function(){return"es"==base.dictionary.currentLanguage()?'Utiliza la herramienta de recorte para definir el instante inicial y el instante final de la clase. Para cambiar la duración solo hay que arrastrar el inicio o el final de la pista "Recorte", en la linea de tiempo.':"Use this tool to define the start and finish time."}}),paella.plugins.trimmingTrackPlugin=new paella.plugins.TrimmingTrackPlugin,Class("paella.plugins.TrimmingLoaderPlugin",paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.trimmingPlayerPlugin"},getEvents:function(){return[paella.events.controlBarLoaded,paella.events.showEditor,paella.events.hideEditor]},onEvent:function(eventType){switch(eventType){case paella.events.controlBarLoaded:this.loadTrimming();break;case paella.events.showEditor:paella.player.videoContainer.disableTrimming();break;case paella.events.hideEditor:paella.player.config.trimming&&paella.player.config.trimming.enabled&&paella.player.videoContainer.enableTrimming()}},loadTrimming:function(){var videoId=paella.initDelegate.getId();paella.data.read("trimming",{id:videoId},function(data,status){data&&status&&data.end>0&&(paella.player.videoContainer.enableTrimming(),paella.player.videoContainer.setTrimming(data.start,data.end))})}}),paella.plugins.trimmingLoaderPlugin=new paella.plugins.TrimmingLoaderPlugin,Class("paella.plugins.AnnotationsEditorPlugin",paella.editor.TrackPlugin,{tracks:null,selectedTrackItem:null,checkEnabled:function(onSuccess){var This=this;this.tracks=[],paella.data.read("annotations",{id:paella.initDelegate.getId()},function(data){data&&"object"==typeof data&&data.annotations&&data.annotations.length>0&&(This.tracks=data.annotations),onSuccess(!0)})},setup:function(){if("es"==base.dictionary.currentLanguage()){var esDict={Annotation:"Anotación",Annotations:"Anotaciones"};base.dictionary.addDictionary(esDict)}},getTrackItems:function(){return this.tracks},getTools:function(){return[{name:"create",label:base.dictionary.translate("Create"),hint:base.dictionary.translate("Create a new caption in the current position")},{name:"delete",label:base.dictionary.translate("Delete"),hint:base.dictionary.translate("Delete selected caption")}]},onToolSelected:function(toolName){if(this.selectedTrackItem&&"delete"==toolName&&this.selectedTrackItem)return paella.events.trigger(paella.events.documentChanged),this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1),!0;if("create"==toolName){paella.events.trigger(paella.events.documentChanged);var start=paella.player.videoContainer.currentTime(),end=start+30,id=this.getTrackUniqueId(),content=base.dictionary.translate("Annotation");return this.tracks.push({id:id,s:start,e:end,content:content,name:content}),!0}},getTrackUniqueId:function(){var newId=-1;if(0==this.tracks.length)return 1;for(var i=0;i<this.tracks.length;++i)newId<=this.tracks[i].id&&(newId=this.tracks[i].id+1);return newId},getName:function(){return"es.upv.paella.editor.trackAnnotations"},getTrackName:function(){return base.dictionary.translate("Annotations")},getColor:function(){return"rgb(212, 212, 224)"},getTextColor:function(){return"rgb(90,90,90)"},onTrackChanged:function(id,start,end){paella.events.trigger(paella.events.documentChanged);var item=this.getTrackItem(id);item&&(item.s=start,item.e=end,this.selectedTrackItem=item)},onTrackContentChanged:function(id,content){paella.events.trigger(paella.events.documentChanged);var item=this.getTrackItem(id);item&&(item.content=paella.AntiXSS.htmlEscape(content),item.name=paella.AntiXSS.htmlEscape(content))},allowEditContent:function(){return!0},getTrackItem:function(id){for(var i=0;i<this.tracks.length;++i)if(this.tracks[i].id==id)return this.tracks[i]},contextHelpString:function(){return"es"==base.dictionary.currentLanguage()?"Utiliza esta herramienta para crear, borrar y editar anotaciones. Para crear una anotación, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de las anotaciones":"Use this tool to create, delete and edit video annotations. To create an annotation, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the annotation text."},onSave:function(success){var data={annotations:this.tracks};paella.data.write("annotations",{id:paella.initDelegate.getId()},data,function(response,status){paella.plugins.annotationsPlayerlugin.annotations=data.annotations,success(status)})}}),paella.plugins.annotationsEditorPlugin=new paella.plugins.AnnotationsEditorPlugin,Class("paella.plugins.AnnotationsPlayerPlugin",paella.EventDrivenPlugin,{annotations:null,lastEvent:0,visibleAnnotations:null,getName:function(){return"es.upv.paella.annotationsPlayerPlugin"},checkEnabled:function(onSuccess){var This=this;this.annotations=[],this.visibleAnnotations=[],paella.data.read("annotations",{id:paella.initDelegate.getId()},function(data){data&&"object"==typeof data&&data.annotations&&data.annotations.length>0&&(This.annotations=data.annotations),onSuccess(!0)})},getEvents:function(){return[paella.events.timeUpdate]},onEvent:function(eventType,params){this.checkAnnotations(params)},checkAnnotations:function(params){for(var a,i=0;i<this.annotations.length;++i)a=this.annotations[i],a.s<params.currentTime&&a.e>params.currentTime&&this.showAnnotation(a);for(var key in this.visibleAnnotations)"object"==typeof a&&(a=this.visibleAnnotations[key],a&&(a.s>=params.currentTime||a.e<=params.currentTime)&&this.removeAnnotation(a))},showAnnotation:function(annotation){if(!this.visibleAnnotations[annotation.s]){var rect={left:100,top:10,width:1080,height:20};annotation.elem=paella.player.videoContainer.overlayContainer.addText(annotation.content,rect),annotation.elem.className="textAnnotation",this.visibleAnnotations[annotation.s]=annotation}},removeAnnotation:function(annotation){if(this.visibleAnnotations[annotation.s]){var elem=this.visibleAnnotations[annotation.s].elem;paella.player.videoContainer.overlayContainer.removeElement(elem),this.visibleAnnotations[annotation.s]=null}}}),paella.plugins.annotationsPlayerlugin=new paella.plugins.AnnotationsPlayerPlugin,Class("paella.BlackBoard2",paella.EventDrivenPlugin,{_blackBoardProfile:"s_p_blackboard2",_blackBoardDIV:null,_hasImages:null,_active:!1,_creationTimer:500,_zImages:null,_videoLength:null,_keys:null,_actualImage:null,_next:null,_ant:null,_lensDIV:null,_lensContainer:null,_lensWidth:null,_lensHeight:null,_conImg:null,_zoom:250,_currentZoom:null,_maxZoom:500,_mousePos:null,_containerRect:null,getName:function(){return"es.upv.paella.blackBoardPlugin"},getIndex:function(){return 10},getAlignment:function(){return"right"},getSubclass:function(){return"blackBoardButton2"},getDefaultToolTip:function(){return base.dictionary.translate("BlackBoard")},checkEnabled:function(onSuccess){onSuccess(!0)},getEvents:function(){return[paella.events.setProfile,paella.events.timeUpdate]},onEvent:function(event,params){var self=this;switch(event){case paella.events.setProfile:if(params.profileName!=self._blackBoardProfile){self._active&&(self.destroyOverlay(),self._active=!1);break}self._hasImages||paella.events.trigger(paella.events.setProfile,{profileName:"slide_professor"}),self._hasImages&&!self._active&&(self.createOverlay(),self._active=!0);break;case paella.events.timeUpdate:self._active&&self._hasImages&&self.imageUpdate(event,params)}},setup:function(){var self=this,n=paella.player.videoContainer.sourceData[0].sources;n.hasOwnProperty("image")?(self._hasImages=!0,self._zImages={},self._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,self._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,self._keys=Object.keys(self._zImages),self._keys=self._keys.sort(function(a,b){return a=a.slice(6),b=b.slice(6),parseInt(a)-parseInt(b)})):(self._hasImages=!1,paella.player.selectedProfile==self._blackBoardProfile&&(defaultprofile=paella.player.config.defaultProfile,paella.events.trigger(paella.events.setProfile,{profileName:defaultprofile}))),this._next=0,this._ant=0,paella.player.selectedProfile==self._blackBoardProfile&&(self.createOverlay(),self._active=!0),self._mousePos={},paella.Profiles.loadProfile(self._blackBoardProfile,function(profileData){self._containerRect=profileData.blackBoardImages})},createLens:function(){var self=this;null==self._currentZoom&&(self._currentZoom=self._zoom);var lens=document.createElement("div");lens.className="lensClass",self._lensDIV=lens;var p=$(".conImg").offset(),width=$(".conImg").width(),height=$(".conImg").height();lens.style.width=width/(self._currentZoom/100)+"px",lens.style.height=height/(self._currentZoom/100)+"px",self._lensWidth=parseInt(lens.style.width),self._lensHeight=parseInt(lens.style.height),$(self._lensContainer).append(lens),$(self._lensContainer).mousemove(function(event){if(mouseX=event.pageX-p.left,mouseY=event.pageY-p.top,self._mousePos.x=mouseX,self._mousePos.y=mouseY,lensTop=mouseY-self._lensHeight/2,lensTop=lensTop<0?0:lensTop,lensTop=lensTop>height-self._lensHeight?height-self._lensHeight:lensTop,lensLeft=mouseX-self._lensWidth/2,lensLeft=lensLeft<0?0:lensLeft,lensLeft=lensLeft>width-self._lensWidth?width-self._lensWidth:lensLeft,self._lensDIV.style.left=lensLeft+"px",self._lensDIV.style.top=lensTop+"px",100!=self._currentZoom)x=100*lensLeft/(width-self._lensWidth),y=100*lensTop/(height-self._lensHeight),self._blackBoardDIV.style.backgroundPosition=x.toString()+"% "+y.toString()+"%";else if(100==self._currentZoom){var xRelative=100*mouseX/width,yRelative=100*mouseY/height;self._blackBoardDIV.style.backgroundPosition=xRelative.toString()+"% "+yRelative.toString()+"%"}self._blackBoardDIV.style.backgroundSize=self._currentZoom+"%"}),$(self._lensContainer).bind("wheel mousewheel",function(e){var delta;delta=void 0!==e.originalEvent.wheelDelta?e.originalEvent.wheelDelta:-1*e.originalEvent.deltaY,delta>0&&self._currentZoom<self._maxZoom?self.reBuildLens(10):self._currentZoom>100?self.reBuildLens(-10):100==self._currentZoom&&(self._lensDIV.style.left="0px",self._lensDIV.style.top="0px"),self._blackBoardDIV.style.backgroundSize=self._currentZoom+"%"})},reBuildLens:function(zoomValue){var self=this;self._currentZoom+=zoomValue;var width=($(".conImg").offset(),$(".conImg").width()),height=$(".conImg").height();if(self._lensDIV.style.width=width/(self._currentZoom/100)+"px",self._lensDIV.style.height=height/(self._currentZoom/100)+"px",self._lensWidth=parseInt(self._lensDIV.style.width),self._lensHeight=parseInt(self._lensDIV.style.height),100!=self._currentZoom){var mouseX=self._mousePos.x,mouseY=self._mousePos.y;lensTop=mouseY-self._lensHeight/2,lensTop=lensTop<0?0:lensTop,lensTop=lensTop>height-self._lensHeight?height-self._lensHeight:lensTop,lensLeft=mouseX-self._lensWidth/2,lensLeft=lensLeft<0?0:lensLeft,lensLeft=lensLeft>width-self._lensWidth?width-self._lensWidth:lensLeft,self._lensDIV.style.left=lensLeft+"px",self._lensDIV.style.top=lensTop+"px",x=100*lensLeft/(width-self._lensWidth),y=100*lensTop/(height-self._lensHeight),self._blackBoardDIV.style.backgroundPosition=x.toString()+"% "+y.toString()+"%"}},destroyLens:function(){var self=this;self._lensDIV&&($(self._lensDIV).remove(),self._blackBoardDIV.style.backgroundSize="100%",self._blackBoardDIV.style.opacity=0)},createOverlay:function(){var self=this,blackBoardDiv=document.createElement("div");blackBoardDiv.className="blackBoardDiv",self._blackBoardDIV=blackBoardDiv,self._blackBoardDIV.style.opacity=0;var lensContainer=document.createElement("div");lensContainer.className="lensContainer",self._lensContainer=lensContainer;var conImg=document.createElement("img");conImg.className="conImg",self._conImg=conImg,self._actualImage&&(self._conImg.src=self._actualImage,$(self._blackBoardDIV).css("background-image","url("+self._actualImage+")")),$(lensContainer).append(conImg),$(self._lensContainer).mouseenter(function(){self.createLens(),self._blackBoardDIV.style.opacity=1}),$(self._lensContainer).mouseleave(function(){self.destroyLens()}),setTimeout(function(){overlayContainer=paella.player.videoContainer.overlayContainer,overlayContainer.addElement(blackBoardDiv,overlayContainer.getMasterRect()),overlayContainer.addElement(lensContainer,self._containerRect)},self._creationTimer)},destroyOverlay:function(){var self=this;self._blackBoardDIV&&$(self._blackBoardDIV).remove(),self._lensContainer&&$(self._lensContainer).remove()},imageUpdate:function(event,params){var self=this,sec=Math.round(params.currentTime),src=$(self._blackBoardDIV).css("background-image");if($(self._blackBoardDIV).length>0){if(self._zImages.hasOwnProperty("frame_"+sec)){if(src==self._zImages["frame_"+sec])return;src=self._zImages["frame_"+sec]}else{if(!(sec>self._next||sec<self._ant))return;src=self.returnSrc(sec)}var image=new Image;image.onload=function(){$(self._blackBoardDIV).css("background-image","url("+src+")")},image.src=src,self._actualImage=src,self._conImg.src=self._actualImage}},returnSrc:function(sec){var self=this,ant=0;for(i=0;i<self._keys.length;i++){var id=parseInt(self._keys[i].slice(6)),lastId=parseInt(self._keys[self._keys.length-1].slice(6));if(id>sec)return self._next=id,self._ant=ant,self._imageNumber=i-1,self._zImages["frame_"+ant];if(sec>lastId&&sec<self._videoLength)return self._next=self._videoLength,self._ant=lastId,self._zImages["frame_"+ant];ant=id}}}),paella.plugins.blackBoard2=new paella.BlackBoard2,Class("paella.plugins.BreaksEditorPlugin",paella.editor.MainTrackPlugin,{tracks:null,selectedTrackItem:null,checkEnabled:function(onSuccess){var This=this;this.tracks=[],paella.data.read("breaks",{id:paella.initDelegate.getId()},function(data){data&&"object"==typeof data&&data.breaks&&data.breaks.length>0&&(This.tracks=data.breaks),onSuccess(!0)})},setup:function(){if("es"==base.dictionary.currentLanguage()){var esDict={Breaks:"Descansos",Break:"Descanso","Create a new break in the current position":"Añade un descanso en el instante actual","Delete selected break":"Borra el descanso seleccionado"};base.dictionary.addDictionary(esDict)}},getTrackItems:function(){return this.tracks},getTools:function(){return[{name:"create",label:base.dictionary.translate("Create"),hint:base.dictionary.translate("Create a new break in the current position")},{name:"delete",label:base.dictionary.translate("Delete"),hint:base.dictionary.translate("Delete selected break")}]},onToolSelected:function(toolName){if(this.selectedTrackItem&&"delete"==toolName&&this.selectedTrackItem)return paella.events.trigger(paella.events.documentChanged),this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1),!0;if("create"==toolName){paella.events.trigger(paella.events.documentChanged);var start=paella.player.videoContainer.currentTime(),end=start+30,id=this.getTrackUniqueId(),content=base.dictionary.translate("Break");return this.tracks.push({id:id,s:start,e:end,content:content,name:content}),!0}},getTrackUniqueId:function(){var newId=-1;if(0==this.tracks.length)return 1;for(var i=0;i<this.tracks.length;++i)newId<=this.tracks[i].id&&(newId=this.tracks[i].id+1);return newId},getName:function(){return"es.upv.paella.editor.trackBreaksPlugin"},getTrackName:function(){return base.dictionary.translate("Breaks")},getColor:function(){return"rgb(219, 81, 81)"},getTextColor:function(){return"rgb(90,90,90)"},onTrackChanged:function(id,start,end){paella.events.trigger(paella.events.documentChanged);var item=this.getTrackItem(id);item&&(item.s=start,item.e=end,this.selectedTrackItem=item)},onTrackContentChanged:function(id,content){paella.events.trigger(paella.events.documentChanged);var item=this.getTrackItem(id);item&&(item.content=paella.AntiXSS.htmlEscape(content),item.name=paella.AntiXSS.htmlEscape(content))},allowEditContent:function(){return!0},getTrackItem:function(id){for(var i=0;i<this.tracks.length;++i)if(this.tracks[i].id==id)return this.tracks[i]},contextHelpString:function(){return"es"==base.dictionary.currentLanguage()?"Utiliza esta herramienta para crear, borrar y editar descansos. Para crear un descanso, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los descansos":"Use this tool to create, delete and edit breaks. To create a break, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the break text."},onSave:function(success){var data={breaks:this.tracks};paella.data.write("breaks",{id:paella.initDelegate.getId()},data,function(response,status){paella.plugins.breaksPlayerPlugin.breaks=data.breaks,success(status)})}}),paella.plugins.breaksEditorPlugin=new paella.plugins.BreaksEditorPlugin,Class("paella.plugins.BreaksPlayerPlugin",paella.EventDrivenPlugin,{breaks:null,lastEvent:0,visibleBreaks:null,getName:function(){return"es.upv.paella.breaksPlayerPlugin"},checkEnabled:function(onSuccess){var This=this;this.breaks=[],this.visibleBreaks=[],paella.data.read("breaks",{id:paella.initDelegate.getId()},function(data){data&&"object"==typeof data&&data.breaks&&data.breaks.length>0&&(This.breaks=data.breaks),onSuccess(!0)})},getEvents:function(){return[paella.events.timeUpdate]},onEvent:function(eventType,params){this.checkBreaks(params)},checkBreaks:function(params){for(var a,i=0;i<this.breaks.length;++i)a=this.breaks[i],a.s<params.currentTime&&a.e>params.currentTime?this.showBreaks(a):a.s.toFixed(0)==params.currentTime.toFixed(0)&&this.avoidBreak(a);for(var key in this.visibleBreaks)"object"==typeof a&&(a=this.visibleBreaks[key],a&&(a.s>=params.currentTime||a.e<=params.currentTime)&&this.removeBreak(a))},showBreaks:function(br){if(!this.visibleBreaks[br.s]){var rect={left:100,top:350,width:1080,height:20};br.elem=paella.player.videoContainer.overlayContainer.addText(br.content,rect),br.elem.className="textBreak",this.visibleBreaks[br.s]=br}},removeBreak:function(br){if(this.visibleBreaks[br.s]){var elem=this.visibleBreaks[br.s].elem;paella.player.videoContainer.overlayContainer.removeElement(elem),this.visibleBreaks[br.s]=null}},avoidBreak:function(br){var newTime=br.e;paella.events.trigger(paella.events.seekToTime,{time:newTime})}}),paella.plugins.breaksPlayerPlugin=new paella.plugins.BreaksPlayerPlugin,function(){Class("paella.captions.parsers.DFXPParserPlugin",paella.CaptionParserPlugIn,{ext:["dfxp"],getName:function(){return"es.upv.paella.captions.DFXPParserPlugin"},parse:function(content,lang,next){for(var captions=[],self=this,xml=$(content),g_lang=xml.attr("xml:lang"),lls=xml.find("div"),idx=0;idx<lls.length;++idx){var ll=$(lls[idx]),l_lang=ll.attr("xml:lang");if((void 0==l_lang||""==l_lang)&&(void 0==g_lang||""==g_lang?(base.log.debug("No xml:lang found! Using '"+lang+"' lang instead."),l_lang=lang):l_lang=g_lang),l_lang==lang){ll.find("p").each(function(i,cap){var c={id:i,begin:self.parseTimeTextToSeg(cap.getAttribute("begin")),end:self.parseTimeTextToSeg(cap.getAttribute("end")),content:$(cap).text().trim()};captions.push(c)});break}}captions.length>0?next(!1,captions):next(!0)},parseTimeTextToSeg:function(ttime){var nseg=0,segtime=/^([0-9]*([.,][0-9]*)?)s/.test(ttime);if(segtime)nseg=parseFloat(RegExp.$1);else{var split=ttime.split(":"),h=parseInt(split[0]),m=parseInt(split[1]),s=parseInt(split[2]);nseg=s+60*m+60*h*60}return nseg}}),new paella.captions.parsers.DFXPParserPlugin}(),Class("paella.plugins.CaptionsPlugin",paella.ButtonPlugin,{_searchTimerTime:1500,_searchTimer:null,_pluginButton:null,_open:0,_parent:null,_body:null,_inner:null,_bar:null,_input:null,_select:null,_editor:null,_activeCaptions:null,_lastSel:null,_browserLang:null,_defaultBodyHeight:280,_autoScroll:!0,_searchOnCaptions:null,getAlignment:function(){return"right"},getSubclass:function(){return"captionsPluginButton"},getName:function(){return"es.upv.paella.captionsPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Subtitles")},getIndex:function(){return 509},checkEnabled:function(onSuccess){onSuccess(!0)},showUI:function(){paella.captions.getAvailableLangs().length&&this.parent()},setup:function(){var self=this;paella.captions.getAvailableLangs().length||paella.plugins.captionsPlugin.hideUI(),paella.events.bind(paella.events.captionsEnabled,function(event,params){self.onChangeSelection(params)}),paella.events.bind(paella.events.captionsDisabled,function(event,params){self.onChangeSelection(params)}),paella.events.bind(paella.events.captionAdded,function(event,params){self.onCaptionAdded(params),paella.plugins.captionsPlugin.showUI()}),paella.events.bind(paella.events.timeUpdate,function(event,params){self._searchOnCaptions&&self.updateCaptionHiglighted(params)}),paella.events.bind(paella.events.controlBarWillHide,function(){self.cancelHideBar()}),self._activeCaptions=paella.captions.getActiveCaptions(),self._searchOnCaptions=self.config.searchOnCaptions||!1},cancelHideBar:function(){var thisClass=this;thisClass._open>0&&paella.player.controls.cancelHideBar()},updateCaptionHiglighted:function(time){var thisClass=this,sel=null,id=null;time&&(id=thisClass.searchIntervaltoHighlight(time),null!=id&&(sel=$(".bodyInnerContainer[sec-id='"+id+"']"),sel!=thisClass._lasSel&&$(thisClass._lasSel).removeClass("Highlight"),sel&&($(sel).addClass("Highlight"),thisClass._autoScroll&&thisClass.updateScrollFocus(id),thisClass._lasSel=sel)))},searchIntervaltoHighlight:function(time){var thisClass=this;return paella.captions.getActiveCaptions()&&(n=paella.captions.getActiveCaptions()._captions,n.forEach(function(l){l.begin<time.currentTime&&time.currentTime<l.end&&(thisClass.resul=l.id)})),null!=thisClass.resul?thisClass.resul:null},updateScrollFocus:function(id){var thisClass=this,resul=0,t=$(".bodyInnerContainer").slice(0,id);t=t.toArray(),t.forEach(function(l){var i=$(l).outerHeight(!0);resul+=i});var x=parseInt(resul/280);$(".captionsBody").scrollTop(x*thisClass._defaultBodyHeight)},onCaptionAdded:function(obj){var thisClass=this,newCap=paella.captions.getCaptions(obj),defOption=document.createElement("option");defOption.text=newCap._lang.txt,defOption.value=obj,thisClass._select.add(defOption)},changeSelection:function(){var thisClass=this,sel=$(thisClass._select).val();return""==sel?($(thisClass._body).empty(),void paella.captions.setActiveCaptions(sel)):(paella.captions.setActiveCaptions(sel),thisClass._activeCaptions=sel,thisClass._searchOnCaptions&&thisClass.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"),void thisClass.setButtonHideShow())},onChangeSelection:function(obj){var thisClass=this;thisClass._activeCaptions!=obj&&($(thisClass._body).empty(),void 0==obj?(thisClass._select.value="",$(thisClass._input).prop("disabled",!0)):($(thisClass._input).prop("disabled",!1),thisClass._select.value=obj,thisClass._searchOnCaptions&&thisClass.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list")),thisClass._activeCaptions=obj,thisClass.setButtonHideShow())},action:function(){var self=this;switch(self._browserLang=base.dictionary.currentLanguage(),self._autoScroll=!0,self._open){case 0:self._browserLang&&void 0==paella.captions.getActiveCaptions()&&self.selectDefaultBrowserLang(self._browserLang),self._open=1,paella.keyManager.enabled=!1;break;case 1:paella.keyManager.enabled=!0,self._open=0}},buildContent:function(domElement){var thisClass=this;thisClass._parent=document.createElement("div"),thisClass._parent.className="captionsPluginContainer",thisClass._bar=document.createElement("div"),thisClass._bar.className="captionsBar",thisClass._searchOnCaptions&&(thisClass._body=document.createElement("div"),thisClass._body.className="captionsBody",thisClass._parent.appendChild(thisClass._body),$(thisClass._body).scroll(function(){thisClass._autoScroll=!1}),thisClass._input=document.createElement("input"),thisClass._input.className="captionsBarInput",thisClass._input.type="text",thisClass._input.id="captionsBarInput",thisClass._input.name="captionsString",thisClass._input.placeholder=base.dictionary.translate("Search captions"),thisClass._bar.appendChild(thisClass._input),$(thisClass._input).change(function(){var text=$(thisClass._input).val();thisClass.doSearch(text)}),$(thisClass._input).keyup(function(){var text=$(thisClass._input).val();null!=thisClass._searchTimer&&thisClass._searchTimer.cancel(),thisClass._searchTimer=new base.Timer(function(){thisClass.doSearch(text)},thisClass._searchTimerTime)})),thisClass._select=document.createElement("select"),thisClass._select.className="captionsSelector";var defOption=document.createElement("option");defOption.text=base.dictionary.translate("None"),defOption.value="",thisClass._select.add(defOption),paella.captions.getAvailableLangs().forEach(function(l){var option=document.createElement("option");option.text=l.lang.txt,option.value=l.id,thisClass._select.add(option)}),thisClass._bar.appendChild(thisClass._select),thisClass._parent.appendChild(thisClass._bar),$(thisClass._select).change(function(){thisClass.changeSelection()}),thisClass._editor=document.createElement("button"),thisClass._editor.className="editorButton",thisClass._editor.innerHTML="",thisClass._bar.appendChild(thisClass._editor),$(thisClass._editor).prop("disabled",!0),$(thisClass._editor).click(function(){var c=paella.captions.getActiveCaptions();paella.userTracking.log("paella:caption:edit",{id:c._captionsProvider+":"+c._id,lang:c._lang}),c.goToEdit()}),domElement.appendChild(thisClass._parent)},selectDefaultBrowserLang:function(code){var provider=null;paella.captions.getAvailableLangs().forEach(function(l){l.lang.code==code&&(provider=l.id)}),provider&&paella.captions.setActiveCaptions(provider)},doSearch:function(text){thisClass=this;var c=paella.captions.getActiveCaptions();c&&(""==text?thisClass.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"):c.search(text,function(err,resul){err||thisClass.buildBodyContent(resul,"search")}))},setButtonHideShow:function(){var thisClass=this,editor=$(".editorButton"),c=paella.captions.getActiveCaptions(),res=null;null!=c?($(thisClass._select).width("39%"),c.canEdit(function(err,r){res=r}),res?($(editor).prop("disabled",!1),$(editor).show()):($(editor).prop("disabled",!0),$(editor).hide(),$(thisClass._select).width("47%"))):($(editor).prop("disabled",!0),$(editor).hide(),$(thisClass._select).width("47%")),thisClass._searchOnCaptions||$(thisClass._select).width(res?"92%":"100%")},buildBodyContent:function(obj,type){var thisClass=this;$(thisClass._body).empty(),obj.forEach(function(l){thisClass._inner=document.createElement("div"),thisClass._inner.className="bodyInnerContainer",thisClass._inner.innerHTML=l.content,"list"==type&&(thisClass._inner.setAttribute("sec-begin",l.begin),thisClass._inner.setAttribute("sec-end",l.end),thisClass._inner.setAttribute("sec-id",l.id),thisClass._autoScroll=!0),"search"==type&&thisClass._inner.setAttribute("sec-begin",l.time),thisClass._body.appendChild(thisClass._inner),$(thisClass._inner).hover(function(){$(this).css("background-color","rgba(250, 161, 102, 0.5)")},function(){$(this).removeAttr("style")}),$(thisClass._inner).click(function(){var secBegin=$(this).attr("sec-begin");paella.player.videoContainer.seekToTime(parseInt(secBegin))})})}}),paella.plugins.captionsPlugin=new paella.plugins.CaptionsPlugin,Class("paella.plugins.CaptionsOnScreen",paella.EventDrivenPlugin,{containerId:"paella_plugin_CaptionsOnScreen",container:null,innerContainer:null,top:null,actualPos:null,lastEvent:null,controlsPlayback:null,captions:!1,captionProvider:null,checkEnabled:function(onSuccess){onSuccess(!paella.player.isLiveStream())},setup:function(){},getEvents:function(){return[paella.events.controlBarDidHide,paella.events.resize,paella.events.controlBarDidShow,paella.events.captionsEnabled,paella.events.captionsDisabled,paella.events.timeUpdate]},onEvent:function(eventType,params){var thisClass=this;switch(eventType){case paella.events.controlBarDidHide:if(thisClass.lastEvent==eventType||0==thisClass.captions)break;thisClass.moveCaptionsOverlay("down");break;case paella.events.resize:if(0==thisClass.captions)break;thisClass.moveCaptionsOverlay(paella.player.controls.isHidden()?"down":"top");break;case paella.events.controlBarDidShow:if(thisClass.lastEvent==eventType||0==thisClass.captions)break;thisClass.moveCaptionsOverlay("top");break;case paella.events.captionsEnabled:thisClass.buildContent(params),thisClass.captions=!0;break;case paella.events.captionsDisabled:thisClass.hideContent(),thisClass.captions=!1;break;case paella.events.timeUpdate:thisClass.captions&&thisClass.updateCaptions(params)}thisClass.lastEvent=eventType},buildContent:function(provider){var thisClass=this;thisClass.captionProvider=provider,null==thisClass.container?(thisClass.container=document.createElement("div"),thisClass.container.className="CaptionsOnScreen",thisClass.container.id=thisClass.containerId,thisClass.innerContainer=document.createElement("div"),thisClass.innerContainer.className="CaptionsOnScreenInner",thisClass.container.appendChild(thisClass.innerContainer),null==thisClass.controlsPlayback&&(thisClass.controlsPlayback=$("#playerContainer_controls_playback")),paella.player.videoContainer.domElement.appendChild(thisClass.container)):$(thisClass.container).show()
},updateCaptions:function(time){var thisClass=this;if(thisClass.captions){var c=paella.captions.getActiveCaptions(),caption=c.getCaptionAtTime(time.currentTime);caption?($(thisClass.container).show(),thisClass.innerContainer.innerHTML=caption.content):thisClass.innerContainer.innerHTML=""}},hideContent:function(){var thisClass=this;$(thisClass.container).hide()},moveCaptionsOverlay:function(pos){var thisClass=this;if(null==thisClass.controlsPlayback&&(thisClass.controlsPlayback=$("#playerContainer_controls_playback")),"down"==pos){{thisClass.controlsPlayback.offset().top}thisClass.innerContainer.style.bottom=-thisClass.container.offsetHeight+50+"px"}if("top"==pos){var t2=thisClass.controlsPlayback.offset().top;t2-=thisClass.innerContainer.offsetHeight+10,thisClass.innerContainer.style.bottom=0-t2+"px"}},getIndex:function(){return 1050},getName:function(){return"es.upv.paella.overlayCaptionsPlugin"}}),new paella.plugins.CaptionsOnScreen,Class("paella.plugins.CommentsPlugin",paella.TabBarPlugin,{divPublishComment:null,divComments:null,publishCommentTextArea:null,publishCommentButtons:null,canPublishAComment:!1,comments:[],commentsTree:[],domElement:null,getSubclass:function(){return"showCommentsTabBar"},getName:function(){return"es.upv.paella.commentsPlugin"},getTabName:function(){return base.dictionary.translate("Comments")},checkEnabled:function(onSuccess){onSuccess(!0)},getIndex:function(){return 40},getDefaultToolTip:function(){return base.dictionary.translate("Comments")},action:function(){this.loadContent()},buildContent:function(domElement){this.domElement=domElement,this.canPublishAComment=paella.initDelegate.initParams.accessControl.permissions.canWrite,this.loadContent()},loadContent:function(){this.divRoot=this.domElement,this.divRoot.innerHTML="",this.divPublishComment=document.createElement("div"),this.divPublishComment.className="CommentPlugin_Publish",this.divPublishComment.id="CommentPlugin_Publish",this.divComments=document.createElement("div"),this.divComments.className="CommentPlugin_Comments",this.divComments.id="CommentPlugin_Comments",this.canPublishAComment&&(this.divRoot.appendChild(this.divPublishComment),this.createPublishComment()),this.divRoot.appendChild(this.divComments),this.reloadComments()},createPublishComment:function(){var divEntry,thisClass=this,rootID=this.divPublishComment.id+"_entry";divEntry=document.createElement("div"),divEntry.id=rootID,divEntry.className="comments_entry";var divSil;divSil=document.createElement("img"),divSil.className="comments_entry_silhouette",divSil.style.width="48px",divSil.src=paella.initDelegate.initParams.accessControl.userData.avatar,divSil.id=rootID+"_silhouette",divEntry.appendChild(divSil);var divTextAreaContainer;divTextAreaContainer=document.createElement("div"),divTextAreaContainer.className="comments_entry_container",divTextAreaContainer.id=rootID+"_textarea_container",divEntry.appendChild(divTextAreaContainer),this.publishCommentTextArea=document.createElement("textarea"),this.publishCommentTextArea.id=rootID+"_textarea",this.publishCommentTextArea.onclick=function(){paella.keyManager.enabled=!1},this.publishCommentTextArea.onblur=function(){paella.keyManager.enabled=!0},divTextAreaContainer.appendChild(this.publishCommentTextArea),this.publishCommentButtons=document.createElement("div"),this.publishCommentButtons.id=rootID+"_buttons_area",divTextAreaContainer.appendChild(this.publishCommentButtons);var btnAddComment;btnAddComment=document.createElement("button"),btnAddComment.id=rootID+"_btnAddComment",btnAddComment.className="publish",btnAddComment.onclick=function(){var txtValue=thisClass.publishCommentTextArea.value;""!=txtValue.replace(/\s/g,"")&&thisClass.addComment()},btnAddComment.innerHTML=base.dictionary.translate("Publish"),this.publishCommentButtons.appendChild(btnAddComment),divTextAreaContainer.commentsTextArea=this.publishCommentTextArea,divTextAreaContainer.commentsBtnAddComment=btnAddComment,divTextAreaContainer.commentsBtnAddCommentToInstant=this.btnAddCommentToInstant,this.divPublishComment.appendChild(divEntry)},addComment:function(){var thisClass=this,txtValue=paella.AntiXSS.htmlEscape(thisClass.publishCommentTextArea.value),now=new Date;this.comments.push({id:base.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"normal",value:txtValue,created:now});var data={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},data,function(response,status){status&&thisClass.loadContent()})},addReply:function(annotationID,domNodeId){var thisClass=this,textArea=document.getElementById(domNodeId),txtValue=paella.AntiXSS.htmlEscape(textArea.value),now=new Date;paella.keyManager.enabled=!0,this.comments.push({id:base.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"reply",parent:annotationID,value:txtValue,created:now});var data={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},data,function(response,status){status&&thisClass.reloadComments()})},reloadComments:function(){var thisClass=this;thisClass.commentsTree=[],thisClass.comments=[],this.divComments.innerHTML="",paella.data.read("comments",{id:paella.initDelegate.getId()},function(data){var i,valueText,comment;if(data&&"object"==typeof data&&data.allComments&&data.allComments.length>0){thisClass.comments=data.allComments;var tempDict={};for(i=0;i<data.allComments.length;++i)valueText=data.allComments[i].value,"reply"!==data.allComments[i].mode&&(comment={},comment.id=data.allComments[i].id,comment.userName=data.allComments[i].userName,comment.mode=data.allComments[i].mode,comment.value=valueText,comment.created=data.allComments[i].created,comment.replies=[],thisClass.commentsTree.push(comment),tempDict[comment.id]=thisClass.commentsTree.length-1);for(i=0;i<data.allComments.length;++i)if(valueText=data.allComments[i].value,"reply"===data.allComments[i].mode){comment={},comment.id=data.allComments[i].id,comment.userName=data.allComments[i].userName,comment.mode=data.allComments[i].mode,comment.value=valueText,comment.created=data.allComments[i].created;var index=tempDict[data.allComments[i].parent];thisClass.commentsTree[index].replies.push(comment)}thisClass.displayComments()}})},displayComments:function(){for(var thisClass=this,i=0;i<thisClass.commentsTree.length;++i){var comment=thisClass.commentsTree[i],e=thisClass.createACommentEntry(comment);thisClass.divComments.appendChild(e)}},createACommentEntry:function(comment){var divEntry,thisClass=this,rootID=this.divPublishComment.id+"_entry"+comment.id;divEntry=document.createElement("div"),divEntry.id=rootID,divEntry.className="comments_entry";var divSil;divSil=document.createElement("img"),divSil.className="comments_entry_silhouette",divSil.id=rootID+"_silhouette",divEntry.appendChild(divSil);var divCommentContainer;divCommentContainer=document.createElement("div"),divCommentContainer.className="comments_entry_container",divCommentContainer.id=rootID+"_comment_container",divEntry.appendChild(divCommentContainer);var divCommentMetadata;divCommentMetadata=document.createElement("div"),divCommentMetadata.id=rootID+"_comment_metadata",divCommentContainer.appendChild(divCommentMetadata);var datePublish="";if(comment.created){var dateToday=new Date,dateComment=paella.utils.timeParse.matterhornTextDateToDate(comment.created);datePublish=paella.utils.timeParse.secondsToText((dateToday.getTime()-dateComment.getTime())/1e3)}var divCommentValue;divCommentValue=document.createElement("div"),divCommentValue.id=rootID+"_comment_value",divCommentValue.className="comments_entry_comment",divCommentContainer.appendChild(divCommentValue),divCommentValue.innerHTML=comment.value;var divCommentReply=document.createElement("div");if(divCommentReply.id=rootID+"_comment_reply",divCommentContainer.appendChild(divCommentReply),paella.data.read("userInfo",{username:comment.userName},function(data){if(data){divSil.src=data.avatar;var headLine="<span class='comments_entry_username'>"+data.name+" "+data.lastname+"</span>";headLine+="<span class='comments_entry_datepublish'>"+datePublish+"</span>",divCommentMetadata.innerHTML=headLine}}),1==this.canPublishAComment){var btnRplyComment=document.createElement("div");btnRplyComment.className="reply_button",btnRplyComment.innerHTML=base.dictionary.translate("Reply"),btnRplyComment.id=rootID+"_comment_reply_button",btnRplyComment.onclick=function(){var e=thisClass.createAReplyEntry(comment.id);this.style.display="none",this.parentElement.parentElement.appendChild(e)},divCommentReply.appendChild(btnRplyComment)}for(var i=0;i<comment.replies.length;++i){var e=thisClass.createACommentReplyEntry(comment.id,comment.replies[i]);divCommentContainer.appendChild(e)}return divEntry},createACommentReplyEntry:function(parentID,comment){var divEntry,rootID=this.divPublishComment.id+"_entry_"+parentID+"_reply_"+comment.id;divEntry=document.createElement("div"),divEntry.id=rootID,divEntry.className="comments_entry";var divSil;divSil=document.createElement("img"),divSil.className="comments_entry_silhouette",divSil.id=rootID+"_silhouette",divEntry.appendChild(divSil);var divCommentContainer;divCommentContainer=document.createElement("div"),divCommentContainer.className="comments_entry_container",divCommentContainer.id=rootID+"_comment_container",divEntry.appendChild(divCommentContainer);var divCommentMetadata;divCommentMetadata=document.createElement("div"),divCommentMetadata.id=rootID+"_comment_metadata",divCommentContainer.appendChild(divCommentMetadata);var datePublish="";if(comment.created){var dateToday=new Date,dateComment=paella.utils.timeParse.matterhornTextDateToDate(comment.created);datePublish=paella.utils.timeParse.secondsToText((dateToday.getTime()-dateComment.getTime())/1e3)}var divCommentValue;return divCommentValue=document.createElement("div"),divCommentValue.id=rootID+"_comment_value",divCommentValue.className="comments_entry_comment",divCommentContainer.appendChild(divCommentValue),divCommentValue.innerHTML=comment.value,paella.data.read("userInfo",{username:comment.userName},function(data){if(data){divSil.src=data.avatar;var headLine="<span class='comments_entry_username'>"+data.name+" "+data.lastname+"</span>";headLine+="<span class='comments_entry_datepublish'>"+datePublish+"</span>",divCommentMetadata.innerHTML=headLine}}),divEntry},createAReplyEntry:function(annotationID){var divEntry,thisClass=this,rootID=this.divPublishComment.id+"_entry_"+annotationID+"_reply";divEntry=document.createElement("div"),divEntry.id=rootID+"_entry",divEntry.className="comments_entry";var divSil;divSil=document.createElement("img"),divSil.className="comments_entry_silhouette",divSil.style.width="48px",divSil.id=rootID+"_silhouette",divSil.src=paella.initDelegate.initParams.accessControl.userData.avatar,divEntry.appendChild(divSil);var divCommentContainer;divCommentContainer=document.createElement("div"),divCommentContainer.className="comments_entry_container comments_reply_container",divCommentContainer.id=rootID+"_reply_container",divEntry.appendChild(divCommentContainer);var textArea;textArea=document.createElement("textArea"),textArea.onclick=function(){paella.keyManager.enabled=!1},textArea.draggable=!1,textArea.id=rootID+"_textarea",divCommentContainer.appendChild(textArea),this.publishCommentButtons=document.createElement("div"),this.publishCommentButtons.id=rootID+"_buttons_area",divCommentContainer.appendChild(this.publishCommentButtons);var btnAddComment;return btnAddComment=document.createElement("button"),btnAddComment.id=rootID+"_btnAddComment",btnAddComment.className="publish",btnAddComment.onclick=function(){var txtValue=textArea.value;""!=txtValue.replace(/\s/g,"")&&thisClass.addReply(annotationID,textArea.id)},btnAddComment.innerHTML=base.dictionary.translate("Reply"),this.publishCommentButtons.appendChild(btnAddComment),divEntry}}),paella.plugins.commentsPlugin=new paella.plugins.CommentsPlugin,Class("paella.plugins.DescriptionPlugin",paella.TabBarPlugin,{getSubclass:function(){return"showDescriptionTabBar"},getName:function(){return"es.upv.paella.descriptionPlugin"},getTabName:function(){return"Descripción"},domElement:null,buildContent:function(domElement){this.domElement=domElement,this.loadContent()},action:function(){this.loadContent()},loadContent:function(){var container=this.domElement;container.innerHTML="Loading...",new paella.Timer(function(){container.innerHTML="Loading done"},2e3)}}),paella.plugins.descriptionPlugin=new paella.plugins.DescriptionPlugin,Class("paella.plugins.SnapShotsEditorPlugin",paella.editor.TrackPlugin,{tracks:null,selectedTrackItem:null,highResFrames:null,getIndex:function(){return 0},checkEnabled:function(onSuccess){var frames=paella.initDelegate.initParams.videoLoader.frameList;onSuccess(null!=frames)},setup:function(){if("es"==base.dictionary.currentLanguage()){var esDict={Slides:"Diapositivas",Slide:"Diapositiva"};base.dictionary.addDictionary(esDict)}},showHiResFrame:function(url){var frameRoot=document.createElement("div"),frame=document.createElement("div"),hiResImage=document.createElement("img");hiResImage.className="frameHiRes",hiResImage.setAttribute("src",url),hiResImage.setAttribute("style","width: 100%;"),$(frame).append(hiResImage),$(frameRoot).append(frame),frameRoot.setAttribute("style","display: table;"),frame.setAttribute("style","display: table-cell; vertical-align:middle;"),overlayContainer=paella.player.videoContainer.overlayContainer;var streams=paella.initDelegate.initParams.videoLoader.streams;1==streams.length?overlayContainer.addElement(frameRoot,overlayContainer.getMasterRect()):streams.length>=2&&overlayContainer.addElement(frameRoot,overlayContainer.getSlaveRect()),overlayContainer.enableBackgroundMode(),this.hiResFrame=frameRoot},removeHiResFrame:function(){overlayContainer=paella.player.videoContainer.overlayContainer,overlayContainer.removeElement(this.hiResFrame),overlayContainer.disableBackgroundMode()},createTrackContent:function(frameItem,numSlide){return onMouseOverScript="paella.plugins.snapShotsEditorPlugin.showHiResFrame('"+frameItem.url+"');",onMouseOutScript="paella.plugins.snapShotsEditorPlugin.removeHiResFrame();",'<div class="snapShotsEditorPluginBox" onmouseover="'+onMouseOverScript+'" onmouseout="'+onMouseOutScript+'">	<img class="snapShotsEditorPluginImage" src="'+frameItem.thumb+'"/>	<div class="snapShotsEditorPluginSliteText">'+base.dictionary.translate("Slide")+" "+numSlide+"</div></div>"},getTrackItems:function(){if(null==this.tracks){this.tracks=[];var frames=paella.initDelegate.initParams.videoLoader.frameList;if(frames){for(var frameItem,s,e,d,numFrame=0,keys=Object.keys(paella.initDelegate.initParams.videoLoader.frameList);numFrame<keys.length-1;numFrame++)frameItem=frames[keys[numFrame]],s=parseInt(keys[numFrame]),e=parseInt(keys[numFrame+1]),d=e-s,this.tracks.push({s:s,e:e,d:d,name:this.createTrackContent(frameItem,numFrame+1)});keys.length>0&&(frameItem=frames[keys[numFrame]],s=parseInt(keys[numFrame]),e=paella.player.videoContainer.duration(),d=e-s,this.tracks.push({s:s,e:e,d:d,name:this.createTrackContent(frameItem,numFrame+1)}))}}return this.tracks},getTools:function(){return[]},onToolSelected:function(){},getTrackUniqueId:function(){var newId=-1;if(0==this.tracks.length)return 1;for(var i=0;i<this.tracks.length;++i)newId<=this.tracks[i].id&&(newId=this.tracks[i].id+1);return newId},getName:function(){return"es.upv.paella.editor.snapShotsEditorPlugin"},getTrackName:function(){return base.dictionary.translate("Slides")},getColor:function(){return"rgb(159, 166, 88)"},getTextColor:function(){return"rgb(90,90,90)"},allowEditContent:function(){return!1},allowDrag:function(){return!1},allowResize:function(){return!1},getTrackItem:function(id){for(var i=0;i<this.tracks.length;++i)if(this.tracks[i].id==id)return this.tracks[i]},onSave:function(success){success(!0)}}),paella.plugins.snapShotsEditorPlugin=new paella.plugins.SnapShotsEditorPlugin,Class("paella.editor.ToolStatusPlugin",paella.editor.RightBarPlugin,{currentTrack:null,currentTextField:null,trackItemContainer:null,selectedColor:"rgb(255, 255, 236)",initialize:function(){if(this.parent(),"es"==base.dictionary.currentLanguage()){var esDict={Tool:"Herramienta","Selected tool":"Herramienta seleccionada","this track does not contain any item":"esta pista no contiene ningún elemento","Click on timeline outside any track to select current playback time.":"Haz clic en el fondo de la línea de tiempo para establecer el instante actual de reproducción","Quick help":"Ayuda rápida",item:"elemento",items:"elementos",from:"desde",to:"hasta"};base.dictionary.addDictionary(esDict)}},getIndex:function(){return 1e4},getName:function(){return"es.upv.paella.editor.toolStatusPlugin"},getTabName:function(){return base.dictionary.translate("Tool")},getContent:function(){this.currentTextField=null;var elem=document.createElement("div");if(this.currentTrack){var plugin=paella.pluginManager.getPlugin(this.currentTrack.getName());elem.innerHTML="<h6>"+base.dictionary.translate("Tool")+": "+base.dictionary.translate(this.currentTrack.getTrackName())+"</h6>";var trackList=this.currentTrack.getTrackItems(),trackContainer=document.createElement("div");if(trackContainer.className="editorPluginToolStatus_trackItemList",this.trackItemContainer=trackContainer,plugin.buildToolTabContent(trackContainer),0==trackContainer.childNodes.length)for(var i=0;i<trackList.length;++i)this.addTrackData(trackContainer,trackList[i]);elem.appendChild(trackContainer)}else elem.innerHTML="<h6>"+base.dictionary.translate("Tool")+": "+base.dictionary.translate("Selection")+"</h6>";return this.addToolHelp(elem),elem},addTrackData:function(parent,track){var trackData=document.createElement("div"),trackTime=document.createElement("div"),duration=Math.round(100*(track.e-track.s))/100;if(trackTime.innerHTML=base.dictionary.translate("from")+" "+paella.utils.timeParse.secondsToTime(track.s)+" "+base.dictionary.translate("to")+" "+paella.utils.timeParse.secondsToTime(track.e)+", "+duration+" sec",trackData.appendChild(trackTime),track.content){var content=paella.AntiXSS.htmlUnescape(track.content);this.addTrackContent(trackData,track.id,content,track.s,track.e)}parent.appendChild(trackData)},addTrackContent:function(parent,id,content,start,end){var contentElem=null,thisClass=this;if(this.currentTrack.allowEditContent()){contentElem=document.createElement("input"),contentElem.setAttribute("type","text"),contentElem.setAttribute("id","trackContentEditor_"+id),contentElem.setAttribute("value",content),contentElem.trackData={id:id,content:content,s:start,e:end},contentElem.plugin=this.currentTrack,$(contentElem).change(function(){this.plugin.onTrackContentChanged(this.trackData.id,$(this).val()),paella.editor.instance.bottomBar.timeline.rebuildTrack(this.plugin.getName())}),$(contentElem).click(function(){thisClass.onFocusChanged(this,this.plugin,this.trackData)}),$(contentElem).focus(function(){thisClass.onFocusChanged(this,this.plugin,this.trackData)});var selectedTrackItemId=-1;try{selectedTrackItemId=this.currentTrack.trackInfo.trackData.id}catch(e){}selectedTrackItemId==id&&(this.currentTextField=contentElem,this.currentTextField.style.backgroundColor=this.selectedColor)}else contentElem=document.createElement("input"),contentElem.setAttribute("type","text"),contentElem.setAttribute("id",id),contentElem.setAttribute("disabled","disabled"),contentElem.setAttribute("style","color:rgb(119, 119, 119)"),contentElem.setAttribute("value",content);parent.appendChild(contentElem)},onFocusChanged:function(field,plugin,trackData){this.currentTextField&&(this.currentTextField.style.backgroundColor="#fff"),field.style.backgroundColor=this.selectedColor,paella.editor.instance.bottomBar.timeline.focusTrackListItem(plugin.getName(),trackData.id),this.currentTextField=field;var time=trackData.e;$(document).trigger(paella.events.seekToTime,{time:time})},onLoadFinished:function(){this.currentTextField&&(this.trackItemContainer.scrollTop=$(this.currentTextField).position().top)},addToolHelp:function(parent){var helpText="";if(helpText=this.currentTrack?this.currentTrack.contextHelpString():base.dictionary.translate("Click on timeline outside any track to select current playback time."),""!=helpText){var helpElem=document.createElement("div");helpElem.className="editorPluginToolStatusHelp",parent.appendChild(helpElem),helpElem.innerHTML="<strong>"+base.dictionary.translate("Quick help")+": </strong>"+helpText}},onTrackSelected:function(newTrack){this.currentTrack=newTrack}}),new paella.editor.ToolStatusPlugin,Class("paella.plugins.extendedTabAdapterPlugin",paella.ButtonPlugin,{currentUrl:null,currentMaster:null,currentSlave:null,availableMasters:[],availableSlaves:[],showWidthRes:null,getAlignment:function(){return"right"},getSubclass:function(){return"extendedTabAdapterPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 550},getName:function(){return"es.upv.paella.extendedTabAdapterPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Extended Tab Adapter")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(domElement){domElement.appendChild(paella.extendedAdapter.bottomContainer)}}),new paella.plugins.extendedTabAdapterPlugin,Class("paella.plugins.FootPrintsPlugin",paella.ButtonPlugin,{INTERVAL_LENGTH:5,inPosition:0,outPosition:0,canvas:null,footPrintsTimer:null,footPrintsData:{},getAlignment:function(){return"right"},getSubclass:function(){return"footPrints"},getIndex:function(){return 590},getDefaultToolTip:function(){return base.dictionary.translate("Show statistics")},getName:function(){return"es.upv.paella.footprintsPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},setup:function(){var thisClass=this;switch(paella.events.bind(paella.events.timeUpdate,function(){thisClass.onTimeUpdate()}),this.config.skin){case"custom":this.fillStyle=this.config.fillStyle,this.strokeStyle=this.config.strokeStyle;break;case"dark":this.fillStyle="#727272",this.strokeStyle="#424242";break;case"light":this.fillStyle="#d8d8d8",this.strokeStyle="#ffffff";break;default:this.fillStyle="#d8d8d8",this.strokeStyle="#ffffff"}},checkEnabled:function(onSuccess){onSuccess(!paella.player.isLiveStream())},buildContent:function(domElement){var container=document.createElement("div");container.className="footPrintsContainer",this.canvas=document.createElement("canvas"),this.canvas.id="footPrintsCanvas",this.canvas.className="footPrintsCanvas",container.appendChild(this.canvas),domElement.appendChild(container)},onTimeUpdate:function(){var videoCurrentTime=Math.round(paella.player.videoContainer.currentTime()+paella.player.videoContainer.trimStart());this.inPosition<=videoCurrentTime&&videoCurrentTime<=this.inPosition+this.INTERVAL_LENGTH?(this.outPosition=videoCurrentTime,this.inPosition+this.INTERVAL_LENGTH===this.outPosition&&(this.trackFootPrint(this.inPosition,this.outPosition),this.inPosition=this.outPosition)):(this.trackFootPrint(this.inPosition,this.outPosition),this.inPosition=videoCurrentTime,this.outPosition=videoCurrentTime)},trackFootPrint:function(inPosition,outPosition){var data={"in":inPosition,out:outPosition};paella.data.write("footprints",{id:paella.initDelegate.getId()},data)},willShowContent:function(){var thisClass=this;this.loadFootprints(),this.footPrintsTimer=new base.Timer(function(){thisClass.loadFootprints()},5e3),this.footPrintsTimer.repeat=!0},didHideContent:function(){null!=this.footPrintsTimer&&(this.footPrintsTimer.cancel(),this.footPrintsTimer=null)},loadFootprints:function(){var thisClass=this;paella.data.read("footprints",{id:paella.initDelegate.getId()},function(data){for(var footPrintsData={},duration=Math.floor(paella.player.videoContainer.duration()),trimStart=Math.floor(paella.player.videoContainer.trimStart()),lastPosition=-1,lastViews=0,i=0;i<data.length;i++)if(position=data[i].position-trimStart,position<duration){if(views=data[i].views,position-1!=lastPosition)for(var j=lastPosition+1;j<position;j++)footPrintsData[j]=lastViews;footPrintsData[position]=views,lastPosition=position,lastViews=views}thisClass.drawFootPrints(footPrintsData)})},drawFootPrints:function(footPrintsData){if(this.canvas){var i,duration=Object.keys(footPrintsData).length,ctx=this.canvas.getContext("2d"),h=20;for(i=0;duration>i;++i)footPrintsData[i]>h&&(h=footPrintsData[i]);for(this.canvas.setAttribute("width",duration),this.canvas.setAttribute("height",h),ctx.clearRect(0,0,this.canvas.width,this.canvas.height),ctx.fillStyle=this.fillStyle,ctx.strokeStyle=this.strokeStyle,ctx.lineWidth=2,ctx.webkitImageSmoothingEnabled=!1,ctx.mozImageSmoothingEnabled=!1,i=0;duration-1>i;++i)ctx.beginPath(),ctx.moveTo(i,h),ctx.lineTo(i,h-footPrintsData[i]),ctx.lineTo(i+1,h-footPrintsData[i+1]),ctx.lineTo(i+1,h),ctx.closePath(),ctx.fill(),ctx.beginPath(),ctx.moveTo(i,h-footPrintsData[i]),ctx.lineTo(i+1,h-footPrintsData[i+1]),ctx.closePath(),ctx.stroke()}}}),paella.plugins.footPrintsPlugin=new paella.plugins.FootPrintsPlugin,Class("paella.plugins.FrameControlPlugin",paella.ButtonPlugin,{frames:null,highResFrames:null,currentFrame:null,navButtons:null,buttons:[],contx:null,_img:null,_searchTimer:null,_searchTimerTime:250,getAlignment:function(){return"right"},getSubclass:function(){return"frameControl"},getIndex:function(){return 510},getMinWindowSize:function(){return 200},getName:function(){return"es.upv.paella.frameControlPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},getDefaultToolTip:function(){return base.dictionary.translate("Navigate by slides")},checkEnabled:function(onSuccess){onSuccess(null==paella.initDelegate.initParams.videoLoader.frameList?!1:0===paella.initDelegate.initParams.videoLoader.frameList.length?!1:0==Object.keys(paella.initDelegate.initParams.videoLoader.frameList).length?!1:!0)},setup:function(){var oldClassName,jumpAtItem,thisClass=this,blockCounter=1,correctJump=0,selectedItem=-1;Keys={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40},$(this.button).keyup(function(event){var visibleItems=Math.floor(thisClass.contx.offsetWidth/100),rest=thisClass.buttons.length%visibleItems,blocks=Math.floor(thisClass.buttons.length/visibleItems);thisClass.isPopUpOpen()&&(event.keyCode==Keys.Left?selectedItem>0&&(thisClass.buttons[selectedItem].className=oldClassName,selectedItem--,blockCounter>blocks&&(correctJump=visibleItems-rest),jumpAtItem=visibleItems*(blockCounter-1)-1-correctJump,selectedItem==jumpAtItem&&0!=selectedItem&&(thisClass.navButtons.left.scrollContainer.scrollLeft-=105*visibleItems,--blockCounter),this.hiResFrame&&thisClass.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||thisClass.buttons[selectedItem].frameControl.onMouseOver(null,thisClass.buttons[selectedItem].frameData),oldClassName=thisClass.buttons[selectedItem].className,thisClass.buttons[selectedItem].className="frameControlItem selected"):event.keyCode==Keys.Right?selectedItem<thisClass.buttons.length-1&&(selectedItem>=0&&(thisClass.buttons[selectedItem].className=oldClassName),selectedItem++,1==blockCounter&&(correctJump=0),jumpAtItem=visibleItems*blockCounter-correctJump,selectedItem==jumpAtItem&&(thisClass.navButtons.left.scrollContainer.scrollLeft+=105*visibleItems,++blockCounter),this.hiResFrame&&thisClass.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||thisClass.buttons[selectedItem].frameControl.onMouseOver(null,thisClass.buttons[selectedItem].frameData),oldClassName=thisClass.buttons[selectedItem].className,thisClass.buttons[selectedItem].className="frameControlItem selected"):event.keyCode==Keys.Return?(thisClass.buttons[selectedItem].frameControl.onClick(null,thisClass.buttons[selectedItem].frameData),oldClassName="frameControlItem current"):event.keyCode==Keys.Esc&&thisClass.removeHiResFrame())})},buildContent:function(domElement){var thisClass=this;this.frames=[];var container=document.createElement("div");container.className="frameControlContainer",thisClass.contx=container;var content=document.createElement("div");content.className="frameControlContent",this.navButtons={left:document.createElement("div"),right:document.createElement("div")},this.navButtons.left.className="frameControl navButton left",this.navButtons.right.className="frameControl navButton right";var frame=this.getFrame(null);domElement.appendChild(this.navButtons.left),domElement.appendChild(container),container.appendChild(content),domElement.appendChild(this.navButtons.right),this.navButtons.left.scrollContainer=container,$(this.navButtons.left).click(function(){this.scrollContainer.scrollLeft-=100}),this.navButtons.right.scrollContainer=container,$(this.navButtons.right).click(function(){this.scrollContainer.scrollLeft+=100}),content.appendChild(frame);var itemWidth=$(frame).outerWidth(!0);content.innerHTML="",$(window).mousemove(function(event){($(content).offset().top>event.pageY||!$(content).is(":visible")||$(content).offset().top+$(content).height()<event.pageY)&&This.removeHiResFrame()});var numFrames,frames=paella.initDelegate.initParams.videoLoader.frameList;if(frames){var framesKeys=Object.keys(frames);numFrames=framesKeys.length,framesKeys.map(function(i){return parseInt(i,10)}).sort(function(a,b){return a-b}).forEach(function(key){var frameItem=thisClass.getFrame(frames[key]);content.appendChild(frameItem,"frameContrlItem_"+numFrames),thisClass.frames.push(frameItem)})}$(content).css({width:numFrames*itemWidth+"px"});var This=this;paella.events.bind(paella.events.setTrim,function(event,params){This.isFrameVisible(params.trimEnabled,params.trimStart,params.trimEnd)}),paella.events.bind(paella.events.timeupdate,function(event,params){This.onTimeUpdate(params.currentTime)})},showHiResFrame:function(url){var thisClass=this,frameRoot=document.createElement("div"),frame=document.createElement("div"),hiResImage=document.createElement("img");thisClass._img=hiResImage,hiResImage.className="frameHiRes",hiResImage.setAttribute("src",url),hiResImage.setAttribute("style","width: 100%;"),$(frame).append(hiResImage),$(frameRoot).append(frame),frameRoot.setAttribute("style","display: table;"),frame.setAttribute("style","display: table-cell; vertical-align:middle;"),overlayContainer=paella.player.videoContainer.overlayContainer;var streams=paella.initDelegate.initParams.videoLoader.streams;1==streams.length?overlayContainer.addElement(frameRoot,overlayContainer.getMasterRect()):streams.length>=2&&overlayContainer.addElement(frameRoot,overlayContainer.getSlaveRect()),overlayContainer.enableBackgroundMode(),this.hiResFrame=frameRoot},removeHiResFrame:function(){var thisClass=this;overlayContainer=paella.player.videoContainer.overlayContainer,this.hiResFrame&&overlayContainer.removeElement(this.hiResFrame),overlayContainer.disableBackgroundMode(),thisClass._img=null},isFrameVisible:function(trimEnabled,trimStart,trimEnd){var i;if(trimEnabled)for(i=0;i<this.frames.length;++i){var frameElem=this.frames[i],frameData=frameElem.frameData;frameData.time<trimStart?this.frames.length>i+1&&this.frames[i+1].frameData.time>trimStart?$(frameElem).show():$(frameElem).hide():frameData.time>trimEnd?$(frameElem).hide():$(frameElem).show()}else for(i=0;i<this.frames.length;++i)$(this.frames[i]).show()},getFrame:function(frameData,id){var frame=document.createElement("div");if(frame.className="frameControlItem",id&&(frame.id=id),frameData){this.buttons.push(frame),frame.frameData=frameData,frame.frameControl=this,image=frameData.thumb?frameData.thumb:frameData.url;var labelTime=paella.utils.timeParse.secondsToTime(frameData.time);frame.innerHTML='<img src="'+image+'" alt="" class="frameControlImage" title="'+labelTime+'" aria-label="'+labelTime+'"></img>',base.userAgent.browser.IsMobileVersion||$(frame).mouseover(function(event){this.frameControl.onMouseOver(event,this.frameData)}),$(frame).mouseout(function(event){this.frameControl.onMouseOut(event,this.frameData)}),$(frame).click(function(event){this.frameControl.onClick(event,this.frameData)
})}return frame},onMouseOver:function(event,frameData){var thisClass=this,frames=paella.initDelegate.initParams.videoLoader.frameList,frame=frames[frameData.time];if(frame){var image=frame.url;thisClass._img?thisClass._img.setAttribute("src",image):this.showHiResFrame(image)}null!=thisClass._searchTimer&&thisClass._searchTimer.cancel()},onMouseOut:function(){var thisClass=this;thisClass._searchTimer=new base.Timer(function(){thisClass.removeHiResFrame()},thisClass._searchTimerTime)},onClick:function(event,frameData){paella.events.trigger(paella.events.seekToTime,{time:frameData.time+1})},onTimeUpdate:function(currentTime){for(var frame=null,i=0;i<this.frames.length&&(this.frames[i].frameData&&this.frames[i].frameData.time<=currentTime);++i)frame=this.frames[i];this.currentFrame!=frame&&(this.currentFrame&&(this.currentFrame.className="frameControlItem"),this.currentFrame=frame,this.currentFrame.className="frameControlItem current")}}),paella.plugins.frameControlPlugin=new paella.plugins.FrameControlPlugin,Class("paella.plugins.FullScreenPlugin",paella.ButtonPlugin,{_reload:null,getIndex:function(){return 551},getAlignment:function(){return"right"},getSubclass:function(){return"showFullScreenButton"},getName:function(){return"es.upv.paella.fullScreenButtonPlugin"},checkEnabled:function(onSuccess){var enabled=paella.player.checkFullScreenCapability();base.userAgent.browser.IsMobileVersion&&(enabled=paella.player.videoContainer.isMonostream&&enabled),onSuccess(enabled)},getDefaultToolTip:function(){return base.dictionary.translate("Go Fullscreen")},setup:function(){var thisClass=this;this._reload=this.config.reloadOnFullscreen?this.config.reloadOnFullscreen.enabled:!1,this._keepUserQuality=this.config.reloadOnFullscreen?this.config.reloadOnFullscreen.keepUserSelection:!0,paella.events.bind(paella.events.enterFullscreen,function(){thisClass.onEnterFullscreen()}),paella.events.bind(paella.events.exitFullscreen,function(){thisClass.onExitFullscreen()})},action:function(){var self=this;if(paella.player.isFullScreen())paella.player.exitFullScreen();else{if((base.userAgent.browser.IsMobileVersion||base.userAgent.browser.Explorer)&&window.location!==window.parent.location){var url=window.location.href;paella.events.trigger(paella.events.pause);var sec=paella.player.videoContainer.currentTime(),obj=self.secondsToHours(sec);return void window.open(url+"&time="+obj.h+"h"+obj.m+"m"+obj.s+"s&autoplay=true")}paella.player.goFullScreen()}setTimeout(function(){self._reload&&paella.player.reloadVideos()},1e3)},secondsToHours:function(sec_numb){var hours=Math.floor(sec_numb/3600),minutes=Math.floor((sec_numb-3600*hours)/60),seconds=Math.floor(sec_numb-3600*hours-60*minutes),obj={};return 10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),10>seconds&&(seconds="0"+seconds),obj.h=hours,obj.m=minutes,obj.s=seconds,obj},onEnterFullscreen:function(){this.setToolTip(base.dictionary.translate("Exit Fullscreen")),this.button.className=this.getButtonItemClass(!0)},onExitFullscreen:function(){this.setToolTip(base.dictionary.translate("Go Fullscreen")),this.button.className=this.getButtonItemClass(!1)},getButtonItemClass:function(selected){return"buttonPlugin "+this.getAlignment()+" "+this.getSubclass()+(selected?" active":"")}}),paella.plugins.fullScreenPlugin=new paella.plugins.FullScreenPlugin,Class("paella.plugins.HelpPlugin",paella.ButtonPlugin,{getIndex:function(){return 509},getAlignment:function(){return"right"},getSubclass:function(){return"helpButton"},getName:function(){return"es.upv.paella.helpPlugin"},getMinWindowSize:function(){return 650},getDefaultToolTip:function(){return base.dictionary.translate("Show help")+" ("+base.dictionary.translate("Paella version:")+" "+paella.version+")"},checkEnabled:function(onSuccess){var availableLangs=this.config&&this.config.langs||[];onSuccess(availableLangs.length>0)},action:function(){var mylang=base.dictionary.currentLanguage(),availableLangs=this.config&&this.config.langs||[],idx=availableLangs.indexOf(mylang);0>idx&&(idx=0),paella.messageBox.showFrame("resources/style/help/help_"+availableLangs[idx]+".html")}}),paella.plugins.helpPlugin=new paella.plugins.HelpPlugin,Class("paella.LiveStreamIndicator",paella.VideoOverlayButtonPlugin,{isEditorVisible:function(){return null!=paella.editor.instance},getIndex:function(){return 10},getSubclass:function(){return"liveIndicator"},getAlignment:function(){return"right"},getDefaultToolTip:function(){return base.dictionary.translate("This video is a live stream")},checkEnabled:function(onSuccess){onSuccess(paella.player.isLiveStream())},setup:function(){},action:function(){paella.messageBox.showMessage(base.dictionary.translate("Live streaming mode: This is a live video, so, some capabilities of the player are disabled"))},getName:function(){return"es.upv.paella.liveStramingIndicatorPlugin"}}),paella.plugins.liveStreamIndicator=new paella.LiveStreamIndicator,Class("paella.plugins.MultipleQualitiesPlugin",paella.ButtonPlugin,{currentUrl:null,currentMaster:null,currentSlave:null,availableMasters:[],availableSlaves:[],showWidthRes:null,_domElement:null,getAlignment:function(){return"right"},getSubclass:function(){return"showMultipleQualitiesPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 550},getName:function(){return"es.upv.paella.multipleQualitiesPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Change video quality")},checkEnabled:function(onSuccess){function sortfunc(a,b){var ia=parseInt(a.res.h),ib=parseInt(b.res.h);return ib>ia?-1:ia>ib?1:0}var key,j;this.currentMaster=paella.player.videoContainer.currentMasterVideoData,this.currentSlave=paella.player.videoContainer.currentSlaveVideoData;var minVerticalRes=parseInt(this.config.minVerticalRes),maxVerticalRes=parseInt(this.config.maxVerticalRes),allMasterSources=paella.player.videoContainer.masterVideoData.sources;for(key in allMasterSources)for(j=0;j<allMasterSources[key].length;++j)if(allMasterSources[key][j].type==this.currentMaster.type){if(0==isNaN(minVerticalRes)&&parseInt(allMasterSources[key][j].res.h)<minVerticalRes)continue;if(0==isNaN(maxVerticalRes)&&parseInt(allMasterSources[key][j].res.h)>maxVerticalRes)continue;this.availableMasters.push(allMasterSources[key][j])}if(this.currentSlave){var allSlaveSources=paella.player.videoContainer.slaveVideoData.sources;for(key in allSlaveSources)for(j=0;j<allSlaveSources[key].length;++j)if(allSlaveSources[key][j].type==this.currentSlave.type){if(0==isNaN(minVerticalRes)&&parseInt(allSlaveSources[key][j].res.h)<minVerticalRes)continue;if(0==isNaN(maxVerticalRes)&&parseInt(allSlaveSources[key][j].res.h)>maxVerticalRes)continue;this.availableSlaves.push(allSlaveSources[key][j])}}this.availableMasters.sort(sortfunc),this.availableSlaves.sort(sortfunc);var isenabled=this.availableMasters.length>1||this.availableSlaves.length>1;onSuccess(isenabled)},setup:function(){var self=this;if(paella.events.bind(paella.events.singleVideoReady,function(){self.setQualityLabel()}),"es"==base.dictionary.currentLanguage()){var esDict={Presenter:"Presentador",Slide:"Diapositiva"};base.dictionary.addDictionary(esDict)}this.setQualityLabel(),self.showWidthRes=void 0!==self.config.showWidthRes?self.config.showWidthRes:!0},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(domElement){var self=this;self._domElement=domElement;var w,h,d,e,percen1,percen2,reso2,act_percen,b=0;if(percen1=100/this.availableMasters.length,percen2=100/this.availableSlaves.length,this.availableMasters.length>=this.availableSlaves.length){act_percen=percen2;for(var i=0;i<this.availableMasters.length;i++)w=this.availableMasters[i].res.w,h=this.availableMasters[i].res.h,this.availableSlaves.length>0&&(act_percen>percen1*(i+1)?(d=this.availableSlaves[b].res.w,e=this.availableSlaves[b].res.h,reso2=d+"x"+e):(act_percen=percen2+act_percen,d=this.availableSlaves[b].res.w,e=this.availableSlaves[b].res.h,reso2=d+"x"+e,b++)),domElement.appendChild(self.showWidthRes?this.getItemButton(w+"x"+h,w+"x"+h,reso2):this.getItemButton(h+"p",w+"x"+h,reso2))}else{act_percen=percen1;for(var z=0;z<this.availableSlaves.length;z++)w=this.availableSlaves[z].res.w,h=this.availableSlaves[z].res.h,this.availableMasters.length>0&&(act_percen>percen2*(z+1)?(d=this.availableMasters[b].res.w,e=this.availableMasters[b].res.h,reso2=d+"x"+e):(act_percen=percen1+act_percen,d=this.availableMasters[b].res.w,e=this.availableMasters[b].res.h,reso2=d+"x"+e,b++)),domElement.appendChild(self.showWidthRes?this.getItemButton(w+"x"+h,w+"x"+h,reso2):this.getItemButton(h+"p",w+"x"+h,reso2))}},getItemButton:function(label,reso,reso2){var elem=document.createElement("div"),current=paella.player.videoContainer.currentMasterVideoData.res.w+"x"+paella.player.videoContainer.currentMasterVideoData.res.h;return elem.className=label==current?this.getButtonItemClass(label,!0):this.getButtonItemClass(label,!1),elem.id=label+"_button",elem.innerHTML=label,elem.data={label:label,reso:reso,reso2:reso2,plugin:this},$(elem).click(function(){this.data.plugin.onItemClick(this,this.data.label,this.data.reso,this.data.reso2)}),elem},onItemClick:function(button,label,reso,reso2){var self=this;paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()}),paella.player.reloadVideos(reso,reso2),this.setQualityLabel();for(var arr=self._domElement.children,i=0;i<arr.length;i++)arr[i].className=self.getButtonItemClass(i,!1);button.className=self.getButtonItemClass(i,!0)},setQualityLabel:function(){var res=paella.player.videoContainer.currentMasterVideoData.res;this.setText(res.h+"p")},getButtonItemClass:function(profileName,selected){return"multipleQualityItem "+profileName+(selected?" selected":"")}}),paella.plugins.multipleQualitiesPlugin=new paella.plugins.MultipleQualitiesPlugin,Class("paella.plugins.PlayPauseButtonPlugin",paella.ButtonPlugin,{playSubclass:"playButton",pauseSubclass:"pauseButton",getAlignment:function(){return"left"},getSubclass:function(){return this.playSubclass},getName:function(){return"es.upv.paella.playPauseButtonPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Play")},getIndex:function(){return 110},checkEnabled:function(onSuccess){onSuccess(!paella.player.isLiveStream())},setup:function(){var This=this;paella.player.playing()&&this.changeSubclass(This.pauseSubclass),paella.events.bind(paella.events.play,function(){This.changeSubclass(This.pauseSubclass),This.setToolTip(paella.dictionary.translate("Pause"))}),paella.events.bind(paella.events.pause,function(){This.changeSubclass(This.playSubclass),This.setToolTip(paella.dictionary.translate("Play"))})},action:function(){paella.events.trigger(paella.player.videoContainer.paused()?paella.events.play:paella.events.pause)}}),paella.plugins.playPauseButtonPlugn=new paella.plugins.PlayPauseButtonPlugin,Class("paella.plugins.PlayButtonOnScreen",paella.EventDrivenPlugin,{containerId:"paella_plugin_PlayButtonOnScreen",container:null,enabled:!0,isPlaying:!1,showIcon:!0,firstPlay:!1,checkEnabled:function(onSuccess){onSuccess(!paella.player.isLiveStream())},getIndex:function(){return 1010},getName:function(){return"es.upv.paella.playButtonOnScreenPlugin"},setup:function(){function repaintCanvas(){var width=jQuery(thisClass.container).innerWidth(),height=jQuery(thisClass.container).innerHeight();icon.width=width,icon.height=height;var iconSize=height>width?width/3:height/3,ctx=icon.getContext("2d");ctx.translate((width-iconSize)/2,(height-iconSize)/2),ctx.beginPath(),ctx.arc(iconSize/2,iconSize/2,iconSize/2,0,2*Math.PI,!0),ctx.closePath(),ctx.strokeStyle="white",ctx.lineWidth=10,ctx.stroke(),ctx.fillStyle="#8f8f8f",ctx.fill(),ctx.beginPath(),ctx.moveTo(iconSize/3,iconSize/4),ctx.lineTo(3*iconSize/4,iconSize/2),ctx.lineTo(iconSize/3,3*iconSize/4),ctx.lineTo(iconSize/3,iconSize/4),ctx.closePath(),ctx.fillStyle="white",ctx.fill(),ctx.stroke()}var thisClass=this;this.container=document.createElement("div"),this.container.className="playButtonOnScreen",this.container.id=this.containerId,this.container.style.width="100%",this.container.style.height="100%",paella.player.videoContainer.domElement.appendChild(this.container),$(this.container).click(function(){thisClass.onPlayButtonClick()});var icon=document.createElement("canvas");icon.className="playButtonOnScreenIcon",this.container.appendChild(icon),paella.events.bind(paella.events.resize,repaintCanvas),repaintCanvas()},getEvents:function(){return[paella.events.endVideo,paella.events.play,paella.events.pause,paella.events.showEditor,paella.events.hideEditor]},onEvent:function(eventType){switch(eventType){case paella.events.endVideo:this.endVideo();break;case paella.events.play:this.play();break;case paella.events.pause:this.pause();break;case paella.events.showEditor:this.showEditor();break;case paella.events.hideEditor:this.hideEditor()}},onPlayButtonClick:function(){this.firstPlay=!0,this.checkStatus()},endVideo:function(){this.isPlaying=!1,this.checkStatus()},play:function(){this.isPlaying=!0,this.showIcon=!1,this.checkStatus()},pause:function(){this.isPlaying=!1,this.showIcon=!1,this.checkStatus()},showEditor:function(){this.enabled=!1,this.checkStatus()},hideEditor:function(){this.enabled=!0,this.checkStatus()},checkStatus:function(){this.enabled&&this.isPlaying||!this.enabled||!this.showIcon?$(this.container).hide():$(this.container).show()}}),new paella.plugins.PlayButtonOnScreen,Class("paella.plugins.PlaybackRate",paella.ButtonPlugin,{buttonItems:null,buttons:[],selected_button:null,defaultRate:null,_domElement:null,available_rates:null,getAlignment:function(){return"left"},getSubclass:function(){return"showPlaybackRateButton"},getIndex:function(){return 140},getMinWindowSize:function(){return 200},getName:function(){return"es.upv.paella.playbackRatePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Set playback rate")},checkEnabled:function(onSuccess){var enabled=!base.userAgent.browser.IsMobileVersion&&null!=dynamic_cast("paella.Html5Video",paella.player.videoContainer.masterVideo());onSuccess(enabled)},setup:function(){this.defaultRate=1,this.available_rates=this.config.availableRates||[.75,1,1.25,1.5]},buildContent:function(domElement){var This=this;This._domElement=domElement,this.buttonItems={},this.available_rates.forEach(function(rate){domElement.appendChild(This.getItemButton(rate+"x",rate))})},getItemButton:function(label,rate){var elem=document.createElement("div");return elem.className=1==rate?this.getButtonItemClass(label,!0):this.getButtonItemClass(label,!1),elem.id=label+"_button",elem.innerHTML=label,elem.data={label:label,rate:rate,plugin:this},$(elem).click(function(){this.data.plugin.onItemClick(this,this.data.label,this.data.rate)}),elem},onItemClick:function(button,label,rate){var self=this;paella.events.trigger(paella.events.setPlaybackRate,rate),this.setText(label),paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()});for(var arr=self._domElement.children,i=0;i<arr.length;i++)arr[i].className=self.getButtonItemClass(i,!1);button.className=self.getButtonItemClass(i,!0)},getText:function(){return"1x"},getProfileItemButton:function(profile,profileData){var elem=document.createElement("div");return elem.className=this.getButtonItemClass(profile,!1),elem.id=profile+"_button",elem.data={profile:profile,profileData:profileData,plugin:this},$(elem).click(function(){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),elem},getButtonItemClass:function(profileName,selected){return"playbackRateItem "+profileName+(selected?" selected":"")}}),paella.plugins.playbackRate=new paella.plugins.PlaybackRate,Class("paella.plugins.CaptionsSearchPlugIn",paella.SearchServicePlugIn,{getName:function(){return"es.upv.paella.search.captionsSearchPlugin"},search:function(text,next){paella.captions.search(text,next)}}),new paella.plugins.CaptionsSearchPlugIn,Class("paella.plugins.SearchPlugin",paella.ButtonPlugin,{_open:!1,_sortDefault:"time",_colorSearch:!1,_localImages:null,_searchTimer:null,_searchTimerTime:1500,_searchBody:null,getAlignment:function(){return"right"},getSubclass:function(){return"searchButton"},getName:function(){return"es.upv.paella.searchPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Search")},getIndex:function(){return 510},checkEnabled:function(onSuccess){onSuccess(!0)},setup:function(){var self=this;$(".searchButton").click(function(){self._open?self._open=!1:(self._open=!0,setTimeout(function(){$("#searchBarInput").focus()},0))}),self._localImages=paella.initDelegate.initParams.videoLoader.frameList,self._colorSearch=self.config.colorSearch||!1,self._sortDefault=self.config.sortType||"time",paella.events.bind(paella.events.controlBarWillHide,function(){self._open&&paella.player.controls.cancelHideBar()})},prettyTime:function(seconds){var hou=Math.floor(seconds/3600)%24;hou=("00"+hou).slice(hou.toString().length);var min=Math.floor(seconds/60)%60;min=("00"+min).slice(min.toString().length);var sec=Math.floor(seconds%60);sec=("00"+sec).slice(sec.toString().length);var timestr=hou+":"+min+":"+sec;return timestr},search:function(text,cb){paella.searchService.search(text,cb)},getPreviewImage:function(time){var thisClass=this,keys=Object.keys(thisClass._localImages);keys.push(time),keys.sort(function(a,b){return parseInt(a)-parseInt(b)});var n=keys.indexOf(time)-1;n=n>0?n:0;var i=keys[n];return i=parseInt(i),thisClass._localImages[i].url},createLoadingElement:function(parent){var loadingResults=document.createElement("div");loadingResults.className="loader";var htmlLoader='<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve"><path fill="#000" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z"><animateTransform attributeType="xml"attributeName="transform"type="rotate"from="0 25 25"to="360 25 25"dur="0.6s"repeatCount="indefinite"/></path></svg>';loadingResults.innerHTML=htmlLoader,parent.appendChild(loadingResults);var sBodyText=document.createElement("p");sBodyText.className="sBodyText",sBodyText.innerHTML=base.dictionary.translate("Searching")+"...",parent.appendChild(sBodyText)},createNotResultsFound:function(parent){var noResults=document.createElement("div");noResults.className="noResults",noResults.innerHTML=base.dictionary.translate("Sorry! No results found."),parent.appendChild(noResults)},doSearch:function(txt,searchBody){var thisClass=this;$(searchBody).empty(),thisClass.createLoadingElement(searchBody),thisClass.search(txt,function(err,results){if($(searchBody).empty(),!err)if(0==results.length)thisClass.createNotResultsFound(searchBody);else for(var i=0;i<results.length;i++){"score"==thisClass._sortDefault&&results.sort(function(a,b){return b.score-a.score}),"time"==thisClass._sortDefault&&results.sort(function(a,b){return a.time-b.time});var sBodyInnerContainer=document.createElement("div");sBodyInnerContainer.className="sBodyInnerContainer",thisClass._colorSearch&&(results[i].score<=.3&&$(sBodyInnerContainer).addClass("redScore"),results[i].score>=.7&&$(sBodyInnerContainer).addClass("greenScore"));var TimePicContainer=document.createElement("div");TimePicContainer.className="TimePicContainer";var sBodyPicture=document.createElement("img");sBodyPicture.className="sBodyPicture",sBodyPicture.src=thisClass.getPreviewImage(results[i].time);var sBodyText=document.createElement("p");sBodyText.className="sBodyText",sBodyText.innerHTML="<span class='timeSpan'>"+thisClass.prettyTime(results[i].time)+"</span>"+results[i].content,TimePicContainer.appendChild(sBodyPicture),sBodyInnerContainer.appendChild(TimePicContainer),sBodyInnerContainer.appendChild(sBodyText),searchBody.appendChild(sBodyInnerContainer),sBodyInnerContainer.setAttribute("sec",results[i].time),$(sBodyInnerContainer).hover(function(){$(this).css("background-color","#faa166")},function(){$(this).removeAttr("style")}),$(sBodyInnerContainer).click(function(){var sec=$(this).attr("sec");paella.player.videoContainer.seekToTime(sec),paella.events.trigger(paella.events.play)})}})},buildContent:function(domElement){var thisClass=this,searchPluginContainer=document.createElement("div");searchPluginContainer.className="searchPluginContainer";var searchBody=document.createElement("div");searchBody.className="searchBody",searchPluginContainer.appendChild(searchBody),thisClass._searchBody=searchBody;var searchBar=document.createElement("div");searchBar.className="searchBar",searchPluginContainer.appendChild(searchBar);var input=document.createElement("input");input.className="searchBarInput",input.type="text",input.id="searchBarInput",input.name="searchString",input.placeholder=base.dictionary.translate("Search"),searchBar.appendChild(input),$(input).change(function(){var text=$(input).val();null!=thisClass._searchTimer&&thisClass._searchTimer.cancel(),""!=text&&thisClass.doSearch(text,searchBody)}),$(input).keyup(function(event){if(13!=event.keyCode){var text=$(input).val();null!=thisClass._searchTimer&&thisClass._searchTimer.cancel(),""!=text?thisClass._searchTimer=new base.Timer(function(){thisClass.doSearch(text,searchBody)},thisClass._searchTimerTime):$(thisClass._searchBody).empty()}}),$(input).focus(function(){paella.keyManager.enabled=!1}),$(input).focusout(function(){paella.keyManager.enabled=!0}),domElement.appendChild(searchPluginContainer)}}),paella.plugins.searchPlugin=new paella.plugins.SearchPlugin,Class("paella.ShowEditorPlugin",paella.VideoOverlayButtonPlugin,{isEditorVisible:function(){return null!=paella.editor.instance},getIndex:function(){return 10},getSubclass:function(){return"showEditorButton"},getAlignment:function(){return"right"},getDefaultToolTip:function(){return base.dictionary.translate("Enter editor mode")},checkEnabled:function(onSuccess){onSuccess(paella.editor&&paella.player.config.editor&&paella.player.config.editor.enabled&&!base.userAgent.browser.IsMobileVersion&&(paella.initDelegate.initParams.accessControl.permissions.canWrite||this.config.alwaysVisible)&&!paella.player.isLiveStream())},setup:function(){var thisClass=this;paella.events.bind(paella.events.hideEditor,function(){thisClass.onHideEditor()}),paella.events.bind(paella.events.showEditor,function(){thisClass.onShowEditor()})},action:function(){var editorPage=this.config.editorPage?this.config.editorPage:"";window!=window.top?window.open(editorPage+"?id="+paella.player.videoIdentifier,"_top"):paella.events.trigger(paella.events.showEditor)},onHideEditor:function(){this.showButton()},onShowEditor:function(){this.hideButton()},getName:function(){return"es.upv.paella.showEditorPlugin"}}),paella.plugins.showEditorPlugin=new paella.ShowEditorPlugin,Class("paella.plugins.SocialPlugin",paella.ButtonPlugin,{buttonItems:null,socialMedia:null,getAlignment:function(){return"right"},getSubclass:function(){return"showSocialPluginButton"},getIndex:function(){return 560},getMinWindowSize:function(){return 600},getName:function(){return"es.upv.paella.socialPlugin"},checkEnabled:function(onSuccess){onSuccess(!0)},getDefaultToolTip:function(){return base.dictionary.translate("Share this video")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buttons:[],selected_button:null,initialize:function(){if(this.parent(),"es"==base.dictionary.currentLanguage()){var esDict={"Custom size:":"Tamaño personalizado:","Choose your embed size. Copy the text and paste it in your html page.":"Elija el tamaño del video a embeber. Copie el texto y péguelo en su página html.","Width:":"Ancho:","Height:":"Alto:"};base.dictionary.addDictionary(esDict)}},setup:function(){var thisClass=this;Keys={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40},$(this.button).keyup(function(event){thisClass.isPopUpOpen()&&(event.keyCode==Keys.Up?thisClass.selected_button>0&&(thisClass.selected_button<thisClass.buttons.length&&(thisClass.buttons[thisClass.selected_button].className="socialItemButton "+thisClass.buttons[thisClass.selected_button].data.mediaData),thisClass.selected_button--,thisClass.buttons[thisClass.selected_button].className=thisClass.buttons[thisClass.selected_button].className+" selected"):event.keyCode==Keys.Down?thisClass.selected_button<thisClass.buttons.length-1&&(thisClass.selected_button>=0&&(thisClass.buttons[thisClass.selected_button].className="socialItemButton "+thisClass.buttons[thisClass.selected_button].data.mediaData),thisClass.selected_button++,thisClass.buttons[thisClass.selected_button].className=thisClass.buttons[thisClass.selected_button].className+" selected"):event.keyCode==Keys.Return&&thisClass.onItemClick(thisClass.buttons[thisClass.selected_button].data.mediaData))})},buildContent:function(domElement){var thisClass=this;this.buttonItems={},socialMedia=["facebook","twitter","embed"],socialMedia.forEach(function(mediaData){var buttonItem=thisClass.getSocialMediaItemButton(mediaData);thisClass.buttonItems[socialMedia.indexOf(mediaData)]=buttonItem,domElement.appendChild(buttonItem),thisClass.buttons.push(buttonItem)}),this.selected_button=thisClass.buttons.length},getSocialMediaItemButton:function(mediaData){var elem=document.createElement("div");return elem.className="socialItemButton "+mediaData,elem.id=mediaData+"_button",elem.data={mediaData:mediaData,plugin:this},$(elem).click(function(){this.data.plugin.onItemClick(this.data.mediaData)}),elem},onItemClick:function(mediaData){var url=this.getVideoUrl();switch(mediaData){case"twitter":window.open("http://twitter.com/home?status="+url);break;case"facebook":window.open("http://www.facebook.com/sharer.php?u="+url);break;case"embed":this.embedPress()}paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()})},getVideoUrl:function(){var url=document.location.href;return url},embedPress:function(){var host=document.location.protocol+"//"+document.location.host,pathname=document.location.pathname,p=pathname.split("/");p.length>0&&(p[p.length-1]="embed.html");var id=paella.initDelegate.getId(),url=host+p.join("/")+"?id="+id,divSelectSize="<div style='display:inline-block;'>     <div class='embedSizeButton' style='width:110px; height:73px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 620x349 </span></div>    <div class='embedSizeButton' style='width:100px; height:65px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 540x304 </span></div>    <div class='embedSizeButton' style='width:90px;  height:58px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 460x259 </span></div>    <div class='embedSizeButton' style='width:80px;  height:50px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 380x214 </span></div>    <div class='embedSizeButton' style='width:70px;  height:42px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 300x169 </span></div></div><div style='display:inline-block; vertical-align:bottom; margin-left:10px;'>    <div>"+base.dictionary.translate("Custom size:")+"</div>    <div>"+base.dictionary.translate("Width:")+" <input id='social_embed_width-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div>    <div>"+base.dictionary.translate("Height:")+" <input id='social_embed_height-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div></div>",divEmbed="<div id='embedContent' style='text-align:left; font-size:14px; color:black;'><div id=''>"+divSelectSize+"</div> <div id=''>"+base.dictionary.translate("Choose your embed size. Copy the text and paste it in your html page.")+"</div> <div id=''><textarea id='social_embed-textarea' class='social_embed-textarea' rows='4' cols='1' style='font-size:12px; width:95%; overflow:auto; margin-top:5px; color:black;'></textarea></div>  </div>";paella.messageBox.showMessage(divEmbed,{closeButton:!0,width:"750px",height:"210px",onClose:function(){}});var w_e=$("#social_embed_width-input")[0],h_e=$("#social_embed_height-input")[0];w_e.onkeyup=function(){var width=parseInt(w_e.value),height=parseInt(h_e.value);isNaN(width)?w_e.value="":300>width?$("#social_embed-textarea")[0].value="Embed width too low. The minimum value is a width of 300.":(isNaN(height)&&(height=(width/(16/9)).toFixed(),h_e.value=height),$("#social_embed-textarea")[0].value='<iframe allowfullscreen src="'+url+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+width+'" height="'+height+'"></iframe>')};for(var embs=$(".embedSizeButton"),i=0;i<embs.length;i+=1){var e=embs[i];e.onclick=function(event){var value=event.target?event.target.textContent:event.toElement.textContent;if(value){var size=value.split("x");w_e.value=size[0],h_e.value=size[1],$("#social_embed-textarea")[0].value='<iframe allowfullscreen src="'+url+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+size[0]+'" height="'+size[1]+'"></iframe>'}}}}}),paella.plugins.socialPlugin=new paella.plugins.SocialPlugin;var MyTabBarExamplePlugin=Class.create(paella.TabBarPlugin,{getSubclass:function(){return"test"},getTabName:function(){return"TabBar Example"},getName:function(){return"es.upv.paella.test.tabBarExamplePlugin"},buildContent:function(domElement){domElement.innerHTML="<p>This is a Paella Extended tab bar plugin</p>"}});new MyTabBarExamplePlugin,Class("paella.plugins.VideoLoadTestPlugin",paella.EventDrivenPlugin,{startTime:0,endTime:0,initialize:function(){if(this.parent(),this.startTime=Date.now(),"es"==base.dictionary.currentLanguage()){var esDict={"Video loaded in {0} seconds":"Video cargado en {0} segundos"};base.dictionary.addDictionary(esDict)}},getName:function(){return"es.upv.paella.test.videoLoadPlugin"},checkEnabled:function(onSuccess){onSuccess(!0)},getEvents:function(){return[paella.events.loadComplete]},onEvent:function(eventType){switch(eventType){case paella.events.loadComplete:this.onLoadComplete()}},onLoadComplete:function(){this.endTime=Date.now();var bench=(this.endTime-this.startTime)/1e3;this.showOverlayMessage(base.dictionary.translate("Video loaded in {0} seconds").replace(/\{0\}/g,bench))},showOverlayMessage:function(message){var overlayContainer=paella.player.videoContainer.overlayContainer,rect={left:40,top:50,width:430,height:80},root=document.createElement("div");root.className="videoLoadTestOverlay";var button=document.createElement("div");button.className="btn",button.innerHTML="X",button.onclick=function(){overlayContainer.removeElement(root)};var element=document.createElement("div");element.className="videoLoadTest",element.innerHTML=message,element.appendChild(button),root.appendChild(element),overlayContainer.addElement(root,rect)}}),paella.plugins.videoLoadTestPlugin=new paella.plugins.VideoLoadTestPlugin,Class("paella.plugins.ThemeChooserPlugin",paella.ButtonPlugin,{currentUrl:null,currentMaster:null,currentSlave:null,availableMasters:[],availableSlaves:[],getAlignment:function(){return"right"},getSubclass:function(){return"themeChooserPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 600},getName:function(){return"es.upv.paella.themeChooserPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Change theme")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},checkEnabled:function(onSuccess){onSuccess(paella.player.config.skin.available)
},buildContent:function(domElement){var This=this;paella.player.config.skin.available.forEach(function(item){var elem=document.createElement("div");elem.className="themebutton",elem.innerHTML=item.replace("-"," ").replace("_"," "),$(elem).click(function(){paella.utils.skin.set(item),paella.events.trigger(paella.events.hidePopUp,{identifier:This.getName()})}),domElement.appendChild(elem)})}}),paella.plugins.themeChooserPlugin=new paella.plugins.ThemeChooserPlugin,paella.plugins.translectures={},Class("paella.captions.translectures.Caption",paella.captions.Caption,{initialize:function(id,format,url,lang,editURL,next){this.parent(id,format,url,lang,next),this._captionsProvider="translecturesCaptionsProvider",this._editURL=editURL},canEdit:function(next){next(!1,void 0!=this._editURL&&""!=this._editURL)},goToEdit:function(){var permissions=paella.player.auth.permissions();1==permissions.isAnonymous?this.askForAnonymousOrLoginEdit():this.doEdit()},doEdit:function(){window.location.href=this._editURL},doLoginAndEdit:function(){paella.player.auth.login(this._editURL)},askForAnonymousOrLoginEdit:function(){var self=this,messageBoxElem=document.createElement("div");messageBoxElem.className="translecturesCaptionsMessageBox";var messageBoxTitle=document.createElement("div");messageBoxTitle.className="title",messageBoxTitle.innerHTML=base.dictionary.translate("You are trying to modify the transcriptions, but you are not Logged in!"),messageBoxElem.appendChild(messageBoxTitle);var messageBoxAuthContainer=document.createElement("div");messageBoxAuthContainer.className="authMethodsContainer",messageBoxElem.appendChild(messageBoxAuthContainer);var messageBoxAuth=document.createElement("div");messageBoxAuth.className="authMethod",messageBoxAuthContainer.appendChild(messageBoxAuth);var messageBoxAuthLink=document.createElement("a");messageBoxAuthLink.href="#",messageBoxAuthLink.style.color="#004488",messageBoxAuth.appendChild(messageBoxAuthLink);var messageBoxAuthLinkImg=document.createElement("img");messageBoxAuthLinkImg.src="resources/style/caption_mlangs_anonymous.png",messageBoxAuthLinkImg.alt="Anonymous",messageBoxAuthLinkImg.style.height="100px",messageBoxAuthLink.appendChild(messageBoxAuthLinkImg);var messageBoxAuthLinkText=document.createElement("p");messageBoxAuthLinkText.innerHTML=base.dictionary.translate("Continue editing the transcriptions anonymously"),messageBoxAuthLink.appendChild(messageBoxAuthLinkText),$(messageBoxAuthLink).click(function(){self.doEdit()}),messageBoxAuth=document.createElement("div"),messageBoxAuth.className="authMethod",messageBoxAuthContainer.appendChild(messageBoxAuth),messageBoxAuthLink=document.createElement("a"),messageBoxAuthLink.href="#",messageBoxAuthLink.style.color="#004488",messageBoxAuth.appendChild(messageBoxAuthLink),messageBoxAuthLinkImg=document.createElement("img"),messageBoxAuthLinkImg.src="resources/style/caption_mlangs_lock.png",messageBoxAuthLinkImg.alt="Login",messageBoxAuthLinkImg.style.height="100px",messageBoxAuthLink.appendChild(messageBoxAuthLinkImg),messageBoxAuthLinkText=document.createElement("p"),messageBoxAuthLinkText.innerHTML=base.dictionary.translate("Log in and edit the transcriptions"),messageBoxAuthLink.appendChild(messageBoxAuthLinkText),$(messageBoxAuthLink).click(function(){self.doLoginAndEdit()}),paella.messageBox.showElement(messageBoxElem)}}),Class("paella.plugins.translectures.CaptionsPlugIn",paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.translecture.captionsPlugin"},getEvents:function(){return[]},onEvent:function(){},checkEnabled:function(onSuccess){var self=this,video_id=paella.player.videoIdentifier;if(void 0==this.config.tLServer||void 0==this.config.tLdb)base.log.debug("Error! "+this.getName()+" plugin not configured!"),onSuccess(!1);else{var langs_url=(this.config.tLServer+"/langs?db=${tLdb}&id=${videoId}").replace(/\$\{videoId\}/gi,video_id).replace(/\$\{tLdb\}/gi,this.config.tLdb);base.ajax.get({url:langs_url},function(data){0==data.scode?(data.langs.forEach(function(l){var l_edit_url,l_get_url=(self.config.tLServer+"/dfxp?format=1&pol=0&db=${tLdb}&id=${videoId}&lang=${tl.lang.code}").replace(/\$\{videoId\}/gi,video_id).replace(/\$\{tLdb\}/gi,self.config.tLdb).replace(/\$\{tl.lang.code\}/gi,l.code);self.config.tLEdit&&(l_edit_url=self.config.tLEdit.replace(/\$\{videoId\}/gi,video_id).replace(/\$\{tLdb\}/gi,self.config.tLdb).replace(/\$\{tl.lang.code\}/gi,l.code));var l_txt=l.value;switch(l.type){case 0:l_txt+=" ("+paella.dictionary.translate("Auto")+")";break;case 1:l_txt+=" ("+paella.dictionary.translate("Under review")+")"}var c=new paella.captions.translectures.Caption(l.code,"dfxp",l_get_url,{code:l.code,txt:l_txt},l_edit_url);paella.captions.addCaptions(c)}),onSuccess(!1)):(base.log.debug("Error getting available captions from translectures: "+langs_url),onSuccess(!1))},function(){base.log.debug("Error getting available captions from translectures: "+langs_url),onSuccess(!1)})}}}),new paella.plugins.translectures.CaptionsPlugIn,new(Class(paella.userTracking.SaverPlugIn,{type:"userTrackingSaverPlugIn",getName:function(){return"es.upv.paella.usertracking.elasticsearchSaverPlugin"},checkEnabled:function(onSuccess){this._url=this.config.url,this._index=this.config.index||"paellaplayer",this._type=this.config.type||"usertracking";var enabled=!0;void 0==this._url&&(enabled=!1,base.log.debug("No ElasticSearch URL found in config file. Disabling ElasticSearch PlugIn")),onSuccess(enabled)},log:function(event,params){var p=params;"object"!=typeof p&&(p={value:p});var log={date:new Date,video:paella.initDelegate.getId(),playing:!paella.player.videoContainer.paused(),time:parseInt(paella.player.videoContainer.currentTime()+paella.player.videoContainer.trimStart()),event:event,params:p};paella.ajax.post({url:this._url+"/"+this._index+"/"+this._type+"/",params:JSON.stringify(log)})}})),new(Class(paella.userTracking.SaverPlugIn,{getName:function(){return"es.upv.paella.usertracking.GoogleAnalyticsSaverPlugin"},checkEnabled:function(onSuccess){var trackingID=this.config.trackingID,domain=this.config.domain||"auto";trackingID?(base.log.debug("Google Analitycs Enabled"),function(i,s,o,g,r,a,m){i.GoogleAnalyticsObject=r,i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date,a=s.createElement(o),m=s.getElementsByTagName(o)[0],a.async=1,a.src=g,m.parentNode.insertBefore(a,m)}(window,document,"script","//www.google-analytics.com/analytics.js","__gaTracker"),__gaTracker("create",trackingID,domain),__gaTracker("send","pageview"),onSuccess(!0)):(base.log.debug("No Google Tracking ID found in config file. Disabling Google Analitycs PlugIn"),onSuccess(!1))},log:function(event,params){if(void 0===this.config.category||this.config.category===!0){var category=this.config.category||"PaellaPlayer",action=event,label="";try{label=JSON.stringify(params)}catch(e){}__gaTracker("send","event",category,action,label)}}})),Class("paella.plugins.ViewModePlugin",paella.ButtonPlugin,{buttonItems:null,buttons:[],selected_button:null,active_profiles:null,getAlignment:function(){return"right"},getSubclass:function(){return"showViewModeButton"},getIndex:function(){return 540},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.viewModePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Change video layout")},checkEnabled:function(onSuccess){this.active_profiles=this.config.activeProfiles,onSuccess(!paella.player.videoContainer.isMonostream)},setup:function(){var thisClass=this;Keys={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40},$(this.button).keyup(function(event){thisClass.isPopUpOpen()&&(event.keyCode==Keys.Up?thisClass.selected_button>0&&(thisClass.selected_button<thisClass.buttons.length&&(thisClass.buttons[thisClass.selected_button].className="viewModeItemButton "+thisClass.buttons[thisClass.selected_button].data.profile),thisClass.selected_button--,thisClass.buttons[thisClass.selected_button].className=thisClass.buttons[thisClass.selected_button].className+" selected"):event.keyCode==Keys.Down?thisClass.selected_button<thisClass.buttons.length-1&&(thisClass.selected_button>=0&&(thisClass.buttons[thisClass.selected_button].className="viewModeItemButton "+thisClass.buttons[thisClass.selected_button].data.profile),thisClass.selected_button++,thisClass.buttons[thisClass.selected_button].className=thisClass.buttons[thisClass.selected_button].className+" selected"):event.keyCode==Keys.Return&&thisClass.onItemClick(thisClass.buttons[thisClass.selected_button],thisClass.buttons[thisClass.selected_button].data.profile,thisClass.buttons[thisClass.selected_button].data.profile))})},buildContent:function(domElement){var thisClass=this;this.buttonItems={},paella.Profiles.loadProfileList(function(profiles){Object.keys(profiles).forEach(function(profile){if(thisClass.active_profiles){var active=!1;if(thisClass.active_profiles.forEach(function(ap){ap==profile&&(active=!0)}),0==active)return}var n=paella.player.videoContainer.sourceData[0].sources;if("s_p_blackboard2"!=profile||0!=n.hasOwnProperty("image")){var profileData=profiles[profile],buttonItem=thisClass.getProfileItemButton(profile,profileData);thisClass.buttonItems[profile]=buttonItem,domElement.appendChild(buttonItem),thisClass.buttons.push(buttonItem),paella.player.selectedProfile==profile&&(thisClass.buttonItems[profile].className=thisClass.getButtonItemClass(profile,!0))}}),thisClass.selected_button=thisClass.buttons.length})},getProfileItemButton:function(profile,profileData){var elem=document.createElement("div");return elem.className=this.getButtonItemClass(profile,!1),elem.id=profile+"_button",elem.data={profile:profile,profileData:profileData,plugin:this},$(elem).click(function(){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),elem},onItemClick:function(button,profile){var thisClass=this,ButtonItem=this.buttonItems[profile];n=this.buttonItems,arr=Object.keys(n),arr.forEach(function(i){thisClass.buttonItems[i].className=thisClass.getButtonItemClass(i,!1)}),ButtonItem&&(ButtonItem.className=thisClass.getButtonItemClass(profile,!0),paella.events.trigger(paella.events.setProfile,{profileName:profile})),paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()})},getButtonItemClass:function(profileName,selected){return"viewModeItemButton "+profileName+(selected?" selected":"")}}),paella.plugins.viewModePlugin=new paella.plugins.ViewModePlugin,Class("paella.plugins.VolumeRangePlugin",paella.ButtonPlugin,{getAlignment:function(){return"left"},getSubclass:function(){return"volumeRangeButton"},getName:function(){return"es.upv.paella.volumeRangePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Volume")},getIndex:function(){return 120},_showMasterVolume:null,_showSlaveVolume:null,_tempMasterVolume:0,_tempSlaveVolume:0,_inputMaster:null,_inputSlave:null,_control_NotMyselfEvent:!0,_storedValue:!1,checkEnabled:function(onSuccess){var enabled=!1;base.userAgent.browser.IsMobileVersion||(this._showMasterVolume=void 0!==this.config.showMasterVolume?this.config.showMasterVolume:!0,this._showSlaveVolume=void 0===this.config.showSlaveVolume||paella.player.videoContainer.isMonostream?!1:this.config.showSlaveVolume,(this._showMasterVolume||this._showSlaveVolume)&&(enabled=!0)),onSuccess(enabled)},setup:function(){var self=this;paella.events.bind(paella.events.videoUnloaded,function(){self.storeVolume()}),paella.events.bind(paella.events.singleVideoReady,function(event,params){self.loadStoredVolume(params)}),paella.events.bind(paella.events.setVolume,function(evt,par){self.updateVolumeOnEvent(par)})},updateVolumeOnEvent:function(volume){var thisClass=this;thisClass._control_NotMyselfEvent?(thisClass._inputMaster&&(thisClass._inputMaster.value=volume.master),thisClass._inputSlave&&(thisClass._inputSlave.value=volume.slave)):thisClass._control_NotMyselfEvent=!0},storeVolume:function(){this._storedValue=!0,paella.player.videoContainer.slaveVideo()&&(this._tempSlaveVolume=paella.player.videoContainer.slaveVideo().volume()),paella.player.videoContainer.masterVideo()&&(this._tempMasterVolume=paella.player.videoContainer.masterVideo().volume())},loadStoredVolume:function(params){0==this._storedValue&&this.storeVolume(),("playerContainer_videoContainer_1"==params.sender.identifier&&this._tempSlaveVolume||this._tempMasterVolume)&&paella.events.trigger(paella.events.setVolume,{master:this._tempMasterVolume,slave:this._tempSlaveVolume}),this._storedValue=!1},buildContent:function(domElement){var thisClass=this,videoRangeContainer=document.createElement("div");if(videoRangeContainer.className="videoRangeContainer",this._showMasterVolume){var rangeMaster=document.createElement("div");rangeMaster.className="range";var rangeImageMaster=document.createElement("div");rangeImageMaster.className="image master";var rangeInputMaster=document.createElement("input");thisClass._inputMaster=rangeInputMaster,rangeInputMaster.type="range",rangeInputMaster.min=0,rangeInputMaster.max=1,rangeInputMaster.step=.01,rangeInputMaster.value=this.getMasterVolume();var updateMasterVolume=function(){var slaveVideo=paella.player.videoContainer.slaveVideo(),slaveVolume=0;slaveVideo&&(slaveVolume=slaveVideo.volume());var masterVolume=$(rangeInputMaster).val();thisClass._control_NotMyselfEvent=!1,paella.events.trigger(paella.events.setVolume,{master:masterVolume,slave:slaveVolume})};$(rangeInputMaster).bind("input",function(){updateMasterVolume()}),$(rangeInputMaster).change(function(){updateMasterVolume()}),rangeMaster.appendChild(rangeImageMaster),rangeMaster.appendChild(rangeInputMaster),videoRangeContainer.appendChild(rangeMaster)}if(!paella.player.videoContainer.isMonostream&&this._showSlaveVolume){var rangeSlave=document.createElement("div");rangeSlave.className="range";var rangeImageSlave=document.createElement("div");rangeImageSlave.className="image slave";var rangeInputSlave=document.createElement("input");thisClass._inputSlave=rangeInputSlave,rangeInputSlave.type="range",rangeInputSlave.min=0,rangeInputSlave.max=1,rangeInputSlave.step=.01,rangeInputSlave.value=this.getSlaveVolume();var updateSlaveVolume=function(){var masterVideo=paella.player.videoContainer.masterVideo(),masterVolume=0;masterVideo&&(masterVolume=masterVideo.volume());var slaveVolume=$(rangeInputSlave).val();thisClass._control_NotMyselfEvent=!1,paella.events.trigger(paella.events.setVolume,{master:masterVolume,slave:slaveVolume})};$(rangeInputSlave).bind("input",function(){updateSlaveVolume()}),$(rangeInputSlave).change(function(){updateSlaveVolume()}),rangeSlave.appendChild(rangeImageSlave),rangeSlave.appendChild(rangeInputSlave),videoRangeContainer.appendChild(rangeSlave)}paella.events.bind(paella.events.setVolume,function(event,params){this._showMasterVolume&&(rangeInputMaster.value=params.master),!paella.player.videoContainer.isMonostream&&this._showMasterVolume&&(rangeInputSlave.value=params.slave),thisClass.updateClass()}),domElement.appendChild(videoRangeContainer),thisClass.updateClass()},getMasterVolume:function(){var masterVideo=paella.player.videoContainer.masterVideo();return masterVideo?masterVideo.volume():0},getSlaveVolume:function(){var slaveVideo=paella.player.videoContainer.slaveVideo();return slaveVideo?slaveVideo.volume():0},updateClass:function(){var volume,selected="";this._showMasterVolume&&this._showSlaveVolume?selected="med":(this._showMasterVolume&&(volume=paella.player.videoContainer.masterVideo().volume()),this._showSlaveVolume&&(volume=paella.player.videoContainer.slaveVideo().volume()),selected=void 0===volume?"med":0==volume?"mute":.33>volume?"min":.66>volume?"med":"max"),this.button.className=["buttonPlugin",this.getAlignment(),this.getSubclass(),selected].join(" ")}}),paella.plugins.volumeRangePlugin=new paella.plugins.VolumeRangePlugin,Class("paella.ZoomPlugin",paella.EventDrivenPlugin,{_zImages:null,_imageNumber:null,_isActivated:!1,_isCreated:!1,_keys:null,_ant:null,_next:null,_videoLength:null,_compChanged:!1,_restartPlugin:!1,_actualImage:null,_zoomIncr:null,_maxZoom:null,_minZoom:null,_dragMode:!1,_mouseDownPosition:null,getIndex:function(){return 20},getAlignment:function(){return"right"},getSubclass:function(){return"zoomButton"},getDefaultToolTip:function(){return base.dictionary.translate("Zoom")},getEvents:function(){return[paella.events.timeUpdate,paella.events.setComposition,paella.events.loadPlugins,paella.events.play]},onEvent:function(event,params){switch(event){case paella.events.timeUpdate:this.imageUpdate(event,params);break;case paella.events.setComposition:this.compositionChanged(event,params);break;case paella.events.loadPlugins:this.loadPlugin(event,params);break;case paella.events.play:this.exitPhotoMode()}},checkEnabled:function(onSuccess){if(paella.player.videoContainer.sourceData.length<2)return void onSuccess(!1);var n=paella.player.videoContainer.sourceData[0].sources;onSuccess(n.hasOwnProperty("image")?!0:!1)},setupIcons:function(){var self=this,width=$(".zoomFrame").width(),arrowsLeft=document.createElement("div");arrowsLeft.className="arrowsLeft",arrowsLeft.style.display="none";var arrowsRight=document.createElement("div");arrowsRight.className="arrowsRight",arrowsRight.style.display="none",arrowsRight.style.left=width-24+"px",$(arrowsLeft).click(function(){self.arrowCallLeft(),event.stopPropagation()}),$(arrowsRight).click(function(){self.arrowCallRight(),event.stopPropagation()});var iconsFrame=document.createElement("div");iconsFrame.className="iconsFrame";var buttonZoomIn=document.createElement("button");buttonZoomIn.className="zoomActionButton buttonZoomIn",buttonZoomIn.style.display="none";var buttonZoomOut=document.createElement("button");buttonZoomOut.className="zoomActionButton buttonZoomOut",buttonZoomOut.style.display="none";var buttonSnapshot=document.createElement("button");buttonSnapshot.className="zoomActionButton buttonSnapshot",buttonSnapshot.style.display="none";var buttonZoomOn=document.createElement("button");buttonZoomOn.className="zoomActionButton buttonZoomOn",$(iconsFrame).append(buttonZoomOn),$(iconsFrame).append(buttonSnapshot),$(iconsFrame).append(buttonZoomIn),$(iconsFrame).append(buttonZoomOut),$(".newframe").append(iconsFrame),$(".newframe").append(arrowsLeft),$(".newframe").append(arrowsRight),$(buttonZoomOn).click(function(){self._isActivated?(self.exitPhotoMode(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked")):(self.enterPhotoMode(),$(".zoomActionButton.buttonZoomOn").addClass("clicked")),event.stopPropagation()}),$(buttonSnapshot).click(function(){null!=self._actualImage&&window.open(self._actualImage,"_blank"),event.stopPropagation()}),$(buttonZoomIn).click(function(){self.zoomIn(),event.stopPropagation()}),$(buttonZoomOut).click(function(){self.zoomOut(),event.stopPropagation()})},enterPhotoMode:function(){var self=this;$(".zoomFrame").show(),$(".zoomFrame").css("opacity","1"),this._isActivated=!0,$(".buttonSnapshot").show(),$(".buttonZoomOut").show(),$(".buttonZoomIn").show(),$(".arrowsRight").show(),$(".arrowsLeft").show(),paella.events.trigger(paella.events.pause),self._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),self._imageNumber>=self._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()},exitPhotoMode:function(){$(".zoomFrame").hide(),this._isActivated=!1,$(".buttonSnapshot").hide(),$(".buttonZoomOut").hide(),$(".buttonZoomIn").hide(),$(".arrowsRight").hide(),$(".arrowsLeft").hide(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked")},setup:function(){var self=this;self._maxZoom=self.config.maxZoom||500,self._minZoom=self.config.minZoom||100,self._zoomIncr=self.config.zoomIncr||10,this._zImages={},this._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,this._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,this._keys=Object.keys(this._zImages),this._keys=this._keys.sort(function(a,b){return a=a.slice(6),b=b.slice(6),parseInt(a)-parseInt(b)}),this._next=0,this._ant=0},loadPlugin:function(){var self=this;0==self._isCreated&&(self.createOverlay(),self.setupIcons(),$(".zoomFrame").hide(),self._isActivated=!1,self._isCreated=!0)},imageUpdate:function(event,params){var self=this,sec=Math.round(params.currentTime),src=$(".zoomFrame").css("background-image");if($(".newframe").length>0){if(this._zImages.hasOwnProperty("frame_"+sec)){if(src==this._zImages["frame_"+sec])return;src=this._zImages["frame_"+sec]}else{if(!(sec>this._next||sec<this._ant||self._compChanged))return;self._compChanged&&(self._compChanged=!1),src=self.returnSrc(sec)}$("#photo_01").attr("src",src).load();var image=new Image;image.onload=function(){$(".zoomFrame").css("background-image","url("+src+")")},image.src=src,self._actualImage=src,self._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),self._imageNumber>=self._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()}},returnSrc:function(sec){var ant=0;for(i=0;i<this._keys.length;i++){var id=parseInt(this._keys[i].slice(6)),lastId=parseInt(this._keys[this._keys.length-1].slice(6));if(id>sec)return this._next=id,this._ant=ant,this._imageNumber=i-1,this._zImages["frame_"+ant];if(sec>lastId&&sec<this._videoLength)return this._next=this._videoLength,this._ant=lastId,this._zImages["frame_"+ant];ant=id}},arrowCallLeft:function(){var self=this,obj={};if(self._imageNumber-1>=0){var frame=self._keys[self._imageNumber-1];self._imageNumber-=1,obj.time=parseInt(frame.slice(6)),paella.events.trigger(paella.events.seekToTime,obj)}},arrowCallRight:function(){var self=this,obj={};if(self._imageNumber+1<=self._keys.length){var frame=self._keys[self._imageNumber+1];self._imageNumber+=1,obj.time=parseInt(frame.slice(6)),paella.events.trigger(paella.events.seekToTime,obj)}},createOverlay:function(){var self=this,newframe=document.createElement("div");newframe.className="newframe",overlayContainer=paella.player.videoContainer.overlayContainer,overlayContainer.addElement(newframe,overlayContainer.getMasterRect());var zoomframe=document.createElement("div");zoomframe.className="zoomFrame",newframe.insertBefore(zoomframe,newframe.firstChild),$(zoomframe).click(function(event){event.stopPropagation()}),$(zoomframe).bind("mousewheel",function(e){e.originalEvent.wheelDelta/120>0?self.zoomIn():self.zoomOut()}),$(zoomframe).mousedown(function(event){self.mouseDown(event.clientX,event.clientY)}),$(zoomframe).mouseup(function(){self.mouseUp()}),$(zoomframe).mouseleave(function(){self.mouseLeave()}),$(zoomframe).mousemove(function(event){self.mouseMove(event.clientX,event.clientY)})},mouseDown:function(x,y){this._dragMode=!0,this._mouseDownPosition={x:x,y:y}},mouseUp:function(){this._dragMode=!1},mouseLeave:function(){this._dragMode=!1},mouseMove:function(x,y){if(this._dragMode){var pos=($(".zoomFrame")[0],this._backgroundPosition?this._backgroundPosition:{left:0,top:0}),px=($(".zoomFrame").width(),$(".zoomFrame").height(),this._mouseDownPosition.x-x),py=this._mouseDownPosition.y-y,positionx=pos.left+px,positiony=pos.top+py;positionx=positionx>=0?positionx:0,positionx=100>=positionx?positionx:100,positiony=positiony>=0?positiony:0,positiony=100>=positiony?positiony:100,$(".zoomFrame").css("background-position",positionx+"% "+positiony+"%"),this._backgroundPosition={left:positionx,top:positiony},this._mouseDownPosition.x=x,this._mouseDownPosition.y=y}},zoomIn:function(){var self=this;z=$(".zoomFrame").css("background-size"),z=z.split(" "),z=parseInt(z[0]),z<self._maxZoom&&$(".zoomFrame").css("background-size",z+self._zoomIncr+"% auto")},zoomOut:function(){var self=this;z=$(".zoomFrame").css("background-size"),z=z.split(" "),z=parseInt(z[0]),z>self._minZoom&&$(".zoomFrame").css("background-size",z-self._zoomIncr+"% auto")},imageUpdateOnPause:function(params){var self=this,sec=Math.round(params),src=$(".zoomFrame").css("background-image");if($(".newframe").length>0&&src!=self._actualImage){if(this._zImages.hasOwnProperty("frame_"+sec)){if(src==this._zImages["frame_"+sec])return;src=this._zImages["frame_"+sec]}else self._compChanged&&(self._compChanged=!1),src=self.returnSrc(sec);$("#photo_01").attr("src",src).load();var image=new Image;image.onload=function(){$(".zoomFrame").css("background-image","url("+src+")")},image.src=src,self._actualImage=src}},compositionChanged:function(){var self=this;if($(".newframe").remove(),self._isCreated=!1,paella.player.videoContainer.getMasterVideoRect().visible&&(self.loadPlugin(),paella.player.paused())){var currentTime=paella.player.videoContainer.currentTime();self.imageUpdateOnPause(currentTime)}self._compChanged=!0},getName:function(){return"es.upv.paella.zoomPlugin"}}),paella.plugins.zoomPlugin=new paella.ZoomPlugin,paella.version="4.1.0 - build: 513e07c";