"use strict";function paella_DeferredResolved(t){return new Promise(function(e){e(t)})}function paella_DeferredRejected(t){return new Promise(function(e,n){n(t)})}function paella_DeferredNotImplemented(){return paella_DeferredRejected(new Error("not implemented"))}function initPaellaEngage(t,e){e||(e=new paella.InitDelegate),paella.initDelegate=e;navigator.language||window.navigator.userLanguage;paellaPlayer=new PaellaPlayer(t,paella.initDelegate)}function DeprecatedClass(t,e,n){Class(t,n,{initialize:function(){base.log.warning(t+" is deprecated, use "+e+" instead."),this.parent.apply(this,arguments)}})}function DeprecatedFunc(t,e,n){function i(){base.log.warning(t+" is deprecated, use "+e+" instead."),n.apply(this,arguments)}return i}function buildChromaVideoCanvas(t,e){var n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),this.stream=t,this._chroma=bg.Color.White(),this._crop=new bg.Vector4(.3,.01,.3,.01),this._transform=bg.Matrix4.Identity().translate(.6,-.04,0),this._bias=.01}return $traceurRuntime.createClass(e,{get chroma(){return this._chroma},get bias(){return this._bias},get crop(){return this._crop},get transform(){return this._transform},set chroma(t){this._chroma=t},set bias(t){this._bias=t},set crop(t){this._crop=t},set transform(t){this._transform=t},get video(){return this.texture?this.texture.video:null},loaded:function(){var t=this;return new Promise(function(e){var n=function(){t.video?e(t):setTimeout(n,100)};n()})},buildShape:function(){this.plist=new bg.base.PolyList(this.gl),this.plist.vertex=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],this.plist.texCoord0=[0,0,1,0,1,1,0,1],this.plist.index=[0,1,2,2,3,0],this.plist.build()},buildShader:function(){this.shader=new bg.base.Shader(this.gl),this.shader.addShaderSource(bg.base.ShaderType.VERTEX,"\n\t\t\t\t\tattribute vec4 position;\n\t\t\t\t\tattribute vec2 texCoord;\n\t\t\t\t\tuniform mat4 inTransform;\n\t\t\t\t\tvarying vec2 vTexCoord;\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tgl_Position = inTransform * position;\n\t\t\t\t\t\tvTexCoord = texCoord;\n\t\t\t\t\t}\n\t\t\t\t"),this.shader.addShaderSource(bg.base.ShaderType.FRAGMENT,"\n\t\t\t\t\tprecision mediump float;\n\t\t\t\t\tvarying vec2 vTexCoord;\n\t\t\t\t\tuniform sampler2D inTexture;\n\t\t\t\t\tuniform vec4 inChroma;\n\t\t\t\t\tuniform float inBias;\n\t\t\t\t\tuniform vec4 inCrop;\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tvec4 result = texture2D(inTexture,vTexCoord);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif ((result.r>=inChroma.r-inBias && result.r<=inChroma.r+inBias &&\n\t\t\t\t\t\t\tresult.g>=inChroma.g-inBias && result.g<=inChroma.g+inBias &&\n\t\t\t\t\t\t\tresult.b>=inChroma.b-inBias && result.b<=inChroma.b+inBias) ||\n\t\t\t\t\t\t\t(vTexCoord.x<inCrop.x || vTexCoord.x>inCrop.z || vTexCoord.y<inCrop.w || vTexCoord.y>inCrop.y)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tgl_FragColor = result;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t"),status=this.shader.link(),this.shader.status||(console.log(this.shader.compileError),console.log(this.shader.linkError)),this.shader.initVars(["position","texCoord"],["inTransform","inTexture","inChroma","inBias","inCrop"])},init:function(){var t=this;bg.Engine.Set(new bg.webgl1.Engine(this.gl)),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),this.buildShape(),this.buildShader(),this.pipeline=new bg.base.Pipeline(this.gl),bg.base.Pipeline.SetCurrent(this.pipeline),this.pipeline.clearColor=bg.Color.Transparent(),bg.base.Loader.Load(this.gl,this.stream.src).then(function(e){t.texture=e})},frame:function(t){this.texture&&this.texture.update()},display:function(){this.pipeline.clearBuffers(bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH),this.texture&&(this.shader.setActive(),this.shader.setInputBuffer("position",this.plist.vertexBuffer,3),this.shader.setInputBuffer("texCoord",this.plist.texCoord0Buffer,2),this.shader.setMatrix4("inTransform",this.transform),this.shader.setTexture("inTexture",this.texture||bg.base.TextureCache.WhiteTexture(this.gl),bg.base.TextureUnit.TEXTURE_0),this.shader.setVector4("inChroma",this.chroma),this.shader.setValueFloat("inBias",this.bias),this.shader.setVector4("inCrop",new bg.Vector4(this.crop.x,1-this.crop.y,1-this.crop.z,this.crop.w)),this.plist.draw(),this.shader.disableInputBuffer("position"),this.shader.disableInputBuffer("texCoord"),this.shader.clearActive())},reshape:function(t,e){var n=this.canvas.domElement;n.width=t,n.height=e,this.pipeline.viewport=new bg.Viewport(0,0,t,e)},mouseMove:function(t){this.postRedisplay()}},{},t)}(bg.app.WindowController),i=new n(t),r=bg.app.MainLoop.singleton;return r.updateMode=bg.app.FrameUpdate.AUTO,r.canvas=e,r.run(i),i.loaded()}function buildVideo360Canvas(t,e){var n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),this.stream=t}return $traceurRuntime.createClass(e,{get video(){return this.texture?this.texture.video:null},loaded:function(){var t=this;return new Promise(function(e){var n=function(){t.video?e(t):setTimeout(n,100)};n()})},buildScene:function(){var t=this;this._root=new bg.scene.Node(this.gl,"Root node"),bg.base.Loader.RegisterPlugin(new bg.base.TextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VWGLBLoaderPlugin),bg.base.Loader.Load(this.gl,this.stream.src).then(function(e){t.texture=e;var n=bg.scene.PrimitiveFactory.Sphere(t.gl,1,50),i=new bg.scene.Node(t.gl);i.addComponent(n),n.getMaterial(0).texture=e,n.getMaterial(0).lightEmission=1,n.getMaterial(0).lightEmissionMaskInvert=!0,n.getMaterial(0).cullFace=!1,t._root.addChild(i),t.postRedisplay()});var e=new bg.scene.Node(this.gl,"Light");this._root.addChild(e),this._camera=new bg.scene.Camera;var n=new bg.scene.Node("Camera");n.addComponent(this._camera),n.addComponent(new bg.scene.Transform);var i=new bg.manipulation.OrbitCameraController;n.addComponent(i),i.maxPitch=90,i.minPitch=-90,i.maxDistance=0,i.minDistace=0,this._root.addChild(n)},init:function(){bg.Engine.Set(new bg.webgl1.Engine(this.gl)),this.buildScene(),this._renderer=bg.render.Renderer.Create(this.gl,bg.render.RenderPath.FORWARD),this._inputVisitor=new bg.scene.InputVisitor},frame:function(t){this.texture&&this.texture.update(),this._renderer.frame(this._root,t)},display:function(){this._renderer.display(this._root,this._camera)},reshape:function(t,e){this._camera.viewport=new bg.Viewport(0,0,t,e),this._camera.projection.perspective(60,this._camera.viewport.aspectRatio,.1,100)},mouseDown:function(t){this._inputVisitor.mouseDown(this._root,t)},mouseDrag:function(t){this._inputVisitor.mouseDrag(this._root,t),this.postRedisplay()},mouseWheel:function(t){this._inputVisitor.mouseWheel(this._root,t),this.postRedisplay()},touchStart:function(t){this._inputVisitor.touchStart(this._root,t)},touchMove:function(t){this._inputVisitor.touchMove(this._root,t),this.postRedisplay()},mouseUp:function(t){this._inputVisitor.mouseUp(this._root,t)},mouseMove:function(t){this._inputVisitor.mouseMove(this._root,t)},mouseOut:function(t){this._inputVisitor.mouseOut(this._root,t)},touchEnd:function(t){this._inputVisitor.touchEnd(this._root,t)}},{},t)}(bg.app.WindowController),i=new n(t),r=bg.app.MainLoop.singleton;return r.updateMode=bg.app.FrameUpdate.AUTO,r.canvas=e,r.run(i),i.loaded()}function buildVideo360ThetaCanvas(t,e){function n(t,e){return new bg.Vector3(Math.cos(e)*Math.cos(t),Math.cos(e)*Math.sin(t),Math.sin(e))}function i(t,e,n){var i=n;return n<-1?i=-1:n>1&&(i=1),new bg.Vector2(Math.atan2(e,t),Math.acos(i)/Math.PI)}function r(t,e,r){var a=n(((t+90)/180-1)*Math.PI,(.5-e/180)*Math.PI),s=i(Math.sin(-.5*Math.PI)*a.z+Math.cos(-.5*Math.PI)*a.x,a.y,Math.cos(-.5*Math.PI)*a.z-Math.sin(-.5*Math.PI)*a.x),o=0===r?.883*s.y*Math.cos(s.x)*.5+.25:.883*(1-s.y)*Math.cos(-1*s.x+Math.PI)*.5+.75,u=0===r?.784888888888881*s.y*Math.sin(s.x)+.55555555555556:.784888888888881*(1-s.y)*Math.sin(-1*s.x+Math.PI)+.55555555555556;return new bg.Vector2(o,u)}function a(t){function e(t,e,n,i,r,s,o,u,l){a.vertex.push(t.x),a.vertex.push(t.y),a.vertex.push(t.z),a.vertex.push(e.x),a.vertex.push(e.y),a.vertex.push(e.z),a.vertex.push(n.x),a.vertex.push(n.y),a.vertex.push(n.z),a.normal.push(i.x),a.normal.push(i.y),a.normal.push(i.z),a.normal.push(r.x),a.normal.push(r.y),a.normal.push(r.z),a.normal.push(s.x),a.normal.push(s.z),a.normal.push(s.z),a.texCoord0.push(o.x),a.texCoord0.push(o.y),a.texCoord0.push(u.x),a.texCoord0.push(u.y),a.texCoord0.push(l.x),a.texCoord0.push(l.y),a.index.push(a.index.length),a.index.push(a.index.length),a.index.push(a.index.length)}var n=new bg.scene.Node(t),i=new bg.scene.Drawable;n.addComponent(i);for(var a=new bg.base.PolyList(t),s=[],o=[],u=[],l=0;l<=180;l+=5){for(var c=0;c<=360;c+=5)s.push(new bg.Vector3(Math.sin(Math.PI*l/180)*Math.sin(Math.PI*c/180)*1,1*Math.cos(Math.PI*l/180),Math.sin(Math.PI*l/180)*Math.cos(Math.PI*c/180)*1)),o.push(new bg.Vector3(0,0,-1));for(var h=0;h<=180;h+=5)u.push(r(h,l,0));for(var f=180;f<=360;f+=5)u.push(r(f,l,1))}for(var d=0;d<36;d++)for(var g=0;g<72;g++){var m=73*d+g,p=g<36?74*d+g:74*d+g+1;u[p+0],u[p+1],u[p+74],u[p+1],u[p+75],u[p+74];var b=s[m+0],_=o[m+0],v=u[p+0],y=s[m+1],E=o[m+1],T=u[p+1],x=s[m+73],S=o[m+73],w=u[p+74],M=s[m+74],C=o[m+74],R=u[p+75];e(b,y,x,_,E,S,v,T,w),e(y,M,x,E,C,S,T,R,w)}a.build(),i.addPolyList(a);var O=bg.Matrix4.Scale(-1,1,1);return n.addComponent(new bg.scene.Transform(O)),n}var s=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),this.stream=t}return $traceurRuntime.createClass(e,{get video(){return this.texture?this.texture.video:null},loaded:function(){var t=this;return new Promise(function(e){var n=function(){t.video?e(t):setTimeout(n,100)};n()})},buildScene:function(){var t=this;this._root=new bg.scene.Node(this.gl,"Root node"),bg.base.Loader.RegisterPlugin(new bg.base.TextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VWGLBLoaderPlugin),bg.base.Loader.Load(this.gl,this.stream.src).then(function(e){t.texture=e;var n=a(t.gl),i=n.component("bg.scene.Drawable");i.getMaterial(0).texture=e,i.getMaterial(0).lightEmission=1,i.getMaterial(0).lightEmissionMaskInvert=!0,i.getMaterial(0).cullFace=!1,t._root.addChild(n),t.postRedisplay()});var e=new bg.scene.Node(this.gl,"Light");this._root.addChild(e),this._camera=new bg.scene.Camera;var n=new bg.scene.Node("Camera");n.addComponent(this._camera),n.addComponent(new bg.scene.Transform);var i=new bg.manipulation.OrbitCameraController;n.addComponent(i),i.maxPitch=90,i.minPitch=-90,i.maxDistance=0,i.minDistace=0,this._root.addChild(n)},init:function(){bg.Engine.Set(new bg.webgl1.Engine(this.gl)),this.buildScene(),this._renderer=bg.render.Renderer.Create(this.gl,bg.render.RenderPath.FORWARD),this._inputVisitor=new bg.scene.InputVisitor},frame:function(t){this.texture&&this.texture.update(),this._renderer.frame(this._root,t)},display:function(){this._renderer.display(this._root,this._camera)},reshape:function(t,e){this._camera.viewport=new bg.Viewport(0,0,t,e),this._camera.projection.perspective(60,this._camera.viewport.aspectRatio,.1,100)},mouseDown:function(t){this._inputVisitor.mouseDown(this._root,t)},mouseDrag:function(t){this._inputVisitor.mouseDrag(this._root,t),this.postRedisplay()},mouseWheel:function(t){this._inputVisitor.mouseWheel(this._root,t),this.postRedisplay()},touchStart:function(t){this._inputVisitor.touchStart(this._root,t)},touchMove:function(t){this._inputVisitor.touchMove(this._root,t),this.postRedisplay()},mouseUp:function(t){this._inputVisitor.mouseUp(this._root,t)},mouseMove:function(t){this._inputVisitor.mouseMove(this._root,t)},mouseOut:function(t){this._inputVisitor.mouseOut(this._root,t)},touchEnd:function(t){this._inputVisitor.touchEnd(this._root,t)}},{},t)}(bg.app.WindowController),o=new s(t),u=bg.app.MainLoop.singleton;return u.updateMode=bg.app.FrameUpdate.AUTO,u.canvas=e,u.run(o),o.loaded()}function onYouTubeIframeAPIReady(){paella.youtubePlayerVars.apiReadyPromise.resolve()}var GlobalParams={video:{zIndex:1},background:{zIndex:0}},paella={};paella.player=null,paella.version="5.2.4 - build: df290e1",paella.events={play:"paella:play",pause:"paella:pause",next:"paella:next",previous:"paella:previous",seeking:"paella:seeking",seeked:"paella:seeked",timeupdate:"paella:timeupdate",timeUpdate:"paella:timeupdate",seekTo:"paella:setseek",endVideo:"paella:endvideo",seekToTime:"paella:seektotime",setTrim:"paella:settrim",setPlaybackRate:"paella:setplaybackrate",setVolume:"paella:setVolume",setComposition:"paella:setComposition",loadStarted:"paella:loadStarted",loadComplete:"paella:loadComplete",loadPlugins:"paella:loadPlugins",error:"paella:error",setProfile:"paella:setprofile",documentChanged:"paella:documentChanged",didSaveChanges:"paella:didsavechanges",controlBarWillHide:"paella:controlbarwillhide",controlBarDidHide:"paella:controlbardidhide",controlBarDidShow:"paella:controlbardidshow",hidePopUp:"paella:hidePopUp",showPopUp:"paella:showPopUp",enterFullscreen:"paella:enterFullscreen",exitFullscreen:"paella:exitFullscreen",resize:"paella:resize",videoZoomChanged:"paella:videoZoomChanged",audioLanguageChanged:"paella:audiolanguagechanged",zoomAvailabilityChanged:"paella:zoomavailabilitychanged",qualityChanged:"paella:qualityChanged",singleVideoReady:"paella:singleVideoReady",singleVideoUnloaded:"paella:singleVideoUnloaded",videoReady:"paella:videoReady",videoUnloaded:"paella:videoUnloaded",controlBarLoaded:"paella:controlBarLoaded",flashVideoEvent:"paella:flashVideoEvent",captionAdded:"paella:caption:add",captionsEnabled:"paella:caption:enabled",captionsDisabled:"paella:caption:disabled",trigger:function(t,e){$(document).trigger(t,e)},bind:function(t,e){$(document).bind(t,function(t,n){e(t,n)})},setupExternalListener:function(){window.addEventListener("message",function(t){t.data&&t.data.event&&paella.events.trigger(t.data.event,t.data.params)},!1)}},paella.events.setupExternalListener(),Class("paella.MouseManager",{targetObject:null,initialize:function(){var t=this;paella.events.bind("mouseup",function(e){t.up(e)}),paella.events.bind("mousemove",function(e){t.move(e)}),paella.events.bind("mouseover",function(e){t.over(e)})},down:function(t,e){return this.targetObject=t,this.targetObject&&this.targetObject.down&&(this.targetObject.down(e,e.pageX,e.pageY),e.cancelBubble=!0),!1},up:function(t){return this.targetObject&&this.targetObject.up&&(this.targetObject.up(t,t.pageX,t.pageY),t.cancelBubble=!0),this.targetObject=null,!1},out:function(t){return this.targetObject&&this.targetObject.out&&(this.targetObject.out(t,t.pageX,t.pageY),t.cancelBubble=!0),!1},move:function(t){return this.targetObject&&this.targetObject.move&&(this.targetObject.move(t,t.pageX,t.pageY),t.cancelBubble=!0),!1},over:function(t){return this.targetObject&&this.targetObject.over&&(this.targetObject.over(t,t.pageX,t.pageY),t.cancelBubble=!0),!1}}),paella.utils={mouseManager:new paella.MouseManager,folders:{get:function(t){if(paella.player&&paella.player.config&&paella.player.config.folders&&paella.player.config.folders[t])return paella.player.config.folders[t]},profiles:function(){return paella.utils.folders.get("profiles")||"config/profiles"},resources:function(){return paella.utils.folders.get("resources")||"resources"},skins:function(){return paella.utils.folders.get("skins")||paella.utils.folders.get("resources")+"/style"}},styleSheet:{removeById:function(t){var e=$(document.head).find("#"+t)[0];e&&document.head.removeChild(e)},remove:function(t){for(var e=document.head.getElementsByTagName("link"),n=0;n<e.length;++n)if(e[n].href){document.head.removeChild(e[n]);break}},add:function(t,e){var n=document.createElement("link");n.rel="stylesheet",n.href=t,n.type="text/css",n.media="screen",n.charset="utf-8",e&&(n.id=e),document.head.appendChild(n)},swap:function(t,e){this.remove(t),this.add(e)}},skin:{set:function(t){paella.utils.styleSheet.removeById("paellaSkin"),paella.utils.styleSheet.add(paella.utils.folders.skins()+"/style_"+t+".css"),base.cookies.set("skin",t)},restore:function(t){var e=base.cookies.get("skin");e&&""!=e?this.set(e):this.set(t)}},timeParse:{timeToSeconds:function(t){var e=0,n=0,i=0;return/([0-9]+)h/i.test(t)&&(e=60*parseInt(RegExp.$1)*60),/([0-9]+)m/i.test(t)&&(n=60*parseInt(RegExp.$1)),/([0-9]+)s/i.test(t)&&(i=parseInt(RegExp.$1)),e+n+i},secondsToTime:function(t){var e=~~(t/3600);e<10&&(e="0"+e);var n=~~(t%3600/60);n<10&&(n="0"+n);var i=Math.floor(t%60);return i<10&&(i="0"+i),e+":"+n+":"+i},secondsToText:function(t){if(t<=1)return base.dictionary.translate("1 second ago");if(t<60)return base.dictionary.translate("{0} seconds ago").replace(/\{0\}/g,t);var e=Math.round(t/60);if(e<=1)return base.dictionary.translate("1 minute ago");if(e<60)return base.dictionary.translate("{0} minutes ago").replace(/\{0\}/g,e);var n=Math.round(t/3600);if(n<=1)return base.dictionary.translate("1 hour ago");if(n<24)return base.dictionary.translate("{0} hours ago").replace(/\{0\}/g,n);var i=Math.round(t/86400);if(i<=1)return base.dictionary.translate("1 day ago");if(i<24)return base.dictionary.translate("{0} days ago").replace(/\{0\}/g,i);var r=Math.round(t/2592e3);if(r<=1)return base.dictionary.translate("1 month ago");if(r<12)return base.dictionary.translate("{0} months ago").replace(/\{0\}/g,r);var a=Math.round(t/31536e3);return a<=1?base.dictionary.translate("1 year ago"):base.dictionary.translate("{0} years ago").replace(/\{0\}/g,a)},matterhornTextDateToDate:function(t){var e=new Date;return e.setFullYear(parseInt(t.substring(0,4),10)),e.setMonth(parseInt(t.substring(5,7),10)-1),e.setDate(parseInt(t.substring(8,10),10)),e.setHours(parseInt(t.substring(11,13),10)),e.setMinutes(parseInt(t.substring(14,16),10)),e.setSeconds(parseInt(t.substring(17,19),10)),e}}},Class("paella.DataDelegate",{read:function(t,e,n){"function"==typeof n&&n({},!0)},write:function(t,e,n,i){"function"==typeof i&&i({},!0)},remove:function(t,e,n){"function"==typeof n&&n({},!0)}}),paella.dataDelegates={},Class("paella.dataDelegates.CookieDataDelegate",paella.DataDelegate,{initialize:function(){},serializeKey:function(t,e){return"object"==$traceurRuntime.typeof(e)&&(e=JSON.stringify(e)),t+"|"+e},read:function(t,e,n){var i=this.serializeKey(t,e),r=base.cookies.get(i);try{r=unescape(r),r=JSON.parse(r)}catch(t){}"function"==typeof n&&n(r,!0)},write:function(t,e,n,i){var r=this.serializeKey(t,e);"object"==$traceurRuntime.typeof(n)&&(n=JSON.stringify(n)),n=escape(n),base.cookies.set(r,n),"function"==typeof i&&i({},!0)},remove:function(t,e,n){var i=this.serializeKey(t,e);"object"==$traceurRuntime.typeof(value)&&(value=JSON.stringify(value)),base.cookies.set(i,""),"function"==typeof n&&n({},!0)}}),paella.dataDelegates.DefaultDataDelegate=paella.dataDelegates.CookieDataDelegate,Class("paella.Data",{enabled:!1,dataDelegates:{},initialize:function(t){this.enabled=t.data.enabled;for(var e in t.data.dataDelegates)try{var n=t.data.dataDelegates[e],i=paella.dataDelegates[n],r=new i;this.dataDelegates[e]=r}catch(t){base.log.debug("Warning: delegate not found - "+n)}this.dataDelegates.default||(this.dataDelegates.default=new paella.dataDelegates.DefaultDataDelegate)},read:function(t,e,n){this.getDelegate(t).read(t,e,n)},write:function(t,e,n,i){this.getDelegate(t).write(t,e,n,i)},remove:function(t,e,n){this.getDelegate(t).remove(t,e,n)},getDelegate:function(t){return this.dataDelegates[t]?this.dataDelegates[t]:this.dataDelegates.default}}),paella.data=null,Class("paella.MessageBox",{modalContainerClassName:"modalMessageContainer",frameClassName:"frameContainer",messageClassName:"messageContainer",errorClassName:"errorContainer",currentMessageBox:null,messageContainer:null,onClose:null,initialize:function(){var t=this;$(window).resize(function(e){t.adjustTop()})},showFrame:function(t,e){var n=!0,i="80%",r="80%",a=null;e&&(n=e.closeButton,i=e.width,r=e.height,a=e.onClose),this.doShowFrame(t,n,i,r,a)},doShowFrame:function(t,e,n,i,r){this.onClose=r,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close(),n||(n="80%"),i||(i="80%");var a=document.createElement("div");a.className=this.modalContainerClassName,a.style.position="fixed",a.style.top="0px",a.style.left="0px",a.style.right="0px",a.style.bottom="0px",a.style.zIndex=999999;var s=document.createElement("div");s.className=this.frameClassName,s.style.width=n,s.style.height=i,s.style.position="relative",a.appendChild(s);var o=document.createElement("iframe");o.src=t,o.setAttribute("frameborder","0"),o.style.width="100%",o.style.height="100%",s.appendChild(o),paella.player.isFullScreen()?paella.player.mainContainer.appendChild(a):$("body")[0].appendChild(a),this.currentMessageBox=a,this.messageContainer=s;this.adjustTop(),e&&this.createCloseButton()},showElement:function(t,e){var n=!0,i="60%",r="40%",a=null,s=this.messageClassName;e&&(s=e.className,n=e.closeButton,i=e.width,r=e.height,a=e.onClose),this.doShowElement(t,n,i,r,s,a)},showMessage:function(t,e){var n=!0,i="60%",r="40%",a=null,s=this.messageClassName;e&&(s=e.className,n=e.closeButton,i=e.width,r=e.height,a=e.onClose),this.doShowMessage(t,n,i,r,s,a)},doShowElement:function(t,e,n,i,r,a){this.onClose=a,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close(),r||(r=this.messageClassName),n||(n="80%"),i||(i="30%");var s=document.createElement("div");s.className=this.modalContainerClassName,s.style.position="fixed",s.style.top="0px",s.style.left="0px",s.style.right="0px",s.style.bottom="0px",s.style.zIndex=999999;var o=document.createElement("div");o.className=r,o.style.width=n,o.style.height=i,o.style.position="relative",o.appendChild(t),s.appendChild(o),$("body")[0].appendChild(s),this.currentMessageBox=s,this.messageContainer=o;this.adjustTop(),e&&this.createCloseButton()},doShowMessage:function(t,e,n,i,r,a){this.onClose=a,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close(),r||(r=this.messageClassName),n||(n="80%"),i||(i="30%");var s=document.createElement("div");s.className=this.modalContainerClassName,s.style.position="fixed",s.style.top="0px",s.style.left="0px",s.style.right="0px",s.style.bottom="0px",s.style.zIndex=999999;var o=document.createElement("div");o.className=r,o.style.width=n,o.style.height=i,o.style.position="relative",o.innerHTML=t,s.appendChild(o),paella.player.isFullScreen()?paella.player.mainContainer.appendChild(s):$("body")[0].appendChild(s),this.currentMessageBox=s,this.messageContainer=o;this.adjustTop(),e&&this.createCloseButton()},showError:function(t,e){var n=!1,i="60%",r="20%",a=null;e&&(n=e.closeButton,i=e.width,r=e.height,a=e.onClose),this.doShowError(t,n,i,r,a)},doShowError:function(t,e,n,i,r){this.doShowMessage(t,e,n,i,this.errorClassName,r)},createCloseButton:function(){if(this.messageContainer){var t=this,e=document.createElement("div");this.messageContainer.appendChild(e),e.className="paella_messageContainer_closeButton",$(e).click(function(e){t.onCloseButtonClick()})}},adjustTop:function(){if(this.currentMessageBox){var t=$(this.messageContainer).outerHeight(),e=$(this.currentMessageBox).height(),n=e/2-t/2;this.messageContainer.style.marginTop=n+"px"}},close:function(){if(this.currentMessageBox&&this.currentMessageBox.parentNode){var t=this.currentMessageBox,e=t.parentNode;$("#playerContainer").removeClass("modalVisible"),$(t).animate({opacity:0},300,function(){e.removeChild(t)}),this.onClose&&this.onClose()}},onCloseButtonClick:function(){this.close()}}),paella.messageBox=new paella.MessageBox,paella.AntiXSS={htmlEscape:function(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlUnescape:function(t){return String(t).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}},Class("paella.Node",{identifier:"",nodeList:null,parent:null,initialize:function(t){this.nodeList={},this.identifier=t},addTo:function(t){t.addNode(this)},addNode:function(t){return t.parent=this,this.nodeList[t.identifier]=t,t},getNode:function(t){return this.nodeList[t]},removeNode:function(t){return!!this.nodeList[t.identifier]&&(delete this.nodeList[t.identifier],!0)}}),Class("paella.DomNode",paella.Node,{domElement:null,initialize:function(t,e,n){this.parent(e),this.domElement=document.createElement(t),this.domElement.id=e,n&&$(this.domElement).css(n)},addNode:function(t){var e=this.parent(t);return this.domElement.appendChild(t.domElement),e},onresize:function(){},removeNode:function(t){this.parent(t)&&this.domElement.removeChild(t.domElement)}}),Class("paella.Button",paella.DomNode,{isToggle:!1,initialize:function(t,e,n,i){this.isToggle=i;var r={};if(this.parent("div",t,r),this.domElement.className=e,i){var a=this;$(this.domElement).click(function(t){a.toggleIcon()})}$(this.domElement).click("click",n)},isToggled:function(){if(this.isToggle){return/([a-zA-Z0-9_]+)_active/.test(this.domElement.className)}return!1},toggle:function(){this.toggleIcon()},toggleIcon:function(){var t=this.domElement;/([a-zA-Z0-9_]+)_active/.test(t.className)?t.className=RegExp.$1:t.className=t.className+"_active"},show:function(){$(this.domElement).show()},hide:function(){$(this.domElement).hide()},visible:function(){return this.domElement.visible()}}),Class("paella.VideoQualityStrategy",{getParams:function(){return paella.player.config.player.videoQualityStrategyParams||{}},getQualityIndex:function(t){return t.length>0?t[t.length-1]:t}}),Class("paella.BestFitVideoQualityStrategy",paella.VideoQualityStrategy,{getQualityIndex:function(t){var e=t.length-1;if(t.length>0){var n=t[0],i=$(window).width(),r=$(window).height(),a=i*r;if(n.res&&n.res.w&&n.res.h)for(var s=parseInt(n.res.w)*parseInt(n.res.h),o=Math.abs(a-s),u=0;u<t.length;++u){var l=t[u].res;if(l){var c=parseInt(t[u].res.w)*parseInt(t[u].res.h),h=Math.abs(a-c);h<=o&&(o=h,e=u)}}}return e}}),Class("paella.LimitedBestFitVideoQualityStrategy",paella.VideoQualityStrategy,{getQualityIndex:function(t){var e=t.length-1,n=this.getParams();if(t.length>0){var i=null,r=$(window).height(),a=n.maxAutoQualityRes||720,s=Number.MAX_VALUE;t.forEach(function(t,n){if(t.res&&t.res.h<=a){Math.abs(r-t.res.h)<s&&(i=t,e=n)}})}return e}}),Class("paella.VideoFactory",{isStreamCompatible:function(t){return!1},getVideoObject:function(t,e,n){return null}}),paella.videoFactory={_factoryList:[],initFactories:function(){if(paella.videoFactories){var t=this;paella.player.config.player.methods.forEach(function(e){e.enabled&&t.registerFactory(new paella.videoFactories[e.factory])}),this.registerFactory(new paella.videoFactories.EmptyVideoFactory)}},getVideoObject:function(t,e,n){0==this._factoryList.length&&this.initFactories();var i=null;return this._factoryList.some(function(t){if(t.isStreamCompatible(e))return i=t,!0})?i.getVideoObject(t,e,n):null},registerFactory:function(t){this._factoryList.push(t)}},function(){var t=function(t){function e(t,n){$traceurRuntime.superConstructor(e).call(this,"div",t),this._stream=n}return $traceurRuntime.createClass(e,{get stream(){return this._stream},setAutoplay:function(){return Promise.reject(new Error("no such compatible video player"))},load:function(){return Promise.reject(new Error("no such compatible video player"))},play:function(){return Promise.reject(new Error("no such compatible video player"))},pause:function(){return Promise.reject(new Error("no such compatible video player"))},isPaused:function(){return Promise.reject(new Error("no such compatible video player"))},duration:function(){return Promise.reject(new Error("no such compatible video player"))},setCurrentTime:function(t){return Promise.reject(new Error("no such compatible video player"))},currentTime:function(){return Promise.reject(new Error("no such compatible video player"))},setVolume:function(t){return Promise.reject(new Error("no such compatible video player"))},volume:function(){return Promise.reject(new Error("no such compatible video player"))},setPlaybackRate:function(t){return Promise.reject(new Error("no such compatible video player"))},playbackRate:function(){return Promise.reject(new Error("no such compatible video player"))},unload:function(){return Promise.reject(new Error("no such compatible video player"))},supportAutoplay:function(){return!1}},{},t)}(paella.DomNode);paella.AudioElementBase=t,paella.audioFactories={};var e=function(){function t(){}return $traceurRuntime.createClass(t,{isStreamCompatible:function(t){return!1},getAudioObject:function(t,e){return null}},{})}();paella.AudioFactory=e,paella.audioFactory={_factoryList:[],initFactories:function(){if(paella.audioFactories){var t=this;paella.player.config.player.audioMethods=paella.player.config.player.audioMethods||{},paella.player.config.player.audioMethods.forEach(function(e){e.enabled&&t.registerFactory(new paella.audioFactories[e.factory])})}},getAudioObject:function(t,e){0==this._factoryList.length&&this.initFactories();var n=null;return this._factoryList.some(function(t){if(t.isStreamCompatible(e))return n=t,!0})?n.getAudioObject(t,e):null},registerFactory:function(t){this._factoryList.push(t)}}}(),function(){function t(t){var e=this;return new Promise(function(n,i){if(e._ready)n("function"!=typeof t||t());else{var r=function(){e.audio.readyState>=e.audio.HAVE_CURRENT_DATA?(e._ready=!0,n("function"!=typeof t||t())):setTimeout(r,50)};r()}})}var e=function(e){function n(t,e){$traceurRuntime.superConstructor(n).call(this,t,e),this._streamName="audio",this._audio=document.createElement("audio"),this.domElement.appendChild(this._audio)}return $traceurRuntime.createClass(n,{get audio(){return this._audio},setAutoplay:function(t){this.audio.autoplay=t},load:function(){var e=this._stream.sources[this._streamName],n=e.length>0?e[0]:null;if(this.audio.innerHTML="",n){var i=this.audio.querySelector("source");return i||(i=document.createElement("source"),this.audio.appendChild(i)),i.src=n.src,n.type&&(i.type=n.type),this.audio.load(),t.apply(this,[function(){return n}])}return Promise.reject(new Error("Could not load video: invalid quality stream index"))},play:function(){var e=this;return t.apply(this,[function(){e.audio.play()}])},pause:function(){var e=this;return t.apply(this,[function(){e.audio.pause()}])},isPaused:function(){var e=this;return t.apply(this,[function(){return e.audio.paused}])},duration:function(){var e=this;return t.apply(this,[function(){return e.audio.duration}])},setCurrentTime:function(e){var n=this;return t.apply(this,[function(){n.audio.currentTime=e}])},currentTime:function(){var e=this;return t.apply(this,[function(){return e.audio.currentTime}])},setVolume:function(e){var n=this;return t.apply(this,[function(){return n.audio.volume=e}])},volume:function(){var e=this;return t.apply(this,[function(){return e.audio.volume}])},setPlaybackRate:function(e){var n=this;return t.apply(this,[function(){n.audio.playbackRate=e}])},playbackRate:function(){var e=this;return t.apply(this,[function(){return e.audio.playbackRate}])},unload:function(){return Promise.resolve()}},{},e)}(paella.AudioElementBase);paella.MultiformatAudioElement=e;var n=function(){function t(){}return $traceurRuntime.createClass(t,{isStreamCompatible:function(t){return!0},getAudioObject:function(t,e){return new paella.MultiformatAudioElement(t,e)}},{})}();paella.audioFactories.MultiformatAudioFactory=n}(),paella.Profiles={profileList:null,getDefaultProfile:function(){return paella.player.videoContainer.masterVideo()&&paella.player.videoContainer.masterVideo().defaultProfile()?paella.player.videoContainer.masterVideo().defaultProfile():paella.player&&paella.player.config&&paella.player.config.defaultProfile?paella.player.config.defaultProfile:void 0},loadProfile:function(t,e){var n=this.getDefaultProfile();this.loadProfileList(function(i){var r;if(i[t])r=i[t];else{if(!i[n])return base.log.debug("Error loading the default profile. Check your Paella Player configuration"),!1;r=i[n]}e(r)})},loadProfileList:function(t){var e=this
;if(null==this.profileList){var n={url:paella.utils.folders.profiles()+"/profiles.json"};base.ajax.get(n,function(n,i,r){"string"==typeof n&&(n=JSON.parse(n)),e.profileList=n,t(e.profileList)},function(t,e,n){base.log.debug("Error loading video profiles. Check your Paella Player configuration")})}else t(e.profileList)}},Class("paella.RelativeVideoSize",{w:1280,h:720,proportionalHeight:function(t){return Math.floor(this.h*t/this.w)},proportionalWidth:function(t){return Math.floor(this.w*t/this.h)},percentVSize:function(t){return 100*t/this.h},percentWSize:function(t){return 100*t/this.w},aspectRatio:function(){return this.w/this.h}}),Class("paella.VideoRect",paella.DomNode,{_rect:null,initialize:function(t,e,n,i,r,a){var s=this,o=paella.player.config.player.videoZoom||{},u=(void 0===o.enabled||o.enabled)&&this.allowZoom();this.parent(e,t,u?{width:this._zoom+"%",height:"100%",position:"absolute"}:{width:"100%"});var l=document.createElement("div");if(setTimeout(function(){return s.domElement.parentElement.appendChild(l)},10),l.style.position="absolute",l.style.top="0px",l.style.left="0px",l.style.right="0px",l.style.bottom="0px",u){var c=function(){var t=paella.player.config.player&&paella.player.config.player.videoZoom&&paella.player.config.player.videoZoom.minWindowSize||500,e=$(window).width()>=t;this._zoomAvailable!=e&&(this._zoomAvailable=e,paella.events.trigger(paella.events.zoomAvailabilityChanged,{available:e}))},h=function(t){return{x:t.originalEvent.offsetX,y:t.originalEvent.offsetY}},f=function(t){var e=t.originalEvent.deltaY*(paella.utils.userAgent.Firefox?2:1);return-Math.abs(e)<6?e:6*Math.sign(e)},d=function(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},g=function(t,e){return{x:(e.x-t.x)/2+t.x,y:(e.y-t.y)/2+t.y}},m=function(t){var e={x:this._mouseCenter.x-1.1*t.x,y:this._mouseCenter.y-1.1*t.y},n={w:$(this.domElement).width(),h:$(this.domElement).height()},i=this._zoom-100,r={x:e.x*i/n.w,y:e.y*i/n.h};r.x>i?r.x=i:r.x<0?r.x=0:this._mouseCenter.x=e.x,r.y>i?r.y=i:r.y<0?r.y=0:this._mouseCenter.y=e.y,$(this.domElement).css({left:"-"+r.x+"%",top:"-"+r.y+"%"}),this._zoomOffset={x:r.x,y:r.y},paella.events.trigger(paella.events.videoZoomChanged,{video:this})};this._zoomAvailable=!0,c.apply(this),$(window).resize(function(){c.apply(s)}),this._zoom=100,this._mouseCenter={x:0,y:0},this._mouseDown={x:0,y:0},this._zoomOffset={x:0,y:0},this._maxZoom=o.max||400,$(this.domElement).css({width:"100%",height:"100%",left:"0%",top:"0%"}),Object.defineProperty(this,"zoom",{get:function(){return this._zoom}}),Object.defineProperty(this,"zoomOffset",{get:function(){return this._zoomOffset}});var p=[];$(l).on("touchstart",function(t){if(s.allowZoom()&&s._zoomAvailable){p=[];for(var e=$(s.domElement).offset(),n=0;n<t.originalEvent.targetTouches.length;++n){var i=t.originalEvent.targetTouches[n];p.push({x:i.screenX-e.left,y:i.screenY-e.top})}p.length>1&&t.preventDefault()}}),$(l).on("touchmove",function(t){if(s.allowZoom()&&s._zoomAvailable){for(var e=[],n=$(s.domElement).offset(),i=0;i<t.originalEvent.targetTouches.length;++i){var r=t.originalEvent.targetTouches[i];e.push({x:r.screenX-n.left,y:r.screenY-n.top})}if(e.length>1&&p.length>1){var a=d(p[0],p[1]),o=d(e[0],e[1]),u=o-a,l=g(p[0],p[1]);s._mouseCenter=l,s._zoom+=u,s._zoom=s._zoom<100?100:s._zoom,s._zoom=s._zoom>s._maxZoom?s._maxZoom:s._zoom;var c={w:$(s.domElement).width(),h:$(s.domElement).height()},h=s._mouseCenter;$(s.domElement).css({width:s._zoom+"%",height:s._zoom+"%"});var f=s._zoom-100,b={x:h.x*f/c.w,y:h.y*f/c.h};b.x=b.x<f?b.x:f,b.y=b.y<f?b.y:f,$(s.domElement).css({left:"-"+b.x+"%",top:"-"+b.y+"%"}),s._zoomOffset={x:b.x,y:b.y},paella.events.trigger(paella.events.videoZoomChanged,{video:s}),p=e,t.preventDefault()}else if(e.length>0){var _={x:e[0].x-p[0].x,y:e[0].y-p[0].y};m.apply(s,[_]),p=e,t.preventDefault()}}}),$(l).on("touchend",function(t){s.allowZoom()&&s._zoomAvailable&&p.length>1&&t.preventDefault()}),this.zoomIn=function(){if(!(s._zoom>=s._maxZoom)&&s._zoomAvailable){s._mouseCenter||(s._mouseCenter={x:$(s.domElement).width()/2,y:$(s.domElement).height()/2}),s._zoom+=25,s._zoom=s._zoom<100?100:s._zoom,s._zoom=s._zoom>s._maxZoom?s._maxZoom:s._zoom;var t={w:$(s.domElement).width(),h:$(s.domElement).height()},e=s._mouseCenter;$(s.domElement).css({width:s._zoom+"%",height:s._zoom+"%"});var n=s._zoom-100,i={x:e.x*n/t.w,y:e.y*n/t.h};i.x=i.x<n?i.x:n,i.y=i.y<n?i.y:n,$(s.domElement).css({left:"-"+i.x+"%",top:"-"+i.y+"%"}),s._zoomOffset={x:i.x,y:i.y},paella.events.trigger(paella.events.videoZoomChanged,{video:s})}},this.zoomOut=function(){if(!(s._zoom<=100)&&s._zoomAvailable){s._mouseCenter||(s._mouseCenter={x:$(s.domElement).width()/2,y:$(s.domElement).height()/2}),s._zoom-=25,s._zoom=s._zoom<100?100:s._zoom,s._zoom=s._zoom>s._maxZoom?s._maxZoom:s._zoom;var t={w:$(s.domElement).width(),h:$(s.domElement).height()},e=s._mouseCenter;$(s.domElement).css({width:s._zoom+"%",height:s._zoom+"%"});var n=s._zoom-100,i={x:e.x*n/t.w,y:e.y*n/t.h};i.x=i.x<n?i.x:n,i.y=i.y<n?i.y:n,$(s.domElement).css({left:"-"+i.x+"%",top:"-"+i.y+"%"}),s._zoomOffset={x:i.x,y:i.y},paella.events.trigger(paella.events.videoZoomChanged,{video:s})}},$(l).on("mousewheel wheel",function(t){if(s.allowZoom()&&s._zoomAvailable){var e=h(t),n=f(t);if(!(s._zoom>=s._maxZoom&&n>0)){s._zoom+=n,s._zoom=s._zoom<100?100:s._zoom,s._zoom=s._zoom>s._maxZoom?s._maxZoom:s._zoom;var i={w:$(s.domElement).width(),h:$(s.domElement).height()};$(s.domElement).css({width:s._zoom+"%",height:s._zoom+"%"});var r=s._zoom-100,a={x:e.x*r/i.w,y:e.y*r/i.h};a.x=a.x<r?a.x:r,a.y=a.y<r?a.y:r,$(s.domElement).css({left:"-"+a.x+"%",top:"-"+a.y+"%"}),s._zoomOffset={x:a.x,y:a.y},paella.events.trigger(paella.events.videoZoomChanged,{video:s}),s._mouseCenter=e}}}),$(l).on("mousedown",function(t){s._mouseDown=h(t),s.drag=!0}),$(l).on("mousemove",function(t){if(s.allowZoom()&&s._zoomAvailable&&s.drag){paella.player.videoContainer.disablePlayOnClick();var e=h(t);m.apply(s,[{x:e.x-s._mouseDown.x,y:e.y-s._mouseDown.y}]),s._mouseDown=e}}),$(l).on("mouseup",function(t){s.allowZoom()&&s._zoomAvailable&&(s.drag=!1,setTimeout(function(){return paella.player.videoContainer.enablePlayOnClick()},10))}),$(l).on("mouseleave",function(t){s.drag=!1})}},allowZoom:function(){return!0},captureFrame:function(){return Promise.resolve(null)},supportsCaptureFrame:function(){return Promise.resolve(!1)},zoomAvailable:function(){return this.allowZoom()&&this._zoomAvailable}}),Class("paella.VideoElementBase",paella.VideoRect,{_ready:!1,_autoplay:!1,_stream:null,_videoQualityStrategy:null,initialize:function(t,e,n,i,r,a,s){this._stream=e,this.parent(t,n,i,r,a,s),Object.defineProperty(this,"ready",{get:function(){return this._ready}}),Object.defineProperty(this,"stream",{get:function(){return this._stream}}),this._stream.preview&&this.setPosterFrame(this._stream.preview)},defaultProfile:function(){return null},setVideoQualityStrategy:function(t){this._videoQualityStrategy=t},setPosterFrame:function(t){base.log.debug("TODO: implement setPosterFrame() function")},setAutoplay:function(t){this._autoplay=t},setMetadata:function(t){this._metadata=t},load:function(){return paella_DeferredNotImplemented()},supportAutoplay:function(){return!0},getVideoData:function(){return paella_DeferredNotImplemented()},play:function(){return base.log.debug("TODO: implement play() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},pause:function(){return base.log.debug("TODO: implement pause() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},isPaused:function(){return base.log.debug("TODO: implement isPaused() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},duration:function(){return base.log.debug("TODO: implement duration() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setCurrentTime:function(t){return base.log.debug("TODO: implement setCurrentTime() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},currentTime:function(){return base.log.debug("TODO: implement currentTime() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setVolume:function(t){return base.log.debug("TODO: implement setVolume() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},volume:function(){return base.log.debug("TODO: implement volume() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setPlaybackRate:function(t){return base.log.debug("TODO: implement setPlaybackRate() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},playbackRate:function(){return base.log.debug("TODO: implement playbackRate() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},getQualities:function(){return paella_DeferredNotImplemented()},setQuality:function(t){return paella_DeferredNotImplemented()},getCurrentQuality:function(){return paella_DeferredNotImplemented()},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()},goFullScreen:function(){return paella_DeferredNotImplemented()},freeze:function(){return paella_DeferredNotImplemented()},unFreeze:function(){return paella_DeferredNotImplemented()},setClassName:function(t){this.domElement.className=t},_callReadyEvent:function(){paella.events.trigger(paella.events.singleVideoReady,{sender:this})},_callUnloadEvent:function(){paella.events.trigger(paella.events.singleVideoUnloaded,{sender:this})}}),Class("paella.EmptyVideo",paella.VideoElementBase,{initialize:function(t,e,n,i,r,a){this.parent(t,e,"div",n,i,r,a)},setPosterFrame:function(t){},setAutoplay:function(t){},load:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},play:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},pause:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},isPaused:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},duration:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setCurrentTime:function(t){return paella_DeferredRejected(new Error("no such compatible video player"))},currentTime:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setVolume:function(t){return paella_DeferredRejected(new Error("no such compatible video player"))},volume:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setPlaybackRate:function(t){return paella_DeferredRejected(new Error("no such compatible video player"))},playbackRate:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},unFreeze:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},freeze:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},unload:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},getDimensions:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}}),Class("paella.videoFactories.EmptyVideoFactory",paella.VideoFactory,{isStreamCompatible:function(t){return!0},getVideoObject:function(t,e,n){return new paella.EmptyVideo(t,e,n.x,n.y,n.w,n.h)}}),Class("paella.Html5Video",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(t,e,n,i,r,a,s){function o(t){l._ready||4!=l.video.readyState||(l._ready=!0,void 0!==l._initialCurrentTipe&&(l.video.currentTime=l._initialCurrentTime,delete l._initialCurrentTime),l._callReadyEvent())}function u(t){o.apply(l,t)}this.parent(t,e,"video",n,i,r,a),this._streamName=s||"mp4";var l=this;this._playbackRate=1,this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(t,e){return t.res.h-e.res.h}),Object.defineProperty(this,"video",{get:function(){return l.domElement}}),this.video.preload="auto",this.video.setAttribute("playsinline",""),$(this.video).bind("progress",u),$(this.video).bind("loadstart",u),$(this.video).bind("loadedmetadata",u),$(this.video).bind("canplay",u),$(this.video).bind("oncanplay",u)},_deferredAction:function(t){var e=this;return new Promise(function(n,i){e.ready?n(t()):$(e.video).bind("canplay",function(){e._ready=!0,n(t())})})},_getQualityObject:function(t,e){return{index:t,res:e.res,src:e.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(t){return this.res.w*this.res.h-t.res.w*t.res.h}}},captureFrame:function(){var t=this;return new Promise(function(e){e({source:t.video,width:t.video.videoWidth,height:t.video.videoHeight})})},supportsCaptureFrame:function(){return Promise.resolve(!0)},getVideoData:function(){var t=this,e=this;return new Promise(function(n,i){t._deferredAction(function(){n({duration:e.video.duration,currentTime:e.video.currentTime,volume:e.video.volume,paused:e.video.paused,ended:e.video.ended,res:{w:e.video.videoWidth,h:e.video.videoHeight}})})})},setPosterFrame:function(t){this._posterFrame=t},setAutoplay:function(t){this._autoplay=t,t&&this.video&&this.video.setAttribute("autoplay",t)},load:function(){var t=this._stream.sources[this._streamName];null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(t));var e=this._currentQuality<t.length?t[this._currentQuality]:null;if(this.video.innerHTML="",e){var n=this.video.querySelector("source");return n||(n=document.createElement("source"),this.video.appendChild(n)),this._posterFrame&&this.video.setAttribute("poster",this._posterFrame),n.src=e.src,n.type=e.type,this.video.load(),this.video.playbackRate=this._playbackRate,this._deferredAction(function(){return e})}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},getQualities:function(){var t=this;return new Promise(function(e,n){setTimeout(function(){var n=[],i=t._stream.sources[t._streamName],r=-1;i.forEach(function(e){r++,n.push(t._getQualityObject(r,e))}),e(n)},10)})},setQuality:function(t){var e=this;return new Promise(function(n){var i=e.video.paused,r=e._stream.sources[e._streamName];e._currentQuality=t<r.length?t:0;var a=e.video.currentTime,s=e,o=function(){s.unFreeze().then(function(){n(),s.video.removeEventListener("seeked",o,!1)})};e.freeze().then(function(){return e.load()}).then(function(){i||e.play(),e.video.addEventListener("seeked",o),e.video.currentTime=a})})},getCurrentQuality:function(){var t=this;return new Promise(function(e){e(t._getQualityObject(t._currentQuality,t._stream.sources[t._streamName][t._currentQuality]))})},play:function(){var t=this;return this._deferredAction(function(){t.video.play()})},pause:function(){var t=this;return this._deferredAction(function(){t.video.pause()})},isPaused:function(){var t=this;return this._deferredAction(function(){return t.video.paused})},duration:function(){var t=this;return this._deferredAction(function(){return t.video.duration})},setCurrentTime:function(t){var e=this;return this._deferredAction(function(){e.video.currentTime=t})},currentTime:function(){var t=this;return this._deferredAction(function(){return t.video.currentTime})},setVolume:function(t){var e=this;return this._deferredAction(function(){e.video.volume=t,0==t?(e.video.setAttribute("muted","muted"),e.video.muted=!0):(e.video.removeAttribute("muted"),e.video.muted=!1)})},volume:function(){var t=this;return this._deferredAction(function(){return t.video.volume})},setPlaybackRate:function(t){var e=this;return this._deferredAction(function(){e._playbackRate=t,e.video.playbackRate=t})},playbackRate:function(){var t=this;return this._deferredAction(function(){return t.video.playbackRate})},supportAutoplay:function(){var t=paella.utils.userAgent.system.MacOS&&paella.utils.userAgent.system.Version.minor>=13&&paella.utils.userAgent.browser.Safari,e=paella.utils.userAgent.system.iOS,n=paella.utils.userAgent.browser.Chrome&&paella.utils.userAgent.browser.Version.major>=64;return!(t||e||n)},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){var t=this;return this._deferredAction(function(){var e=document.getElementById(t.video.className+"canvas");e&&$(e).remove()})},freeze:function(){var t=this;return this._deferredAction(function(){var e=document.createElement("canvas");e.id=t.video.className+"canvas",e.width=t.video.videoWidth,e.height=t.video.videoHeight,e.style.cssText=t.video.style.cssText,e.style.zIndex=2,e.getContext("2d").drawImage(t.video,0,0,16*Math.ceil(e.width/16),16*Math.ceil(e.height/16)),t.video.parentElement.appendChild(e)})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.Html5VideoFactory",{isStreamCompatible:function(t){try{if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS&&paella.utils.userAgent.system.Version.major<=10&&paella.utils.userAgent.system.Version.minor<3)return!1;for(var e in t.sources)if("mp4"==e)return!0}catch(t){}return!1},getVideoObject:function(t,e,n){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Html5Video(t,e,n.x,n.y,n.w,n.h)}}),paella.videoFactories.Html5VideoFactory.s_instances=0,Class("paella.ImageVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_currentTime:0,_duration:0,_ended:!1,_playTimer:null,_playbackRate:1,_frameArray:null,initialize:function(t,e,n,i,r,a){this.parent(t,e,"img",n,i,r,a);var s=this;this._stream.sources.image.sort(function(t,e){return t.res.h-e.res.h}),Object.defineProperty(this,"img",{get:function(){return s.domElement}}),Object.defineProperty(this,"imgStream",{get:function(){return this._stream.sources.image[this._currentQuality]}}),Object.defineProperty(this,"_paused",{get:function(){return null==this._playTimer}})},_deferredAction:function(t){var e=this;return new Promise(function(n){if(e.ready)n(t());else{var n=function(){e._ready=!0,n(t())};$(e.video).bind("paella:imagevideoready",n)}})},_getQualityObject:function(t,e){return{index:t,res:e.res,src:e.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(t){return this.res.w*this.res.h-t.res.w*t.res.h}}},_loadCurrentFrame:function(){var t=this;if(this._frameArray){var e=this._frameArray[0];this._frameArray.some(function(n){if(t._currentTime<n.time)return!0;e=n.src}),this.img.src=e}},allowZoom:function(){return!1},getVideoData:function(){var t=this,e=this;return new Promise(function(n){t._deferredAction(function(){var t={duration:e._duration,currentTime:e._currentTime,volume:0,paused:e._paused,ended:e._ended,res:{w:e.imgStream.res.w,h:e.imgStream.res.h}};n(t)})})},setPosterFrame:function(t){this._posterFrame=t},setAutoplay:function(t){this._autoplay=t,t&&this.video&&this.video.setAttribute("autoplay",t)},load:function(){var t=this._stream.sources.image;null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(t));var e=this._currentQuality<t.length?t[this._currentQuality]:null;if(e){this._frameArray=[];for(var n in e.frames){var i=Math.floor(Number(n.replace("frame_","")));this._frameArray.push({src:e.frames[n],time:i})}return this._frameArray.sort(function(t,e){return t.time-e.time}),this._ready=!0,this._currentTime=0,this._duration=e.duration,this._loadCurrentFrame(),paella.events.trigger("paella:imagevideoready"),this._deferredAction(function(){return e})}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},supportAutoplay:function(){return!0},getQualities:function(){var t=this;return new Promise(function(e){setTimeout(function(){var n=[],i=t._stream.sources[t._streamName],r=-1;i.forEach(function(e){r++,n.push(t._getQualityObject(r,e))}),e(n)},10)})},setQuality:function(t){var e=this;return new Promise(function(n){var i=(e._paused,e._stream.sources.image);e._currentQuality=t<i.length?t:0;e._currentTime;e.load().then(function(){this._loadCurrentFrame(),n()})})},getCurrentQuality:function(){var t=this;return new Promise(function(e){e(t._getQualityObject(t._currentQuality,t._stream.sources.image[t._currentQuality]))})},play:function(){var t=this;return this._deferredAction(function(){t._playTimer=new base.Timer(function(){t._currentTime+=.25*t._playbackRate,t._loadCurrentFrame()},250),t._playTimer.repeat=!0})},pause:function(){var t=this;return this._deferredAction(function(){t._playTimer.repeat=!1,t._playTimer=null})},isPaused:function(){var t=this;return this._deferredAction(function(){return t._paused})},duration:function(){var t=this;return this._deferredAction(function(){return t._duration})},setCurrentTime:function(t){var e=this;return this._deferredAction(function(){e._currentTime=t,e._loadCurrentFrame()})},currentTime:function(){var t=this;return this._deferredAction(function(){return t._currentTime})},setVolume:function(t){return this._deferredAction(function(){})},volume:function(){return this._deferredAction(function(){return 0})},setPlaybackRate:function(t){var e=this;return this._deferredAction(function(){e._playbackRate=t})},playbackRate:function(){var t=this;return this._deferredAction(function(){return t._playbackRate})},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.img;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){return this._deferredAction(function(){})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.ImageVideoFactory",{isStreamCompatible:function(t){try{for(var e in t.sources)if("image"==e)return!0}catch(t){}return!1},getVideoObject:function(t,e,n){return new paella.ImageVideo(t,e,n.x,n.y,n.w,n.h)}}),Class("paella.BackgroundContainer",paella.DomNode,{initialize:function(t,e){this.parent("img",t,{position:"relative",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:GlobalParams.background.zIndex}),this.domElement.setAttribute("src",e),this.domElement.setAttribute("alt",""),this.domElement.setAttribute("width","100%"),this.domElement.setAttribute("height","100%")},setImage:function(t){this.domElement.setAttribute("src",t)}}),Class("paella.VideoOverlay",paella.DomNode,{size:{w:1280,h:720},initialize:function(){var t={position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden",zIndex:10};this.parent("div","overlayContainer",t),this.domElement.setAttribute("role","main")},_generateId:function(){return Math.ceil(Date.now()*Math.random())},enableBackgroundMode:function(){this.domElement.className="overlayContainer background"},disableBackgroundMode:function(){this.domElement.className="overlayContainer"},clear:function(){this.domElement.innerHTML=""},getMasterRect:function(){return paella.player.videoContainer.getMasterVideoRect()},getSlaveRect:function(){return paella.player.videoContainer.getSlaveVideoRect()},addText:function(t,e,n){var i=document.createElement("div");return i.innerHTML=t,i.className="videoOverlayText",n&&(i.style.backgroundColor="red"),this.addElement(i,e)},addElement:function(t,e){return this.domElement.appendChild(t),t.style.position="absolute",t.style.left=this.getHSize(e.left)+"%",t.style.top=this.getVSize(e.top)+"%",t.style.width=this.getHSize(e.width)+"%",t.style.height=this.getVSize(e.height)+"%",t},getLayer:function(t,e){return t=t||this._generateId(),$(this.domElement).find("#"+t)[0]||this.addLayer(t,e)},addLayer:function(t,e){e=e||10;var n=document.createElement("div");return n.className="row",n.id=t||this._generateId(),this.addElement(n,{left:0,top:0,width:1280,height:720})},removeLayer:function(t){var e=$(this.domElement).find("#"+t)[0];e&&this.domElement.removeChild(e)},removeElement:function(t){if(t)try{this.domElement.removeChild(t)}catch(t){}},getVSize:function(t){return 100*t/this.size.h},getHSize:function(t){return 100*t/this.size.w}}),function(){var t=function(t){function e(t,n,i,r,a){var s=new paella.RelativeVideoSize,o=s.percentVSize(i)+"%",u=s.percentWSize(n)+"%",l=s.percentWSize(r)+"%",c=s.percentVSize(a)+"%",h={top:o,left:u,width:l,height:c,position:"absolute",zIndex:GlobalParams.video.zIndex,overflow:"hidden"};$traceurRuntime.superConstructor(e).call(this,"div",t,h),this._rect={left:n,top:i,width:r,height:a},this.domElement.className="videoWrapper"}return $traceurRuntime.createClass(e,{setRect:function(t,e){this._rect=JSON.parse(JSON.stringify(t));var n=new paella.RelativeVideoSize,i=n.percentVSize(t.top)+"%",r=n.percentWSize(t.left)+"%",a=n.percentWSize(t.width)+"%",s=n.percentVSize(t.height)+"%",o={top:i,left:r,width:a,height:s,position:"absolute"};if(e){this.disableClassName();var u=this;$(this.domElement).animate(o,400,function(){u.enableClassName(),paella.events.trigger(paella.events.setComposition,{video:u})}),this.enableClassNameAfter(400)}else $(this.domElement).css(o),paella.events.trigger(paella.events.setComposition,{video:this})},getRect:function(){return this._rect},disableClassName:function(){this.classNameBackup=this.domElement.className,this.domElement.className=""},enableClassName:function(){this.domElement.className=this.classNameBackup},enableClassNameAfter:function(t){setTimeout("$('#"+this.domElement.id+"')[0].className = '"+this.classNameBackup+"'",t)},setVisible:function(t,e){"true"==t&&e?($(this.domElement).show(),$(this.domElement).animate({opacity:1},300)):"true"!=t||e?"false"==t&&e?$(this.domElement).animate({opacity:0},300):"false"!=t||e||$(this.domElement).hide():$(this.domElement).show()},setLayer:function(t){this.domElement.style.zIndex=t}},{},t)}(paella.DomNode);paella.VideoWrapper=t}(),Class("paella.VideoContainerBase",paella.DomNode,{_trimming:{enabled:!1,start:0,end:0},timeupdateEventTimer:null,timeupdateInterval:250,masterVideoData:null,slaveVideoData:null,currentMasterVideoData:null,currentSlaveVideoData:null,_force:!1,_playOnClickEnabled:!0,initialize:function(t){var e=this,n={position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden"};this.parent("div",t,n),$(this.domElement).click(function(t){e.firstClick&&base.userAgent.browser.IsMobileVersion||e.firstClick&&!e._playOnClickEnabled||paella.player.videoContainer.paused().then(function(t){e.firstClick=!0,t?paella.player.play():paella.player.pause()})}),this.domElement.addEventListener("touchstart",function(t){paella.player.controls&&paella.player.controls.restartHideTimer()})},triggerTimeupdate:function(){var t=this,e=0,n=0;this.paused().then(function(n){return e=n,t.duration()}).then(function(e){return n=e,t.currentTime()}).then(function(i){e&&!t._force||(t._force=!1,paella.events.trigger(paella.events.timeupdate,{videoContainer:t,currentTime:i,duration:n}))})},startTimeupdate:function(){var t=this;this.timeupdateEventTimer=new Timer(function(e){t.triggerTimeupdate()},this.timeupdateInterval),this.timeupdateEventTimer.repeat=!0},stopTimeupdate:function(){this.timeupdateEventTimer&&(this.timeupdateEventTimer.repeat=!1),this.timeupdateEventTimer=null},enablePlayOnClick:function(){this._playOnClickEnabled=!0},disablePlayOnClick:function(){this._playOnClickEnabled=!1},isPlayOnClickEnabled:function(){return this._playOnClickEnabled},play:function(){paella.events.trigger(paella.events.play),this.startTimeupdate()},pause:function(){paella.events.trigger(paella.events.pause),this.stopTimeupdate()},seekTo:function(t){var e=this,n=this;this.setCurrentPercent(t).then(function(i){n._force=!0,e.triggerTimeupdate(),paella.events.trigger(paella.events.seekToTime,{newPosition:i.time}),paella.events.trigger(paella.events.seekTo,{newPositionPercent:t})})},seekToTime:function(t){var e=this;this.setCurrentTime(t).then(function(t){e._force=!0,e.triggerTimeupdate();var n=100*t.time/t.duration;paella.events.trigger(paella.events.seekToTime,{newPosition:t.time}),paella.events.trigger(paella.events.seekTo,{newPositionPercent:n})})},setPlaybackRate:function(t){paella.events.trigger(paella.events.setPlaybackRate,{rate:t})},setVolume:function(t){},volume:function(){return 1},trimStart:function(){var t=this;return new Promise(function(e){e(t._trimming.start)})},trimEnd:function(){var t=this;return new Promise(function(e){e(t._trimming.end)})},trimEnabled:function(){var t=this;return new Promise(function(e){e(t._trimming.enabled)})},trimming:function(){var t=this;return new Promise(function(e){e(t._trimming)})},enableTrimming:function(){this._trimming.enabled=!0;var t=paella.captions.getActiveCaptions();void 0!==t&&paella.plugins.captionsPlugin.buildBodyContent(t._captions,"list"),paella.events.trigger(paella.events.setTrim,{trimEnabled:this._trimming.enabled,trimStart:this._trimming.start,trimEnd:this._trimming.end})},disableTrimming:function(){this._trimming.enabled=!1;var t=paella.captions.getActiveCaptions();void 0!==t&&paella.plugins.captionsPlugin.buildBodyContent(t._captions,"list"),paella.events.trigger(paella.events.setTrim,{trimEnabled:this._trimming.enabled,trimStart:this._trimming.start,trimEnd:this._trimming.end})},setTrimming:function(t,e){var n=this;return new Promise(function(i){var r=0,a=0;n.currentTime().then(function(t){return r=t,n.duration()}).then(function(s){if(a=s,n._trimming.start=Math.floor(t),n._trimming.end=Math.floor(e),r<n._trimming.start&&n.setCurrentTime(n._trimming.start),r>n._trimming.end&&n.setCurrentTime(n._trimming.end),n._trimming.enabled){var o=paella.captions.getActiveCaptions();void 0!==o&&paella.plugins.captionsPlugin.buildBodyContent(o._captions,"list")}paella.events.trigger(paella.events.setTrim,{trimEnabled:n._trimming.enabled,trimStart:n._trimming.start,trimEnd:n._trimming.end}),i()})})},setTrimmingStart:function(t){return this.setTrimming(t,this._trimming.end)},setTrimmingEnd:function(t){return this.setTrimming(this._trimming.start,t)},setCurrentPercent:function(t){var e=this,n=this,i=0;return new Promise(function(r){e.duration().then(function(t){return i=t,n.trimming()}).then(function(e){var r=0;if(e.enabled){var a=e.start,s=e.end;i=s-a;var o=t*i/100;r=parseFloat(o)}else r=t*i/100;return n.setCurrentTime(r)}).then(function(t){r(t)})})},setCurrentTime:function(t){base.log.debug("VideoContainerBase.setCurrentTime("+t+")")},currentTime:function(){return base.log.debug("VideoContainerBase.currentTime()"),0},duration:function(){return base.log.debug("VideoContainerBase.duration()"),0},paused:function(){return base.log.debug("VideoContainerBase.paused()"),!0},setupVideo:function(t){base.log.debug("VideoContainerBase.setupVide()")},isReady:function(){return base.log.debug("VideoContainerBase.isReady()"),!0},onresize:function(){this.parent(onresize)}}),Class("paella.ProfileFrameStrategy",{valid:function(){return!0},adaptFrame:function(t,e){return e}}),Class("paella.LimitedSizeProfileFrameStrategy",paella.ProfileFrameStrategy,{adaptFrame:function(t,e){if(t.width<e.width||t.height<e.height){var n=JSON.parse(JSON.stringify(e));n.width=t.width,n.height=t.height;var i={w:e.width-t.width,h:e.height-t.height};return n.top=n.top+i.h/2,n.left=n.left+i.w/2,n}return e}}),function(){function t(t,e){var n=new paella.VideoWrapper(t);return n.addNode(e),this.videoWrappers.push(n),this.container.addNode(n),n}var e=function(){function t(t){this._masterVideo=null,this._slaveVideos=[],this._videoStreams=[],this._audioStreams=[]}return $traceurRuntime.createClass(t,{
init:function(t){var e=this;if(0==t.length)throw Error("Empty video data.");if(this._videoData=t,this._videoData.some(function(t){return"master"==t.role})||(this._videoData[0].role="master"),this._videoData.forEach(function(t,n){t.type=t.type||"video","master"==t.role?e._masterVideo=t:"video"==t.type&&e._slaveVideos.push(t),"video"==t.type?e._videoStreams.push(t):"audio"==t.type&&e._audioStreams.push(t)}),0==this._videoStreams.length)throw new Error("No video streams found. Paella Player requires at least one video stream.")},get masterVideo(){return this._masterVideo},get slaveVideos(){return this._slaveVideos},get mainSlaveVideo(){return this._slaveVideos.length>0?this._slaveVideos[0]:null},get audioStreams(){return this._audioStreams},get isLiveStreaming(){return paella.player.isLiveStream()}},{})}();paella.StreamProvider=e;var n=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this.containerId="",this.video1Id="",this.videoSlaveId="",this.backgroundId="",this.container=null,this.profileFrameStrategy=null,this.videoWrappers=[],this._players=[],this._videoPlayers=[],this._audioPlayers=[],this._audioPlayer=null,this._audioLanguage=paella.dictionary.currentLanguage(),this._volume=1,this.videoClasses={master:"video masterVideo",slave:"video slaveVideo"},this.isHidden=!1,this.logos=null,this.overlayContainer=null,this.videoSyncTimeMillis=5e3,this.currentMasterVideoRect={},this.currentSlaveVideoRect={},this._maxSyncDelay=.5,this._isMonostream=!1,this._videoQualityStrategy=null,this._sourceData=null,this._isMasterReady=!1,this._isSlaveReady=!1,this._firstLoad=!1,this._playOnLoad=!1,this._seekToOnLoad=0,this._showPosterFrame=!0,this._currentProfile=null;var e=this;this._sourceData=[],this.containerId=t+"_container",this.video1Id=t+"_master",this.videoSlaveId=t+"_slave_",this.audioId=t+"_audio_",this.backgroundId=t+"_bkg",this.logos=[],this._videoQualityStrategy=this._getQualityStrategyObject(),this.container=new paella.DomNode("div",this.containerId,{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",width:"1024px",height:"567px"}),this.container.domElement.setAttribute("role","main"),this.addNode(this.container),this.overlayContainer=new paella.VideoOverlay(this.domElement),this.container.addNode(this.overlayContainer),this.container.addNode(new paella.BackgroundContainer(this.backgroundId,paella.utils.folders.profiles()+"/resources/default_background_paella.jpg")),Object.defineProperty(this,"sourceData",{get:function(){return this._sourceData}}),new base.Timer(function(t){e.syncVideos()},e.videoSyncTimeMillis).repeat=!0;var i=paella.player.config;try{var r=i.player.profileFrameStrategy,a=Class.fromString(r),s=new a;dynamic_cast("paella.ProfileFrameStrategy",s)&&this.setProfileFrameStrategy(s)}catch(t){}this._streamProvider=new paella.StreamProvider,Object.defineProperty(this,"ready",{get:function(){return this._isMasterReady&&this._isSlaveReady}}),Object.defineProperty(this,"isMonostream",{get:function(){return this._isMonostream}})}return $traceurRuntime.createClass(n,{_getQualityStrategyObject:function(){var t=null;return paella.player.config.player.videoQualityStrategy.split(".").forEach(function(e,n,i){t=0==n&&i.length>1?window[e]:t[e]}),new(t=t||paella.VideoQualityStrategy())},getVideoData:function(){var t=this;return new Promise(function(e){var n={master:null,slaves:[]},i=[];t.masterVideo()&&i.push(t.masterVideo().getVideoData().then(function(t){return n.master=t,Promise.resolve(t)})),t.slaveVideo()&&i.push(t.slaveVideo().getVideoData().then(function(t){return n.slaves.push(t),Promise.resolve(t)})),Promise.all(i).then(function(){e(n)})})},setVideoQualityStrategy:function(t){this._videoQualityStrategy=t,this.masterVideo()&&this.masterVideo().setVideoQualityStrategy(this._videoQualityStrategy),this.slaveVideo()&&slaveVideo.setVideoQualityStrategy(this._videoQualityStrategy)},setProfileFrameStrategy:function(t){this.profileFrameStrategy=t},getMasterVideoRect:function(){return this.currentMasterVideoRect},getSlaveVideoRect:function(){return this.currentSlaveVideoRect},setHidden:function(t){this.isHidden=t},hideVideo:function(){this.setHidden(!0)},publishVideo:function(){this.setHidden(!1)},syncVideos:function(){var t=this,e=this.masterVideo(),n=this.slaveVideo(),i=0,r=0;!this._isMonostream&&e&&e.currentTime().then(function(t){return i=t,n?n.currentTime():Promise.resolve(-1)}).then(function(e){if(e>=-1){r=e;var a=Math.abs(i-r);a>t._maxSyncDelay&&(base.log.debug("Sync videos performed, diff="+a),n.setCurrentTime(i))}var s=[];return t._audioPlayers.forEach(function(t){s.push(t.currentTime())}),Promise.all(s)}).then(function(e){e.forEach(function(e,n){var r=t._audioPlayers[n],a=Math.abs(i-e);a>t._maxSyncDelay&&(base.log.debug("Sync audio performed, diff="+a),r.setCurrentTime(e))})})},checkVideoBounds:function(t,e,n,i){var r=this,a=t.start,s=t.end,o=t.enabled;paella.events.bind(paella.events.endVideo,function(){r.setCurrentTime(0)}),o?e>=Math.floor(s)&&!n?(paella.events.trigger(paella.events.endVideo,{videoContainer:this}),this.pause()):e<a&&this.setCurrentTime(a+1):e>=i&&(paella.events.trigger(paella.events.endVideo,{videoContainer:this}),this.pause())},play:function(){var t=this;return new Promise(function(e){t._firstLoad?t._playOnLoad=!0:t._firstLoad=!0;var i=t.masterVideo(),r=t.slaveVideo();i?i.play().then(function(){r&&r.play(),t._audioPlayers.forEach(function(t){t.play()}),$traceurRuntime.superGet(t,n.prototype,"play").call(t),e()}):reject(new Error("Invalid master video"))})},pause:function(){var t=this;return new Promise(function(e,i){var r=t.masterVideo(),a=t.slaveVideo();r?r.pause().then(function(){a&&a.pause(),t._audioPlayers.forEach(function(t){t.pause()}),$traceurRuntime.superGet(t,n.prototype,"pause").call(t),e()}):i(new Error("invalid master video"))})},next:function(){0!==this._trimming.end?this.setCurrentTime(this._trimming.end):this.duration(!0).then(function(t){this.setCurrentTime(t)}),$traceurRuntime.superGet(this,n.prototype,"next").call(this)},previous:function(){this.setCurrentTime(this._trimming.start),$traceurRuntime.superGet(this,n.prototype,"previous").call(this)},setCurrentTime:function(t){var e=this;return new Promise(function(n){var i=[];e._trimming.enabled&&(t+=e._trimming.start,t<e._trimming.start&&(t=e._trimming.start),t>e._trimming.end&&(t=e._trimming.end)),i.push(e.masterVideo().setCurrentTime(t)),e.slaveVideo()&&i.push(e.slaveVideo().setCurrentTime(t)),e._audioPlayers.forEach(function(e){i.push(e.setCurrentTime(t))}),Promise.all(i).then(function(){return e.duration(!1)}).then(function(e){n({time:t,duration:e})})})},currentTime:function(){var t=void 0!==arguments[0]&&arguments[0],e=this;if(this._trimming.enabled&&!t){var n=this._trimming.start;return new Promise(function(t){e.masterVideo().currentTime().then(function(e){t(e-n)})})}return this.masterVideo().currentTime()},setPlaybackRate:function(t){var e=this.masterVideo(),i=this.slaveVideo();e&&e.setPlaybackRate(t),i&&i.setPlaybackRate(t),$traceurRuntime.superGet(this,n.prototype,"setPlaybackRate").call(this,t)},setVolume:function(t){var e=this;return new Promise(function(n){"object"==$traceurRuntime.typeof(t)&&(t=void 0!==t.master?t.master:1),e.mainAudioPlayer().setVolume(t).then(function(){paella.events.trigger(paella.events.setVolume,{master:t}),e._volume=t,n(t)})})},volume:function(){var t=this;return new Promise(function(e){t.mainAudioPlayer().then(function(t){return t.volume()}).then(function(t){e(t)})})},masterVideo:function(){return this.videoWrappers.length>0?this.videoWrappers[0].getNode(this.video1Id):null},slaveVideo:function(){return this.videoWrappers.length>1?this.videoWrappers[1].getNode(this.videoSlaveId+1):null},mainAudioPlayer:function(){return this._audioPlayer},players:function(){var t=this;return new Promise(function(e){function n(){t.masterVideo()?e(t._players):setTimeout(function(){return n()},10)}n()})},videoPlayers:function(){var t=this;return new Promise(function(e){function n(){t.masterVideo()?e(t._videoPlayers):setTimeout(function(){return n()},10)}n()})},audioPlayers:function(){var t=this;return new Promise(function(e){function n(){t.masterVideo()?e(t._audioPlayers):setTimeout(function(){return n()},10)}n()})},duration:function(t){var e=this;return this.masterVideo().duration().then(function(n){return e._trimming.enabled&&!t&&(n=e._trimming.end-e._trimming.start),n})},paused:function(){return this.masterVideo().isPaused()},trimEnabled:function(){return this._trimming.enabled},trimStart:function(){return this._trimming.enabled?this._trimming.start:0},trimEnd:function(){return this._trimming.enabled?this._trimming.end:this.duration()},getQualities:function(){var t=this;return new Promise(function(e){t.masterVideo().getQualities().then(function(t){e(t)})})},setQuality:function(t){var e=this,n=[],i=[],r=this;return new Promise(function(a){function s(){var e=t<n.length?t:n.length-1,s=t<i.length?t:i.length-1;r.masterVideo().setQuality(e).then(function(){return r.slaveVideo()?r.slaveVideo().setQuality(s):paella_DeferredResolved()}).then(function(){paella.events.trigger(paella.events.qualityChanged),a()})}e.masterVideo().getQualities().then(function(t){return n=t,e.slaveVideo()?e.slaveVideo().getQualities():paella_DeferredResolved()}).then(function(t){i=t||[],s()})})},getCurrentQuality:function(){return this.masterVideo().getCurrentQuality()},setStartTime:function(t){this.seekToTime(t)},get audioLanguage(){return this._audioLanguage},getAudioLanguages:function(){var t=this;return new Promise(function(e){var n=[];t.players().then(function(t){t.forEach(function(t){t.stream.language&&n.push(t.stream.language)}),e(n)})})},setAudioLanguage:function(t){var e=this;return new Promise(function(n){var i=!1;e.players().then(function(n){var r=[];return n.forEach(function(n){n.stream.language==t&&(i=!0,e._audioPlayer=n),r.push(n.setVolume(0))}),Promise.all(r)}).then(function(){return i||(e._audioPlayer=e.masterVideo()),e.mainAudioPlayer().setVolume(e._volume)}).then(function(){e._audioLanguage=e.mainAudioPlayer().stream.language,paella.events.trigger(paella.events.audioLanguageChanged),n()})})},setStreamData:function(e){var n=this,i=this;this._sourceData=e;var r=document.createElement("div");r.className="videoLoaderOverlay",this.overlayContainer.addElement(r,{left:0,top:0,width:1280,height:720}),this._streamProvider.init(e);var a=this._streamProvider.slaveVideos.length>0?{x:850,y:140,w:360,h:550}:{x:0,y:0,w:1280,h:720},s={x:10,y:40,w:800,h:600};this._isMonostream=0==this._streamProvider.slaveVideos.length;var o=this._streamProvider.masterVideo,u=this._streamProvider.audioStreams;this._players=[],this._videoPlayers=[],this._audioPlayers=[];var l=this._streamProvider.mainSlaveVideo,c=paella.videoFactory.getVideoObject(this.video1Id,o,a);this._audioPlayer=c,this._players.push(c),this._videoPlayers.push(c);var h=l?paella.videoFactory.getVideoObject(this.videoSlaveId+1,l,s):null;h&&(h.setVolume(0),this._players.push(h),this._videoPlayers.push(h)),u.forEach(function(t,e){var i=paella.audioFactory.getAudioObject(n.audioId+e,t);i&&(n._audioPlayers.push(i),n._players.push(i),n.container.addNode(i))}),c.setVideoQualityStrategy(this._videoQualityStrategy),h&&h.setVideoQualityStrategy(this._videoQualityStrategy),t.apply(this,["masterVideoWrapper",c]),this._streamProvider.slaveVideos.length>0&&t.apply(this,["slaveVideoWrapper",h]);var f=this.autoplay();return c.setAutoplay(f),h&&h.setAutoplay(f),c.load().then(function(){return n._streamProvider.slaveVideos.length>0?h.load():paella_DeferredResolved(!0)}).then(function(){if(i._audioPlayers.length>0){var t=[];return i._audioPlayers.forEach(function(e){t.push(e.load())}),Promise.all(t)}return paella_DeferredResolved(!0)}).then(function(){$(c.video).bind("timeupdate",function(t){var e=i._trimming,n=t.currentTarget.currentTime,r=t.currentTarget.duration;e.enabled&&(n-=e.start,r=e.end-e.start),paella.events.trigger(paella.events.timeupdate,{videoContainer:i,currentTime:n,duration:r}),i.checkVideoBounds(e,t.currentTarget.currentTime,t.currentTarget.paused,r)}),i.overlayContainer.removeElement(r),i._isMasterReady=!0,i._isSlaveReady=!0;var t=paella.player.config,e=t.player.audio&&void 0!=t.player.audio.master?t.player.audio.master:1;return c.setVolume(e),i.setAudioLanguage(i._audioLanguage)}).then(function(){paella.events.trigger(paella.events.videoReady);var t=base.parameters.get("profile"),e=base.cookies.get("lastProfile");return t?i.setProfile(t,!1):e?i.setProfile(e,!1):i.setProfile(paella.Profiles.getDefaultProfile(),!1)})},setAutoplay:function(){var t=void 0===arguments[0]||arguments[0];return!!this.supportAutoplay()&&(this._autoplay=t,this.masterVideo()&&this.masterVideo().setAutoplay(t),this.slaveVideo()&&this.slaveVideo().setAutoplay(t),this._audioPlayers.lenght>0&&this._audioPlayers.forEach(function(e){e.setAutoplay(t)}),!0)},autoplay:function(){return this.supportAutoplay()&&("true"==base.parameters.get("autoplay")||this._streamProvider.isLiveStreaming)&&!base.userAgent.browser.IsMobileVersion},supportAutoplay:function(){var t=!1;return this.masterVideo()&&(t=this.masterVideo().supportAutoplay()),this.slaveVideo()&&t&&(t=t&&this.slaveVideo().supportAutoplay()),this._audioPlayers.lenght>0&&t&&this._audioPlayers.forEach(function(e){t=t&&e.supportAutoplay()}),t},numberOfStreams:function(){return this._sourceData.length},getMonostreamMasterProfile:function(){this.masterVideo();return{content:"presenter",visible:!0,layer:1,rect:[{aspectRatio:"1/1",left:280,top:0,width:720,height:720},{aspectRatio:"6/5",left:208,top:0,width:864,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720},{aspectRatio:"11/8",left:145,top:0,width:990,height:720},{aspectRatio:"1.41/1",left:132,top:0,width:1015,height:720},{aspectRatio:"1.43/1",left:125,top:0,width:1029,height:720},{aspectRatio:"3/2",left:100,top:0,width:1080,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"1.85/1",left:0,top:14,width:1280,height:692},{aspectRatio:"2.35/1",left:0,top:87,width:1280,height:544},{aspectRatio:"2.41/1",left:0,top:94,width:1280,height:531},{aspectRatio:"2.76/1",left:0,top:128,width:1280,height:463}]}},getMonostreamSlaveProfile:function(){return{content:"slides",visible:!1,layer:0,rect:[{aspectRatio:"16/9",left:0,top:0,width:0,height:0},{aspectRatio:"4/3",left:0,top:0,width:0,height:0}]}},getCurrentProfileName:function(){return this._currentProfile},setProfile:function(t,e){var n=this;return new Promise(function(i){e=!base.userAgent.browser.Explorer&&e,n.masterVideo()?paella.Profiles.loadProfile(t,function(r){n._currentProfile=t,0==n._streamProvider.slaveVideos.length&&(r.masterVideo=n.getMonostreamMasterProfile(),r.slaveVideo=n.getMonostreamSlaveProfile()),n.applyProfileWithJson(r,e),i(t)}):i()})},getProfile:function(t){return new Promise(function(e,n){paella.Profiles.loadProfile(t,function(t){e(t)})})},hideAllLogos:function(){for(var t=0;t<this.logos.length;++t){var e=this.logos[t],n=this.container.getNode(e);$(n.domElement).hide()}},showLogos:function(t){if(void 0!=t)for(var e=new paella.RelativeVideoSize,n=0;n<t.length;++n){var i=t[n],r=i.content,a=this.container.getNode(r),s=i.rect;a?$(a.domElement).show():(h={},a=this.container.addNode(new paella.DomNode("img",r,h)),a.domElement.setAttribute("src",paella.utils.folders.profiles()+"/resources/"+r),a.domElement.setAttribute("src",paella.utils.folders.profiles()+"/resources/"+r));var o=e.percentVSize(s.top)+"%",u=e.percentWSize(s.left)+"%",l=e.percentWSize(s.width)+"%",c=e.percentVSize(s.height)+"%",h={top:o,left:u,width:l,height:c,position:"absolute",zIndex:i.zIndex};$(a.domElement).css(h)}},getClosestRect:function(t,e){var n=10,i=/([0-9\.]+)\/([0-9\.]+)/,r=t.rect[0],a=0==e.h?1.333333:e.w/e.h,s=1,o=!1;return t.rect.forEach(function(t){(o=i.exec(t.aspectRatio))&&(s=Number(o[1])/Number(o[2]));var e=Math.abs(s-a);n>e&&(n=e,r=t)}),r},applyProfileWithJson:function(t,e){var n=function(n,i){void 0==e&&(e=!0);var r=this.videoWrappers[0],a=this.videoWrappers.length>1?this.videoWrappers[1]:null,s=(this.masterVideo(),this.slaveVideo(),this.container.getNode(this.backgroundId)),o=n.res,u=i&&i.res,l=this.getClosestRect(t.masterVideo,n.res),c=i&&this.getClosestRect(t.slaveVideo,i.res);if(this.hideAllLogos(),this.showLogos(t.logos),dynamic_cast("paella.ProfileFrameStrategy",this.profileFrameStrategy)){var h={width:$(this.domElement).width(),height:$(this.domElement).height()},f=l.width/h.width,d={width:o.w*f,height:o.h*f};if(l.left=Number(l.left),l.top=Number(l.top),l.width=Number(l.width),l.height=Number(l.height),l=this.profileFrameStrategy.adaptFrame(d,l),a){var g={width:u.w*f,height:u.h*f};c.left=Number(c.left),c.top=Number(c.top),c.width=Number(c.width),c.height=Number(c.height),c=this.profileFrameStrategy.adaptFrame(g,c)}}r.setRect(l,e),this.currentMasterVideoRect=l,r.setVisible(t.masterVideo.visible,e),this.currentMasterVideoRect.visible=!!/true/i.test(t.masterVideo.visible),this.currentMasterVideoRect.layer=parseInt(t.masterVideo.layer),a&&(a.setRect(c,e),this.currentSlaveVideoRect=c,this.currentSlaveVideoRect.visible=!!/true/i.test(t.slaveVideo.visible),this.currentSlaveVideoRect.layer=parseInt(t.slaveVideo.layer),a.setVisible(t.slaveVideo.visible,e),a.setLayer(t.slaveVideo.layer)),r.setLayer(t.masterVideo.layer),s.setImage(paella.utils.folders.profiles()+"/resources/"+t.background.content)},i=this;if(this.masterVideo())if(this.slaveVideo()){var r={};this.masterVideo().getVideoData().then(function(t){return r=t,i.slaveVideo().getVideoData()}).then(function(t){n.apply(i,[r,t])})}else this.masterVideo().getVideoData().then(function(t){n.apply(i,[t])})},resizePortrail:function(){var t=1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width(),e=new paella.RelativeVideoSize,n=e.proportionalHeight(t);this.container.domElement.style.width=t+"px",this.container.domElement.style.height=n+"px";var i=1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height(),r=i/2-n/2;this.container.domElement.style.top=r+"px"},resizeLandscape:function(){var t=1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height(),e=new paella.RelativeVideoSize,n=e.proportionalWidth(t);this.container.domElement.style.width=n+"px",this.container.domElement.style.height=t+"px",this.container.domElement.style.top="0px"},onresize:function(){$traceurRuntime.superGet(this,n.prototype,"onresize").call(this);var t=new paella.RelativeVideoSize,e=t.aspectRatio();(1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width())/(1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height())>e?this.resizeLandscape():this.resizePortrail()}},{},e)}(paella.VideoContainerBase);paella.VideoContainer=n}(),Class("paella.PluginManager",{targets:null,pluginList:[],eventDrivenPlugins:[],enabledPlugins:[],setupPlugin:function(t){t.setup(),this.enabledPlugins.push(t),dynamic_cast("paella.UIPlugin",t)&&t.checkVisibility()},checkPluginsVisibility:function(){this.enabledPlugins.forEach(function(t){dynamic_cast("paella.UIPlugin",t)&&t.checkVisibility()})},initialize:function(){this.targets={};var t=this;paella.events.bind(paella.events.loadPlugins,function(e){t.loadPlugins("paella.DeferredLoadPlugin")}),new base.Timer(function(){paella.player&&paella.player.controls&&paella.player.controls.onresize()},1e3).repeat=!0},setTarget:function(t,e){e.addPlugin&&(this.targets[t]=e)},getTarget:function(t){return"eventDriven"==t?this:this.targets[t]},registerPlugin:function(t){this.importLibraries(t),this.pluginList.push(t),this.pluginList.sort(function(t,e){return t.getIndex()-e.getIndex()})},importLibraries:function(t){t.getDependencies().forEach(function(t){var e=document.createElement("script");e.type="text/javascript",e.src="javascript/"+t+".js",document.head.appendChild(e)})},loadPlugins:function(t){if(void 0!=t){var e=this;this.foreach(function(n,i){null!=dynamic_cast(t,n)&&i.enabled&&(base.log.debug("Load plugin ("+t+"): "+n.getName()),n.config=i,n.load(e))})}},foreach:function(t){var e=!1,n={};try{e=paella.player.config.plugins.enablePluginsByDefault}catch(t){}try{n=paella.player.config.plugins.list}catch(t){}this.pluginList.forEach(function(i){var r=i.getName(),a=n[r];a||(a={enabled:e}),t(i,a)})},addPlugin:function(t){var e=this;t.checkEnabled(function(n){if("eventDriven"==t.type&&n){paella.pluginManager.setupPlugin(t),e.eventDrivenPlugins.push(t);for(var i=t.getEvents(),r=function(e,n){t.onEvent(e.type,n)},a=0;a<i.length;++a){var s=i[a];paella.events.bind(s,r)}}})},getPlugin:function(t){for(var e=0;e<this.pluginList.length;++e)if(this.pluginList[e].getName()==t)return this.pluginList[e];return null}}),paella.pluginManager=new paella.PluginManager,Class("paella.Plugin",{type:"",initialize:function(){paella.pluginManager.registerPlugin(this)},getDependencies:function(){return[]},load:function(t){var e=t.getTarget(this.type);e&&e.addPlugin&&e.addPlugin(this)},getRootNode:function(t){return null},checkEnabled:function(t){t(!0)},setup:function(){},getIndex:function(){return 0},getName:function(){return""}}),Class("paella.FastLoadPlugin",paella.Plugin,{}),Class("paella.EarlyLoadPlugin",paella.Plugin,{}),Class("paella.DeferredLoadPlugin",paella.Plugin,{}),Class("paella.PopUpContainer",paella.DomNode,{containers:null,currentContainerId:-1,initialize:function(t,e){var n={};this.parent("div",t,n),this.domElement.className=e,this.containers={}},hideContainer:function(t,e){var n=this.containers[t];n&&this.currentContainerId==t&&(n.identifier=t,paella.events.trigger(paella.events.hidePopUp,{container:n}),n.plugin.willHideContent(),$(n.element).hide(),n.button.className=n.button.className.replace(" selected",""),$(this.domElement).css({width:"0px"}),this.currentContainerId=-1,n.plugin.didHideContent())},showContainer:function(t,e){function n(t){paella.events.trigger(paella.events.hidePopUp,{container:t}),t.plugin.willHideContent(),$(t.element).hide(),$(r.domElement).css({width:"0px"}),t.button.className=t.button.className.replace(" selected",""),r.currentContainerId=-1,t.plugin.didHideContent()}function i(n){if(paella.events.trigger(paella.events.showPopUp,{container:n}),n.plugin.willShowContent(),n.button.className=n.button.className+" selected",$(n.element).show(),a=$(n.element).width(),"right"==n.plugin.getAlignment()){var i=$(e.parentElement).width()-$(e).position().left-$(e).width();$(r.domElement).css({width:a+"px",right:i+"px",left:""})}else{var s=$(e).position().left;$(r.domElement).css({width:a+"px",left:s+"px",right:""})}r.currentContainerId=t,n.plugin.didShowContent()}var r=this,a=0,s=this.containers[t];if(s&&this.currentContainerId!=t&&-1!=this.currentContainerId){n(this.containers[this.currentContainerId]),i(s)}else s&&this.currentContainerId==t?n(s):s&&i(s)},registerContainer:function(t,e,n,i){var r={identifier:t,button:n,element:e,plugin:i};if(this.containers[t]=r,i.closeOnMouseOut&&i.closeOnMouseOut()){var a=t,s=n;$(e).mouseleave(function(t){paella.player.controls.playbackControl().hidePopUp(a,s)})}$(e).hide(),n.popUpIdentifier=t,n.sourcePlugin=i,$(n).click(function(t){this.plugin.isPopUpOpen()?paella.player.controls.playbackControl().hidePopUp(this.popUpIdentifier,this):paella.player.controls.playbackControl().showPopUp(this.popUpIdentifier,this)}),$(n).keyup(function(t){13!=t.keyCode||this.plugin.isPopUpOpen()?27==t.keyCode&&paella.player.controls.playbackControl().hidePopUp(this.popUpIdentifier,this):paella.player.controls.playbackControl().showPopUp(this.popUpIdentifier,this)}),i.containerManager=this}}),Class("paella.TimelineContainer",paella.PopUpContainer,{hideContainer:function(t,e){var n=this.containers[t];n&&this.currentContainerId==t&&(paella.events.trigger(paella.events.hidePopUp,{container:n}),n.plugin.willHideContent(),$(n.element).hide(),n.button.className=n.button.className.replace(" selected",""),this.currentContainerId=-1,$(this.domElement).css({height:"0px"}),n.plugin.didHideContent())},showContainer:function(t,e){var n=0,i=this.containers[t];if(i&&this.currentContainerId!=t&&-1!=this.currentContainerId){var r=this.containers[this.currentContainerId];r.button.className=r.button.className.replace(" selected",""),i.button.className=i.button.className+" selected",paella.events.trigger(paella.events.hidePopUp,{container:r}),r.plugin.willHideContent(),$(r.element).hide(),r.plugin.didHideContent(),paella.events.trigger(paella.events.showPopUp,{container:i}),i.plugin.willShowContent(),$(i.element).show(),this.currentContainerId=t,n=$(i.element).height(),$(this.domElement).css({height:n+"px"}),i.plugin.didShowContent()}else i&&this.currentContainerId==t?(paella.events.trigger(paella.events.hidePopUp,{container:i}),i.plugin.willHideContent(),$(i.element).hide(),i.button.className=i.button.className.replace(" selected",""),$(this.domElement).css({height:"0px"}),this.currentContainerId=-1,i.plugin.didHideContent()):i&&(paella.events.trigger(paella.events.showPopUp,{container:i}),i.plugin.willShowContent(),i.button.className=i.button.className+" selected",$(i.element).show(),this.currentContainerId=t,n=$(i.element).height(),$(this.domElement).css({height:n+"px"}),i.plugin.didShowContent())}}),Class("paella.UIPlugin",paella.DeferredLoadPlugin,{ui:null,checkVisibility:function(){var t=this.config.visibleOn||[paella.PaellaPlayer.mode.standard,paella.PaellaPlayer.mode.fullscreen,paella.PaellaPlayer.mode.embed],e=!1;t.forEach(function(t){t==paella.player.getPlayerMode()&&(e=!0)}),e?this.showUI():this.hideUI()},hideUI:function(){this.ui.setAttribute("aria-hidden","true"),$(this.ui).hide()},showUI:function(){var t=this;paella.pluginManager.enabledPlugins.forEach(function(e){e==t&&(t.ui.setAttribute("aria-hidden","false"),$(t.ui).show())})}}),Class("paella.ButtonPlugin",paella.UIPlugin,{type:"button",subclass:"",container:null,containerManager:null,getAlignment:function(){return"left"},getSubclass:function(){return"myButtonPlugin"},addSubclass:function(t){$(this.container).addClass(t)},removeSubclass:function(t){$(this.container).removeClass(t)},action:function(t){},getName:function(){return"ButtonPlugin"},getMinWindowSize:function(){return 0},buildContent:function(t){},willShowContent:function(){base.log.debug(this.getName()+" willDisplayContent")},didShowContent:function(){base.log.debug(this.getName()+" didDisplayContent")},willHideContent:function(){base.log.debug(this.getName()+" willHideContent")},didHideContent:function(){base.log.debug(this.getName()+" didHideContent")},getButtonType:function(){return paella.ButtonPlugin.type.actionButton},getText:function(){return""},setText:function(t){this.container.innerHTML=t},hideButton:function(){this.hideUI()},showButton:function(){this.showUI()},changeSubclass:function(t){this.subclass=t,this.container.className=this.getClassName()},getClassName:function(){return paella.ButtonPlugin.kClassName+" "+this.getAlignment()+" "+this.subclass},getContainerClassName:function(){return this.getButtonType()==paella.ButtonPlugin.type.timeLineButton?paella.ButtonPlugin.kTimeLineClassName+" "+this.getSubclass():this.getButtonType()==paella.ButtonPlugin.type.popUpButton?paella.ButtonPlugin.kPopUpClassName+" "+this.getSubclass():void 0},setToolTip:function(t){this.button.setAttribute("title",t),this.button.setAttribute("aria-label",t)},getDefaultToolTip:function(){return""},isPopUpOpen:function(){return this.button.popUpIdentifier==this.containerManager.currentContainerId}}),paella.ButtonPlugin.alignment={left:"left",right:"right"},paella.ButtonPlugin.kClassName="buttonPlugin",paella.ButtonPlugin.kPopUpClassName="buttonPluginPopUp",paella.ButtonPlugin.kTimeLineClassName="buttonTimeLine",paella.ButtonPlugin.type={actionButton:1,popUpButton:2,timeLineButton:3},paella.ButtonPlugin.buildPluginButton=function(t,e){function n(t){paella.userTracking.log("paella:button:action",t.plugin.getName()),t.plugin.action(t)}t.subclass=t.getSubclass();var i=document.createElement("div");return i.className=t.getClassName(),i.id=e,i.innerHTML=t.getText(),i.setAttribute("tabindex",1e3+t.getIndex()),i.setAttribute("alt",""),i.setAttribute("role","button"),i.plugin=t,t.button=i,t.container=i,t.ui=i,t.setToolTip(t.getDefaultToolTip()),$(i).click(function(t){n(this)}),$(i).keyup(function(t){13==t.keyCode&&n(this)}),i},paella.ButtonPlugin.buildPluginPopUp=function(t,e,n){e.subclass=e.getSubclass();var i=document.createElement("div");return t.appendChild(i),i.className=e.getContainerClassName(),i.id=n,i.plugin=e,e.buildContent(i),i},Class("paella.VideoOverlayButtonPlugin",paella.ButtonPlugin,{type:"videoOverlayButton",getSubclass:function(){return"myVideoOverlayButtonPlugin "+this.getAlignment()},action:function(t){},getName:function(){return"VideoOverlayButtonPlugin"}}),Class("paella.EventDrivenPlugin",paella.EarlyLoadPlugin,{type:"eventDriven",initialize:function(){this.parent();for(var t=this.getEvents(),e=0;e<t.length;++e){t[e]==paella.events.loadStarted&&this.onEvent(paella.events.loadStarted)}},getEvents:function(){return[]},onEvent:function(t,e){},getName:function(){return"EventDrivenPlugin"}}),function(){var t=new(Class({_formats:{},addPlugin:function(t){var e=this,n=t.ext;0==(Array.isArray&&Array.isArray(n)||n instanceof Array)&&(n=[n]),0==n.length?base.log.debug("No extension provided by the plugin "+t.getName()):(base.log.debug("New captionParser added: "+t.getName()),n.forEach(function(n){e._formats[n]=t}))},initialize:function(){paella.pluginManager.setTarget("captionParser",this)}})),e=Class(base.AsyncLoaderCallback,{initialize:function(t,e){this.name="captionSearchCallback",this.caption=t,this.text=e},load:function(t,e){var n=this;this.caption.search(this.text,function(i,r){i?e():(n.result=r,t())})}});paella.captions={parsers:{},_captions:{},_activeCaption:void 0,addCaptions:function(t){var e=t._captionsProvider+":"+t._id;this._captions[e]=t,paella.events.trigger(paella.events.captionAdded,e)},getAvailableLangs:function(){var t=[],e=this;return Object.keys(this._captions).forEach(function(n){var i=e._captions[n];t.push({id:n,lang:i._lang})}),t},getCaptions:function(t){if(t&&this._captions[t])return this._captions[t]},getActiveCaptions:function(t){return this._activeCaption},setActiveCaptions:function(t){return this._activeCaption=this.getCaptions(t),void 0!=this._activeCaption?paella.events.trigger(paella.events.captionsEnabled,t):paella.events.trigger(paella.events.captionsDisabled),this._activeCaption},getCaptionAtTime:function(t,e){var n=this.getCaptions(t);if(void 0!=n)return n.getCaptionAtTime(e)},search:function(t,n){var i=this,r=new base.AsyncLoader;this.getAvailableLangs().forEach(function(n){r.addCallback(new e(i.getCaptions(n.id),t))}),r.load(function(){var t=[];Object.keys(r.callbackArray).forEach(function(e){t=t.concat(r.getCallback(e).result)}),n&&n(!1,t)},function(){n&&n(!0)})}},Class("paella.captions.Caption",{initialize:function(t,e,n,i,r){this._id=t,this._format=e,this._url=n,this._captions=void 0,this._index=lunr(function(){this.ref("id"),this.field("content",{boost:10})}),"string"==typeof i&&(i={code:i,txt:i}),this._lang=i,this._captionsProvider="downloadCaptionsProvider",this.reloadCaptions(r)},canEdit:function(t){t(!1,!1)},goToEdit:function(){},reloadCaptions:function(e){var n=this;jQuery.ajax({url:n._url,cache:!1,type:"get",dataType:"text"}).then(function(i){var r=t._formats[n._format];void 0==r?(base.log.debug("Error adding captions: Format not supported!"),e&&e(!0)):r.parse(i,n._lang.code,function(t,i){t||(n._captions=i,n._captions.forEach(function(t){n._index.add({id:t.id,content:t.content})})),e&&e(t)})}).fail(function(t){base.log.debug("Error loading captions: "+n._url),e&&e(!0)})},getCaptions:function(){return this._captions},getCaptionAtTime:function(t){if(void 0!=this._captions)for(var e=0;e<this._captions.length;++e){var n=this._captions[e];if(n.begin<=t&&n.end>=t)return n}},getCaptionById:function(t){
if(void 0!=this._captions)for(var e=0;e<this._captions.length;++e){var n=this._captions[e];if(n.id==t)return n}},search:function(t,e){var n=this,i=this;if(void 0==this._index)e&&e(!0,"Error. No captions found.");else{var r=[];paella.player.videoContainer.trimming().then(function(a){n._index.search(t).forEach(function(t){var e=i.getCaptionById(t.ref);a.enabled&&(e.end<a.start||e.begin>a.end)||r.push({time:e.begin,content:e.content,score:t.score})}),e&&e(!1,r)})}}}),Class("paella.CaptionParserPlugIn",paella.FastLoadPlugin,{type:"captionParser",getIndex:function(){return-1},ext:[],parse:function(t,e,n){throw new Error("paella.CaptionParserPlugIn#parse must be overridden by subclass")}})}(),function(){var t=new(Class({_plugins:[],addPlugin:function(t){this._plugins.push(t)},initialize:function(){paella.pluginManager.setTarget("SearchServicePlugIn",this)}})),e=Class(base.AsyncLoaderCallback,{initialize:function(t,e){this.name="searchCallback",this.plugin=t,this.text=e},load:function(t,e){var n=this;this.plugin.search(this.text,function(i,r){i?e():(n.result=r,t())})}});paella.searchService={search:function(n,i){var r=new base.AsyncLoader;paella.userTracking.log("paella:searchService:search",n),t._plugins.forEach(function(t){r.addCallback(new e(t,n))}),r.load(function(){var t=[];Object.keys(r.callbackArray).forEach(function(e){t=t.concat(r.getCallback(e).result)}),i&&i(!1,t)},function(){i&&i(!0)})}},Class("paella.SearchServicePlugIn",paella.FastLoadPlugin,{type:"SearchServicePlugIn",getIndex:function(){return-1},search:function(t,e){throw new Error("paella.SearchServicePlugIn#search must be overridden by subclass")}})}(),function(){var t=new(Class({_plugins:[],addPlugin:function(t){var e=this;t.checkEnabled(function(n){n&&(t.setup(),e._plugins.push(t))})},initialize:function(){paella.pluginManager.setTarget("userTrackingSaverPlugIn",this)}}));paella.userTracking={},Class("paella.userTracking.SaverPlugIn",paella.FastLoadPlugin,{type:"userTrackingSaverPlugIn",getIndex:function(){return-1},checkEnabled:function(t){t(!0)},log:function(t,e){throw new Error("paella.userTracking.SaverPlugIn#log must be overridden by subclass")}});var e={};paella.userTracking.log=function(n,i){void 0!=e[n]&&e[n].cancel(),e[n]=new base.Timer(function(r){t._plugins.forEach(function(t){t.log(n,i)}),delete e[n]},500)},[paella.events.play,paella.events.pause,paella.events.endVideo,paella.events.showEditor,paella.events.hideEditor,paella.events.enterFullscreen,paella.events.exitFullscreen,paella.events.loadComplete].forEach(function(t){paella.events.bind(t,function(e,n){paella.userTracking.log(t)})}),[paella.events.showPopUp,paella.events.hidePopUp].forEach(function(t){paella.events.bind(t,function(e,n){paella.userTracking.log(t,n.identifier)})}),[paella.events.captionsEnabled,paella.events.captionsDisabled].forEach(function(t){paella.events.bind(t,function(e,n){var i;if(void 0!=n){var r=paella.captions.getCaptions(n);i={id:n,lang:r._lang,url:r._url}}paella.userTracking.log(t,i)})}),[paella.events.setProfile].forEach(function(t){paella.events.bind(t,function(e,n){paella.userTracking.log(t,n.profileName)})}),[paella.events.seekTo,paella.events.seekToTime].forEach(function(t){paella.events.bind(t,function(e,n){var i;try{JSON.stringify(n),i=n}catch(t){}paella.userTracking.log(t,i)})}),[paella.events.setVolume,paella.events.resize,paella.events.setPlaybackRate].forEach(function(t){paella.events.bind(t,function(e,n){var i;try{JSON.stringify(n),i=n}catch(t){}paella.userTracking.log(t,i)})})}(),Class("paella.TimeControl",paella.DomNode,{initialize:function(t){this.parent("div",t,{left:"0%"}),this.domElement.className="timeControlOld",this.domElement.className="timeControl";var e=this;paella.events.bind(paella.events.timeupdate,function(t,n){e.onTimeUpdate(n)})},onTimeUpdate:function(t){t.videoContainer,t.currentTime,t.duration;this.domElement.innerHTML=this.secondsToHours(parseInt(t.currentTime))},secondsToHours:function(t){var e=Math.floor(t/3600),n=Math.floor((t-3600*e)/60),i=t-3600*e-60*n;return e<10&&(e="0"+e),n<10&&(n="0"+n),i<10&&(i="0"+i),e+":"+n+":"+i}}),Class("paella.PlaybackBar",paella.DomNode,{playbackFullId:"",updatePlayBar:!0,timeControlId:"",_images:null,_keys:null,_prev:null,_next:null,_videoLength:null,_lastSrc:null,_aspectRatio:1.777777778,_hasSlides:null,_imgNode:null,_canvas:null,initialize:function(t){var e={};this.parent("div",t,e),this.domElement.className="playbackBar",this.domElement.setAttribute("alt",""),this.domElement.setAttribute("aria-label","Timeline Slider"),this.domElement.setAttribute("role","slider"),this.domElement.setAttribute("aria-valuemin","0"),this.domElement.setAttribute("aria-valuemax","100"),this.domElement.setAttribute("aria-valuenow","0"),this.domElement.setAttribute("tabindex","1100"),$(this.domElement).keyup(function(t){var e=0,n=0;paella.player.videoContainer.currentTime().then(function(t){return e=t,paella.player.videoContainer.duration()}).then(function(i){n=i;var r,a;switch(t.keyCode){case 37:r=100*e/n,a=r-5,paella.player.videoContainer.seekTo(a);break;case 39:r=100*e/n,a=r+5,paella.player.videoContainer.seekTo(a)}})}),this.playbackFullId=t+"_full",this.timeControlId=t+"_timeControl";var n=new paella.DomNode("div",this.playbackFullId,{width:"0%"});n.domElement.className="playbackBarFull",this.addNode(n),this.addNode(new paella.TimeControl(this.timeControlId));var i=this;paella.events.bind(paella.events.timeupdate,function(t,e){i.onTimeUpdate(e)}),$(this.domElement).bind("mousedown",function(t){paella.utils.mouseManager.down(i,t),t.stopPropagation()}),$(n.domElement).bind("mousedown",function(t){paella.utils.mouseManager.down(i,t),t.stopPropagation()}),base.userAgent.browser.IsMobileVersion||($(this.domElement).bind("mousemove",function(t){i.movePassive(t),paella.utils.mouseManager.move(t)}),$(n.domElement).bind("mousemove",function(t){paella.utils.mouseManager.move(t)}),$(this.domElement).bind("mouseout",function(t){i.mouseOut(t)})),$(this.domElement).bind("mouseup",function(t){paella.utils.mouseManager.up(t)}),$(n.domElement).bind("mouseup",function(t){paella.utils.mouseManager.up(t)}),paella.player.isLiveStream()&&$(this.domElement).hide()},mouseOut:function(t){this._hasSlides?$("#divTimeImageOverlay").remove():$("#divTimeOverlay").remove()},drawTimeMarks:function(){var t=this,e={};paella.player.videoContainer.trimming().then(function(n){return e=n,t.imageSetup()}).then(function(){var n=t,i=(e.enabled?(e.end,e.start):t._videoLength,$("#playerContainer_controls_playback_playbackBar"));t.clearCanvas(),t._keys&&paella.player.config.player.slidesMarks.enabled&&t._keys.forEach(function(t){var r=parseInt(t)-e.start;if(r>0){var a=r*i.width()/n._videoLength;n.drawTimeMark(a)}})})},drawTimeMark:function(t){var e=this.getCanvasContext();e.fillStyle=paella.player.config.player.slidesMarks.color,e.fillRect(t,0,1,12)},clearCanvas:function(){if(this._canvas){this.getCanvasContext().clearRect(0,0,this._canvas.width,this._canvas.height)}},getCanvas:function(){if(!this._canvas){var t=$("#playerContainer_controls_playback_playbackBar"),e=document.createElement("canvas");e.className="playerContainer_controls_playback_playbackBar_canvas",e.id="playerContainer_controls_playback_playbackBar_canvas",e.width=t.width();e.height=t.height();t.prepend(e),this._canvas=document.getElementById("playerContainer_controls_playback_playbackBar_canvas")}return this._canvas},getCanvasContext:function(){return this.getCanvas().getContext("2d")},movePassive:function(t){function e(e,i){var r=$(n.domElement),a=r.offset(),s=r.width(),o=t.clientX-a.left;o=o<0?0:o;var u=100*o/s,l=u*e/100;i.enabled&&(l+=i.start);var c=Math.floor((l-i.start)/3600)%24;c=("00"+c).slice(c.toString().length);var h=Math.floor((l-i.start)/60)%60;h=("00"+h).slice(h.toString().length);var f=Math.floor((l-i.start)%60);f=("00"+f).slice(f.toString().length);var d=c+":"+h+":"+f;if(n._hasSlides?(0==$("#divTimeImageOverlay").length?n.setupTimeImageOverlay(d,a.top,s):$("#divTimeOverlay")[0].innerHTML=d,n.imageUpdate(l)):0==$("#divTimeOverlay").length?n.setupTimeOnly(d,a.top,s):$("#divTimeOverlay")[0].innerHTML=d,n._hasSlides){var g=$("#divTimeImageOverlay").width(),m=t.clientX-g/2;t.clientX>g/2+a.left&&t.clientX<a.left+s-g/2?$("#divTimeImageOverlay").css("left",m):t.clientX<s/2?$("#divTimeImageOverlay").css("left",a.left):$("#divTimeImageOverlay").css("left",a.left+s-g)}var p=$("#divTimeOverlay").width(),b=t.clientX-p/2;t.clientX>p/2+a.left&&t.clientX<a.left+s-p/2?$("#divTimeOverlay").css("left",b):t.clientX<s/2?$("#divTimeOverlay").css("left",a.left):$("#divTimeOverlay").css("left",a.left+s-p-2),n._hasSlides&&$("#divTimeImageOverlay").css("bottom",$(".playbackControls").height())}var n=this;paella.player.videoContainer.duration();var i=0;paella.player.videoContainer.duration().then(function(t){return i=t,paella.player.videoContainer.trimming()}).then(function(t){e(i,t)})},imageSetup:function(){var t=this;return new Promise(function(e){paella.player.videoContainer.duration().then(function(n){t._images={};var i=paella.initDelegate.initParams.videoLoader.frameList;if(!i||0===Object.keys(i).length)return void(t._hasSlides=!1);t._hasSlides=!0,t._images=i,t._videoLength=n,t._keys=Object.keys(t._images),t._keys=t._keys.sort(function(t,e){return parseInt(t)-parseInt(e)}),t._next=0,t._prev=0,e()})})},imageUpdate:function(t){var e=this,n=$("#imgOverlay").attr("src");if($(e._imgNode).show(),t>this._next||t<this._prev)n=e.getPreviewImageSrc(t),n?(e._lastSrc=n,$("#imgOverlay").attr("src",n)):e.hideImg();else{if(void 0!=n)return;$("#imgOverlay").attr("src",e._lastSrc)}},hideImg:function(){var t=this;$(t._imgNode).hide()},getPreviewImageSrc:function(t){var e=Object.keys(this._images);e.push(t),e.sort(function(t,e){return parseInt(t)-parseInt(e)});var n=e.indexOf(t)-1;n=n>0?n:0;var i=e[n],r=e[n+2],a=e[n];return r=void 0==r?e.length-1:parseInt(r),this._next=r,a=void 0==a?0:parseInt(a),this._prev=a,i=parseInt(i),!!this._images[i]&&(this._images[i].url||this._images[i].url)},setupTimeImageOverlay:function(t,e,n){var i=this,r=document.createElement("div");r.className="divTimeImageOverlay",r.id="divTimeImageOverlay";var a=Math.round(n/10);if(r.style.width=Math.round(a*i._aspectRatio)+"px",i._hasSlides){var s=document.createElement("img");s.className="imgOverlay",s.id="imgOverlay",i._imgNode=s,r.appendChild(s)}var o=document.createElement("div");o.className="divTimeOverlay",o.style.top=e-20+"px",o.id="divTimeOverlay",o.innerHTML=t,r.appendChild(o),$(this.domElement).parent().append(r)},setupTimeOnly:function(t,e,n){var i=document.createElement("div");i.className="divTimeOverlay",i.style.top=e-20+"px",i.id="divTimeOverlay",i.innerHTML=t,$(this.domElement).parent().append(i)},playbackFull:function(){return this.getNode(this.playbackFullId)},timeControl:function(){return this.getNode(this.timeControlId)},setPlaybackPosition:function(t){this.playbackFull().domElement.style.width=t+"%"},isSeeking:function(){return!this.updatePlayBar},onTimeUpdate:function(t){if(this.updatePlayBar){var e=t.currentTime,n=t.duration;this.setPlaybackPosition(100*e/n)}},down:function(t,e,n){this.updatePlayBar=!1,this.move(t,e,n)},move:function(t,e,n){var i=$(this.domElement).width(),r=e-$(this.domElement).offset().left;r=r<0?0:r>i?100:100*r/i,this.setPlaybackPosition(r)},up:function(t,e,n){var i=$(this.domElement).width(),r=e-$(this.domElement).offset().left;r=r<0?0:r>i?100:100*r/i,paella.player.videoContainer.seekTo(r),this.updatePlayBar=!0},onresize:function(){this.drawTimeMarks()}}),Class("paella.PlaybackControl",paella.DomNode,{playbackBarId:"",pluginsContainer:null,_popUpPluginContainer:null,_timeLinePluginContainer:null,playbackPluginsWidth:0,popupPluginsWidth:0,minPlaybackBarSize:120,playbackBarInstance:null,buttonPlugins:[],addPlugin:function(t){var e=this,n="buttonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(t);var i=paella.ButtonPlugin.buildPluginButton(t,n);t.button=i,this.pluginsContainer.domElement.appendChild(i),$(i).hide(),t.checkEnabled(function(n){var r;if(n){$(t.button).show(),paella.pluginManager.setupPlugin(t);var a="buttonPlugin"+e.buttonPlugins.length;if(t.getButtonType()==paella.ButtonPlugin.type.popUpButton){r=e.popUpPluginContainer.domElement;var s=paella.ButtonPlugin.buildPluginPopUp(r,t,a+"_container");e.popUpPluginContainer.registerContainer(t.getName(),s,i,t)}else if(t.getButtonType()==paella.ButtonPlugin.type.timeLineButton){r=e.timeLinePluginContainer.domElement;var o=paella.ButtonPlugin.buildPluginPopUp(r,t,a+"_timeline");e.timeLinePluginContainer.registerContainer(t.getName(),o,i,t)}}else e.pluginsContainer.domElement.removeChild(t.button)})},initialize:function(t){var e={};this.parent("div",t,e),this.domElement.className="playbackControls",this.playbackBarId=t+"_playbackBar";this.pluginsContainer=new paella.DomNode("div",t+"_playbackBarPlugins"),this.pluginsContainer.domElement.className="playbackBarPlugins",this.pluginsContainer.domElement.setAttribute("role","toolbar"),this.addNode(this.pluginsContainer),this.addNode(new paella.PlaybackBar(this.playbackBarId)),paella.pluginManager.setTarget("button",this),Object.defineProperty(this,"popUpPluginContainer",{get:function(){return this._popUpPluginContainer||(this._popUpPluginContainer=new paella.PopUpContainer(t+"_popUpPluginContainer","popUpPluginContainer"),this.addNode(this._popUpPluginContainer)),this._popUpPluginContainer}}),Object.defineProperty(this,"timeLinePluginContainer",{get:function(){return this._timeLinePluginContainer||(this._timeLinePluginContainer=new paella.TimelineContainer(t+"_timelinePluginContainer","timelinePluginContainer"),this.addNode(this._timeLinePluginContainer)),this._timeLinePluginContainer}})},showPopUp:function(t,e){this.popUpPluginContainer.showContainer(t,e),this.timeLinePluginContainer.showContainer(t,e)},hidePopUp:function(t,e){this.popUpPluginContainer.hideContainer(t,e),this.timeLinePluginContainer.hideContainer(t,e)},playbackBar:function(){return null==this.playbackBarInstance&&(this.playbackBarInstance=this.getNode(this.playbackBarId)),this.playbackBarInstance},onresize:function(){var t=$(this.domElement).width();base.log.debug("resize playback bar (width="+t+")");for(var e=0;e<this.buttonPlugins.length;++e){var n=this.buttonPlugins[e],i=n.getMinWindowSize();i>0&&t<i?n.hideUI():n.checkVisibility()}this.getNode(this.playbackBarId).onresize()}}),Class("paella.ControlsContainer",paella.DomNode,{playbackControlId:"",editControlId:"",isEnabled:!0,autohideTimer:null,hideControlsTimeMillis:3e3,playbackControlInstance:null,videoOverlayButtons:null,buttonPlugins:[],_hidden:!1,addPlugin:function(t){var e="videoOverlayButtonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(t);var n=paella.ButtonPlugin.buildPluginButton(t,e);this.videoOverlayButtons.domElement.appendChild(n),t.button=n,$(n).hide(),t.checkEnabled(function(e){e&&($(t.button).show(),paella.pluginManager.setupPlugin(t))})},initialize:function(t){this.parent("div",t),this.viewControlId=t+"_view",this.playbackControlId=t+"_playback",this.editControlId=t+"_editor",this.addNode(new paella.PlaybackControl(this.playbackControlId));var e=this;paella.events.bind(paella.events.showEditor,function(t){e.onShowEditor()}),paella.events.bind(paella.events.hideEditor,function(t){e.onHideEditor()}),paella.events.bind(paella.events.play,function(t){e.onPlayEvent()}),paella.events.bind(paella.events.pause,function(t){e.onPauseEvent()}),$(document).mousemove(function(t){paella.player.controls.restartHideTimer()}),paella.events.bind(paella.events.endVideo,function(t){e.onEndVideoEvent()}),paella.events.bind("keydown",function(t){e.onKeyEvent()}),this.videoOverlayButtons=new paella.DomNode("div",t+"_videoOverlayButtonPlugins"),this.videoOverlayButtons.domElement.className="videoOverlayButtonPlugins",this.videoOverlayButtons.domElement.setAttribute("role","toolbar"),this.addNode(this.videoOverlayButtons),paella.pluginManager.setTarget("videoOverlayButton",this)},onShowEditor:function(){var t=this.editControl();t&&$(t.domElement).hide()},onHideEditor:function(){var t=this.editControl();t&&$(t.domElement).show()},enterEditMode:function(){var t=this.playbackControl(),e=this.editControl();t&&e&&$(t.domElement).hide()},exitEditMode:function(){var t=this.playbackControl(),e=this.editControl();t&&e&&$(t.domElement).show()},playbackControl:function(){return null==this.playbackControlInstance&&(this.playbackControlInstance=this.getNode(this.playbackControlId)),this.playbackControlInstance},editControl:function(){return this.getNode(this.editControlId)},disable:function(){this.isEnabled=!1,this.hide()},enable:function(){this.isEnabled=!0,this.show()},isHidden:function(){return this._hidden},hide:function(){function t(){e._doHide&&($(e.domElement).css({opacity:0}),$(e.domElement).hide(),e.domElement.setAttribute("aria-hidden","true"),e._hidden=!0,paella.events.trigger(paella.events.controlBarDidHide))}var e=this;this._doHide=!0,paella.events.trigger(paella.events.controlBarWillHide),e._doHide&&(base.userAgent.browser.IsMobileVersion||base.userAgent.browser.Explorer?t():$(this.domElement).animate({opacity:0},{duration:300,complete:t}))},showPopUp:function(t){this.playbackControl().showPopUp(t)},hidePopUp:function(t){this.playbackControl().hidePopUp(t)},show:function(){this.isEnabled&&($(this.domElement).stop(),this._doHide=!1,this.domElement.style.opacity=1,this.domElement.setAttribute("aria-hidden","false"),this._hidden=!1,$(this.domElement).show(),paella.events.trigger(paella.events.controlBarDidShow))},autohideTimeout:function(){this.playbackControl().playbackBar().isSeeking()?paella.player.controls.restartHideTimer():paella.player.controls.hideControls()},hideControls:function(){var t=this;paella.player.videoContainer.paused().then(function(e){e?t.show():t.hide()})},showControls:function(){this.show()},onPlayEvent:function(){this.restartHideTimer()},onPauseEvent:function(){this.clearAutohideTimer()},onEndVideoEvent:function(){this.show(),this.clearAutohideTimer()},onKeyEvent:function(){this.restartHideTimer(),paella.player.videoContainer.paused().then(function(t){t||paella.player.controls.restartHideTimer()})},cancelHideBar:function(){this.restartTimerEvent()},restartTimerEvent:function(){var t=this;this.isHidden()&&this.showControls(),this._doHide=!1,paella.player.videoContainer.paused(function(e){e||t.restartHideTimer()})},clearAutohideTimer:function(){null!=this.autohideTimer&&(this.autohideTimer.cancel(),this.autohideTimer=null)},restartHideTimer:function(){this.showControls(),this.clearAutohideTimer();var t=this;this.autohideTimer=new base.Timer(function(e){t.autohideTimeout()},this.hideControlsTimeMillis)},onresize:function(){this.playbackControl().onresize()}}),Class("paella.LoaderContainer",paella.DomNode,{timer:null,loader:null,loaderPosition:0,initialize:function(t){this.parent("div",t,{position:"fixed",backgroundColor:"white",opacity:"0.7",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:1e4}),this.loader=this.addNode(new paella.DomNode("div","",{position:"fixed",width:"128px",height:"128px",top:"50%",left:"50%",marginLeft:"-64px",marginTop:"-64px",backgroundImage:"url("+paella.utils.folders.resources()+"/images/loader.png)"}));var e=this;paella.events.bind(paella.events.loadComplete,function(t,n){e.loadComplete(n)}),this.timer=new base.Timer(function(t){e.loaderPosition-=128,e.loader.domElement.style.backgroundPosition=e.loaderPosition+"px"},1e3),this.timer.repeat=!0},loadComplete:function(t){$(this.domElement).hide(),this.timer.repeat=!1}}),Class("paella.KeyManager",{isPlaying:!1,Keys:{Space:32,Left:37,Up:38,Right:39,Down:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},enabled:!0,initialize:function(){var t=this;paella.events.bind(paella.events.loadComplete,function(e,n){t.loadComplete(e,n)}),paella.events.bind(paella.events.play,function(e){t.onPlay()}),paella.events.bind(paella.events.pause,function(e){t.onPause()})},loadComplete:function(t,e){var n=this;paella.events.bind("keyup",function(t){n.keyUp(t)})},onPlay:function(){this.isPlaying=!0},onPause:function(){this.isPlaying=!1},keyUp:function(t){this.enabled&&(t.altKey&&t.ctrlKey?t.which==this.Keys.P?this.togglePlayPause():t.which==this.Keys.S?this.pause():t.which==this.Keys.M?this.mute():t.which==this.Keys.U?this.volumeUp():t.which==this.Keys.D&&this.volumeDown():t.which==this.Keys.Space?this.togglePlayPause():t.which==this.Keys.Up?this.volumeUp():t.which==this.Keys.Down?this.volumeDown():t.which==this.Keys.M&&this.mute())},togglePlayPause:function(){this.isPlaying?paella.player.pause():paella.player.play()},pause:function(){paella.player.pause()},mute:function(){paella.player.videoContainer.volume().then(function(t){var e=0;0==t&&(e=1),paella.player.videoContainer.setVolume({master:e,slave:0})})},volumeUp:function(){paella.player.videoContainer.volume().then(function(t){t+=.1,t=t>1?1:t,paella.player.videoContainer.setVolume({master:t,slave:0})})},volumeDown:function(){paella.player.videoContainer.volume().then(function(t){t-=.1,t=t<0?0:t,paella.player.videoContainer.setVolume({master:t,slave:0})})}}),paella.keyManager=new paella.KeyManager,Class("paella.VideoLoader",{metadata:{title:"",duration:0},streams:[],frameList:[],loadStatus:!1,codecStatus:!1,getMetadata:function(){return this.metadata},loadVideo:function(t,e){e()}}),Class("paella.AccessControl",{canRead:function(){return paella_DeferredResolved(!0)},canWrite:function(){return paella_DeferredResolved(!1)},userData:function(){return paella_DeferredResolved({username:"anonymous",name:"Anonymous",avatar:paella.utils.folders.resources()+"/images/default_avatar.png",isAnonymous:!0})},getAuthenticationUrl:function(t){var e=this._authParams.authCallbackName&&window[this._authParams.authCallbackName];return!e&&paella.player.config.auth&&(e=paella.player.config.auth.authCallbackName&&window[paella.player.config.auth.authCallbackName]),"function"==typeof e?e(t):""}}),Class("paella.PlayerBase",{config:null,playerId:"",mainContainer:null,videoContainer:null,controls:null,accessControl:null,checkCompatibility:function(){var t="";if(base.parameters.get("ignoreBrowserCheck"))return!0;if(base.userAgent.browser.IsMobileVersion)return!0;if(base.userAgent.browser.Chrome||base.userAgent.browser.Safari||base.userAgent.browser.Firefox||base.userAgent.browser.Opera||base.userAgent.browser.Edge||base.userAgent.browser.Explorer&&base.userAgent.browser.Version.major>=9)return!0;var e=base.dictionary.translate("It seems that your browser is not HTML 5 compatible");return paella.events.trigger(paella.events.error,{error:e}),t=e+'<div style="display:block;width:470px;height:140px;margin-left:auto;margin-right:auto;font-family:Verdana,sans-sherif;font-size:12px;"><a href="http://www.google.es/chrome" style="color:#004488;float:left;margin-right:20px;"><img src="'+paella.utils.folders.resources()+'images/chrome.png" style="width:80px;height:80px" alt="Google Chrome"></img><p>Google Chrome</p></a><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home" style="color:#004488;float:left;margin-right:20px;"><img src="'+paella.utils.folders.resources()+'images/explorer.png" style="width:80px;height:80px" alt="Internet Explorer 9"></img><p>Internet Explorer 9</p></a><a href="http://www.apple.com/safari/" style="float:left;margin-right:20px;color:#004488"><img src="'+paella.utils.folders.resources()+'images/safari.png" style="width:80px;height:80px" alt="Safari"></img><p>Safari 5</p></a><a href="http://www.mozilla.org/firefox/" style="float:left;color:#004488"><img src="'+paella.utils.folders.resources()+'images/firefox.png" style="width:80px;height:80px" alt="Firefox"></img><p>Firefox 12</p></a></div>',t+='<div style="margin-top:30px;"><a id="ignoreBrowserCheckLink" href="#" onclick="window.location = window.location + \'&ignoreBrowserCheck=true\'">'+base.dictionary.translate("Continue anyway")+"</a></div>",paella.messageBox.showError(t,{height:"40%"}),!1},initialize:function(t){if(void 0!=base.parameters.get("log")){var e=0;switch(base.parameters.get("log")){case"error":e=base.Log.kLevelError;break;case"warn":e=base.Log.kLevelWarning;break;case"debug":e=base.Log.kLevelDebug;break;case"log":case"true":e=base.Log.kLevelLog}base.log.setLevel(e)}if(this.checkCompatibility()){paella.player=this,this.playerId=t,this.mainContainer=$("#"+this.playerId)[0];var n=this;paella.events.bind(paella.events.loadComplete,function(t,e){n.loadComplete(t,e)})}else base.log.debug("It seems that your browser is not HTML 5 compatible")},loadComplete:function(t,e){},auth:{login:function(t){t=t||window.location.href;var e=paella.initDelegate.initParams.accessControl.getAuthenticationUrl(t);e&&(window.location.href=e)},canRead:function(){return paella.initDelegate.initParams.accessControl.canRead()},canWrite:function(){return paella.initDelegate.initParams.accessControl.canWrite()},userData:function(){return paella.initDelegate.initParams.accessControl.userData()}}}),Class("paella.InitDelegate",{initParams:{configUrl:"config/config.json",dictionaryUrl:"localization/paella",accessControl:null,videoLoader:null},initialize:function(t){if(t)for(var e in t)this.initParams[e]=t[e]},getId:function(){return base.parameters.get("id")||"noid"},loadDictionary:function(){var t=this;return new Promise(function(e){base.ajax.get({url:t.initParams.dictionaryUrl+"_"+base.dictionary.currentLanguage()+".json"},function(t,n,i){base.dictionary.addDictionary(t),e(t)},function(t,n,i){e()})})},loadConfig:function(){var t=this;return new Promise(function(e,n){var i=t.initParams.configUrl,r={};r.url=i,base.ajax.get(r,function(i,r,a){if("string"==typeof i)try{i=JSON.parse(i)}catch(t){return void n()}base.dictionary.addDictionary(i);var s=Class.fromString(i.player.accessControlClass||"paella.AccessControl");t.initParams.accessControl=new s,e(i)},function(t,e,n){paella.messageBox.showError(base.dictionary.translate("Error! Config file not found. Please configure paella!"))})})}});var paellaPlayer=null;paella.plugins={},paella.plugins.events={},paella.initDelegate=null,Class("paella.PaellaPlayer",paella.PlayerBase,{player:null,videoIdentifier:"",loader:null,videoData:null,getPlayerMode:function(){return paella.player.isFullScreen()?paella.PaellaPlayer.mode.fullscreen:window.self!==window.top?paella.PaellaPlayer.mode.embed:paella.PaellaPlayer.mode.standard},checkFullScreenCapability:function(){var t=document.getElementById(paella.player.mainContainer.id);return!!(t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.requestFullScreen)||!(!base.userAgent.browser.IsMobileVersion||!paella.player.videoContainer.isMonostream)},addFullScreenListeners:function(){var t=this,e=function(){setTimeout(function(){paella.pluginManager.checkPluginsVisibility()},1e3);var e=document.getElementById(paella.player.mainContainer.id);paella.player.isFullScreen()?(e.style.width="100%",e.style.height="100%"):(e.style.width="",e.style.height=""),t.isFullScreen()?paella.events.trigger(paella.events.enterFullscreen):paella.events.trigger(paella.events.exitFullscreen)};this.eventFullScreenListenerAdded||(this.eventFullScreenListenerAdded=!0,document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),document.addEventListener("MSFullscreenChange",e,!1),document.addEventListener("webkitendfullscreen",e,!1))},isFullScreen:function(){var t=!0===document.webkitIsFullScreen,e=void 0!==document.msFullscreenElement&&null!==document.msFullscreenElement,n=!0===document.mozFullScreen,i=void 0!==document.fullScreenElement&&null!==document.fullScreenElement;return t||e||n||i},goFullScreen:function(){if(!this.isFullScreen())if(base.userAgent.system.iOS)paella.player.videoContainer.masterVideo().goFullScreen();else{var t=document.getElementById(paella.player.mainContainer.id);t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.requestFullScreen&&t.requestFullScreen()}},exitFullScreen:function(){this.isFullScreen()&&(document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen()?document.msExitFullscreen():document.cancelFullScreen&&document.cancelFullScreen())},setProfile:function(t,e){this.videoContainer.setProfile(t,e).then(function(t){return paella.player.getProfile(t)}).then(function(e){paella.player.videoContainer.isMonostream||base.cookies.set("lastProfile",t),paella.events.trigger(paella.events.setProfile,{profileName:t})})},getProfile:function(t){return this.videoContainer.getProfile(t)},initialize:function(t){if(this.parent(t),this.playerId==t){this.loadPaellaPlayer()}Object.defineProperty(this,"selectedProfile",{get:function(){return this.videoContainer.getCurrentProfileName()}})},loadPaellaPlayer:function(){var t=this;this.loader=new paella.LoaderContainer("paellaPlayer_loader"),$("body")[0].appendChild(this.loader.domElement),paella.events.trigger(paella.events.loadStarted),paella.initDelegate.loadDictionary().then(function(){return paella.initDelegate.loadConfig()}).then(function(e){if(t.accessControl=paella.initDelegate.initParams.accessControl,t.onLoadConfig(e),e.skin){var n=e.skin.default||"dark";paella.utils.skin.restore(n)}})},onLoadConfig:function(t){if(paella.data=new paella.Data(t),this.config=t,this.videoIdentifier=paella.initDelegate.getId(),this.videoIdentifier){if(this.mainContainer){this.videoContainer=new paella.VideoContainer(this.playerId+"_videoContainer");var e=new paella.BestFitVideoQualityStrategy;try{var n=this.config.player.videoQualityStrategy;e=new(Class.fromString(n))}catch(t){base.log.warning("Error selecting video quality strategy: strategy not found")}this.videoContainer.setVideoQualityStrategy(e),this.mainContainer.appendChild(this.videoContainer.domElement)}$(window).resize(function(t){paella.player.onresize()}),this.onload()}paella.pluginManager.loadPlugins("paella.FastLoadPlugin")},onload:function(){var t=this,e=(this.accessControl,!1),n={};this.accessControl.canRead().then(function(n){return e=n,t.accessControl.userData()}).then(function(i){if(n=i,e)t.loadVideo(),t.videoContainer.publishVideo();else if(n.isAnonymous){var r=paella.initDelegate.initParams.accessControl.getAuthenticationUrl("player/?id="+paella.player.videoIdentifier),a="<div>"+base.dictionary.translate("You are not authorized to view this resource")+"</div>";r&&(a+='<div class="login-link"><a href="'+r+'">'+base.dictionary.translate("Login")+"</a></div>"),t.unloadAll(a)}else{var s=base.dictionary.translate("You are not authorized to view this resource");t.unloadAll(s),paella.events.trigger(paella.events.error,{error:s})}}).catch(function(e){var n=base.dictionary.translate(e);t.unloadAll(n),paella.events.trigger(paella.events.error,{error:n})})},onresize:function(){this.videoContainer.onresize(),this.controls&&this.controls.onresize();var t=paella.utils.cookies.get("lastProfile");t?this.setProfile(t,!1):this.setProfile(paella.Profiles.getDefaultProfile(),!1),paella.events.trigger(paella.events.resize,{width:$(this.videoContainer.domElement).width(),height:$(this.videoContainer.domElement).height()})},unloadAll:function(t){$("#paellaPlayer_loader")[0];this.mainContainer.innerHTML="",paella.messageBox.showError(t)},reloadVideos:function(t,e){this.videoContainer&&(this.videoContainer.reloadVideos(t,e),this.onresize())},loadVideo:function(){if(this.videoIdentifier){var t=this,e=paella.initDelegate.initParams.videoLoader;paella.player.videoLoader=e,this.onresize(),e.loadVideo(this.videoIdentifier,function(){t.videoContainer.setStreamData(e.streams).then(function(){paella.events.trigger(paella.events.loadComplete),t.addFullScreenListeners(),t.onresize(),t.videoContainer.autoplay()&&t.play()}).catch(function(t){console.log(t)})})}},showPlaybackBar:function(){
this.controls||(this.controls=new paella.ControlsContainer(this.playerId+"_controls"),this.mainContainer.appendChild(this.controls.domElement),this.controls.onresize(),paella.events.trigger(paella.events.loadPlugins,{pluginManager:paella.pluginManager}))},isLiveStream:function(){if(void 0===this._isLiveStream){var t=paella.initDelegate.initParams.videoLoader,e=function(t,e){if(t.length>e){var n=t[e];for(var i in n.sources)if("object"==$traceurRuntime.typeof(n.sources[i]))for(var r=0;r<n.sources[i].length;++r){var a=n.sources[i][r];if(a.isLiveStream)return!0}}return!1};this._isLiveStream=e(t.streams,0)||e(t.streams,1)}return this._isLiveStream},loadPreviews:function(){var t=paella.initDelegate.initParams.videoLoader.streams,e=null,n=t[0].preview;if(t.length>=2&&(e=t[1].preview),n){var i=paella.player.videoContainer.overlayContainer.getMasterRect();this.masterPreviewElem=document.createElement("img"),this.masterPreviewElem.src=n,paella.player.videoContainer.overlayContainer.addElement(this.masterPreviewElem,i)}if(e){var r=paella.player.videoContainer.overlayContainer.getSlaveRect();this.slavePreviewElem=document.createElement("img"),this.slavePreviewElem.src=e,paella.player.videoContainer.overlayContainer.addElement(this.slavePreviewElem,r)}paella.events.bind(paella.events.timeUpdate,function(t){paella.player.unloadPreviews()})},unloadPreviews:function(){this.masterPreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.masterPreviewElem),this.masterPreviewElem=null),this.slavePreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.slavePreviewElem),this.slavePreviewElem=null)},loadComplete:function(t,e){paella.pluginManager.loadPlugins("paella.EarlyLoadPlugin"),paella.player.videoContainer._autoplay&&this.play()},play:function(){if(!this.controls){this.showPlaybackBar();var t=base.parameters.get("time"),e=base.hashParams.get("time"),n=e||(t||"0s"),i=paella.utils.timeParse.timeToSeconds(n);i&&paella.player.videoContainer.setStartTime(i),paella.events.trigger(paella.events.controlBarLoaded),this.controls.onresize()}return this.videoContainer.play()},pause:function(){return this.videoContainer.pause()},playing:function(){var t=this;return new Promise(function(e){t.paused().then(function(t){e(!t)})})},paused:function(){return this.videoContainer.paused()}});var PaellaPlayer=paella.PaellaPlayer;paella.PaellaPlayer.mode={standard:"standard",fullscreen:"fullscreen",embed:"embed"},Class("paella.DefaultVideoLoader",paella.VideoLoader,{_url:null,initialize:function(t){if("object"==$traceurRuntime.typeof(t))this._data=t;else try{this._data=JSON.parse(t)}catch(e){this._url=t}},loadVideo:function(t,e){if(this._data)this.loadVideoData(this._data,e);else if(this._url){var n=this;this._url=(/\/$/.test(this._url)?this._url:this._url+"/")+t+"/",base.ajax.get({url:this._url+"data.json"},function(t,i,r){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}n._data=t,n.loadVideoData(n._data,e)},function(t,e,n){switch(n){case 401:paella.messageBox.showError(base.dictionary.translate("You are not logged in"));break;case 403:paella.messageBox.showError(base.dictionary.translate("You are not authorized to view this resource"));break;case 404:paella.messageBox.showError(base.dictionary.translate("The specified video identifier does not exist"));break;default:paella.messageBox.showError(base.dictionary.translate("Could not load the video"))}})}},loadVideoData:function(t,e){var n=this;t.metadata&&(this.metadata=t.metadata),t.streams&&t.streams.forEach(function(t){n.loadStream(t)}),t.frameList&&this.loadFrameData(t),t.captions&&this.loadCaptions(t.captions),t.blackboard&&this.loadBlackboard(t.streams[0],t.blackboard),this.streams=t.streams,this.frameList=t.frameList,this.loadStatus=this.streams.length>0,e()},loadFrameData:function(t){var e=this;if(t.frameList&&t.frameList.forEach){var n={};t.frameList.forEach(function(t){/^[a-zA-Z]+:\/\//.test(t.url)||/^data:/.test(t.url)||(t.url=e._url+t.url),!t.thumb||/^[a-zA-Z]+:\/\//.test(t.thumb)||/^data:/.test(t.thumb)||(t.thumb=e._url+t.thumb);var i=t.time;n[i]=t}),t.frameList=n}},loadStream:function(t){var e=this;!t.preview||/^[a-zA-Z]+:\/\//.test(t.preview)||/^data:/.test(t.preview)||(t.preview=e._url+t.preview),t.sources.image&&t.sources.image.forEach(function(t){if(t.frames.forEach){var n={};t.frames.forEach(function(t){!t.src||/^[a-zA-Z]+:\/\//.test(t.src)||/^data:/.test(t.src)||(t.src=e._url+t.src),!t.thumb||/^[a-zA-Z]+:\/\//.test(t.thumb)||/^data:/.test(t.thumb)||(t.thumb=e._url+t.thumb);var i="frame_"+t.time;n[i]=t.src}),t.frames=n}});for(var n in t.sources)if(t.sources[n]){if("image"!=n){var i=t.sources[n];i.forEach(function(t){var n=/^[a-zA-Z\:]+\:\/\//gi;"string"==typeof t.src&&null==t.src.match(n)&&(t.src=e._url+t.src),t.type=t.mimetype})}}else delete t.sources[n]},loadCaptions:function(t){if(t)for(var e=0;e<t.length;++e){var n=t[e].url;/^[a-zA-Z]+:\/\//.test(n)||(n=this._url+n);var i=new paella.captions.Caption(e,t[e].format,n,{code:t[e].lang,txt:t[e].text});paella.captions.addCaptions(i)}},loadBlackboard:function(t,e){var n=this;t.sources.image||(t.sources.image=[]);var i={count:e.frames.length,duration:e.duration,mimetype:e.mimetype,res:e.res,frames:{}};e.frames.forEach(function(t){var e="frame_"+Math.round(t.time);/^[a-zA-Z]+:\/\//.test(t.src)||(t.src=n._url+t.src),i.frames[e]=t.src}),t.sources.image.push(i)}}),Class("paella.DefaultInitDelegate",paella.InitDelegate,{initialize:function(t,e){1==arguments.length?this.parent(arguments[0]):2==arguments.length&&(this._config=arguments[0],this.parent(arguments[1]))},loadConfig:function(){var t=this;return this._config?new Promise(function(e){base.dictionary.addDictionary(t._config);var n=Class.fromString(t._config.player.accessControlClass||"paella.AccessControl");t.initParams.accessControl=new n,e(t._config)}):this.parent()}}),paella.load=function(t,e){var n=(e&&e.auth,null);if(n=paella.utils.parameters.get("video")){var i=paella.utils.parameters.get("videoSlave");i=i&&decodeURIComponent(i);var r=paella.utils.parameters.get("preview");r=r&&decodeURIComponent(r);var a=paella.utils.parameters.get("previewSlave");a=a&&decodeURIComponent(a);var s=paella.utils.parameters.get("preview")||"Untitled Video",o={metadata:{title:s},streams:[{sources:{mp4:[{src:decodeURIComponent(n),mimetype:"video/mp4",res:{w:0,h:0}}]},preview:r}]};i&&o.streams.push({sources:{mp4:[{src:i,mimetype:"video/mp4",res:{w:0,h:0}}]},preview:a}),e.data=o}var u={videoLoader:new paella.DefaultVideoLoader(e.data||e.url)};e.config?paella.initDelegate=new paella.DefaultInitDelegate(e.config,u):paella.initDelegate=new paella.DefaultInitDelegate(u),new PaellaPlayer(t,paella.initDelegate)},Class("paella.RightBarPlugin",paella.DeferredLoadPlugin,{type:"rightBarPlugin",getName:function(){return"es.upv.paella.RightBarPlugin"},buildContent:function(t){}}),Class("paella.TabBarPlugin",paella.DeferredLoadPlugin,{type:"tabBarPlugin",getName:function(){return"es.upv.paella.TabBarPlugin"},getTabName:function(){return"New Tab"},action:function(t){},buildContent:function(t){},setToolTip:function(t){this.button.setAttribute("title",t),this.button.setAttribute("aria-label",t)},getDefaultToolTip:function(){return""}}),Class("paella.ExtendedAdapter",{rightContainer:null,bottomContainer:null,rightBarPlugins:[],tabBarPlugins:[],currentTabIndex:0,bottomContainerTabs:null,bottomContainerContent:null,initialize:function(){this.rightContainer=document.createElement("div"),this.rightContainer.className="rightPluginContainer",this.bottomContainer=document.createElement("div"),this.bottomContainer.className="tabsPluginContainer";var t=document.createElement("div");t.className="tabsLabelContainer",this.bottomContainerTabs=t,this.bottomContainer.appendChild(t);var e=document.createElement("div");e.className="tabsContentContainer",this.bottomContainerContent=e,this.bottomContainer.appendChild(e),this.initPlugins()},initPlugins:function(){paella.pluginManager.setTarget("rightBarPlugin",this),paella.pluginManager.setTarget("tabBarPlugin",this)},addPlugin:function(t){var e=this;t.checkEnabled(function(n){n&&(paella.pluginManager.setupPlugin(t),"rightBarPlugin"==t.type&&(e.rightBarPlugins.push(t),e.addRightBarPlugin(t)),"tabBarPlugin"==t.type&&(e.tabBarPlugins.push(t),e.addTabPlugin(t)))})},showTab:function(t){var e=0,n=this.bottomContainer.getElementsByClassName("tabLabel"),i=this.bottomContainer.getElementsByClassName("tabContent");for(e=0;e<n.length;++e)n[e].getAttribute("tab")==t?n[e].className="tabLabel enabled":n[e].className="tabLabel disabled";for(e=0;e<i.length;++e)i[e].getAttribute("tab")==t?i[e].className="tabContent enabled":i[e].className="tabContent disabled"},addTabPlugin:function(t){var e=this,n=this.currentTabIndex,i=document.createElement("div");i.setAttribute("tab",n),i.className="tabLabel disabled",i.innerHTML=t.getTabName(),i.plugin=t,$(i).click(function(t){/disabled/.test(this.className)&&(e.showTab(n),this.plugin.action(this))}),$(i).keyup(function(t){13==t.keyCode&&/disabledTabItem/.test(this.className)&&(e.showTab(n),this.plugin.action(this))}),this.bottomContainerTabs.appendChild(i);var r=document.createElement("div");r.setAttribute("tab",n),r.className="tabContent disabled "+t.getSubclass(),this.bottomContainerContent.appendChild(r),t.buildContent(r),t.button=i,t.container=r,t.button.setAttribute("tabindex",3e3+t.getIndex()),t.button.setAttribute("alt",""),t.setToolTip(t.getDefaultToolTip()),void 0===this.firstTabShown&&(this.showTab(n),this.firstTabShown=!0),++this.currentTabIndex},addRightBarPlugin:function(t){var e=document.createElement("div");e.className="rightBarPluginContainer "+t.getSubclass(),this.rightContainer.appendChild(e),t.buildContent(e)}}),paella.extendedAdapter=new paella.ExtendedAdapter,Class("paella.editor.EmbedPlayer",base.AsyncLoaderCallback,{editar:null,initialize:function(){this.editor=paella.editor.instance},load:function(t,e){var n=this.editor.bottomBar.getHeight()+20,i=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:n+"px",right:i+"px",left:"20px",top:"20px"}),paella.player.mainContainer.className="paellaMainContainerEditorMode",new Timer(function(e){paella.player.controls.disable(),paella.player.onresize(),t&&t()},500)},restorePlayer:function(){$("body")[0].appendChild(paella.player.mainContainer),paella.player.controls.enable(),paella.player.mainContainer.className="",$(paella.player.mainContainer).css({position:"",width:"",bottom:"",left:"",right:"",top:""}),paella.player.onresize()},onresize:function(){var t=this.editor.bottomBar.getHeight()+20,e=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:t+"px",right:e+"px",left:"20px",top:"20px"})}}),DeprecatedClass("paella.Dictionary","base.Dictionary",base.Dictionary),paella.dictionary=base.dictionary,DeprecatedClass("paella.AsyncLoaderCallback","base.AsyncLoaderCallback",base.AsyncLoaderCallback),DeprecatedClass("paella.AjaxCallback","base.AjaxCallback",base.AjaxCallback),DeprecatedClass("paella.JSONCallback","base.JSONCallback",base.JSONCallback),DeprecatedClass("paella.DictionaryCallback","base.DictionaryCallback",base.DictionaryCallback),DeprecatedClass("paella.AsyncLoader","base.AsyncLoader",base.AsyncLoader),DeprecatedClass("paella.Timer","base.Timer",base.Timer),DeprecatedClass("paella.utils.Timer","base.Timer",base.Timer),paella.ajax={},paella.ajax.send=DeprecatedFunc("paella.ajax.send","base.ajax.send",base.ajax.send),paella.ajax.get=DeprecatedFunc("paella.ajax.get","base.ajax.get",base.ajax.get),paella.ajax.put=DeprecatedFunc("paella.ajax.put","base.ajax.put",base.ajax.put),paella.ajax.post=DeprecatedFunc("paella.ajax.post","base.ajax.post",base.ajax.post),paella.ajax.delete=DeprecatedFunc("paella.ajax.delete","base.ajax.delete",base.ajax.send),paella.ui={},paella.ui.Container=function(t){var e=document.createElement("div");return t.id&&(e.id=t.id),t.className&&(e.className=t.className),t.style&&$(e).css(t.style),e},paella.utils.ajax=base.ajax,paella.utils.cookies=base.cookies,paella.utils.parameters=base.parameters,paella.utils.require=base.require,paella.utils.importStylesheet=base.importStylesheet,paella.utils.language=base.dictionary.currentLanguage,paella.utils.uuid=base.uuid,paella.utils.userAgent=base.userAgent,paella.debug={log:function(t){base.log.warning("paella.debug.log is deprecated, use base.debug.[error/warning/debug/log] instead."),base.log.log(t)}},Class("paella.plugins.FlexSkipPlugin",paella.ButtonPlugin,{getAlignment:function(){return"left"},getName:function(){return"edu.harvard.dce.paella.flexSkipPlugin"},getIndex:function(){return 121},getSubclass:function(){return"flexSkip_Rewind_10"},formatMessage:function(){return"Rewind 10 seconds"},getDefaultToolTip:function(){return base.dictionary.translate(this.formatMessage())},getMinWindowSize:function(){return 510},checkEnabled:function(t){t(!paella.player.isLiveStream())},action:function(t){paella.player.videoContainer.currentTime().then(function(t){paella.player.videoContainer.seekToTime(t-10)})}}),paella.plugins.flexSkipPlugin=new paella.plugins.FlexSkipPlugin,Class("paella.plugins.FlexSkipForwardPlugin",paella.plugins.FlexSkipPlugin,{getIndex:function(){return 122},getName:function(){return"edu.harvard.dce.paella.flexSkipForwardPlugin"},getSubclass:function(){return"flexSkip_Forward_30"},formatMessage:function(){return"Forward 30 seconds"},action:function(t){paella.player.videoContainer.currentTime().then(function(t){paella.player.videoContainer.seekToTime(t+30)})}}),paella.plugins.flexSkipForwardPlugin=new paella.plugins.FlexSkipForwardPlugin,function(){Class("paella.captions.parsers.WebVTTParserPlugin",paella.CaptionParserPlugIn,{ext:["vtt"],getName:function(){return"es.teltek.paella.captions.WebVTTParserPlugin"},parse:function(t,e,n){for(var i,r=[],a=this,s=t.split("\n"),o=0,u=!1,l=0;l<s.length;++l){var c=s[l].trim();/^WEBVTT/.test(c)&&void 0===i||0===c.length||((/^[0-9]+$/.test(c)||/^[0-9]+ -/.test(c))&&0===s[l-1].trim().length||(/^NOTE/.test(c)||/^STYLE/.test(c)?u=!0:/^(([0-9]{2}:)?[0-9]{2}:[0-9]{2}.[0-9]{3} --> ([0-9]{2}:)?[0-9]{2}:[0-9]{2}.[0-9]{3})/.test(c)?(u=!1,void 0!=i&&(r.push(i),o++),i={id:o,begin:a.parseTimeTextToSeg(c.split("--\x3e")[0]),end:a.parseTimeTextToSeg(c.split("--\x3e")[1])}):void 0===i||u||(c=c.replace(/^- /,""),c=c.replace(/<[^>]*>/g,""),void 0===i.content?i.content=c:i.content+="<p></p>"+c)))}r.push(i),r.length>0?n(!1,r):n(!0)},parseTimeTextToSeg:function(t){var e=0,n=1;t=/(([0-9]{2}:)?[0-9]{2}:[0-9]{2}.[0-9]{3})/.exec(t);for(var i=t[0].split(":"),r=i.length-1;r>=0;r--)n=Math.pow(60,i.length-1-r),e+=i[r]*n;return e}}),new paella.captions.parsers.WebVTTParserPlugin}(),paella.plugins.TrimmingTrackPlugin=Class.create(paella.editor.MainTrackPlugin,{trimmingTrack:null,trimmingData:{s:0,e:0},getTrackItems:function(){null==this.trimmingTrack&&(this.trimmingTrack={id:1,s:0,e:0},this.trimmingTrack.s=paella.player.videoContainer.trimStart(),this.trimmingTrack.e=paella.player.videoContainer.trimEnd(),this.trimmingData.s=this.trimmingTrack.s,this.trimmingData.e=this.trimmingTrack.e);var t=[];return t.push(this.trimmingTrack),t},getName:function(){return"es.upv.paella.editor.trimmingTrackPlugin"},getTools:function(){if(this.config.enableResetButton)return[{name:"reset",label:base.dictionary.translate("Reset"),hint:base.dictionary.translate("Resets the trimming bar to the default length of the video.")}]},onToolSelected:function(t){if(this.config.enableResetButton&&"reset"==t)return this.trimmingTrack={id:1,s:0,e:0},this.trimmingTrack.s=0,this.trimmingTrack.e=paella.player.videoContainer.duration(!0),!0},getTrackName:function(){return base.dictionary.translate("Trimming")},getColor:function(){return"rgb(0, 51, 107)"},onSave:function(t){paella.player.videoContainer.enableTrimming(),paella.player.videoContainer.setTrimmingStart(this.trimmingTrack.s),paella.player.videoContainer.setTrimmingEnd(this.trimmingTrack.e),this.trimmingData.s=this.trimmingTrack.s,this.trimmingData.e=this.trimmingTrack.e,paella.data.write("trimming",{id:paella.initDelegate.getId()},{start:this.trimmingTrack.s,end:this.trimmingTrack.e},function(e,n){t(n)})},onDiscard:function(t){this.trimmingTrack.s=this.trimmingData.s,this.trimmingTrack.e=this.trimmingData.e,t(!0)},allowDrag:function(){return!1},onTrackChanged:function(t,e,n){playerEnd=paella.player.videoContainer.duration(!0),e=e<0?0:e,n=n>playerEnd?playerEnd:n,this.trimmingTrack.s=e,this.trimmingTrack.e=n,this.parent(t,e,n)},contextHelpString:function(){return"es"==base.dictionary.currentLanguage()?'Utiliza la herramienta de recorte para definir el instante inicial y el instante final de la clase. Para cambiar la duración solo hay que arrastrar el inicio o el final de la pista "Recorte", en la linea de tiempo.':"Use this tool to define the start and finish time."}}),paella.plugins.trimmingTrackPlugin=new paella.plugins.TrimmingTrackPlugin,Class("paella.plugins.TrimmingLoaderPlugin",paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.trimmingPlayerPlugin"},getEvents:function(){return[paella.events.controlBarLoaded,paella.events.showEditor,paella.events.hideEditor]},onEvent:function(t,e){switch(t){case paella.events.controlBarLoaded:this.loadTrimming();break;case paella.events.showEditor:paella.player.videoContainer.disableTrimming();break;case paella.events.hideEditor:paella.player.config.trimming&&paella.player.config.trimming.enabled&&paella.player.videoContainer.enableTrimming()}},loadTrimming:function(){var t=paella.initDelegate.getId();paella.data.read("trimming",{id:t},function(t,e){if(t&&e&&t.end>0)paella.player.videoContainer.setTrimming(t.start,t.end).then(function(){return paella.player.videoContainer.enableTrimming()});else{var n=base.parameters.get("start"),i=base.parameters.get("end");n&&i&&paella.player.videoContainer.setTrimming(n,i).then(function(){return paella.player.videoContainer.enableTrimming()})}})}}),paella.plugins.trimmingLoaderPlugin=new paella.plugins.TrimmingLoaderPlugin,Class("paella.plugins.AirPlayPlugin",paella.ButtonPlugin,{_visible:!1,getIndex:function(){return 552},getAlignment:function(){return"right"},getSubclass:function(){return"AirPlayButton"},getName:function(){return"es.upv.paella.airPlayPlugin"},checkEnabled:function(t){t(window.WebKitPlaybackTargetAvailabilityEvent)},getDefaultToolTip:function(){return base.dictionary.translate("Emit to AirPlay.")},setup:function(){var t=this,e=paella.player.videoContainer.masterVideo().video;window.WebKitPlaybackTargetAvailabilityEvent&&e.addEventListener("webkitplaybacktargetavailabilitychanged",function(e){switch(e.availability){case"available":t._visible=!0;break;case"not-available":t._visible=!1}t.updateClassName()})},action:function(t){paella.player.videoContainer.masterVideo().video.webkitShowPlaybackTargetPicker()},updateClassName:function(){this.button.className=this.getButtonItemClass(!0)},getButtonItemClass:function(t){return"buttonPlugin "+this.getSubclass()+" "+this.getAlignment()+" "+(this._visible?"available":"not-available")}}),paella.plugins.airPlayPlugin=new paella.plugins.AirPlayPlugin,Class("paella.plugins.ArrowSlidesNavigator",paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.arrowSlidesNavigatorPlugin"},checkEnabled:function(t){t(!paella.initDelegate.initParams.videoLoader.frameList||0==Object.keys(paella.initDelegate.initParams.videoLoader.frameList).length&&paella.player.videoContainer.isMonostream?!1:!0)},setup:function(){var t=this;this._showArrowsIn=this.config.showArrowsIn||"slave",this.createOverlay(),t._frames=[];var e=paella.initDelegate.initParams.videoLoader.frameList;if(e){var n=Object.keys(e);n.length,n.map(function(t){return Number(t,10)}).sort(function(t,e){return t-e}).forEach(function(n){t._frames.push(e[n])})}},createOverlay:function(){var t=this,e=paella.player.videoContainer.overlayContainer;if(!this.arrows){this.arrows=document.createElement("div"),this.arrows.id="arrows",this.arrows.style.marginTop="25%";var n=document.createElement("div");n.className="buttonPlugin arrowSlideNavidator nextButton right",this.arrows.appendChild(n);var i=document.createElement("div");i.className="buttonPlugin arrowSlideNavidator prevButton left",this.arrows.appendChild(i),$(n).click(function(e){t.goNextSlide(),e.stopPropagation()}),$(i).click(function(e){t.goPrevSlide(),e.stopPropagation()})}switch(this.container&&e.removeElement(this.container),t._showArrowsIn){case"full":this.container=e.addLayer(),this.container.style.marginRight="0",this.container.style.marginLeft="0",this.arrows.style.marginTop="25%";break;case"master":var r=document.createElement("div");this.container=e.addElement(r,e.getMasterRect()),this.arrows.style.marginTop="23%";break;case"slave":var r=document.createElement("div");this.container=e.addElement(r,e.getSlaveRect()),this.arrows.style.marginTop="35%"}this.container.appendChild(this.arrows),this.hideArrows()},getCurrentRange:function(){var t=this;return new Promise(function(e){if(t._frames.length<1)e(null);else{var n=null,i=0;paella.player.videoContainer.duration().then(function(t){return i=t,paella.player.videoContainer.trimming()}).then(function(t){return n=t,paella.player.videoContainer.currentTime()}).then(function(i){if(!t._frames.some(function(r,a,s){if(a+1!=s.length){var o=0==a?r:t._frames[a-1],u=t._frames[a+1],l=n.enabled?o.time-n.start:o.time,c=n.enabled?r.time-n.start:r.time,h=n.enabled?u.time-n.start:u.time;if(c<i&&h>i){var f={prev:l,next:h};return l<0&&(f.prev=c>0?c:0),e(f),!0}}})){var r=t._frames[t._frames.length-2].time,a=t._frames[t._frames.length-1].time;e({prev:n.enabled?r-n.start:r,next:n.enabled?a-n.start:a})}})}})},goNextSlide:function(){this.getCurrentRange().then(function(t){console.log(t),paella.player.videoContainer.seekToTime(t.next)})},goPrevSlide:function(){this.getCurrentRange().then(function(t){console.log(t),paella.player.videoContainer.seekToTime(t.prev-1)})},showArrows:function(){$(this.arrows).show()},hideArrows:function(){$(this.arrows).hide()},getEvents:function(){return[paella.events.controlBarDidShow,paella.events.controlBarDidHide,paella.events.setComposition]},onEvent:function(t,e){switch(t){case paella.events.controlBarDidShow:this.showArrows();break;case paella.events.controlBarDidHide:this.hideArrows();break;case paella.events.setComposition:this.createOverlay()}}}),paella.plugins.arrowSlidesNavigator=new paella.plugins.ArrowSlidesNavigator,function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{getAlignment:function(){return"right"},getSubclass:function(){return"audioLanguages"},getIndex:function(){return 2040},getMinWindowSize:function(){return 400},getName:function(){return"es.upv.paella.audioLanguage"},getDefaultToolTip:function(){return base.dictionary.translate("Set audio language")},closeOnMouseOut:function(){return!0},checkEnabled:function(t){var e=this;paella.player.videoContainer.getAudioLanguages().then(function(n){e._languages=n,t(n.length>1)})},setup:function(){var t=this;this.setLanguageLabel(),paella.events.bind(paella.events.audioLanguageChanged,function(){t.setLanguageLabel()})},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(t){var e=this;this._languages.forEach(function(n){t.appendChild(e.getItemButton(n))})},getItemButton:function(t){var e=document.createElement("div"),n=paella.player.videoContainer.mainAudioPlayer().stream.language,i=paella.dictionary.translate(t);return e.className=this.getButtonItemClass(i,t==n),e.id="laguageSelectorItem_"+t,e.innerHTML=i,e.data=t,$(e).click(function(t){$(".videoAudioTrackItem").removeClass("selected"),$(".videoAudioTrackItem."+this.data).addClass("selected"),paella.player.videoContainer.setAudioLanguage(this.data)}),e},setQualityLabel:function(){var t=this;paella.player.videoContainer.getCurrentQuality().then(function(e){t.setText(e.shortLabel())})},getButtonItemClass:function(t,e){return"videoAudioTrackItem "+t+(e?" selected":"")},setLanguageLabel:function(){this.setText(paella.player.videoContainer.audioLanguage)}},{},t)}(paella.ButtonPlugin);paella.plugins.audioLanguage=new t}(),Class("paella.BlackBoard2",paella.EventDrivenPlugin,{_blackBoardProfile:"s_p_blackboard2",_blackBoardDIV:null,_hasImages:null,_active:!1,_creationTimer:500,_zImages:null,_videoLength:null,_keys:null,_currentImage:null,_next:null,_prev:null,_lensDIV:null,_lensContainer:null,_lensWidth:null,_lensHeight:null,_conImg:null,_zoom:250,_currentZoom:null,_maxZoom:500,_mousePos:null,_containerRect:null,getName:function(){return"es.upv.paella.blackBoardPlugin"},getIndex:function(){return 10},getAlignment:function(){return"right"},getSubclass:function(){return"blackBoardButton2"},getDefaultToolTip:function(){return base.dictionary.translate("BlackBoard")},checkEnabled:function(t){t(!0)},getEvents:function(){return[paella.events.setProfile,paella.events.timeUpdate]},onEvent:function(t,e){var n=this;switch(t){case paella.events.setProfile:if(e.profileName!=n._blackBoardProfile){n._active&&(n.destroyOverlay(),n._active=!1);break}n._hasImages||paella.player.setProfile("slide_professor"),n._hasImages&&!n._active&&(n.createOverlay(),n._active=!0);break;case paella.events.timeUpdate:n._active&&n._hasImages&&n.imageUpdate(t,e)}},setup:function(){var t=this;if(paella.player.videoContainer.sourceData[0].sources.hasOwnProperty("image"))t._hasImages=!0,t._zImages={},t._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,t._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,t._keys=Object.keys(t._zImages),t._keys=t._keys.sort(function(t,e){return t=t.slice(6),e=e.slice(6),parseInt(t)-parseInt(e)});else if(t._hasImages=!1,paella.player.selectedProfile==t._blackBoardProfile){var e=paella.player.config.defaultProfile;paella.player.setProfile(e)}this._next=0,this._prev=0,paella.player.selectedProfile==t._blackBoardProfile&&(t.createOverlay(),t._active=!0),t._mousePos={},paella.Profiles.loadProfile(t._blackBoardProfile,function(e){t._containerRect=e.blackBoardImages})},createLens:function(){var t=this;null==t._currentZoom&&(t._currentZoom=t._zoom);var e=document.createElement("div");e.className="lensClass",t._lensDIV=e;var n=$(".conImg").offset(),i=$(".conImg").width(),r=$(".conImg").height();e.style.width=i/(t._currentZoom/100)+"px",e.style.height=r/(t._currentZoom/100)+"px",t._lensWidth=parseInt(e.style.width),t._lensHeight=parseInt(e.style.height),$(t._lensContainer).append(e),$(t._lensContainer).mousemove(function(e){var a=e.pageX-n.left,s=e.pageY-n.top;t._mousePos.x=a,t._mousePos.y=s;var o=s-t._lensHeight/2;o=o<0?0:o,o=o>r-t._lensHeight?r-t._lensHeight:o;var u=a-t._lensWidth/2;if(u=u<0?0:u,u=u>i-t._lensWidth?i-t._lensWidth:u,t._lensDIV.style.left=u+"px",t._lensDIV.style.top=o+"px",100!=t._currentZoom){var l=100*u/(i-t._lensWidth),c=100*o/(r-t._lensHeight);t._blackBoardDIV.style.backgroundPosition=l.toString()+"% "+c.toString()+"%"}else if(100==t._currentZoom){var h=100*a/i,f=100*s/r;t._blackBoardDIV.style.backgroundPosition=h.toString()+"% "+f.toString()+"%"}t._blackBoardDIV.style.backgroundSize=t._currentZoom+"%"}),$(t._lensContainer).bind("wheel mousewheel",function(e){var n;n=void 0!==e.originalEvent.wheelDelta?e.originalEvent.wheelDelta:-1*e.originalEvent.deltaY,n>0&&t._currentZoom<t._maxZoom?t.reBuildLens(10):t._currentZoom>100?t.reBuildLens(-10):100==t._currentZoom&&(t._lensDIV.style.left="0px",t._lensDIV.style.top="0px"),t._blackBoardDIV.style.backgroundSize=t._currentZoom+"%"})},reBuildLens:function(t){var e=this;e._currentZoom+=t;var n=($(".conImg").offset(),$(".conImg").width()),i=$(".conImg").height();if(e._lensDIV.style.width=n/(e._currentZoom/100)+"px",e._lensDIV.style.height=i/(e._currentZoom/100)+"px",e._lensWidth=parseInt(e._lensDIV.style.width),e._lensHeight=parseInt(e._lensDIV.style.height),100!=e._currentZoom){var r=e._mousePos.x,a=e._mousePos.y,s=a-e._lensHeight/2;s=s<0?0:s,s=s>i-e._lensHeight?i-e._lensHeight:s;var o=r-e._lensWidth/2;o=o<0?0:o,o=o>n-e._lensWidth?n-e._lensWidth:o,e._lensDIV.style.left=o+"px",e._lensDIV.style.top=s+"px";var u=100*o/(n-e._lensWidth),l=100*s/(i-e._lensHeight);e._blackBoardDIV.style.backgroundPosition=u.toString()+"% "+l.toString()+"%"}},destroyLens:function(){var t=this;t._lensDIV&&($(t._lensDIV).remove(),t._blackBoardDIV.style.backgroundSize="100%",t._blackBoardDIV.style.opacity=0)},createOverlay:function(){var t=this,e=document.createElement("div");e.className="blackBoardDiv",t._blackBoardDIV=e,t._blackBoardDIV.style.opacity=0;var n=document.createElement("div");n.className="lensContainer",t._lensContainer=n;var i=document.createElement("img");i.className="conImg",t._conImg=i,t._currentImage&&(t._conImg.src=t._currentImage,$(t._blackBoardDIV).css("background-image","url("+t._currentImage+")")),$(n).append(i),$(t._lensContainer).mouseenter(function(){t.createLens(),t._blackBoardDIV.style.opacity=1}),$(t._lensContainer).mouseleave(function(){t.destroyLens()}),setTimeout(function(){var i=paella.player.videoContainer.overlayContainer;i.addElement(e,i.getMasterRect()),i.addElement(n,t._containerRect)},t._creationTimer)},destroyOverlay:function(){var t=this;t._blackBoardDIV&&$(t._blackBoardDIV).remove(),t._lensContainer&&$(t._lensContainer).remove()},imageUpdate:function(t,e){var n=this,i=Math.round(e.currentTime),r=$(n._blackBoardDIV).css("background-image");if($(n._blackBoardDIV).length>0){if(n._zImages.hasOwnProperty("frame_"+i)){if(r==n._zImages["frame_"+i])return;r=n._zImages["frame_"+i]}else{if(!(i>n._next||i<n._prev))return;r=n.returnSrc(i)}var a=new Image;a.onload=function(){$(n._blackBoardDIV).css("background-image","url("+r+")")},a.src=r,n._currentImage=r,n._conImg.src=n._currentImage}},returnSrc:function(t){for(var e=0,n=0;n<this._keys.length;n++){var i=parseInt(this._keys[n].slice(6)),r=parseInt(this._keys[this._keys.length-1].slice(6));if(t<i)return this._next=i,this._prev=e,this._imageNumber=n-1,this._zImages["frame_"+e];if(t>r&&t<this._videoLength)return this._next=this._videoLength,this._prev=r,this._zImages["frame_"+e];e=i}}}),paella.plugins.blackBoard2=new paella.BlackBoard2,Class("paella.plugins.BreaksPlayerPlugin",paella.EventDrivenPlugin,{breaks:null,lastEvent:0,visibleBreaks:null,getName:function(){return"es.upv.paella.breaksPlayerPlugin"},checkEnabled:function(t){var e=this;this.breaks=[],this.visibleBreaks=[],paella.data.read("breaks",{id:paella.initDelegate.getId()},function(n,i){n&&"object"==$traceurRuntime.typeof(n)&&n.breaks&&n.breaks.length>0&&(e.breaks=n.breaks),t(!0)})},getEvents:function(){return[paella.events.timeUpdate]},onEvent:function(t,e){var n=this;e.videoContainer.currentTime(!0).then(function(t){n.checkBreaks(t)})},checkBreaks:function(t){for(var e,n=0;n<this.breaks.length;++n)e=this.breaks[n],e.s<t&&e.e>t?this.areBreaksClickable()?this.avoidBreak(e):this.showBreaks(e):e.s.toFixed(0)==t.toFixed(0)&&this.avoidBreak(e);if(!this.areBreaksClickable())for(var i in this.visibleBreaks)"object"==$traceurRuntime.typeof(e)&&(e=this.visibleBreaks[i])&&(e.s>=t||e.e<=t)&&this.removeBreak(e)},areBreaksClickable:function(){return this.config.neverShow&&!(paella.editor.instance&&paella.editor.instance.isLoaded)},showBreaks:function(t){if(!this.visibleBreaks[t.s]){var e={left:100,top:350,width:1080,height:40},n=t.name||paella.dictionary.translate("Break");t.elem=paella.player.videoContainer.overlayContainer.addText(n,e),t.elem.className="textBreak",this.visibleBreaks[t.s]=t}},removeBreak:function(t){if(this.visibleBreaks[t.s]){var e=this.visibleBreaks[t.s].elem;paella.player.videoContainer.overlayContainer.removeElement(e),this.visibleBreaks[t.s]=null}},avoidBreak:function(t){var e=t.e+(this.config.neverShow?.01:0)-paella.player.videoContainer.trimStart();paella.player.videoContainer.seekToTime(e)}}),paella.plugins.breaksPlayerPlugin=new paella.plugins.BreaksPlayerPlugin,function(){Class("paella.captions.parsers.DFXPParserPlugin",paella.CaptionParserPlugIn,{
ext:["dfxp"],getName:function(){return"es.upv.paella.captions.DFXPParserPlugin"},parse:function(t,e,n){for(var i=[],r=this,a=$(t),s=a.attr("xml:lang"),o=a.find("div"),u=0;u<o.length;++u){var l=$(o[u]),c=l.attr("xml:lang");if(void 0!=c&&""!=c||(void 0==s||""==s?(base.log.debug("No xml:lang found! Using '"+e+"' lang instead."),c=e):c=s),c==e){l.find("p").each(function(t,e){var n={id:t,begin:r.parseTimeTextToSeg(e.getAttribute("begin")),end:r.parseTimeTextToSeg(e.getAttribute("end")),content:$(e).text().trim()};i.push(n)});break}}i.length>0?n(!1,i):n(!0)},parseTimeTextToSeg:function(t){var e=0;if(/^([0-9]*([.,][0-9]*)?)s/.test(t))e=parseFloat(RegExp.$1);else{var n=t.split(":"),i=parseInt(n[0]),r=parseInt(n[1]);e=parseInt(n[2])+60*r+60*i*60}return e}}),new paella.captions.parsers.DFXPParserPlugin}(),Class("paella.plugins.CaptionsPlugin",paella.ButtonPlugin,{_searchTimerTime:1500,_searchTimer:null,_pluginButton:null,_open:0,_parent:null,_body:null,_inner:null,_bar:null,_input:null,_select:null,_editor:null,_activeCaptions:null,_lastSel:null,_browserLang:null,_defaultBodyHeight:280,_autoScroll:!0,_searchOnCaptions:null,getAlignment:function(){return"right"},getSubclass:function(){return"captionsPluginButton"},getName:function(){return"es.upv.paella.captionsPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Subtitles")},getIndex:function(){return 509},closeOnMouseOut:function(){return!1},checkEnabled:function(t){t(!0)},showUI:function(){paella.captions.getAvailableLangs().length>=1&&this.parent()},setup:function(){var t=this;paella.captions.getAvailableLangs().length||paella.plugins.captionsPlugin.hideUI(),paella.events.bind(paella.events.captionsEnabled,function(e,n){t.onChangeSelection(n)}),paella.events.bind(paella.events.captionsDisabled,function(e,n){t.onChangeSelection(n)}),paella.events.bind(paella.events.captionAdded,function(e,n){t.onCaptionAdded(n),paella.plugins.captionsPlugin.showUI()}),paella.events.bind(paella.events.timeUpdate,function(e,n){t._searchOnCaptions&&t.updateCaptionHiglighted(n)}),paella.events.bind(paella.events.controlBarWillHide,function(e){t.cancelHideBar()}),t._activeCaptions=paella.captions.getActiveCaptions(),t._searchOnCaptions=t.config.searchOnCaptions||!1},cancelHideBar:function(){this._open>0&&paella.player.controls.cancelHideBar()},updateCaptionHiglighted:function(t){var e=this,n=null;t&&paella.player.videoContainer.trimming().then(function(i){var r=i.enabled?i.start:0,a=paella.captions.getActiveCaptions(),s=a&&a.getCaptionAtTime(t.currentTime+r),o=s&&s.id;null!=o&&(n=$(".bodyInnerContainer[sec-id='"+o+"']"),n!=e._lasSel&&$(e._lasSel).removeClass("Highlight"),n&&($(n).addClass("Highlight"),e._autoScroll&&e.updateScrollFocus(o),e._lasSel=n))})},updateScrollFocus:function(t){var e=this,n=0,i=$(".bodyInnerContainer").slice(0,t);i=i.toArray(),i.forEach(function(t){var e=$(t).outerHeight(!0);n+=e});var r=parseInt(n/280);$(".captionsBody").scrollTop(r*e._defaultBodyHeight)},onCaptionAdded:function(t){var e=this,n=paella.captions.getCaptions(t),i=document.createElement("option");i.text=n._lang.txt,i.value=t,e._select.add(i)},changeSelection:function(){var t=this,e=$(t._select).val();if(""==e)return $(t._body).empty(),void paella.captions.setActiveCaptions(e);paella.captions.setActiveCaptions(e),t._activeCaptions=e,t._searchOnCaptions&&t.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"),t.setButtonHideShow()},onChangeSelection:function(t){var e=this;e._activeCaptions!=t&&($(e._body).empty(),void 0==t?(e._select.value="",$(e._input).prop("disabled",!0)):($(e._input).prop("disabled",!1),e._select.value=t,e._searchOnCaptions&&e.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list")),e._activeCaptions=t,e.setButtonHideShow())},action:function(){var t=this;switch(t._browserLang=base.dictionary.currentLanguage(),t._autoScroll=!0,t._open){case 0:t._browserLang&&void 0==paella.captions.getActiveCaptions()&&t.selectDefaultBrowserLang(t._browserLang),t._open=1,paella.keyManager.enabled=!1;break;case 1:paella.keyManager.enabled=!0,t._open=0}},buildContent:function(t){var e=this;e._parent=document.createElement("div"),e._parent.className="captionsPluginContainer",e._bar=document.createElement("div"),e._bar.className="captionsBar",e._searchOnCaptions&&(e._body=document.createElement("div"),e._body.className="captionsBody",e._parent.appendChild(e._body),$(e._body).scroll(function(){e._autoScroll=!1}),e._input=document.createElement("input"),e._input.className="captionsBarInput",e._input.type="text",e._input.id="captionsBarInput",e._input.name="captionsString",e._input.placeholder=base.dictionary.translate("Search captions"),e._bar.appendChild(e._input),$(e._input).change(function(){var t=$(e._input).val();e.doSearch(t)}),$(e._input).keyup(function(){var t=$(e._input).val();null!=e._searchTimer&&e._searchTimer.cancel(),e._searchTimer=new base.Timer(function(n){e.doSearch(t)},e._searchTimerTime)})),e._select=document.createElement("select"),e._select.className="captionsSelector";var n=document.createElement("option");n.text=base.dictionary.translate("None"),n.value="",e._select.add(n),paella.captions.getAvailableLangs().forEach(function(t){var n=document.createElement("option");n.text=t.lang.txt,n.value=t.id,e._select.add(n)}),e._bar.appendChild(e._select),e._parent.appendChild(e._bar),$(e._select).change(function(){e.changeSelection()}),e._editor=document.createElement("button"),e._editor.className="editorButton",e._editor.innerHTML="",e._bar.appendChild(e._editor),$(e._editor).prop("disabled",!0),$(e._editor).click(function(){var t=paella.captions.getActiveCaptions();paella.userTracking.log("paella:caption:edit",{id:t._captionsProvider+":"+t._id,lang:t._lang}),t.goToEdit()}),t.appendChild(e._parent)},selectDefaultBrowserLang:function(t){var e=null;paella.captions.getAvailableLangs().forEach(function(n){n.lang.code==t&&(e=n.id)}),e&&paella.captions.setActiveCaptions(e)},doSearch:function(t){var e=this,n=paella.captions.getActiveCaptions();n&&(""==t?e.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"):n.search(t,function(t,n){t||e.buildBodyContent(n,"search")}))},setButtonHideShow:function(){var t=this,e=$(".editorButton"),n=paella.captions.getActiveCaptions(),i=null;null!=n?($(t._select).width("39%"),n.canEdit(function(t,e){i=e}),i?($(e).prop("disabled",!1),$(e).show()):($(e).prop("disabled",!0),$(e).hide(),$(t._select).width("47%"))):($(e).prop("disabled",!0),$(e).hide(),$(t._select).width("47%")),t._searchOnCaptions||(i?$(t._select).width("92%"):$(t._select).width("100%"))},buildBodyContent:function(t,e){var n=this;$(n._body).empty(),t.forEach(function(t){paella.player.videoContainer.trimming().then(function(i){i.enabled&&(t.end<i.start||t.begin>i.end)||(n._inner=document.createElement("div"),n._inner.className="bodyInnerContainer",n._inner.innerHTML=t.content,"list"==e&&(n._inner.setAttribute("sec-begin",t.begin),n._inner.setAttribute("sec-end",t.end),n._inner.setAttribute("sec-id",t.id),n._autoScroll=!0),"search"==e&&n._inner.setAttribute("sec-begin",t.time),n._body.appendChild(n._inner),$(n._inner).hover(function(){$(this).css("background-color","rgba(250, 161, 102, 0.5)")},function(){$(this).removeAttr("style")}),$(n._inner).click(function(){var t=$(this).attr("sec-begin");paella.player.videoContainer.trimming().then(function(e){var n=e.enabled?e.start:0;paella.player.videoContainer.seekToTime(parseInt(t-n))})}))})})}}),paella.plugins.captionsPlugin=new paella.plugins.CaptionsPlugin,Class("paella.plugins.CaptionsOnScreen",paella.EventDrivenPlugin,{containerId:"paella_plugin_CaptionsOnScreen",container:null,innerContainer:null,top:null,actualPos:null,lastEvent:null,controlsPlayback:null,captions:!1,captionProvider:null,checkEnabled:function(t){t(!paella.player.isLiveStream())},setup:function(){},getEvents:function(){return[paella.events.controlBarDidHide,paella.events.resize,paella.events.controlBarDidShow,paella.events.captionsEnabled,paella.events.captionsDisabled,paella.events.timeUpdate]},onEvent:function(t,e){var n=this;switch(t){case paella.events.controlBarDidHide:if(n.lastEvent==t||0==n.captions)break;n.moveCaptionsOverlay("down");break;case paella.events.resize:if(0==n.captions)break;paella.player.controls.isHidden()?n.moveCaptionsOverlay("down"):n.moveCaptionsOverlay("top");break;case paella.events.controlBarDidShow:if(n.lastEvent==t||0==n.captions)break;n.moveCaptionsOverlay("top");break;case paella.events.captionsEnabled:n.buildContent(e),n.captions=!0,paella.player.controls.isHidden()?n.moveCaptionsOverlay("down"):n.moveCaptionsOverlay("top");break;case paella.events.captionsDisabled:n.hideContent(),n.captions=!1;break;case paella.events.timeUpdate:n.captions&&n.updateCaptions(e)}n.lastEvent=t},buildContent:function(t){var e=this;e.captionProvider=t,null==e.container?(e.container=document.createElement("div"),e.container.className="CaptionsOnScreen",e.container.id=e.containerId,e.innerContainer=document.createElement("div"),e.innerContainer.className="CaptionsOnScreenInner",e.container.appendChild(e.innerContainer),null==e.controlsPlayback&&(e.controlsPlayback=$("#playerContainer_controls_playback")),paella.player.videoContainer.domElement.appendChild(e.container)):$(e.container).show()},updateCaptions:function(t){var e=this;this.captions&&paella.player.videoContainer.trimming().then(function(n){var i=n.enabled?n.start:0,r=paella.captions.getActiveCaptions(),a=r.getCaptionAtTime(t.currentTime+i);a?($(e.container).show(),e.innerContainer.innerHTML=a.content):e.innerContainer.innerHTML=""})},hideContent:function(){var t=this;$(t.container).hide()},moveCaptionsOverlay:function(t){var e=this;if(null==e.controlsPlayback&&(e.controlsPlayback=$("#playerContainer_controls_playback")),"down"==t){e.controlsPlayback.offset().top;e.innerContainer.style.bottom=50-e.container.offsetHeight+"px"}if("top"==t){var n=e.controlsPlayback.offset().top;n-=e.innerContainer.offsetHeight+10,e.innerContainer.style.bottom=0-n+"px"}},getIndex:function(){return 1050},getName:function(){return"es.upv.paella.overlayCaptionsPlugin"}}),new paella.plugins.CaptionsOnScreen,Class("paella.ChromaVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(t,e,n,i,r,a,s){function o(){if(u.canvasController){var t=u.canvasController.canvas.domElement;u.canvasController.reshape($(t).width(),$(t).height())}}this.parent(t,e,"canvas",n,i,r,a),this._streamName=s||"chroma";var u=this;this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(t,e){return t.res.h-e.res.h}),this.video=null,new paella.Timer(function(t){o()},500).repeat=!0},defaultProfile:function(){return"chroma"},_setVideoElem:function(t){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)},_loadDeps:function(){return new Promise(function(t,e){window.$paella_mpd?defer.resolve(window.$paella_mpd):require(["resources/deps/bg2e.js"],function(){window.$paella_bg2e=!0,t(window.$paella_bg2e)})})},_deferredAction:function(t){var e=this;return new Promise(function(n,i){e.video?n(t()):$(e.video).bind("canplay",function(){e._ready=!0,n(t())})})},_getQualityObject:function(t,e){return{index:t,res:e.res,src:e.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(t){return this.res.w*this.res.h-t.res.w*t.res.h}}},allowZoom:function(){return!1},getVideoData:function(){var t=this,e=this;return new Promise(function(n,i){t._deferredAction(function(){n({duration:e.video.duration,currentTime:e.video.currentTime,volume:e.video.volume,paused:e.video.paused,ended:e.video.ended,res:{w:e.video.videoWidth,h:e.video.videoHeight}})})})},setPosterFrame:function(t){this._posterFrame=t},setAutoplay:function(t){this._autoplay=t,t&&this.video&&this.video.setAttribute("autoplay",t)},load:function(){var t=this;return new Promise(function(e,n){t._loadDeps().then(function(){var i=t._stream.sources[t._streamName];null===t._currentQuality&&t._videoQualityStrategy&&(t._currentQuality=t._videoQualityStrategy.getQualityIndex(i));var r=t._currentQuality<i.length?i[t._currentQuality]:null;t.video=null,r?(t.canvasController=null,buildChromaVideoCanvas(r,t.domElement).then(function(n){t.canvasController=n,t.video=n.video,t.video.pause(),r.crop&&(t.canvasController.crop=new bg.Vector4(r.crop.left,r.crop.top,r.crop.right,r.crop.bottom)),r.displacement&&(t.canvasController.transform=bg.Matrix4.Translation(r.displacement.x,r.displacement.y,0)),r.chromaColor&&(t.canvasController.chroma=new bg.Color(r.chromaColor[0],r.chromaColor[1],r.chromaColor[2],r.chromaColor[3])),r.chromaBias&&(t.canvasController.bias=r.chromaBias),e(r)})):n(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){var t=this;return new Promise(function(e,n){setTimeout(function(){var n=[],i=t._stream.sources[t._streamName],r=-1;i.forEach(function(e){r++,n.push(t._getQualityObject(r,e))}),e(n)},10)})},setQuality:function(t){var e=this;return new Promise(function(n){var i=e.video.paused,r=e._stream.sources[e._streamName];e._currentQuality=t<r.length?t:0;var a=e.video.currentTime;e.freeze().then(function(){return e._ready=!1,e.load()}).then(function(){i||e.play(),$(e.video).on("seeked",function(){e.unFreeze(),n(),$(e.video).off("seeked")}),e.video.currentTime=a})})},getCurrentQuality:function(){var t=this;return new Promise(function(e){e(t._getQualityObject(t._currentQuality,t._stream.sources[t._streamName][t._currentQuality]))})},play:function(){var t=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,t.video.play()})},pause:function(){var t=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,t.video.pause()})},isPaused:function(){var t=this;return this._deferredAction(function(){return t.video.paused})},duration:function(){var t=this;return this._deferredAction(function(){return t.video.duration})},setCurrentTime:function(t){var e=this;return this._deferredAction(function(){e.video.currentTime=t,$(e.video).on("seeked",function(){e.canvasController.postRedisplay(),$(e.video).off("seeked")})})},currentTime:function(){var t=this;return this._deferredAction(function(){return t.video.currentTime})},setVolume:function(t){var e=this;return this._deferredAction(function(){e.video.volume=t})},volume:function(){var t=this;return this._deferredAction(function(){return t.video.volume})},setPlaybackRate:function(t){var e=this;return this._deferredAction(function(){e.video.playbackRate=t})},playbackRate:function(){var t=this;return this._deferredAction(function(){return t.video.playbackRate})},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){var t=this;return this._deferredAction(function(){var e=document.getElementById(t.video.className+"canvas");$(e).remove()})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.ChromaVideoFactory",{isStreamCompatible:function(t){try{if(paella.ChromaVideo._loaded)return!1;if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var e in t.sources)if("chroma"==e)return!0}catch(t){}return!1},getVideoObject:function(t,e,n){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,new paella.ChromaVideo(t,e,n.x,n.y,n.w,n.h)}});var bg={};bg.utils={},Reflect.defineProperty=Reflect.defineProperty||Object.defineProperty,function(t){t.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}(),bg.utils.initWebGLContext=function(t){var e={gl:null,supported:!1,experimental:!1};try{e.gl=t.getContext("webgl",{preserveDrawingBuffer:!0}),e.supported=null!=e.gl}catch(t){e.supported=!1}if(!e.supported)try{e.gl=t.getContext("experimental-webgl",{preserveDrawingBuffer:!0}),e.supported=null!=e.gl,e.experimental=!0}catch(t){}return e&&(e.gl.uuid=Symbol(e.gl)),e},bg.utils.isBigEndian=function(){var t=new Uint32Array(1);new Uint8Array(t.buffer);return t[0]=255,255==t[3]},bg.utils.isLittleEndian=function(){var t=new Uint32Array(1);new Uint8Array(t.buffer);return t[0]=255,255==t[0]};var e=function(){function t(t){this.system={},this.browser={},t||(t=navigator.userAgent),this.parseOperatingSystem(t),this.parseBrowser(t)}return $traceurRuntime.createClass(t,{parseOperatingSystem:function(t){this.system.OSX=/Macintosh/.test(t),this.system.Windows=/Windows/.test(t),this.system.iPhone=/iPhone/.test(t),this.system.iPodTouch=/iPod/.test(t),this.system.iPad=/iPad/.test(t),this.system.iOS=this.system.iPhone||this.system.iPad||this.system.iPodTouch,this.system.Android=/Android/.test(t),this.system.Linux=!this.system.Android&&/Linux/.test(t),this.system.OSX?(this.system.OSName="OS X",this.parseOSXVersion(t)):this.system.Windows?(this.system.OSName="Windows",this.parseWindowsVersion(t)):this.system.Linux?(this.system.OSName="Linux",this.parseLinuxVersion(t)):this.system.iOS?(this.system.OSName="iOS",this.parseIOSVersion(t)):this.system.Android&&(this.system.OSName="Android",this.parseAndroidVersion(t))},parseBrowser:function(t){if(this.browser.Version={},this.browser.Safari=/Version\/([\d\.]+) Safari\//.test(t),this.browser.Safari&&(this.browser.Name="Safari",this.browser.Vendor="Apple",this.browser.Version.versionString=RegExp.$1),this.browser.Chrome=/Chrome\/([\d\.]+) Safari\//.test(t),this.browser.Chrome&&(this.browser.Name="Chrome",this.browser.Vendor="Google",this.browser.Version.versionString=RegExp.$1),this.browser.Opera=/Opera\/[\d\.]+/.test(t),this.browser.Opera){this.browser.Name="Opera",this.browser.Vendor="Opera Software";/Version\/([\d\.]+)/.test(t);this.browser.Version.versionString=RegExp.$1}if(this.browser.Firefox=/Gecko\/[\d\.]+ Firefox\/([\d\.]+)/.test(t),this.browser.Firefox&&(this.browser.Name="Firefox",this.browser.Vendor="Mozilla Foundation",this.browser.Version.versionString=RegExp.$1),this.browser.Edge=/Edge\/(.*)/.test(t),this.browser.Edge){var e=/Edge\/(.*)/.exec(t);this.browser.Name="Edge",this.browser.Chrome=!1,this.browser.Vendor="Microsoft",this.browser.Version.versionString=e[1]}if(this.browser.Explorer=/MSIE ([\d\.]+)/.test(t),this.browser.Explorer)this.browser.Name="Internet Explorer",this.browser.Vendor="Microsoft",this.browser.Version.versionString=RegExp.$1;else{var n=/\Mozilla\/5.0 \(([^)]+)\) like Gecko/,i=n.exec(t);if(i){n=/rv:(.*)/;var r=n.exec(i[1]);this.browser.Explorer=!0,this.browser.Name="Internet Explorer",this.browser.Vendor="Microsoft",this.browser.Version.versionString=r?r[1]:"unknown"}}this.system.iOS?(this.browser.IsMobileVersion=!0,this.browser.MobileSafari=/Version\/([\d\.]+) Mobile/.test(t),this.browser.MobileSafari&&(this.browser.Name="Mobile Safari",this.browser.Vendor="Apple",this.browser.Version.versionString=RegExp.$1),this.browser.Android=!1):this.system.Android?(this.browser.IsMobileVersion=!0,this.browser.Android=/Version\/([\d\.]+) Mobile/.test(t),this.browser.MobileSafari?(this.browser.Name="Android Browser",this.browser.Vendor="Google",this.browser.Version.versionString=RegExp.$1):(this.browser.Chrome=/Chrome\/([\d\.]+)/.test(t),this.browser.Name="Chrome",this.browser.Vendor="Google",this.browser.Version.versionString=RegExp.$1),this.browser.Safari=!1):this.browser.IsMobileVersion=!1,this.parseBrowserVersion(t)},parseBrowserVersion:function(t){/([\d]+)\.([\d]+)\.*([\d]*)/.test(this.browser.Version.versionString)&&(this.browser.Version.major=Number(RegExp.$1),this.browser.Version.minor=Number(RegExp.$2),this.browser.Version.revision=RegExp.$3?Number(RegExp.$3):0)},parseOSXVersion:function(t){var e=/Mac OS X (\d+_\d+_*\d*)/.test(t)?RegExp.$1:"";switch(this.system.Version={},""!=e?/(\d+)_(\d+)_*(\d*)/.test(e)&&(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0):(e=/Mac OS X (\d+\.\d+\.*\d*)/.test(t)?RegExp.$1:"Unknown",/(\d+)\.(\d+)\.*(\d*)/.test(e)&&(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0)),this.system.Version.major||(this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.revision=0),this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision,this.system.Version.minor){case 0:this.system.Version.name="Cheetah";break;case 1:this.system.Version.name="Puma";break;case 2:this.system.Version.name="Jaguar";break;case 3:this.system.Version.name="Panther";break;case 4:this.system.Version.name="Tiger";break;case 5:this.system.Version.name="Leopard";break;case 6:this.system.Version.name="Snow Leopard";break;case 7:this.system.Version.name="Lion";break;case 8:this.system.Version.name="Mountain Lion"}},parseWindowsVersion:function(t){if(this.system.Version={},/NT (\d+)\.(\d*)/.test(t)){this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=0,this.system.Version.stringValue="NT "+this.system.Version.major+"."+this.system.Version.minor;var e=this.system.Version.major,n=this.system.Version.minor;5==e?this.system.Version.name=0==n?"2000":"XP":6==e&&(0==n?this.system.Version.name="Vista":1==n?this.system.Version.name="7":2==n&&(this.system.Version.name="8"))}else this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.name="Unknown",this.system.Version.stringValue="Unknown"},parseLinuxVersion:function(t){this.system.Version={},this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.revision=0,this.system.Version.name="",this.system.Version.stringValue="Unknown distribution"},parseIOSVersion:function(t){this.system.Version={},/iPhone OS (\d+)_(\d+)_*(\d*)/i.test(t)?(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0,this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision,this.system.Version.name="iOS"):(this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.name="Unknown",this.system.Version.stringValue="Unknown")},parseAndroidVersion:function(t){this.system.Version={},/Android (\d+)\.(\d+)\.*(\d*)/.test(t)?(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0,this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision):(this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.revision=0),/Build\/([a-zA-Z]+)/.test(t)?this.system.Version.name=RegExp.$1:this.system.Version.name="Unknown version",this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision},getInfoString:function(){return navigator.userAgent}},{})}();bg.utils.UserAgent=e,bg.utils.userAgent=new e}(window),function(){function t(t,e,n){var i=new XMLHttpRequest;return i.open("GET",t,!0),i.addEventListener("load",function(){200===i.status?e(i):n(new Error("Error receiving data: "+i.status+", url: "+t))},!1),i.addEventListener("error",function(){n(new Error("Cannot make AJAX request. Url: "+t))},!1),i}var e=[],n=[],i=function(){function i(){}return $traceurRuntime.createClass(i,{},{GetExtension:function(t){var e=/\.([a-z0-9-_]*)$/i.exec(t);return e&&e[1].toLowerCase()||""},IsFormat:function(t,e){return null!=e.find(function(t){return t==this},i.GetExtension(t))},IsImage:function(t){return i.IsFormat(t,["jpg","jpeg","gif","png"])},IsBinary:function(t){var e=void 0!==arguments[1]?arguments[1]:["vwglb"];return i.IsFormat(t,e)},IsVideo:function(t){var e=void 0!==arguments[1]?arguments[1]:["mp4","m4v","ogg","ogv","m3u8","webm"];return i.IsFormat(t,e)},LoadMultiple:function(t){var e=[];return t.forEach(function(t){e.push(i.Load(t))}),Promise.all(e).then(function(e){var n={};return t.forEach(function(t,i){n[t]=e[i]}),n})},Load:function(t){var e=null;switch(!0){case t.constructor===Array:e=i.LoadMultiple;break;case i.IsImage(t):e=i.LoadImage;break;case i.IsBinary(t):e=i.LoadBinary;break;case i.IsVideo(t):e=i.LoadVideo;break;case"json"==i.GetExtension(t):e=i.LoadJson;break;default:e=i.LoadText}return e(t)},LoadText:function(e){return new Promise(function(n,i){t(e,function(t){n(t.responseText)},function(t){i(t)}).send()})},LoadVideo:function(t){return new Promise(function(e,i){var r=document.createElement("video");n.push(r),r.crossOrigin="",r.autoplay=!0,r.setAttribute("playsinline",null),r.addEventListener("canplay",function(t){var i=n.indexOf(t.target);-1!=i&&n.splice(i,1),e(event.target),bg.emitImageLoadEvent(event.target)}),r.addEventListener("error",function(e){i(new Error("Error loading video: "+t))}),r.addEventListener("abort",function(e){i(new Error("Error loading video: "+t))}),r.src=t})},LoadBinary:function(e){return new Promise(function(n,i){var r=t(e,function(t){n(t.response)},function(t){i(t)});r.responseType="arraybuffer",r.send()})},LoadImage:function(t){return new Promise(function(n,i){var r=new Image;e.push(r),r.crossOrigin="",r.addEventListener("load",function(t){var i=e.indexOf(t.target);-1!=i&&e.splice(i,1),n(t.target),bg.emitImageLoadEvent(t.target)}),r.addEventListener("error",function(e){i(new Error("Error loading image: "+t))}),r.addEventListener("abort",function(e){i(new Error("Image load aborted: "+t))}),r.src=t})},LoadJson:function(e){return new Promise(function(n,i){t(e,function(t){try{n(JSON.parse(t.responseText))}catch(t){i(new Error("Error parsing JSON data"))}},function(t){i(t)}).send()})}})}();bg.utils.Resource=i}(),function(){var t=null,e=function(){function e(){}return $traceurRuntime.createClass(e,{get id(){return this._engineId},get texture(){return this._texture},get pipeline(){return this._pipeline},get polyList(){return this._polyList},get shader(){return this._shader},get colorBuffer(){return this._colorBuffer},get textureBuffer(){return this._textureBuffer},get shaderSource(){return this._shaderSource}},{Set:function(e){t=e},Get:function(){return t}})}();bg.Engine=e}(),function(){var t=function(){function t(){}return $traceurRuntime.createClass(t,{init:function(){},frame:function(t){},willDisplay:function(t,e){},display:function(t,e){},didDisplay:function(t,e){},reshape:function(t,e,n,i){},keyDown:function(t){},keyUp:function(t){},mouseUp:function(t){},mouseDown:function(t){},mouseMove:function(t){},mouseOut:function(t){},mouseDrag:function(t){},mouseWheel:function(t){},touchStart:function(t){},touchMove:function(t){},touchEnd:function(t){}},{})}();bg.LifeCycle=t}(),bg.app={},function(){var t=function(){function t(t){var e=this;if(this._domElem=t,this._domElem.style.MozUserSelect="none",this._domElem.style.WebkitUserSelect="none",this._domElem.setAttribute("onselectstart","return false"),!function(){return e._context=bg.utils.initWebGLContext(t),e._context.supported}())throw new Error("Sorry, your browser does not support WebGL.")}return $traceurRuntime.createClass(t,{get context(){return this._context},get domElement(){return this._domElem},get width(){return this._domElem.clientWidth},get height(){return this._domElem.clientHeight},screenshot:function(t,e,n){var i="",r={};e&&(n=n||e,i=this.domElement.style.cssText,r.width=this.domElement.width,r.height=this.domElement.height,this.domElement.style.cssText="top:auto;left:auto;bottom:auto;right:auto;width:"+e+"px;height:"+n+"px;",this.domElement.width=e,this.domElement.height=n,bg.app.MainLoop.singleton.windowController.reshape(e,n),bg.app.MainLoop.singleton.windowController.postRedisplay(),bg.app.MainLoop.singleton.windowController.display());var a=this.domElement.toDataURL(t);return e&&(this.domElement.style.cssText=i,this.domElement.width=r.width,this.domElement.height=r.height,bg.app.MainLoop.singleton.windowController.reshape(r.width,r.height),bg.app.MainLoop.singleton.windowController.postRedisplay(),bg.app.MainLoop.singleton.windowController.display()),a}},{})}();bg.app.Canvas=t;var e=function(){function t(t){this._context=t}return $traceurRuntime.createClass(t,{get context(){return this._context},set context(t){this._context=t}},{})}();bg.app.ContextObject=e}(),function(){bg.app.SpecialKey={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,PAGE_UP:33,PAGEDOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46};var t=function(){function t(t){this.key=t}return $traceurRuntime.createClass(t,{isSpecialKey:function(){return t.IsSpecialKey(this.key)}},{IsSpecialKey:function(t){Object.keys(bg.app.SpecialKey).some(function(e){return bg.app.SpecialKey[e]==t})}})}();bg.app.KeyboardEvent=t,bg.app.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2,NONE:-1};var e=function(){function t(){var t=void 0!==arguments[0]?arguments[0]:bg.app.MouseButton.NONE,e=void 0!==arguments[1]?arguments[1]:-1,n=void 0!==arguments[2]?arguments[2]:-1,i=void 0!==arguments[3]?arguments[3]:0;this.button=t,this.x=e,this.y=n,this.delta=i}return $traceurRuntime.createClass(t,{},{})}();bg.app.MouseEvent=e;var n=function(){function t(t){this.touches=t}return $traceurRuntime.createClass(t,{},{})}();bg.app.TouchEvent=n}(),function(){function t(){requestAnimFrame(t),i()}function e(){if(n(),window.addEventListener("resize",function(t){n()}),!p.canvas)throw new Error("Configuration error in MainLoop: no canvas defined");var t=p.canvas.domElement;t.addEventListener("mousedown",function(t){return r(t),t.preventDefault(),!1}),t.addEventListener("mousemove",function(t){return a(t),t.preventDefault(),!1}),t.addEventListener("mouseout",function(t){return s(),t.preventDefault(),!1}),t.addEventListener("mouseover",function(t){return o(t),t.preventDefault(),!1}),t.addEventListener("mouseup",function(t){return u(t),t.preventDefault(),!1}),t.addEventListener("touchstart",function(t){return h(t),t.preventDefault(),!1}),t.addEventListener("touchmove",function(t){return f(t),t.preventDefault(),!1}),t.addEventListener("touchend",function(t){return d(t),t.preventDefault(),!1});var e=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";t.addEventListener(e,function(t){return l(t),t.preventDefault(),!1}),window.addEventListener("keydown",function(t){g(t)}),window.addEventListener("keyup",function(t){m(t)}),t.oncontextmenu=function(t){return!1}}function n(){p.canvas&&p.windowController&&(p.canvas.domElement.width=p.canvas.width,p.canvas.domElement.height=p.canvas.height,p.windowController.reshape(p.canvas.width,p.canvas.height))}function i(){p.redisplay&&(-1==_&&(_=Date.now()),p.windowController.frame(Date.now()-_),p.windowController.display(),_=Date.now(),p._redisplay=p.updateMode==bg.app.FrameUpdate.AUTO)}function r(t){var e=p.canvas.domElement.getBoundingClientRect();switch(b.pos.x=t.clientX-e.left,b.pos.y=t.clientY-e.top,t.button){case bg.app.MouseButton.LEFT:b.leftButton=!0;break;case bg.app.MouseButton.MIDDLE:b.middleButton=!0;break;case bg.app.MouseButton.RIGHT:b.rightButton=!0}p.windowController.mouseDown(new bg.app.MouseEvent(t.button,b.pos.x,b.pos.y))}function a(t){var e=p.canvas.domElement.getBoundingClientRect();b.pos.x=t.clientX-e.left,
b.pos.y=t.clientY-e.top;var n=new bg.app.MouseEvent(bg.app.MouseButton.NONE,b.pos.x,b.pos.y);p.windowController.mouseMove(n),b.anyButton&&p.windowController.mouseDrag(n)}function s(){p.windowController.mouseOut(new bg.app.MouseEvent(bg.app.MouseButton.NONE,b.pos.x,b.pos.y)),b.leftButton&&(b.leftButton=!1,p.windowController.mouseUp(new bg.app.MouseEvent(bg.app.MouseButton.LEFT,b.pos.x,b.pos.y))),b.middleButton&&(b.middleButton=!1,p.windowController.mouseUp(new bg.app.MouseEvent(bg.app.MouseButton.MIDDLE,b.pos.x,b.pos.y))),b.rightButton&&(p.windowController.mouseUp(new bg.app.MouseEvent(bg.app.MouseButton.RIGHT,b.pos.x,b.pos.y)),b.rightButton=!1)}function o(t){a(t)}function u(t){switch(t.button){case bg.app.MouseButton.LEFT:b.leftButton=!1;break;case bg.app.MouseButton.MIDDLE:b.middleButton=!1;break;case bg.app.MouseButton.RIGHT:b.rightButton=!1}var e=p.canvas.domElement.getBoundingClientRect();b.pos.x=t.clientX-e.left,b.pos.y=t.clientY-e.top,p.windowController.mouseUp(new bg.app.MouseEvent(t.button,b.pos.x,b.pos.y))}function l(t){var e=p.canvas.domElement.getBoundingClientRect();b.pos.x=t.clientX-e.left,b.pos.y=t.clientY-e.top;var n=t.wheelDelta?-1*t.wheelDelta:10*t.detail;p.windowController.mouseWheel(new bg.app.MouseEvent(bg.app.MouseButton.NONE,b.pos.x,b.pos.y,n))}function c(t){for(var e=p.canvas.domElement.getBoundingClientRect(),n=[],i=0;i<t.touches.length;++i){var r=t.touches[i];n.push({identifier:r.identifier,x:r.clientX-e.left,y:r.clientY-e.top,force:r.force,rotationAngle:r.rotationAngle,radiusX:r.radiusX,radiusY:r.radiusY})}return new bg.app.TouchEvent(n)}function h(t){p.windowController.touchStart(c(t))}function f(t){p.windowController.touchMove(c(t))}function d(t){p.windowController.touchEnd(c(t))}function g(t){var e=bg.app.KeyboardEvent.IsSpecialKey(t.keyCode)?t.keyCode:String.fromCharCode(t.keyCode);p.windowController.keyDown(new bg.app.KeyboardEvent(e))}function m(t){var e=bg.app.KeyboardEvent.IsSpecialKey(t.keyCode)?t.keyCode:String.fromCharCode(t.keyCode);p.windowController.keyUp(new bg.app.KeyboardEvent(e))}var p=null,b={leftButton:!1,middleButton:!1,rightButton:!1,pos:{x:-1,y:-1}};Object.defineProperty(b,"anyButton",{get:function(){return this.leftButton||this.middleButton||this.rightButton}});var _=-1,v=function(){function t(){}return $traceurRuntime.createClass(t,{},{LeftButton:function(){return b.leftButton},MiddleButton:function(){return b.middleButton},RightButton:function(){return b.rightButton},Position:function(){return b.pos}})}();bg.app.Mouse=v,bg.app.FrameUpdate={AUTO:0,MANUAL:1};var y=function(){function i(){this._canvas=null,this._windowController=null,this._updateMode=bg.app.FrameUpdate.AUTO,this._redisplay=!0}return $traceurRuntime.createClass(i,{get canvas(){return this._canvas},set canvas(t){this._canvas=new bg.app.Canvas(t)},get windowController(){return this._windowController},get updateMode(){return this._updateMode},set updateMode(t){this._updateMode=t,this._updateMode==bg.app.FrameUpdate.AUTO&&(this._redisplay=!0)},get redisplay(){return this._redisplay},get mouseButtonStatus(){return b},run:function(n){this._windowController=n,this.postRedisplay(),this.windowController.init(),e(),t()},postRedisplay:function(){this._redisplay=!0},postReshape:function(){n()}},{})}();bg.app.MainLoop={},Object.defineProperty(bg.app.MainLoop,"singleton",{get:function(){return p||(p=new y),p}})}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{postRedisplay:function(){bg.app.MainLoop.singleton.postRedisplay()},postReshape:function(){bg.app.MainLoop.singleton.postReshape()},get canvas(){return bg.app.MainLoop.singleton.canvas},get context(){return bg.app.MainLoop.singleton.canvas.context},get gl(){return bg.app.MainLoop.singleton.canvas.context.gl}},{},t)}(bg.LifeCycle);bg.app.WindowController=t}(),bg.base={},bg.s_log=[],bg.log=function(t){console.log&&console.log(t),bg.s_log.push(t)},bg.flushLog=function(){console.log&&bg.s_log.forEach(function(t){console.log(t)}),bg.s_log=[]},bg.emitImageLoadEvent=function(t){var e=new CustomEvent("bg2e:image-load",{image:t});document.dispatchEvent(e)},bg.bindImageLoadEvent=function(t){document.addEventListener("bg2e:image-load",t)},bg.Axis={NONE:0,X:1,Y:2,Z:3},function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._shader=null,this._inputVars=[]}return $traceurRuntime.createClass(e,{get inputVars(){return this._inputVars},get shader(){return this._shader},setupShaderSource:function(t){var e=this;this._shader=new bg.base.Shader(this.context),this._inputVars=[];var n=[],i=[];t.forEach(function(t){t.params.forEach(function(t){t&&("buffer"==t.role?(e._inputVars[t.target]=t.name,n.push(t.name)):"value"==t.role&&i.push(t.name))}),e._shader.addShaderSource(t.type,t.toString())}),this._shader.link(),this._shader.status?this._shader.initVars(n,i):(bg.log(this._shader.compileError),this._shader.compileErrorSource&&(bg.log("Shader source:"),bg.log(this._shader.compileErrorSource)),bg.log(this._shader.linkError))},beginDraw:function(){},setupVars:function(){},setActive:function(){this.shader.setActive(),this.beginDraw()},clearActive:function(){this.shader.clearActive()},bindPolyList:function(t){var e=this.shader;this.inputVars.vertex&&e.setInputBuffer(this.inputVars.vertex,t.vertexBuffer,3),this.inputVars.normal&&e.setInputBuffer(this.inputVars.normal,t.normalBuffer,3),this.inputVars.tex0&&e.setInputBuffer(this.inputVars.tex0,t.texCoord0Buffer,2),this.inputVars.tex1&&e.setInputBuffer(this.inputVars.tex1,t.texCoord1Buffer,2),this.inputVars.tex2&&e.setInputBuffer(this.inputVars.tex2,t.texCoord2Buffer,2),this.inputVars.color&&e.setInputBuffer(this.inputVars.color,t.colorBuffer,4),this.inputVars.tangent&&e.setInputBuffer(this.inputVars.tangent,t.tangentBuffer,3),this.setupVars()},unbind:function(){var t=this.shader;this.inputVars.vertex&&t.disableInputBuffer(this.inputVars.vertex),this.inputVars.normal&&t.disableInputBuffer(this.inputVars.normal),this.inputVars.tex0&&t.disableInputBuffer(this.inputVars.tex0),this.inputVars.tex1&&t.disableInputBuffer(this.inputVars.tex1),this.inputVars.tex2&&t.disableInputBuffer(this.inputVars.tex2),this.inputVars.color&&t.disableInputBuffer(this.inputVars.color),this.inputVars.tangent&&t.disableInputBuffer(this.inputVars.tangent)}},{},t)}(bg.app.ContextObject);bg.base.Effect=e;var n=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._frame=new bg.base.PolyList(t),this._frame.vertex=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],this._frame.texCoord0=[1,1,0,1,0,0,1,0],this._frame.index=[0,1,2,2,3,0],this._frame.build(),this.rebuildShaders()}return $traceurRuntime.createClass(n,{rebuildShaders:function(){this.setupShaderSource([this.vertexShaderSource,this.fragmentShaderSource])},get vertexShaderSource(){return this._vertexShaderSource||(this._vertexShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),this._vertexShaderSource.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,{name:"fsTexCoord",dataType:"vec2",role:"out"}]),"webgl1"==bg.Engine.Get().id&&this._vertexShaderSource.setMainBody("\n\t\t\t\t\tgl_Position = vec4(inVertex,1.0);\n\t\t\t\t\tfsTexCoord = inTex0;")),this._vertexShaderSource},get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter({name:"fsTexCoord",dataType:"vec2",role:"in"}),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tgl_FragColor = vec4(1.0,0.0,0.0,1.0);")),this._fragmentShaderSource},drawSurface:function(t){this.setActive(),this._surface=t,this.bindPolyList(this._frame),this._frame.draw(),this.unbind(),this.clearActive()}},{},e)}(e);bg.base.TextureEffect=n}(),function(){var t=function(){function t(){}return $traceurRuntime.createClass(t,{acceptType:function(t,e){return!1},load:function(t,e,n){return new Promise(function(t,e){e(new Error("Not implemented"))})}},{})}();bg.base.LoaderPlugin=t;var e=[],n=function(){function t(){}return $traceurRuntime.createClass(t,{},{RegisterPlugin:function(t){e.push(t)},Load:function(e,n){return new Promise(function(i,r){bg.utils.Resource.Load(n).then(function(i){return t.LoadData(e,n,i)}).then(function(t){i(t)}).catch(function(t){r(t)})})},LoadData:function(t,n,i){return new Promise(function(r,a){var s=null;if(e.some(function(t){if(t.acceptType(n,i))return s=t,!0}),!s)return a(new Error("No suitable plugin found for load "+n));r(s.load(t,n,i))})}})}();bg.base.Loader=n}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e);var i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT);i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,{name:"fsTexCoord",dataType:"vec2",role:"out"}]),r.addParameter([t().inputs.material.texture,{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&(i.setMainBody("\n\t\t\t\tgl_Position = vec4(inVertex,1.0);\n\t\t\t\tfsTexCoord = inTex0;"),r.setMainBody("gl_FragColor = texture2D(inTexture,fsTexCoord);")),this.setupShaderSource([i,r])}return $traceurRuntime.createClass(n,{setupVars:function(){var t=null;this._surface instanceof bg.base.Texture?t=this._surface:this._surface instanceof bg.base.RenderSurface&&(t=this._surface.getTexture(0)),t&&this.shader.setTexture("inTexture",t,bg.base.TextureUnit.TEXTURE_0)}},{},e)}(bg.base.TextureEffect);bg.base.DrawTextureEffect=e}(),function(){function t(){return bg.base.ShaderLibrary.Get()}function e(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.normal,t().inputs.buffers.tangent,t().inputs.buffers.tex0,t().inputs.buffers.tex1]),i.addParameter(t().inputs.matrix.all),i.addParameter([{name:"inLightProjectionMatrix",dataType:"mat4",role:"value"},{name:"inLightViewMatrix",dataType:"mat4",role:"value"}]),i.addParameter([{name:"fsPosition",dataType:"vec3",role:"out"},{name:"fsTex0Coord",dataType:"vec2",role:"out"},{name:"fsTex1Coord",dataType:"vec2",role:"out"},{name:"fsNormal",dataType:"vec3",role:"out"},{name:"fsTangent",dataType:"vec3",role:"out"},{name:"fsBitangent",dataType:"vec3",role:"out"},{name:"fsSurfaceToView",dataType:"vec3",role:"out"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"out"}]),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\t\tmat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.5, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.0, 0.5, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.5, 0.5, 0.5, 1.0);\n\t\t\t\t\t\n\t\t\t\t\tvec4 viewPos = inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tgl_Position = inProjectionMatrix * viewPos;\n\t\t\t\t\t\n\t\t\t\t\tfsNormal = normalize((inNormalMatrix * vec4(inNormal,1.0)).xyz);\n\t\t\t\t\tfsTangent = normalize((inNormalMatrix * vec4(inTangent,1.0)).xyz);\n\t\t\t\t\tfsBitangent = cross(fsNormal,fsTangent);\n\t\t\t\t\t\n\t\t\t\t\tfsVertexPosFromLight = ScaleMatrix * inLightProjectionMatrix * inLightViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\t\n\t\t\t\t\tfsTex0Coord = inTex0;\n\t\t\t\t\tfsTex1Coord = inTex1;\n\t\t\t\t\tfsPosition = viewPos.xyz;")),i}function n(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),r.addParameter(t().inputs.material.all),r.addParameter(t().inputs.lighting.all),r.addParameter(t().inputs.shadows.all),r.addParameter(t().inputs.colorCorrection.all),r.addParameter([{name:"fsPosition",dataType:"vec3",role:"in"},{name:"fsTex0Coord",dataType:"vec2",role:"in"},{name:"fsTex1Coord",dataType:"vec2",role:"in"},{name:"fsNormal",dataType:"vec3",role:"in"},{name:"fsTangent",dataType:"vec3",role:"in"},{name:"fsBitangent",dataType:"vec3",role:"in"},{name:"fsSurfaceToView",dataType:"vec3",role:"in"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"in"}]),r.addFunction(t().functions.materials.all),r.addFunction(t().functions.colorCorrection.all),r.addFunction(t().functions.utils.unpack),r.addFunction(t().functions.utils.random),r.addFunction(t().functions.lighting.all),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\tvec4 diffuseColor = samplerColor(inTexture,fsTex0Coord,inTextureOffset,inTextureScale);\n\t\t\t\t\tif (diffuseColor.a>=inAlphaCutoff) {\t\n\t\t\t\t\t\tvec4 lightmapColor = samplerColor(inLightMap,fsTex1Coord,inLightMapOffset,inLightMapScale);\n\t\t\t\t\t\tvec3 normalMap = samplerNormal(inNormalMap,fsTex0Coord,inNormalMapOffset,inNormalMapScale);\n\t\t\t\t\t\tnormalMap = combineNormalWithMap(fsNormal,fsTangent,fsBitangent,normalMap);\n\t\t\t\t\t\tvec4 shadowColor = vec4(1.0);\n\t\t\t\t\t\tif (inReceiveShadows) {\n\t\t\t\t\t\t\tshadowColor = getShadowColor(fsVertexPosFromLight,inShadowMap,inShadowMapSize,inShadowType,inShadowStrength,inShadowBias,inShadowColor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvec4 specular = specularColor(inSpecularColor,inShininessMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinShininessMaskChannel,inShininessMaskInvert);\n\t\t\t\t\t\tfloat lightEmission = applyTextureMask(inLightEmission,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMaskChannel,inLightEmissionMaskInvert);\n\t\t\t\t\t\tdiffuseColor = diffuseColor * inDiffuseColor * lightmapColor;\n\t\t\t\t\t\tvec4 light = getDirectionalLight(inLightAmbient,inLightDiffuse,inLightSpecular,inShininess,\n\t\t\t\t\t\t\t\t\t\t\t\t-inLightDirection,fsPosition,normalMap,\n\t\t\t\t\t\t\t\t\t\t\t\tdiffuseColor,specular,shadowColor);\n\t\t\t\t\t\t\n\t\t\t\t\t\tlight.rgb = clamp(light.rgb + (lightEmission * diffuseColor.rgb), vec3(0.0), vec3(1.0));\n\t\t\t\t\t\t// TODO: Select mode\n\t\t\t\t\t\tgl_FragColor = colorCorrection(light,inHue,inSaturation,inLightness,inBrightness,inContrast);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}")),r}var i=null,r=null,a=function(){function t(){this._hue=1,this._saturation=1,this._lightness=1,this._brightness=.5,this._contrast=.5}return $traceurRuntime.createClass(t,{set hue(t){this._hue=t},get hue(){return this._hue},set saturation(t){this._saturation=t},get saturation(){return this._saturation},set lightness(t){this._lightness=t},get lightness(){return this._lightness},set brightness(t){this._brightness=t},get brightness(){return this._brightness},set contrast(t){this._contrast=t},get contrast(){return this._contrast},apply:function(t){var e=void 0!==arguments[1]?arguments[1]:{hue:"inHue",saturation:"inSaturation",lightness:"inLightness",brightness:"inBrightness",contrast:"inContrast"};t.setValueFloat(e.hue,this._hue),t.setValueFloat(e.saturation,this._saturation),t.setValueFloat(e.lightness,this._lightness),t.setValueFloat(e.brightness,this._brightness),t.setValueFloat(e.contrast,this._contrast)}},{})}();bg.base.ColorCorrectionSettings=a;var s=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._material=null,this._light=null,this._lightTransform=bg.Matrix4.Identity(),this._shadowMap=null;var r=[e(),n()];this.setupShaderSource(r),this._colorCorrection=new bg.base.ColorCorrectionSettings}return $traceurRuntime.createClass(i,{get material(){return this._material},set material(t){this._material=t},get light(){return this._light},set light(t){this._light=t},get lightTransform(){return this._lightTransform},set lightTransform(t){this._lightTransform=t},set shadowMap(t){this._shadowMap=t},get shadowMap(){return this._shadowMap},get colorCorrection(){return this._colorCorrection},set colorCorrection(t){this._colorCorrection=t},beginDraw:function(){if(this._light){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst),n=this.shadowMap?this.shadowMap.viewMatrix:new bg.Matrix4(this._lightTransform);this.shader.setMatrix4("inLightProjectionMatrix",this.shadowMap?this.shadowMap.projection:this._light.projection);var i=this.shadowMap?this.shadowMap.shadowColor:bg.Color.Transparent();this.shader.setMatrix4("inLightViewMatrix",n),this.shader.setValueInt("inShadowType",this._shadowMap.shadowType),this.shader.setTexture("inShadowMap",this._shadowMap.texture,bg.base.TextureUnit.TEXTURE_5),this.shader.setVector2("inShadowMapSize",this._shadowMap.size),this.shader.setValueFloat("inShadowStrength",this._light.shadowStrength),this.shader.setVector4("inShadowColor",i),this.shader.setValueFloat("inShadowBias",this._light.shadowBias),this.shader.setValueInt("inCastShadows",this._light.castShadows),this.shader.setVector4("inLightAmbient",this._light.ambient),this.shader.setVector4("inLightDiffuse",this._light.diffuse),this.shader.setVector4("inLightSpecular",this._light.specular);var r=e.mult(this._lightTransform).rotation.multVector(this._light.direction).xyz;this.shader.setVector3("inLightDirection",r)}else{var a=bg.Color.Black();this.shader.setVector4("inLightAmbient",a),this.shader.setVector4("inLightDiffuse",a),this.shader.setVector4("inLightSpecular",a),this.shader.setVector3("inLightDirection",new bg.Vector3(0,0,0))}this.colorCorrection.apply(this.shader)},setupVars:function(){if(this.material){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst),this.shader.setMatrix4("inNormalMatrix",t.normalMatrix),this.shader.setMatrix4("inViewMatrixInv",t.viewMatrixInvert);var n=bg.base.TextureCache.WhiteTexture(this.context),i=bg.base.TextureCache.BlackTexture(this.context),r=bg.base.TextureCache.NormalTexture(this.context),a=this.material.texture||n,s=this.material.lightmap||n,o=this.material.normalMap||r,u=this.material.shininessMask||i,l=this.material.lightEmissionMask||n;this.shader.setVector4("inDiffuseColor",this.material.diffuse),this.shader.setVector4("inSpecularColor",this.material.specular),this.shader.setValueFloat("inShininess",this.material.shininess),this.shader.setTexture("inShininessMask",u,bg.base.TextureUnit.TEXTURE_3),this.shader.setVector4("inShininessMaskChannel",this.material.shininessMaskChannelVector),this.shader.setValueInt("inShininessMaskInvert",this.material.shininessMaskInvert),this.shader.setValueFloat("inLightEmission",this.material.lightEmission),this.shader.setTexture("inLightEmissionMask",l,bg.base.TextureUnit.TEXTURE_4),this.shader.setVector4("inLightEmissionMaskChannel",this.material.lightEmissionMaskChannelVector),this.shader.setValueInt("inLightEmissionMaskInvert",this.material.lightEmissionMaskInvert),this.shader.setTexture("inTexture",a,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setTexture("inLightMap",s,bg.base.TextureUnit.TEXTURE_1),this.shader.setVector2("inLightMapOffset",this.material.lightmapOffset),this.shader.setVector2("inLightMapScale",this.material.lightmapScale),this.shader.setTexture("inNormalMap",o,bg.base.TextureUnit.TEXTURE_2),this.shader.setVector2("inNormalMapScale",this.material.normalMapScale),this.shader.setVector2("inNormalMapOffset",this.material.normalMapOffset),this.shader.setValueInt("inReceiveShadows",this.material.receiveShadows),this.shader.setValueInt("inSelectMode",!1)}}},{},t)}(bg.base.Effect);bg.base.ForwardEffect=s}(),function(){bg.base.LightType={DIRECTIONAL:4,SPOT:1,POINT:5,DISABLED:10};var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._enabled=!0,this._type=bg.base.LightType.DIRECTIONAL,this._direction=new bg.Vector3(0,0,-1),this._ambient=new bg.Color(.2,.2,.2,1),this._diffuse=new bg.Color(.9,.9,.9,1),this._specular=bg.Color.White(),this._attenuation=new bg.Vector3(1,.5,.1),this._spotCutoff=20,this._spotExponent=30,this._shadowStrength=.7,this._cutoffDistance=-1,this._castShadows=!0,this._shadowBias=2e-5,this._projection=bg.Matrix4.Ortho(-10,10,-10,10,.5,300)}return $traceurRuntime.createClass(e,{clone:function(t){var e=new bg.base.Light(t||this.context);return e.assign(this),e},assign:function(t){this.enabled=t.enabled,this.type=t.type,this.direction.assign(t.direction),this.ambient.assign(t.ambient),this.diffuse.assign(t.diffuse),this.specular.assign(t.specular),this.attenuation.assign(t.attenuation),this.spotCutoff=t.spotCutoff,this.spotExponent=t.spotExponent,this.shadowStrength=t.shadowStrength,this.cutoffDistance=t.cutoffDistance,this.castShadows=t.castShadows,this.shadowBias=t.shadowBias},get enabled(){return this._enabled},set enabled(t){this._enabled=t},get type(){return this._type},set type(t){this._type=t},get direction(){return this._direction},set direction(t){this._direction=t},get ambient(){return this._ambient},set ambient(t){this._ambient=t},get diffuse(){return this._diffuse},set diffuse(t){this._diffuse=t},get specular(){return this._specular},set specular(t){this._specular=t},get attenuationVector(){return this._attenuation},get constantAttenuation(){return this._attenuation.x},get linearAttenuation(){return this._attenuation.y},get quadraticAttenuation(){return this._attenuation.z},set attenuationVector(t){this._attenuation=t},set constantAttenuation(t){this._attenuation.x=t},set linearAttenuation(t){this._attenuation.y=t},set quadraticAttenuation(t){this._attenuation.z=t},get cutoffDistance(){return this._cutoffDistance},set cutoffDistance(t){this._cutoffDistance=t},get spotCutoff(){return this._spotCutoff},set spotCutoff(t){this._spotCutoff=t},get spotExponent(){return this._spotExponent},set spotExponent(t){this._spotExponent=t},get shadowStrength(){return this._shadowStrength},set shadowStrength(t){this._shadowStrength=t},get castShadows(){return this._castShadows},set castShadows(t){this._castShadows=t},get shadowBias(){return this._shadowBias},set shadowBias(t){this._shadowBias=t},get projection(){return this._projection},set projection(t){this._projection=t}},{},t)}(bg.app.ContextObject);bg.base.Light=t}(),function(){function t(t,e,n){var i=null;return e&&((i=bg.base.TextureCache.Get(t).find(n))||(bg.log("Texture "+n+" not found. Loading texture"),i=new bg.base.Texture(t),i.create(),i.bind(),i.minFilter=bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST,i.magFilter=bg.base.TextureFilter.LINEAR,i.setImage(e),i.fileName=n,bg.base.TextureCache.Get(t).register(n,i))),i}function e(t){return/^(f|ht)tps?:\/\//i.test(t)}function n(t,n,i){var r=null;return n&&(e(n)||("/"!=i.slice(-1)&&(i+="/"),n=""+i+n),(r=bg.base.TextureCache.Get(t).find(n))||(r=new bg.base.Texture(t),r.create(),r.fileName=n,bg.base.TextureCache.Get(t).register(n,r),function(t,e){bg.utils.Resource.Load(t).then(function(n){e.bind(),r.minFilter=bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST,r.magFilter=bg.base.TextureFilter.LINEAR,e.fileName=t,e.setImage(n)})}(n,r))),r}function i(t){return t?t.fileName:""}function r(t){return new bg.Vector4(0==t?1:0,1==t?1:0,2==t?1:0,3==t?1:0)}bg.base.MaterialFlag={DIFFUSE:1,SPECULAR:2,SHININESS:4,LIGHT_EMISSION:8,REFRACTION_AMOUNT:16,REFLECTION_AMOUNT:32,TEXTURE:64,LIGHT_MAP:128,NORMAL_MAP:256,TEXTURE_OFFSET:512,TEXTURE_SCALE:1024,LIGHT_MAP_OFFSET:2048,LIGHT_MAP_SCALE:4096,NORMAL_MAP_OFFSET:8192,NORMAL_MAP_SCALE:16384,CAST_SHADOWS:32768,RECEIVE_SHADOWS:65536,ALPHA_CUTOFF:1<<17,SHININESS_MASK:1<<18,SHININESS_MASK_CHANNEL:1<<19,SHININESS_MASK_INVERT:1<<20,LIGHT_EMISSION_MASK:1<<21,LIGHT_EMISSION_MASK_CHANNEL:1<<22,LIGHT_EMISSION_MASK_INVERT:1<<23,REFLECTION_MASK:1<<24,REFLECTION_MASK_CHANNEL:1<<25,REFLECTION_MASK_INVERT:1<<26,CULL_FACE:1<<27};var a=function(){function t(t){this._modifierFlags=0,this._diffuse=bg.Color.White(),this._specular=bg.Color.White(),this._shininess=0,this._lightEmission=0,this._refractionAmount=0,this._reflectionAmount=0,this._texture=null,this._lightmap=null,this._normalMap=null,this._textureOffset=new bg.Vector2,this._textureScale=new bg.Vector2(1),this._lightmapOffset=new bg.Vector2,this._lightmapScale=new bg.Vector2(1),this._normalMapOffset=new bg.Vector2,this._normalMapScale=new bg.Vector2(1),this._castShadows=!0,this._receiveShadows=!0,this._alphaCutoff=.5,this._shininessMask=null,this._shininessMaskChannel=0,this._shininessMaskInvert=!1,this._lightEmissionMask=null,this._lightEmissionMaskChannel=0,this._lightEmissionMaskInvert=!1,this._reflectionMask=null,this._reflectionMaskChannel=0,this._reflectionMaskInvert=!1,this._cullFace=!0,t&&(void 0!==t.diffuseR&&void 0!==t.diffuseG&&void 0!==t.diffuseB&&(this.diffuse=new bg.Color(t.diffuseR,t.diffuseG,t.diffuseB,t.diffuseA?t.diffuseA:1)),void 0!==t.specularR&&void 0!==t.specularG&&void 0!==t.specularB&&(this.specular=new bg.Color(t.specularR,t.specularG,t.specularB,t.specularA?t.specularA:1)),void 0!==t.shininess&&(this.shininess=t.shininess),void 0!==t.lightEmission&&(this.lightEmission=t.lightEmission),void 0!==t.refractionAmount&&(this.refractionAmount=t.refractionAmount),void 0!==t.reflectionAmount&&(this.reflectionAmount=t.reflectionAmount),void 0!==t.texture&&(this.texture=t.texture),void 0!==t.lightmap&&(this.lightmap=t.lightmap),void 0!==t.normalMap&&(this.normalMap=t.normalMap),void 0!==t.textureOffsetX&&void 0!==t.textureOffsetY&&(this.textureOffset=new bg.Vector2(t.textureOffsetX,t.textureOffsetY)),void 0!==t.textureScaleX&&void 0!==t.textureScaleY&&(this.textureScale=new bg.Vector2(t.textureScaleX,t.textureScaleY)),void 0!==t.lightmapOffsetX&&void 0!==t.lightmapOffsetY&&(this.lightmapOffset=new bg.Vector2(t.lightmapOffsetX,t.lightmapOffsetY)),void 0!==t.lightmapScaleX&&void 0!==t.lightmapScaleY&&(this.lightmapScale=new bg.Vector2(t.lightmapScaleX,t.lightmapScaleY)),void 0!==t.normalMapScaleX&&void 0!==t.normalMapScaleY&&(this.normalMapScale=new bg.Vector2(t.normalMapScaleX,t.normalMapScaleY)),void 0!==t.normalMapOffsetX&&void 0!==t.normalMapOffsetY&&(this.normalMapOffset=new bg.Vector2(t.normalMapOffsetX,t.normalMapOffsetY)),void 0!==t.castShadows&&(this.castShadows=t.castShadows),void 0!==t.receiveShadows&&(this.receiveShadows=t.receiveShadows),void 0!==t.alphaCutoff&&(this.alphaCutoff=t.alphaCutoff),void 0!==t.shininessMask&&(this.shininessMask=t.shininessMask),void 0!==t.shininessMaskChannel&&(this.shininessMaskChannel=t.shininessMaskChannel),void 0!==t.invertShininessMask&&(this.shininessMaskInvert=t.invertShininessMask),void 0!==t.lightEmissionMask&&(this.lightEmissionMask=t.lightEmissionMask),void 0!==t.lightEmissionMaskChannel&&(this.lightEmissionMaskChannel=t.lightEmissionMaskChannel),void 0!==t.invertLightEmissionMask&&(this.lightEmissionMaskInvert=t.invertLightEmissionMask),void 0!==t.reflectionMask&&(this.reflectionMask=t.reflectionMask),void 0!==t.reflectionMaskChannel&&(this.reflectionMaskChannel=t.reflectionMaskChannel),void 0!==t.invertReflectionMask&&(this.reflectionMaskInvert=t.reflectionMaskInvert))}return $traceurRuntime.createClass(t,{get modifierFlags(){return this._modifierFlags},set modifierFlags(t){this._modifierFlags=t},setEnabled:function(t){this._modifierFlags=this._modifierFlags|t},isEnabled:function(t){return 0!=(this._modifierFlags&t)},get diffuse(){return this._diffuse},get specular(){return this._specular},get shininess(){return this._shininess},get lightEmission(){return this._lightEmission},get refractionAmount(){return this._refractionAmount},get reflectionAmount(){return this._reflectionAmount},get texture(){return this._texture},get lightmap(){return this._lightmap},get normalMap(){return this._normalMap},get textureOffset(){return this._textureOffset},get textureScale(){return this._textureScale},get lightmapOffset(){return this._lightmapOffset},get lightmapScale(){return this._lightmapScale},get normalMapOffset(){return this._normalMapOffset},get normalMapScale(){return this._normalMapScale},get castShadows(){return this._castShadows},get receiveShadows(){return this._receiveShadows},get alphaCutoff(){return this._alphaCutoff},get shininessMask(){return this._shininessMask},get shininessMaskChannel(){return this._shininessMaskChannel},get shininessMaskInvert(){return this._shininessMaskInvert},get lightEmissionMask(){return this._lightEmissionMask},get lightEmissionMaskChannel(){return this._lightEmissionMaskChannel},get lightEmissionMaskInvert(){return this._lightEmissionMaskInvert},get reflectionMask(){return this._reflectionMask},get reflectionMaskChannel(){return this._reflectionMaskChannel},get reflectionMaskInvert(){return this._reflectionMaskInvert},get cullFace(){return this._cullFace},set diffuse(t){this._diffuse=t,this.setEnabled(bg.base.MaterialFlag.DIFFUSE)},set specular(t){this._specular=t,this.setEnabled(bg.base.MaterialFlag.SPECULAR)},set shininess(t){isNaN(t)||(this._shininess=t,this.setEnabled(bg.base.MaterialFlag.SHININESS))},set lightEmission(t){isNaN(t)||(this._lightEmission=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION))},set refractionAmount(t){isNaN(t)||(this._refractionAmount=t,this.setEnabled(bg.base.MaterialFlag.REFRACTION_AMOUNT))},set reflectionAmount(t){isNaN(t)||(this._reflectionAmount=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_AMOUNT))},set texture(t){this._texture=t,this.setEnabled(bg.base.MaterialFlag.TEXTURE)},set lightmap(t){this._lightmap=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_MAP)},set normalMap(t){this._normalMap=t,this.setEnabled(bg.base.MaterialFlag.NORMAL_MAP)},set textureOffset(t){this._textureOffset=t,this.setEnabled(bg.base.MaterialFlag.TEXTURE_OFFSET)},set textureScale(t){this._textureScale=t,this.setEnabled(bg.base.MaterialFlag.TEXTURE_SCALE)},set lightmapOffset(t){this._lightmapOffset=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_MAP_OFFSET)},set lightmapScale(t){this._lightmapScale=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_MAP_SCALE)},set normalMapOffset(t){this._normalMapOffset=t,this.setEnabled(bg.base.MaterialFlag.NORMAL_MAP_OFFSET)},set normalMapScale(t){this._normalMapScale=t,this.setEnabled(bg.base.MaterialFlag.NORMAL_MAP_SCALE)},set castShadows(t){this._castShadows=t,this.setEnabled(bg.base.MaterialFlag.CAST_SHADOWS)},set receiveShadows(t){this._receiveShadows=t,this.setEnabled(bg.base.MaterialFlag.RECEIVE_SHADOWS)},set alphaCutoff(t){isNaN(t)||(this._alphaCutoff=t,this.setEnabled(bg.base.MaterialFlag.ALPHA_CUTOFF))},set shininessMask(t){this._shininessMask=t,this.setEnabled(bg.base.MaterialFlag.SHININESS_MASK)},set shininessMaskChannel(t){this._shininessMaskChannel=t,this.setEnabled(bg.base.MaterialFlag.SHININESS_MASK_CHANNEL)},set shininessMaskInvert(t){this._shininessMaskInvert=t,this.setEnabled(bg.base.MaterialFlag.SHININESS_MASK_INVERT)},set lightEmissionMask(t){this._lightEmissionMask=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK)},set lightEmissionMaskChannel(t){this._lightEmissionMaskChannel=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL)},set lightEmissionMaskInvert(t){this._lightEmissionMaskInvert=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT)},set reflectionMask(t){this._reflectionMask=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_MASK)},set reflectionMaskChannel(t){this._reflectionMaskChannel=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL)},set reflectionMaskInvert(t){this._reflectionMaskInvert=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_MASK_INVERT)},set cullFace(t){this._cullFace=t,this.setEnabled(bg.base.MaterialFlag.CULL_FACE)},clone:function(){var e=new t;return e.assign(this),e},assign:function(t){this._modifierFlags=t._modifierFlags,this._diffuse=t._diffuse,this._specular=t._specular,this._shininess=t._shininess,this._lightEmission=t._lightEmission,this._refractionAmount=t._refractionAmount,this._reflectionAmount=t._reflectionAmount,this._texture=t._texture,this._lightmap=t._lightmap,this._normalMap=t._normalMap,this._textureOffset=t._textureOffset,this._textureScale=t._textureScale,this._lightmapOffset=t._lightmapOffset,this._lightmapScale=t._lightmapScale,
this._normalMapOffset=t._normalMapOffset,this._normalMapScale=t._normalMapScale,this._castShadows=t._castShadows,this._receiveShadows=t._receiveShadows,this._alphaCutoff=t._alphaCutoff,this._shininessMask=t._shininessMask,this._shininessMaskChannel=t._shininessMaskChannel,this._shininessMaskInvert=t._shininessMaskInvert,this._lightEmissionMask=t._lightEmissionMask,this._lightEmissionMaskChannel=t._lightEmissionMaskChannel,this._lightEmissionMaskInvert=t._lightEmissionMaskInvert,this._reflectionMask=t._reflectionMask,this._reflectionMaskChannel=t._reflectionMaskChannel,this._reflectionMaskInvert=t._reflectionMaskInvert,this._cullFace=t._cullFace}},{})}();bg.base.MaterialModifier=a;var s=function(){function e(){this._diffuse=bg.Color.White(),this._specular=bg.Color.White(),this._shininess=0,this._lightEmission=0,this._refractionAmount=0,this._reflectionAmount=0,this._texture=null,this._lightmap=null,this._normalMap=null,this._textureOffset=new bg.Vector2,this._textureScale=new bg.Vector2(1),this._lightmapOffset=new bg.Vector2,this._lightmapScale=new bg.Vector2(1),this._normalMapOffset=new bg.Vector2,this._normalMapScale=new bg.Vector2(1),this._castShadows=!0,this._receiveShadows=!0,this._alphaCutoff=.5,this._shininessMask=null,this._shininessMaskChannel=0,this._shininessMaskInvert=!1,this._lightEmissionMask=null,this._lightEmissionMaskChannel=0,this._lightEmissionMaskInvert=!1,this._reflectionMask=null,this._reflectionMaskChannel=0,this._reflectionMaskInvert=!1,this._cullFace=!0}return $traceurRuntime.createClass(e,{clone:function(){var t=new e;return t.assign(this),t},assign:function(t){this._diffuse=new bg.Color(t.diffuse),this._specular=new bg.Color(t.specular),this._shininess=t.shininess,this._lightEmission=t.lightEmission,this._refractionAmount=t.refractionAmount,this._reflectionAmount=t.reflectionAmount,this._texture=t.texture,this._lightmap=t.lightmap,this._normalMap=t.normalMap,this._textureOffset=new bg.Vector2(t.textureOffset),this._textureScale=new bg.Vector2(t.textureScale),this._lightmapOffset=new bg.Vector2(t.ligthmapOffset),this._lightmapScale=new bg.Vector2(t.lightmapScale),this._normalMapOffset=new bg.Vector2(t.normalMapOffset),this._normalMapScale=new bg.Vector2(t.normalMapScale),this._castShadows=t.castShadows,this._receiveShadows=t.receiveShadows,this._alphaCutoff=t.alphaCutoff,this._shininessMask=t.shininessMask,this._shininessMaskChannel=t.shininessMaskChannel,this._shininessMaskInvert=t.shininessMaskInvert,this._lightEmissionMask=t.lightEmissionMask,this._lightEmissionMaskChannel=t.lightEmissionMaskChannel,this._lightEmissionMaskInvert=t.lightEmissionMaskInvert,this._reflectionMask=t.reflectionMask,this._reflectionMaskChannel=t.reflectionMaskChannel,this._reflectionMaskInvert=t.reflectionMaskInvert,this._cullFace=t.cullFace},get isTransparent(){return this._diffuse.a<1},get diffuse(){return this._diffuse},get specular(){return this._specular},get shininess(){return this._shininess},get lightEmission(){return this._lightEmission},get refractionAmount(){return this._refractionAmount},get reflectionAmount(){return this._reflectionAmount},get texture(){return this._texture},get lightmap(){return this._lightmap},get normalMap(){return this._normalMap},get textureOffset(){return this._textureOffset},get textureScale(){return this._textureScale},get lightmapOffset(){return this._lightmapOffset},get lightmapScale(){return this._lightmapScale},get normalMapOffset(){return this._normalMapOffset},get normalMapScale(){return this._normalMapScale},get castShadows(){return this._castShadows},get receiveShadows(){return this._receiveShadows},get alphaCutoff(){return this._alphaCutoff},get shininessMask(){return this._shininessMask},get shininessMaskChannel(){return this._shininessMaskChannel},get shininessMaskInvert(){return this._shininessMaskInvert},get lightEmissionMask(){return this._lightEmissionMask},get lightEmissionMaskChannel(){return this._lightEmissionMaskChannel},get lightEmissionMaskInvert(){return this._lightEmissionMaskInvert},get reflectionMask(){return this._reflectionMask},get reflectionMaskChannel(){return this._reflectionMaskChannel},get reflectionMaskInvert(){return this._reflectionMaskInvert},get cullFace(){return this._cullFace},set diffuse(t){this._diffuse=t},set specular(t){this._specular=t},set shininess(t){isNaN(t)||(this._shininess=t)},set lightEmission(t){isNaN(t)||(this._lightEmission=t)},set refractionAmount(t){this._refractionAmount=t},set reflectionAmount(t){this._reflectionAmount=t},set texture(t){this._texture=t},set lightmap(t){this._lightmap=t},set normalMap(t){this._normalMap=t},set textureOffset(t){this._textureOffset=t},set textureScale(t){this._textureScale=t},set lightmapOffset(t){this._lightmapOffset=t},set lightmapScale(t){this._lightmapScale=t},set normalMapOffset(t){this._normalMapOffset=t},set normalMapScale(t){this._normalMapScale=t},set castShadows(t){this._castShadows=t},set receiveShadows(t){this._receiveShadows=t},set alphaCutoff(t){isNaN(t)||(this._alphaCutoff=t)},set shininessMask(t){this._shininessMask=t},set shininessMaskChannel(t){this._shininessMaskChannel=t},set shininessMaskInvert(t){this._shininessMaskInvert=t},set lightEmissionMask(t){this._lightEmissionMask=t},set lightEmissionMaskChannel(t){this._lightEmissionMaskChannel=t},set lightEmissionMaskInvert(t){this._lightEmissionMaskInvert=t},set reflectionMask(t){this._reflectionMask=t},set reflectionMaskChannel(t){this._reflectionMaskChannel=t},set reflectionMaskInvert(t){this._reflectionMaskInvert=t},set cullFace(t){this._cullFace=t},get lightEmissionMaskChannelVector(){return r(this.lightEmissionMaskChannel)},get shininessMaskChannelVector(){return r(this.shininessMaskChannel)},get reflectionMaskChannelVector(){return r(this.reflectionMaskChannel)},copyMaterialSettings:function(t,e){e&bg.base.MaterialFlag.DIFFUSE&&(t.diffuse=this.diffuse),e&bg.base.MaterialFlag.SPECULAR&&(t.specular=this.specular),e&bg.base.MaterialFlag.SHININESS&&(t.shininess=this.shininess),e&bg.base.MaterialFlag.LIGHT_EMISSION&&(t.lightEmission=this.lightEmission),e&bg.base.MaterialFlag.REFRACTION_AMOUNT&&(t.refractionAmount=this.refractionAmount),e&bg.base.MaterialFlag.REFLECTION_AMOUNT&&(t.reflectionAmount=this.reflectionAmount),e&bg.base.MaterialFlag.TEXTURE&&(t.texture=this.texture),e&bg.base.MaterialFlag.LIGHT_MAP&&(t.lightmap=this.lightmap),e&bg.base.MaterialFlag.NORMAL_MAP&&(t.normalMap=this.normalMap),e&bg.base.MaterialFlag.TEXTURE_OFFSET&&(t.textureOffset=this.textureOffset),e&bg.base.MaterialFlag.TEXTURE_SCALE&&(t.textureScale=this.textureScale),e&bg.base.MaterialFlag.LIGHT_MAP_OFFSET&&(t.lightmapOffset=this.lightmapOffset),e&bg.base.MaterialFlag.LIGHT_MAP_SCALE&&(t.lightmapScale=this.lightmapScale),e&bg.base.MaterialFlag.NORMAL_MAP_OFFSET&&(t.normalMapOffset=this.normalMapOffset),e&bg.base.MaterialFlag.NORMAL_MAP_SCALE&&(t.normalMapScale=this.normalMapScale),e&bg.base.MaterialFlag.CAST_SHADOWS&&(t.castShadows=this.castShadows),e&bg.base.MaterialFlag.RECEIVE_SHADOWS&&(t.receiveShadows=this.receiveShadows),e&bg.base.MaterialFlag.ALPHA_CUTOFF&&(t.alphaCutoff=this.alphaCutoff),e&bg.base.MaterialFlag.SHININESS_MASK&&(t.shininessMask=this.shininessMask),e&bg.base.MaterialFlag.SHININESS_MASK_CHANNEL&&(t.shininessMaskChannel=this.shininessMaskChannel),e&bg.base.MaterialFlag.SHININESS_MASK_INVERT&&(t.shininessMaskInvert=this.shininessMaskInvert),e&bg.base.MaterialFlag.LIGHT_EMISSION_MASK&&(t.lightEmissionMask=this.lightEmissionMask),e&bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL&&(t.lightEmissionMaskChannel=this.lightEmissionMaskChannel),e&bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT&&(t.lightEmissionMaskInvert=this.lightEmissionMaskInvert),e&bg.base.MaterialFlag.REFLECTION_MASK&&(t.reflectionMask=this.reflectionMask),e&bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL&&(t.reflectionMaskChannel=this.reflectionMaskChannel),e&bg.base.MaterialFlag.REFLECTION_MASK_INVERT&&(t.reflectionMaskInvert=this.reflectionMaskInvert),e&bg.base.MaterialFlag.CULL_FACE&&(t.cullFace=this.cullFace)},applyModifier:function(t,e,i){e.isEnabled(bg.base.MaterialFlag.DIFFUSE)&&(this.diffuse=e.diffuse),e.isEnabled(bg.base.MaterialFlag.SPECULAR)&&(this.specular=e.specular),e.isEnabled(bg.base.MaterialFlag.SHININESS)&&(this.shininess=e.shininess),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION)&&(this.lightEmission=e.lightEmission),e.isEnabled(bg.base.MaterialFlag.REFRACTION_AMOUNT)&&(this.refractionAmount=e.refractionAmount),e.isEnabled(bg.base.MaterialFlag.REFLECTION_AMOUNT)&&(this.reflectionAmount=e.reflectionAmount),e.isEnabled(bg.base.MaterialFlag.TEXTURE)&&(this.texture=n(t,e.texture,i)),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP)&&(this.lightmap=n(t,e.lightmap,i)),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP)&&(this.normalMap=n(t,e.normalMap,i)),e.isEnabled(bg.base.MaterialFlag.TEXTURE_OFFSET)&&(this.textureOffset=e.textureOffset),e.isEnabled(bg.base.MaterialFlag.TEXTURE_SCALE)&&(this.textureScale=e.textureScale),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_OFFSET)&&(this.lightmapOffset=e.lightmapOffset),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_SCALE)&&(this.lightmapScale=e.lightmapScale),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_OFFSET)&&(this.normalMapOffset=e.normalMapOffset),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_SCALE)&&(this.normalMapScale=e.normalMapScale),e.isEnabled(bg.base.MaterialFlag.CAST_SHADOWS)&&(this.castShadows=e.castShadows),e.isEnabled(bg.base.MaterialFlag.RECEIVE_SHADOWS)&&(this.receiveShadows=e.receiveShadows),e.isEnabled(bg.base.MaterialFlag.ALPHA_CUTOFF)&&(this.alphaCutoff=e.alphaCutoff),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK)&&(this.shininessMask=n(t,e.shininessMask,i)),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_CHANNEL)&&(this.shininessMaskChannel=e.shininessMaskChannel),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_INVERT)&&(this.shininessMaskInvert=e.shininessMaskInvert),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK)&&(this.lightEmissionMask=n(t,e.lightEmissionMask,i)),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL)&&(this.lightEmissionMaskChannel=e.lightEmissionMaskChannel),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT)&&(this.lightEmissionMaskInvert=e.lightEmissionMaskInvert),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK)&&(this.reflectionMask=n(t,e.reflectionMask,i)),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL)&&(this.reflectionMaskChannel=e.reflectionMaskChannel),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_INVERT)&&(this.reflectionMaskInvert=e.reflectionMaskInvert),e.isEnabled(bg.base.MaterialFlag.CULL_FACE)&&(this.cullFace=e.cullFace)},getModifierWithMask:function(t){var e=new a;e.isEnabled(bg.base.MaterialFlag.DIFFUSE)&&(e.diffuse=this.diffuse),e.isEnabled(bg.base.MaterialFlag.SPECULAR)&&(e.specular=this.specular),e.isEnabled(bg.base.MaterialFlag.SHININESS)&&(e.shininess=this.shininess),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION)&&(e.lightEmission=this.lightEmission),e.isEnabled(bg.base.MaterialFlag.REFRACTION_AMOUNT)&&(e.refractionAmount=this.refractionAmount),e.isEnabled(bg.base.MaterialFlag.REFLECTION_AMOUNT)&&(e.reflectionAmount=this.reflectionAmount),e.isEnabled(bg.base.MaterialFlag.TEXTURE)&&(e.texture=i(this.texture)),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP)&&(e.lightmap=i(this.lightmap)),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP)&&(e.normalMap=i(this.normalMap)),e.isEnabled(bg.base.MaterialFlag.TEXTURE_OFFSET)&&(e.textureOffset=this.textureOffset),e.isEnabled(bg.base.MaterialFlag.TEXTURE_SCALE)&&(e.textureScale=this.textureScale),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_OFFSET)&&(e.lightmapOffset=this.lightmapOffset),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_SCALE)&&(e.lightmapScale=this.lightmapScale),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_OFFSET)&&(e.normalMapOffset=this.normalMapOffset),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_SCALE)&&(e.normalMapScale=this.normalMapScale),e.isEnabled(bg.base.MaterialFlag.CAST_SHADOWS)&&(e.castShadows=this.castShadows),e.isEnabled(bg.base.MaterialFlag.RECEIVE_SHADOWS)&&(e.receiveShadows=this.receiveShadows),e.isEnabled(bg.base.MaterialFlag.ALPHA_CUTOFF)&&(e.alphaCutoff=this.alphaCutoff),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK)&&(e.shininessMask=i(this.shininessMask)),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_CHANNEL)&&(e.shininessMaskChannel=this.shininessMaskChannel),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_INVERT)&&(e.shininessMaskInvert=this.shininessMaskInvert),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK)&&(e.lightEmissionMask=i(this.lightEmissionMask)),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL)&&(e.lightEmissionMaskChannel=this.lightEmissionMaskChannel),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT)&&(e.lightEmissionMaskInver=this.lightEmissionMaskInver),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK)&&(e.reflectionMask=i(this.reflectionMask)),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL)&&(e.reflectionMaskChannel=this.reflectionMaskChannel),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_INVERT)&&(e.reflectionMaskInvert=this.reflectionMaskInvert),e.isEnabled(bg.base.MaterialFlag.CULL_FACE)&&(e.cullFace=this.cullFace),e.setFlags(t)}},{GetMaterialWithJson:function(n,i,r){function a(t,e){return e?t?t+e:e:null}var s=new e;return void 0===i.cullFace&&(i.cullFace=!0),s.diffuse.set(i.diffuseR,i.diffuseG,i.diffuseB,i.diffuseA),s.specular.set(i.specularR,i.specularG,i.specularB,i.specularA),s.shininess=i.shininess,s.lightEmission=i.lightEmission,s.refractionAmount=i.refractionAmount,s.reflectionAmount=i.reflectionAmount,s.textureOffset.set(i.textureOffsetX,i.textureOffsetY),s.textureScale.set(i.textureScaleX,i.textureScaleY),s.lightmapOffset.set(i.lightmapOffsetX,i.lightmapOffsetY),s.lightmapScale.set(i.lightmapScaleX,i.lightmapScaleY),s.normalMapOffset.set(i.normalMapOffsetX,i.normalMapOffsetY),s.normalMapScale.set(i.normalMapScaleX,i.normalMapScaleY),s.alphaCutoff=i.alphaCutoff,s.castShadows=i.castShadows,s.receiveShadows=i.receiveShadows,s.shininessMaskChannel=i.shininessMaskChannel,s.shininessMaskInvert=i.invertShininessMask,s.lightEmissionMaskChannel=i.lightEmissionMaskChannel,s.lightEmissionMaskInvert=i.invertLightEmissionMask,s.reflectionMaskChannel=i.reflectionMaskChannel,s.reflectionMaskInvert=i.invertReflectionMask,s.cullFace=i.cullFace,r&&"/"!=r[r.length-1]&&(r+="/"),i.texture=a(r,i.texture),i.lightmap=a(r,i.lightmap),i.normalMap=a(r,i.normalMap),i.shininessMask=a(r,i.shininessMask),i.lightEmissionMask=a(r,i.lightEmissionMask),i.reflectionMask=a(r,i.reflectionMask),new Promise(function(e,r){var a=[];i.texture&&a.push(i.texture),i.lightmap&&-1==a.indexOf(i.lightmap)&&a.push(i.lightmap),i.normalMap&&-1==a.indexOf(i.normalMap)&&a.push(i.normalMap),i.shininessMask&&-1==a.indexOf(i.shininessMask)&&a.push(i.shininessMask),i.lightEmissionMask&&-1==a.indexOf(i.lightEmissionMask)&&a.push(i.lightEmissionMask),i.reflectionMask&&-1==a.indexOf(i.reflectionMask)&&a.push(i.reflectionMask),bg.utils.Resource.Load(a).then(function(r){s.texture=t(n,r[i.texture],i.texture),s.lightmap=t(n,r[i.lightmap],i.lightmap),s.normalMap=t(n,r[i.normalMap],i.normalMap),s.shininessMask=t(n,r[i.shininessMask],i.shininessMask),s.lightEmissionMask=t(n,r[i.lightEmissionMask],i.lightEmissionMask),s.reflectionMask=t(n,r[i.reflectionMask],i.reflectionMask),e(s)})})}})}();bg.base.Material=s}(),function(){var t=function(){function t(){this._matrix=new bg.Matrix4.Identity,this._stack=[],this._changed=!0}return $traceurRuntime.createClass(t,{get changed(){return this._changed},set changed(t){this._changed=t},push:function(){this._stack.push(new bg.Matrix4(this._matrix))},set:function(t){return this._matrix.assign(t),this._changed=!0,this},mult:function(t){return this._matrix.mult(t),this._changed=!0,this},identity:function(){return this._matrix.identity(),this._changed=!0,this},translate:function(t,e,n){return this._matrix.translate(t,e,n),this._changed=!0,this},rotate:function(t,e,n,i){return this._matrix.rotate(t,e,n,i),this._changed=!0,this},scale:function(t,e,n){return this._matrix.scale(t,e,n),this._changed=!0,this},perspective:function(t,e,n,i){return this._matrix.identity().perspective(t,e,n,i),this._changed=!0,this},frustum:function(t,e,n,i,r,a){return this._matrix.identity().frustum(t,e,n,i,r,a),this._changed=!0,this},ortho:function(t,e,n,i,r,a){return this._matrix.identity().ortho(t,e,n,i,r,a),this._changed=!0,this},invert:function(){return this._matrix.invert(),this._changed=!0,this},get matrix(){return this._changed=!0,this._matrix},get matrixConst(){return this._matrix},pop:function(){return this._stack.length&&(this._matrix.assign(this._stack.pop()),this._changed=!0),this._matrix}},{})}();bg.base.MatrixStack=t;var e=null,n=function(){function n(){this._modelMatrixStack=new t,this._viewMatrixStack=new t,this._projectionMatrixStack=new t,this._modelViewMatrix=new bg.Matrix4.Identity,this._normalMatrix=new bg.Matrix4.Identity}return $traceurRuntime.createClass(n,{get modelMatrixStack(){return this._modelMatrixStack},get viewMatrixStack(){return this._viewMatrixStack},get projectionMatrixStack(){return this._projectionMatrixStack},get modelViewMatrix(){return(!this._modelViewMatrix||this._modelMatrixStack.changed||this._viewMatrixStack.changed)&&(this._modelViewMatrix=new bg.Matrix4(this._viewMatrixStack._matrix),this._modelViewMatrix.mult(this._modelMatrixStack._matrix),this._modelMatrixStack.changed=!1,this._viewMatrixStack.changed=!1),this._modelViewMatrix},get normalMatrix(){return(!this._normalMatrix||this._modelMatrixStack.changed||this._viewMatrixStack.changed)&&(this._normalMatrix=new bg.Matrix4(this.modelViewMatrix),this._normalMatrix.invert(),this._normalMatrix.traspose(),this._modelMatrixStack.changed=!1),this._normalMatrix},get viewMatrixInvert(){return this._viewMatrixInvert&&!this._viewMatrixStack.changed||(this._viewMatrixInvert=new bg.Matrix4(this.viewMatrixStack.matrixConst),this._viewMatrixInvert.invert()),this._viewMatrixInvert}},{Current:function(){return e||(e=new n),e},SetCurrent:function(t){return e=t}})}();bg.base.MatrixState=n}(),function(){function t(t){t._effect&&t._effect.setActive(),t.renderSurface.setActive(),bg.Engine.Get().pipeline.setViewport(t.context,t._viewport),bg.Engine.Get().pipeline.setDepthTestEnabled(t.context,t._depthTest),bg.Engine.Get().pipeline.setCullFace(t.context,t._cullFace),bg.Engine.Get().pipeline.setBlendEnabled(t.context,t._blend),bg.Engine.Get().pipeline.setBlendMode(t.context,t._blendMode)}bg.base.ClearBuffers={COLOR:null,DEPTH:null,COLOR_DEPTH:null},bg.base.BlendMode={NORMAL:1,MULTIPLY:2,ADD:3,SUBTRACT:4,ALPHA_ADD:5,ALPHA_SUBTRACT:6},bg.base.OpacityLayer={TRANSPARENT:1,OPAQUE:2,GIZMOS:4,SELECTION:8,ALL:15,NONE:0};var e=function(){function t(t){this.initFlags(t),bg.base.ClearBuffers.COLOR_DEPTH=bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH}return $traceurRuntime.createClass(t,{initFlags:function(t){},setViewport:function(t,e){},clearBuffers:function(t,e,n){},setDepthTestEnabled:function(t,e){},setBlendEnabled:function(t,e){},setBlendMode:function(t,e){},setCullFace:function(t,e){}},{})}();bg.base.PipelineImpl=e;var n=null,i=function(e){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._opacityLayer=bg.base.OpacityLayer.ALL,this._viewport=new bg.Viewport(0,0,200,200),this._clearColor=bg.Color.Black(),this._effect=null,this._textureEffect=null,this._depthTest=!0,this._cullFace=!0,this._renderSurface=null,this._blend=!1,this._blendMode=bg.base.BlendMode.NORMAL,this._buffersToClear=bg.base.ClearBuffers.COLOR_DEPTH}return $traceurRuntime.createClass(i,{get isCurrent(){return n==this},set opacityLayer(t){this._opacityLayer=t},get opacityLayer(){return this._opacityLayer},shouldDraw:function(t){return t&&(t.isTransparent&&0!=(this._opacityLayer&bg.base.OpacityLayer.TRANSPARENT)||!t.isTransparent&&0!=(this._opacityLayer&bg.base.OpacityLayer.OPAQUE))},get effect(){return this._effect},set effect(t){this._effect=t,this._effect&&this.isCurrent&&this._effect.setActive()},get textureEffect(){return this._textureEffect||(this._textureEffect=new bg.base.DrawTextureEffect(this.context)),this._textureEffect},set textureEffect(t){this._textureEffect=t},set buffersToClear(t){this._buffersToClear=t},get buffersToClear(){return this._buffersToClear},get renderSurface(){return this._renderSurface||(this._renderSurface=new bg.base.ColorSurface(this.context),this._renderSurface.setActive()),this._renderSurface},set renderSurface(t){this._renderSurface=t,this.isCurrent&&this._renderSurface.setActive()},draw:function(t){if(this._effect&&t&&this.isCurrent){var e=this.cullFace;this._effect.bindPolyList(t),this._effect.material&&(this.cullFace=this._effect.material.cullFace),t.draw(),this._effect.unbind(),this.cullFace=e}},drawTexture:function(t){var e=this.depthTest;this.depthTest=!1,this.textureEffect.drawSurface(t),this.depthTest=e},get blend(){return this._blend},set blend(t){this._blend=t,this.isCurrent&&bg.Engine.Get().pipeline.setBlendEnabled(this.context,this._blend)},get blendMode(){return this._blendMode},set blendMode(t){this._blendMode=t,this.isCurrent&&bg.Engine.Get().pipeline.setBlendMode(this.context,this._blendMode)},get viewport(){return this._viewport},set viewport(t){this._viewport=t,this.renderSurface.resizeOnViewportChanged&&(this.renderSurface.size=new bg.Vector2(t.width,t.height)),this.isCurrent&&bg.Engine.Get().pipeline.setViewport(this.context,this._viewport)},clearBuffers:function(t){this.isCurrent&&(t=void 0!==t?t:this._buffersToClear,bg.Engine.Get().pipeline.clearBuffers(this.context,this._clearColor,t))},get clearColor(){return this._clearColor},set clearColor(t){this._clearColor=t},get depthTest(){return this._depthTest},set depthTest(t){this._depthTest=t,this.isCurrent&&bg.Engine.Get().pipeline.setDepthTestEnabled(this.context,this._depthTest)},get cullFace(){return this._cullFace},set cullFace(t){this._cullFace=t,this.isCurrent&&bg.Engine.Get().pipeline.setCullFace(this.context,this._cullFace)}},{SetCurrent:function(e){(n=e)&&t(n)},Current:function(){return n}},e)}(bg.app.ContextObject);bg.base.Pipeline=i}(),function(){function t(t){if(t.texCoord0&&t.vertex){t._tangent=[];for(var e=[],n={},i=0;i<t.index.length-2;i+=3){var r=3*t.index[i],a=3*t.index[i+1],s=3*t.index[i+2],o=2*t.index[i],u=2*t.index[i+1],l=2*t.index[i+2],c=new bg.Vector3(t.vertex[r],t.vertex[r+1],t.vertex[r+2]),h=new bg.Vector3(t.vertex[a],t.vertex[a+1],t.vertex[a+2]),f=new bg.Vector3(t.vertex[s],t.vertex[s+1],t.vertex[s+2]),d=new bg.Vector2(t.texCoord0[o],t.texCoord0[o+1]),g=new bg.Vector2(t.texCoord0[u],t.texCoord0[u+1]),m=new bg.Vector2(t.texCoord0[l],t.texCoord0[l+1]),p=new bg.Vector3(h).sub(c),b=new bg.Vector3(f).sub(c),_=g.x-d.x,v=g.y-d.y,y=m.x-d.x,E=m.y-d.y,T=1/(_*E-y*v),x=new bg.Vector3(T*(E*p.x-v*b.x),T*(E*p.y-v*b.y),T*(E*p.z-v*b.z));x.normalize(),void 0===n[r]&&(e.push(x.x),e.push(x.y),e.push(x.z),n[r]=x),void 0===n[a]&&(e.push(x.x),e.push(x.y),e.push(x.z),n[a]=x),void 0===n[s]&&(e.push(x.x),e.push(x.y),e.push(x.z),n[s]=x)}return e}}var e=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){},create:function(t){},build:function(t,e,n,i,r,a,s,o,u,l){return!1},draw:function(t,e,n,i){},destroy:function(t,e){}},{})}();bg.base.PolyListImpl=e,bg.base.DrawMode={TRIANGLES:null,TRIANGLE_FAN:null,TRIANGLE_STRIP:null};var n=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._plist=null,this._drawMode=bg.base.DrawMode.TRIANGLES,this._name="",this._groupName="",this._visible=!0,this._vertex=[],this._normal=[],this._texCoord0=[],this._texCoord1=[],this._texCoord2=[],this._color=[],this._tangent=[],this._index=[]}return $traceurRuntime.createClass(n,{clone:function(){var t=new n(this.context),e=function(t,e){t.forEach(function(t){e.push(t)})};return t.name=this.name+" clone",t.groupName=this.groupName,t.visible=this.visible,t.drawMode=this.drawMode,e(this.vertex,t.vertex),e(this.normal,t.normal),e(this.texCoord0,t.texCoord0),e(this.texCoord1,t.texCoord1),e(this.texCoord2,t.texCoord02),e(this.color,t.color),e(this.index,t.index),t.build(),t},get name(){return this._name},set name(t){this._name=t},get groupName(){return this._groupName},set groupName(t){this._groupName=t},get visible(){return this._visible},set visible(t){this._visible=t},get drawMode(){return this._drawMode},set drawMode(t){this._drawMode=t},set vertex(t){this._vertex=t},set normal(t){this._normal=t},set texCoord0(t){this._texCoord0=t},set texCoord1(t){this._texCoord1=t},set texCoord2(t){this._texCoord2=t},set color(t){this._color=t},set index(t){this._index=t},get vertex(){return this._vertex},get normal(){return this._normal},get texCoord0(){return this._texCoord0},get texCoord1(){return this._texCoord1},get texCoord2(){return this._texCoord2},get color(){return this._color},get tangent(){return this._tangent},get index(){return this._index},get vertexBuffer(){return this._plist.vertexBuffer},get normalBuffer(){return this._plist.normalBuffer},get texCoord0Buffer(){return this._plist.tex0Buffer},get texCoord1Buffer(){return this._plist.tex1Buffer},get texCoord2Buffer(){return this._plist.tex2Buffer},get colorBuffer(){return this._plist.colorBuffer},get tangentBuffer(){return this._plist.tangentBuffer},get indexBuffer(){return this._plist.indexBuffer},build:function(){var e=bg.Engine.Get().polyList;return this._plist&&(e.destroy(this.context,this._plist),this._tangent=[]),this._tangent=t(this),this._plist=e.create(this.context),e.build(this.context,this._plist,this._vertex,this._normal,this._texCoord0,this._texCoord1,this._texCoord2,this._color,this._tangent,this._index)},draw:function(){bg.Engine.Get().polyList.draw(this.context,this._plist,this.drawMode,this.index.length)},destroy:function(){this._plist&&bg.Engine.Get().polyList.destroy(this.context,this._plist),this._plist=null,this._name="",this._vertex=[],this._normal=[],this._texCoord0=[],this._texCoord1=[],this._texCoord2=[],this._color=[],this._tangent=[],this._index=[]},applyTransform:function(t){var e=new bg.Matrix4(t),n=new bg.Matrix4(t.getMatrix3());if(this.normal.length>0&&this.normal.length!=this.vertex.length)throw new Error("Unexpected number of normal coordinates found in polyList");for(var i=0;i<this.vertex.length-2;i+=3){var r=new bg.Vector4(this.vertex[i],this.vertex[i+1],this.vertex[i+2],1);if(r=e.multVector(r),this.vertex[i]=r.x,this.vertex[i+1]=r.y,this.vertex[i+2]=r.z,this.normal.length){var a=new bg.Vector4(this.normal[i],this.normal[i+1],this.normal[i+2],1);a=n.multVector(a),this.normal[i]=a.x,this.normal[i+1]=a.y,this.normal[i+2]=a.z}}this.build()}},{},e)}(bg.app.ContextObject);bg.base.PolyList=n}(),function(){function t(){return bg.base.ShaderLibrary.Get()}function e(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex]),i.addParameter(t().inputs.matrix.all),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t")),i}function n(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\tgl_FragColor = vec4(1.0,0.0,0.0,1.0);\n\t\t\t\t")),r}var i=null,r=null,a=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t);var r=[e(),n()];this.setupShaderSource(r)}return $traceurRuntime.createClass(i,{beginDraw:function(){},setupVars:function(){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst)}},{},t)}(bg.base.Effect);bg.base.RedEffect=a}(),function(){var t=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){},create:function(t,e){},setActive:function(t,e){},readBuffer:function(t,e,n){},resize:function(t,e,n){},destroy:function(t,e){},supportType:function(t){},supportFormat:function(t){},maxColorAttachments:function(){}},{})}();bg.base.RenderSurfaceBufferImpl=t;var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._size=new bg.Vector2(256),this._renderSurface=null,this._resizeOnViewportChanged=!0}return $traceurRuntime.createClass(e,{get size(){return this._size},set size(t){this._size.x==t.x&&this._size.y==t.y||(this._size=t,this.surfaceImpl.resize(this.context,this._renderSurface,t))},get surfaceImpl(){return null},get resizeOnViewportChanged(){return this._resizeOnViewportChanged},set resizeOnViewportChanged(t){this._resizeOnViewportChanged=t},create:function(t){t||(t=e.DefaultAttachments()),this._renderSurface=this.surfaceImpl.create(this.context,t)},setActive:function(){this.surfaceImpl.setActive(this.context,this._renderSurface)},readBuffer:function(t){return this.surfaceImpl.readBuffer(this.context,this._renderSurface,t,this.size)},destroy:function(){this.surfaceImpl.destroy(this.context,this._renderSurface),this._renderSurface=null}},{DefaultAttachments:function(){return[{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]},SupportFormat:function(t){return bg.Engine.Get().colorBuffer.supportFormat(t)},SupportType:function(t){return bg.Engine.Get().colorBuffer.supportType(t)},MaxColorAttachments:function(){return bg.Engine.Get().textureBuffer.maxColorAttachments}},t)}(bg.app.ContextObject);bg.base.RenderSurface=e,bg.base.RenderSurfaceType={RGBA:null,DEPTH:null},bg.base.RenderSurfaceFormat={UNSIGNED_BYTE:null,UNSIGNED_SHORT:null,FLOAT:null,RENDERBUFFER:null};var n=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{get surfaceImpl(){return bg.Engine.Get().colorBuffer}},{MaxColorAttachments:function(){return bg.Engine.Get().colorBuffer.maxColorAttachments}},t)}(e);bg.base.ColorSurface=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{get surfaceImpl(){return bg.Engine.Get().textureBuffer},getTexture:function(){var t=void 0!==arguments[0]?arguments[0]:0;return this._renderSurface.attachments[t]&&this._renderSurface.attachments[t].texture}},{MaxColorAttachments:function(){return bg.Engine.Get().textureBuffer.maxColorAttachments}},t)}(e);bg.base.TextureSurface=i}(),function(){function t(t){Reflect.defineProperty(t,"all",{get:function(){if(!this._all){this._all=[];for(var e in t)"object"==$traceurRuntime.typeof(t[e])&&t[e].name&&this._all.push(t[e])}return this._all}})}var e=null,n=function(){function n(){var e=bg[bg.Engine.Get().id].shaderLibrary;for(var n in e)this[n]=e[n];t(this.inputs.matrix),Object.defineProperty(this.inputs.matrix,"modelViewProjection",{get:function(){return[this.model,this.view,this.projection]}}),t(this.inputs.material),t(this.inputs.lighting),t(this.inputs.shadows),t(this.inputs.colorCorrection),t(this.functions.materials),t(this.functions.colorCorrection),t(this.functions.lighting),t(this.functions.utils)}return $traceurRuntime.createClass(n,{},{Get:function(){return e||(e=new n),e}})}();bg.base.ShaderLibrary=n;var i=function(){function t(){}return $traceurRuntime.createClass(t,{header:function(t){return""},parameter:function(t,e){return e.name},func:function(t,e){return e.name}},{})}();bg.base.ShaderSourceImpl=i;var r=function(){function t(t){this._type=t,this._params=[],this._functions=[],this._requiredExtensions=[],this._header=""}return $traceurRuntime.createClass(t,{get type(){return this._type},get params(){return this._params},get header(){return this._header},get functions(){return this._functions},addParameter:function(t){t instanceof Array?this._params=$traceurRuntime.spread(this._params,t):this._params.push(t),this._params.push(null)},addFunction:function(t){
t instanceof Array?this._functions=$traceurRuntime.spread(this._functions,t):this._functions.push(t)},setMainBody:function(t){this.addFunction({returnType:"void",name:"main",params:{},body:t})},appendHeader:function(t){this._header+=t+"\n"},toString:function(){var t=this,e=bg.Engine.Get().shaderSource,n=e.header(this.type)+"\n"+this._header+"\n\n";return this.params.forEach(function(i){n+=e.parameter(t.type,i)+"\n"}),this.functions.forEach(function(i){n+="\n"+e.func(t.type,i)+"\n"}),n}},{FormatSource:function(t){var e="",n=t.replace(/^\n*/,"").replace(/\n*$/,"").split("\n"),i=100;return n.forEach(function(t){var e=/(\t*)/.exec(t)[0].length;i>e&&(i=e)}),n.forEach(function(t){var n=/(\t*)/.exec(t)[0].length,r=n-i;e+=t.slice(n-r,t.length)+"\n"}),e.replace(/^\n*/,"").replace(/\n*$/,"")}})}();bg.base.ShaderSource=r}(),function(){function t(t){var e="";return t.split("\n").forEach(function(t,n){++n,e+=(n<10?"00":n<100?"0":"")+n+" | "+t+"\n"}),e}var e=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){},setActive:function(t,e){},create:function(t){},addShaderSource:function(t,e,n,i){},link:function(t,e){},initVars:function(t,e,n,i){},setInputBuffer:function(t,e,n,i,r){},setValueInt:function(t,e,n,i){},setValueFloat:function(t,e,n,i){},setValueVector2:function(t,e,n,i){},setValueVector3:function(t,e,n,i){},setValueVector4:function(t,e,n,i){},setValueVector2v:function(t,e,n,i){},setValueVector3v:function(t,e,n,i){},setValueVector4v:function(t,e,n,i){},setValueMatrix3:function(t,e,n,i,r){},setValueMatrix4:function(t,e,n,i,r){},setTexture:function(t,e,n,i,r){}},{})}();bg.base.ShaderImpl=e,bg.base.ShaderType={VERTEX:null,FRAGMENT:null};var n=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._shader=bg.Engine.Get().shader.create(t),this._linked=!1,this._compileError=null,this._linkError=null}return $traceurRuntime.createClass(n,{get shader(){return this._shader},get compileError(){return this._compileError},get compileErrorSource(){return this._compileErrorSource},get linkError(){return this._linkError},get status(){return null==this._compileError&&null==this._linkError},addShaderSource:function(e,n){return this._linked?this._compileError="Tying to attach a shader to a linked program":this._compileError||(this._compileError=bg.Engine.Get().shader.addShaderSource(this.context,this._shader,e,n),this._compileError&&(this._compileErrorSource=t(n))),null==this._compileError},link:function(){return this._linkError=null,this._linked?this._linkError="Shader already linked":(this._linkError=bg.Engine.Get().shader.link(this.context,this._shader),this._linked=null==this._linkError),this._linked},setActive:function(){bg.Engine.Get().shader.setActive(this.context,this._shader)},clearActive:function(){n.ClearActive(this.context)},initVars:function(t,e){bg.Engine.Get().shader.initVars(this.context,this._shader,t,e)},setInputBuffer:function(t,e,n){bg.Engine.Get().shader.setInputBuffer(this.context,this._shader,t,e,n)},disableInputBuffer:function(t){bg.Engine.Get().shader.disableInputBuffer(this.context,this._shader,t)},setValueInt:function(t,e){bg.Engine.Get().shader.setValueInt(this.context,this._shader,t,e)},setValueFloat:function(t,e){bg.Engine.Get().shader.setValueFloat(this.context,this._shader,t,e)},setVector2:function(t,e){bg.Engine.Get().shader.setValueVector2(this.context,this._shader,t,e)},setVector3:function(t,e){bg.Engine.Get().shader.setValueVector3(this.context,this._shader,t,e)},setVector4:function(t,e){bg.Engine.Get().shader.setValueVector4(this.context,this._shader,t,e)},setVector2Ptr:function(t,e){bg.Engine.Get().shader.setValueVector2v(this.context,this._shader,t,e)},setVector3Ptr:function(t,e){bg.Engine.Get().shader.setValueVector3v(this.context,this._shader,t,e)},setVector4Ptr:function(t,e){bg.Engine.Get().shader.setValueVector4v(this.context,this._shader,t,e)},setMatrix3:function(t,e){var n=void 0!==arguments[2]&&arguments[2];bg.Engine.Get().shader.setValueMatrix3(this.context,this._shader,t,n,e)},setMatrix4:function(t,e){var n=void 0!==arguments[2]&&arguments[2];bg.Engine.Get().shader.setValueMatrix4(this.context,this._shader,t,n,e)},setTexture:function(t,e,n){bg.Engine.Get().shader.setTexture(this.context,this._shader,t,e,n)}},{ClearActive:function(t){bg.Engine.Get().shader.setActive(t,null)}},e)}(bg.app.ContextObject);bg.base.Shader=n}(),function(){function t(){return bg.base.ShaderLibrary.Get()}function e(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,null,t().inputs.matrix.model,t().inputs.matrix.view,t().inputs.matrix.projection,null,{name:"fsTexCoord",dataType:"vec2",role:"out"}]),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\tfsTexCoord = inTex0;\n\t\t\t\t")),i}function n(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),r.addParameter([t().inputs.material.castShadows,t().inputs.material.texture,t().inputs.material.textureOffset,t().inputs.material.textureScale,t().inputs.material.alphaCutoff,null,{name:"fsTexCoord",dataType:"vec2",role:"in"}]),r.addFunction(t().functions.utils.pack),r.addFunction(t().functions.materials.samplerColor),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\n\t\t\t\tfloat alpha = samplerColor(inTexture,fsTexCoord,inTextureOffset,inTextureScale).a;\n\t\t\t\tif (inCastShadows && alpha>inAlphaCutoff) {\n\t\t\t\t\tgl_FragColor = pack(gl_FragCoord.z);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdiscard;\n\t\t\t\t}")),r}var i=null,r=null,a=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._material=null,this._light=null,this._lightTransform=null,this.setupShaderSource([e(),n()])}return $traceurRuntime.createClass(i,{get material(){return this._material},set material(t){this._material=t},get light(){return this._light},set light(t){this._light=t},get lightTransform(){return this._lightTransform},set lightTransform(t){this._lightTransform=t},setupVars:function(){if(this.material&&this.light&&this.lightTransform){var t=bg.base.MatrixState.Current();this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",this.lightTransform),this.shader.setMatrix4("inProjectionMatrix",this.light.projection),this.shader.setValueInt("inCastShadows",this.material.castShadows);var e=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context);this.shader.setTexture("inTexture",e,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setValueFloat("inAlphaCutoff",this.material.alphaCutoff)}}},{},t)}(bg.base.Effect);bg.base.ShadowMapEffect=a,bg.base.ShadowType={HARD:0,SOFT:1,STRATIFIED:2};var s=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._pipeline=new bg.base.Pipeline(t),this._pipeline.renderSurface=new bg.base.TextureSurface(t),this._pipeline.renderSurface.create(),this._pipeline.effect=new bg.base.ShadowMapEffect(t),this._matrixState=new bg.base.MatrixState,this._drawVisitor=new bg.scene.DrawVisitor(this._pipeline,this._matrixState),this._shadowMapSize=new bg.Vector2(2048),this._pipeline.viewport=new bg.Viewport(0,0,this._shadowMapSize.width,this._shadowMapSize.height),this._shadowType=bg.base.ShadowType.SOFT,this._projection=bg.Matrix4.Ortho(-15,15,-15,15,1,50),this._viewMatrix=bg.Matrix4.Identity(),this._shadowColor=bg.Color.Black()}return $traceurRuntime.createClass(e,{get size(){return this._shadowMapSize},set size(t){this._shadowMapSize=t,this._pipeline.viewport=new bg.Viewport(0,0,t.width,t.height)},get shadowType(){return this._shadowType},set shadowType(t){this._shadowType=t},get shadowColor(){return this._shadowColor},set shadowColor(t){this._shadowColor=t},get viewMatrix(){return this._viewMatrix},get projection(){return this._projection},get texture(){return this._pipeline.renderSurface.getTexture(0)},update:function(t,e,n,i){var r=bg.base.MatrixState.Current();if(bg.base.MatrixState.SetCurrent(this._matrixState),this._pipeline.effect.light=n,this._viewMatrix=new bg.Matrix4(i),n.type==bg.base.LightType.DIRECTIONAL){var a=this._viewMatrix.rotation,s=e.transform.matrix.position,o=new bg.Matrix4(e.transform.matrix),u=s.add(o.forwardVector.scale(-e.focus));window.camera=e,window.cameraTransform=e.transform.matrix,this._viewMatrix.identity().translate(u).mult(a).translate(0,0,10).invert(),n.projection=bg.Matrix4.Ortho(-e.focus,e.focus,-e.focus,e.focus,1,300*e.focus)}this._projection=n.projection,this._pipeline.effect.lightTransform=this._viewMatrix,bg.base.Pipeline.SetCurrent(this._pipeline),this._pipeline.clearBuffers(bg.base.ClearBuffers.COLOR_DEPTH),t.accept(this._drawVisitor),bg.base.MatrixState.SetCurrent(r)}},{},t)}(bg.app.ContextObject);bg.base.ShadowMap=s}(),function(){var t={},e=8,n=function(){function n(t){this._context=t,this._textures={}}return $traceurRuntime.createClass(n,{find:function(t){return this._textures[t]},register:function(t,e){e instanceof bg.base.Texture&&(this._textures[t]=e)},unregister:function(t){this._textures[t]&&delete this._textures[t]},clear:function(){this._textures={}}},{SetColorTextureSize:function(t){e=t},GetColorTextureSize:function(){return e},WhiteTexture:function(t){var i=n.Get(t),r=i.find("static-white-color-texture");return r||(r=bg.base.Texture.WhiteTexture(t,new bg.Vector2(e)),i.register("static-white-color-texture",r)),r},BlackTexture:function(t){var i=n.Get(t),r=i.find("static-black-color-texture");return r||(r=bg.base.Texture.BlackTexture(t,new bg.Vector2(e)),i.register("static-black-color-texture",r)),r},NormalTexture:function(t){var i=n.Get(t),r=i.find("static-normal-color-texture");return r||(r=bg.base.Texture.NormalTexture(t,new bg.Vector2(e)),i.register("static-normal-color-texture",r)),r},RandomTexture:function(t){var e=n.Get(t),i=e.find("static-random-color-texture");return i||(i=bg.base.Texture.RandomTexture(t,new bg.Vector2(64)),e.register("static-random-color-texture",i)),i},Get:function(e){return t[e.uuid]||(t[e.uuid]=new n(e)),t[e.uuid]}})}();bg.base.TextureCache=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{acceptType:function(t,e){return bg.utils.Resource.IsImage(t)},load:function(t,e,n){return new Promise(function(i,r){if(n){var a=bg.base.TextureCache.Get(t).find(e);a||(bg.log("Texture "+e+" not found. Loading texture"),a=new bg.base.Texture(t),a.create(),a.bind(),a.minFilter=bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST,a.magFilter=bg.base.TextureFilter.LINEAR,a.setImage(n),a.fileName=e,bg.base.TextureCache.Get(t).register(e,a)),i(a)}else r(new Error("Error loading texture image data"))})}},{},t)}(bg.base.LoaderPlugin);bg.base.TextureLoaderPlugin=i;var r=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{acceptType:function(t,e){return bg.utils.Resource.IsVideo(t)},load:function(t,e,n){return new Promise(function(i,r){if(n){var a=new bg.base.Texture(t);a.create(),a.bind(),a.setVideo(n),a.fileName=e,i(a)}else r(new Error("Error loading video texture data"))})}},{},t)}(bg.base.LoaderPlugin);bg.base.VideoTextureLoaderPlugin=r}(),function(){bg.base.TextureUnit={TEXTURE_0:0,TEXTURE_1:1,TEXTURE_2:2,TEXTURE_3:3,TEXTURE_4:4,TEXTURE_5:5,TEXTURE_6:6,TEXTURE_7:7,TEXTURE_8:8,TEXTURE_9:9,TEXTURE_10:10,TEXTURE_11:11,TEXTURE_12:12,TEXTURE_13:13,TEXTURE_14:14,TEXTURE_15:15,TEXTURE_16:16,TEXTURE_17:17,TEXTURE_18:18,TEXTURE_19:19,TEXTURE_20:20,TEXTURE_21:21,TEXTURE_22:22,TEXTURE_23:23,TEXTURE_24:24,TEXTURE_25:25,TEXTURE_26:26,TEXTURE_27:27,TEXTURE_28:28,TEXTURE_29:29,TEXTURE_30:30},bg.base.TextureWrap={REPEAT:null,CLAMP:null},bg.base.TextureFilter={NEAREST_MIPMAP_NEAREST:null,LINEAR_MIPMAP_NEAREST:null,NEAREST_MIPMAP_LINEAR:null,LINEAR_MIPMAP_LINEAR:null,NEAREST:null,LINEAR:null},bg.base.TextureTarget={TEXTURE_2D:null,CUBE_MAP:null,POSITIVE_X_FACE:null,NEGATIVE_X_FACE:null,POSITIVE_Y_FACE:null,NEGATIVE_Y_FACE:null,POSITIVE_Z_FACE:null,NEGATIVE_Z_FACE:null};var t=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){console.log("TextureImpl: initFlags() method not implemented")},create:function(t){return console.log("TextureImpl: create() method not implemented"),null},setActive:function(t,e){console.log("TextureImpl: setActive() method not implemented")},bind:function(t,e,n){console.log("TextureImpl: bind() method not implemented")},unbind:function(t,e){console.log("TextureImpl: unbind() method not implemented")},setTextureWrapX:function(t,e,n,i){console.log("TextureImpl: setTextureWrapX() method not implemented")},setTextureWrapY:function(t,e,n,i){console.log("TextureImpl: setTextureWrapY() method not implemented")},setImage:function(t,e,n,i,r,a,s){console.log("TextureImpl: setImage() method not implemented")},setImageRaw:function(t,e,n,i,r,a,s,o){console.log("TextureImpl: setImageRaw() method not implemented")},setVideo:function(t,e,n,i,r){console.log("TextureImpl: setVideo() method not implemented")},updateVideoData:function(t,e,n,i){console.log("TextureImpl: updateVideoData() method not implemented")},destroy:function(t,e){console.log("TextureImpl: destroy() method not implemented")}},{})}();bg.base.TextureImpl=t;var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._texture=null,this._fileName="",this._size=new bg.Vector2(0),this._target=bg.base.TextureTarget.TEXTURE_2D,this._minFilter=bg.base.TextureFilter.LINEAR,this._magFilter=bg.base.TextureFilter.LINEAR,this._wrapX=bg.base.TextureWrap.REPEAT,this._wrapY=bg.base.TextureWrap.REPEAT,this._video=null}return $traceurRuntime.createClass(e,{get texture(){return this._texture},get target(){return this._target},set target(t){this._target=t},get fileName(){return this._fileName},set fileName(t){this._fileName=t},set minFilter(t){this._minFilter=t},set magFilter(t){this._magFilter=t},get minFilter(){return this._minFilter},get magFilter(){return this._magFilter},set wrapX(t){this._wrapX=t},set wrapY(t){this._wrapY=t},get wrapX(){return this._wrapX},get wrapY(){return this._wrapY},get size(){return this._size},get video(){return this._video},create:function(){null!==this._texture&&this.destroy(),this._texture=bg.Engine.Get().texture.create(this.context)},setActive:function(t){bg.Engine.Get().texture.setActive(this.context,t)},bind:function(){bg.Engine.Get().texture.bind(this.context,this._target,this._texture)},unbind:function(){e.Unbind(this.context,this._target)},setImage:function(t,e){void 0===e&&(e=!0),this._size.width=t.width,this._size.height=t.height,bg.Engine.Get().texture.setTextureWrapX(this.context,this._target,this._texture,this._wrapX),bg.Engine.Get().texture.setTextureWrapY(this.context,this._target,this._texture,this._wrapY),bg.Engine.Get().texture.setImage(this.context,this._target,this._minFilter,this._magFilter,this._texture,t,e)},setImageRaw:function(t,e,n,i,r){i||(i=this.context.RGBA),r||(r=this.context.UNSIGNED_BYTE),this._size.width=t,this._size.height=e,bg.Engine.Get().texture.setTextureWrapX(this.context,this._target,this._texture,this._wrapX),bg.Engine.Get().texture.setTextureWrapY(this.context,this._target,this._texture,this._wrapY),bg.Engine.Get().texture.setImageRaw(this.context,this._target,this._minFilter,this._magFilter,this._texture,t,e,n,i,r)},setVideo:function(t,e){void 0===e&&(e=!0),this._size.width=t.videoWidth,this._size.height=t.videoHeight,bg.Engine.Get().texture.setVideo(this.context,this._target,this._texture,t,e),this._video=t},destroy:function(){bg.Engine.Get().texture.destroy(this.context,this._texture),this._texture=null,this._minFilter=null,this._magFilter=null,this._fileName=""},valid:function(){return null!==this._texture},update:function(){bg.Engine.Get().texture.updateVideoData(this.context,this._target,this._texture,this._video)}},{ColorTexture:function(t,e,n){var i=new bg.base.Texture(t);i.create(),i.bind();for(var r=n.width*n.height*4,a=[],s=0;s<r;s+=4)a[s]=255*e.r,a[s+1]=255*e.g,a[s+2]=255*e.b,a[s+3]=255*e.a;return a=new Uint8Array(a),i.minFilter=bg.base.TextureFilter.NEAREST,i.magFilter=bg.base.TextureFilter.NEAREST,i.setImageRaw(n.width,n.height,a),i.unbind(),i},WhiteTexture:function(t,n){return e.ColorTexture(t,bg.Color.White(),n)},NormalTexture:function(t,n){return e.ColorTexture(t,new bg.Color(.5,.5,1,1),n)},BlackTexture:function(t,n){return e.ColorTexture(t,bg.Color.Black(),n)},RandomTexture:function(t,e){var n=new bg.base.Texture(t);n.create(),n.bind();for(var i=e.width*e.height*4,r=[],a=0;a<i;a+=4){var s=new bg.Vector3(2*bg.Math.random()-1,2*bg.Math.random()-1,0);s.normalize(),r[a]=255*s.x,r[a+1]=255*s.y,r[a+2]=255*s.z,r[a+3]=1}return r=new Uint8Array(r),n.minFilter=bg.base.TextureFilter.NEAREST,n.magFilter=bg.base.TextureFilter.NEAREST,n.setImageRaw(e.width,e.height,r),n.unbind(),n},SetActive:function(t,e){bg.Engine.Get().texture.setActive(t,e)},Unbind:function(t,e){e||(e=bg.base.TextureTarget.TEXTURE_2D),bg.Engine.Get().texture.unbind(t,e)}},t)}(bg.app.ContextObject);bg.base.Texture=e}(),function(){bg.Math={PI:3.141592653589793,DEG_TO_RAD:.01745329251994,RAD_TO_DEG:57.29577951308233,PI_2:1.5707963267948966,PI_4:.785398163397448,TWO_PI:6.283185307179586,EPSILON:1e-7,Array:Float32Array,FLOAT_MAX:3.402823e38,checkZero:function(t){return t>-this.EPSILON&&t<this.EPSILON?0:t},equals:function(t,e){return Math.abs(t-e)<this.EPSILON},degreesToRadians:function(t){return Math.fround(this.checkZero(t*this.DEG_TO_RAD))},radiansToDegrees:function(t){return Math.fround(this.checkZero(t*this.RAD_TO_DEG))},sin:function(t){return Math.fround(this.checkZero(Math.sin(t)))},cos:function(t){return Math.fround(this.checkZero(Math.cos(t)))},tan:function(t){return Math.fround(this.checkZero(Math.tan(t)))},cotan:function(t){return Math.fround(this.checkZero(1/this.tan(t)))},atan:function(t){return Math.fround(this.checkZero(Math.atan(t)))},atan2:function(t,e){return Math.fround(this.checkZero(Math.atan2f(t,e)))},random:function(){return Math.random()},max:function(t,e){return Math.fround(Math.max(t,e))},min:function(t,e){return Math.fround(Math.min(t,e))},abs:function(t){return Math.fround(Math.abs(t))},sqrt:function(t){return Math.fround(Math.sqrt(t))},lerp:function(t,e,n){return Math.fround((1-n)*t+n*e)},square:function(t){return Math.fround(t*t)}};var t=function(){function t(t){this._target=t}return $traceurRuntime.createClass(t,{get target(){return this._target},set target(t){this._target=t},apply:function(){console.log("WARNING: MatrixStrategy::apply() not overloaded by the child class.")}},{})}();bg.MatrixStrategy=t}(),function(){var t=function(){function t(){var t=void 0!==arguments[0]?arguments[0]:1,e=void 0!==arguments[1]?arguments[1]:0,n=void 0!==arguments[2]?arguments[2]:0,i=void 0!==arguments[3]?arguments[3]:0,r=void 0!==arguments[4]?arguments[4]:1,a=void 0!==arguments[5]?arguments[5]:0,s=void 0!==arguments[6]?arguments[6]:0,o=void 0!==arguments[7]?arguments[7]:0,u=void 0!==arguments[8]?arguments[8]:1;this._m=new bg.Math.Array(9),"number"==typeof t?(this._m[0]=t,this._m[1]=e,this._m[2]=n,this._m[3]=i,this._m[4]=r,this._m[5]=a,this._m[6]=s,this._m[7]=o,this._m[8]=u):this.assign(t)}return $traceurRuntime.createClass(t,{get m(){return this._m},get m00(){return this._m[0]},get m01(){return this._m[1]},get m02(){return this._m[2]},get m10(){return this._m[3]},get m11(){return this._m[4]},get m12(){return this._m[5]},get m20(){return this._m[6]},get m21(){return this._m[7]},get m22(){return this._m[8]},set m00(t){this._m[0]=t},set m01(t){this._m[1]=t},set m02(t){this._m[2]=t},set m10(t){this._m[3]=t},set m11(t){this._m[4]=t},set m12(t){this._m[5]=t},set m20(t){this._m[6]=t},set m21(t){this._m[7]=t},set m22(t){this._m[8]=t},zero:function(){return this._m[0]=this._m[1]=this._m[2]=this._m[3]=this._m[4]=this._m[5]=this._m[6]=this._m[7]=this._m[8]=0,this},identity:function(){return this._m[0]=1,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=1,this._m[5]=0,this._m[6]=0,this._m[7]=0,this._m[8]=1,this},isZero:function(){return 0==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&0==this._m[4]&&0==this._m[5]&&0==this._m[6]&&0==this._m[7]&&0==this._m[8]},isIdentity:function(){return 1==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&1==this._m[4]&&0==this._m[5]&&0==this._m[6]&&0==this._m[7]&&1==this._m[8]},row:function(t){return new bg.Vector3(this._m[3*t],this._m[3*t+1],this._m[3*t+2])},setRow:function(t,e){return this._m[3*t]=e._v[0],this._m[3*t+1]=e._v[1],this._m[3*t+2]=e._v[2],this},get length(){return this._m.length},traspose:function(){var t=new bg.Vector3(this._m[0],this._m[3],this._m[6]),e=new bg.Vector3(this._m[1],this._m[4],this._m[7]),n=new bg.Vector3(this._m[2],this._m[5],this._m[8]);return this.setRow(0,t),this.setRow(1,e),this.setRow(2,n),this},elemAtIndex:function(t){return this._m[t]},assign:function(t){return 9==t.length?(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=t._m[3],this._m[4]=t._m[4],this._m[5]=t._m[5],this._m[6]=t._m[6],this._m[7]=t._m[7],this._m[8]=t._m[8]):16==t.length&&(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=t._m[4],this._m[4]=t._m[5],this._m[5]=t._m[6],this._m[6]=t._m[8],this._m[7]=t._m[9],this._m[8]=t._m[10]),this},equals:function(t){return this._m[0]==t._m[0]&&this._m[1]==t._m[1]&&this._m[2]==t._m[2]&&this._m[3]==t._m[3]&&this._m[4]==t._m[4]&&this._m[5]==t._m[5]&&this._m[6]==t._m[6]&&this._m[7]==t._m[7]&&this._m[8]==t._m[8]},notEquals:function(t){return this._m[0]!=t._m[0]||this._m[1]!=t._m[1]||this._m[2]!=t._m[2]&&this._m[3]!=t._m[3]||this._m[4]!=t._m[4]||this._m[5]!=t._m[5]&&this._m[6]!=t._m[6]||this._m[7]!=t._m[7]||this._m[8]!=t._m[8]},mult:function(t){if("number"==typeof t)this._m[0]*=t,this._m[1]*=t,this._m[2]*=t,this._m[3]*=t,this._m[4]*=t,this._m[5]*=t,this._m[6]*=t,this._m[7]*=t,this._m[8]*=t;else{var e=this._m,n=t._m,i=new bg.Math.Array(9);i[0]=n[0]*e[0]+n[1]*e[1]+n[2]*e[2],i[1]=n[0]*e[1]+n[1]*e[4]+n[2]*e[7],i[2]=n[0]*e[2]+n[1]*e[5]+n[2]*e[8],i[3]=n[3]*e[0]+n[4]*e[3]+n[5]*e[6],i[4]=n[3]*e[1]+n[4]*e[4]+n[5]*e[7],i[5]=n[3]*e[2]+n[4]*e[5]+n[5]*e[8],i[6]=n[6]*e[0]+n[7]*e[3]+n[8]*e[6],i[7]=n[6]*e[1]+n[7]*e[4]+n[8]*e[7],i[8]=n[6]*e[2]+n[7]*e[5]+n[8]*e[8],this._m=i}return this},isNan:function(){return!(Math.isNaN(_m[0])||Math.isNaN(_m[1])||Math.isNaN(_m[2])||Math.isNaN(_m[3])||Math.isNaN(_m[4])||Math.isNaN(_m[5])||Math.isNaN(_m[6])||Math.isNaN(_m[7])||Math.isNaN(_m[8]))},toString:function(){return"["+this._m[0]+", "+this._m[1]+", "+this._m[2]+"]\n ["+this._m[3]+", "+this._m[4]+", "+this._m[5]+"]\n ["+this._m[6]+", "+this._m[7]+", "+this._m[8]+"]"}},{Identity:function(){return new bg.Matrix3(1,0,0,0,1,0,0,0,1)}})}();bg.Matrix3=t;var e=function(){function t(){var t=void 0!==arguments[0]?arguments[0]:0,e=void 0!==arguments[1]?arguments[1]:0,n=void 0!==arguments[2]?arguments[2]:0,i=void 0!==arguments[3]?arguments[3]:0,r=void 0!==arguments[4]?arguments[4]:0,a=void 0!==arguments[5]?arguments[5]:0,s=void 0!==arguments[6]?arguments[6]:0,o=void 0!==arguments[7]?arguments[7]:0,u=void 0!==arguments[8]?arguments[8]:0,l=void 0!==arguments[9]?arguments[9]:0,c=void 0!==arguments[10]?arguments[10]:0,h=void 0!==arguments[11]?arguments[11]:0,f=void 0!==arguments[12]?arguments[12]:0,d=void 0!==arguments[13]?arguments[13]:0,g=void 0!==arguments[14]?arguments[14]:0,m=void 0!==arguments[15]?arguments[15]:0;this._m=new bg.Math.Array(16),"number"==typeof t?(this._m[0]=t,this._m[1]=e,this._m[2]=n,this._m[3]=i,this._m[4]=r,this._m[5]=a,this._m[6]=s,this._m[7]=o,this._m[8]=u,this._m[9]=l,this._m[10]=c,this._m[11]=h,this._m[12]=f,this._m[13]=d,this._m[14]=g,this._m[15]=m):this.assign(t)}return $traceurRuntime.createClass(t,{get m(){return this._m},get m00(){return this._m[0]},get m01(){return this._m[1]},get m02(){return this._m[2]},get m03(){return this._m[3]},get m10(){return this._m[4]},get m11(){return this._m[5]},get m12(){return this._m[6]},get m13(){return this._m[7]},get m20(){return this._m[8]},get m21(){return this._m[9]},get m22(){return this._m[10]},get m23(){return this._m[11]},get m30(){return this._m[12]},get m31(){return this._m[13]},get m32(){return this._m[14]},get m33(){return this._m[15]},set m00(t){this._m[0]=t},set m01(t){this._m[1]=t},set m02(t){this._m[2]=t},set m03(t){this._m[3]=t},set m10(t){this._m[4]=t},set m11(t){this._m[5]=t},set m12(t){this._m[6]=t},set m13(t){this._m[7]=t},set m20(t){this._m[8]=t},set m21(t){this._m[9]=t},set m22(t){this._m[10]=t},set m23(t){this._m[11]=t},set m30(t){this._m[12]=t},set m31(t){this._m[13]=t},set m32(t){this._m[14]=t},set m33(t){this._m[15]=t},zero:function(){return this._m[0]=0,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=0,this._m[5]=0,this._m[6]=0,this._m[7]=0,this._m[8]=0,this._m[9]=0,this._m[10]=0,this._m[11]=0,this._m[12]=0,this._m[13]=0,this._m[14]=0,this._m[15]=0,this},identity:function(){return this._m[0]=1,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=0,this._m[5]=1,this._m[6]=0,this._m[7]=0,this._m[8]=0,this._m[9]=0,this._m[10]=1,this._m[11]=0,this._m[12]=0,this._m[13]=0,this._m[14]=0,this._m[15]=1,this},isZero:function(){return 0==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&0==this._m[4]&&0==this._m[5]&&0==this._m[6]&&0==this._m[7]&&0==this._m[8]&&0==this._m[9]&&0==this._m[10]&&0==this._m[11]&&0==this._m[12]&&0==this._m[13]&&0==this._m[14]&&0==this._m[15]},isIdentity:function(){return 1==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&0==this._m[4]&&1==this._m[5]&&0==this._m[6]&&0==this._m[7]&&0==this._m[8]&&0==this._m[9]&&1==this._m[10]&&0==this._m[11]&&0==this._m[12]&&0==this._m[13]&&0==this._m[14]&&1==this._m[15]},row:function(t){return new bg.Vector4(this._m[4*t],this._m[4*t+1],this._m[4*t+2],this._m[4*t+3])},setRow:function(t,e){return this._m[4*t]=e._v[0],this._m[4*t+1]=e._v[1],this._m[4*t+2]=e._v[2],this._m[4*t+3]=e._v[3],this},get length(){return this._m.length},getMatrix3:function(){return new bg.Matrix3(this._m[0],this._m[1],this._m[2],this._m[4],this._m[5],this._m[6],this._m[8],this._m[9],this._m[10])},perspective:function(t,e,n,i){return this.assign(bg.Matrix4.Perspective(t,e,n,i)),this},frustum:function(t,e,n,i,r,a){return this.assign(bg.Matrix4.Frustum(t,e,n,i,r,a)),this},ortho:function(t,e,n,i,r,a){return this.assign(bg.Matrix4.Ortho(t,e,n,i,r,a)),this},lookAt:function(t,e,n){return this.assign(bg.Matrix4.LookAt(t,e,n)),this},translate:function(t,e,n){return this.mult(bg.Matrix4.Translation(t,e,n)),this},rotate:function(t,e,n,i){return this.mult(bg.Matrix4.Rotation(t,e,n,i)),this},scale:function(t,e,n){return this.mult(bg.Matrix4.Scale(t,e,n)),this},elemAtIndex:function(t){return this._m[t]},assign:function(t){return 9==t.length?(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=0,this._m[4]=t._m[3],this._m[5]=t._m[4],this._m[6]=t._m[5],this._m[7]=0,this._m[8]=t._m[6],this._m[9]=t._m[7],this._m[10]=t._m[8],this._m[11]=0,this._m[12]=0,this._m[13]=0,this._m[14]=0,this._m[15]=1):16==t.length&&(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=t._m[3],this._m[4]=t._m[4],this._m[5]=t._m[5],this._m[6]=t._m[6],this._m[7]=t._m[7],this._m[8]=t._m[8],this._m[9]=t._m[9],this._m[10]=t._m[10],this._m[11]=t._m[11],this._m[12]=t._m[12],this._m[13]=t._m[13],this._m[14]=t._m[14],this._m[15]=t._m[15]),this},equals:function(t){return this._m[0]==t._m[0]&&this._m[1]==t._m[1]&&this._m[2]==t._m[2]&&this._m[3]==t._m[3]&&this._m[4]==t._m[4]&&this._m[5]==t._m[5]&&this._m[6]==t._m[6]&&this._m[7]==t._m[7]&&this._m[8]==t._m[8]&&this._m[9]==t._m[9]&&this._m[10]==t._m[10]&&this._m[11]==t._m[11]&&this._m[12]==t._m[12]&&this._m[13]==t._m[13]&&this._m[14]==t._m[14]&&this._m[15]==t._m[15]},notEquals:function(t){return this._m[0]!=t._m[0]||this._m[1]!=t._m[1]||this._m[2]!=t._m[2]||this._m[3]!=t._m[3]||this._m[4]!=t._m[4]||this._m[5]!=t._m[5]||this._m[6]!=t._m[6]||this._m[7]!=t._m[7]||this._m[8]!=t._m[8]||this._m[9]!=t._m[9]||this._m[10]!=t._m[10]||this._m[11]!=t._m[11]||this._m[12]!=t._m[12]||this._m[13]!=t._m[13]||this._m[14]!=t._m[14]||this._m[15]!=t._m[15]},mult:function(t){if("number"==typeof t)return this._m[0]*=t,this._m[1]*=t,this._m[2]*=t,this._m[3]*=t,this._m[4]*=t,this._m[5]*=t,this._m[6]*=t,this._m[7]*=t,this._m[8]*=t,this._m[9]*=t,this._m[10]*=t,this._m[11]*=t,this._m[12]*=t,this._m[13]*=t,this._m[14]*=t,this._m[15]*=t,this;var e=this._m,n=t._m,i=new bg.Math.Array(16);return i[0]=n[0]*e[0]+n[1]*e[4]+n[2]*e[8]+n[3]*e[12],i[1]=n[0]*e[1]+n[1]*e[5]+n[2]*e[9]+n[3]*e[13],i[2]=n[0]*e[2]+n[1]*e[6]+n[2]*e[10]+n[3]*e[14],i[3]=n[0]*e[3]+n[1]*e[7]+n[2]*e[11]+n[3]*e[15],i[4]=n[4]*e[0]+n[5]*e[4]+n[6]*e[8]+n[7]*e[12],i[5]=n[4]*e[1]+n[5]*e[5]+n[6]*e[9]+n[7]*e[13],i[6]=n[4]*e[2]+n[5]*e[6]+n[6]*e[10]+n[7]*e[14],i[7]=n[4]*e[3]+n[5]*e[7]+n[6]*e[11]+n[7]*e[15],i[8]=n[8]*e[0]+n[9]*e[4]+n[10]*e[8]+n[11]*e[12],i[9]=n[8]*e[1]+n[9]*e[5]+n[10]*e[9]+n[11]*e[13],i[10]=n[8]*e[2]+n[9]*e[6]+n[10]*e[10]+n[11]*e[14],i[11]=n[8]*e[3]+n[9]*e[7]+n[10]*e[11]+n[11]*e[15],i[12]=n[12]*e[0]+n[13]*e[4]+n[14]*e[8]+n[15]*e[12],i[13]=n[12]*e[1]+n[13]*e[5]+n[14]*e[9]+n[15]*e[13],i[14]=n[12]*e[2]+n[13]*e[6]+n[14]*e[10]+n[15]*e[14],i[15]=n[12]*e[3]+n[13]*e[7]+n[14]*e[11]+n[15]*e[15],this._m=i,this},multVector:function(t){"object"==$traceurRuntime.typeof(t)&&t._v&&t._v.length>=3&&(t=t._v);var e=t[0],n=t[1],i=t[2];return new bg.Vector4(this._m[0]*e+this._m[4]*n+this._m[8]*i+1*this._m[12],this._m[1]*e+this._m[5]*n+this._m[9]*i+1*this._m[13],this._m[2]*e+this._m[6]*n+this._m[10]*i+1*this._m[14],this._m[3]*e+this._m[7]*n+this._m[11]*i+1*this._m[15])},invert:function(){var t=this._m[0],e=this._m[1],n=this._m[2],i=this._m[3],r=this._m[4],a=this._m[5],s=this._m[6],o=this._m[7],u=this._m[8],l=this._m[9],c=this._m[10],h=this._m[11],f=this._m[12],d=this._m[13],g=this._m[14],m=this._m[15],p=t*a-e*r,b=t*s-n*r,_=t*o-i*r,v=e*s-n*a,y=e*o-i*a,E=n*o-i*s,T=u*d-l*f,x=u*g-c*f,S=u*m-h*f,w=l*g-c*d,M=l*m-h*d,C=c*m-h*g,R=p*C-b*M+_*w+v*S-y*x+E*T;return R?(R=1/R,this._m[0]=(a*C-s*M+o*w)*R,this._m[1]=(n*M-e*C-i*w)*R,this._m[2]=(d*E-g*y+m*v)*R,this._m[3]=(c*y-l*E-h*v)*R,this._m[4]=(s*S-r*C-o*x)*R,this._m[5]=(t*C-n*S+i*x)*R,this._m[6]=(g*_-f*E-m*b)*R,this._m[7]=(u*E-c*_+h*b)*R,this._m[8]=(r*M-a*S+o*T)*R,this._m[9]=(e*S-t*M-i*T)*R,this._m[10]=(f*y-d*_+m*p)*R,this._m[11]=(l*_-u*y-h*p)*R,this._m[12]=(a*x-r*w-s*T)*R,this._m[13]=(t*w-e*x+n*T)*R,this._m[14]=(d*b-f*v-g*p)*R,this._m[15]=(u*v-l*b+c*p)*R,this):(this.zero(),this)},traspose:function(){var t=new bg.Vector4(this._m[0],this._m[4],this._m[8],this._m[12]),e=new bg.Vector4(this._m[1],this._m[5],this._m[9],this._m[13]),n=new bg.Vector4(this._m[2],this._m[6],this._m[10],this._m[14]),i=new bg.Vector4(this._m[3],this._m[7],this._m[11],this._m[15]);return this.setRow(0,t),this.setRow(1,e),this.setRow(2,n),this.setRow(3,i),this},get rotation(){return new bg.Matrix4(this._m[0],this._m[1],this._m[2],0,this._m[4],this._m[5],this._m[6],0,this._m[8],this._m[9],this._m[10],0,0,0,0,1)},get position(){return new bg.Vector3(this._m[12],this._m[13],this._m[14])},transformDirection:function(t){var e=new bg.Vector3(t),n=new bg.Matrix4(this);return n.setRow(3,new bg.Vector4(0,0,0,1)),e.assign(n.multVector(e).xyz),e.normalize(),e},get forwardVector(){return this.transformDirection(new bg.Vector3(0,0,1))},get rightVector(){return this.transformDirection(new bg.Vector3(1,0,0))},get upVector(){return this.transformDirection(new bg.Vector3(0,1,0))},get backwardVector(){return this.transformDirection(new bg.Vector3(0,0,-1))},get leftVector(){return this.transformDirection(new bg.Vector3(-1,0,0))},get downVector(){return this.transformDirection(new bg.Vector3(0,-1,0))},isNan:function(){
return Number.isNaN(this._m[0])||Number.isNaN(this._m[1])||Number.isNaN(this._m[2])||Number.isNaN(this._m[3])||Number.isNaN(this._m[4])||Number.isNaN(this._m[5])||Number.isNaN(this._m[6])||Number.isNaN(this._m[7])||Number.isNaN(this._m[8])||Number.isNaN(this._m[9])||Number.isNaN(this._m[10])||Number.isNaN(this._m[11])||Number.isNaN(this._m[12])||Number.isNaN(this._m[13])||Number.isNaN(this._m[14])||Number.isNaN(this._m[15])},getOrthoValues:function(){return[(1+get23())/get22(),-(1-get23())/get22(),(1-get13())/get11(),-(1+get13())/get11(),-(1+get03())/get00(),(1-get03())/get00()]},getPerspectiveValues:function(){return[get23()/(get22()-1),get23()/(get22()+1),near*(get12()-1)/get11(),near*(get12()+1)/get11(),near*(get02()-1)/get00(),near*(get02()+1)/get00()]},toString:function(){return"["+this._m[0]+", "+this._m[1]+", "+this._m[2]+", "+this._m[3]+"]\n ["+this._m[4]+", "+this._m[5]+", "+this._m[6]+", "+this._m[7]+"]\n ["+this._m[8]+", "+this._m[9]+", "+this._m[10]+", "+this._m[11]+"]\n ["+this._m[12]+", "+this._m[13]+", "+this._m[14]+", "+this._m[15]+"]"}},{Unproject:function(t,e,n,i,r,a){var s=new bg.Matrix4(r);s.mult(i),s.invert();var o=new bg.Vector4((t-a.y)/a.width*2-1,(e-a.x)/a.height*2-1,2*n-1,1),u=new bg.Vector4(s.multVector(o));return 0==u.z?u.set(0):u.set(u.x/u.w,u.y/u.w,u.z/u.w,u.w/u.w),u},Identity:function(){return new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},Perspective:function(t,e,n,i){var r=bg.Math.tan(t*bg.Math.PI/360)*n,a=r*e;return bg.Matrix4.Frustum(-a,a,-r,r,n,i)},Frustum:function(t,e,n,i,r,a){var s=new bg.Matrix4,o=e-t,u=i-n,l=a-r;return s.setRow(0,new bg.Vector4(2*r/o,0,0,0)),s.setRow(1,new bg.Vector4(0,2*r/u,0,0)),s.setRow(2,new bg.Vector4((e+t)/o,(i+n)/u,-(a+r)/l,-1)),s.setRow(3,new bg.Vector4(0,0,-a*r*2/l,0)),s},Ortho:function(t,e,n,i,r,a){var s=new bg.Matrix4,o=e-t,u=i-n,l=a-r;return s._m[0]=2/o,s._m[1]=0,s._m[2]=0,s._m[3]=0,s._m[4]=0,s._m[5]=2/u,s._m[6]=0,s._m[7]=0,s._m[8]=0,s._m[9]=0,s._m[10]=-2/l,s._m[11]=0,s._m[12]=-(t+e)/o,s._m[13]=-(i+n)/u,s._m[14]=-(a+r)/l,s._m[15]=1,s},LookAt:function(t,e,n){var i=new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),r=new bg.Vector3(e);r.sub(t);var a=new bg.Vector3(n);r.normalize();var s=new bg.Vector3(r);return s.cross(a),a.assign(s),a.cross(r),i.set00(s.x),i.set10(s.y),i.set20(s.z),i.set01(a.x),i.set11(a.y),i.set21(a.z),i.set02(-r.x),i.set12(-r.y),i.set22(-r.z),i.setRow(3,new vwgl.Vector4(-t.x,-t.y,-t.z,1)),i},Translation:function(t,e,n){return"object"==$traceurRuntime.typeof(t)&&t._v&&t._v.length>=3&&(e=t._v[1],n=t._v[2],t=t._v[0]),new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,t,e,n,1)},Rotation:function(t,e,n,i){var r=new bg.Vector3(e,n,i);r.normalize();var a=(new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),bg.Math.cos(t)),s=1-a,o=bg.Math.sin(t);return new bg.Matrix4(r.x*r.x*s+a,r.x*r.y*s+r.z*o,r.x*r.z*s-r.y*o,0,r.y*r.x*s-r.z*o,r.y*r.y*s+a,r.y*r.z*s+r.x*o,0,r.z*r.x*s+r.y*o,r.z*r.y*s-r.x*o,r.z*r.z*s+a,0,0,0,0,1)},Scale:function(t,e,n){return"object"==$traceurRuntime.typeof(t)&&t._v&&t._v.length>=3&&(t=t._v[0],e=t._v[1],n=t._v[2]),new bg.Matrix4(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1)}})}();bg.Matrix4=e}(),function(){var t=function(){function t(t){this._v=t}return $traceurRuntime.createClass(t,{get v(){return this._v},get length(){return this._v.length},get x(){return this._v[0]},set x(t){this._v[0]=t},get y(){return this._v[1]},set y(t){this._v[1]=t},magnitude:function(){for(var t=0,e=0;e<this._v.length;++e){var n=this._v[e];t+=bg.Math.square(n)}return bg.Math.sqrt(t)}},{MinComponents:function(t,e){var n=Math.min(t.length,e.length),i=null;switch(n){case 2:i=new bg.Vector2;break;case 3:i=new bg.Vector3;break;case 4:i=new bg.Vector4}for(var r=0;r<n;++r)i._v[r]=t._v[r]<e._v[r]?t._v[r]:e._v[r];return i},MaxComponents:function(t,e){var n=Math.min(t.length,e.length),i=null;switch(n){case 2:i=new bg.Vector2;break;case 3:i=new bg.Vector3;break;case 4:i=new bg.Vector4}for(var r=0;r<n;++r)i._v[r]=t._v[r]>e._v[r]?t._v[r]:e._v[r];return i}})}();bg.VectorBase=t,bg.Vector=t;var e=function(t){function e(){var t=void 0!==arguments[0]?arguments[0]:0,n=arguments[1];$traceurRuntime.superConstructor(e).call(this,new bg.Math.Array(2)),t instanceof e?(this._v[0]=t._v[0],this._v[1]=t._v[1]):(void 0===n&&(n=t),this._v[0]=t,this._v[1]=n)}return $traceurRuntime.createClass(e,{distance:function(t){return new bg.Vector2(this._v[0]-t._v[0],this._v[1]-t._v[1]).magnitude()},normalize:function(){var t=this.magnitude();return this._v[0]=this._v[0]/t,this._v[1]=this._v[1]/t,this},add:function(t){return this._v[0]+=t._v[0],this._v[1]+=t._v[1],this},sub:function(t){return this._v[0]-=t._v[0],this._v[1]-=t._v[1],this},dot:function(t){return this._v[0]*t._v[0]+this._v[1]*t._v[1]},scale:function(t){return this._v[0]*=t,this._v[1]*=t,this},elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1]},set:function(t,e){void 0===e&&(e=t),this._v[0]=t,this._v[1]=e},get width(){return this._v[0]},get height(){return this._v[1]},set width(t){this._v[0]=t},set height(t){this._v[1]=t},get aspectRatio(){return this._v[0]/this._v[1]},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])},toString:function(){return"["+this._v+"]"}},{Add:function(t,n){return new e(t.x+n.x,t.y+n.y)},Sub:function(t,n){return new e(t.x-n.x,t.y-n.y)}},t)}(t);bg.Vector2=e;var n=function(t){function n(){var t=void 0!==arguments[0]?arguments[0]:0,i=void 0!==arguments[1]?arguments[1]:0,r=void 0!==arguments[2]?arguments[2]:0;$traceurRuntime.superConstructor(n).call(this,new bg.Math.Array(3)),t instanceof e?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=i):t instanceof n?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2]):(void 0===i&&(i=t),void 0===r&&(r=i),this._v[0]=t,this._v[1]=i,this._v[2]=r)}return $traceurRuntime.createClass(n,{get z(){return this._v[2]},set z(t){this._v[2]=t},normalize:function(){var t=this.magnitude();return this._v[0]=this._v[0]/t,this._v[1]=this._v[1]/t,this._v[2]=this._v[2]/t,this},distance:function(t){return new bg.Vector3(this._v[0]-t._v[0],this._v[1]-t._v[1],this._v[2]-t._v[2]).magnitude()},add:function(t){return this._v[0]+=t._v[0],this._v[1]+=t._v[1],this._v[2]+=t._v[2],this},sub:function(t){return this._v[0]-=t._v[0],this._v[1]-=t._v[1],this._v[2]-=t._v[2],this},dot:function(t){return this._v[0]*t._v[0]+this._v[1]*t._v[1]+this._v[2]*t._v[2]},scale:function(t){return this._v[0]*=t,this._v[1]*=t,this._v[2]*=t,this},cross:function(t){var e=this._v[1]*t._v[2]-this._v[2]*t._v[1],n=this._v[2]*t._v[0]-this._v[0]*t._v[2],i=this._v[0]*t._v[1]-this._v[1]*t._v[0];return this._v[0]=e,this._v[1]=n,this._v[2]=i,this},elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]&&this._v[2]==t._v[2]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]||this._v[2]!=t._v[2]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],t._v.length>=3&&(this._v[2]=t._v[2])},set:function(t,e,n){this._v[0]=t,this._v[1]=void 0===e?t:e,this._v[2]=void 0===e?t:void 0===n?e:n},get width(){return this._v[0]},get height(){return this._v[1]},get depth(){return this._v[2]},set width(t){this._v[0]=t},set height(t){this._v[1]=t},set depth(t){this._v[2]=t},get xy(){return new bg.Vector2(this._v[0],this._v[1])},get yz(){return new bg.Vector2(this._v[1],this._v[2])},get xz(){return new bg.Vector2(this._v[0],this._v[2])},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])||isNaN(this._v[2])},toString:function(){return"["+this._v+"]"}},{Add:function(t,e){return new n(t.x+e.x,t.y+e.y,t.z+e.z)},Sub:function(t,e){return new n(t.x-e.x,t.y-e.y,t.z-e.z)}},t)}(t);bg.Vector3=n;var i=function(t){function i(){var t=void 0!==arguments[0]?arguments[0]:0,r=void 0!==arguments[1]?arguments[1]:0,a=void 0!==arguments[2]?arguments[2]:0,s=void 0!==arguments[3]?arguments[3]:0;$traceurRuntime.superConstructor(i).call(this,new bg.Math.Array(4)),t instanceof e?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=r,this._v[3]=a):t instanceof n?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=r):t instanceof i?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=t._v[3]):(void 0===r&&(r=t),void 0===a&&(a=r),void 0===s&&(s=a),this._v[0]=t,this._v[1]=r,this._v[2]=a,this._v[3]=s)}return $traceurRuntime.createClass(i,{get z(){return this._v[2]},set z(t){this._v[2]=t},get w(){return this._v[3]},set w(t){this._v[3]=t},normalize:function(){var t=this.magnitude();return this._v[0]=this._v[0]/t,this._v[1]=this._v[1]/t,this._v[2]=this._v[2]/t,this._v[3]=this._v[3]/t,this},distance:function(t){return new bg.Vector4(this._v[0]-t._v[0],this._v[1]-t._v[1],this._v[2]-t._v[2],this._v[3]-t._v[3]).magnitude()},add:function(t){return this._v[0]+=t._v[0],this._v[1]+=t._v[1],this._v[2]+=t._v[2],this._v[3]+=t._v[3],this},sub:function(t){return this._v[0]-=t._v[0],this._v[1]-=t._v[1],this._v[2]-=t._v[2],this._v[3]-=t._v[3],this},dot:function(t){return this._v[0]*t._v[0]+this._v[1]*t._v[1]+this._v[2]*t._v[2]+this._v[3]*t._v[3]},scale:function(t){return this._v[0]*=t,this._v[1]*=t,this._v[2]*=t,this._v[3]*=t,this},elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]&&this._v[2]==t._v[2]&&this._v[3]==t._v[3]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]||this._v[2]!=t._v[2]||this._v[3]!=t._v[3]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],t._v.length>=3&&(this._v[2]=t._v[2]),4==t._v.length&&(this._v[3]=t._v[3])},set:function(t,e,n,i){this._v[0]=t,this._v[1]=void 0===e?t:e,this._v[2]=void 0===e?t:void 0===n?e:n,this._v[3]=void 0===e?t:void 0===n?e:void 0===i?n:i},get r(){return this._v[0]},get g(){return this._v[1]},get b(){return this._v[2]},get a(){return this._v[3]},set r(t){this._v[0]=t},set g(t){this._v[1]=t},set b(t){this._v[2]=t},set a(t){this._v[3]=t},get xy(){return new bg.Vector2(this._v[0],this._v[1])},get yz(){return new bg.Vector2(this._v[1],this._v[2])},get xz(){return new bg.Vector2(this._v[0],this._v[2])},get xyz(){return new bg.Vector3(this._v[0],this._v[1],this._v[2])},get width(){return this._v[2]},get height(){return this._v[3]},set width(t){this._v[2]=t},set height(t){this._v[3]=t},get aspectRatio(){return 0!=this._v[3]?this._v[2]/this._v[3]:1},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])||isNaN(this._v[2])||isNaN(this._v[3])},toString:function(){return"["+this._v+"]"}},{Add:function(t,e){return new i(t.x+e.x,t.y+e.y,t.z+e.z,t.w+e.w)},Sub:function(t,e){return new i(t.x-e.x,t.y-e.y,t.z-e.z,t.w-e.w)},Yellow:function(){return new bg.Vector4(1,1,0,1)},Orange:function(){return new bg.Vector4(1,.5,0,1)},Red:function(){return new bg.Vector4(1,0,0,1)},Violet:function(){return new bg.Vector4(.5,0,1,1)},Blue:function(){return new bg.Vector4(0,0,1,1)},Green:function(){return new bg.Vector4(0,1,0,1)},White:function(){return new bg.Vector4(1,1,1,1)},LightGray:function(){return new bg.Vector4(.8,.8,.8,1)},Gray:function(){return new bg.Vector4(.5,.5,.5,1)},DarkGray:function(){return new bg.Vector4(.2,.2,.2,1)},Black:function(){return new bg.Vector4(0,0,0,1)},Brown:function(){return new bg.Vector4(.4,.2,0,1)},Transparent:function(){return new bg.Vector4(0,0,0,0)}},t)}(t);bg.Vector4=i,bg.Size2D=e,bg.Size3D=n,bg.Position2D=e,bg.Viewport=i,bg.Color=i;var r=function(t){function e(){var t=void 0!==arguments[0]?arguments[0]:0,n=void 0!==arguments[1]?arguments[1]:0,i=void 0!==arguments[2]?arguments[2]:0,r=void 0!==arguments[3]?arguments[3]:0,a=void 0!==arguments[4]?arguments[4]:0,s=void 0!==arguments[5]?arguments[5]:0;$traceurRuntime.superConstructor(e).call(this,new bg.Math.Array(6)),this._v[0]=t,this._v[1]=n,this._v[2]=i,this._v[3]=r,this._v[4]=a,this._v[5]=s}return $traceurRuntime.createClass(e,{elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]&&this._v[2]==t._v[2]&&this._v[3]==t._v[3]&&this._v[4]==t._v[4]&&this._v[5]==t._v[5]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]||this._v[2]!=t._v[2]||this._v[3]!=t._v[3]||this._v[4]!=t._v[4]||this._v[5]!=t._v[5]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=t._v[3],this._v[4]=t._v[4],this._v[5]=t._v[5]},set:function(t,e,n,i,r,a){this._v[0]=t,this._v[1]=void 0===e?t:e,this._v[2]=void 0===e?t:n,this._v[3]=void 0===e?t:i,this._v[4]=void 0===e?t:r,this._v[5]=void 0===e?t:a},get left(){return this._v[0]},get right(){return this._v[1]},get bottom(){return this._v[2]},get top(){return this._v[3]},get back(){return this._v[4]},get front(){return this._v[5]},set left(t){this._v[0]=t},set right(t){this._v[1]=t},set bottom(t){this._v[2]=t},set top(t){this._v[3]=t},set back(t){this._v[4]=t},set front(t){this._v[5]=t},get width(){return Math.abs(this._v[1]-this._v[0])},get height(){return Math.abs(this._v[3]-this._v[2])},get depth(){return Math.abs(this._v[5]-this._v[4])},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])||isNaN(this._v[2])||isNaN(this._v[3])||isNaN(this._v[4])||isNaN(this._v[5])},toString:function(){return"["+this._v+"]"},isInBounds:function(t){return t.x>=this._v[0]&&t.x<=this._v[1]&&t.y>=this._v[2]&&t.y<=this._v[3]&&t.z>=this._v[4]&&t.z<=this._v[5]}},{},t)}(t);bg.Bounds=r;var a=function(t){function e(t,n,i,r){$traceurRuntime.superConstructor(e).call(this),void 0===t?this.zero():void 0===n?t._v&&t._v.lenght>=4?this.clone(t):t._m&&9==t._m.length?this.initWithMatrix3(t):t._m&&16==t._m.length?this.initWithMatrix4(t):this.zero():void 0!==t&&void 0!==n&&void 0!==i&&void 0!==r?this.initWithValues(t,n,i,r):this.zero()}return $traceurRuntime.createClass(e,{initWithValues:function(t,e,n,i){return this._v[0]=e*bg.Math.sin(t/2),this._v[1]=n*bg.Math.sin(t/2),this._v[2]=i*bg.Math.sin(t/2),this._v[3]=bg.Math.cos(t/2),this},clone:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=t._v[3]},initWithMatrix3:function(t){var e=bg.Math.sqrt(1+t._m[0]+t._m[4]+t._m[8])/2,n=4*e;this._v[0]=(t._m[7]-t._m[5])/e,this._v[1]=(t._m[2]-t._m[6])/n,this._v[2]=(t._m[3]-t._m[1])/n,this._v[3]=e},initWithMatrix4:function(t){var e=bg.Math.sqrt(1+t._m[0]+t._m[5]+t._m[10])/2,n=4*e;this._v[0]=(t._m[9]-t._m[6])/e,this._v[1]=(t._m[2]-t._m[8])/n,this._v[2]=(t._m[4]-t._m[1])/n,this._v[3]=e},getMatrix4:function(){var t=bg.Matrix4.Identity(),e=this._v;return t.setRow(0,new bg.Vector4(1-2*e[1]*e[1]-2*e[2]*e[2],2*e[0]*e[1]-2*e[2]*e[3],2*e[0]*e[2]+2*e[1]*e[3],0)),t.setRow(1,new bg.Vector4(2*e[0]*e[1]+2*e[2]*e[3],1-2*e[0]*e[0]-2*e[2]*e[2],2*e[1]*e[2]-2*e[0]*e[3],0)),t.setRow(2,new bg.Vector4(2*e[0]*e[2]-2*e[1]*e[3],2*e[1]*e[2]+2*e[0]*e[3],1-2*e[0]*e[0]-2*e[1]*e[1],0)),t},getMatrix3:function(){var t=bg.Matrix3.Identity(),e=this._v;return t.setRow(0,new bg.Vector3(1-2*e[1]*e[1]-2*e[2]*e[2],2*e[0]*e[1]-2*e[2]*e[3],2*e[0]*e[2]+2*e[1]*e[3])),t.setRow(1,new bg.Vector3(2*e[0]*e[1]+2*e[2]*e[3],1-2*e[0]*e[0]-2*e[2]*e[2],2*e[1]*e[2]-2*e[0]*e[3])),t.setRow(2,new bg.Vector3(2*e[0]*e[2]-2*e[1]*e[3],2*e[1]*e[2]+2*e[0]*e[3],1-2*e[0]*e[0]-2*e[1]*e[1])),t}},{MakeWithMatrix:function(t){return new e(t)}},t)}(i);bg.Quaternion=a}(),bg.physics={},function(){bg.physics.IntersectionType={NONE:0,POINT:1,LLINE:2};var t=function(){function t(){this._type=null,this._p0=null,this._p1=null}return $traceurRuntime.createClass(t,{get type(){return this._type},get point(){return this._p0},get endPoint(){return this._p1},intersects:function(){return!1}},{RayToPlane:function(t,e){return new bg.physics.RayToPlaneIntersection(t,e)}})}();bg.physics.Intersection=t;var e=function(t){function e(t,n){$traceurRuntime.superConstructor(e).call(this),this._ray=null,this._p0=null,this._type=bg.physics.IntersectionType.POINT;var i=new bg.Vector3(n.origin),r=new bg.Vector3(n.normal),a=new bg.Vector3(t.start),s=new bg.Vector3(t.vector),o=i.sub(a).dot(r),u=s.dot(r);if(0!=u){var l=o/u;l>t.magnitude||(this._ray=bg.physics.Ray.RayWithVector(t.vector,t.start,l),this._p0=this._ray.end)}}return $traceurRuntime.createClass(e,{get ray(){return this._ray},intersects:function(){return null!=this._ray&&null!=this._p0}},{},t)}(bg.physics.Intersection);bg.physics.RayToPlaneIntersection=e}(),function(){var t=function(){function t(){this._transform=bg.Matrix4.Identity()}return $traceurRuntime.createClass(t,{get transform(){return this._transform},set transform(t){this._transform=t},applyTransform:function(t){},calculateTransform:function(){}},{})}();bg.physics.Joint=t,bg.physics.LinkTransformOrder={TRANSLATE_ROTATE:1,ROTATE_TRANSLATE:0};var e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._offset=new bg.Vector3,this._eulerRotation=new bg.Vector3,this._transformOrder=bg.physics.LinkTransformOrder.TRANSLATE_ROTATE}return $traceurRuntime.createClass(e,{applyTransform:function(t){t.mult(this.transform)},assign:function(t){this.yaw=t.yaw,this.pitch=t.pitch,this.roll=t.roll,this.offset.assign(t.offset),this.transformOrder=t.transformOrder},get offset(){return this._offset},set offset(t){this._offset=t,this.calculateTransform()},get eulerRotation(){return this._eulerRotation},set eulerRotation(t){this._eulerRotation=t,this.calculateTransform()},get yaw(){return this._eulerRotation.x},get pitch(){return this._eulerRotation.y},get roll(){return this._eulerRotation.z},set yaw(t){this._eulerRotation.x=t,this.calculateTransform()},set pitch(t){this._eulerRotation.y=t,this.calculateTransform()},set roll(t){this._eulerRotation.z=t,this.calculateTransform()},get transformOrder(){return this._transformOrder},set transformOrder(t){this._transformOrder=t,this.calculateTransform()},multTransform:function(t){switch(this.transformOrder){case bg.physics.LinkTransformOrder.TRANSLATE_ROTATE:t.translate(this.offset.x,this.offset.y,this.offset.z),this.multRotation(t);break;case bg.physics.LinkTransformOrder.TRANSLATE_ROTATE:this.multRotation(t),t.translate(this.offset.x,this.offset.y,this.offset.z)}},multRotation:function(t){t.rotate(this.eulerRotation.z,0,0,1).rotate(this.eulerRotation.y,0,1,0).rotate(this.eulerRotation.x,1,0,0)},calculateTransform:function(){this.transform.identity(),this.multTransform(this.transform)},deserialize:function(t){}},{},t)}(t);bg.physics.LinkJoint=e}(),function(){var t=function(){function t(t,e,n){if(t=t instanceof bg.Vector3&&t,e=e instanceof bg.Vector3&&e,n=n instanceof bg.Vector3&&n,t&&!e)this._normal=new bg.Vector3(t),this._origin=new bg.Vector3(0);else if(t&&e&&!n)this._normal=new bg.Vector3(t),this._origin=new bg.Vector3(e);else if(t&&e&&n){var i=new bg.Vector3(t);i.sub(e);var r=new bg.Vector3(n);r.sub(t),this._origin=new bg.Vector3(p1),this._normal=new bg.Vector3(i),this._normal.cross(r).normalize()}else this._origin=new bg.Vector3(0),this._normal=new bg.Vector3(0,1,0)}return $traceurRuntime.createClass(t,{get normal(){return this._normal},set normal(t){this._normal.assign(t)},get origin(){return this._origin},set origin(t){this._origin.assign(t)},toString:function(){return"P0: "+this._origin.toString()+", normal:"+this._normal.toString()},valid:function(){return!this._origin.isNan()&&!this._normal.isNan()},assign:function(t){return this._origin.assign(t._origin),this._normal.assign(t._normal),this},equals:function(t){return this._origin.equals(t._origin)&&this._normal.equals(t._normal)}},{})}();bg.physics.Plane=t}(),function(){function t(t){t._vector=new bg.Vector3(t._end),t._vector.sub(t._start),t._magnitude=t._vector.magnitude(),t._vector.normalize()}var e=function(){function e(e,n){this._start=e||new bg.Vector3,this._end=n||new bg.Vector3(1),t(this)}return $traceurRuntime.createClass(e,{setWithPoints:function(e,n){return this._start.assign(e),this._end.assign(n),t(),this},setWithVector:function(e,n,i){this._start.assign(n),this._end.assign(n);var r=new bg.Vector3(e);return r.normalize().scale(i),this._end.add(r),t(this),this},setWithScreenPoint:function(e,n,i,r){var a=bg.Matrix4.Unproject(e.x,e.y,0,i,n,r),s=bg.Matrix4.Unproject(e.x,e.y,1,i,n,r);return this._start=a.xyz,this._end=s.xyz,t(this),this},assign:function(t){this._start.assign(t.start),this._end.assign(t.end),this._vector.assign(t.vector),this._magnitude.assign(t.magnitude)},get start(){return this._start},set start(e){this._start.assign(e),t(this)},get end(){return this._end},set end(t){this._end.assign(t)},get vector(){return this._vector},get magnitude(){return this._magnitude},toString:function(){return"start: "+this.start.toString()+", end: "+this.end.toString()}},{RayWithPoints:function(t,n){return new e(t,n)},RayWithVector:function(t,n,i){var r=new e;return r.setWithVector(t,n,i),r},RayWithScreenPoint:function(t,n,i,r){var a=new e;return a.setWithScreenPoint(t,n,i,r),a}})}();bg.physics.Ray=e}(),bg.scene={},function(){var t={},e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._node=null}return $traceurRuntime.createClass(e,{clone:function(){return bg.log("WARNING: Component with typeid "+this.typeId+" does not implmement the clone() method."),null},get node(){return this._node},get typeId(){return this._typeId},removedFromNode:function(t){},addedToNode:function(t){},deserialize:function(t){},component:function(t){return this._node&&this._node.component(t)},get camera(){return this.component("bg.scene.Camera")},get chain(){return this.component("bg.scene.Chain")},get drawable(){return this.component("bg.scene.Drawable")},get inputJoint(){return this.component("bg.scene.InputJoint")},get outputJoint(){return this.component("bg.scene.OutputJoint")},get light(){return this.component("bg.scene.Light")},get transform(){return this.component("bg.scene.Transform")}},{Factory:function(t){}},t)}(bg.LifeCycle);bg.scene.Component=e,bg.scene.registerComponent=function(e,n,i){var r=/function (.+)\(/.exec(n.toString()),a=r&&r.length>1?r[1]:"";e[a]=n,n.prototype._typeId=i||a,t[n]=n}}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._context=t}return $traceurRuntime.createClass(e,{get context(){return this._context},set context(t){this._context=t}},{},t)}(bg.LifeCycle),e=function(t){function e(t){var n=void 0!==arguments[1]?arguments[1]:"";$traceurRuntime.superConstructor(e).call(this,t),this._name=n,this._enabled=!0,this._components={}}return $traceurRuntime.createClass(e,{cloneComponents:function(){var t=new bg.scene.Node(this.context,this.name?"copy of "+this.name:"");t.enabled=this.enabled,forEachComponent(function(e){t.addComponent(e.clone())})},get name(){return this._name},set name(t){this._name=t},get enabled(){return this._enabled},set enabled(t){this._enabled=t},addComponent:function(t){t._node&&t._node.removeComponent(t),t._node=this,this._components[t.typeId]=t,t.addedToNode(this)},removeComponent:function(t){var e="",n=null;return"string"==typeof t?(e=t,n=this.component(t)):t instanceof bg.scene.Component&&(n=t,e=t.typeId),this._components[e]==n&&null!=n&&(delete this._components[e],n.removedFromNode(this),!0)},component:function(t){return this._components[t]},forEachComponent:function(t){var e=Object.keys(this._components),n=!0,i=!1,r=void 0;try{for(var a=void 0,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;t(this._components[o],o,this._components)}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}},someComponent:function(t){var e=Object.keys(this._components),n=!0,i=!1,r=void 0;try{for(var a=void 0,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;if(t(this._components[o],o,this._components))return!0}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return!1},everyComponent:function(t){var e=Object.keys(this._components),n=!0,i=!1,r=void 0;try{for(var a=void 0,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;if(!t(this._components[o],o,this._components))return!1}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return!0},destroy:function(){var t=this;this.forEachComponent(function(e){e.removedFromNode(t)}),this._components={}},init:function(){this.forEachComponent(function(t){t.init()})},frame:function(t){this.forEachComponent(function(e){e._initialized_||(e.init(),e._initialized_=!0),e.frame(t)})},willDisplay:function(t,e){this.forEachComponent(function(n){n.willDisplay(t,e)})},display:function(t,e){this.forEachComponent(function(n){n.display(t,e)})},didDisplay:function(t,e){this.forEachComponent(function(n){n.didDisplay(t,e)})},reshape:function(t,e,n,i){this.forEachComponent(function(t){t.reshape(n,i)})},keyDown:function(t){this.forEachComponent(function(e){e.keyDown(t)})},keyUp:function(t){this.forEachComponent(function(e){e.keyUp(t)})},mouseUp:function(t){this.forEachComponent(function(e){e.mouseUp(t)})},mouseDown:function(t){this.forEachComponent(function(e){e.mouseDown(t)})},mouseMove:function(t){this.forEachComponent(function(e){e.mouseMove(t)})},mouseOut:function(t){this.forEachComponent(function(e){e.mouseOut(t)})},mouseDrag:function(t){this.forEachComponent(function(e){e.mouseDrag(t)})},mouseWheel:function(t){this.forEachComponent(function(e){e.mouseWheel(t)})},touchStart:function(t){this.forEachComponent(function(e){e.touchStart(t)})},touchMove:function(t){this.forEachComponent(function(e){e.touchMove(t)})},touchEnd:function(t){this.forEachComponent(function(e){e.touchEnd(t)})}},{},t)}(t);bg.scene.SceneObject=e}(),function(){function t(e,n){return!(!e||!n)&&(e._parent==n||t(e._parent,n))}var e=function(e){function n(t){var e=void 0!==arguments[1]?arguments[1]:"";$traceurRuntime.superConstructor(n).call(this,t,e),this._children=[],this._parent=null}return $traceurRuntime.createClass(n,{addChild:function(t){t&&!this.isAncientOf(t)&&t!=this&&(t.parent&&t.parent.removeChild(t),this._children.push(t),t._parent=this)},removeChild:function(t){var e=this._children.indexOf(t);e>=0&&this._children.splice(e,1)},get children(){return this._children},get parent(){return this._parent},get sceneRoot(){return this._parent?this._parent.sceneRoot():this},haveChild:function(t){return-1!=this._children.indexOf(t)},isAncientOf:function(e){t(this,e)},accept:function(t){t.visit(this),this._children.forEach(function(e){e.accept(t)}),t.didVisit(this)},acceptReverse:function(t){this._parent&&this._parent.acceptReverse(t),t.visit(this)},destroy:function(){$traceurRuntime.superGet(this,n.prototype,"destroy").call(this),this._children.forEach(function(t){t.destroy()}),this._children=[]}},{},e)}(bg.scene.SceneObject);bg.scene.Node=e;var n=function(){function t(){}return $traceurRuntime.createClass(t,{visit:function(t){},didVisit:function(t){}},{})}();bg.scene.NodeVisitor=n}(),function(){var t=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._near=.1,this._far=100,this._viewport=new bg.Viewport(0,0,512,512)}return $traceurRuntime.createClass(i,{clone:function(){console.log("WARNING: ProjectionStrategy::clone() method not implemented by child class.")},get near(){return this._near},set near(t){this._near=t,apply()},get far(){return this._far},set far(t){this._far=t},get viewport(){return this._viewport},set viewport(t){this._viewport=t}},{Factory:function(t){var i=null;return t&&("PerspectiveProjectionMethod"==t.type?i=new e:"OpticalProjectionMethod"==t.type&&(i=new n),i&&i.deserialize(t)),i}},t)}(bg.MatrixStrategy);bg.scene.ProjectionStrategy=t;var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._fov=60}return $traceurRuntime.createClass(e,{clone:function(){var t=new e;return t.near=this.near,t.far=this.far,t.viewport=this.viewport,t.fov=this.fov,t},get fov(){return this._fov},set fov(t){this._fov=t},apply:function(){this.target&&this.target.perspective(this.fov,this.viewport.aspectRatio,this.near,this.far)},deserialize:function(t){this.near=t.near,this.far=t.far,this.fov=t.fov}},{},t)}(t);bg.scene.PerspectiveProjectionStrategy=e;var n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._focalLength=50,this._frameSize=35}return $traceurRuntime.createClass(e,{clone:function(){var t=new e;return t.near=this.near,t.far=this.far,t.viewport=this.viewport,t.focalLength=this.focalLength,t.frameSize=this.frameSize,t},get focalLength(){return this._focalLength},set focalLength(t){this._focalLength=t},get frameSize(){return this._frameSize},set frameSize(t){this._frameSize=t},apply:function(){if(this.target){var t=2*bg.Math.atan(this.frameSize/(this.focalLength/2));t=bg.Math.radiansToDegrees(t),this.target.perspective(t,this.viewport.aspectRatio,this.near,this.far)}},deserialize:function(t){this.frameSize=t.frameSize,this.focalLength=t.focalLength,this.near=t.near,this.far=t.far}},{},t)}(t);bg.scene.OpticalProjectionStrategy=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._projection=bg.Matrix4.Perspective(60,1,.1,100),this._viewport=new bg.Viewport(0,0,512,512),this._visitor=new bg.scene.TransformVisitor,this._rebuildTransform=!0,this._clearBuffers=bg.base.ClearBuffers.COLOR_DEPTH,this._focus=5,this._projectionStrategy=null}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.Camera;return t._projection=new bg.Matrix4(this._projection),t._viewport=new bg.Matrix4(this._viewport),t._projectionStrategy=this._projectionStrategy?this._projectionStrategy.clone():null,t},get projection(){return this._projection},set projection(t){this._projectionStrategy||(this._projection=t)},get viewport(){return this._viewport},set viewport(t){this._viewport=t,this._projectionStrategy&&(this._projectionStrategy.viewport=t,this._projectionStrategy.apply())},get focus(){return this._focus},set focus(t){this._focus=t},get projectionStrategy(){return this._projectionStrategy},set projectionStrategy(t){this._projectionStrategy=t,this._projectionStrategy&&(this._projectionStrategy.target=this._projection)},get clearBuffers(){return this._clearBuffers},set clearBuffers(t){this._clearBuffers=t},get modelMatrix(){return this._rebuildTransform&&this.node&&(this._visitor.matrix.identity(),this.node.acceptReverse(this._visitor),this._rebuildTransform=!1),this._visitor.matrix},get viewMatrix(){return this._viewMatrix&&!this._rebuildTransform||(this._viewMatrix=new bg.Matrix4(this.modelMatrix),this._viewMatrix.invert()),this._viewMatrix},frame:function(t){this._rebuildTransform=!0}},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,i,"bg.scene.Camera")}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).call(this)}return $traceurRuntime.createClass(e,{clone:function(){return new bg.scene.Chain},willDisplay:function(t,e){if(this.node){var n=bg.Matrix4.Identity();this.node.children.forEach(function(t){var e=t.component("bg.scene.Transform"),i=t.component("bg.scene.InputChainJoint"),r=t.component("bg.scene.OutputChainJoint");i?i.joint.applyTransform(n):n.identity(),e&&e.matrix.assign(n),r&&r.joint.applyTransform(n)})}},deserialize:function(t){}},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,t,"bg.scene.Chain");var e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._joint=new bg.physics.LinkJoint}return $traceurRuntime.createClass(e,{get joint(){return this._joint},set joint(t){this._joint=t},deserialize:function(t){}},{},t)}(bg.scene.Component);bg.scene.ChainJoint=e;var n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),t?this.joint=t:this.joint.transformOrder=bg.physics.LinkTransformOrder.ROTATE_TRANSLATE}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.InputChainJoint;return t.joint.assign(this.joint),t}},{},t)}(e);bg.scene.registerComponent(bg.scene,n,"bg.scene.InputChainJoint");var i=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),t?this.joint=t:this.joint.transformOrder=bg.physics.LinkTransformOrder.TRANSLATE_ROTATE}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.OutputChainJoint;return t.joint.assign(this.joint),t}},{},t)}(e)
;bg.scene.registerComponent(bg.scene,i,"bg.scene.OutputChainJoint")}(),function(){var t=function(t){function e(){var t=void 0!==arguments[0]?arguments[0]:"";$traceurRuntime.superConstructor(e).call(this),this._name=t,this._items=[]}return $traceurRuntime.createClass(e,{get name(){return this._name},set name(t){this._name=t},clone:function(t){var e=new bg.scene.Drawable;return e.name=t||"copy of "+this.name,this.forEach(function(t,n,i){e.addPolyList(t.clone(),n.clone(),i?new bg.Matrix4(i):null)}),e},instance:function(t){var e=new bg.scene.Drawable;return e.name=t||"copy of "+this.name,this.forEach(function(t,n,i){e.addPolyList(t,n.clone(),i?new bg.Matrix4(i):null)}),e},addPolyList:function(t,e){var n=void 0!==arguments[2]?arguments[2]:null;return!(!t||-1!=this.indexOf(t))&&(e=e||new bg.base.Material,this._items.push({polyList:t,material:e,transform:n}),!0)},removePolyList:function(t){var e=this.indexOf(t);e>=0&&this._items.splice(e,1)},indexOf:function(t){var e=-1;return this._items.some(function(t,n){if(t.polyList==t)return e=n,!0}),e},replacePolyList:function(t,e){return t>=0&&t<this._items.length&&(this._items[t].polyList=e,!0)},replaceMaterial:function(t,e){return t>=0&&t<this._items.length&&(this._items[t].material=e,!0)},replaceTransform:function(t,e){return t>=0&&t<this._items.length&&(this._items[t].transform=e,!0)},getPolyList:function(t){return t>=0&&t<this._items.length&&this._items[t].polyList},getMaterial:function(t){return t>=0&&t<this._items.length&&this._items[t].material},getTransform:function(t){return t>=0&&t<this._items.length&&this._items[t].transform},forEach:function(t){var e=!0,n=!1,i=void 0;try{for(var r=void 0,a=this._items[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;t(s.polyList,s.material,s.transform)}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}},some:function(t){var e=!0,n=!1,i=void 0;try{for(var r=void 0,a=this._items[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;if(t(s.polyList,s.material,s.transform))return!0}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return!1},every:function(t){var e=!0,n=!1,i=void 0;try{for(var r=void 0,a=this._items[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;if(!t(s.polyList,s.material,s.transform))return!1}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return!0},display:function(t,e){if(!t.effect)throw new Error("Could not draw component: invalid effect found.");this.node.enabled&&this.forEach(function(n,i,r){if(n.visible){var a=t.effect.material;r&&(e.modelMatrixStack.push(),e.modelMatrixStack.mult(r)),t.shouldDraw(i)&&(t.effect.material=i,t.draw(n)),r&&e.modelMatrixStack.pop(),t.effect.material=a}})},setGroupVisible:function(t){var e=void 0===arguments[1]||arguments[1];this.forEach(function(n){n.groupName==t&&(n.visible=e)})},hideGroup:function(t){this.setGroupVisible(t,!1)},showGroup:function(t){this.setGroupVisible(t,!0)},setVisibleByName:function(t){var e=void 0===arguments[1]||arguments[1];this.some(function(n){if(n.name==t)return n.visible=e,!0})},showByName:function(t){this.setVisibleByName(t,!0)},hideByName:function(t){this.setVisibleByName(t,!1)},deserialize:function(t){}},{InstanceNode:function(t){var n=new bg.scene.Node(t.context,t.name?"copy of "+t.name:"");return n.enabled=t.enabled,t.forEachComponent(function(t){var i=null;i=t instanceof e?t.instance():t.clone(),n.addComponent(i)}),n}},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,t,"bg.scene.Drawable")}(),function(){function t(t){n.push(t)}function e(t){var e=n.indexOf(t);-1!=e&&n.splice(e,1)}var n=[],i=function(i){function r(){var t=void 0!==arguments[0]?arguments[0]:null;$traceurRuntime.superConstructor(r).call(this),this._light=t,this._visitor=new bg.scene.TransformVisitor,this._rebuildTransform=!0}return $traceurRuntime.createClass(r,{clone:function(){var t=new bg.scene.Light;return t.light=this.light.clone(),t},get light(){return this._light},set light(t){this._light=t},get transform(){return this._rebuildTransform&&this.node&&(this._visitor.matrix.identity(),this.node.acceptReverse(this._visitor),this._rebuildTransform=!1),this._visitor.matrix},frame:function(t){this._rebuildTransform=!0},removedFromNode:function(t){e(this)},addedToNode:function(e){t(this)}},{GetActiveLights:function(){return n}},i)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,i,"bg.scene.Light")}(),function(){function t(t,e,n,i){var r=new bg.base.PolyList(t),a=e/2,s=n/2,o=i/2;return r.vertex=[a,-s,-o,-a,-s,-o,-a,s,-o,a,s,-o,a,-s,o,a,-s,-o,a,s,-o,a,s,o,-a,-s,o,a,-s,o,a,s,o,-a,s,o,-a,-s,-o,-a,-s,o,-a,s,o,-a,s,-o,-a,s,o,a,s,o,a,s,-o,-a,s,-o,a,-s,o,-a,-s,o,-a,-s,-o,a,-s,-o],r.normal=[0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],r.texCoord0=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],r.texCoord1=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],r.index=[0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8,12,13,14,14,15,12,16,17,18,18,19,16,20,21,22,22,23,20],r.build(),r}function e(t,e,n){var i=e/2,r=n/2,a=new bg.base.PolyList(t);return a.vertex=[-i,0,-r,i,0,-r,i,0,r,i,0,r,-i,0,r,-i,0,-r],a.normal=[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],a.texCoord0=[0,0,1,0,1,1,1,1,0,1,0,0],a.texCoord1=[0,0,1,0,1,1,1,1,0,1,0,0],a.index=[2,1,0,5,4,3],a.build(),a}function n(t,e,n,i){var r=new bg.base.PolyList(t);++n;var a,s,o=1/(i-1),u=1/(n-1),l=[],c=[],h=[],f=[];for(a=0;a<i;a++)for(s=0;s<n;s++){var d=bg.Math.sin(-bg.Math.PI_2+bg.Math.PI*a*o),g=bg.Math.cos(2*bg.Math.PI*s*u)*bg.Math.sin(bg.Math.PI*a*o),m=bg.Math.sin(2*bg.Math.PI*s*u)*bg.Math.sin(bg.Math.PI*a*o);h.push(s*u),h.push(a*o),c.push(g,d,m),l.push(g*e,d*e,m*e)}for(a=0;a<i-1;a++)for(s=0;s<n-1;s++){var p=a*n+s,b=a*n+(s+1),_=(a+1)*n+(s+1),v=(a+1)*n+s;f.push(p),f.push(v),f.push(_),f.push(_),f.push(b),f.push(p)}return r.vertex=l,r.normal=c,r.texCoord0=h,r.texCoord1=h,r.index=f,r.build(),r}function i(t,e){var n=new bg.scene.Drawable(e);return n.addPolyList(t),n}var r=function(){function r(){}return $traceurRuntime.createClass(r,{},{Cube:function(e){var n=void 0!==arguments[1]?arguments[1]:1,r=arguments[2],a=arguments[3];return r=r||n,a=a||n,i(t(e,n,r,a),"Cube")},Plane:function(t){var n=void 0!==arguments[1]?arguments[1]:1,r=arguments[2];return r=r||n,i(e(t,n,r),"Cube")},Sphere:function(t){var e=void 0!==arguments[1]?arguments[1]:1,r=void 0!==arguments[2]?arguments[2]:20,a=arguments[3];return a=a||r,i(n(t,e,r,a),"Cube")}})}();bg.scene.PrimitiveFactory=r}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),this._matrix=t||bg.Matrix4.Identity(),this._globalMatrixValid=!1,this._transformVisitor=new bg.scene.TransformVisitor}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.Transform;return t.matrix=new bg.Matrix4(this.matrix),t},get matrix(){return this._matrix},set matrix(t){this._matrix=t},get globalMatrix(){return this._globalMatrixValid||(this._transformVisitor.clear(),this.node.acceptReverse(this._transformVisitor),this._globalMatrix=this._transformVisitor.matrix),this._globalMatrix},deserialize:function(t){t.transformStrategy||t.transformMatrix},willDisplay:function(t,e){this.node&&this.node.enabled&&(e.modelMatrixStack.push(),e.modelMatrixStack.mult(this.matrix))},didDisplay:function(t,e){this.node&&this.node.enabled&&e.modelMatrixStack.pop(),this._globalMatrixValid=!1}},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,t,"bg.scene.Transform")}(),function(){var t=function(t){function e(t,n){$traceurRuntime.superConstructor(e).call(this),this._pipeline=t||bg.base.Pipeline.Current(),this._matrixState=n||bg.base.MatrixState.Current()}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline},get matrixState(){return this._matrixState},visit:function(t){t.willDisplay(this.pipeline,this.matrixState),t.display(this.pipeline,this.matrixState)},didVisit:function(t){t.didDisplay(this.pipeline,this.matrixState)}},{},t)}(bg.scene.NodeVisitor);bg.scene.DrawVisitor=t;var e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._delta=0}return $traceurRuntime.createClass(e,{get delta(){return this._delta},set delta(t){this._delta=t},visit:function(t){t.frame(this.delta)}},{},t)}(bg.scene.NodeVisitor);bg.scene.FrameVisitor=e;var n=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._matrix=bg.Matrix4.Identity()}return $traceurRuntime.createClass(e,{get matrix(){return this._matrix},clear:function(){this._matrix=bg.Matrix4.Identity()},visit:function(t){var e=t.component("bg.scene.Transform");e&&this._matrix.mult(e.matrix)}},{},t)}(bg.scene.NodeVisitor);bg.scene.TransformVisitor=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{visit:function(t){this._operation&&t[this._operation](this._event)},keyDown:function(t,e){this._operation="keyDown",this._event=e,t.accept(this)},keyUp:function(t,e){this._operation="keyUp",this._event=e,t.accept(this)},mouseUp:function(t,e){this._operation="mouseUp",this._event=e,t.accept(this)},mouseDown:function(t,e){this._operation="mouseDown",this._event=e,t.accept(this)},mouseMove:function(t,e){this._operation="mouseMove",this._event=e,t.accept(this)},mouseOut:function(t,e){this._operation="mouseOut",this._event=e,t.accept(this)},mouseDrag:function(t,e){this._operation="mouseDrag",this._event=e,t.accept(this)},mouseWheel:function(t,e){this._operation="mouseWheel",this._event=e,t.accept(this)},touchStart:function(t,e){this._operation="touchStart",this._event=e,t.accept(this)},touchMove:function(t,e){this._operation="touchMove",this._event=e,t.accept(this)},touchEnd:function(t,e){this._operation="touchEnd",this._event=e,t.accept(this)}},{},t)}(bg.scene.NodeVisitor);bg.scene.InputVisitor=i;var r=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this.clear()}return $traceurRuntime.createClass(e,{get min(){return this._min},get max(){return this._max},get size(){return this._size},clear:function(){this._min=new bg.Vector3(bg.Math.FLOAT_MAX,bg.Math.FLOAT_MAX,bg.Math.FLOAT_MAX),this._max=new bg.Vector3(-bg.Math.FLOAT_MAX,-bg.Math.FLOAT_MAX,-bg.Math.FLOAT_MAX),this._size=new bg.Vector3(0,0,0)},visit:function(t){var e=bg.Matrix4.Identity();if(t.component("bg.scene.Transform")&&(e=t.component("bg.scene.Transform").globalMatrix),t.component("bg.scene.Drawable")){var n=new bg.tools.BoundingBox(t.component("bg.scene.Drawable"),new bg.Matrix4(e));this._min=bg.Vector.MinComponents(this._min,n.min),this._max=bg.Vector.MaxComponents(this._max,n.max),this._size=bg.Vector3.Sub(this._max,this._min)}}},{},t)}(bg.scene.NodeVisitor);bg.scene.BoundingBoxVisitor=r}(),function(){function t(t,e){var n=new Uint8Array(t,e,4);return n=String.fromCharCode(n[0])+String.fromCharCode(n[1])+String.fromCharCode(n[2])+String.fromCharCode(n[3])}function e(t,e){return new DataView(t,e,4).getInt32(0)}function n(t,e){return new DataView(t,e,4).getFloat32(0)}function i(t,e){for(var n={offset:0,data:[]},i=new DataView(t,e,64),r=0;r<16;++r)n.data[r]=i.getFloat32(4*r,!1);return n.offset+=64,n}function r(t,n){var i={offset:0,data:""},r=e(t,n);i.offset+=4;for(var a=new Uint8Array(t,n+4,r),s=0;s<r;++s)i.data+=String.fromCharCode(a[s]);return i.offset+=r,i}function a(t,n){var i={offset:0,data:[]},r=e(t,n);i.offset+=4;for(var a=new DataView(t,n+4,4*r),s=0;s<r;++s)i.data[s]=a.getFloat32(4*s,!1);return i.offset+=4*r,i}function s(t,n){var i={offset:0,data:[]},r=e(t,n);i.offset+=4;for(var a=new DataView(t,n+4,4*r),s=0;s<r;++s)i.data[s]=a.getInt32(4*s,!1);return i.offset+=4*r,i}function o(t,e,n){var i=new bg.physics[n.type];i.offset=new(Function.prototype.bind.apply(bg.Vector3,$traceurRuntime.spread([null],n.offset))),i.roll=n.roll,i.pitch=n.pitch,i.yaw=n.yaw;var r=new bg.scene[e](i);t.addComponent(r)}var u=function(){function u(t,e){this._context=t}return $traceurRuntime.createClass(u,{loadDrawable:function(t,e){this._jointData=null;var n=this.parseData(t);return this.createDrawable(n,e)},parseData:function(o){var u=[],l=null,c=0,h=new Uint8Array(o,0,8);c=8;var f=String.fromCharCode(h[4])+String.fromCharCode(h[5])+String.fromCharCode(h[6])+String.fromCharCode(h[7]);if(1==h[0])throw"Could not open the model file. This file has been saved as computer (little endian) format, try again saving it in network (big endian) format";if("hedr"!=f)throw"File format error. Expecting header";var d={maj:h[1],min:h[2],rev:h[3]};bg.log("vwglb file version: "+d.maj+"."+d.min+"."+d.rev+", big endian");e(o,c);c+=4;var g=t(o,c);if(c+=4,"mtrl"!=g)throw"File format error. Expecting materials definition";var m=r(o,c);if(c+=m.offset,l=JSON.parse(m.data),"proj"==t(o,c)){c+=4,c+=r(o,c).offset,n(o,c),c+=4;var p=i(o,c);c+=p.offset;var b=(p.data,i(o,c));c+=b.offset,b.data}if("join"==t(o,c)){c+=4;var _=r(o,c);c+=_.offset;var v=_.data;try{this._jointData=JSON.parse(v)}catch(t){throw new Error("VWGLB file format reader: Error parsing joint data")}}var y=t(o,c);if("plst"!=y)throw"File format error. Expecting poly list";var E=!1;c+=4;for(var T,x,S,w,M,C,R,O;!E;){y=t(o,c),c+=4;var A=null,j=null;switch(y){case"pnam":A=r(o,c),c+=A.offset,T=A.data;break;case"mnam":A=r(o,c),c+=A.offset,x=A.data;break;case"varr":var I=a(o,c);c+=I.offset,S=I.data;break;case"narr":var P=a(o,c);c+=P.offset,w=P.data;break;case"t0ar":j=a(o,c),c+=j.offset,M=j.data;break;case"t1ar":j=a(o,c),c+=j.offset,C=j.data;break;case"t2ar":j=a(o,c),c+=j.offset,R=j.data;break;case"indx":var L=s(o,c);c+=L.offset,O=L.data;break;case"plst":case"endf":var N={name:T,matName:x,vertices:S,normal:w,texcoord0:M,texcoord1:C,texcoord2:R,indices:O};u.push(N),T="",x="",S=null,w=null,M=null,C=null,R=null,O=null;break;default:throw"File format exception. Unexpected poly list member found"}E="endf"==y}var D={version:d,polyList:u,materials:{}};return l.forEach(function(t){D.materials[t.name]=t}),D},createDrawable:function(t,e){var n=this,i=new bg.scene.Drawable(this.context);i._version=t.version;var r=[];return t.polyList.forEach(function(a){var s=t.materials[a.matName],o=new bg.base.PolyList(n._context);o.name=a.name,o.vertex=a.vertices||o.vertex,o.normal=a.normal||o.normal,o.texCoord0=a.texcoord0||o.texCoord0,o.texCoord1=a.texcoord1||o.texCoord1,o.texCoord2=a.texcoord2||o.texCoord2,o.index=a.indices||o.index,o.groupName=s.groupName,o.visible=s.visible,o.build(),r.push(bg.base.Material.GetMaterialWithJson(n._context,s,e).then(function(t){i.addPolyList(o,t)}))}),Promise.all(r).then(function(){return i})},addComponents:function(t){if(this._jointData){var e=null,n=null;this._jointData.input&&(e=this._jointData.input),this._jointData.output&&this._jointData.output.length&&(n=this._jointData.output[0]),e&&o(t,"InputChainJoint",e),n&&o(t,"OutputChainJoint",n)}}},{})}(),l=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{acceptType:function(t,e){return"vwglb"==bg.utils.Resource.GetExtension(t)},load:function(t,e,n){return new Promise(function(i,r){if(n)try{var a=new u(t,n),s=e.substr(0,e.lastIndexOf("/"));a.loadDrawable(n,s).then(function(e){var n=new bg.scene.Node(t,e.name);n.addComponent(e),a.addComponents(n),i(n)})}catch(t){r(t)}else r(new Error("Error loading drawable. Data is null"))})}},{},t)}(bg.base.LoaderPlugin);bg.base.VWGLBLoaderPlugin=l}(),bg.manipulation={},function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._gizmoOpacity=.9}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline||(this._pipeline=new bg.base.Pipeline(this.context),this._pipeline.blendMode=bg.base.BlendMode.NORMAL,this._pipeline.effect=new bg.manipulation.GizmoEffect(this.context)),this._pipeline},get matrixState(){return this._matrixState||(this._matrixState=new bg.base.MatrixState),this._matrixState},get drawVisitor(){return this._drawVisitor||(this._drawVisitor=new bg.scene.DrawVisitor(this.pipeline,this.matrixState)),this._drawVisitor},get gizmoOpacity(){return this._gizmoOpacity},set gizmoOpacity(t){this._gizmoOpacity=t},get working(){return this._working},startAction:function(t,e){if(this._working=!0,this._startPoint=e,this._currentGizmoData=t,this._currentGizmoData&&this._currentGizmoData.node){var n=this._currentGizmoData.node.component("bg.manipulation.Gizmo");n&&n.beginDrag(this._currentGizmoData.action,e)}},move:function(t,e){if(this._currentGizmoData&&this._currentGizmoData.node){var n=this._currentGizmoData.node.component("bg.manipulation.Gizmo");n&&(t.y=e.viewport.height-t.y,n.drag(this._currentGizmoData.action,this._startPoint,t,e)),this._startPoint=t}},endAction:function(){if(this._currentGizmoData&&this._currentGizmoData.node){var t=this._currentGizmoData.node.component("bg.manipulation.Gizmo");t&&t.endDrag(this._currentGizmoData.action)}this._working=!1,this._startPoint=null,this._currentGizmoData=null},drawGizmos:function(t,e){var n=void 0===arguments[2]||arguments[2],i=bg.base.Pipeline.Current(),r=bg.base.MatrixState.Current();bg.base.Pipeline.SetCurrent(this.pipeline),bg.base.MatrixState.SetCurrent(this.matrixState),this.pipeline.viewport=e.viewport,this.pipeline.effect.matrixState=this.matrixState,n&&this.pipeline.clearBuffers(bg.base.ClearBuffers.DEPTH),this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix);var a=this.pipeline.opacityLayer;this.pipeline.opacityLayer=bg.base.OpacityLayer.NONE,this.pipeline.blend=!0,this.pipeline.effect.gizmoOpacity=this.gizmoOpacity,t.accept(this.drawVisitor),this.pipeline.blend=!1,this.pipeline.opacityLayer=a,i&&bg.base.Pipeline.SetCurrent(i),r&&bg.base.MatrixState.SetCurrent(r)}},{},t)}(bg.app.ContextObject);bg.manipulation.GizmoManager=t}(),function(){function t(){o[bg.webgl1.EngineId]={vertex:"\n\t\t\tattribute vec3 inVertex;\n\t\t\tattribute vec2 inTexCoord;\n\t\t\t\n\t\t\tuniform mat4 inModelMatrix;\n\t\t\tuniform mat4 inViewMatrix;\n\t\t\tuniform mat4 inProjectionMatrix;\n\t\t\t\n\t\t\tvarying vec2 fsTexCoord;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tfsTexCoord = inTexCoord;\n\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t}\n\t\t\t",fragment:"\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tuniform sampler2D inTexture;\n\t\t\tuniform float inOpacity;\n\t\t\t\n\t\t\tvarying vec2 fsTexCoord;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = vec4(texture2D(inTexture,fsTexCoord).rgb,inOpacity);\n\t\t\t}\n\t\t\t"}}function e(t){return/rotate.*fine/i.test(t.name)?bg.manipulation.GizmoAction.ROTATE_FINE:/rotate/i.test(t.name)?bg.manipulation.GizmoAction.ROTATE:/translate/i.test(t.name)?bg.manipulation.GizmoAction.TRANSLATE:void 0}function n(t,n,i){return new Promise(function(r,a){bg.base.Loader.Load(t,n).then(function(t){var n=t.component("bg.scene.Drawable"),a=[];n&&n.forEach(function(t,n){a.push({id:bg.manipulation.Selectable.GetIdentifier(),type:bg.manipulation.SelectableType.GIZMO,plist:t,material:n,action:e(t),node:i})}),r(a)}).catch(function(t){a(t)})})}function i(t,e,n,i,r){r||(r=0);var a=new bg.Vector3(n);a.sub(i).normalize();var s=new bg.Vector3(e);s.sub(i).normalize();var o=a.dot(s),u=Math.acos(o);if(u>=r||0==r){0!=r&&(u=u>=2*r?2*r:r);t.dot(a.cross(s))<0&&(u*=-1);var l=new bg.Quaternion(u,t.x,t.y,t.z);if(l.normalize(),!isNaN(l.x))return l}return new bg.Quaternion(0,0,1,0)}function r(t,e){var n=new bg.Matrix4(t.transform.matrix),i=n.rotation,r=n.position;switch(t._lastPickPoint||(t._lastPickPoint=e.ray.end,t._translateOffset=new bg.Vector3(r),t._translateOffset.sub(e.ray.end)),Math.abs(t.plane)){case bg.Axis.X:n=bg.Matrix4.Translation(r.x,e.point.y+t._translateOffset.y,e.point.z+t._translateOffset.z);break;case bg.Axis.Y:n=bg.Matrix4.Translation(e.point.x+t._translateOffset.x,r.y,e.point.z+t._translateOffset.z);break;case bg.Axis.Z:n=bg.Matrix4.Translation(e.point.x+t._translateOffset.x,e.point.y+t._translateOffset.y,r.z)}return n.mult(i),t._lastPickPoint=e.point,n}function a(t,e,n){var r=new bg.Matrix4(t.transform.matrix),a=r.rotation,s=r.position;if(t._lastPickPoint||(t._lastPickPoint=e.ray.end,t._translateOffset=new bg.Vector3(s),t._translateOffset.sub(e.ray.end)),n){var o=new bg.Matrix4(a);a=i(t.planeAxis,t._lastPickPoint,e.point,s),0==a.x&&0==a.y&&0==a.z&&1==a.w||(r=bg.Matrix4.Translation(s).mult(a.getMatrix4()).mult(o),t._lastPickPoint=e.point)}else{var u=new bg.Matrix4(a);a=i(t.planeAxis,t._lastPickPoint,e.point,s,bg.Math.degreesToRadians(22.5)),0==a.x&&0==a.y&&0==a.z&&1==a.w||(r=bg.Matrix4.Translation(s).mult(a.getMatrix4()).mult(u),t._lastPickPoint=e.point)}return r}function s(t,e){var n=e.viewMatrixStack.matrix.forwardVector,i=e.viewMatrixStack.matrix.upVector,r=new bg.Vector3(1,0,0),a=new bg.Vector3(0,1,0),s=new bg.Vector3(0,0,1),o=new bg.Vector3(-1,0,0),u=new bg.Vector3(0,-1,0),l=new bg.Vector3(0,0,-1);if(Math.acos(i.dot(a))>.9)t.plane=bg.Axis.Y;else{var c=[Math.acos(n.dot(r)),Math.acos(n.dot(a)),Math.acos(n.dot(s)),Math.acos(n.dot(o)),Math.acos(n.dot(u)),Math.acos(n.dot(l))],h=c[0],f=0;switch(c.reduce(function(t,e,n){e<h&&(f=n,h=e)}),f){case 0:t.plane=-bg.Axis.X;break;case 1:t.plane=bg.Axis.Y;break;case 2:t.plane=bg.Axis.Z;break;case 3:t.plane=bg.Axis.X;break;case 4:t.plane=-bg.Axis.Y;break;case 5:t.plane=-bg.Axis.Z}}}var o={},u=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e),t(),this._gizmoOpacity=1}return $traceurRuntime.createClass(n,{get inputVars(){return{vertex:"inVertex",tex0:"inTexCoord"}},set matrixState(t){this._matrixState=t},get matrixState(){return this._matrixState},set texture(t){this._texture=t},get texture(){return this._texture},set gizmoOpacity(t){this._gizmoOpacity=t},get gizmoOpacity(){return this._gizmoOpacity},get shader(){return this._shader||(this._shader=new bg.base.Shader(this.context),this._shader.addShaderSource(bg.base.ShaderType.VERTEX,o[bg.webgl1.EngineId].vertex),this._shader.addShaderSource(bg.base.ShaderType.FRAGMENT,o[bg.webgl1.EngineId].fragment),this._shader.link(),this._shader.status?this._shader.initVars(["inVertex","inTexCoord"],["inModelMatrix","inViewMatrix","inProjectionMatrix","inTexture","inOpacity"]):(console.log(this._shader.compileError),console.log(this._shader.linkError))),this._shader},setupVars:function(){this.shader.setMatrix4("inModelMatrix",this.matrixState.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",new bg.Matrix4(this.matrixState.viewMatrixStack.matrixConst)),this.shader.setMatrix4("inProjectionMatrix",this.matrixState.projectionMatrixStack.matrixConst),this.shader.setTexture("inTexture",this.texture,bg.base.TextureUnit.TEXTURE_0),this.shader.setValueFloat("inOpacity",this.gizmoOpacity)}},{},e)}(bg.base.Effect);bg.manipulation.GizmoEffect=u,bg.manipulation.GizmoAction={TRANSLATE:1,ROTATE:2,ROTATE_FINE:3,NONE:99};var l={},c=function(){function t(t){this._context=t,this._gizmos={}}return $traceurRuntime.createClass(t,{find:function(t){return this._gizmos[t]},register:function(t,e){this._gizmos[t]=e},unregister:function(t){this._gizmos[t]&&delete this._gizmos[t]},clear:function(){this._gizmos={}}},{Get:function(e){return l[e.uuid]||(l[e.uuid]=new t(e)),l[e.uuid]}})}();bg.manipulation.GizmoCache=c;var h=function(t){function e(t){var n=void 0===arguments[1]||arguments[1];$traceurRuntime.superConstructor(e).call(this),this._gizmoPath=t,this._offset=new bg.Vector3(0),this._visible=n,this._gizmoTransform=bg.Matrix4.Identity(),this._gizmoP=bg.Matrix4.Identity()}return $traceurRuntime.createClass(e,{clone:function(){var t=new e(this._gizmoPath);return t.offset.assign(this._offset),t.visible=this._visible,t},get offset(){return this._offset},set offset(t){this._offset=t},get visible(){return this._visible},set visible(t){this._visible=t},get gizmoTransform(){return this._gizmoTransform},beginDrag:function(t,e){},drag:function(t,e,n,i){},endDrag:function(t){},findId:function(t){var e=null;return this._gizmoItems&&this._gizmoItems.some(function(n){if(n.id.r==t.r&&n.id.g==t.g&&n.id.b==t.b&&n.id.a==t.a)return e=n,!0}),e},init:function(){var t=this;this._error||(this._gizmoItems=[],n(this.node.context,this._gizmoPath,this.node).then(function(e){t._gizmoItems=e}).catch(function(e){throw t._error=!0,e}))},frame:function(t){},display:function(t,e){if(this._gizmoItems&&this.visible){if(e.modelMatrixStack.push(),e.modelMatrixStack.set(this._gizmoP).mult(this.gizmoTransform),t.effect instanceof bg.manipulation.ColorPickEffect&&t.opacityLayer&bg.base.OpacityLayer.GIZMOS){var n=t.depthTest;t.depthTest=!1,this._gizmoItems.forEach(function(e){t.effect.pickId=new bg.Color(e.id.a/255,e.id.b/255,e.id.g/255,e.id.r/255),t.draw(e.plist)}),t.depthTest=n}else t.effect instanceof bg.manipulation.GizmoEffect&&this._gizmoItems.forEach(function(e){t.effect.texture=e.material.texture,t.draw(e.plist)});e.modelMatrixStack.pop()}}},{},t)}(bg.scene.Component),f=function(t){function e(t){var n=void 0===arguments[1]||arguments[1];$traceurRuntime.superConstructor(e).call(this,t,n),this._plane=bg.Axis.Y,this._autoPlaneMode=!0}return $traceurRuntime.createClass(e,{get plane(){return this._plane},set plane(t){this._plane=t},get autoPlaneMode(){return this._autoPlaneMode},set autoPlaneMode(t){this._autoPlaneMode=t},get planeAxis(){switch(Math.abs(this.plane)){case bg.Axis.X:return new bg.Vector3(1,0,0);case bg.Axis.Y:return new bg.Vector3(0,1,0);case bg.Axis.Z:return new bg.Vector3(0,0,1)}},get gizmoTransform(){var t=bg.Matrix4.Identity();switch(this.plane){case bg.Axis.X:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),0,0,-1);case bg.Axis.Y:break;case bg.Axis.Z:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),1,0,0);case-bg.Axis.X:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),0,0,1);case-bg.Axis.Y:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(180),0,-1,0);case-bg.Axis.Z:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),-1,0,0)}return t},clone:function(){var t=new e(this._gizmoPath);return t.offset.assign(this._offset),t.visible=this._visible,t},init:function(){$traceurRuntime.superGet(this,e.prototype,"init").call(this),this._gizmoP=bg.Matrix4.Translation(this.transform.matrix.position)},display:function(t,n){this._gizmoItems&&this.visible&&(this.autoPlaneMode&&s(this,n),$traceurRuntime.superGet(this,e.prototype,"display").call(this,t,n))},beginDrag:function(t,e){this._lastPickPoint=null},drag:function(t,e,n,i){if(this.transform){var s=new bg.physics.Plane(this.planeAxis),o=bg.physics.Ray.RayWithScreenPoint(n,i.projection,i.viewMatrix,i.viewport),u=bg.physics.Intersection.RayToPlane(o,s);if(u.intersects()){var l=new bg.Matrix4(this.transform.matrix);switch(this._gizmoP=bg.Matrix4.Translation(this.transform.matrix.position),t){case bg.manipulation.GizmoAction.TRANSLATE:l=r(this,u);break;case bg.manipulation.GizmoAction.ROTATE:l=a(this,u,!1);break;case bg.manipulation.GizmoAction.ROTATE_FINE:l=a(this,u,!0)}this.transform.matrix=l}}},endDrag:function(t){this._lastPickPoint=null}},{},t)}(h);bg.scene.registerComponent(bg.manipulation,h,"bg.manipulation.Gizmo"),bg.scene.registerComponent(bg.manipulation,f,"bg.manipulation.Gizmo")}(),function(){function t(){e[bg.webgl1.EngineId]={vertex:"\n\t\t\tattribute vec3 inVertex;\n\t\t\t\n\t\t\tuniform mat4 inModelMatrix;\n\t\t\tuniform mat4 inViewMatrix;\n\t\t\tuniform mat4 inProjectionMatrix;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t}\n\t\t\t",fragment:"\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tuniform vec4 inColorId;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = inColorId;\n\t\t\t}\n\t\t\t"}}var e={},n=function(n){function i(e){$traceurRuntime.superConstructor(i).call(this,e),t()}return $traceurRuntime.createClass(i,{get inputVars(){return{vertex:"inVertex"}},set matrixState(t){this._matrixState=t},get matrixState(){return this._matrixState},set pickId(t){this._pickId=t},get pickId(){return this._pickId||bg.Color.Transparent()},get shader(){return this._shader||(this._shader=new bg.base.Shader(this.context),this._shader.addShaderSource(bg.base.ShaderType.VERTEX,e[bg.webgl1.EngineId].vertex),this._shader.addShaderSource(bg.base.ShaderType.FRAGMENT,e[bg.webgl1.EngineId].fragment),this._shader.link(),this._shader.status?this._shader.initVars(["inVertex"],["inModelMatrix","inViewMatrix","inProjectionMatrix","inColorId"]):(console.log(this._shader.compileError),console.log(this._shader.linkError))),this._shader},setupVars:function(){this.shader.setMatrix4("inModelMatrix",this.matrixState.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",new bg.Matrix4(this.matrixState.viewMatrixStack.matrixConst)),this.shader.setMatrix4("inProjectionMatrix",this.matrixState.projectionMatrixStack.matrixConst),this.shader.setVector4("inColorId",this.pickId)}},{},n)}(bg.base.Effect);bg.manipulation.ColorPickEffect=n;var i=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),this._target=t}return $traceurRuntime.createClass(e,{get target(){return this._target},set target(t){this._target=t,this._result=null},get result(){return this._result},visit:function(t){var e=t.component("bg.manipulation.Selectable"),n=t.component("bg.manipulation.Gizmo");n&&!n.visible&&(n=null),this._result=this._result||e&&e.findId(this.target)||n&&n.findId(this.target)}},{},t)}(bg.scene.NodeVisitor);bg.manipulation.FindPickIdVisitor=i;var r=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline||(this._pipeline=new bg.base.Pipeline(this.context),this._pipeline.effect=new n(this.context),this._renderSurface=new bg.base.TextureSurface(this.context),this._renderSurface.create(),this._pipeline.renderSurface=this._renderSurface,this._pipeline.clearColor=new bg.Color(0,0,0,0)),this._pipeline},get matrixState(){return this._matrixState||(this._matrixState=new bg.base.MatrixState),this._matrixState},get drawVisitor(){return this._drawVisitor||(this._drawVisitor=new bg.scene.DrawVisitor(this.pipeline,this.matrixState)),this._drawVisitor},pick:function(t,e,n){var r=bg.base.Pipeline.Current(),a=bg.base.MatrixState.Current();bg.base.Pipeline.SetCurrent(this.pipeline),bg.base.MatrixState.SetCurrent(this.matrixState),this.pipeline.viewport=e.viewport,this.pipeline.effect.matrixState=this.matrixState,this.pipeline.clearBuffers(bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH),this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix);var s=this.pipeline.opacityLayer;this.pipeline.opacityLayer=bg.base.OpacityLayer.SELECTION,t.accept(this.drawVisitor),this.pipeline.opacityLayer=bg.base.OpacityLayer.GIZMOS,t.accept(this.drawVisitor),this.pipeline.opacityLayer=s;var o=this.pipeline.renderSurface.readBuffer(new bg.Viewport(n.x,n.y,1,1)),u={r:o[3],g:o[2],b:o[1],a:o[0]},l=new i(u);return t.accept(l),r&&bg.base.Pipeline.SetCurrent(r),a&&bg.base.MatrixState.SetCurrent(a),l.result}},{},t)}(bg.app.ContextObject);bg.manipulation.MousePicker=r}(),function(){function t(){255==a?(a=0,e()):++a}function e(){255==s?(s=0,n()):++s}function n(){255==o?(o=0,i()):++o}function i(){255==u?(u=0,bg.log("WARNING: Maximum number of picker identifier reached.")):++u}function r(){return t(),{r:a,g:s,b:s,a:u}}var a=0,s=0,o=0,u=0,l=!1;bg.manipulation.SelectableType={PLIST:1,GIZMO:2};var c=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._initialized=!1,this._selectablePlist=[]}return $traceurRuntime.createClass(e,{clone:function(){return new e},buildIdentifier:function(){this._initialized=!1,this._selectablePlist=[]},findId:function(t){var e=null;return this._selectablePlist.some(function(n){if(n.id.r==t.r&&n.id.g==t.g&&n.id.b==t.b&&n.id.a==t.a)return e=n,!0}),e},frame:function(t){var e=this
;!this._initialized&&this.drawable&&(this.drawable.forEach(function(t,n){var i=r();e._selectablePlist.push({id:i,type:bg.manipulation.SelectableType.PLIST,plist:t,material:n,drawable:e.drawable,node:e.node})}),this._initialized=!0)},display:function(t,e){t.effect instanceof bg.manipulation.ColorPickEffect&&t.opacityLayer&bg.base.OpacityLayer.SELECTION&&this._selectablePlist.forEach(function(e){t.effect.pickId=new bg.Color(e.id.a/255,e.id.b/255,e.id.g/255,e.id.r/255),t.draw(e.plist)})}},{SetSelectMode:function(t){l=t},GetIdentifier:function(){return r()}},t)}(bg.scene.Component);bg.scene.registerComponent(bg.manipulation,c,"bg.manipulation.Selectable")}(),function(){function t(t){var n=bg.app.Mouse.LeftButton(),i=bg.app.Mouse.MiddleButton(),r=bg.app.Mouse.RightButton();switch(!0){case n==t._rotateButtons.left&&i==t._rotateButtons.middle&&r==t._rotateButtons.right:return e.ROTATE;case n==t._panButtons.left&&i==t._panButtons.middle&&r==t._panButtons.right:return e.PAN;case n==t._zoomButtons.left&&i==t._zoomButtons.middle&&r==t._zoomButtons.right:return e.ZOOM}}var e={ROTATE:0,PAN:1,ZOOM:2},n=function(n){function i(){$traceurRuntime.superConstructor(i).call(this),this._rotateButtons={left:!0,middle:!1,right:!1},this._panButtons={left:!1,middle:!1,right:!0},this._zoomButtons={left:!1,middle:!0,right:!1},this._rotation=new bg.Vector2,this._distance=5,this._center=new bg.Vector3,this._rotationSpeed=.2,this._forward=0,this._left=0,this._wheelSpeed=1,this._minFocus=2,this._minPitch=.1,this._maxPitch=85,this._minDistance=.4,this._maxDistance=24,this._maxX=15,this._minX=-15,this._minY=.1,this._maxY=2,this._maxZ=15,this._minZ=-15}return $traceurRuntime.createClass(i,{setRotateButtons:function(t,e,n){this._rotateButtons={left:t,middle:e,right:n}},setPanButtons:function(t,e,n){this._panButtons={left:t,middle:e,right:n}},setZoomButtons:function(t,e,n){this._zoomButtons={left:t,middle:e,right:n}},get rotation(){return this._rotation},set rotation(t){this._rotation=t},get distance(){return this._distance},set distance(t){this._distance=t},get center(){return this._center},set center(t){this._center=t},get whellSpeed(){this._wheelSpeed},set wheelSpeed(t){this._wheelSpeed=t},get minCameraFocus(){return this._minFocus},set minCameraFocus(t){this._minFocus=t},get minPitch(){return this._minPitch},set minPitch(t){this._minPitch=t},get maxPitch(){return this._maxPitch},set maxPitch(t){this._maxPitch=t},get minDistance(){return this._minDistance},set minDistance(t){this._minDistance=t},get maxDistance(){return this._maxDistance},set maxDistance(t){this._maxDistance=t},frame:function(t){if(this.transform){var e=this.transform.matrix.forwardVector,n=this.transform.matrix.leftVector;e.scale(this._forward),n.scale(this._left),this._center.add(e).add(n);var i=this._rotation.x>this._minPitch?this._rotation.x:this._minPitch;i=i<this._maxPitch?i:this._maxPitch,this._rotation.x=i,this._distance=this._distance>this._minDistance?this._distance:this._minDistance,this._distance=this._distance<this._maxDistance?this._distance:this._maxDistance,this._center.x<this._minX?this._center.x=this._minX:this._center.x>this._maxX&&(this._center.x=this._maxX),this._center.y<this._minY?this._center.y=this._minY:this._center.y>this._maxY&&(this._center.y=this._maxY),this._center.z<this._minZ?this._center.z=this._minZ:this._center.z>this._maxZ&&(this._center.z=this._maxZ),this.transform.matrix.identity().translate(this._center).rotate(bg.Math.degreesToRadians(this._rotation.y),0,1,0).rotate(bg.Math.degreesToRadians(i),-1,0,0).translate(0,0,this._distance)}this.camera&&(this.camera.focus=this._distance>this._minFocus?this._distance:this._minFocus)},mouseDown:function(t){this._lastPos=new bg.Vector2(t.x,t.y)},mouseDrag:function(n){if(this.transform&&this._lastPos){var i=new bg.Vector2(this._lastPos.y-n.y,this._lastPos.x-n.x);switch(this._lastPos.set(n.x,n.y),t(this)){case e.ROTATE:i.x=-1*i.x,this._rotation.add(i.scale(.5));break;case e.PAN:var r=this.transform.matrix.upVector,a=this.transform.matrix.leftVector;r.scale(-.001*i.x*this._distance),a.scale(-.001*i.y*this._distance),this._center.add(r).add(a);break;case e.ZOOM:this._distance+=.01*i.x*this._distance}}},mouseWheel:function(t){var e=this._distance>.01?this._distance:.01;this._distance+=.001*t.delta*e*this._wheelSpeed},touchStart:function(t){this._lastTouch=t.touches},touchMove:function(t){if(this._lastTouch.length==t.touches.length&&this.transform)if(1==this._lastTouch.length){var e=this._lastTouch[0],n=t.touches[0],i=new bg.Vector2(-1*(e.y-n.y),e.x-n.x);this._rotation.add(i.scale(.5))}else if(2==this._lastTouch.length){var r=this._lastTouch[0],a=this._lastTouch[1],s=null,o=null;t.touches.forEach(function(t){t.identifier==r.identifier?s=t:t.identifier==a.identifier&&(o=t)});var u=Math.round(new bg.Vector2(r.x,r.y).sub(new bg.Vector3(a.x,a.y)).magnitude()),l=Math.round(new bg.Vector2(s.x,s.y).sub(new bg.Vector3(o.x,o.y)).magnitude()),c=new bg.Vector2(r.y-s.y,a.x-o.x),h=this.transform.matrix.upVector,f=this.transform.matrix.leftVector;h.scale(-.001*c.x*this._distance),f.scale(-.001*c.y*this._distance),this._center.add(h).add(f),this._distance+=.005*(u-l)*this._distance}this._lastTouch=t.touches}},{},n)}(bg.scene.Component),i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{},{},t)}(bg.scene.Component),r=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.manipulation,n,"bg.manipulation.OrbitCameraController"),bg.scene.registerComponent(bg.manipulation,i,"bg.manipulation.FPSCameraController"),bg.scene.registerComponent(bg.manipulation,r,"bg.manipulation.TargetCameraController")}(),bg.tools={},function(){var t=function(){function t(t,e){this._min=new bg.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._max=new bg.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._center=null,this._size=null,this._halfSize=null,this._vertexArray=[],e=e||bg.Matrix4.Identity(),t instanceof bg.scene.Drawable?this.addDrawable(t,e):t instanceof bg.scene.PolyList&&this.addPolyList(t,e)}return $traceurRuntime.createClass(t,{clear:function(){this._min=bg.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._max=bg.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._center=this._size=this._halfSize=null},get min(){return this._min},get max(){return this._max},get center(){if(!this._center){this.halfSize;this._center=bg.Vector3.Add(this.halfSize,this._min)}return this._center},get size(){return this._size||(this._size=bg.Vector3.Sub(this.max,this.min)),this._size},get halfSize(){return this._halfSize||(this._halfSize=new bg.Vector3(this.size),this._halfSize.scale(.5)),this._halfSize},addPolyList:function(t,e){this._center=this._size=this._halfSize=null;for(var n=0;n<t.vertex.length;n+=3){var i=e.multVector(new bg.Vector3(t.vertex[n],t.vertex[n+1],t.vertex[n+2]));i.x<this._min.x&&(this._min.x=i.x),i.y<this._min.y&&(this._min.y=i.y),i.z<this._min.z&&(this._min.z=i.z),i.x>this._max.x&&(this._max.x=i.x),i.z>this._max.z&&(this._max.z=i.z),i.y>this._max.y&&(this._max.y=i.y)}},addDrawable:function(t,e){var n=this;t.forEach(function(t,i,r){var a=new bg.Matrix4(e);r&&a.mult(r),n.addPolyList(t,a)})}},{})}();bg.tools.BoundingBox=t}(),bg.render={},function(){var t=function(t){function e(t){var n=void 0!==arguments[1]?arguments[1]:bg.base.OpacityLayer.ALL;$traceurRuntime.superConstructor(e).call(this,t),this._pipeline=new bg.base.Pipeline(t),this._pipeline.opacityLayer=n,this._matrixState=bg.base.MatrixState.Current(),this._drawVisitor=new bg.scene.DrawVisitor(this._pipeline,this._matrixState),this._settings={}}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline},get opacityLayer(){return this._pipeline.opacityLayer},get drawVisitor(){return this._drawVisitor},get matrixState(){return this._matrixState},set settings(t){this._settings=t},get settings(){return this._settings},draw:function(t,e){}},{},t)}(bg.app.ContextObject);bg.render.RenderLayer=t}(),function(){bg.render.RenderPath={FORWARD:1,DEFERRED:2},bg.render.RaytracerQuality={low:{maxSamples:20,rayIncrement:.05},mid:{maxSamples:50,rayIncrement:.025},high:{maxSamples:100,rayIncrement:.0125},extreme:{maxSamples:200,rayIncrement:.0062}};var t={debug:{enabled:!1},ambientOcclusion:{enabled:!0,sampleRadius:.4,kernelSize:16,blur:2,maxDistance:300},raytracer:{enabled:!0,quality:bg.render.RaytracerQuality.mid}},e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e),this._frameVisitor=new bg.scene.FrameVisitor,this._settings=t,this._clearColor=bg.Color.Black()}return $traceurRuntime.createClass(n,{get isSupported(){return!1},create:function(){console.log("ERROR: Error creating renderer. The renderer class must implemente the create() method.")},get clearColor(){return this._clearColor},set clearColor(t){this._clearColor=t},frame:function(t,e){this._frameVisitor.delta=e,t.accept(this._frameVisitor)},display:function(t,e){this.draw(t,e)},get settings(){return this._settings}},{Create:function(t,e){var n=null;if(e==bg.render.RenderPath.DEFERRED&&(n=new bg.render.DeferredRenderer(t)),(e==bg.render.RenderPath.FORWARD||n&&!n.isSupported)&&(n=new bg.render.ForwardRenderer(t)),!n.isSupported)throw new Error("No suitable renderer found.");return n.create(),n}},e)}(bg.app.ContextObject);bg.render.Renderer=e}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inLighting",dataType:"sampler2D",role:"value"},{name:"inDiffuse",dataType:"sampler2D",role:"value"},{name:"inPositionMap",dataType:"sampler2D",role:"value"},{name:"inSSAO",dataType:"sampler2D",role:"value"},{name:"inReflection",dataType:"sampler2D",role:"value"},{name:"inMaterial",dataType:"sampler2D",role:"value"},{name:"inOpaqueDepthMap",dataType:"sampler2D",role:"value"},{name:"inViewSize",dataType:"vec2",role:"value"},{name:"inSSAOBlur",dataType:"int",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&(this._fragmentShaderSource.addFunction(t().functions.blur.blur),this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tvec4 lighting = texture2D(inLighting,fsTexCoord);\n\t\t\t\t\tvec4 diffuse = texture2D(inDiffuse,fsTexCoord);\n\t\t\t\t\tvec4 pos = texture2D(inPositionMap,fsTexCoord);\n\t\t\t\t\tvec4 ssao = blur(inSSAO,fsTexCoord,inSSAOBlur,inViewSize);\n\t\t\t\t\tvec4 reflect = texture2D(inReflection,fsTexCoord);\n\t\t\t\t\tvec4 material = texture2D(inMaterial,fsTexCoord);\n\t\t\t\t\tvec4 opaqueDepth = texture2D(inOpaqueDepthMap,fsTexCoord);\n\t\t\t\t\tif (pos.z<opaqueDepth.z && opaqueDepth.w<1.0) {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfloat reflectionAmount = material.b;\n\t\t\t\t\t\tvec3 finalColor = lighting.rgb * (1.0 - reflectionAmount);\n\t\t\t\t\t\tfinalColor += reflect.rgb * reflectionAmount;\n\t\t\t\t\t\tfinalColor *= ssao.rgb;\n\t\t\t\t\t\tgl_FragColor = vec4(finalColor,diffuse.a);\n\t\t\t\t\t}"))),this._fragmentShaderSource},setupVars:function(){this.shader.setVector2("inViewSize",new bg.Vector2(this.viewport.width,this.viewport.height)),this.shader.setTexture("inLighting",this._surface.lightingMap,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inDiffuse",this._surface.diffuseMap,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inPositionMap",this._surface.positionMap,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inSSAO",this._surface.ssaoMap,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inReflection",this._surface.reflectionMap,bg.base.TextureUnit.TEXTURE_4),this.shader.setTexture("inMaterial",this._surface.materialMap,bg.base.TextureUnit.TEXTURE_5),this.shader.setTexture("inOpaqueDepthMap",this._surface.opaqueDepthMap,bg.base.TextureUnit.TEXTURE_6),this.shader.setValueInt("inSSAOBlur",this.ssaoBlur)},set viewport(t){this._viewport=t},get viewport(){return this._viewport},set clearColor(t){this._clearColor=t},get clearColor(){return this._clearColor},set ssaoBlur(t){this._ssaoBlur=t},get ssaoBlur(){return this._ssaoBlur},get colorCorrection(){return this._colorCorrection||(this._colorCorrection={hue:1,saturation:1,lightness:1,brightness:.5,contrast:.5}),this._colorCorrection}},{},e)}(bg.base.TextureEffect);bg.render.DeferredMixEffect=e}(),function(){function t(t,e,n,i){var r=new bg.base.Pipeline(t);return r.renderSurface=n,void 0!==i?(r.opacityLayer=i,r.effect=e):r.textureEffect=e,r}function e(e){var n=e.context,i=e._surfaces,r=e._opacityLayer;e._gbufferUbyte=t(n,new bg.render.GBufferEffect(n),i.gbufferUByteSurface,r),e._gbufferFloat=t(n,new bg.render.PositionGBufferEffect(n),i.gbufferFloatSurface,r),e._shadow=t(n,new bg.render.ShadowEffect(n),i.shadowSurface,bg.base.OpacityLayer.ALL),e._lighting=t(n,new bg.render.LightingEffect(n),i.lightingSurface),e._ssao=t(n,new bg.render.SSAOEffect(n),i.ssaoSurface),e._ssao.clearColor=bg.Color.White(),e._ssrt=t(n,new bg.render.SSRTEffect(n),i.ssrtSurface);var a=e.matrixState;e.ubyteVisitor=new bg.scene.DrawVisitor(e._gbufferUbyte,a),e.floatVisitor=new bg.scene.DrawVisitor(e._gbufferFloat,a),e.shadowVisitor=new bg.scene.DrawVisitor(e._shadow,a),e._mix=t(n,new bg.render.DeferredMixEffect(n),i.mixSurface)}bg.render.SurfaceType={UNDEFINED:0,OPAQUE:1,TRANSPARENT:2};var n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._type=bg.render.SurfaceType.UNDEFINED,this._gbufferUByteSurface=null,this._gbufferFloatSurface=null,this._lightingSurface=null,this._shadowSurface=null,this._ssaoSurface=null,this._mixSurface=null,this._ssrtSurface=null,this._opaqueSurfaces=null}return $traceurRuntime.createClass(e,{createOpaqueSurfaces:function(){this._type=bg.render.SurfaceType.OPAQUE,this.createCommon()},createTransparentSurfaces:function(t){this._type=bg.render.SurfaceType.TRANSPARENT,this._opaqueSurfaces=t,this.createCommon()},resize:function(t){var e=new bg.Vector2(t.width,t.height);this._gbufferUByteSurface.size=e,this._gbufferFloatSurface.size=e,this._lightingSurface.size=e,this._shadowSurface.size=e,this._ssaoSurface.size=e,this._ssrtSurface.size=e,this._mixSurface.size=e},get type(){return this._type},get gbufferUByteSurface(){return this._gbufferUByteSurface},get gbufferFloatSurface(){return this._gbufferFloatSurface},get lightingSurface(){return this._lightingSurface},get shadowSurface(){return this._shadowSurface},get ssaoSurface(){return this._ssaoSurface},get ssrtSurface(){return this._ssrtSurface},get mixSurface(){return this._mixSurface},get diffuse(){return this._gbufferUByteSurface.getTexture(0)},get specular(){return this._gbufferUByteSurface.getTexture(1)},get normal(){return this._gbufferUByteSurface.getTexture(2)},get material(){return this._gbufferUByteSurface.getTexture(3)},get position(){return this._gbufferFloatSurface.getTexture(0)},get lighting(){return this._lightingSurface.getTexture()},get shadow(){return this._shadowSurface.getTexture()},get ambientOcclusion(){return this._ssaoSurface.getTexture()},get reflection(){return this._ssrtSurface.getTexture()},get mix(){return this._mixSurface.getTexture()},get reflectionColor(){return this._type==bg.render.SurfaceType.OPAQUE?this.lighting:this._opaqueSurfaces.lighting},get reflectionDepth(){return this._type==bg.render.SurfaceType.OPAQUE?this.position:this._opaqueSurfaces.position},get mixDepthMap(){return this._type==bg.render.SurfaceType.OPAQUE?this.position:this._opaqueSurfaces.position},createCommon:function(){var t=this.context;this._gbufferUByteSurface=new bg.base.TextureSurface(t),this._gbufferUByteSurface.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._gbufferUByteSurface.resizeOnViewportChanged=!1,this._gbufferFloatSurface=new bg.base.TextureSurface(t),this._gbufferFloatSurface.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.FLOAT},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._gbufferFloatSurface.resizeOnViewportChanged=!1,this._lightingSurface=new bg.base.TextureSurface(t),this._lightingSurface.create(),this._lightingSurface.resizeOnViewportChanged=!1,this._shadowSurface=new bg.base.TextureSurface(t),this._shadowSurface.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._shadowSurface.resizeOnViewportChanged=!1,this._ssaoSurface=new bg.base.TextureSurface(t),this._ssaoSurface.create(),this._ssaoSurface.resizeOnViewportChanged=!1,this._ssrtSurface=new bg.base.TextureSurface(t),this._ssrtSurface.create(),this._ssrtSurface.resizeOnViewportChanged=!1,this._mixSurface=new bg.base.TextureSurface(t),this._mixSurface.create(),this._mixSurface.resizeOnViewportChanged=!1}},{},t)}(bg.app.ContextObject);bg.render.DeferredRenderSurfaces=n;var i=function(t){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{createOpaque:function(){this._opacityLayer=bg.base.OpacityLayer.OPAQUE,this._surfaces=new bg.render.DeferredRenderSurfaces(this.context),this._surfaces.createOpaqueSurfaces(),e(this)},createTransparent:function(t){this._opacityLayer=bg.base.OpacityLayer.TRANSPARENT,this._surfaces=new bg.render.DeferredRenderSurfaces(this.context),this._surfaces.createTransparentSurfaces(t),e(this),this._gbufferUbyte.blend=!0,this._gbufferUbyte.setBlendMode=bg.base.BlendMode.NORMAL,this._gbufferUbyte.clearColor=bg.Color.Transparent(),this._lighting.clearColor=bg.Color.Black(),this.pipeline.clearColor=bg.Color.Transparent()},set shadowMap(t){this._shadowMap=t},get shadowMap(){return this._shadowMap},get pipeline(){return this._mix},get texture(){return this.maps.mix},draw:function(t,e){this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix),this.matrixState.modelMatrixStack.identity(),this.performDraw(t,e)},get maps(){return this._surfaces},resize:function(t){var e=t.viewport;this.maps.resize(new bg.Size2D(e.width,e.height))},performDraw:function(t,e){var n=this;bg.base.Pipeline.SetCurrent(this._gbufferUbyte),this._gbufferUbyte.viewport=e.viewport,this._gbufferUbyte.clearBuffers(),t.accept(this.ubyteVisitor),bg.base.Pipeline.SetCurrent(this._gbufferFloat),this._gbufferFloat.viewport=e.viewport,this._gbufferFloat.clearBuffers(),t.accept(this.floatVisitor),this._lighting.viewport=e.viewport,this._lighting.clearcolor=bg.Color.White(),this._shadow.viewport=e.viewport,bg.scene.Light.GetActiveLights().forEach(function(i){i.light&&i.light.enabled&&i.node&&i.node.enabled&&(i.light.type!=bg.base.LightType.DIRECTIONAL&&i.light.type!=bg.base.LightType.SPOT||(n._shadowMap.update(t,e,i.light,i.transform),bg.base.Pipeline.SetCurrent(n._shadow),n._shadow.viewport=e.viewport,n._shadow.clearBuffers(),n._shadow.effect.light=i.light,n._shadow.effect.shadowMap=n._shadowMap,t.accept(n.shadowVisitor)),bg.base.Pipeline.SetCurrent(n._lighting),n._lighting.textureEffect.light=i.light,n._lighting.textureEffect.lightTransform=i.transform,n._lighting.textureEffect.shadowMap=n.maps.shadow,n._lighting.drawTexture(n.maps))});var i=this.settings.ambientOcclusion.enabled,r=this.settings.raytracer.enabled,a=new bg.Viewport(e.viewport);if(this._ssao.textureEffect.enabled=i,this._ssao.textureEffect.settings.kernelSize=this.settings.ambientOcclusion.kernelSize,this._ssao.textureEffect.settings.sampleRadius=this.settings.ambientOcclusion.sampleRadius,this._ssao.textureEffect.settings.maxDistance=this.settings.ambientOcclusion.maxDistance,i&&(bg.base.Pipeline.SetCurrent(this._ssao),this._ssao.viewport=e.viewport,this._ssao.clearBuffers(),this._ssao.textureEffect.viewport=e.viewport,this._ssao.textureEffect.projectionMatrix=e.projection,this._ssao.drawTexture(this.maps)),bg.base.Pipeline.SetCurrent(this._ssrt),r){this._ssrt.viewport=a,this._ssrt.clearBuffers(),this._ssrt.textureEffect.quality=this.settings.raytracer.quality;var s=e.node.component("bg.scene.Transform");if(s){var o=new bg.Matrix4(e.projection);o.mult(e.viewMatrix),this._ssrt.textureEffect.cameraPosition=o.multVector(s.matrix.position).xyz}this._ssrt.textureEffect.projectionMatrix=e.projection,this._ssrt.drawTexture(this.maps)}bg.base.Pipeline.SetCurrent(this.pipeline),this.pipeline.viewport=e.viewport,this.pipeline.clearBuffers(),this.pipeline.textureEffect.viewport=e.viewport,this.pipeline.textureEffect.ssaoBlur=i?this.settings.ambientOcclusion.blur:1,this.pipeline.drawTexture({lightingMap:this.maps.lighting,diffuseMap:this.maps.diffuse,positionMap:this.maps.position,ssaoMap:i?this.maps.ambientOcclusion:bg.base.TextureCache.WhiteTexture(this.context),reflectionMap:r?this.maps.reflection:this.maps.lighting,materialMap:this.maps.material,opaqueDepthMap:this.maps.mixDepthMap})}},{},t)}(bg.render.RenderLayer);bg.render.DeferredRenderLayer=i}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._size=new bg.Size2D(0)}return $traceurRuntime.createClass(e,{get isSupported(){return bg.base.RenderSurface.MaxColorAttachments()>5&&bg.base.RenderSurface.SupportFormat(bg.base.RenderSurfaceFormat.FLOAT)&&bg.base.RenderSurface.SupportType(bg.base.RenderSurfaceType.DEPTH)},get pipeline(){return this._pipeline},create:function(){var t=this.context;this._opaqueLayer=new bg.render.DeferredRenderLayer(t),this._opaqueLayer.settings=this.settings,this._opaqueLayer.createOpaque(),this._transparentLayer=new bg.render.DeferredRenderLayer(t),this._transparentLayer.settings=this.settings,this._transparentLayer.createTransparent(this._opaqueLayer.maps),this._shadowMap=new bg.base.ShadowMap(t),this._shadowMap.size=new bg.Vector2(2048),this._opaqueLayer.shadowMap=this._shadowMap,this._transparentLayer.shadowMap=this._shadowMap,this._pipeline=new bg.base.Pipeline(t),this._pipeline.textureEffect=new bg.render.RendererMixEffect(t)},draw:function(t,e){this._size.width==e.viewport.width&&this._size.height==e.viewport.height||(this._opaqueLayer.resize(e),this._transparentLayer.resize(e)),this._opaqueLayer.draw(t,e),this._transparentLayer.draw(t,e),bg.base.Pipeline.SetCurrent(this.pipeline),this.pipeline.viewport=e.viewport,this.pipeline.clearBuffers(),this.pipeline.drawTexture({opaque:this._opaqueLayer.texture,transparent:this._transparentLayer.texture,transparentNormal:this._transparentLayer.maps.normal,opaqueDepth:this._opaqueLayer.maps.position,transparentDepth:this._transparentLayer.maps.position})}},{},t)}(bg.render.Renderer);bg.render.DeferredRenderer=t}(),function(){var t=function(t){function e(t,n){$traceurRuntime.superConstructor(e).call(this,t,n),this._pipeline.effect=new bg.base.ForwardEffect(t),this._pipeline.opacityLayer=n,this._lightComponent=null,n==bg.base.OpacityLayer.TRANSPARENT&&(this._pipeline.buffersToClear=bg.base.ClearBuffers.NONE,this._pipeline.blend=!0,this._pipeline.blendMode=bg.base.BlendMode.NORMAL)}return $traceurRuntime.createClass(e,{set lightComponent(t){this._lightComponent=t},get lightComponent(){return this._lightComponent},set shadowMap(t){this._shadowMap=t},get shadowMap(){return this._shadowMap},draw:function(t,e){bg.base.Pipeline.SetCurrent(this._pipeline),this._pipeline.viewport=e.viewport,0!=e.clearBuffers&&this._pipeline.clearBuffers(),this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix),this.willDraw(t,e),t.accept(this._drawVisitor),this.performDraw(t,e)},willDraw:function(t,e){this._lightComponent&&(this._pipeline.effect.light=this._lightComponent.light,this._pipeline.effect.lightTransform=this._lightComponent.transform,this._pipeline.effect.shadowMap=this._shadowMap)},performDraw:function(t,e){this._pipeline.viewport=e.viewport,t.accept(this.drawVisitor)}},{},t)}(bg.render.RenderLayer);bg.render.ForwardRenderLayer=t}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get isSupported(){return!0},create:function(){var t=this.context;this._transparentLayer=new bg.render.ForwardRenderLayer(t,bg.base.OpacityLayer.TRANSPARENT),this._opaqueLayer=new bg.render.ForwardRenderLayer(t,bg.base.OpacityLayer.OPAQUE),this._shadowMap=new bg.base.ShadowMap(t),this._shadowMap.size=new bg.Vector2(2048)},draw:function(t,e){var n=null;bg.scene.Light.GetActiveLights().some(function(t){if(t.light&&t.light.enabled)return n=t,!0}),n&&(this._shadowMap.update(t,e,n.light,n.transform),this._opaqueLayer.lightComponent=n,this._opaqueLayer.shadowMap=this._shadowMap,this._transparentLayer.lightComponent=n,this._transparentLayer.shadowMap=this._shadowMap),this._opaqueLayer.pipeline.clearColor=this.clearColor,this._opaqueLayer.draw(t,e),this._transparentLayer.draw(t,e)}},{},t)}(bg.render.Renderer);bg.render.ForwardRenderer=t}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=null,n=null,i=null,r=null,a={gbuffer_ubyte_vertex:function(){return e||(e=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),e.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.normal,t().inputs.buffers.tangent,t().inputs.buffers.tex0,t().inputs.buffers.tex1]),e.addParameter(t().inputs.matrix.all),e.addParameter([{name:"fsPosition",dataType:"vec3",role:"out"},{name:"fsTex0Coord",dataType:"vec2",role:"out"},{name:"fsTex1Coord",dataType:"vec2",role:"out"},{name:"fsNormal",dataType:"vec3",role:"out"},{name:"fsTangent",dataType:"vec3",role:"out"},{name:"fsBitangent",dataType:"vec3",role:"out"}]),"webgl1"==bg.Engine.Get().id&&e.setMainBody("\n\t\t\t\t\tvec4 viewPos = inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tgl_Position = inProjectionMatrix * viewPos;\n\t\t\t\t\t\n\t\t\t\t\tfsNormal = normalize((inNormalMatrix  * vec4(inNormal,1.0)).xyz);\n\t\t\t\t\tfsTangent = normalize((inNormalMatrix * vec4(inTangent,1.0)).xyz);\n\t\t\t\t\tfsBitangent = cross(fsNormal,fsTangent);\n\t\t\t\t\t\n\t\t\t\t\tfsTex0Coord = inTex0;\n\t\t\t\t\tfsTex1Coord = inTex1;\n\t\t\t\t\tfsPosition = viewPos.xyz;")),e},gbuffer_ubyte_fragment:function(){return n||(n=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),n.appendHeader("#extension GL_EXT_draw_buffers : require"),n.addParameter([{name:"fsPosition",dataType:"vec3",role:"in"},{name:"fsTex0Coord",dataType:"vec2",role:"in"},{name:"fsTex1Coord",dataType:"vec2",role:"in"},{name:"fsNormal",dataType:"vec3",role:"in"},{name:"fsTangent",dataType:"vec3",role:"in"},{name:"fsBitangent",dataType:"vec3",role:"int"}]),n.addParameter(t().inputs.material.all),n.addFunction(t().functions.materials.all),"webgl1"==bg.Engine.Get().id&&n.setMainBody("\n\t\t\t\t\t\tvec4 lightMap = samplerColor(inLightMap,fsTex1Coord,inLightMapOffset,inLightMapScale);\n\t\t\t\t\t\tvec4 diffuse = samplerColor(inTexture,fsTex0Coord,inTextureOffset,inTextureScale) * inDiffuseColor * lightMap;\n\t\t\t\t\t\tif (diffuse.a>=inAlphaCutoff) {\n\t\t\t\t\t\t\tvec3 normal = samplerNormal(inNormalMap,fsTex0Coord,inNormalMapOffset,inNormalMapScale);\n\t\t\t\t\t\t\tnormal = combineNormalWithMap(fsNormal,fsTangent,fsBitangent,normal);\n\t\t\t\t\t\t\tvec4 specular = specularColor(inSpecularColor,inShininessMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinShininessMaskChannel,inShininessMaskInvert);\n\t\t\t\t\t\t\tfloat lightEmission = applyTextureMask(inLightEmission,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMaskChannel,inLightEmissionMaskInvert);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfloat reflectionMask = applyTextureMask(inReflection,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinReflectionMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinReflectionMaskChannel,inReflectionMaskInvert);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tgl_FragData[0] = diffuse;\n\t\t\t\t\t\t\tgl_FragData[1] = specular;\n\t\t\t\t\t\t\tgl_FragData[2] = vec4(normal * 0.5 + 0.5, 1.0);\n\t\t\t\t\t\t\tgl_FragData[3] = vec4(lightEmission,inShininess/255.0,reflectionMask,float(inCastShadows));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}")),n},gbuffer_float_vertex:function(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,null,t().inputs.matrix.model,t().inputs.matrix.view,t().inputs.matrix.projection,null,{name:"fsPosition",dataType:"vec4",role:"out"},{name:"fsTex0Coord",dataType:"vec2",role:"out"}]),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\t\tfsPosition = inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tfsTex0Coord = inTex0;\n\t\t\t\t\t\n\t\t\t\t\tgl_Position = inProjectionMatrix * fsPosition;")),i},gbuffer_float_fragment:function(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),r.addParameter([t().inputs.material.texture,t().inputs.material.textureScale,t().inputs.material.textureOffset,null,{name:"fsPosition",dataType:"vec4",role:"in"},{name:"fsTex0Coord",dataType:"vec2",role:"in"}]),r.addFunction(t().functions.materials.samplerColor),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\tfloat alpha = samplerColor(inTexture,fsTex0Coord,inTextureOffset,inTextureScale).a;\n\t\t\t\t\t// TODO: texture alpha\n\t\t\t\t\t// if (a<alphaCutoff....etc)\n\t\t\t\t\t\n\t\t\t\t\tgl_FragColor = vec4(fsPosition.xyz,gl_FragCoord.z);")),r}},s=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t);var n=[a.gbuffer_ubyte_vertex(),a.gbuffer_ubyte_fragment()];this._material=null,this.setupShaderSource(n)}return $traceurRuntime.createClass(e,{get material(){return this._material},set material(t){this._material=t},setupVars:function(){if(this.material){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst),this.shader.setMatrix4("inNormalMatrix",t.normalMatrix),this.shader.setMatrix4("inViewMatrixInv",t.viewMatrixInvert);var n=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context),i=this.material.lightmap||bg.base.TextureCache.WhiteTexture(this.context),r=this.material.normalMap||bg.base.TextureCache.NormalTexture(this.context);this.shader.setVector4("inDiffuseColor",this.material.diffuse),this.shader.setVector4("inSpecularColor",this.material.specular),this.shader.setValueFloat("inShininess",this.material.shininess),this.shader.setValueFloat("inLightEmission",this.material.lightEmission),this.shader.setValueFloat("inAlphaCutoff",this.material.alphaCutoff),this.shader.setTexture("inTexture",n,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setTexture("inLightMap",i,bg.base.TextureUnit.TEXTURE_1),this.shader.setVector2("inLightMapOffset",this.material.lightmapOffset),this.shader.setVector2("inLightMapScale",this.material.lightmapScale),this.shader.setTexture("inNormalMap",r,bg.base.TextureUnit.TEXTURE_2),this.shader.setVector2("inNormalMapScale",this.material.normalMapScale),this.shader.setVector2("inNormalMapOffset",this.material.normalMapOffset)
;var a=this.material.shininessMask||bg.base.TextureCache.BlackTexture(this.context),s=this.material.lightEmissionMask||bg.base.TextureCache.WhiteTexture(this.context),o=this.material.reflectionMask||bg.base.TextureCache.BlackTexture(this.context);this.shader.setTexture("inShininessMask",a,bg.base.TextureUnit.TEXTURE_3),this.shader.setVector4("inShininessMaskChannel",this.material.shininessMaskChannelVector),this.shader.setValueInt("inShininessMaskInvert",this.material.shininessMaskInvert),this.shader.setTexture("inLightEmissionMask",s,bg.base.TextureUnit.TEXTURE_4),this.shader.setVector4("inLightEmissionMaskChannel",this.material.lightEmissionMaskChannelVector),this.shader.setValueInt("inLightEmissionMaskInvert",this.material.lightEmissionMaskInvert),this.shader.setValueFloat("inReflection",this.material.reflectionAmount),this.shader.setTexture("inReflectionMask",o,bg.base.TextureUnit.TEXTURE_5),this.shader.setVector4("inReflectionMaskChannel",this.material.reflectionMaskChannelVector),this.shader.setValueInt("inReflectionMaskInvert",this.material.reflectionMaskInvert),this.shader.setValueInt("inCastShadows",this.material.castShadows)}}},{},t)}(bg.base.Effect),o=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t);var n=[a.gbuffer_float_vertex(),a.gbuffer_float_fragment()];this._material=null,this.setupShaderSource(n)}return $traceurRuntime.createClass(e,{get material(){return this._material},set material(t){this._material=t},setupVars:function(){if(this.material){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst);var n=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context);this.shader.setTexture("inTexture",n,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale)}}},{},t)}(bg.base.Effect);bg.render.PositionGBufferEffect=o,bg.render.GBufferEffect=s}(),function(){function t(t,e,n,i){bg.base.Pipeline.SetCurrent(t),t.viewport=i.viewport,t.clearBuffers(bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH),n.accept(e)}var e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._pipelines={ubyte:new bg.base.Pipeline(t),float:new bg.base.Pipeline(t)};var e=new bg.base.TextureSurface(t);e.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._pipelines.ubyte.effect=new bg.render.GBufferEffect(t),this._pipelines.ubyte.renderSurface=e;var i=new bg.base.TextureSurface(t);i.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.FLOAT},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._pipelines.float.effect=new bg.render.PositionGBufferEffect(t),this._pipelines.float.renderSurface=i,this._ubyteDrawVisitor=new bg.scene.DrawVisitor(this._pipelines.ubyte,this._matrixState),this._floatDrawVisitor=new bg.scene.DrawVisitor(this._pipelines.float,this._matrixState)}return $traceurRuntime.createClass(n,{get diffuse(){return this._pipelines.ubyte.renderSurface.getTexture(0)},get specular(){return this._pipelines.ubyte.renderSurface.getTexture(1)},get normal(){return this._pipelines.ubyte.renderSurface.getTexture(2)},get material(){return this._pipelines.ubyte.renderSurface.getTexture(3)},get position(){return this._pipelines.float.renderSurface.getTexture(0)},get shadow(){return this._pipelines.ubyte.renderSurface.getTexture(4)},update:function(e,n){t(this._pipelines.ubyte,this._ubyteDrawVisitor,e,n),t(this._pipelines.float,this._floatDrawVisitor,e,n)}},{},e)}(bg.app.ContextObject);bg.render.GBufferSet=e}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inDiffuse",dataType:"sampler2D",role:"value"},{name:"inSpecular",dataType:"sampler2D",role:"value"},{name:"inNormal",dataType:"sampler2D",role:"value"},{name:"inMaterial",dataType:"sampler2D",role:"value"},{name:"inPosition",dataType:"sampler2D",role:"value"},{name:"inShadowMap",dataType:"sampler2D",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),this._fragmentShaderSource.addParameter(t().inputs.lighting.all),this._fragmentShaderSource.addFunction(t().functions.utils.all),this._fragmentShaderSource.addFunction(t().functions.lighting.all),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tvec4 diffuse = texture2D(inDiffuse,fsTexCoord);\n\t\t\t\t\tvec4 specular = texture2D(inSpecular,fsTexCoord);\n\t\t\t\t\tvec3 normal = texture2D(inNormal,fsTexCoord).xyz * 2.0 - 1.0;\n\t\t\t\t\tvec4 material = texture2D(inMaterial,fsTexCoord);\n\t\t\t\t\tvec4 position = texture2D(inPosition,fsTexCoord);\n\t\t\t\t\t\n\t\t\t\t\tvec4 shadowColor = texture2D(inShadowMap,fsTexCoord);\n\t\t\t\t\tfloat shininess = material.g * 255.0;\n\t\t\t\t\tgl_FragColor = getDirectionalLight(inLightAmbient,inLightDiffuse,inLightSpecular,shininess,\n\t\t\t\t\t\t\t\t\t\t-inLightDirection,position.rgb,normal,diffuse,specular,shadowColor);")),this._fragmentShaderSource},setupVars:function(){if(this.shader.setTexture("inDiffuse",this._surface.diffuse,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inSpecular",this._surface.specular,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inNormal",this._surface.normal,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inMaterial",this._surface.material,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inPosition",this._surface.position,bg.base.TextureUnit.TEXTURE_4),this.shader.setTexture("inShadowMap",this._shadowMap,bg.base.TextureUnit.TEXTURE_5),this.light){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setVector4("inLightAmbient",this._light.ambient),this.shader.setVector4("inLightDiffuse",this._light.diffuse),this.shader.setVector4("inLightSpecular",this._light.specular);var n=e.mult(this._lightTransform).rotation.multVector(this._light.direction).xyz;this.shader.setVector3("inLightDirection",n)}},get light(){return this._light},set light(t){this._light=t},get lightTransform(){return this._lightTransform},set lightTransform(t){this._lightTransform=t},get shadowMap(){return this._shadowMap},set shadowMap(t){this._shadowMap=t}},{},e)}(bg.base.TextureEffect);bg.render.LightingEffect=e}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inOpaque",dataType:"sampler2D",role:"value"},{name:"inTransparent",dataType:"sampler2D",role:"value"},{name:"inTransparentNormal",dataType:"sampler2D",role:"value"},{name:"inOpaqueDepth",dataType:"sampler2D",role:"value"},{name:"inTransparentDepth",dataType:"sampler2D",role:"value"},{name:"inRefractionAmount",dataType:"float",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\t\tvec4 opaque = texture2D(inOpaque,fsTexCoord);\n\t\t\t\t\t\tvec4 transparent = texture2D(inTransparent,fsTexCoord);\n\t\t\t\t\t\tvec3 normal = texture2D(inTransparentNormal,fsTexCoord).rgb * 2.0 - 1.0;\n\t\t\t\t\t\tif (transparent.a>0.0) {\n\t\t\t\t\t\t\tfloat refractionFactor = inRefractionAmount / texture2D(inTransparentDepth,fsTexCoord).z;\n\t\t\t\t\t\t\tvec2 offset = fsTexCoord - normal.xy * refractionFactor;\n\t\t\t\t\t\t\tvec4 opaqueDepth = texture2D(inOpaqueDepth,offset);\n\t\t\t\t\t\t\tvec4 transparentDepth = texture2D(inTransparentDepth,offset);\n\t\t\t\t\t\t\t//if (opaqueDepth.w>transparentDepth.w) {\n\t\t\t\t\t\t\t\topaque = texture2D(inOpaque,offset);\n\t\t\t\t\t\t\t//}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvec3 color = opaque.rgb * (1.0 - transparent.a) + transparent.rgb * transparent.a;\n\t\t\t\t\t\tgl_FragColor = vec4(color, 1.0);\n\t\t\t\t\t\t")),this._fragmentShaderSource},setupVars:function(){this.shader.setTexture("inOpaque",this._surface.opaque,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inTransparent",this._surface.transparent,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inTransparentNormal",this._surface.transparentNormal,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inOpaqueDepth",this._surface.opaqueDepth,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inTransparentDepth",this._surface.transparentDepth,bg.base.TextureUnit.TEXTURE_4),this.shader.setValueFloat("inRefractionAmount",this.settings.refractionAmount)},get settings(){return this._settings||(this._currentKernelSize=0,this._settings={refractionAmount:.01}),this._settings}},{},t)}(bg.base.TextureEffect);bg.render.RendererMixEffect=t}(),function(){function t(){return bg.base.ShaderLibrary.Get()}bg.render.ShadowType={HARD:1,SOFT:2};var e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e);var i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT);i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,null,t().inputs.matrix.model,t().inputs.matrix.view,t().inputs.matrix.projection,{name:"inLightProjectionMatrix",dataType:"mat4",role:"value"},{name:"inLightViewMatrix",dataType:"mat4",role:"value"},null,{name:"fsTexCoord",dataType:"vec2",role:"out"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"out"}]),r.addParameter(t().inputs.shadows.all),r.addFunction(t().functions.utils.unpack),r.addFunction(t().functions.lighting.getShadowColor),r.addParameter([t().inputs.material.receiveShadows,t().inputs.material.texture,t().inputs.material.textureOffset,t().inputs.material.textureScale,t().inputs.material.alphaCutoff,null,{name:"fsTexCoord",dataType:"vec2",role:"in"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"in"}]),r.addFunction(t().functions.materials.samplerColor),"webgl1"==bg.Engine.Get().id&&(i.setMainBody("\n\t\t\t\t\tmat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.5, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.0, 0.5, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.5, 0.5, 0.5, 1.0);\n\t\t\t\t\t\n\t\t\t\t\tfsVertexPosFromLight = ScaleMatrix * inLightProjectionMatrix * inLightViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tfsTexCoord = inTex0;\n\t\t\t\t\t\n\t\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);"),r.setMainBody("\n\t\t\t\t\tfloat alpha = samplerColor(inTexture,fsTexCoord,inTextureOffset,inTextureScale).a;\n\t\t\t\t\tif (alpha>inAlphaCutoff) {\n\t\t\t\t\t\tvec4 shadowColor = vec4(1.0);\n\t\t\t\t\t\tif (inReceiveShadows) {\n\t\t\t\t\t\t\tshadowColor = getShadowColor(fsVertexPosFromLight,inShadowMap,inShadowMapSize,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t inShadowType,inShadowStrength,inShadowBias,inShadowColor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tgl_FragColor = shadowColor;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}")),this.setupShaderSource([i,r])}return $traceurRuntime.createClass(n,{beginDraw:function(){if(this.light&&this.shadowMap){var t=bg.base.MatrixState.Current(),e=(new bg.Matrix4(t.viewMatrixStack.matrixConst),this.shadowMap.viewMatrix);this.shader.setMatrix4("inLightProjectionMatrix",this.shadowMap.projection),this.shader.setMatrix4("inLightViewMatrix",e),this.shader.setValueInt("inShadowType",this.shadowMap.shadowType),this.shader.setTexture("inShadowMap",this.shadowMap.texture,bg.base.TextureUnit.TEXTURE_1),this.shader.setVector2("inShadowMapSize",this.shadowMap.size),this.shader.setValueFloat("inShadowStrength",this.light.shadowStrength),this.shader.setVector4("inShadowColor",this.shadowMap.shadowColor),this.shader.setValueFloat("inShadowBias",this.light.shadowBias)}},setupVars:function(){if(this.material&&this.light){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst);var n=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context);this.shader.setTexture("inTexture",n,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setValueFloat("inAlphaCutoff",this.material.alphaCutoff),this.shader.setValueInt("inReceiveShadows",this.material.receiveShadows)}},get material(){return this._material},set material(t){this._material=t},get light(){return this._light},set light(t){this._light=t},get shadowMap(){return this._shadowMap},set shadowMap(t){this._shadowMap=t}},{},e)}(bg.base.Effect);bg.render.ShadowEffect=e}(),function(){var t=64,e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inViewportSize",dataType:"vec2",role:"value"},{name:"inPositionMap",dataType:"sampler2D",role:"value"},{name:"inNormalMap",dataType:"sampler2D",role:"value"},{name:"inProjectionMatrix",dataType:"mat4",role:"value"},{name:"inRandomMap",dataType:"sampler2D",role:"value"},{name:"inRandomMapSize",dataType:"vec2",role:"value"},{name:"inSampleRadius",dataType:"float",role:"value"},{name:"inKernelOffsets",dataType:"vec3",role:"value",vec:t},{name:"inKernelSize",dataType:"int",role:"value"},{name:"inSSAOColor",dataType:"vec4",role:"value"},{name:"inEnabled",dataType:"bool",role:"value"},{name:"inMaxDistance",dataType:"float",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tif (!inEnabled) discard;\n\t\t\t\t\telse {\n\t\t\t\t\t\tvec3 normal = texture2D(inNormalMap,fsTexCoord).xyz * 2.0 - 1.0;\n\t\t\t\t\t\tvec4 vertexPos = texture2D(inPositionMap,fsTexCoord);\n\t\t\t\t\t\tif (distance(vertexPos.xyz,vec3(0))>inMaxDistance || vertexPos.w==1.0) {\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tvec2 noiseScale = vec2(inViewportSize.x/inRandomMapSize.x,inViewportSize.y/inRandomMapSize.y);\n\t\t\t\t\t\t\tvec3 randomVector = texture2D(inRandomMap, fsTexCoord * noiseScale).xyz * 2.0 - 1.0;\n\t\t\t\t\t\t\tvec3 tangent = normalize(randomVector - normal * dot(randomVector, normal));\n\t\t\t\t\t\t\tvec3 bitangent = cross(normal,tangent);\n\t\t\t\t\t\t\tmat3 tbn = mat3(tangent, bitangent, normal);\n\n\t\t\t\t\t\t\tfloat occlusion = 0.0;\n\t\t\t\t\t\t\tfor (int i=0; i<"+t+"; ++i) {\n\t\t\t\t\t\t\t\tif (inKernelSize==i) break;\n\t\t\t\t\t\t\t\tvec3 samplePos = tbn * inKernelOffsets[i];\n\t\t\t\t\t\t\t\tsamplePos = samplePos * inSampleRadius + vertexPos.xyz;\n\n\t\t\t\t\t\t\t\tvec4 offset = inProjectionMatrix * vec4(samplePos, 1.0);\t// -w, w\n\t\t\t\t\t\t\t\toffset.xyz /= offset.w;\t// -1, 1\n\t\t\t\t\t\t\t\toffset.xyz = offset.xyz * 0.5 + 0.5;\t// 0, 1\n\n\t\t\t\t\t\t\t\tvec4 sampleRealPos = texture2D(inPositionMap, offset.xy);\n\t\t\t\t\t\t\t\tif (samplePos.z<sampleRealPos.z) {\n\t\t\t\t\t\t\t\t\tfloat dist = distance(vertexPos.xyz, sampleRealPos.xyz);\n\t\t\t\t\t\t\t\t\tocclusion += dist<inSampleRadius ? 1.0:0.0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tocclusion = 1.0 - (occlusion / float(inKernelSize));\n\t\t\t\t\t\t\tgl_FragColor = clamp(vec4(occlusion, occlusion, occlusion, 1.0) + inSSAOColor, 0.0, 1.0);\n\t\t\t\t\t\t\t//gl_FragColor = vec4(1.0, 0.0, 0.0 ,1.0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}")),this._fragmentShaderSource},setupVars:function(){this.settings.kernelSize>t&&(this.settings.kernelSize=t),this.shader.setVector2("inViewportSize",new bg.Vector2(this.viewport.width,this.viewport.height)),this.shader.setTexture("inPositionMap",this._surface.position,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inNormalMap",this._surface.normal,bg.base.TextureUnit.TEXTURE_1),this.shader.setMatrix4("inProjectionMatrix",this.projectionMatrix),this.shader.setTexture("inRandomMap",this.randomMap,bg.base.TextureUnit.TEXTURE_2),this.shader.setVector2("inRandomMapSize",this.randomMap.size),this.shader.setValueFloat("inSampleRadius",this.settings.sampleRadius),this.shader.setVector3Ptr("inKernelOffsets",this.kernelOffsets),this.shader.setValueInt("inKernelSize",this.settings.kernelSize),this.shader.setVector4("inSSAOColor",this.settings.color),this.shader.setValueInt("inEnabled",this.settings.enabled),this.shader.setValueFloat("inMaxDistance",this.settings.maxDistance)},get viewport(){return this._viewport},set viewport(t){this._viewport=t},get projectionMatrix(){return this._projectionMatrix},set projectionMatrix(t){this._projectionMatrix=t},get randomMap(){return this._randomMap||(this._randomMap=bg.base.TextureCache.RandomTexture(this.context)),this._randomMap},set randomMap(t){this._randomMap=t},get settings(){return this._settings||(this._currentKernelSize=0,this._settings={kernelSize:32,sampleRadius:.3,color:bg.Color.Black(),blur:4,maxDistance:100,enabled:!0}),this._settings},get kernelOffsets(){if(this._currentKernelSize!=this.settings.kernelSize){this._kernelOffsets=[];for(var t=0;t<3*this.settings.kernelSize;t+=3){var e=new bg.Vector3(2*bg.Math.random()-1,2*bg.Math.random()-1,bg.Math.random());e.normalize();var n=t/3/this.settings.kernelSize;n=bg.Math.lerp(.1,1,n*n),e.scale(n),this._kernelOffsets.push(e.x),this._kernelOffsets.push(e.y),this._kernelOffsets.push(e.z)}this._currentKernelSize=this.settings.kernelSize}return this._kernelOffsets}},{},e)}(bg.base.TextureEffect);bg.render.SSAOEffect=e}(),function(){bg.render.RaytracerQuality={low:{maxSamples:20,rayIncrement:.05},mid:{maxSamples:50,rayIncrement:.025},high:{maxSamples:100,rayIncrement:.0125},extreme:{maxSamples:200,rayIncrement:.0062}};var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get fragmentShaderSource(){if(!this._fragmentShaderSource){this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT);var t=this.quality;this._fragmentShaderSource.addParameter([{name:"inPositionMap",dataType:"sampler2D",role:"value"},{name:"inNormalMap",dataType:"sampler2D",role:"value"},{name:"inLightingMap",dataType:"sampler2D",role:"value"},{name:"inMaterialMap",dataType:"sampler2D",role:"value"},{name:"inSamplePosMap",dataType:"sampler2D",role:"value"},{name:"inProjectionMatrix",dataType:"mat4",role:"value"},{name:"inCameraPos",dataType:"vec3",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\t\tvec3 normal = texture2D(inNormalMap,fsTexCoord).xyz * 2.0 - 1.0;\n\t\t\t\t\t\tvec4 vertexPos = texture2D(inPositionMap,fsTexCoord);\n\t\t\t\t\t\tvec3 cameraVector = vertexPos.xyz - inCameraPos;\n\t\t\t\t\t\tvec3 rayDirection = reflect(cameraVector,normal);\n\t\t\t\t\t\tvec4 lighting = texture2D(inLightingMap,fsTexCoord);\n\t\t\t\t\t\tvec4 material = texture2D(inMaterialMap,fsTexCoord);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat increment = "+t.rayIncrement+";\n\t\t\t\t\t\tvec4 result = vec4(0.0,0.0,0.0,0.0);\n\t\t\t\t\t\tif (material.b>0.0) {\t// material[2] is reflectionAmount\n\t\t\t\t\t\t\tresult = vec4(0.0,0.0,0.0,1.0);\n\t\t\t\t\t\t\tfor (float i=0.0; i<"+t.maxSamples+".0; ++i) {\n\t\t\t\t\t\t\t\tif (i=="+t.maxSamples+".0) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat radius = i * increment;\n\t\t\t\t\t\t\t\tincrement *= 1.01;\n\t\t\t\t\t\t\t\tvec3 ray = vertexPos.xyz + rayDirection * radius;\n\n\t\t\t\t\t\t\t\tvec4 offset = inProjectionMatrix * vec4(ray, 1.0);\t// -w, w\n\t\t\t\t\t\t\t\toffset.xyz /= offset.w;\t// -1, 1\n\t\t\t\t\t\t\t\toffset.xyz = offset.xyz * 0.5 + 0.5;\t// 0, 1\n\n\t\t\t\t\t\t\t\tvec4 rayActualPos = texture2D(inSamplePosMap, offset.xy);\n\t\t\t\t\t\t\t\tfloat hitDistance = rayActualPos.z - ray.z;\n\t\t\t\t\t\t\t\tif (rayActualPos.w<0.6) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (offset.x>1.0 || offset.y>1.0) {\n\t\t\t\t\t\t\t\t\tresult = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (hitDistance>0.02 && hitDistance<0.4) {\n\t\t\t\t\t\t\t\t\tresult = texture2D(inLightingMap,offset.xy);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (result.a==0.0) {\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tgl_FragColor = result;\n\t\t\t\t\t\t}")}return this._fragmentShaderSource},setupVars:function(){this.shader.setTexture("inPositionMap",this._surface.position,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inNormalMap",this._surface.normal,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inLightingMap",this._surface.reflectionColor,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inMaterialMap",this._surface.material,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inSamplePosMap",this._surface.reflectionDepth,bg.base.TextureUnit.TEXTURE_4),this.shader.setMatrix4("inProjectionMatrix",this._projectionMatrix),this.shader.setVector3("inCameraPos",this._cameraPos)},get projectionMatrix(){return this._projectionMatrix},set projectionMatrix(t){this._projectionMatrix=t},get cameraPosition(){return this._cameraPos},set cameraPosition(t){this._cameraPos=t},get quality(){return this._quality||bg.render.RaytracerQuality.low},set quality(t){this._quality&&this._quality.maxSamples==t.maxSamples&&this._quality.rayIncrement==t.rayIncrement||(this._quality=t,this._fragmentShaderSource=null,this.rebuildShaders())},get settings(){return this._settings,this._settings}},{},t)}(bg.base.TextureEffect);bg.render.SSRTEffect=t}(),bg.webgl1={},function(){var t="webgl1";bg.webgl1.EngineId=t;var e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e),bg.webgl1.Extensions.Get(e),this._engineId=t,this._texture=new bg.webgl1.TextureImpl(e),this._pipeline=new bg.webgl1.PipelineImpl(e),this._polyList=new bg.webgl1.PolyListImpl(e),this._shader=new bg.webgl1.ShaderImpl(e),this._colorBuffer=new bg.webgl1.ColorRenderSurfaceImpl(e),this._textureBuffer=new bg.webgl1.TextureRenderSurfaceImpl(e),this._shaderSource=new bg.webgl1.ShaderSourceImpl}return $traceurRuntime.createClass(n,{},{},e)}(bg.Engine);bg.webgl1.Engine=e}(),function(){bg.webgl1.shaderLibrary={inputs:{},functions:{}};var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{header:function(t){return"precision highp float;\nprecision highp int;"},parameter:function(t,e){if(!e)return"\n";var n="";switch(e.role){case"buffer":n="attribute";break;case"value":n="uniform";break;case"in":case"out":n="varying"}var i="";return e.vec&&(i="["+e.vec+"]"),n+" "+e.dataType+" "+e.name+i+";"},func:function(t,e){if(!e)return"\n";var n="";for(var i in e.params)n+=e.params[i]+" "+i+",";return(e.returnType+" "+e.name+"("+n+") {").replace(",)",")")+("\n"+bg.base.ShaderSource.FormatSource(e.body)).replace(/\n/g,"\n\t")+"\n}"}},{},t)}(bg.base.ShaderSourceImpl);bg.webgl1.ShaderSourceImpl=t}(),function(){var t=null,e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{getExtension:function(t){return this.context.getExtension(t)},get textureFloat(){return void 0===this._textureFloat&&(this._textureFloat=this.getExtension("OES_texture_float")),this._textureFloat},get depthTexture(){return void 0===this._depthTexture&&(this._depthTexture=this.getExtension("WEBGL_depth_texture")),this._depthTexture},get drawBuffers(){return void 0===this._drawBuffers&&(this._drawBuffers=this.getExtension("WEBGL_draw_buffers")),this._drawBuffers}},{Get:function(e){return t||(t=new n(e)),t}},e)}(bg.app.ContextObject);bg.webgl1.Extensions=e}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){bg.base.ClearBuffers.COLOR=t.COLOR_BUFFER_BIT,bg.base.ClearBuffers.DEPTH=t.DEPTH_BUFFER_BIT},setViewport:function(t,e){t.viewport(e.x,e.y,e.width,e.height)},clearBuffers:function(t,e,n){t.clearColor(e.r,e.g,e.b,e.a),t.clear(n)},setDepthTestEnabled:function(t,e){e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)},setCullFace:function(t,e){e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE)},setBlendEnabled:function(t,e){e?t.enable(t.BLEND):t.disable(t.BLEND)},setBlendMode:function(t,e){switch(e){case bg.base.BlendMode.NORMAL:t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.MULTIPLY:t.blendFunc(t.ZERO,t.SRC_COLOR),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.ADD:t.blendFunc(t.ONE,t.ONE),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.SUBTRACT:t.blendFunc(t.ONE,t.ONE),t.blendEquation(t.FUNC_SUBTRACT);break;case bg.base.BlendMode.ALPHA_ADD:t.blendFunc(t.SRC_ALPHA,t.SRC_ALPHA),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.ALPHA_SUBTRACT:t.blendFunc(t.SRC_ALPHA,t.SRC_ALPHA),t.blendEquation(t.FUNC_SUBTRACT)}}},{},t)}(bg.base.PipelineImpl);bg.webgl1.PipelineImpl=t}(),function(){function t(t,e,n,i){var r=null;return e.length&&(r=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),i),r.itemSize=n,r.numItems=e.length/n),r}function e(t,e){return e&&t.deleteBuffer(e),null}var n=function(n){function i(){$traceurRuntime.superConstructor(i).apply(this,arguments)}return $traceurRuntime.createClass(i,{initFlags:function(t){bg.base.DrawMode.TRIANGLES=t.TRIANGLES,bg.base.DrawMode.TRIANGLE_FAN=t.TRIANGLE_FAN,bg.base.DrawMode.TRIANGLE_STRIP=t.TRIANGLE_STRIP},create:function(t){return{vertexBuffer:null,normalBuffer:null,tex0Buffer:null,tex1Buffer:null,tex2Buffer:null,colorBuffer:null,tangentBuffer:null,indexBuffer:null}},build:function(e,n,i,r,a,s,o,u,l,c){return n.vertexBuffer=t(e,i,3,e.STATIC_DRAW),n.normalBuffer=t(e,r,3,e.STATIC_DRAW),n.tex0Buffer=t(e,a,2,e.STATIC_DRAW),n.tex1Buffer=t(e,s,2,e.STATIC_DRAW),n.tex2Buffer=t(e,o,2,e.STATIC_DRAW),n.colorBuffer=t(e,u,4,e.STATIC_DRAW),n.tangentBuffer=t(e,l,3,e.STATIC_DRAW),c.length>0&&(n.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),e.STATIC_DRAW),n.indexBuffer.itemSize=3,n.indexBuffer.numItems=c.length),n.vertexBuffer&&n.indexBuffer},draw:function(t,e,n,i){t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.indexBuffer),t.drawElements(n,i,t.UNSIGNED_SHORT,0)},destroy:function(t,n){t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),n.vertexBuffer=e(t,n.vertexBuffer),n.normalBuffer=e(t,n.normalBuffer),n.tex0Buffer=e(t,n.tex0Buffer),n.tex1Buffer=e(t,n.tex1Buffer),n.tex2Buffer=e(t,n.tex2Buffer),n.colorBuffer=e(t,n.colorBuffer),n.tangentBuffer=e(t,n.tangentBuffer),n.indexBuffer=e(t,n.indexBuffer)}},{},n)}(bg.base.PolyListImpl);bg.webgl1.PolyListImpl=n}(),function(){function t(){return o.drawBuffers?o.drawBuffers.MAX_COLOR_ATTACHMENTS||o.drawBuffers.MAX_COLOR_ATTACHMENTS_WEBGL:1}function e(t){switch(!0){case t.type==bg.base.RenderSurfaceType.RGBA&&t.format==bg.base.RenderSurfaceFormat.UNSIGNED_BYTE:case t.type==bg.base.RenderSurfaceType.RGBA&&t.format==bg.base.RenderSurfaceFormat.FLOAT:case t.type==bg.base.RenderSurfaceType.DEPTH&&t.format==bg.base.RenderSurfaceFormat.RENDERBUFFER:case t.type==bg.base.RenderSurfaceType.DEPTH&&t.format==bg.base.RenderSurfaceFormat.UNSIGNED_SHORT:return!0;default:return!1}}function n(t){switch(t){case bg.base.RenderSurfaceType.RGBA:return"RGBA";case bg.base.RenderSurfaceType.DEPTH:return"DEPTH";default:return"unknown"}}function i(t){switch(t){case bg.base.RenderSurfaceFormat.UNSIGNED_BYTE:return"UNSIGNED_BYTE";case bg.base.RenderSurfaceFormat.FLOAT:return"FLOAT";case bg.base.RenderSurfaceFormat.RENDERBUFFER:return"RENDERBUFFER";case bg.base.RenderSurfaceFormat.UNSIGNED_SHORT:return"UNSIGNED_SHORT";default:return"unknown"}}function r(r){var a=0,s=t(),u=null;return r.every(function(t,l){return e(t)?t.type==bg.base.RenderSurfaceType.DEPTH&&l!=r.length-1?(u="Error in attachment "+l+": Depth attachment must be specified as the last attachment. Specified at index "+l+" of "+(r.length-1),!1):(t.type==bg.base.RenderSurfaceType.RGBA&&++a,t.format!=bg.base.RenderSurfaceFormat.FLOAT||o.textureFloat?t.type!=bg.base.RenderSurfaceType.DEPTH||t.format==bg.base.RenderSurfaceFormat.RENDERBUFFER||o.depthTexture?!(a>s)||(u="Error in attachment "+l+": Maximum number of "+s+" color attachment exceeded.",!1):(u="Error in attachment "+l+": Depth texture attachment requested, but the requiered extension is not present: WEBGL_depth_texture.",!1):(u="Error in attachment "+l+": Floating point render surface requested, but the required extension is not present: OES_texture_float.",!1)):(u="Error in attachment "+l+": Invalid combination of type and format ("+n(t.type)+" is incompatible with "+i(t.format)+").",!1)}),u}function a(t,e,n,i){if(n.format==bg.base.RenderSurfaceFormat.RENDERBUFFER){var r=t.createRenderbuffer();return t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,r),t.bindRenderbuffer(t.RENDERBUFFER,null),{_renderbuffer:r}}var a=new bg.base.Texture(t),s=n.format,o=n.type;return a.create(),a.bind(),a.minFilter=bg.base.TextureFilter.LINEAR,a.magFilter=bg.base.TextureFilter.LINEAR,a.wrapX=bg.base.TextureWrap.CLAMP,a.wrapY=bg.base.TextureWrap.CLAMP,a.setImageRaw(e.width,e.height,null,o,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+i,t.TEXTURE_2D,a._texture,0),a.unbind(),a}function s(t,e,n,i){if(n.texture&&(n.texture.bind(),n.texture.setImageRaw(e.width,e.height,null,n.type,n.format),n.texture.unbind()),n.renderbuffer){var r=n.renderbuffer._renderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}}var o=null,u=function(e){function n(){$traceurRuntime.superConstructor(n).apply(this,arguments)}return $traceurRuntime.createClass(n,{initFlags:function(t){bg.base.RenderSurfaceType.RGBA=t.RGBA,bg.base.RenderSurfaceType.DEPTH=t.DEPTH_COMPONENT,bg.base.RenderSurfaceFormat.UNSIGNED_BYTE=t.UNSIGNED_BYTE,bg.base.RenderSurfaceFormat.UNSIGNED_SHORT=t.UNSIGNED_SHORT,bg.base.RenderSurfaceFormat.FLOAT=t.FLOAT,bg.base.RenderSurfaceFormat.RENDERBUFFER=t.RENDERBUFFER,o=bg.webgl1.Extensions.Get()},supportType:function(t){switch(t){case bg.base.RenderSurfaceType.RGBA:return!0;case bg.base.RenderSurfaceType.DEPTH:return null!=o.depthTexture;default:return!1}},supportFormat:function(t){switch(t){case bg.base.RenderSurfaceFormat.UNSIGNED_BYTE:case bg.base.RenderSurfaceFormat.UNSIGNED_SHORT:return!0;case bg.base.RenderSurfaceFormat.FLOAT:return null!=o.textureFloat;default:return!1}},get maxColorAttachments(){return t()}},{},e)}(bg.base.RenderSurfaceBufferImpl),l=function(t){function e(){
$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{create:function(t){return{}},setActive:function(t,e,n){t.bindFramebuffer(t.FRAMEBUFFER,null)},resize:function(t,e,n){},destroy:function(t,e){}},{},t)}(u);bg.webgl1.ColorRenderSurfaceImpl=l;var c=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){},create:function(t,e){var n=r(e);if(n)throw new Error(n);var i=new bg.Vector2(256),s={fbo:t.createFramebuffer(),size:i,attachments:[]};t.bindFramebuffer(t.FRAMEBUFFER,s.fbo);var u=[];return e.forEach(function(e,n){var r=a(t,i,e,n);r instanceof bg.base.Texture&&u.push(o.drawBuffers?o.drawBuffers.COLOR_ATTACHMENT0_WEBGL+n:t.COLOR_ATTACHMENT0),s.attachments.push({texture:r instanceof bg.base.Texture?r:null,renderbuffer:r instanceof bg.base.Texture?null:r,format:e.format,type:e.type})}),u.length>1&&o.drawBuffers.drawBuffersWEBGL(u),t.bindFramebuffer(t.FRAMEBUFFER,null),s},setActive:function(t,e){t.bindFramebuffer(t.FRAMEBUFFER,e.fbo)},readBuffer:function(t,e,n,i){var r=new Uint8Array(n.width*n.height*4);return t.readPixels(n.x,i.height-n.y,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,r),r},resize:function(t,e,n){e.size.width=n.width,e.size.height=n.height,e.attachments.forEach(function(e,i){s(t,n,e,i)})},destroy:function(t,e){t.bindFramebuffer(t.FRAMEBUFFER,null);var n=e&&e.attachments;e.fbo&&t.deleteFramebuffer(e.fbo),n&&n.forEach(function(e){e.texture?e.texture.destroy():e.renderbuffer&&t.deleteRenderbuffer(e.renderbuffer._renderbuffer)}),e.fbo=null,e.size=null,e.attachments=null}},{},t)}(u);bg.webgl1.TextureRenderSurfaceImpl=c}(),function(){var t={textureInput:"sampler2D",texCoord:"vec2",size:"int",samplerSize:"vec2"},e="\n\t\tvec2 texelSize = 1.0 / samplerSize;\n\t\tvec3 result = vec3(0.0);\n\t\tvec2 hlim = vec2(float(-size) * 0.5 + 0.5);\n\t\tfor (int x=0; x<25; ++x) {\n\t\t\tif (x==size) break;\n\t\t\tfor (int y=0; y<25; ++y) {\n\t\t\t\tif (y==size) break;\n\t\t\t\tvec2 offset = (hlim + vec2(float(x), float(y))) * texelSize;\n\t\t\t\tresult += texture2D(textureInput, texCoord + offset).rgb;\n\t\t\t}\n\t\t}\n\t\treturn vec4(result / float(size * size), 1.0);\n\t\t";bg.webgl1.shaderLibrary.functions.blur={gaussianBlur:{returnType:"vec4",name:"gaussianBlur",params:t,body:e},blur:{returnType:"vec4",name:"blur",params:t,body:e}}}(),function(){bg.webgl1.shaderLibrary.functions.colorCorrection={rgb2hsv:{returnType:"vec3",name:"rgb2hsv",params:{c:"vec3"},body:"\n\t\t\t\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\t\t\t\tvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n\t\t\t\tvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n\t\t\t\tfloat d = q.x - min(q.w, q.y);\n\t\t\t\tfloat e = 1.0e-10;\n\t\t\t\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);"},hsv2rgb:{returnType:"vec3",name:"hsv2rgb",params:{c:"vec3"},body:"\n\t\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);"},applyBrightness:{returnType:"vec4",name:"applyBrightness",params:{color:"vec4",brightness:"float"},body:"\n\t\t\t\t\treturn clamp(vec4(color.rgb + brightness - 0.5,1.0),0.0,1.0);\n\t\t\t\t"},applyContrast:{returnType:"vec4",name:"applyContrast",params:{color:"vec4",contrast:"float"},body:"\n\t\t\t\treturn clamp(vec4((color.rgb * max(contrast + 0.5,0.0)),1.0),0.0,1.0);"},applySaturation:{returnType:"vec4",name:"applySaturation",params:{color:"vec4",hue:"float",saturation:"float",lightness:"float"},body:"\n\t\t\t\tvec3 fragRGB = clamp(color.rgb + vec3(0.001),0.0,1.0);\n\t\t\t\tvec3 fragHSV = rgb2hsv(fragRGB);\n\t\t\t\tlightness -= 0.01;\n\t\t\t\tfloat h = hue;\n\t\t\t\tfragHSV.x *= h;\n\t\t\t\tfragHSV.yz *= vec2(saturation,lightness);\n\t\t\t\tfragHSV.x = mod(fragHSV.x, 1.0);\n\t\t\t\tfragHSV.y = mod(fragHSV.y, 1.0);\n\t\t\t\tfragHSV.z = mod(fragHSV.z, 1.0);\n\t\t\t\tfragRGB = hsv2rgb(fragHSV);\n\t\t\t\treturn clamp(vec4(hsv2rgb(fragHSV), color.w),0.0,1.0);"},colorCorrection:{returnType:"vec4",name:"colorCorrection",params:{fragColor:"vec4",hue:"float",saturation:"float",lightness:"float",brightness:"float",contrast:"float"},body:"\n\t\t\t\treturn applyContrast(applyBrightness(applySaturation(fragColor,hue,saturation,lightness),brightness),contrast);"}}}(),function(){bg.webgl1.shaderLibrary.inputs={buffers:{vertex:{name:"inVertex",dataType:"vec3",role:"buffer",target:"vertex"},normal:{name:"inNormal",dataType:"vec3",role:"buffer",target:"normal"},tangent:{name:"inTangent",dataType:"vec3",role:"buffer",target:"tangent"},tex0:{name:"inTex0",dataType:"vec2",role:"buffer",target:"tex0"},tex1:{name:"inTex1",dataType:"vec2",role:"buffer",target:"tex1"},tex2:{name:"inTex2",dataType:"vec2",role:"buffer",target:"tex2"},color:{name:"inColor",dataType:"vec4",role:"buffer",target:"color"}},matrix:{model:{name:"inModelMatrix",dataType:"mat4",role:"value"},view:{name:"inViewMatrix",dataType:"mat4",role:"value"},projection:{name:"inProjectionMatrix",dataType:"mat4",role:"value"},normal:{name:"inNormalMatrix",dataType:"mat4",role:"value"},viewInv:{name:"inViewMatrixInv",dataType:"mat4",role:"value"}},material:{diffuse:{name:"inDiffuseColor",dataType:"vec4",role:"value"},specular:{name:"inSpecularColor",dataType:"vec4",role:"value"},shininess:{name:"inShininess",dataType:"float",role:"value"},shininessMask:{name:"inShininessMask",dataType:"sampler2D",role:"value"},shininessMaskChannel:{name:"inShininessMaskChannel",dataType:"vec4",role:"value"},shininessMaskInvert:{name:"inShininessMaskInvert",dataType:"bool",role:"value"},lightEmission:{name:"inLightEmission",dataType:"float",role:"value"},lightEmissionMask:{name:"inLightEmissionMask",dataType:"sampler2D",role:"value"},lightEmissionMaskChannel:{name:"inLightEmissionMaskChannel",dataType:"vec4",role:"value"},lightEmissionMaskInvert:{name:"inLightEmissionMaskInvert",dataType:"bool",role:"value"},texture:{name:"inTexture",dataType:"sampler2D",role:"value"},textureOffset:{name:"inTextureOffset",dataType:"vec2",role:"value"},textureScale:{name:"inTextureScale",dataType:"vec2",role:"value"},alphaCutoff:{name:"inAlphaCutoff",dataType:"float",role:"value"},lightMap:{name:"inLightMap",dataType:"sampler2D",role:"value"},lightMapOffset:{name:"inLightMapOffset",dataType:"vec2",role:"value"},lightMapScale:{name:"inLightMapScale",dataType:"vec2",role:"value"},normalMap:{name:"inNormalMap",dataType:"sampler2D",role:"value"},normalMapOffset:{name:"inNormalMapOffset",dataType:"vec2",role:"value"},normalMapScale:{name:"inNormalMapScale",dataType:"vec2",role:"value"},reflection:{name:"inReflection",dataType:"float",role:"value"},reflectionMask:{name:"inReflectionMask",dataType:"sampler2D",role:"value"},reflectionMaskChannel:{name:"inReflectionMaskChannel",dataType:"vec4",role:"value"},reflectionMaskInvert:{name:"inReflectionMaskInvert",dataType:"bool",role:"value"},castShadows:{name:"inCastShadows",dataType:"bool",role:"value"},receiveShadows:{name:"inReceiveShadows",dataType:"bool",role:"value"}},lighting:{type:{name:"inLightType",dataType:"int",role:"value"},position:{name:"inLightPosition",dataType:"vec3",role:"value"},direction:{name:"inLightDirection",dataType:"vec3",role:"value"},ambient:{name:"inLightAmbient",dataType:"vec4",role:"value"},diffuse:{name:"inLightDiffuse",dataType:"vec4",role:"value"},specular:{name:"inLightSpecular",dataType:"vec4",role:"value"},attenuation:{name:"inLightAttenuation",dataType:"vec3",role:"value"},spotExponent:{name:"inSpotExponent",dataType:"float",role:"value"},spotCutoff:{name:"inSpotCutoff",dataType:"float",role:"value"},cutoffDistance:{name:"inLightCutoffDistance",dataType:"float",role:"value"},exposure:{name:"inLightExposure",dataType:"float",role:"value"},castShadows:{name:"inLightCastShadows",dataType:"bool",role:"value"}},shadows:{shadowMap:{name:"inShadowMap",dataType:"sampler2D",role:"value"},shadowMapSize:{name:"inShadowMapSize",dataType:"vec2",role:"value"},shadowStrength:{name:"inShadowStrength",dataType:"float",role:"value"},shadowColor:{name:"inShadowColor",dataType:"vec4",role:"value"},shadowBias:{name:"inShadowBias",dataType:"float",role:"value"},shadowType:{name:"inShadowType",dataType:"int",role:"value"}},colorCorrection:{hue:{name:"inHue",dataType:"float",role:"value"},saturation:{name:"inSaturation",dataType:"float",role:"value"},lightness:{name:"inLightness",dataType:"float",role:"value"},brightness:{name:"inBrightness",dataType:"float",role:"value"},contrast:{name:"inContrast",dataType:"float",role:"value"}}}}(),function(){bg.webgl1.shaderLibrary.functions.lighting={getDirectionalLight:{returnType:"vec4",name:"getDirectionalLight",params:{ambient:"vec4",diffuse:"vec4",specular:"vec4",shininess:"float",direction:"vec3",vertexPos:"vec3",normal:"vec3",matDiffuse:"vec4",matSpecular:"vec4",shadowColor:"vec4"},body:"\n\t\t\t\tvec3 color = ambient.rgb * matDiffuse.rgb;\n\t\t\t\tvec3 diffuseWeight = max(0.0, dot(normal,direction)) * diffuse.rgb;\n\t\t\t\tcolor += min(diffuseWeight,shadowColor.rgb) * matDiffuse.rgb;\n\t\t\t\tif (shininess>0.0) {\n\t\t\t\t\tvec3 eyeDirection = normalize(-vertexPos);\n\t\t\t\t\tvec3 reflectionDirection = normalize(reflect(-direction,normal));\n\t\t\t\t\tfloat specularWeight = clamp(pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininess), 0.0, 1.0);\n\t\t\t\t\tvec3 specularColor = specularWeight * pow(shadowColor.rgb,vec3(10.0));\n\t\t\t\t\tcolor += specularColor * specular.rgb * matSpecular.rgb;\n\t\t\t\t}\n\t\t\t\treturn vec4(color,1.0);"},getShadowColor:{returnType:"vec4",name:"getShadowColor",params:{vertexPosFromLight:"vec4",shadowMap:"sampler2D",shadowMapSize:"vec2",shadowType:"int",shadowStrength:"float",shadowBias:"float",shadowColor:"vec4"},body:"\n\t\t\t\tfloat visibility = 1.0;\n\t\t\t\tvec3 depth = vertexPosFromLight.xyz / vertexPosFromLight.w;\n\t\t\t\tconst float kShadowBorderOffset = 3.0;\n\t\t\t\tfloat shadowBorderOffset = kShadowBorderOffset / shadowMapSize.x;\n\t\t\t\tfloat bias = shadowBias;\n\t\t\t\tvec4 shadow = vec4(1.0);\n\t\t\t\tif (shadowType==0) {\t// hard\n\t\t\t\t\tfloat shadowDepth = unpack(texture2D(shadowMap,depth.xy));\n\t\t\t\t\tif (shadowDepth<depth.z - bias &&\n\t\t\t\t\t\t(depth.x>0.0 && depth.x<1.0 && depth.y>0.0 && depth.y<1.0))\n\t\t\t\t\t{\n\t\t\t\t\t\tvisibility = 1.0 - shadowStrength;\n\t\t\t\t\t}\n\t\t\t\t\tshadow = clamp(shadowColor + visibility,0.0,1.0);\n\t\t\t\t}\n\t\t\t\telse if (shadowType==1 || shadowType==2) {\t// soft / soft stratified (not supported on webgl, fallback to soft)\n\t\t\t\t\tvec2 poissonDisk[4];\n\t\t\t\t\tpoissonDisk[0] = vec2( -0.94201624, -0.39906216 );\n\t\t\t\t\tpoissonDisk[1] = vec2( 0.94558609, -0.76890725 );\n\t\t\t\t\tpoissonDisk[2] = vec2( -0.094184101, -0.92938870 );\n\t\t\t\t\tpoissonDisk[3] = vec2( 0.34495938, 0.29387760 );\n\t\t\t\t\t\n\t\t\t\t\tfor (int i=0; i<4; ++i) {\n\t\t\t\t\t\tfloat shadowDepth = unpack(texture2D(shadowMap, depth.xy + poissonDisk[i]/1000.0));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (shadowDepth<depth.z - bias\n\t\t\t\t\t\t\t&& (depth.x>0.0 && depth.x<1.0 && depth.y>0.0 && depth.y<1.0)) {\n\t\t\t\t\t\t\tvisibility -= (shadowStrength) * 0.25;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tshadow = clamp(shadowColor + visibility,0.0,1.0);\n\t\t\t\t}\n\t\t\t\treturn shadow;"}}}(),function(){bg.webgl1.shaderLibrary.functions.materials={samplerColor:{returnType:"vec4",name:"samplerColor",params:{sampler:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2"},body:"\n\t\t\t\treturn texture2D(sampler,uv * scale + offset);"},samplerNormal:{returnType:"vec3",name:"samplerNormal",params:{sampler:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2"},body:"\n\t\t\t\treturn normalize(samplerColor(sampler,uv,offset,scale).xyz * 2.0 - 1.0);\n\t\t\t\t"},combineNormalWithMap:{returnType:"vec3",name:"combineNormalWithMap",params:{normalCoord:"vec3",tangent:"vec3",bitangent:"vec3",normalMapValue:"vec3"},body:"\n\t\t\t\tmat3 tbnMat = mat3( tangent.x, bitangent.x, normalCoord.x,\n\t\t\t\t\t\t\ttangent.y, bitangent.y, normalCoord.y,\n\t\t\t\t\t\t\ttangent.z, bitangent.z, normalCoord.z\n\t\t\t\t\t\t);\n\t\t\t\treturn normalize(normalMapValue * tbnMat);"},applyTextureMask:{returnType:"float",name:"applyTextureMask",params:{value:"float",textureMask:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2",channelMask:"vec4",invert:"bool"},body:"\n\t\t\t\tfloat mask;\n\t\t\t\tvec4 color = samplerColor(textureMask,uv,offset,scale);\n\t\t\t\tmask = color.r * channelMask.r +\n\t\t\t\t\t\t color.g * channelMask.g +\n\t\t\t\t\t\t color.b * channelMask.b +\n\t\t\t\t\t\t color.a * channelMask.a;\n\t\t\t\tif (!invert) {\n\t\t\t\t\tmask = 1.0 - mask;\n\t\t\t\t}\n\t\t\t\treturn value * mask;"},specularColor:{returnType:"vec4",name:"specularColor",params:{specular:"vec4",shininessMask:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2",channelMask:"vec4",invert:"bool"},body:"\n\t\t\t\tfloat maskValue = applyTextureMask(1.0, shininessMask,uv,offset,scale,channelMask,invert);\n\t\t\t\treturn vec4(specular.rgb * maskValue, 1.0);"}}}(),function(){bg.webgl1.shaderLibrary.functions.utils={pack:{returnType:"vec4",name:"pack",params:{depth:"float"},body:"\n\t\t\t\tconst vec4 bitSh = vec4(256 * 256 * 256,\n\t\t\t\t\t\t\t\t\t\t256 * 256,\n\t\t\t\t\t\t\t\t\t\t256,\n\t\t\t\t\t\t\t\t\t\t1.0);\n\t\t\t\tconst vec4 bitMsk = vec4(0,\n\t\t\t\t\t\t\t\t\t\t1.0 / 256.0,\n\t\t\t\t\t\t\t\t\t\t1.0 / 256.0,\n\t\t\t\t\t\t\t\t\t\t1.0 / 256.0);\n\t\t\t\tvec4 comp = fract(depth * bitSh);\n\t\t\t\tcomp -= comp.xxyz * bitMsk;\n\t\t\t\treturn comp;"},unpack:{returnType:"float",name:"unpack",params:{color:"vec4"},body:"\n\t\t\t\tconst vec4 bitShifts = vec4(1.0 / (256.0 * 256.0 * 256.0),\n\t\t\t\t\t\t\t\t\t\t\t1.0 / (256.0 * 256.0),\n\t\t\t\t\t\t\t\t\t\t\t1.0 / 256.0,\n\t\t\t\t\t\t\t\t\t\t\t1.0);\n\t\t\t\treturn dot(color, bitShifts);"},random:{returnType:"float",name:"random",params:{seed:"vec3",i:"int"},body:"\n\t\t\t\tvec4 seed4 = vec4(seed,i);\n\t\t\t\tfloat dot_product = dot(seed4, vec4(12.9898,78.233,45.164,94.673));\n\t\t\t\treturn fract(sin(dot_product) * 43758.5453);"}}}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){bg.base.ShaderType.VERTEX=t.VERTEX_SHADER,bg.base.ShaderType.FRAGMENT=t.FRAGMENT_SHADER},setActive:function(t,e){t.useProgram(e&&e.program)},create:function(t){return{program:t.createProgram(),attribLocations:{},uniformLocations:{}}},addShaderSource:function(t,e,n,i){var r=null;if(e&&e.program){var a=t.createShader(n);t.shaderSource(a,i),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?t.attachShader(e.program,a):r=t.getShaderInfoLog(a),t.deleteShader(a)}else r="Could not attach shader. Invalid shader program";return r},link:function(t,e){var n=null;return e&&e.program?(t.linkProgram(e.program),t.getProgramParameter(e.program,t.LINK_STATUS)||(n=t.getProgramInfoLog(e.program))):n="Could not link shader. Invalid shader program",n},initVars:function(t,e,n,i){n.forEach(function(n){e.attribLocations[n]=t.getAttribLocation(e.program,n)}),i.forEach(function(n){e.uniformLocations[n]=t.getUniformLocation(e.program,n)})},setInputBuffer:function(t,e,n,i,r){if(i&&e&&e.program){var a=e.attribLocations[n];-1!=a&&(t.bindBuffer(t.ARRAY_BUFFER,i),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,r,t.FLOAT,!1,0,0))}},disableInputBuffer:function(t,e,n){t.disableVertexAttribArray(e.attribLocations[n])},setValueInt:function(t,e,n,i){t.uniform1i(e.uniformLocations[n],i)},setValueFloat:function(t,e,n,i){t.uniform1f(e.uniformLocations[n],i)},setValueVector2:function(t,e,n,i){t.uniform2fv(e.uniformLocations[n],i.v)},setValueVector3:function(t,e,n,i){t.uniform3fv(e.uniformLocations[n],i.v)},setValueVector4:function(t,e,n,i){t.uniform4fv(e.uniformLocations[n],i.v)},setValueVector2v:function(t,e,n,i){t.uniform2fv(e.uniformLocations[n],i)},setValueVector3v:function(t,e,n,i){t.uniform3fv(e.uniformLocations[n],i)},setValueVector4v:function(t,e,n,i){t.uniform4fv(e.uniformLocations[n],i)},setValueMatrix3:function(t,e,n,i,r){t.uniformMatrix3fv(e.uniformLocations[n],i,r.m)},setValueMatrix4:function(t,e,n,i,r){t.uniformMatrix4fv(e.uniformLocations[n],i,r.m)},setTexture:function(t,e,n,i,r){i.setActive(r),i.bind(),t.uniform1i(e.uniformLocations[n],r)}},{},t)}(bg.base.ShaderImpl);bg.webgl1.ShaderImpl=t}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){bg.base.TextureWrap.REPEAT=t.REPEAT,bg.base.TextureWrap.CLAMP=t.CLAMP_TO_EDGE,bg.base.TextureFilter.NEAREST_MIPMAP_NEAREST=t.NEAREST_MIPMAP_NEAREST,bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST=t.LINEAR_MIPMAP_NEAREST,bg.base.TextureFilter.NEAREST_MIPMAP_LINEAR=t.NEAREST_MIPMAP_LINEAR,bg.base.TextureFilter.LINEAR_MIPMAP_LINEAR=t.LINEAR_MIPMAP_LINEAR,bg.base.TextureFilter.NEAREST=t.NEAREST,bg.base.TextureFilter.LINEAR=t.LINEAR,bg.base.TextureTarget.TEXTURE_2D=t.TEXTURE_2D,bg.base.TextureTarget.CUBE_MAP=t.TEXTURE_CUBE_MAP,bg.base.TextureTarget.POSITIVE_X_FACE=t.TEXTURE_CUBE_MAP_POSITIVE_X,bg.base.TextureTarget.NEGATIVE_X_FACE=t.TEXTURE_CUBE_MAP_NEGATIVE_X,bg.base.TextureTarget.POSITIVE_Y_FACE=t.TEXTURE_CUBE_MAP_POSITIVE_Y,bg.base.TextureTarget.NEGATIVE_Y_FACE=t.TEXTURE_CUBE_MAP_NEGATIVE_Y,bg.base.TextureTarget.POSITIVE_Z_FACE=t.TEXTURE_CUBE_MAP_POSITIVE_Z,bg.base.TextureTarget.NEGATIVE_Z_FACE=t.TEXTURE_CUBE_MAP_NEGATIVE_Z},requireMipmaps:function(t,e){return t==bg.base.TextureFilter.NEAREST_MIPMAP_NEAREST||t==bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST||t==bg.base.TextureFilter.NEAREST_MIPMAP_LINEAR||t==bg.base.TextureFilter.LINEAR_MIPMAP_LINEAR||e==bg.base.TextureFilter.NEAREST_MIPMAP_NEAREST||e==bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST||e==bg.base.TextureFilter.NEAREST_MIPMAP_LINEAR||e==bg.base.TextureFilter.LINEAR_MIPMAP_LINEAR},create:function(t){return t.createTexture()},setActive:function(t,e){t.activeTexture(t.TEXTURE0+e)},bind:function(t,e,n){t.bindTexture(e,n)},unbind:function(t,e){this.bind(t,e,null)},setTextureWrapX:function(t,e,n,i){t.texParameteri(e,t.TEXTURE_WRAP_S,i)},setTextureWrapY:function(t,e,n,i){t.texParameteri(e,t.TEXTURE_WRAP_T,i)},setImage:function(t,e,n,i,r,a,s){s&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texParameteri(e,t.TEXTURE_MIN_FILTER,n),t.texParameteri(e,t.TEXTURE_MAG_FILTER,i),t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a),this.requireMipmaps(n,i)&&t.generateMipmap(e)},setImageRaw:function(t,e,n,i,r,a,s,o,u,l){u||(u=t.RGBA),l||(l=t.UNSIGNED_BYTE),l==bg.base.RenderSurfaceFormat.FLOAT&&(n=bg.base.TextureFilter.NEAREST,i=bg.base.TextureFilter.NEAREST),t.texParameteri(e,t.TEXTURE_MIN_FILTER,n),t.texParameteri(e,t.TEXTURE_MAG_FILTER,i),t.texImage2D(e,0,u,a,s,0,u,l,o),this.requireMipmaps(n,i)&&t.generateMipmap(e)},setVideo:function(t,e,n,i,r){r&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)},updateVideoData:function(t,e,n,i){t.bindTexture(e,n),t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.bindTexture(e,null)},destroy:function(t,e){t.deleteTexture(this._texture)}},{},t)}(bg.base.TextureImpl);bg.webgl1.TextureImpl=t}(),Class("paella.plugins.CommentsPlugin",paella.TabBarPlugin,{divPublishComment:null,divComments:null,publishCommentTextArea:null,publishCommentButtons:null,canPublishAComment:!1,comments:[],commentsTree:[],domElement:null,getSubclass:function(){return"showCommentsTabBar"},getName:function(){return"es.upv.paella.commentsPlugin"},getTabName:function(){return base.dictionary.translate("Comments")},checkEnabled:function(t){t(!0)},getIndex:function(){return 40},getDefaultToolTip:function(){return base.dictionary.translate("Comments")},action:function(t){this.loadContent()},buildContent:function(t){this.domElement=t,this.canPublishAComment=paella.initDelegate.initParams.accessControl.permissions.canWrite,this.loadContent()},loadContent:function(){this.divRoot=this.domElement,this.divRoot.innerHTML="",this.divPublishComment=document.createElement("div"),this.divPublishComment.className="CommentPlugin_Publish",this.divPublishComment.id="CommentPlugin_Publish",this.divComments=document.createElement("div"),this.divComments.className="CommentPlugin_Comments",this.divComments.id="CommentPlugin_Comments",this.canPublishAComment&&(this.divRoot.appendChild(this.divPublishComment),this.createPublishComment()),this.divRoot.appendChild(this.divComments),this.reloadComments()},createPublishComment:function(){var t,e=this,n=this.divPublishComment.id+"_entry";t=document.createElement("div"),t.id=n,t.className="comments_entry";var i;i=document.createElement("img"),i.className="comments_entry_silhouette",i.style.width="48px",i.src=paella.initDelegate.initParams.accessControl.userData.avatar,i.id=n+"_silhouette",t.appendChild(i);var r;r=document.createElement("div"),r.className="comments_entry_container",r.id=n+"_textarea_container",t.appendChild(r),this.publishCommentTextArea=document.createElement("textarea"),this.publishCommentTextArea.id=n+"_textarea",this.publishCommentTextArea.onclick=function(){paella.keyManager.enabled=!1},this.publishCommentTextArea.onblur=function(){paella.keyManager.enabled=!0},r.appendChild(this.publishCommentTextArea),this.publishCommentButtons=document.createElement("div"),this.publishCommentButtons.id=n+"_buttons_area",r.appendChild(this.publishCommentButtons);var a;a=document.createElement("button"),a.id=n+"_btnAddComment",a.className="publish",a.onclick=function(){""!=e.publishCommentTextArea.value.replace(/\s/g,"")&&e.addComment()},a.innerHTML=base.dictionary.translate("Publish"),this.publishCommentButtons.appendChild(a),r.commentsTextArea=this.publishCommentTextArea,r.commentsBtnAddComment=a,r.commentsBtnAddCommentToInstant=this.btnAddCommentToInstant,this.divPublishComment.appendChild(t)},addComment:function(){var t=this,e=paella.AntiXSS.htmlEscape(t.publishCommentTextArea.value),n=new Date;this.comments.push({id:base.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"normal",value:e,created:n});var i={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},i,function(e,n){n&&t.loadContent()})},addReply:function(t,e){var n=this,i=document.getElementById(e),r=paella.AntiXSS.htmlEscape(i.value),a=new Date;paella.keyManager.enabled=!0,this.comments.push({id:base.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"reply",parent:t,value:r,created:a});var s={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},s,function(t,e){e&&n.reloadComments()})},reloadComments:function(){var t=this;t.commentsTree=[],t.comments=[],this.divComments.innerHTML="",paella.data.read("comments",{id:paella.initDelegate.getId()},function(e,n){var i,r,a;if(e&&"object"==$traceurRuntime.typeof(e)&&e.allComments&&e.allComments.length>0){t.comments=e.allComments;var s={};for(i=0;i<e.allComments.length;++i)r=e.allComments[i].value,"reply"!==e.allComments[i].mode&&(a={},a.id=e.allComments[i].id,a.userName=e.allComments[i].userName,a.mode=e.allComments[i].mode,a.value=r,a.created=e.allComments[i].created,a.replies=[],t.commentsTree.push(a),s[a.id]=t.commentsTree.length-1);for(i=0;i<e.allComments.length;++i)if(r=e.allComments[i].value,"reply"===e.allComments[i].mode){a={},a.id=e.allComments[i].id,a.userName=e.allComments[i].userName,a.mode=e.allComments[i].mode,a.value=r,a.created=e.allComments[i].created;var o=s[e.allComments[i].parent];t.commentsTree[o].replies.push(a)}t.displayComments()}})},displayComments:function(){for(var t=this,e=0;e<t.commentsTree.length;++e){var n=t.commentsTree[e],i=t.createACommentEntry(n);t.divComments.appendChild(i)}},createACommentEntry:function(t){var e,n=this,i=this.divPublishComment.id+"_entry"+t.id;e=document.createElement("div"),e.id=i,e.className="comments_entry";var r;r=document.createElement("img"),r.className="comments_entry_silhouette",r.id=i+"_silhouette",e.appendChild(r);var a;a=document.createElement("div"),a.className="comments_entry_container",a.id=i+"_comment_container",e.appendChild(a);var s;s=document.createElement("div"),s.id=i+"_comment_metadata",a.appendChild(s);var o="";if(t.created){var u=new Date,l=paella.utils.timeParse.matterhornTextDateToDate(t.created);o=paella.utils.timeParse.secondsToText((u.getTime()-l.getTime())/1e3)}var c;c=document.createElement("div"),c.id=i+"_comment_value",c.className="comments_entry_comment",a.appendChild(c),c.innerHTML=t.value;var h=document.createElement("div");if(h.id=i+"_comment_reply",a.appendChild(h),paella.data.read("userInfo",{username:t.userName},function(t,e){if(t){r.src=t.avatar;var n="<span class='comments_entry_username'>"+t.name+" "+t.lastname+"</span>";n+="<span class='comments_entry_datepublish'>"+o+"</span>",s.innerHTML=n}}),1==this.canPublishAComment){var f=document.createElement("div");f.className="reply_button",f.innerHTML=base.dictionary.translate("Reply"),f.id=i+"_comment_reply_button",f.onclick=function(){var e=n.createAReplyEntry(t.id);this.style.display="none",this.parentElement.parentElement.appendChild(e)},h.appendChild(f)}for(var d=0;d<t.replies.length;++d){var g=n.createACommentReplyEntry(t.id,t.replies[d]);a.appendChild(g)}return e},createACommentReplyEntry:function(t,e){var n,i=this.divPublishComment.id+"_entry_"+t+"_reply_"+e.id;n=document.createElement("div"),n.id=i,n.className="comments_entry";var r;r=document.createElement("img"),r.className="comments_entry_silhouette",r.id=i+"_silhouette",n.appendChild(r);var a;a=document.createElement("div"),a.className="comments_entry_container",a.id=i+"_comment_container",n.appendChild(a);var s;s=document.createElement("div"),s.id=i+"_comment_metadata",a.appendChild(s);var o="";if(e.created){var u=new Date,l=paella.utils.timeParse.matterhornTextDateToDate(e.created);o=paella.utils.timeParse.secondsToText((u.getTime()-l.getTime())/1e3)}var c;return c=document.createElement("div"),c.id=i+"_comment_value",c.className="comments_entry_comment",a.appendChild(c),c.innerHTML=e.value,paella.data.read("userInfo",{username:e.userName},function(t,e){if(t){r.src=t.avatar;var n="<span class='comments_entry_username'>"+t.name+" "+t.lastname+"</span>";n+="<span class='comments_entry_datepublish'>"+o+"</span>",s.innerHTML=n}}),n},createAReplyEntry:function(t){var e,n=this,i=this.divPublishComment.id+"_entry_"+t+"_reply";e=document.createElement("div"),e.id=i+"_entry",e.className="comments_entry";var r;r=document.createElement("img"),r.className="comments_entry_silhouette",r.style.width="48px",r.id=i+"_silhouette",r.src=paella.initDelegate.initParams.accessControl.userData.avatar,e.appendChild(r);var a;a=document.createElement("div"),a.className="comments_entry_container comments_reply_container",a.id=i+"_reply_container",e.appendChild(a);var s;s=document.createElement("textArea"),s.onclick=function(){paella.keyManager.enabled=!1},s.draggable=!1,s.id=i+"_textarea",a.appendChild(s),this.publishCommentButtons=document.createElement("div"),this.publishCommentButtons.id=i+"_buttons_area",a.appendChild(this.publishCommentButtons);var o;return o=document.createElement("button"),o.id=i+"_btnAddComment",o.className="publish",o.onclick=function(){""!=s.value.replace(/\s/g,"")&&n.addReply(t,s.id)},o.innerHTML=base.dictionary.translate("Reply"),this.publishCommentButtons.appendChild(o),e}}),paella.plugins.commentsPlugin=new paella.plugins.CommentsPlugin,Class("paella.plugins.DescriptionPlugin",paella.TabBarPlugin,{getSubclass:function(){return"showDescriptionTabBar"},getName:function(){return"es.upv.paella.descriptionPlugin"},getTabName:function(){return"Descripción"},domElement:null,buildContent:function(t){this.domElement=t,this.loadContent()},action:function(t){this.loadContent()},loadContent:function(){var t=this.domElement;t.innerHTML="Loading...",new paella.Timer(function(e){t.innerHTML="Loading done"},2e3)}}),paella.plugins.descriptionPlugin=new paella.plugins.DescriptionPlugin,Class("paella.plugins.extendedTabAdapterPlugin",paella.ButtonPlugin,{currentUrl:null,currentMaster:null,currentSlave:null,availableMasters:[],availableSlaves:[],showWidthRes:null,getAlignment:function(){return"right"},getSubclass:function(){return"extendedTabAdapterPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 550},getName:function(){return"es.upv.paella.extendedTabAdapterPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Extended Tab Adapter")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(t){t.appendChild(paella.extendedAdapter.bottomContainer)}}),new paella.plugins.extendedTabAdapterPlugin,Class("paella.plugins.FootPrintsPlugin",paella.ButtonPlugin,{INTERVAL_LENGTH:5,inPosition:0,outPosition:0,canvas:null,footPrintsTimer:null,footPrintsData:{},getAlignment:function(){return"right"},getSubclass:function(){return"footPrints"},getIndex:function(){return 590},getDefaultToolTip:function(){return base.dictionary.translate("Show statistics")},getName:function(){return"es.upv.paella.footprintsPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},setup:function(){var t=this;switch(paella.events.bind(paella.events.timeUpdate,function(e){t.onTimeUpdate()}),this.config.skin){case"custom":this.fillStyle=this.config.fillStyle,this.strokeStyle=this.config.strokeStyle;break;case"dark":this.fillStyle="#727272",this.strokeStyle="#424242";break;case"light":default:this.fillStyle="#d8d8d8",this.strokeStyle="#ffffff"}},checkEnabled:function(t){t(!paella.player.isLiveStream())},buildContent:function(t){var e=document.createElement("div");e.className="footPrintsContainer",this.canvas=document.createElement("canvas"),this.canvas.id="footPrintsCanvas",this.canvas.className="footPrintsCanvas",e.appendChild(this.canvas),t.appendChild(e)},onTimeUpdate:function(){var t=this;paella.player.videoContainer.currentTime().then(function(e){var n=Math.round(e+paella.player.videoContainer.trimStart());t.inPosition<=n&&n<=t.inPosition+t.INTERVAL_LENGTH?(t.outPosition=n,t.inPosition+t.INTERVAL_LENGTH===t.outPosition&&(t.trackFootPrint(t.inPosition,t.outPosition),t.inPosition=t.outPosition)):(t.trackFootPrint(t.inPosition,t.outPosition),t.inPosition=n,t.outPosition=n)})},trackFootPrint:function(t,e){var n={in:t,out:e};paella.data.write("footprints",{id:paella.initDelegate.getId()},n)},willShowContent:function(){var t=this;this.loadFootprints(),this.footPrintsTimer=new base.Timer(function(e){t.loadFootprints()},5e3),this.footPrintsTimer.repeat=!0},didHideContent:function(){null!=this.footPrintsTimer&&(this.footPrintsTimer.cancel(),this.footPrintsTimer=null)},loadFootprints:function(){var t=this;paella.data.read("footprints",{id:paella.initDelegate.getId()},function(e,n){var i={};paella.player.videoContainer.duration().then(function(n){for(var r=Math.floor(paella.player.videoContainer.trimStart()),a=-1,s=0,o=0;o<e.length;o++){var u=e[o].position-r;if(u<n){var l=e[o].views;if(u-1!=a)for(var c=a+1;c<u;c++)i[c]=s;i[u]=l,a=u,s=l}}t.drawFootPrints(i)})})},drawFootPrints:function(t){if(this.canvas){var e,n=Object.keys(t).length,i=this.canvas.getContext("2d"),r=20;for(e=0;e<n;++e)t[e]>r&&(r=t[e]);for(this.canvas.setAttribute("width",n),this.canvas.setAttribute("height",r),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.fillStyle=this.fillStyle,i.strokeStyle=this.strokeStyle,i.lineWidth=2,i.webkitImageSmoothingEnabled=!1,i.mozImageSmoothingEnabled=!1,e=0;e<n-1;++e)i.beginPath(),i.moveTo(e,r),i.lineTo(e,r-t[e]),i.lineTo(e+1,r-t[e+1]),i.lineTo(e+1,r),i.closePath(),i.fill(),i.beginPath(),i.moveTo(e,r-t[e]),i.lineTo(e+1,r-t[e+1]),i.closePath(),i.stroke()}}}),paella.plugins.footPrintsPlugin=new paella.plugins.FootPrintsPlugin,
Class("paella.plugins.FrameCaptionsSearchPlugIn",paella.SearchServicePlugIn,{getName:function(){return"es.upv.paella.frameCaptionsSearchPlugin"},search:function(t,e){var n=RegExp(t,"i"),i=[];for(var r in paella.player.videoLoader.frameList){var a=paella.player.videoLoader.frameList[r];"object"==$traceurRuntime.typeof(a)&&n.test(a.caption)&&i.push({time:r,content:a.caption,score:0})}e&&e(!1,i)}}),new paella.plugins.FrameCaptionsSearchPlugIn,Class("paella.plugins.FrameControlPlugin",paella.ButtonPlugin,{frames:null,highResFrames:null,currentFrame:null,navButtons:null,buttons:[],contx:null,_img:null,_searchTimer:null,_searchTimerTime:250,getAlignment:function(){return"right"},getSubclass:function(){return"frameControl"},getIndex:function(){return 510},getMinWindowSize:function(){return 450},getName:function(){return"es.upv.paella.frameControlPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},getDefaultToolTip:function(){return base.dictionary.translate("Navigate by slides")},checkEnabled:function(t){t(null==paella.initDelegate.initParams.videoLoader.frameList?!1:0===paella.initDelegate.initParams.videoLoader.frameList.length?!1:0==Object.keys(paella.initDelegate.initParams.videoLoader.frameList).length?!1:!0)},setup:function(){this._showFullPreview=this.config.showFullPreview||"auto";var t,e,n=this,i=1,r=0,a=-1,s={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40};$(this.button).keyup(function(o){var u=Math.floor(n.contx.offsetWidth/100),l=n.buttons.length%u,c=Math.floor(n.buttons.length/u);n.isPopUpOpen()&&(o.keyCode==s.Left?a>0&&(n.buttons[a].className=t,a--,i>c&&(r=u-l),e=u*(i-1)-1-r,a==e&&0!=a&&(n.navButtons.left.scrollContainer.scrollLeft-=105*u,--i),this.hiResFrame&&n.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||n.buttons[a].frameControl.onMouseOver(null,n.buttons[a].frameData),t=n.buttons[a].className,n.buttons[a].className="frameControlItem selected"):o.keyCode==s.Right?a<n.buttons.length-1&&(a>=0&&(n.buttons[a].className=t),a++,1==i&&(r=0),e=u*i-r,a==e&&(n.navButtons.left.scrollContainer.scrollLeft+=105*u,++i),this.hiResFrame&&n.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||n.buttons[a].frameControl.onMouseOver(null,n.buttons[a].frameData),t=n.buttons[a].className,n.buttons[a].className="frameControlItem selected"):o.keyCode==s.Return?(n.buttons[a].frameControl.onClick(null,n.buttons[a].frameData),t="frameControlItem current"):o.keyCode==s.Esc&&n.removeHiResFrame())})},buildContent:function(t){var e=this,n=this;this.frames=[];var i=document.createElement("div");i.className="frameControlContainer",n.contx=i;var r=document.createElement("div");r.className="frameControlContent",this.navButtons={left:document.createElement("div"),right:document.createElement("div")},this.navButtons.left.className="frameControl navButton left",this.navButtons.right.className="frameControl navButton right";var a=this.getFrame(null);t.appendChild(this.navButtons.left),t.appendChild(i),i.appendChild(r),t.appendChild(this.navButtons.right),this.navButtons.left.scrollContainer=i,$(this.navButtons.left).click(function(t){this.scrollContainer.scrollLeft-=100}),this.navButtons.right.scrollContainer=i,$(this.navButtons.right).click(function(t){this.scrollContainer.scrollLeft+=100}),r.appendChild(a);var s=$(a).outerWidth(!0);r.innerHTML="",$(window).mousemove(function(t){($(r).offset().top>t.pageY||!$(r).is(":visible")||$(r).offset().top+$(r).height()<t.pageY)&&n.removeHiResFrame()});var o,u=paella.initDelegate.initParams.videoLoader.frameList;if(u){var l=Object.keys(u);o=l.length,l.map(function(t){return Number(t,10)}).sort(function(t,e){return t-e}).forEach(function(t){var e=n.getFrame(u[t]);r.appendChild(e,"frameContrlItem_"+o),n.frames.push(e)})}$(r).css({width:o*s+"px"}),paella.events.bind(paella.events.setTrim,function(t,n){e.updateFrameVisibility(n.trimEnabled,n.trimStart,n.trimEnd)}),paella.player.videoContainer.trimming().then(function(t){e.updateFrameVisibility(t.enabled,t.start,t.end)}),paella.events.bind(paella.events.timeupdate,function(t,n){return e.onTimeUpdate(n.currentTime)})},showHiResFrame:function(t,e){var n=document.createElement("div"),i=document.createElement("div"),r=document.createElement("img");this._img=r,r.className="frameHiRes",r.setAttribute("src",t),r.setAttribute("style","width: 100%;"),$(i).append(r),$(n).append(i),n.setAttribute("style","display: table;"),i.setAttribute("style","display: table-cell; vertical-align:middle;");var a=document.createElement("p");a.className="frameCaption",a.innerHTML=e||"",n.append(a),this._caption=a;var s=paella.player.videoContainer.overlayContainer;switch(this._showFullPreview){case"auto":var o=paella.initDelegate.initParams.videoLoader.streams;1==o.length?s.addElement(n,s.getMasterRect()):o.length>=2&&s.addElement(n,s.getSlaveRect()),s.enableBackgroundMode(),this.hiResFrame=n;break;case"master":s.addElement(n,s.getMasterRect()),s.enableBackgroundMode(),this.hiResFrame=n;break;case"slave":var o=paella.initDelegate.initParams.videoLoader.streams;o.length>=2&&(s.addElement(n,s.getSlaveRect()),s.enableBackgroundMode(),this.hiResFrame=n)}},removeHiResFrame:function(){var t=this,e=paella.player.videoContainer.overlayContainer;this.hiResFrame&&e.removeElement(this.hiResFrame),e.disableBackgroundMode(),t._img=null},updateFrameVisibility:function(t,e,n){var i;if(t)for(i=0;i<this.frames.length;++i){var r=this.frames[i],a=r.frameData;a.time<e?this.frames.length>i+1&&this.frames[i+1].frameData.time>e?$(r).show():$(r).hide():a.time>n?$(r).hide():$(r).show()}else for(i=0;i<this.frames.length;++i)$(this.frames[i]).show()},getFrame:function(t,e){var n=document.createElement("div");if(n.className="frameControlItem",e&&(n.id=e),t){this.buttons.push(n),n.frameData=t,n.frameControl=this;var i=t.thumb?t.thumb:t.url,r=paella.utils.timeParse.secondsToTime(t.time);n.innerHTML='<img src="'+i+'" alt="" class="frameControlImage" title="'+r+'" aria-label="'+r+'"></img>',base.userAgent.browser.IsMobileVersion||$(n).mouseover(function(t){this.frameControl.onMouseOver(t,this.frameData)}),$(n).mouseout(function(t){this.frameControl.onMouseOut(t,this.frameData)}),$(n).click(function(t){this.frameControl.onClick(t,this.frameData)})}return n},onMouseOver:function(t,e){var n=paella.initDelegate.initParams.videoLoader.frameList,i=n[e.time];if(i){var r=i.url;this._img?(this._img.setAttribute("src",r),this._caption.innerHTML=i.caption||""):this.showHiResFrame(r,i.caption)}null!=this._searchTimer&&this._searchTimer.cancel()},onMouseOut:function(t,e){var n=this;n._searchTimer=new base.Timer(function(t){n.removeHiResFrame()},n._searchTimerTime)},onClick:function(t,e){paella.player.videoContainer.trimming().then(function(t){var n=t.enabled?e.time-t.start:e.time;n>0?paella.player.videoContainer.seekToTime(n+1):paella.player.videoContainer.seekToTime(0)})},onTimeUpdate:function(t){for(var e=null,n=0;n<this.frames.length&&(this.frames[n].frameData&&this.frames[n].frameData.time<=t);++n)e=this.frames[n];this.currentFrame!=e&&e&&(this.currentFrame&&(this.currentFrame.className="frameControlItem"),this.currentFrame=e,this.currentFrame.className="frameControlItem current")}}),paella.plugins.frameControlPlugin=new paella.plugins.FrameControlPlugin,Class("paella.plugins.FullScreenPlugin",paella.ButtonPlugin,{_reload:null,getIndex:function(){return 551},getAlignment:function(){return"right"},getSubclass:function(){return"showFullScreenButton"},getName:function(){return"es.upv.paella.fullScreenButtonPlugin"},checkEnabled:function(t){t(paella.player.checkFullScreenCapability())},getDefaultToolTip:function(){return base.dictionary.translate("Go Fullscreen")},setup:function(){var t=this;this._reload=!!this.config.reloadOnFullscreen&&this.config.reloadOnFullscreen.enabled,this._keepUserQuality=!this.config.reloadOnFullscreen||this.config.reloadOnFullscreen.keepUserSelection,paella.events.bind(paella.events.enterFullscreen,function(e){t.onEnterFullscreen()}),paella.events.bind(paella.events.exitFullscreen,function(e){t.onExitFullscreen()})},action:function(t){var e=this;if(paella.player.isFullScreen())paella.player.exitFullScreen();else{if((!paella.player.checkFullScreenCapability()||base.userAgent.browser.Explorer)&&window.location!==window.parent.location){var n=window.location.href;return paella.player.pause(),void paella.player.videoContainer.currentTime().then(function(t){var i=e.secondsToHours(t);window.open(n+"&time="+i.h+"h"+i.m+"m"+i.s+"s&autoplay=true")})}paella.player.goFullScreen()}paella.player.config.player.reloadOnFullscreen&&!paella.utils.userAgent.system.iOS&&setTimeout(function(){e._reload&&paella.player.videoContainer.setQuality(null).then(function(){})},1e3)},secondsToHours:function(t){var e=Math.floor(t/3600),n=Math.floor((t-3600*e)/60),i=Math.floor(t-3600*e-60*n),r={};return e<10&&(e="0"+e),n<10&&(n="0"+n),i<10&&(i="0"+i),r.h=e,r.m=n,r.s=i,r},onEnterFullscreen:function(){this.setToolTip(base.dictionary.translate("Exit Fullscreen")),this.button.className=this.getButtonItemClass(!0)},onExitFullscreen:function(){this.setToolTip(base.dictionary.translate("Go Fullscreen")),this.button.className=this.getButtonItemClass(!1),setTimeout(function(){paella.player.onresize()},100)},getButtonItemClass:function(t){return"buttonPlugin "+this.getAlignment()+" "+this.getSubclass()+(t?" active":"")}}),paella.plugins.fullScreenPlugin=new paella.plugins.FullScreenPlugin,Class("paella.plugins.HelpPlugin",paella.ButtonPlugin,{getIndex:function(){return 509},getAlignment:function(){return"right"},getSubclass:function(){return"helpButton"},getName:function(){return"es.upv.paella.helpPlugin"},getMinWindowSize:function(){return 650},getDefaultToolTip:function(){return base.dictionary.translate("Show help")+" ("+base.dictionary.translate("Paella version:")+" "+paella.version+")"},checkEnabled:function(t){t((this.config&&this.config.langs||[]).length>0)},action:function(t){var e=base.dictionary.currentLanguage(),n=this.config&&this.config.langs||[],i=n.indexOf(e);i<0&&(i=0);var r="resources/style/help/help_"+n[i]+".html";base.userAgent.browser.IsMobileVersion?window.open(r):paella.messageBox.showFrame(r)}}),paella.plugins.helpPlugin=new paella.plugins.HelpPlugin,function(t){if("object"==("undefined"==typeof exports?"undefined":$traceurRuntime.typeof(exports))&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Hls=t()}}(function(){var t;return function t(e,n,i){function r(s,o){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return r(n||t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function a(t){return"number"==typeof t}function s(t){return"object"==(void 0===t?"undefined":$traceurRuntime.typeof(t))&&null!==t}function o(t){return void 0===t}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!a(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,n,i,a,u,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(n=this._events[t],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(s(n))for(a=Array.prototype.slice.call(arguments,1),l=n.slice(),i=l.length,u=0;u<i;u++)l[u].apply(this,a);return!0},i.prototype.addListener=function(t,e){var n;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(n=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.trace),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},i.prototype.removeListener=function(t,e){var n,i,a,o;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],a=n.length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(o=a;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){i=o;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(e,n,i){!function(e){var r=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,a=/^([^\/;?#]*)(.*)$/,s={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),!(e=e.trim())){if(!n.alwaysNormalize)return t;var i=this.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");return i.path=s.normalizePath(i.path),s.buildURLFromParts(i)}var r=this.parseURL(e);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return n.alwaysNormalize?(r.path=s.normalizePath(r.path),s.buildURLFromParts(r)):e;var o=this.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var u=a.exec(o.path);o.netLoc=u[1],o.path=u[2]}o.netLoc&&!o.path&&(o.path="/");var l={scheme:o.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};if(!r.netLoc&&(l.netLoc=o.netLoc,"/"!==r.path[0]))if(r.path){var c=o.path,h=c.substring(0,c.lastIndexOf("/")+1)+r.path;l.path=s.normalizePath(h)}else l.path=o.path,r.params||(l.params=o.params,r.query||(l.query=o.query));return null===l.path&&(l.path=n.alwaysNormalize?s.normalizePath(r.path):r.path),s.buildURLFromParts(l)},parseURL:function(t){var e=r.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(/(?:\/|^)\.(?=\/)/g,"");t.length!==(t=t.replace(/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};"object"==(void 0===i?"undefined":$traceurRuntime.typeof(i))&&"object"==(void 0===n?"undefined":$traceurRuntime.typeof(n))?n.exports=s:"function"==typeof t&&t.amd?t([],function(){return s}):"object"==(void 0===i?"undefined":$traceurRuntime.typeof(i))?i.URLToolkit=s:e.URLToolkit=s}(this)},{}],3:[function(t,e,n){var i=arguments[3],r=arguments[4],a=arguments[5],s=JSON.stringify;e.exports=function(t,e){function n(t){p[t]=!0;for(var e in r[t][1]){var i=r[t][1][e];p[i]||n(i)}}for(var o=void 0,u=Object.keys(a),l=0,c=u.length;l<c;l++){var h=u[l],f=a[h].exports;if(f===t||f&&f.default===t){o=h;break}}if(!o){o=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var d={},l=0,c=u.length;l<c;l++){var h=u[l];d[h]=h}r[o]=[Function(["require","module","exports"],"("+t+")(self)"),d]}var g=Math.floor(Math.pow(16,8)*Math.random()).toString(16),m={};m[o]=o,r[g]=[Function(["require"],"var f = require("+s(o)+");(f.default ? f.default : f)(self);"),m];var p={};n(g);var b="("+i+")({"+Object.keys(p).map(function(t){return s(t)+":["+r[t][0]+","+s(r[t][1])+"]"}).join(",")+"},{},["+s(g)+"])",_=window.URL||window.webkitURL||window.mozURL||window.msURL,v=new Blob([b],{type:"text/javascript"});if(e&&e.bare)return v;var y=_.createObjectURL(v),E=new Worker(y);return E.objectURL=y,E}},{}],4:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0}),n.hlsDefaultConfig=void 0;var r=t(5),a=i(r),s=t(8),o=i(s),u=t(9),l=i(u),c=t(10),h=i(c),f=t(55),d=i(f),g=t(7),m=i(g),p=t(6),b=i(p),_=t(47),v=i(_),y=t(15),E=i(y),T=t(14),x=i(T),S=t(13),w=i(S);n.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:d.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:a.default,bufferController:o.default,capLevelController:l.default,fpsController:h.default,audioStreamController:b.default,audioTrackController:m.default,subtitleStreamController:w.default,subtitleTrackController:x.default,timelineController:E.default,cueHandler:v.default,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}},{10:10,13:13,14:14,15:15,47:47,5:5,55:55,6:6,7:7,8:8,9:9}],5:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(32),l=i(u),c=t(31),h=i(c),f=t(34),d=i(f),g=t(30),m=t(50),p=t(48),b=i(p),_=function(t){function e(t){r(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l.default.FRAG_LOADING,l.default.FRAG_LOADED,l.default.FRAG_BUFFERED,l.default.ERROR));return n.lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=t,n.onCheck=n._abandonRulesCheck.bind(n),n}return s(e,t),o(e,[{key:"destroy",value:function(){this.clearTimer(),h.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(t){var e=t.frag;if("main"===e.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var n=this.hls,i=t.frag.level,r=n.levels[i].details.live,a=n.config,s=void 0,o=void 0;r?(s=a.abrEwmaFastLive,o=a.abrEwmaSlowLive):(s=a.abrEwmaFastVoD,o=a.abrEwmaSlowVoD),this._bwEstimator=new b.default(n,o,s,a.abrEwmaDefaultEstimate)}this.fragCurrent=e}}},{key:"_abandonRulesCheck",value:function(){var t=this.hls,e=t.media,n=this.fragCurrent,i=n.loader,r=t.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return m.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var a=i.stats;if(e&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&n.autoLevel&&n.level){var s=performance.now()-a.trequest,o=Math.abs(e.playbackRate);if(s>500*n.duration/o){var u=t.levels,c=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/s),h=u[n.level],f=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,g=a.total?a.total:Math.max(a.loaded,Math.round(n.duration*f/8)),p=e.currentTime,b=(g-a.loaded)/c,_=(d.default.bufferInfo(e,p,t.config.maxBufferHole).end-p)/o;if(_<2*n.duration/o&&b>_){var v=void 0,y=void 0;for(y=n.level-1;y>r;y--){var E=u[y].realBitrate?Math.max(u[y].realBitrate,u[y].bitrate):u[y].bitrate;if((v=n.duration*E/(6.4*c))<_)break}v<b&&(m.logger.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+v.toFixed(1)+"<"+b.toFixed(1)+":"+_.toFixed(1)),t.nextLoadLevel=y,this._bwEstimator.sample(s,a.loaded),i.abort(),this.clearTimer(),t.trigger(l.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:a}))}}}}},{key:"onFragLoaded",value:function(t){var e=t.frag;if("main"===e.type&&!isNaN(e.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[e.level],i=(n.loaded?n.loaded.bytes:0)+t.stats.loaded,r=(n.loaded?n.loaded.duration:0)+t.frag.duration;n.loaded={bytes:i,duration:r},n.realBitrate=Math.round(8*i/r)}if(t.frag.bitrateTest){var a=t.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(t)}}}},{key:"onFragBuffered",value:function(t){var e=t.stats,n=t.frag;if(!(!0===e.aborted||1!==n.loadCounter||"main"!==n.type||isNaN(n.sn)||n.bitrateTest&&e.tload!==e.tbuffered)){var i=e.tparsed-e.trequest;m.logger.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(i,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(t){switch(t.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"_findBestLevel",value:function(t,e,n,i,r,a,s,o,u){for(var l=r;l>=i;l--){var c=u[l],h=c.details,f=h?h.totalduration/h.fragments.length:e,d=!!h&&h.live,g=void 0;g=l<=t?s*n:o*n;var p=u[l].realBitrate?Math.max(u[l].realBitrate,u[l].bitrate):u[l].bitrate,b=p*f/g;if(m.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(g)+"/"+p+"/"+f+"/"+a+"/"+b),g>p&&(!b||d||b<a))return l}return-1}},{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var n=this._nextABRAutoLevel;return-1!==t&&(n=Math.min(t,n)),n},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,n=t.levels,i=t.config,r=t.minAutoLevel,a=t.media,s=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,u=a?a.currentTime:0,l=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,c=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,h=(d.default.bufferInfo(a,u,i.maxBufferHole).end-u)/l,f=this._findBestLevel(s,o,c,r,e,h,i.abrBandWidthFactor,i.abrBandWidthUpFactor,n);if(f>=0)return f;m.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var g=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay,p=i.abrBandWidthFactor,b=i.abrBandWidthUpFactor;if(0===h){var _=this.bitrateTestDelay;_&&(g=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-_,m.logger.trace("bitrate test took "+Math.round(1e3*_)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),p=b=1)}return f=this._findBestLevel(s,o,c,r,e,h+g,p,b,n),Math.max(f,0)}}]),e}(h.default);n.default=_},{30:30,31:31,32:32,34:34,48:48,50:50}],6:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(45),l=i(u),c=t(34),h=i(c),f=t(24),d=i(f),g=t(32),m=i(g),p=t(31),b=i(p),_=t(35),v=i(_),y=t(51),E=i(y),T=t(30),x=t(50),S={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},w=function(t){function e(t){r(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,m.default.MEDIA_ATTACHED,m.default.MEDIA_DETACHING,m.default.AUDIO_TRACKS_UPDATED,m.default.AUDIO_TRACK_SWITCHING,m.default.AUDIO_TRACK_LOADED,m.default.KEY_LOADED,m.default.FRAG_LOADED,m.default.FRAG_PARSING_INIT_SEGMENT,m.default.FRAG_PARSING_DATA,m.default.FRAG_PARSED,m.default.ERROR,m.default.BUFFER_CREATED,m.default.BUFFER_APPENDED,m.default.BUFFER_FLUSHED,m.default.INIT_PTS_FOUND));return n.config=t.config,n.audioCodecSwap=!1,n.ticks=0,n._state=S.STOPPED,n.ontick=n.tick.bind(n),n.initPTS=[],n.waitingFragment=null,n}return s(e,t),o(e,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),b.default.prototype.destroy.call(this),this.state=S.STOPPED}},{key:"onInitPtsFound",value:function(t){var e=t.id,n=t.frag.cc,i=t.initPTS;"main"===e&&(this.initPTS[n]=i,x.logger.log("InitPTS for cc:"+n+" found from video track:"+i),this.state===S.WAITING_INIT_PTS&&(x.logger.log("sending pending audio frag to demuxer"),this.state=S.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,e>0&&-1===t?(x.logger.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=S.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=S.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=S.STOPPED}},{key:"stopLoad",value:function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=S.STOPPED}},{key:"tick",value:function(){1==++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var t,e,n,i=this.hls,r=i.config;switch(this.state){case S.ERROR:case S.PAUSED:case S.BUFFER_FLUSHING:break;case S.STARTING:this.state=S.WAITING_TRACK,this.loadedmetadata=!1;break;case S.IDLE:var a=this.tracks;if(!a)break;if(!this.media&&(this.startFragRequested||!r.startFragPrefetch))break;t=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition;var s=this.mediaBuffer?this.mediaBuffer:this.media,o=h.default.bufferInfo(s,t,r.maxBufferHole),u=o.len,c=o.end,f=this.fragPrevious,d=r.maxMaxBufferLength,g=this.audioSwitch,p=this.trackId;if((u<d||g)&&p<a.length){if(void 0===(n=a[p].details)){this.state=S.WAITING_TRACK;break}if(!g&&!n.live&&f&&f.sn===n.endSN&&(!this.media.seeking||this.media.duration-c<f.duration/2)){this.hls.trigger(m.default.BUFFER_EOS,{type:"audio"}),this.state=S.ENDED;break}var b=n.fragments,_=b.length,v=b[0].start,y=b[_-1].start+b[_-1].duration,E=void 0;if(g)if(n.live&&!n.PTSKnown)x.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),c=0;else if(c=t,n.PTSKnown&&t<v){if(!(o.end>v||o.nextStart))return;x.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=v+.05}if(n.initSegment&&!n.initSegment.data)E=n.initSegment;else if(c<=v){if(E=b[0],n.live&&E.loadIdx&&E.loadIdx===this.fragLoadIdx){var w=o.nextStart?o.nextStart:v;return x.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(w+.05)),void(this.media.currentTime=w+.05)}}else{var M=void 0,C=r.maxFragLookUpTolerance,R=f?b[f.sn-b[0].sn+1]:void 0,O=function(t){var e=Math.min(C,t.duration);return t.start+t.duration-e<=c?1:t.start-e>c&&t.start?-1:0};c<y?(c>y-C&&(C=0),M=R&&!O(R)?R:l.default.search(b,O)):M=b[_-1],M&&(E=M,v=M.start,f&&E.level===f.level&&E.sn===f.sn&&(E.sn<n.endSN?(E=b[E.sn+1-n.startSN],x.logger.log("SN just loaded, load next one: "+E.sn)):E=null))}if(E)if(E.decryptdata&&null!=E.decryptdata.uri&&null==E.decryptdata.key)x.logger.log("Loading key for "+E.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+p),this.state=S.KEY_LOADING,i.trigger(m.default.KEY_LOADING,{frag:E});else{if(x.logger.log("Loading "+E.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+p+", currentTime:"+t+",bufferEnd:"+c.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,E.loadCounter){E.loadCounter++;var A=r.fragLoadingLoopThreshold;if(E.loadCounter>A&&Math.abs(this.fragLoadIdx-E.loadIdx)<A)return void i.trigger(m.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:E})}else E.loadCounter=1;E.loadIdx=this.fragLoadIdx,this.fragCurrent=E,this.startFragRequested=!0,isNaN(E.sn)||(this.nextLoadPosition=E.start+E.duration),i.trigger(m.default.FRAG_LOADING,{frag:E}),this.state=S.FRAG_LOADING}
}break;case S.WAITING_TRACK:(e=this.tracks[this.trackId])&&e.details&&(this.state=S.IDLE);break;case S.FRAG_LOADING_WAITING_RETRY:var j=performance.now(),I=this.retryDate;s=this.media;var P=s&&s.seeking;(!I||j>=I||P)&&(x.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=S.IDLE);break;case S.WAITING_INIT_PTS:case S.STOPPED:case S.FRAG_LOADING:case S.PARSING:case S.PARSED:case S.ENDED:}}},{key:"onMediaAttached",value:function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var t=this.media;t&&t.ended&&(x.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.tracks;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===S.ENDED&&(this.state=S.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(t){x.logger.log("audio tracks updated"),this.tracks=t.audioTracks}},{key:"onAudioTrackSwitching",value:function(t){var e=!!t.url;this.trackId=t.id,this.state=S.IDLE,this.fragCurrent=null,this.state=S.PAUSED,this.waitingFragment=null,e?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=S.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(t){var e=t.details,n=t.id,i=this.tracks[n],r=e.totalduration,a=0;if(x.logger.log("track "+n+" loaded ["+e.startSN+","+e.endSN+"],duration:"+r),e.live){var s=i.details;s&&e.fragments.length>0?(v.default.mergeDetails(s,e),a=e.fragments[0].start,e.PTSKnown?x.logger.log("live audio playlist sliding:"+a.toFixed(3)):x.logger.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,x.logger.log("live audio playlist - first load, unknown sliding"))}else e.PTSKnown=!1;if(i.details=e,!this.startFragRequested){if(-1===this.startPosition){var o=e.startTimeOffset;isNaN(o)?this.startPosition=0:(x.logger.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o)}this.nextLoadPosition=this.startPosition}this.state===S.WAITING_TRACK&&(this.state=S.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===S.KEY_LOADING&&(this.state=S.IDLE,this.tick())}},{key:"onFragLoaded",value:function(t){var e=this.fragCurrent,n=t.frag;if(this.state===S.FRAG_LOADING&&e&&"audio"===n.type&&n.level===e.level&&n.sn===e.sn){var i=this.tracks[this.trackId],r=i.details,a=r.totalduration,s=e.level,o=e.sn,u=e.cc,l=this.config.defaultAudioCodec||i.audioCodec||"mp4a.40.2",c=this.stats=t.stats;if("initSegment"===o)this.state=S.IDLE,c.tparsed=c.tbuffered=performance.now(),r.initSegment.data=t.payload,this.hls.trigger(m.default.FRAG_BUFFERED,{stats:c,frag:e,id:"audio"}),this.tick();else{this.state=S.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new d.default(this.hls,"audio"));var h=this.initPTS[u],f=r.initSegment?r.initSegment.data:[];f||void 0!==h?(this.pendingBuffering=!0,x.logger.log("Demuxing "+o+" of ["+r.startSN+" ,"+r.endSN+"],track "+s),this.demuxer.push(t.payload,f,l,null,e,a,!1,h)):(x.logger.log("unknown video PTS for continuity counter "+u+", waiting for video PTS before demuxing audio frag "+o+" of ["+r.startSN+" ,"+r.endSN+"],track "+s),this.waitingFragment=t,this.state=S.WAITING_INIT_PTS)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(t){var e=this.fragCurrent,n=t.frag;if(e&&"audio"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===S.PARSING){var i=t.tracks,r=void 0;if(i.video&&delete i.video,r=i.audio){r.levelCodec="mp4a.40.2",r.id=t.id,this.hls.trigger(m.default.BUFFER_CODECS,i),x.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var a=r.initSegment;if(a){var s={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[s]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(m.default.BUFFER_APPENDING,s))}this.tick()}}}},{key:"onFragParsingData",value:function(t){var e=this,n=this.fragCurrent,i=t.frag;if(n&&"audio"===t.id&&"audio"===t.type&&i.sn===n.sn&&i.level===n.level&&this.state===S.PARSING){var r=this.trackId,a=this.tracks[r],s=this.hls;isNaN(t.endPTS)&&(t.endPTS=t.startPTS+n.duration,t.endDTS=t.startDTS+n.duration),x.logger.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),v.default.updateFragPTSDTS(a.details,n,t.startPTS,t.endPTS);var o=this.audioSwitch,u=this.media,l=!1;if(o&&u)if(u.readyState){var c=u.currentTime;x.logger.log("switching audio track : currentTime:"+c),c>=t.startPTS&&(x.logger.log("switching audio track : flushing all audio"),this.state=S.BUFFER_FLUSHING,s.trigger(m.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),l=!0,this.audioSwitch=!1,s.trigger(m.default.AUDIO_TRACK_SWITCHED,{id:r}))}else this.audioSwitch=!1,s.trigger(m.default.AUDIO_TRACK_SWITCHED,{id:r});var h=this.pendingData;this.audioSwitch||([t.data1,t.data2].forEach(function(e){e&&e.length&&h.push({type:t.type,data:e,parent:"audio",content:"data"})}),!l&&h.length&&(h.forEach(function(t){e.state===S.PARSING&&(e.pendingBuffering=!0,e.hls.trigger(m.default.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)),this.tick()}}},{key:"onFragParsed",value:function(t){var e=this.fragCurrent,n=t.frag;e&&"audio"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===S.PARSING&&(this.stats.tparsed=performance.now(),this.state=S.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(t){if("audio"===t.parent){var e=this.state;e!==S.PARSING&&e!==S.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==S.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,n=this.hls;if(t){this.fragPrevious=t,e.tbuffered=performance.now(),n.trigger(m.default.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var i=this.mediaBuffer?this.mediaBuffer:this.media;x.logger.log("audio buffered : "+E.default.toString(i.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(m.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=S.IDLE}this.tick()}}},{key:"onError",value:function(t){var e=t.frag;if(!e||"audio"===e.type)switch(t.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!t.fatal){var n=this.fragLoadError;n?n++:n=1;var i=this.config;if(n<=i.fragLoadingMaxRetry){this.fragLoadError=n,e.loadCounter=0;var r=Math.min(Math.pow(2,n-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);x.logger.warn("audioStreamController: frag loading failed, retry in "+r+" ms"),this.retryDate=performance.now()+r,this.state=S.FRAG_LOADING_WAITING_RETRY}else x.logger.error("audioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=S.ERROR}break;case T.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case T.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case T.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==S.ERROR&&(this.state=t.fatal?S.ERROR:S.IDLE,x.logger.warn("audioStreamController: "+t.details+" while loading frag,switch to "+this.state+" state ..."));break;case T.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===t.parent&&(this.state===S.PARSING||this.state===S.PARSED)){var a=this.mediaBuffer,s=this.media.currentTime;if(a&&h.default.isBuffered(a,s)&&h.default.isBuffered(a,s+.5)){var o=this.config;o.maxMaxBufferLength>=o.maxBufferLength&&(o.maxMaxBufferLength/=2,x.logger.warn("audio:reduce max buffer length to "+o.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*o.fragLoadingLoopThreshold),this.state=S.IDLE}else x.logger.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=S.BUFFER_FLUSHING,this.hls.trigger(m.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}}},{key:"onBufferFlushed",value:function(){var t=this,e=this.pendingData;e&&e.length?(x.logger.log("appending pending audio data on Buffer Flushed"),e.forEach(function(e){t.hls.trigger(m.default.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=S.PARSED):(this.state=S.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,x.logger.log("audio stream:"+e+"->"+t)}},get:function(){return this._state}}]),e}(b.default);n.default=w},{24:24,30:30,31:31,32:32,34:34,35:35,45:45,50:50,51:51}],7:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(32),l=i(u),c=t(31),h=i(c),f=t(50),d=function(t){function e(t){r(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l.default.MANIFEST_LOADING,l.default.MANIFEST_LOADED,l.default.AUDIO_TRACK_LOADED));return n.ticks=0,n.ontick=n.tick.bind(n),n}return s(e,t),o(e,[{key:"destroy",value:function(){h.default.prototype.destroy.call(this)}},{key:"tick",value:function(){1==++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(t){var e=this,n=t.audioTracks||[],i=!1;this.tracks=n,this.hls.trigger(l.default.AUDIO_TRACKS_UPDATED,{audioTracks:n});var r=0;n.forEach(function(t){if(t.default)return e.audioTrack=r,void(i=!0);r++}),!1===i&&n.length&&(f.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(t){t.id<this.tracks.length&&(f.logger.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*t.details.targetduration)),!t.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(t){if(t>=0&&t<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=t,f.logger.log("switching to audioTrack "+t);var e=this.tracks[t],n=this.hls,i=e.type,r=e.url,a={id:t,type:i,url:r};n.trigger(l.default.AUDIO_TRACK_SWITCH,a),n.trigger(l.default.AUDIO_TRACK_SWITCHING,a);var s=e.details;!r||void 0!==s&&!0!==s.live||(f.logger.log("(re)loading playlist for audioTrack "+t),n.trigger(l.default.AUDIO_TRACK_LOADING,{url:r,id:t}))}}},{key:"updateTrack",value:function(t){if(t>=0&&t<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=t,f.logger.log("updating audioTrack "+t);var e=this.tracks[t],n=e.url,i=e.details;!n||void 0!==i&&!0!==i.live||(f.logger.log("(re)loading playlist for audioTrack "+t),this.hls.trigger(l.default.AUDIO_TRACK_LOADING,{url:n,id:t}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.trackId===t&&void 0!==this.tracks[t].details||this.setAudioTrackInternal(t)}}]),e}(h.default);n.default=d},{31:31,32:32,50:50}],8:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(32),l=i(u),c=t(31),h=i(c),f=t(50),d=t(30),g=function(t){function e(t){r(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.MANIFEST_PARSED,l.default.BUFFER_RESET,l.default.BUFFER_APPENDING,l.default.BUFFER_CODECS,l.default.BUFFER_EOS,l.default.BUFFER_FLUSHING,l.default.LEVEL_PTS_UPDATED,l.default.LEVEL_UPDATED));return n._msDuration=null,n._levelDuration=null,n.onsbue=n.onSBUpdateEnd.bind(n),n.onsbe=n.onSBUpdateError.bind(n),n.pendingTracks={},n.tracks={},n}return s(e,t),o(e,[{key:"destroy",value:function(){h.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(t){var e=t.type,n=this.tracks.audio;if("audio"===e&&n&&"audio/mpeg"===n.container){var i=this.sourceBuffer.audio;if(Math.abs(i.timestampOffset-t.start)>.1){var r=i.updating;try{i.abort()}catch(t){r=!0,f.logger.warn("can not abort audio buffer: "+t)}r?this.audioTimestampOffset=t.start:(f.logger.warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+t.start),i.timestampOffset=t.start)}}}},{key:"onManifestParsed",value:function(t){var e=t.audio,n=t.video,i=0;t.altAudio&&(e||n)&&(i=(e?1:0)+(n?1:0),f.logger.log(i+" sourceBuffer(s) expected")),this.sourceBufferNb=i}},{key:"onMediaAttaching",value:function(t){var e=this.media=t.media;if(e){var n=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener("sourceopen",this.onmso),n.addEventListener("sourceended",this.onmse),n.addEventListener("sourceclose",this.onmsc),e.src=URL.createObjectURL(n)}}},{key:"onMediaDetaching",value:function(){f.logger.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){f.logger.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(l.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){f.logger.log("media source opened"),this.hls.trigger(l.default.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var t=this.pendingTracks,e=Object.keys(t).length;e&&(this.sourceBufferNb<=e||0===this.sourceBufferNb)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){f.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){f.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var t=this.sourceBuffer.audio;f.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var e=this.parent,n=this.segments.reduce(function(t,n){return n.parent===e?t+1:t},0);this.hls.trigger(l.default.BUFFER_APPENDED,{parent:e,pending:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(t){f.logger.error("sourceBuffer error:",t),this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var t=this.sourceBuffer;for(var e in t){var n=t[e];try{this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this.onsbue),n.removeEventListener("error",this.onsbe)}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(t){if(0===Object.keys(this.sourceBuffer).length){for(var e in t)this.pendingTracks[e]=t[e];var n=this.mediaSource;n&&"open"===n.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(t){var e=this.sourceBuffer,n=this.mediaSource;for(var i in t)if(!e[i]){var r=t[i],a=r.levelCodec||r.codec,s=r.container+";codecs="+a;f.logger.log("creating sourceBuffer("+s+")");try{var o=e[i]=n.addSourceBuffer(s);o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe),this.tracks[i]={codec:a,container:r.container},r.buffer=o}catch(t){f.logger.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:s})}}this.hls.trigger(l.default.BUFFER_CREATED,{tracks:t})}},{key:"onBufferAppending",value:function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())}},{key:"onBufferAppendFail",value:function(t){f.logger.error("sourceBuffer error:",t.event),this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function(t){var e=this.sourceBuffer,n=t.type;for(var i in e)n&&i!==n||e[i].ended||(e[i].ended=!0,f.logger.log(i+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var t=this.sourceBuffer,e=this.mediaSource;if(!e||"open"!==e.readyState)return void(this._needsEos=!1);for(var n in t){var i=t[n];if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}f.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){f.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(t){var e=t.details;0!==e.fragments.length&&(this._levelDuration=e.totalduration+e.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var t=this.media,e=this.mediaSource,n=this.sourceBuffer,i=this._levelDuration;if(null!==i&&t&&e&&n&&0!==t.readyState&&"open"===e.readyState){for(var r in n)if(n[r].updating)return;null===this._msDuration&&(this._msDuration=e.duration);var a=t.duration;(i>this._msDuration&&i>a||a===1/0||isNaN(a))&&(f.logger.log("Updating mediasource duration to "+i.toFixed(3)),this._msDuration=e.duration=i)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,n=this.sourceBuffer;try{for(var i in n)e+=n[i].buffered.length}catch(t){f.logger.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(l.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var t=this.hls,e=this.sourceBuffer,n=this.segments;if(Object.keys(e).length){if(this.media.error)return this.segments=[],void f.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(n&&n.length){var i=n.shift();try{var r=i.type,a=e[r];a?a.updating?n.unshift(i):(a.ended=!1,this.parent=i.parent,a.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){f.logger.error("error while trying to append buffer:"+e.message),n.unshift(i);var s={type:d.ErrorTypes.MEDIA_ERROR,parent:i.parent};if(22===e.code)return this.segments=[],s.details=d.ErrorDetails.BUFFER_FULL_ERROR,s.fatal=!1,void t.trigger(l.default.ERROR,s);if(this.appendError?this.appendError++:this.appendError=1,s.details=d.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry)return f.logger.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),n=[],s.fatal=!0,void t.trigger(l.default.ERROR,s);s.fatal=!1,t.trigger(l.default.ERROR,s)}}}}},{key:"flushBuffer",value:function(t,e,n){var i,r,a,s,o,u,l=this.sourceBuffer;if(Object.keys(l).length){if(f.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+e),this.flushBufferCounter<this.appended){for(var c in l)if(!n||c===n){if(i=l[c],i.ended=!1,i.updating)return f.logger.warn("cannot flush, sb updating in progress"),!1;try{for(r=0;r<i.buffered.length;r++)if(a=i.buffered.start(r),s=i.buffered.end(r),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&e===Number.POSITIVE_INFINITY?(o=t,u=e):(o=Math.max(a,t),u=Math.min(s,e)),Math.min(u,s)-o>.5)return this.flushBufferCounter++,f.logger.log("flush "+c+" ["+o+","+u+"], of ["+a+","+s+"], pos:"+this.media.currentTime),i.remove(o,u),!1}catch(t){f.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else f.logger.warn("abort flushing too many retries");f.logger.log("buffer flushed")}return!0}}]),e}(h.default);n.default=g},{30:30,31:31,32:32,50:50}],9:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(32),l=i(u),c=t(31),h=i(c),f=function(t){function e(t){return r(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l.default.FPS_DROP_LEVEL_CAPPING,l.default.MEDIA_ATTACHING,l.default.MANIFEST_PARSED))}return s(e,t),o(e,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(t){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(t.droppedLevel)||this.restrictedLevels.push(t.droppedLevel)}},{key:"onMediaAttaching",value:function(t){this.media=t.media instanceof HTMLVideoElement?t.media:null}},{key:"onManifestParsed",value:function(t){var e=this.hls;e.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=t.levels,e.firstLevel=this.getMaxLevel(t.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}},{key:"getMaxLevel",value:function(t){var e=0,n=void 0,i=void 0,r=this.mediaWidth,a=this.mediaHeight,s=0,o=0;for(n=0;n<=t&&(i=this.levels[n],!this.isLevelRestricted(n))&&(e=n,s=i.width,o=i.height,!(r<=s||a<=o));n++);return e}},{key:"isLevelRestricted",value:function(t){return!(!this.restrictedLevels||-1===this.restrictedLevels.indexOf(t))}},{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t}},{key:"mediaWidth",get:function(){var t=void 0,e=this.media;return e&&(t=e.width||e.clientWidth||e.offsetWidth,t*=this.contentScaleFactor),t}},{key:"mediaHeight",get:function(){var t=void 0,e=this.media;return e&&(t=e.height||e.clientHeight||e.offsetHeight,t*=this.contentScaleFactor),t}}]),e}(h.default);n.default=f},{31:31,32:32}],10:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(32),l=i(u),c=t(31),h=i(c),f=t(50),d=function(t){function e(t){return r(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l.default.MEDIA_ATTACHING))}return s(e,t),o(e,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(t){var e=this.hls.config;e.capLevelOnFPSDrop&&("function"==typeof(this.video=t.media instanceof HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod))}},{key:"checkFPS",value:function(t,e,n){var i=performance.now();if(e){if(this.lastTime){var r=i-this.lastTime,a=n-this.lastDroppedFrames,s=e-this.lastDecodedFrames,o=1e3*a/r,u=this.hls;if(u.trigger(l.default.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:n}),o>0&&a>u.config.fpsDroppedMonitoringThreshold*s){var c=u.currentLevel;f.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=c)&&(c-=1,u.trigger(l.default.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,u.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=e}}},{key:"checkFPSInterval",value:function(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}]),e}(h.default);n.default=d},{31:31,32:32,50:50}],11:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(32),l=i(u),c=t(31),h=i(c),f=t(50),d=t(30),g=t(34),m=i(g),p=function(t){function e(t){r(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l.default.MANIFEST_LOADED,l.default.LEVEL_LOADED,l.default.FRAG_LOADED,l.default.ERROR));return n.ontick=n.tick.bind(n),n._manualLevel=-1,n}return s(e,t),o(e,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var t=this._levels;t&&t.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(t){var e,n=[],i=[],r={},a=!1,s=!1,o=this.hls,u=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),c=function(t,e){return MediaSource.isTypeSupported(t+"/mp4;codecs="+e)};if(t.levels.forEach(function(t){t.videoCodec&&(a=!0),u&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),(t.audioCodec||t.attrs&&t.attrs.AUDIO)&&(s=!0);var e=r[t.bitrate];void 0===e?(r[t.bitrate]=n.length,t.url=[t.url],t.urlId=0,n.push(t)):n[e].url.push(t.url)}),a&&s?n.forEach(function(t){t.videoCodec&&i.push(t)}):i=n,i=i.filter(function(t){var e=t.audioCodec,n=t.videoCodec;return(!e||c("audio",e))&&(!n||c("video",n))}),i.length){e=i[0].bitrate,i.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=i;for(var h=0;h<i.length;h++)if(i[h].bitrate===e){this._firstLevel=h,f.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+e);break}o.trigger(l.default.MANIFEST_PARSED,{levels:i,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:a,altAudio:t.audioTracks.length>0})}else o.trigger(l.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,
details:d.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:o.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(t){var e=this._levels,n=this.hls;if(t>=0&&t<e.length){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==t){f.logger.log("switching to level "+t),this._level=t;var i=e[t];i.level=t,n.trigger(l.default.LEVEL_SWITCH,i),n.trigger(l.default.LEVEL_SWITCHING,i)}var r=e[t],a=r.details;if(!a||!0===a.live){var s=r.urlId;n.trigger(l.default.LEVEL_LOADING,{url:r.url[s],level:t,id:s})}}else n.trigger(l.default.ERROR,{type:d.ErrorTypes.OTHER_ERROR,details:d.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(t){if(!t.fatal){var e=t.details,n=this.hls,i=void 0,r=void 0,a=!1;switch(e){case d.ErrorDetails.FRAG_LOAD_ERROR:case d.ErrorDetails.FRAG_LOAD_TIMEOUT:case d.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case d.ErrorDetails.KEY_LOAD_ERROR:case d.ErrorDetails.KEY_LOAD_TIMEOUT:i=t.frag.level;break;case d.ErrorDetails.LEVEL_LOAD_ERROR:case d.ErrorDetails.LEVEL_LOAD_TIMEOUT:i=t.context.level,a=!0;break;case d.ErrorDetails.REMUX_ALLOC_ERROR:i=t.level}if(void 0!==i){r=this._levels[i],r.loadError?r.loadError++:r.loadError=1;var s=r.url.length;if(s>1&&r.loadError<s)r.urlId=(r.urlId+1)%s,r.details=void 0,f.logger.warn("level controller,"+e+" for level "+i+": switching to redundant stream id "+r.urlId);else if(-1===this._manualLevel&&i)f.logger.warn("level controller,"+e+": switch-down for next fragment"),n.nextAutoLevel=Math.max(0,i-1);else if(r&&r.details&&r.details.live)f.logger.warn("level controller,"+e+" on live stream, discard"),a&&(this._level=void 0);else if(e===d.ErrorDetails.LEVEL_LOAD_ERROR||e===d.ErrorDetails.LEVEL_LOAD_TIMEOUT){var o=n.media,u=o&&m.default.isBuffered(o,o.currentTime)&&m.default.isBuffered(o,o.currentTime+.5);if(u){var l=n.config.levelLoadingRetryDelay;f.logger.warn("level controller,"+e+", but media buffered, retry in "+l+"ms"),this.timer=setTimeout(this.ontick,l)}else f.logger.error("cannot recover "+e+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),t.fatal=!0}}}}},{key:"onFragLoaded",value:function(t){var e=t.frag;if(e&&"main"===e.type){var n=this._levels[e.level];n&&(n.loadError=0)}}},{key:"onLevelLoaded",value:function(t){var e=t.level;if(e===this._level){var n=this._levels[e];n.loadError=0;var i=t.details;if(i.live){var r=1e3*(i.averagetargetduration?i.averagetargetduration:i.targetduration),a=n.details;a&&i.endSN===a.endSN&&(r/=2,f.logger.log("same live playlist, reload twice faster")),r-=performance.now()-t.stats.trequest,r=Math.max(1e3,Math.round(r)),f.logger.log("live playlist, reload in "+r+" ms"),this.timer=setTimeout(this.ontick,r)}else this.timer=null}}},{key:"tick",value:function(){var t=this._level;if(void 0!==t&&this.canload){var e=this._levels[t];if(e&&e.url){var n=e.urlId;this.hls.trigger(l.default.LEVEL_LOADING,{url:e.url[n],level:t,id:n})}}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(t){var e=this._levels;e&&e.length>t&&(this._level===t&&void 0!==e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(t){this._manualLevel=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this._manualLevel&&(this.hls.nextAutoLevel=t)}}]),e}(h.default);n.default=p},{30:30,31:31,32:32,34:34,50:50}],12:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(45),l=i(u),c=t(34),h=i(c),f=t(24),d=i(f),g=t(32),m=i(g),p=t(31),b=i(p),_=t(35),v=i(_),y=t(51),E=i(y),T=t(30),x=t(50),S={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},w=function(t){function e(t){r(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,m.default.MEDIA_ATTACHED,m.default.MEDIA_DETACHING,m.default.MANIFEST_LOADING,m.default.MANIFEST_PARSED,m.default.LEVEL_LOADED,m.default.KEY_LOADED,m.default.FRAG_LOADED,m.default.FRAG_LOAD_EMERGENCY_ABORTED,m.default.FRAG_PARSING_INIT_SEGMENT,m.default.FRAG_PARSING_DATA,m.default.FRAG_PARSED,m.default.ERROR,m.default.AUDIO_TRACK_SWITCHING,m.default.AUDIO_TRACK_SWITCHED,m.default.BUFFER_CREATED,m.default.BUFFER_APPENDED,m.default.BUFFER_FLUSHED));return n.config=t.config,n.audioCodecSwap=!1,n.ticks=0,n._state=S.STOPPED,n.ontick=n.tick.bind(n),n}return s(e,t),o(e,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),b.default.prototype.destroy.call(this),this.state=S.STOPPED}},{key:"startLoad",value:function(t){if(this.levels){var e=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=n.startLevel;-1===i&&(i=0,this.bitrateTest=!0),this.level=n.nextLoadLevel=i,this.loadedmetadata=!1}e>0&&-1===t&&(x.logger.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=S.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=S.STOPPED}},{key:"stopLoad",value:function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=S.STOPPED,this.forceStartLoad=!1}},{key:"tick",value:function(){1==++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case S.ERROR:break;case S.BUFFER_FLUSHING:this.fragLoadError=0;break;case S.IDLE:this._doTickIdle();break;case S.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=S.IDLE);break;case S.FRAG_LOADING_WAITING_RETRY:var e=performance.now(),n=this.retryDate;(!n||e>=n||this.media&&this.media.seeking)&&(x.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=S.IDLE);break;case S.ERROR:case S.STOPPED:case S.FRAG_LOADING:case S.PARSING:case S.PARSED:case S.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var t=this.hls,e=t.config,n=this.media;if(void 0===this.levelLastLoaded||n||!this.startFragRequested&&e.startFragPrefetch){var i=void 0;i=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var r=t.nextLoadLevel,a=this.levels[r],s=a.bitrate,o=void 0;o=s?Math.max(8*e.maxBufferSize/s,e.maxBufferLength):e.maxBufferLength,o=Math.min(o,e.maxMaxBufferLength);var u=h.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,i,e.maxBufferHole),l=u.len;if(!(l>=o)){x.logger.trace("buffer length of "+l.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=r;var c=a.details;if(void 0===c||c.live&&this.levelLastLoaded!==r)return void(this.state=S.WAITING_LEVEL);var f=this.fragPrevious;if(!c.live&&f&&f.sn===c.endSN&&Math.min(n.duration,f.start+f.duration)-Math.max(u.end,f.start)<=Math.max(.2,f.duration/2)){var d={};return this.altAudio&&(d.type="video"),this.hls.trigger(m.default.BUFFER_EOS,d),void(this.state=S.ENDED)}this._fetchPayloadOrEos(i,u,c)}}}},{key:"_fetchPayloadOrEos",value:function(t,e,n){var i=this.fragPrevious,r=this.level,a=n.fragments,s=a.length;if(0!==s){var o=a[0].start,u=a[s-1].start+a[s-1].duration,l=e.end,c=void 0;if(n.initSegment&&!n.initSegment.data)c=n.initSegment;else if(n.live){var h=this.config.initialLiveManifestSize;if(s<h)return void x.logger.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+h);if(null===(c=this._ensureFragmentAtLivePoint(n,l,o,u,i,a,s)))return}else l<o&&(c=a[0]);c||(c=this._findFragment(o,i,s,a,l,u,n)),c&&this._loadFragmentOrKey(c,r,n,t,l)}}},{key:"_ensureFragmentAtLivePoint",value:function(t,e,n,i,r,a,s){var o=this.hls.config,u=this.media,l=void 0,c=void 0!==o.liveMaxLatencyDuration?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*t.targetduration;if(e<Math.max(n-o.maxFragLookUpTolerance,i-c)){var h=this.liveSyncPosition=this.computeLivePosition(n,t);x.logger.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),e=h,u&&u.readyState&&u.duration>h&&(u.currentTime=h)}if(t.PTSKnown&&e>i&&u&&u.readyState)return null;if(this.startFragRequested&&!t.PTSKnown){if(r){var f=r.sn+1;f>=t.startSN&&f<=t.endSN&&(l=a[f-t.startSN],x.logger.log("live playlist, switching playlist, load frag with next SN: "+l.sn))}l||(l=a[Math.min(s-1,Math.round(s/2))],x.logger.log("live playlist, switching playlist, unknown, load middle frag : "+l.sn))}return l}},{key:"_findFragment",value:function(t,e,n,i,r,a,s){var o=this.hls.config,u=void 0,c=void 0,h=o.maxFragLookUpTolerance,f=e?i[e.sn-i[0].sn+1]:void 0,d=function(t){var e=Math.min(h,t.duration);return t.start+t.duration-e<=r?1:t.start-e>r&&t.start?-1:0};if(r<a?(r>a-h&&(h=0),c=f&&!d(f)?f:l.default.search(i,d)):c=i[n-1],c){u=c;var g=u.sn-s.startSN,m=e&&u.level===e.level,p=i[g-1],b=i[g+1];if(m&&u.sn===e.sn)if(u.sn<s.endSN){var _=e.deltaPTS;_&&_>o.maxBufferHole&&e.dropped&&g?(u=p,x.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),e.loadCounter--):(u=b,x.logger.log("SN just loaded, load next one: "+u.sn))}else u=null;else u.dropped&&!m&&(b&&b.backtracked?(x.logger.warn("Already backtracked from fragment "+(g+1)+", will not backtrack to fragment "+g+". Loading fragment "+(g+1)),u=b):(x.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),u.dropped=0,p?(p.loadCounter&&p.loadCounter--,u=p):u=null))}return u}},{key:"_loadFragmentOrKey",value:function(t,e,n,i,r){var a=this.hls,s=a.config;if(!t.decryptdata||null==t.decryptdata.uri||null!=t.decryptdata.key){if(x.logger.log("Loading "+t.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+e+", currentTime:"+i.toFixed(3)+",bufferEnd:"+r.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,t.loadCounter){t.loadCounter++;var o=s.fragLoadingLoopThreshold;if(t.loadCounter>o&&Math.abs(this.fragLoadIdx-t.loadIdx)<o)return void a.trigger(m.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:t})}else t.loadCounter=1;return t.loadIdx=this.fragLoadIdx,this.fragCurrent=t,this.startFragRequested=!0,isNaN(t.sn)||(this.nextLoadPosition=t.start+t.duration),t.autoLevel=a.autoLevelEnabled,t.bitrateTest=this.bitrateTest,a.trigger(m.default.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new d.default(a,"main")),void(this.state=S.FRAG_LOADING)}x.logger.log("Loading key for "+t.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+e),this.state=S.KEY_LOADING,a.trigger(m.default.KEY_LOADING,{frag:t})}},{key:"getBufferedFrag",value:function(t){return l.default.search(this._bufferedFrags,function(e){return t<e.startPTS?-1:t>e.endPTS?1:0})}},{key:"followingBufferedFrag",value:function(t){return t?this.getBufferedFrag(t.endPTS+.5):null}},{key:"_checkFragmentChanged",value:function(){var t,e,n=this.media;if(n&&n.readyState&&!1===n.seeking&&(e=n.currentTime,e>n.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=e),h.default.isBuffered(n,e)?t=this.getBufferedFrag(e):h.default.isBuffered(n,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var i=t;if(i!==this.fragPlaying){this.hls.trigger(m.default.FRAG_CHANGED,{frag:i});var r=i.level;this.fragPlaying&&this.fragPlaying.level===r||this.hls.trigger(m.default.LEVEL_SWITCHED,{level:r}),this.fragPlaying=i}}}},{key:"immediateLevelSwitch",value:function(){if(x.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t=this.media,e=void 0;t?(e=t.paused,t.pause()):e=!0,this.previouslyPaused=e}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,h.default.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())}},{key:"nextLevelSwitch",value:function(){var t=this.media;if(t&&t.readyState){var e=void 0,n=void 0,i=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,n=this.getBufferedFrag(t.currentTime),n&&n.startPTS>1&&this.flushMainBuffer(0,n.startPTS-1),t.paused)e=0;else{var r=this.hls.nextLoadLevel,a=this.levels[r],s=this.fragLastKbps;e=s&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*s)+1:0}if((i=this.getBufferedFrag(t.currentTime+e))&&(i=this.followingBufferedFrag(i))){var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.startPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(t,e){this.state=S.BUFFER_FLUSHING;var n={startOffset:t,endOffset:e};this.altAudio&&(n.type="video"),this.hls.trigger(m.default.BUFFER_FLUSHING,n)}},{key:"onMediaAttached",value:function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var t=this.media;t&&t.ended&&(x.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0,t.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var t=this.media,e=t?t.currentTime:void 0,n=this.config;if(x.logger.log("media seeking to "+e.toFixed(3)),this.state===S.FRAG_LOADING){var i=this.mediaBuffer?this.mediaBuffer:t,r=h.default.bufferInfo(i,e,this.config.maxBufferHole),a=this.fragCurrent;if(0===r.len&&a){var s=n.maxFragLookUpTolerance,o=a.start-s,u=a.start+a.duration+s;e<o||e>u?(a.loader&&(x.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=S.IDLE):x.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===S.ENDED&&(this.state=S.IDLE);t&&(this.lastCurrentTime=e),this.state!==S.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*n.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=e),this.tick()}},{key:"onMediaSeeked",value:function(){x.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){x.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){x.logger.log("trigger BUFFER_RESET"),this.hls.trigger(m.default.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(t){var e,n=!1,i=!1;t.levels.forEach(function(t){(e=t.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(n=!0),-1!==e.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=n&&i,this.audioCodecSwitch&&x.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var r=this.config;(r.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(r.startPosition)}},{key:"onLevelLoaded",value:function(t){var e=t.details,n=t.level,i=this.levels[n],r=e.totalduration,a=0;if(x.logger.log("level "+n+" loaded ["+e.startSN+","+e.endSN+"],duration:"+r),this.levelLastLoaded=n,e.live){var s=i.details;s&&e.fragments.length>0?(v.default.mergeDetails(s,e),a=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,s),e.PTSKnown?x.logger.log("live playlist sliding:"+a.toFixed(3)):x.logger.log("live playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,x.logger.log("live playlist - first load, unknown sliding"))}else e.PTSKnown=!1;if(i.details=e,this.hls.trigger(m.default.LEVEL_UPDATED,{details:e,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var o=e.startTimeOffset;isNaN(o)?e.live?(this.startPosition=this.computeLivePosition(a,e),x.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(o<0&&(x.logger.log("negative start time offset "+o+", count from end of last fragment"),o=a+r+o),x.logger.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===S.WAITING_LEVEL&&(this.state=S.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===S.KEY_LOADING&&(this.state=S.IDLE,this.tick())}},{key:"onFragLoaded",value:function(t){var e=this.fragCurrent,n=t.frag;if(this.state===S.FRAG_LOADING&&e&&"main"===n.type&&n.level===e.level&&n.sn===e.sn){var i=t.stats,r=this.levels[e.level],a=r.details;if(x.logger.log("Loaded  "+e.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+e.level),this.bitrateTest=!1,this.stats=i,!0===n.bitrateTest&&this.hls.nextLoadLevel)this.state=S.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=performance.now(),this.hls.trigger(m.default.FRAG_BUFFERED,{stats:i,frag:e,id:"main"}),this.tick();else if("initSegment"===n.sn)this.state=S.IDLE,i.tparsed=i.tbuffered=performance.now(),a.initSegment.data=t.payload,this.hls.trigger(m.default.FRAG_BUFFERED,{stats:i,frag:e,id:"main"}),this.tick();else{this.state=S.PARSING;var s=a.totalduration,o=e.level,u=e.sn,l=this.config.defaultAudioCodec||r.audioCodec;this.audioCodecSwap&&(x.logger.log("swapping playlist audio codec"),void 0===l&&(l=this.lastAudioCodec),l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,x.logger.log("Parsing "+u+" of ["+a.startSN+" ,"+a.endSN+"],level "+o+", cc "+e.cc);var c=this.demuxer;c||(c=this.demuxer=new d.default(this.hls,"main"));var h=this.media,f=h&&h.seeking,g=!f&&(a.PTSKnown||!a.live),p=a.initSegment?a.initSegment.data:[];c.push(t.payload,p,l,r.videoCodec,e,s,g,void 0)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(t){var e=this.fragCurrent,n=t.frag;if(e&&"main"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===S.PARSING){var i,r,a=t.tracks;if(a.audio&&this.altAudio&&delete a.audio,r=a.audio){var s=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(x.logger.log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==r.metadata.channelCount&&-1===o.indexOf("firefox")&&(s="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==r.container&&(s="mp4a.40.2",x.logger.log("Android: force audio codec to "+s)),r.levelCodec=s,r.id=t.id}r=a.video,r&&(r.levelCodec=this.levels[this.level].videoCodec,r.id=t.id),this.hls.trigger(m.default.BUFFER_CODECS,a);for(i in a){r=a[i],x.logger.log("main track:"+i+",container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var u=r.initSegment;u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(m.default.BUFFER_APPENDING,{type:i,data:u,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(t){var e=this,n=this.fragCurrent,i=t.frag;if(n&&"main"===t.id&&i.sn===n.sn&&i.level===n.level&&("audio"!==t.type||!this.altAudio)&&this.state===S.PARSING){var r=this.levels[this.level],a=n;if(isNaN(t.endPTS)&&(t.endPTS=t.startPTS+n.duration,t.endDTS=t.startDTS+n.duration),x.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(a.dropped=t.dropped,a.dropped){if(!a.backtracked)return a.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=S.IDLE,void this.tick();x.logger.warn("Already backtracked on this fragment, appending with the gap")}else a.backtracked=!1;var s=v.default.updateFragPTSDTS(r.details,a,t.startPTS,t.endPTS,t.startDTS,t.endDTS),o=this.hls;o.trigger(m.default.LEVEL_PTS_UPDATED,{details:r.details,level:this.level,drift:s,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(n){n&&n.length&&e.state===S.PARSING&&(e.appended=!0,e.pendingBuffering=!0,o.trigger(m.default.BUFFER_APPENDING,{type:t.type,data:n,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(t){var e=this.fragCurrent,n=t.frag;e&&"main"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===S.PARSING&&(this.stats.tparsed=performance.now(),this.state=S.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(t){var e=!!t.url,n=t.id;if(!e){if(this.mediaBuffer!==this.media){x.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(x.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=S.IDLE}var r=this.hls;r.trigger(m.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),r.trigger(m.default.AUDIO_TRACK_SWITCHED,{id:n}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(t){var e=t.id,n=!!this.hls.audioTracks[e].url;if(n){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(x.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n,this.tick()}},{key:"onBufferCreated",value:function(t){var e=t.tracks,n=void 0,i=void 0,r=!1;for(var a in e){var s=e[a];"main"===s.id?(i=a,n=s,"video"===a&&(this.videoBuffer=e[a].buffer)):r=!0}r&&n?(x.logger.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(t){if("main"===t.parent){var e=this.state;e!==S.PARSING&&e!==S.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==S.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;x.logger.log("main buffered : "+E.default.toString(e.buffered));var n=this._bufferedFrags.filter(function(t){return h.default.isBuffered(e,(t.startPTS+t.endPTS)/2)});n.push(t),this._bufferedFrags=n.sort(function(t,e){return t.startPTS-e.startPTS}),this.fragPrevious=t;var i=this.stats;i.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(m.default.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),this.state=S.IDLE}this.tick()}}},{key:"onError",value:function(t){var e=t.frag||this.fragCurrent;if(!e||"main"===e.type){var n=this.media,i=n&&h.default.isBuffered(n,n.currentTime)&&h.default.isBuffered(n,n.currentTime+.5);switch(t.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:if(!t.fatal){var r=this.fragLoadError;r?r++:r=1;var a=this.config;if(r<=a.fragLoadingMaxRetry||i||e.autoLevel&&e.level){this.fragLoadError=r,e.loadCounter=0;var s=Math.min(Math.pow(2,r-1)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);x.logger.warn("mediaController: frag loading failed, retry in "+s+" ms"),this.retryDate=performance.now()+s,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=S.FRAG_LOADING_WAITING_RETRY}else x.logger.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=S.ERROR}break;case T.ErrorDetails.FRAG_LOOP_LOADING_ERROR:t.fatal||(i?(this._reduceMaxBufferLength(e.duration),this.state=S.IDLE):e.autoLevel&&0!==e.level||(t.fatal=!0,this.state=S.ERROR));break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==S.ERROR&&(t.fatal?(this.state=S.ERROR,x.logger.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):this.state===S.WAITING_LEVEL&&(this.state=S.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==S.PARSING&&this.state!==S.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=S.IDLE):(x.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(t){var e=this.config;e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,x.logger.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*e.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var t=this.media;if(t&&t.readyState){var e=t.currentTime,n=this.mediaBuffer?this.mediaBuffer:t,i=n.buffered;if(!this.loadedmetadata&&i.length){this.loadedmetadata=!0;var r=t.seeking?e:this.startPosition,a=h.default.isBuffered(n,r);e===r&&a||(x.logger.log("target start position:"+r),a||(r=i.start(0),x.logger.log("target start position not buffered, seek to buffered.start(0) "+r)),x.logger.log("adjust currentTime from "+e+" to "+r),t.currentTime=r)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var s=h.default.bufferInfo(t,e,0),o=!(t.paused||t.ended||0===t.buffered.length),u=e!==this.lastCurrentTime,l=this.config;if(u)this.stallReported&&(x.logger.warn("playback not stuck anymore @"+e+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(o){var c=performance.now(),f=this.hls;if(this.stalled){var d=c-this.stalled,g=s.len,p=this.nudgeRetry||0;if(g<=.5&&d>1e3*l.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,x.logger.warn("playback stalling in low buffer @"+e),f.trigger(m.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:g}));var b=s.nextStart,_=b-e;if(b&&_<l.maxSeekHole&&_>0){this.nudgeRetry=++p;var v=p*l.nudgeOffset;x.logger.log("adjust currentTime from "+t.currentTime+" to next buffered @ "+b+" + nudge "+v),t.currentTime=b+v,this.stalled=void 0,f.trigger(m.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:b+v-e})}}else if(g>.5&&d>1e3*l.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,x.logger.warn("playback stalling in high buffer @"+e),f.trigger(m.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:g})),this.stalled=void 0,this.nudgeRetry=++p,p<l.nudgeMaxRetry){var y=t.currentTime,E=y+p*l.nudgeOffset;x.logger.log("adjust currentTime from "+y+" to "+E),t.currentTime=E,f.trigger(m.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else x.logger.error("still stuck in high buffer @"+e+" after "+l.nudgeMaxRetry+", raise fatal error"),f.trigger(m.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=c,this.stallReported=!1}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=S.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var t=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(e){return h.default.isBuffered(t,(e.startPTS+e.endPTS)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=S.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(t,e){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-n)}},{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,x.logger.log("main stream:"+e+"->"+t),this.hls.trigger(m.default.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}}]),e}(b.default);n.default=w},{24:24,30:30,31:31,32:32,34:34,35:35,45:45,50:50,51:51}],13:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(32),l=i(u),c=t(31),h=i(c),f=t(50),d=function(t){function e(t){r(this,e)
;var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l.default.ERROR,l.default.SUBTITLE_TRACKS_UPDATED,l.default.SUBTITLE_TRACK_SWITCH,l.default.SUBTITLE_TRACK_LOADED,l.default.SUBTITLE_FRAG_PROCESSED));return n.config=t.config,n.vttFragSNsProcessed={},n.vttFragQueues=void 0,n.currentlyProcessing=null,n.currentTrackId=-1,n}return s(e,t),o(e,[{key:"destroy",value:function(){h.default.prototype.destroy.call(this)}},{key:"clearVttFragQueues",value:function(){var t=this;this.vttFragQueues={},this.tracks.forEach(function(e){t.vttFragQueues[e.id]=[]})}},{key:"nextFrag",value:function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var t=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.hls.trigger(l.default.FRAG_LOADING,{frag:t})}}},{key:"onSubtitleFragProcessed",value:function(t){t.success&&this.vttFragSNsProcessed[t.frag.trackId].push(t.frag.sn),this.currentlyProcessing=null,this.nextFrag()}},{key:"onError",value:function(t){var e=t.frag;e&&"subtitle"!==e.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())}},{key:"onSubtitleTracksUpdated",value:function(t){var e=this;f.logger.log("subtitle tracks updated"),this.tracks=t.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(t){e.vttFragSNsProcessed[t.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function(t){this.currentTrackId=t.id,this.clearVttFragQueues()}},{key:"onSubtitleTrackLoaded",value:function(t){var e=this.vttFragSNsProcessed[t.id],n=this.vttFragQueues[t.id],i=this.currentlyProcessing?this.currentlyProcessing.sn:-1,r=function(t){return e.indexOf(t.sn)>-1},a=function(t){return n.some(function(e){return e.sn===t.sn})};t.details.fragments.forEach(function(e){r(e)||e.sn===i||a(e)||(e.trackId=t.id,n.push(e))}),this.nextFrag()}}]),e}(h.default);n.default=d},{31:31,32:32,50:50}],14:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(32),l=i(u),c=t(31),h=i(c),f=t(50),d=function(t){function e(t){r(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.MANIFEST_LOADING,l.default.MANIFEST_LOADED,l.default.SUBTITLE_TRACK_LOADED));return n.tracks=[],n.trackId=-1,n.media=void 0,n}return s(e,t),o(e,[{key:"destroy",value:function(){h.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(t){var e=this;this.media=t.media,this.media&&this.media.textTracks.addEventListener("change",function(){if(e.media){for(var t=-1,n=e.media.textTracks,i=0;i<n.length;i++)"showing"===n[i].mode&&(t=i);e.subtitleTrack=t}})}},{key:"onMediaDetaching",value:function(){this.media=void 0}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(t){var e=this,n=t.subtitles||[],i=!1;this.tracks=n,this.trackId=-1,this.hls.trigger(l.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach(function(t){t.default&&(e.subtitleTrack=t.id,i=!0)})}},{key:"onTick",value:function(){var t=this.trackId,e=this.tracks[t];if(e){var n=e.details;void 0!==n&&!0!==n.live||(f.logger.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(l.default.SUBTITLE_TRACK_LOADING,{url:e.url,id:t}))}}},{key:"onSubtitleTrackLoaded",value:function(t){var e=this;t.id<this.tracks.length&&(f.logger.log("subtitle track "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(function(){e.onTick()},1e3*t.details.targetduration,this)),!t.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setSubtitleTrackInternal",value:function(t){if(t>=0&&t<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=t,f.logger.log("switching to subtitle track "+t);var e=this.tracks[t];this.hls.trigger(l.default.SUBTITLE_TRACK_SWITCH,{id:t});var n=e.details;void 0!==n&&!0!==n.live||(f.logger.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(l.default.SUBTITLE_TRACK_LOADING,{url:e.url,id:t}))}}},{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&this.setSubtitleTrackInternal(t)}}]),e}(h.default);n.default=d},{31:31,32:32,50:50}],15:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t){if(t&&t.cues)for(;t.cues.length>0;)t.removeCue(t.cues[0])}function u(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}function l(t,e,n,i){return Math.min(e,i)-Math.max(t,n)}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),h=t(32),f=i(h),d=t(31),g=i(d),m=t(46),p=i(m),b=t(54),_=i(b),v=t(50),y=function(t){function e(t){r(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,f.default.MEDIA_ATTACHING,f.default.MEDIA_DETACHING,f.default.FRAG_PARSING_USERDATA,f.default.MANIFEST_LOADING,f.default.MANIFEST_LOADED,f.default.FRAG_LOADED,f.default.LEVEL_SWITCHING,f.default.INIT_PTS_FOUND));if(n.hls=t,n.config=t.config,n.enabled=!0,n.Cues=t.config.cueHandler,n.textTracks=[],n.tracks=[],n.unparsedVttFrags=[],n.initPTS=void 0,n.cueRanges=[],n.config.enableCEA708Captions){var i=n,s=function(t,e){var n=null;try{n=new window.Event("addtrack")}catch(t){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=t,e.dispatchEvent(n)},u={newCue:function(t,e,n){if(!i.textTrack1){var r=i.getExistingTrack("1");if(r)i.textTrack1=r,o(i.textTrack1),s(i.textTrack1,i.media);else{var a=i.createTextTrack("captions",i.config.captionsTextTrack1Label,i.config.captionsTextTrack1LanguageCode);a&&(a.textTrack1=!0,i.textTrack1=a)}}i.addCues("textTrack1",t,e,n)}},l={newCue:function(t,e,n){if(!i.textTrack2){var r=i.getExistingTrack("2");if(r)i.textTrack2=r,o(i.textTrack2),s(i.textTrack2,i.media);else{var a=i.createTextTrack("captions",i.config.captionsTextTrack2Label,i.config.captionsTextTrack1LanguageCode);a&&(a.textTrack2=!0,i.textTrack2=a)}}i.addCues("textTrack2",t,e,n)}};n.cea608Parser=new p.default(0,u,l)}return n}return s(e,t),c(e,[{key:"addCues",value:function(t,e,n,i){for(var r=this.cueRanges,a=!1,s=r.length;s--;){var o=r[s],u=l(o[0],o[1],e,n);if(u>=0&&(o[0]=Math.min(o[0],e),o[1]=Math.max(o[1],n),a=!0,u/(n-e)>.5))return}a||r.push([e,n]),this.Cues.newCue(this[t],e,n,i)}},{key:"onInitPtsFound",value:function(t){var e=this;void 0===this.initPTS&&(this.initPTS=t.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(t){e.onFragLoaded(t)}),this.unparsedVttFrags=[])}},{key:"getExistingTrack",value:function(t){var e=this.media;if(e)for(var n=0;n<e.textTracks.length;n++){var i=e.textTracks[n],r="textTrack"+t;if(!0===i[r])return i}return null}},{key:"createTextTrack",value:function(t,e,n){var i=this.media;if(i)return i.addTextTrack(t,e,n)}},{key:"destroy",value:function(){g.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(t){this.media=t.media}},{key:"onMediaDetaching",value:function(){o(this.textTrack1),o(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0};var t=this.media;if(t){var e=t.textTracks;if(e)for(var n=0;n<e.length;n++)o(e[n])}}},{key:"onManifestLoaded",value:function(t){var e=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=t.subtitles||[];var n=this.media?this.media.textTracks:[];this.tracks.forEach(function(t,i){var r=void 0;if(i<n.length){var a=n[i];u(a,t)&&(r=a)}r||(r=e.createTextTrack("subtitles",t.name,t.lang)),r.mode=t.default?"showing":"hidden",e.textTracks.push(r)})}}},{key:"onLevelSwitching",value:function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions}},{key:"onFragLoaded",value:function(t){var e=t.frag,n=t.payload;if("main"===e.type){var i=e.sn;i!==this.lastSn+1&&this.cea608Parser.reset(),this.lastSn=i}else if("subtitle"===e.type)if(n.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(t);var r=this.vttCCs;r[e.cc]||(r[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var a=this.textTracks,s=this.hls;_.default.parse(n,this.initPTS,r,e.cc,function(t){t.forEach(function(t){a[e.trackId].addCue(t)}),s.trigger(f.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){v.logger.log("Failed to parse VTT cue: "+t),s.trigger(f.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})}else this.hls.trigger(f.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})}},{key:"onFragParsingUserdata",value:function(t){if(this.enabled&&this.config.enableCEA708Captions)for(var e=0;e<t.samples.length;e++){var n=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,n)}}},{key:"extractCea608Data",value:function(t){for(var e=void 0,n=void 0,i=void 0,r=void 0,a=void 0,s=31&t[0],o=2,u=[],l=0;l<s;l++)e=t[o++],n=127&t[o++],i=127&t[o++],r=0!=(4&e),a=3&e,0===n&&0===i||r&&0===a&&(u.push(n),u.push(i));return u}}]),e}(g.default);n.default=y},{31:31,32:32,46:46,50:50,54:54}],16:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e,n){i(this,t),this.subtle=e,this.aesIV=n}return r(t,[{key:"decrypt",value:function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)}}]),t}();n.default=a},{}],17:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(){i(this,t),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return r(t,[{key:"uint8ArrayToUint32Array_",value:function(t){for(var e=new DataView(t),n=new Uint32Array(4),i=0;i<4;i++)n[i]=e.getUint32(4*i);return n}},{key:"initTable",value:function(){var t=this.sBox,e=this.invSBox,n=this.subMix,i=n[0],r=n[1],a=n[2],s=n[3],o=this.invSubMix,u=o[0],l=o[1],c=o[2],h=o[3],f=new Uint32Array(256),d=0,g=0,m=0;for(m=0;m<256;m++)f[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var p=g^g<<1^g<<2^g<<3^g<<4;p=p>>>8^255&p^99,t[d]=p,e[p]=d;var b=f[d],_=f[b],v=f[_],y=257*f[p]^16843008*p;i[d]=y<<24|y>>>8,r[d]=y<<16|y>>>16,a[d]=y<<8|y>>>24,s[d]=y,y=16843009*v^65537*_^257*b^16843008*d,u[p]=y<<24|y>>>8,l[p]=y<<16|y>>>16,c[p]=y<<8|y>>>24,h[p]=y,d?(d=b^f[f[f[v^b]]],g^=f[f[g]]):d=g=1}}},{key:"expandKey",value:function(t){for(var e=this.uint8ArrayToUint32Array_(t),n=!0,i=0;i<e.length&&n;)n=e[i]===this.key[i],i++;if(!n){this.key=e;var r=this.keySize=e.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);var a=this.ksRows=4*(r+6+1),s=void 0,o=void 0,u=this.keySchedule=new Uint32Array(a),l=this.invKeySchedule=new Uint32Array(a),c=this.sBox,h=this.rcon,f=this.invSubMix,d=f[0],g=f[1],m=f[2],p=f[3],b=void 0,_=void 0;for(s=0;s<a;s++)s<r?b=u[s]=e[s]:(_=b,s%r==0?(_=_<<8|_>>>24,_=c[_>>>24]<<24|c[_>>>16&255]<<16|c[_>>>8&255]<<8|c[255&_],_^=h[s/r|0]<<24):r>6&&s%r==4&&(_=c[_>>>24]<<24|c[_>>>16&255]<<16|c[_>>>8&255]<<8|c[255&_]),u[s]=b=(u[s-r]^_)>>>0);for(o=0;o<a;o++)s=a-o,_=3&o?u[s]:u[s-4],l[o]=o<4||s<=4?_:d[c[_>>>24]]^g[c[_>>>16&255]]^m[c[_>>>8&255]]^p[c[255&_]],l[o]=l[o]>>>0}}},{key:"networkToHostOrderSwap",value:function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24}},{key:"decrypt",value:function(t,e,n){for(var i=void 0,r=void 0,a=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,u=this.invSubMix,l=u[0],c=u[1],h=u[2],f=u[3],d=this.uint8ArrayToUint32Array_(n),g=d[0],m=d[1],p=d[2],b=d[3],_=new Int32Array(t),v=new Int32Array(_.length),y=void 0,E=void 0,T=void 0,x=void 0,S=void 0,w=void 0,M=void 0,C=void 0,R=void 0,O=void 0,A=void 0,j=void 0,I=this.networkToHostOrderSwap;e<_.length;){for(R=I(_[e]),O=I(_[e+1]),A=I(_[e+2]),j=I(_[e+3]),S=R^s[0],w=j^s[1],M=A^s[2],C=O^s[3],i=4,r=1;r<a;r++)y=l[S>>>24]^c[w>>16&255]^h[M>>8&255]^f[255&C]^s[i],E=l[w>>>24]^c[M>>16&255]^h[C>>8&255]^f[255&S]^s[i+1],T=l[M>>>24]^c[C>>16&255]^h[S>>8&255]^f[255&w]^s[i+2],x=l[C>>>24]^c[S>>16&255]^h[w>>8&255]^f[255&M]^s[i+3],S=y,w=E,M=T,C=x,i+=4;y=o[S>>>24]<<24^o[w>>16&255]<<16^o[M>>8&255]<<8^o[255&C]^s[i],E=o[w>>>24]<<24^o[M>>16&255]<<16^o[C>>8&255]<<8^o[255&S]^s[i+1],T=o[M>>>24]<<24^o[C>>16&255]<<16^o[S>>8&255]<<8^o[255&w]^s[i+2],x=o[C>>>24]<<24^o[S>>16&255]<<16^o[w>>8&255]<<8^o[255&M]^s[i+3],i+=3,v[e]=I(y^g),v[e+1]=I(x^m),v[e+2]=I(T^p),v[e+3]=I(E^b),g=R,m=O,p=A,b=j,e+=4}return v.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),t}();n.default=a},{}],18:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=t(16),o=i(s),u=t(19),l=i(u),c=t(17),h=i(c),f=t(30),d=t(50),g=function(){function t(e,n){r(this,t),this.observer=e,this.config=n,this.logEnabled=!0;try{var i=crypto||self.crypto;this.subtle=i.subtle||i.webkitSubtle}catch(t){}this.disableWebCrypto=!this.subtle}return a(t,[{key:"isSync",value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function(t,e,n,i){var r=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(d.logger.log("JS AES decrypt"),this.logEnabled=!1);var a=this.decryptor;a||(this.decryptor=a=new h.default),a.expandKey(e),i(a.decrypt(t,0,n))}else{this.logEnabled&&(d.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var s=this.subtle;this.key!==e&&(this.key=e,this.fastAesKey=new l.default(s,e)),this.fastAesKey.expandKey().then(function(a){new o.default(s,n).decrypt(t,a).catch(function(a){r.onWebCryptoError(a,t,e,n,i)}).then(function(t){i(t)})}).catch(function(a){r.onWebCryptoError(a,t,e,n,i)})}}},{key:"onWebCryptoError",value:function(t,e,n,i,r){this.config.enableSoftwareAES?(d.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,n,i,r)):(d.logger.error("decrypting error : "+t.message),this.observer.trigger(Event.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))}},{key:"destroy",value:function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)}}]),t}();n.default=g},{16:16,17:17,19:19,30:30,50:50}],19:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e,n){i(this,t),this.subtle=e,this.key=n}return r(t,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),t}();n.default=a},{}],20:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=t(21),o=i(s),u=t(50),l=t(26),c=i(l),h=function(){function t(e,n,i){r(this,t),this.observer=e,this.config=i,this.remuxer=n}return a(t,[{key:"resetInitSegment",value:function(t,e,n,i){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(t,e,n,i){var r,a,s,l,h,f,d,g,m,p,b=new c.default(t),_=90*b.timeStamp;for(r=this._aacTrack,f=b.length,m=t.length;f<m-1&&(255!==t[f]||240!=(240&t[f+1]));f++);for(r.samplerate||(a=o.default.getAudioConfig(this.observer,t,f,r.manifestCodec),r.config=a.config,r.samplerate=a.samplerate,r.channelCount=a.channelCount,r.codec=a.codec,u.logger.log("parsed codec:"+r.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount)),h=0,l=9216e4/r.samplerate;f+5<m&&(d=1&t[f+1]?7:9,s=(3&t[f+3])<<11|t[f+4]<<3|(224&t[f+5])>>>5,(s-=d)>0&&f+d+s<=m);)for(g=_+h*l,p={unit:t.subarray(f+d,f+d+s),pts:g,dts:g},r.samples.push(p),r.len+=s,f+=s+d,h++;f<m-1&&(255!==t[f]||240!=(240&t[f+1]));f++);this.remuxer.remux(r,{samples:[]},{samples:[{pts:_,dts:_,unit:b.payload}],inputTimeScale:9e4},{samples:[]},e,n,i)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(t){var e,n,i=new c.default(t);if(i.hasTimeStamp)for(e=i.length,n=t.length;e<n-1;e++)if(255===t[e]&&240==(240&t[e+1]))return!0;return!1}}]),t}();n.default=h},{21:21,26:26,50:50}],21:[function(t,e,n){var i=t(50),r=t(30),a={getAudioConfig:function(t,e,n,a){var s,o,u,l,c,h=navigator.userAgent.toLowerCase(),f=a,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return s=1+((192&e[n+2])>>>6),(o=(60&e[n+2])>>>2)>d.length-1?void t.trigger(Event.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o}):(l=(1&e[n+2])<<2,l|=(192&e[n+3])>>>6,i.logger.log("manifest codec:"+a+",ADTS data:type:"+s+",sampleingIndex:"+o+"["+d[o]+"Hz],channelConfig:"+l),/firefox/i.test(h)?o>=6?(s=5,c=new Array(4),u=o-3):(s=2,c=new Array(2),u=o):-1!==h.indexOf("android")?(s=2,c=new Array(2),u=o):(s=5,c=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&o>=6?u=o-3:((a&&-1!==a.indexOf("mp4a.40.2")&&o>=6&&1===l||!a&&1===l)&&(s=2,c=new Array(2)),u=o)),c[0]=s<<3,c[0]|=(14&o)>>1,c[1]|=(1&o)<<7,c[1]|=l<<3,5===s&&(c[1]|=(14&u)>>1,c[2]=(1&u)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:d[o],channelCount:l,codec:"mp4a.40."+s,manifestCodec:f})}};e.exports=a},{30:30,50:50}],22:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=t(32),o=i(s),u=t(30),l=t(18),c=i(l),h=t(20),f=i(h),d=t(27),g=i(d),m=t(29),p=i(m),b=t(42),_=i(b),v=t(43),y=i(v),E=function(){function t(e,n,i,a){r(this,t),this.observer=e,this.typeSupported=n,this.config=i,this.vendor=a}return a(t,[{key:"destroy",value:function(){var t=this.demuxer;t&&t.destroy()}},{key:"push",value:function(t,e,n,i,r,a,s,u,l,h,f,d){if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){var g=this.decrypter;null==g&&(g=this.decrypter=new c.default(this.observer,this.config));var m,p=this;try{m=performance.now()}catch(t){m=Date.now()}g.decrypt(t,e.key.buffer,e.iv.buffer,function(t){var c;try{c=performance.now()}catch(t){c=Date.now()}p.observer.trigger(o.default.FRAG_DECRYPTED,{stats:{tstart:m,tdecrypt:c}}),p.pushDecrypted(new Uint8Array(t),e,new Uint8Array(n),i,r,a,s,u,l,h,f,d)})}else this.pushDecrypted(new Uint8Array(t),e,new Uint8Array(n),i,r,a,s,u,l,h,f,d)}},{key:"pushDecrypted",value:function(t,e,n,i,r,a,s,l,c,h,d,m){var b=this.demuxer;if(!b||s&&!this.probe(t)){var v=this.observer,E=this.typeSupported,T=this.config,x=[{demux:p.default,remux:_.default},{demux:f.default,remux:_.default},{demux:g.default,remux:y.default}];for(var S in x){var w=x[S],M=w.demux.probe;if(M(t)){var C=this.remuxer=new w.remux(v,T,E,this.vendor);b=new w.demux(v,C,T,E),this.probe=M;break}}if(!b)return void v.trigger(o.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=b}var R=this.remuxer;(s||l)&&(b.resetInitSegment(n,i,r,h),R.resetInitSegment()),s&&(b.resetTimeStamp(),R.resetTimeStamp(m)),"function"==typeof b.setDecryptData&&b.setDecryptData(e),b.append(t,a,c,d)}}]),t}();n.default=E},{18:18,20:20,27:27,29:29,30:30,32:32,42:42,43:43}],23:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(22),a=i(r),s=t(32),o=i(s),u=t(50),l=t(1),c=i(l),h=function(t){var e=new c.default;e.trigger=function(t){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.emit.apply(e,[t,t].concat(i))},e.off=function(t){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.removeListener.apply(e,[t].concat(i))};var n=function(e,n){t.postMessage({event:e,data:n})};t.addEventListener("message",function(i){var r=i.data;switch(r.cmd){case"init":var s=JSON.parse(r.config);t.demuxer=new a.default(e,r.typeSupported,s,r.vendor);try{(0,u.enableLogs)(!0===s.debug)}catch(t){}n("init",null);break;case"demux":t.demuxer.push(r.data,r.decryptdata,r.initSegment,r.audioCodec,r.videoCodec,r.timeOffset,r.discontinuity,r.trackSwitch,r.contiguous,r.duration,r.accurateTimeOffset,r.defaultInitPTS)}}),e.on(o.default.FRAG_DECRYPTED,n),e.on(o.default.FRAG_PARSING_INIT_SEGMENT,n),e.on(o.default.FRAG_PARSED,n),e.on(o.default.ERROR,n),e.on(o.default.FRAG_PARSING_METADATA,n),e.on(o.default.FRAG_PARSING_USERDATA,n),e.on(o.default.INIT_PTS_FOUND,n),e.on(o.default.FRAG_PARSING_DATA,function(e,n){var i=[],r={event:e,data:n};n.data1&&(r.data1=n.data1.buffer,i.push(n.data1.buffer),delete n.data1),n.data2&&(r.data2=n.data2.buffer,i.push(n.data2.buffer),delete n.data2),t.postMessage(r,i)})};n.default=h},{1:1,22:22,32:32,50:50}],24:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=t(32),o=i(s),u=t(22),l=i(u),c=t(23),h=i(c),f=t(50),d=t(30),g=t(1),m=i(g),p=function(){function e(n,i){r(this,e),this.hls=n,this.id=i;var a=this.observer=new m.default,s=n.config;a.trigger=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];a.emit.apply(a,[t,t].concat(n))},a.off=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];a.removeListener.apply(a,[t].concat(n))};var u=function(t,e){e=e||{},e.frag=this.frag,e.id=this.id,n.trigger(t,e)}.bind(this);a.on(o.default.FRAG_DECRYPTED,u),a.on(o.default.FRAG_PARSING_INIT_SEGMENT,u),a.on(o.default.FRAG_PARSING_DATA,u),a.on(o.default.FRAG_PARSED,u),a.on(o.default.ERROR,u),a.on(o.default.FRAG_PARSING_METADATA,u),a.on(o.default.FRAG_PARSING_USERDATA,u),a.on(o.default.INIT_PTS_FOUND,u);var c={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},g=navigator.vendor;if(s.enableWorker&&"undefined"!=typeof Worker){f.logger.log("demuxing in webworker");var p=void 0;try{var b=t(3);p=this.w=b(h.default),this.onwmsg=this.onWorkerMessage.bind(this),p.addEventListener("message",this.onwmsg),p.onerror=function(t){n.trigger(o.default.ERROR,{type:d.ErrorTypes.OTHER_ERROR,details:d.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},p.postMessage({cmd:"init",typeSupported:c,vendor:g,id:i,config:JSON.stringify(s)})}catch(t){f.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),p&&URL.revokeObjectURL(p.objectURL),this.demuxer=new l.default(a,c,s,g),this.w=void 0}}else this.demuxer=new l.default(a,c,s,g)}return a(e,[{key:"destroy",value:function(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var n=this.observer;n&&(n.removeAllListeners(),this.observer=null)}},{key:"push",value:function(t,e,n,i,r,a,s,o){var u=this.w,l=isNaN(r.startDTS)?r.start:r.startDTS,c=r.decryptdata,h=this.frag,d=!(h&&r.cc===h.cc),g=!(h&&r.level===h.level),m=h&&r.sn===h.sn+1,p=!g&&m;if(d&&f.logger.log(this.id+":discontinuity detected"),g&&f.logger.log(this.id+":switch detected"),this.frag=r,u)u.postMessage({cmd:"demux",data:t,decryptdata:c,initSegment:e,audioCodec:n,videoCodec:i,timeOffset:l,discontinuity:d,trackSwitch:g,contiguous:p,duration:a,accurateTimeOffset:s,defaultInitPTS:o},[t]);else{var b=this.demuxer;b&&b.push(t,c,e,n,i,l,d,g,p,a,s,o)}}},{key:"onWorkerMessage",value:function(t){var e=t.data,n=this.hls;switch(e.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case o.default.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,n.trigger(e.event,e.data)}}}]),e}();n.default=p},{1:1,22:22,23:23,3:3,30:30,32:32,50:50}],25:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t(50),s=function(){function t(e){i(this,t),this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return r(t,[{key:"loadWord",value:function(){var t=this.data,e=this.bytesAvailable,n=t.byteLength-e,i=new Uint8Array(4),r=Math.min(4,e);if(0===r)throw new Error("no bytes available");i.set(t.subarray(n,n+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}},{key:"skipBits",value:function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}},{key:"readBits",value:function(t){var e=Math.min(this.bitsAvailable,t),n=this.word>>>32-e;return t>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),e=t-e,e>0&&this.bitsAvailable?n<<e|this.readBits(e):n}},{key:"skipLZ",value:function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var t=this.skipLZ();return this.readBits(t+1)-1}},{key:"readEG",value:function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(t){var e,n,i=8,r=8;for(e=0;e<t;e++)0!==r&&(n=this.readEG(),r=(i+n+256)%256),i=0===r?i:r}},{key:"readSPS",value:function(){var t,e,n,i,r,a,s,o=0,u=0,l=0,c=0,h=this.readUByte.bind(this),f=this.readBits.bind(this),d=this.readUEG.bind(this),g=this.readBoolean.bind(this),m=this.skipBits.bind(this),p=this.skipEG.bind(this),b=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);if(h(),t=h(),f(5),m(3),h(),b(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var v=d();if(3===v&&m(1),b(),b(),m(1),g())for(a=3!==v?8:12,s=0;s<a;s++)g()&&_(s<6?16:64)}b();var y=d();if(0===y)d();else if(1===y)for(m(1),p(),p(),e=d(),s=0;s<e;s++)p();b(),m(1),n=d(),i=d(),r=f(1),0===r&&m(1),m(1),g()&&(o=d(),u=d(),l=d(),c=d());var E=[1,1];if(g()&&g())switch(h()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[h()<<8|h(),h()<<8|h()]}return{width:Math.ceil(16*(n+1)-2*o-2*u),height:(2-r)*(i+1)*16-(r?2:4)*(l+c),pixelRatio:E}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),t}();n.default=s},{50:50}],26:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}
return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t(50),s=function(){function t(e){i(this,t),this._hasTimeStamp=!1;for(var n=void 0,r=void 0,s=void 0,o=void 0,u=void 0,l=void 0,c=void 0,h=void 0,f=0;;)if(c=this.readUTF(e,f,3),f+=3,"ID3"===c)f+=3,n=127&e[f++],r=127&e[f++],s=127&e[f++],o=127&e[f++],u=(n<<21)+(r<<14)+(s<<7)+o,l=f+u,this._parseID3Frames(e,f,l),f=l;else{if("3DI"!==c)return f-=3,void((h=f)&&(this.hasTimeStamp||a.logger.warn("ID3 tag found, but no timestamp"),this._length=h,this._payload=e.subarray(0,h)));f+=7,a.logger.log("3DI footer found, end: "+f)}}return r(t,[{key:"readUTF",value:function(t,e,n){var i="",r=e,a=e+n;do{i+=String.fromCharCode(t[r++])}while(r<a);return i}},{key:"_parseID3Frames",value:function(t,e,n){for(var i=void 0,r=void 0;e+8<=n;)switch(i=this.readUTF(t,e,4),e+=4,t[e++],t[e++],t[e++],t[e++],t[e++],t[e++],i){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(t,e,44)){e+=44,e+=4;var s=1&t[e++];this._hasTimeStamp=!0,r=((t[e++]<<23)+(t[e++]<<15)+(t[e++]<<7)+t[e++])/45,s&&(r+=47721858.84),r=Math.round(r),a.logger.trace("ID3 timestamp found: "+r),this._timeStamp=r}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),t}();n.default=s},{50:50}],27:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t(32),s=function(t){return t&&t.__esModule?t:{default:t}}(a),o=function(){function t(e,n){i(this,t),this.observer=e,this.remuxer=n}return r(t,[{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(e,n,i,r){var a=this.initData=t.parseInitSegment(e),o={};a.audio&&(o.audio={container:"audio/mp4",codec:n,initSegment:e}),a.video&&(o.video={container:"video/mp4",codec:i,initSegment:e}),this.observer.trigger(s.default.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}},{key:"append",value:function(e,n,i,r){var a=this.initData,s=t.startDTS(a,e);this.remuxer.remux(a.audio,a.video,null,null,s,i,r,e)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){if(e.length>=8){return["moof","ftyp","styp"].indexOf(t.bin2str(e.subarray(4,8)))>=0}return!1}},{key:"bin2str",value:function(t){return String.fromCharCode.apply(null,t)}},{key:"findBox",value:function(e,n){var i,r,a,s,o,u=[];if(!n.length)return null;for(i=0;i<e.byteLength;)r=e[i]<<24,r|=e[i+1]<<16,r|=e[i+2]<<8,r|=e[i+3],a=t.bin2str(e.subarray(i+4,i+8)),s=r>1?i+r:e.byteLength,a===n[0]&&(1===n.length?u.push(e.subarray(i+8,s)):(o=t.findBox(e.subarray(i+8,s),n.slice(1)),o.length&&(u=u.concat(o)))),i=s;return u}},{key:"parseInitSegment",value:function(e){var n=[];return t.findBox(e,["moov","trak"]).forEach(function(e){var i=t.findBox(e,["tkhd"])[0];if(i){var r=i[0],a=0===r?12:20,s=i[a]<<24|i[a+1]<<16|i[a+2]<<8|i[a+3];s=s<0?4294967296+s:s;var o=t.findBox(e,["mdia","mdhd"])[0];if(o){r=o[0],a=0===r?12:20;var u=o[a]<<24|o[a+1]<<16|o[a+2]<<8|o[a+3],l=t.findBox(e,["mdia","hdlr"])[0];if(l){var c=t.bin2str(l.subarray(8,12)),h={soun:"audio",vide:"video"}[c];h&&(n[s]={timescale:u,type:h},n[h]={timescale:u,id:s})}}}}),n}},{key:"startDTS",value:function(e,n){var i,r,a;return i=t.findBox(n,["moof","traf"]),r=[].concat.apply([],i.map(function(n){return t.findBox(n,["tfhd"]).map(function(i){var r,a,s;return r=i[4]<<24|i[5]<<16|i[6]<<8|i[7],a=e[r].timescale||9e4,s=t.findBox(n,["tfdt"]).map(function(t){var e,n;return e=t[0],n=t[4]<<24|t[5]<<16|t[6]<<8|t[7],1===e&&(n*=Math.pow(2,32),n+=t[8]<<24|t[9]<<16|t[10]<<8|t[11]),n})[0],(s=s||1/0)/a})})),a=Math.min.apply(null,r),isFinite(a)?a:0}}]),t}();n.default=o},{32:32}],28:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t(18),s=function(t){return t&&t.__esModule?t:{default:t}}(a),o=function(){function t(e,n,r,a){i(this,t),this.decryptdata=r,this.discardEPB=a,this.decrypter=new s.default(e,n)}return r(t,[{key:"decryptBuffer",value:function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)}},{key:"decryptAacSample",value:function(t,e,n,i){var r=t[e].unit,a=r.subarray(16,r.length-r.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(s,function(a){a=new Uint8Array(a),r.set(a,16),i||o.decryptAacSamples(t,e+1,n)})}},{key:"decryptAacSamples",value:function(t,e,n){for(;;e++){if(e>=t.length)return void n();if(!(t[e].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(t,e,n,i),!i)return}}}},{key:"getAvcEncryptedData",value:function(t){for(var e=16*Math.floor((t.length-48)/160)+16,n=new Int8Array(e),i=0,r=32;r<=t.length-16;r+=160,i+=16)n.set(t.subarray(r,r+16),i);return n}},{key:"getAvcDecryptedUnit",value:function(t,e){e=new Uint8Array(e);for(var n=0,i=32;i<=t.length-16;i+=160,n+=16)t.set(e.subarray(n,n+16),i);return t}},{key:"decryptAvcSample",value:function(t,e,n,i,r,a){var s=this.discardEPB(r.data),o=this.getAvcEncryptedData(s),u=this;this.decryptBuffer(o.buffer,function(o){r.data=u.getAvcDecryptedUnit(s,o),a||u.decryptAvcSamples(t,e,n+1,i)})}},{key:"decryptAvcSamples",value:function(t,e,n,i){for(;;e++,n=0){if(e>=t.length)return void i();for(var r=t[e].units;!(n>=r.length);n++){var a=r[n];if(!(a.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(t,e,n,i,a,s),!s)return}}}}}]),t}();n.default=o},{18:18}],29:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=t(21),o=i(s),u=t(32),l=i(u),c=t(25),h=i(c),f=t(28),d=i(f),g=t(50),m=t(30),p=function(){function t(e,n,i,a){r(this,t),this.observer=e,this.config=i,this.typeSupported=a,this.remuxer=n,this.sampleAes=null}return a(t,[{key:"setDecryptData",value:function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new d.default(this.observer,this.config,t,this.discardEPB):this.sampleAes=null}},{key:"resetInitSegment",value:function(t,e,n,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=e,this.videoCodec=n,this._duration=i}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(t,e,n,i){var r,a,s,o,u,c=t.length,h=!1;this.contiguous=n;var f=this.pmtParsed,d=this._avcTrack,p=this._audioTrack,b=this._id3Track,_=d.id,v=p.id,y=b.id,E=this._pmtId,T=d.pesData,x=p.pesData,S=b.pesData,w=this._parsePAT,M=this._parsePMT,C=this._parsePES,R=this._parseAVCPES.bind(this),O=this._parseAACPES.bind(this),A=this._parseMPEGPES.bind(this),j=this._parseID3PES.bind(this);for(c-=c%188,r=0;r<c;r+=188)if(71===t[r]){if(a=!!(64&t[r+1]),s=((31&t[r+1])<<8)+t[r+2],(48&t[r+3])>>4>1){if((o=r+5+t[r+4])===r+188)continue}else o=r+4;switch(s){case _:a&&(T&&(u=C(T))&&R(u,!1),T={data:[],size:0}),T&&(T.data.push(t.subarray(o,r+188)),T.size+=r+188-o);break;case v:a&&(x&&(u=C(x))&&(p.isAAC?O(u):A(u)),x={data:[],size:0}),x&&(x.data.push(t.subarray(o,r+188)),x.size+=r+188-o);break;case y:a&&(S&&(u=C(S))&&j(u),S={data:[],size:0}),S&&(S.data.push(t.subarray(o,r+188)),S.size+=r+188-o);break;case 0:a&&(o+=t[o]+1),E=this._pmtId=w(t,o);break;case E:a&&(o+=t[o]+1);var I=M(t,o,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);_=I.avc,_>0&&(d.id=_),v=I.audio,v>0&&(p.id=v,p.isAAC=I.isAAC),y=I.id3,y>0&&(b.id=y),h&&!f&&(g.logger.log("reparse from beginning"),h=!1,r=-188),f=this.pmtParsed=!0;break;case 17:case 8191:break;default:h=!0}}else this.observer.trigger(l.default.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});T&&(u=C(T))?(R(u,!0),d.pesData=null):d.pesData=T,x&&(u=C(x))?(p.isAAC?O(u):A(u),p.pesData=null):(x&&x.size&&g.logger.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=x),S&&(u=C(S))?(j(u),b.pesData=null):b.pesData=S,null==this.sampleAes?this.remuxer.remux(p,d,b,this._txtTrack,e,n,i):this.decryptAndRemux(p,d,b,this._txtTrack,e,n,i)}},{key:"decryptAndRemux",value:function(t,e,n,i,r,a,s){if(t.samples&&t.isAAC){var o=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){o.decryptAndRemuxAvc(t,e,n,i,r,a,s)})}else this.decryptAndRemuxAvc(t,e,n,i,r,a,s)}},{key:"decryptAndRemuxAvc",value:function(t,e,n,i,r,a,s){if(e.samples){var o=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,function(){o.remuxer.remux(t,e,n,i,r,a,s)})}else this.remuxer.remux(t,e,n,i,r,a,s)}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(t,e){return(31&t[e+10])<<8|t[e+11]}},{key:"_parsePMT",value:function(t,e,n,i){var r,a,s,o,u={audio:-1,avc:-1,id3:-1,isAAC:!0};for(r=(15&t[e+1])<<8|t[e+2],a=e+3+r-4,s=(15&t[e+10])<<8|t[e+11],e+=12+s;e<a;){switch(o=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!i){g.logger.log("unkown stream type:"+t[e]);break}case 15:-1===u.audio&&(u.audio=o);break;case 21:-1===u.id3&&(u.id3=o);break;case 219:if(!i){g.logger.log("unkown stream type:"+t[e]);break}case 27:-1===u.avc&&(u.avc=o);break;case 3:case 4:n?-1===u.audio&&(u.audio=o,u.isAAC=!1):g.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:g.logger.warn("HEVC stream type found, not supported for now");break;default:g.logger.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return u}},{key:"_parsePES",value:function(t){var e,n,i,r,a,s,o,u,l=0,c=t.data;if(!t||0===t.size)return null;for(;c[0].length<19&&c.length>1;){var h=new Uint8Array(c[0].length+c[1].length);h.set(c[0]),h.set(c[1],c[0].length),c[0]=h,c.splice(1,1)}if(e=c[0],1===(e[0]<<16)+(e[1]<<8)+e[2]){if((i=(e[4]<<8)+e[5])&&i>t.size-6)return null;n=e[7],192&n&&(s=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,s>4294967295&&(s-=8589934592),64&n?(o=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2,o>4294967295&&(o-=8589934592),s-o>54e5&&(g.logger.warn(Math.round((s-o)/9e4)+"s delta between PTS and DTS, align them"),s=o)):o=s),r=e[8],u=r+9,t.size-=u,a=new Uint8Array(t.size);for(var f=0,d=c.length;f<d;f++){e=c[f];var m=e.byteLength;if(u){if(u>m){u-=m;continue}e=e.subarray(u),m-=u,u=0}a.set(e,l),l+=m}return i&&(i-=r+3),{data:a,pts:s,dts:o,len:i}}return null}},{key:"pushAccesUnit",value:function(t,e){if(t.units.length&&t.frame){var n=e.samples,i=n.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(i||this.contiguous)?(t.id=i,n.push(t)):e.dropped++}t.debug.length&&g.logger.log(t.pts+"/"+t.dts+":"+t.debug)}},{key:"_parseAVCPES",value:function(t,e){var n,i,r,a=this,s=this._avcTrack,o=this._parseAVCNALu(t.data),u=this.avcSample;t.data=null,o.forEach(function(e){switch(e.type){case 1:i=!0,u.frame=!0;var o=e.data;if(o.length>4){var l=new h.default(o).readSliceType();2!==l&&4!==l&&7!==l&&9!==l||(u.key=!0)}break;case 5:i=!0,u||(u=a.avcSample=a._createAVCSample(!0,t.pts,t.dts,"")),u.key=!0,u.frame=!0;break;case 6:i=!0,n=new h.default(a.discardEPB(e.data)),n.readUByte();for(var c=0,f=0,d=!1,g=0;!d&&n.bytesAvailable>1;){c=0;do{g=n.readUByte(),c+=g}while(255===g);f=0;do{g=n.readUByte(),f+=g}while(255===g);if(4===c&&0!==n.bytesAvailable){if(d=!0,181===n.readUByte()&&49===n.readUShort()&&1195456820===n.readUInt()&&3===n.readUByte()){var m=n.readUByte(),p=n.readUByte(),b=31&m,_=[m,p];for(r=0;r<b;r++)_.push(n.readUByte()),_.push(n.readUByte()),_.push(n.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:t.pts,bytes:_})}}else if(f<n.bytesAvailable)for(r=0;r<f;r++)n.readUByte()}break;case 7:if(i=!0,!s.sps){n=new h.default(e.data);var v=n.readSPS();s.width=v.width,s.height=v.height,s.pixelRatio=v.pixelRatio,s.sps=[e.data],s.duration=a._duration;var y=e.data.subarray(1,4),E="avc1.";for(r=0;r<3;r++){var T=y[r].toString(16);T.length<2&&(T="0"+T),E+=T}s.codec=E}break;case 8:i=!0,s.pps||(s.pps=[e.data]);break;case 9:i=!1,u&&a.pushAccesUnit(u,s),u=a.avcSample=a._createAVCSample(!1,t.pts,t.dts,"");break;case 12:i=!1;break;default:i=!1,u&&(u.debug+="unknown NAL "+e.type+" ")}u&&i&&u.units.push(e)}),e&&u&&(this.pushAccesUnit(u,s),this.avcSample=null)}},{key:"_createAVCSample",value:function(t,e,n,i){return{key:t,pts:e,dts:n,units:[],debug:i}}},{key:"_insertSampleInOrder",value:function(t,e){var n=t.length;if(n>0){if(e.pts>=t[n-1].pts)t.push(e);else for(var i=n-1;i>=0;i--)if(e.pts<t[i].pts){t.splice(i,0,e);break}}else t.push(e)}},{key:"_getLastNalUnit",value:function(){var t=this.avcSample,e=void 0;if(!t||0===t.units.length){var n=this._avcTrack,i=n.samples;t=i[i.length-1]}if(t){var r=t.units;e=r[r.length-1]}return e}},{key:"_parseAVCNALu",value:function(t){var e,n,i,r,a,s=0,o=t.byteLength,u=this._avcTrack,l=u.naluState||0,c=l,h=[],f=-1;for(-1===l&&(f=0,a=31&t[0],l=0,s=1);s<o;)if(e=t[s++],l)if(1!==l)if(e)if(1===e){if(f>=0)i={data:t.subarray(f,s-l-1),type:a},h.push(i);else{var d=this._getLastNalUnit();if(d&&(c&&s<=4-c&&d.state&&(d.data=d.data.subarray(0,d.data.byteLength-c)),(n=s-l-1)>0)){var g=new Uint8Array(d.data.byteLength+n);g.set(d.data,0),g.set(t.subarray(0,n),d.data.byteLength),d.data=g}}s<o?(r=31&t[s],f=s,a=r,l=0):l=-1}else l=0;else l=3;else l=e?0:2;else l=e?0:1;if(f>=0&&l>=0&&(i={data:t.subarray(f,o),type:a,state:l},h.push(i)),0===h.length){var m=this._getLastNalUnit();if(m){var p=new Uint8Array(m.data.byteLength+t.byteLength);p.set(m.data,0),p.set(t,m.data.byteLength),m.data=p}}return u.naluState=l,h}},{key:"discardEPB",value:function(t){for(var e=void 0,n=void 0,i=t.byteLength,r=[],a=1;a<i-2;)0===t[a]&&0===t[a+1]&&3===t[a+2]?(r.push(a+2),a+=2):a++;if(0===r.length)return t;e=i-r.length,n=new Uint8Array(e);var s=0;for(a=0;a<e;s++,a++)s===r[0]&&(s++,r.shift()),n[a]=t[s];return n}},{key:"_parseAACPES",value:function(t){var e,n,i,r,a,s,u,c,h,f=this._audioTrack,d=t.data,p=t.pts,b=this.aacOverFlow,_=this.aacLastPTS;if(b){var v=new Uint8Array(b.byteLength+d.byteLength);v.set(b,0),v.set(d,b.byteLength),d=v}for(a=0,c=d.length;a<c-1&&(255!==d[a]||240!=(240&d[a+1]));a++);if(a){var y,E;if(a<c-1?(y="AAC PES did not start with ADTS header,offset:"+a,E=!1):(y="no ADTS header found in AAC PES",E=!0),g.logger.warn("parsing error:"+y),this.observer.trigger(l.default.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:E,reason:y}),E)return}if(!f.samplerate){var T=this.audioCodec;e=o.default.getAudioConfig(this.observer,d,a,T),f.config=e.config,f.samplerate=e.samplerate,f.channelCount=e.channelCount,f.codec=e.codec,f.manifestCodec=e.manifestCodec,f.duration=this._duration,g.logger.log("parsed codec:"+f.codec+",rate:"+e.samplerate+",nb channel:"+e.channelCount)}if(r=0,i=9216e4/f.samplerate,b&&_){var x=_+i;Math.abs(x-p)>1&&(g.logger.log("AAC: align PTS for overlapping frames by "+Math.round((x-p)/90)),p=x)}for(;a+5<c&&(s=1&d[a+1]?7:9,n=(3&d[a+3])<<11|d[a+4]<<3|(224&d[a+5])>>>5,(n-=s)>0&&a+s+n<=c);)for(u=p+r*i,h={unit:d.subarray(a+s,a+s+n),pts:u,dts:u},f.samples.push(h),f.len+=n,a+=n+s,r++;a<c-1&&(255!==d[a]||240!=(240&d[a+1]));a++);b=a<c?d.subarray(a,c):null,this.aacOverFlow=b,this.aacLastPTS=u}},{key:"_parseMPEGPES",value:function(t){for(var e=void 0,n=t.data,i=t.pts,r=n.length,a=0,s=0;s<r&&(e=this._parseMpeg(n,s,r,a++,i))>0;)s+=e}},{key:"_onMpegFrame",value:function(t,e,n,i,r,a){var s=1152/n*1e3,o=a+r*s,u=this._audioTrack;u.config=[],u.channelCount=i,u.samplerate=n,u.duration=this._duration,u.samples.push({unit:t,pts:o,dts:o}),u.len+=t.length}},{key:"_onMpegNoise",value:function(t){g.logger.warn("mpeg audio has noise: "+t.length+" bytes")}},{key:"_parseMpeg",value:function(t,e,n,i,r){var a=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],s=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(e+2>n)return-1;if(255===t[e]||224==(224&t[e+1])){if(e+24>n)return-1;var o=t[e+1]>>3&3,u=t[e+1]>>1&3,l=t[e+2]>>4&15,c=t[e+2]>>2&3,h=!!(2&t[e+2]);if(1!==o&&0!==l&&15!==l&&3!==c){var f=3===o?3-u:3===u?3:4,d=1e3*a[14*f+l-1],g=3===o?0:2===o?1:2,m=s[3*g+c],p=h?1:0,b=t[e+3]>>6==3?1:2,_=3===u?(3===o?12:6)*d/m+p<<2:(3===o?144:72)*d/m+p|0;return e+_>n?-1:(this._onMpegFrame&&this._onMpegFrame(t.subarray(e,e+_),d,m,b,i,r),_)}}for(var v=e+2;v<n;){if(255===t[v-1]&&224==(224&t[v]))return this._onMpegNoise&&this._onMpegNoise(t.subarray(e,v-1)),v-e-1;v++}return-1}},{key:"_parseID3PES",value:function(t){this._id3Track.samples.push(t)}}],[{key:"probe",value:function(t){return t.length>=564&&71===t[0]&&71===t[188]&&71===t[376]}}]),t}();n.default=p},{21:21,25:25,28:28,30:30,32:32,50:50}],30:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},n.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException"}},{}],31:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==$traceurRuntime.typeof(Symbol.iterator)?function(t){return void 0===t?"undefined":$traceurRuntime.typeof(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":$traceurRuntime.typeof(t)},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=t(50),o=t(30),u=t(32),l=function(t){return t&&t.__esModule?t:{default:t}}(u),c=function(){function t(e){i(this,t),this.hls=e,this.onEvent=this.onEvent.bind(this);for(var n=arguments.length,r=Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}return a(t,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===r(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if("hlsEventGeneric"===t)throw new Error("Forbidden event name: "+t);this.hls.on(t,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(t,e){this.onEventGeneric(t,e)}},{key:"onEventGeneric",value:function(t,e){var n=function(t,e){var n="on"+t.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,e)};try{n.call(this,t,e).call()}catch(e){s.logger.error("internal error happened while processing "+t+":"+e.message),this.hls.trigger(l.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}}}]),t}();n.default=c},{30:30,32:32,50:50}],32:[function(t,e,n){e.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],33:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(){i(this,t)}return r(t,null,[{key:"getSilentFrame",value:function(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),t}();n.default=a},{}],34:[function(t,e,n){var i={isBuffered:function(t,e){if(t)for(var n=t.buffered,i=0;i<n.length;i++)if(e>=n.start(i)&&e<=n.end(i))return!0;return!1},bufferInfo:function(t,e,n){if(t){var i,r=t.buffered,a=[];for(i=0;i<r.length;i++)a.push({start:r.start(i),end:r.end(i)});return this.bufferedInfo(a,e,n)}return{len:0,start:e,end:e,nextStart:void 0}},bufferedInfo:function(t,e,n){var i,r,a,s,o,u=[];for(t.sort(function(t,e){var n=t.start-e.start;return n||e.end-t.end}),o=0;o<t.length;o++){var l=u.length;if(l){var c=u[l-1].end;t[o].start-c<n?t[o].end>c&&(u[l-1].end=t[o].end):u.push(t[o])}else u.push(t[o])}for(o=0,i=0,r=a=e;o<u.length;o++){var h=u[o].start,f=u[o].end;if(e+n>=h&&e<f)r=h,a=f,i=a-e;else if(e+n<h){s=h;break}}return{len:i,start:r,end:a,nextStart:s}}};e.exports=i},{}],35:[function(t,e,n){var i=t(50),r={mergeDetails:function(t,e){var n,a=Math.max(t.startSN,e.startSN)-e.startSN,s=Math.min(t.endSN,e.endSN)-e.startSN,o=e.startSN-t.startSN,u=t.fragments,l=e.fragments,c=0;if(s<a)return void(e.PTSKnown=!1);for(var h=a;h<=s;h++){var f=u[o+h],d=l[h];d&&f&&(c=f.cc-d.cc,isNaN(f.startPTS)||(d.start=d.startPTS=f.startPTS,d.endPTS=f.endPTS,d.duration=f.duration,n=d))}if(c)for(i.logger.log("discontinuity sliding from playlist, take drift into account"),h=0;h<l.length;h++)l[h].cc+=c;if(n)r.updateFragPTSDTS(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS);else if(o>=0&&o<u.length){var g=u[o].start;for(h=0;h<l.length;h++)l[h].start+=g}e.PTSKnown=t.PTSKnown},updateFragPTSDTS:function(t,e,n,i,a,s){if(!isNaN(e.startPTS)){var o=Math.abs(e.startPTS-n);isNaN(e.deltaPTS)?e.deltaPTS=o:e.deltaPTS=Math.max(o,e.deltaPTS),n=Math.min(n,e.startPTS),i=Math.max(i,e.endPTS),a=Math.min(a,e.startDTS),s=Math.max(s,e.endDTS)}var u=n-e.start;e.start=e.startPTS=n,e.endPTS=i,e.startDTS=a,e.endDTS=s,e.duration=i-n;var l=e.sn;if(!t||l<t.startSN||l>t.endSN)return 0;var c,h,f;for(c=l-t.startSN,h=t.fragments,e=h[c],f=c;f>0;f--)r.updatePTS(h,f,f-1);for(f=c;f<h.length-1;f++)r.updatePTS(h,f,f+1);return t.PTSKnown=!0,u},updatePTS:function(t,e,n){var r=t[e],a=t[n],s=a.startPTS;isNaN(s)?a.start=n>e?r.start+r.duration:Math.max(r.start-a.duration,0):n>e?(r.duration=s-r.start,r.duration<0&&i.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(a.duration=r.start-s,a.duration<0&&i.logger.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!"))}};e.exports=r},{50:50}],36:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=t(2),o=i(s),u=t(32),l=i(u),c=t(30),h=t(40),f=i(h),d=t(38),g=i(d),m=t(39),p=i(m),b=t(12),_=i(b),v=t(11),y=i(v),E=t(50),T=t(1),x=i(T),S=t(4),w=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,t);var i=t.DefaultConfig;if((n.liveSyncDurationCount||n.liveMaxLatencyDurationCount)&&(n.liveSyncDuration||n.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var a in i)a in n||(n[a]=i[a]);if(void 0!==n.liveMaxLatencyDurationCount&&n.liveMaxLatencyDurationCount<=n.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==n.liveMaxLatencyDuration&&(n.liveMaxLatencyDuration<=n.liveSyncDuration||void 0===n.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,E.enableLogs)(n.debug),this.config=n,this._autoLevelCapping=-1;var s=this.observer=new x.default;s.trigger=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];s.emit.apply(s,[t,t].concat(n))},s.off=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];s.removeListener.apply(s,[t].concat(n))},this.on=s.on.bind(s),this.off=s.off.bind(s),this.trigger=s.trigger.bind(s);var o=this.abrController=new n.abrController(this),u=new n.bufferController(this),l=new n.capLevelController(this),c=new n.fpsController(this),h=new f.default(this),d=new g.default(this),m=new p.default(this),b=this.levelController=new y.default(this),v=this.streamController=new _.default(this),T=[b,v],S=n.audioStreamController;S&&T.push(new S(this)),this.networkControllers=T;var w=[h,d,m,o,u,l,c];if(S=n.audioTrackController){var M=new S(this);this.audioTrackController=M,w.push(M)}if(S=n.subtitleTrackController){var C=new S(this);this.subtitleTrackController=C,w.push(C)}[n.subtitleStreamController,n.timelineController].forEach(function(t){t&&w.push(new t(e))}),this.coreComponents=w}return a(t,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.7.5"}},{key:"Events",get:function(){return l.default}},{key:"ErrorTypes",get:function(){return c.ErrorTypes}},{key:"ErrorDetails",get:function(){return c.ErrorDetails}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:S.hlsDefaultConfig},set:function(e){t.defaultConfig=e}}]),a(t,[{key:"destroy",value:function(){E.logger.log("destroy"),this.trigger(l.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function(t){E.logger.log("attachMedia"),this.media=t,this.trigger(l.default.MEDIA_ATTACHING,{media:t})}},{key:"detachMedia",value:function(){E.logger.log("detachMedia"),this.trigger(l.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(t){t=o.default.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),E.logger.log("loadSource:"+t),this.url=t,this.trigger(l.default.MANIFEST_LOADING,{url:t})}},{key:"startLoad",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;E.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})}},{key:"stopLoad",value:function(){E.logger.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})}},{key:"swapAudioCodec",
value:function(){E.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){E.logger.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){E.logger.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){E.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){E.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){E.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){E.logger.log("set startLevel:"+t);var e=this;-1!==t&&(t=Math.max(t,e.minAutoLevel)),e.levelController.startLevel=t}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){E.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var t=this,e=t.levels,n=t.config.minAutoBitrate,i=e?e.length:0,r=0;r<i;r++)if((e[r].realBitrate?Math.max(e[r].realBitrate,e[r].bitrate):e[r].bitrate)>n)return r;return 0}},{key:"maxAutoLevel",get:function(){var t=this,e=t.levels,n=t.autoLevelCapping;return-1===n&&e&&e.length?e.length-1:n}},{key:"nextAutoLevel",get:function(){var t=this;return Math.min(Math.max(t.abrController.nextAutoLevel,t.minAutoLevel),t.maxAutoLevel)},set:function(t){var e=this;e.abrController.nextAutoLevel=Math.max(e.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}}]),t}();n.default=w},{1:1,11:11,12:12,2:2,30:30,32:32,38:38,39:39,4:4,40:40,50:50}],37:[function(t,e,n){e.exports=t(36).default},{36:36}],38:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(32),l=i(u),c=t(31),h=i(c),f=t(30),d=t(50),g=function(t){function e(t){r(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l.default.FRAG_LOADING));return n.loaders={},n}return s(e,t),o(e,[{key:"destroy",value:function(){var t=this.loaders;for(var e in t){var n=t[e];n&&n.destroy()}this.loaders={},h.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(t){var e=t.frag,n=e.type,i=this.loaders[n],r=this.hls.config;e.loaded=0,i&&(d.logger.warn("abort previous fragment loader for type:"+n),i.abort()),i=this.loaders[n]=e.loader=void 0!==r.fLoader?new r.fLoader(r):new r.loader(r);var a=void 0,s=void 0,o=void 0;a={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1};var u=e.byteRangeStartOffset,l=e.byteRangeEndOffset;isNaN(u)||isNaN(l)||(a.rangeStart=u,a.rangeEnd=l),s={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout},o={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},i.load(a,s,o)}},{key:"loadsuccess",value:function(t,e,n){var i=t.data,r=n.frag;r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(l.default.FRAG_LOADED,{payload:i,frag:r,stats:e})}},{key:"loaderror",value:function(t,e){var n=e.loader;n&&n.abort(),this.loaders[e.type]=void 0,this.hls.trigger(l.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t})}},{key:"loadtimeout",value:function(t,e){var n=e.loader;n&&n.abort(),this.loaders[e.type]=void 0,this.hls.trigger(l.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag})}},{key:"loadprogress",value:function(t,e,n){var i=e.frag;i.loaded=t.loaded,this.hls.trigger(l.default.FRAG_LOAD_PROGRESS,{frag:i,stats:t})}}]),e}(h.default);n.default=g},{30:30,31:31,32:32,50:50}],39:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(32),l=i(u),c=t(31),h=i(c),f=t(30),d=t(50),g=function(t){function e(t){r(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l.default.KEY_LOADING));return n.loaders={},n.decryptkey=null,n.decrypturl=null,n}return s(e,t),o(e,[{key:"destroy",value:function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},h.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(t){var e=t.frag,n=e.type,i=this.loaders[n],r=e.decryptdata,a=r.uri;if(a!==this.decrypturl||null===this.decryptkey){var s=this.hls.config;i&&(d.logger.warn("abort previous key loader for type:"+n),i.abort()),e.loader=this.loaders[n]=new s.loader(s),this.decrypturl=a,this.decryptkey=null;var o=void 0,u=void 0,c=void 0;o={url:a,frag:e,responseType:"arraybuffer"},u={timeout:s.fragLoadingTimeOut,maxRetry:s.fragLoadingMaxRetry,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},e.loader.load(o,u,c)}else this.decryptkey&&(r.key=this.decryptkey,this.hls.trigger(l.default.KEY_LOADED,{frag:e}))}},{key:"loadsuccess",value:function(t,e,n){var i=n.frag;this.decryptkey=i.decryptdata.key=new Uint8Array(t.data),i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(l.default.KEY_LOADED,{frag:i})}},{key:"loaderror",value:function(t,e){var n=e.frag,i=n.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(l.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:t})}},{key:"loadtimeout",value:function(t,e){var n=e.frag,i=n.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(l.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})}}]),e}(h.default);n.default=g},{30:30,31:31,32:32,50:50}],40:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=(void 0===e?"undefined":$traceurRuntime.typeof(e))&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=t(2),l=i(u),c=t(32),h=i(c),f=t(31),d=i(f),g=t(30),m=t(44),p=i(m),b=t(50),_=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,v=/#EXT-X-MEDIA:(.*)/g,y=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,E=function(){function t(){s(this,t),this.method=null,this.key=null,this.iv=null,this._uri=null}return o(t,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=l.default.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),t}(),T=function(){function t(){s(this,t),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return o(t,[{key:"createInitializationVector",value:function(t){for(var e=new Uint8Array(16),n=12;n<16;n++)e[n]=t>>8*(15-n)&255;return e}},{key:"fragmentDecryptdataFromLevelkey",value:function(t,e){var n=t;return t&&t.method&&t.uri&&!t.iv&&(n=new E,n.method=t.method,n.baseuri=t.baseuri,n.reluri=t.reluri,n.iv=this.createInitializationVector(e)),n}},{key:"cloneObj",value:function(t){return JSON.parse(JSON.stringify(t))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=l.default.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var t=this._byteRange=[];if(this.rawByteRange){var e=this.rawByteRange.split("@",2);if(1===e.length){var n=this.lastByteRangeEndOffset;t[0]=n||0}else t[0]=parseInt(e[1]);t[1]=parseInt(e[0])+t[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),t}(),x=function(t){function e(t){s(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,h.default.MANIFEST_LOADING,h.default.LEVEL_LOADING,h.default.AUDIO_TRACK_LOADING,h.default.SUBTITLE_TRACK_LOADING));return n.loaders={},n}return a(e,t),o(e,[{key:"destroy",value:function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},d.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(t){this.load(t.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(t){this.load(t.url,{type:"level",level:t.level,id:t.id})}},{key:"onAudioTrackLoading",value:function(t){this.load(t.url,{type:"audioTrack",id:t.id})}},{key:"onSubtitleTrackLoading",value:function(t){this.load(t.url,{type:"subtitleTrack",id:t.id})}},{key:"load",value:function(t,e){var n=this.loaders[e.type];if(n){var i=n.context;if(i&&i.url===t)return void b.logger.trace("playlist request ongoing");b.logger.warn("abort previous loader for type:"+e.type),n.abort()}var r=this.hls.config,a=void 0,s=void 0,o=void 0,u=void 0;"manifest"===e.type?(a=r.manifestLoadingMaxRetry,s=r.manifestLoadingTimeOut,o=r.manifestLoadingRetryDelay,u=r.manifestLoadingMaxRetryTimeout):(a=r.levelLoadingMaxRetry,s=r.levelLoadingTimeOut,o=r.levelLoadingRetryDelay,u=r.levelLoadingMaxRetryTimeout,b.logger.log("loading playlist for "+e.type+" "+(e.level||e.id))),n=this.loaders[e.type]=e.loader=void 0!==r.pLoader?new r.pLoader(r):new r.loader(r),e.url=t,e.responseType="";var l=void 0,c=void 0;l={timeout:s,maxRetry:a,retryDelay:o,maxRetryDelay:u},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},n.load(e,l,c)}},{key:"resolve",value:function(t,e){return l.default.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(t,e){var n=[],i=void 0;for(_.lastIndex=0;null!=(i=_.exec(t));){var r={},a=r.attrs=new p.default(i[1]);r.url=this.resolve(i[2],e);var s=a.decimalResolution("RESOLUTION");s&&(r.width=s.width,r.height=s.height),r.bitrate=a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),r.name=a.NAME;var o=a.CODECS;if(o){o=o.split(/[ ,]+/);for(var u=0;u<o.length;u++){var l=o[u];-1!==l.indexOf("avc1")?r.videoCodec=this.avc1toavcoti(l):r.audioCodec=l}}n.push(r)}return n}},{key:"parseMasterPlaylistMedia",value:function(t,e,n){var i=void 0,r=[],a=0;for(v.lastIndex=0;null!=(i=v.exec(t));){var s={},o=new p.default(i[1]);o.TYPE===n&&(s.groupId=o["GROUP-ID"],s.name=o.NAME,s.type=n,s.default="YES"===o.DEFAULT,s.autoselect="YES"===o.AUTOSELECT,s.forced="YES"===o.FORCED,o.URI&&(s.url=this.resolve(o.URI,e)),s.lang=o.LANGUAGE,s.name||(s.name=s.lang),s.id=a++,r.push(s))}return r}},{key:"avc1toavcoti",value:function(t){var e,n=t.split(".");return n.length>2?(e=n.shift()+".",e+=parseInt(n.shift()).toString(16),e+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):e=t,e}},{key:"parseLevelPlaylist",value:function(t,e,n,i){var r,a,s=0,o=0,u={type:null,version:null,url:e,fragments:[],live:!0,startSN:0},l=new E,c=0,h=null,f=new T;for(y.lastIndex=0;null!==(r=y.exec(t));){var d=r[1];if(d){f.duration=parseFloat(d);var g=(" "+r[2]).slice(1);f.title=g||null,f.tagList.push(g?["INF",d,g]:["INF",d])}else if(r[3]){if(!isNaN(f.duration)){var m=s++;f.type=i,f.start=o,f.levelkey=l,f.sn=m,f.level=n,f.cc=c,f.baseurl=e,f.relurl=(" "+r[3]).slice(1),u.fragments.push(f),h=f,o+=f.duration,f=new T}}else if(r[4]){if(f.rawByteRange=(" "+r[4]).slice(1),h){var _=h.byteRangeEndOffset;_&&(f.lastByteRangeEndOffset=_)}}else if(r[5])f.rawProgramDateTime=(" "+r[5]).slice(1),f.tagList.push(["PROGRAM-DATE-TIME",f.rawProgramDateTime]);else{for(r=r[0].match(/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/),a=1;a<r.length&&void 0===r[a];a++);var v=(" "+r[a+1]).slice(1),x=(" "+r[a+2]).slice(1);switch(r[a]){case"#":f.tagList.push(x?[v,x]:[v]);break;case"PLAYLIST-TYPE":u.type=v.toUpperCase();break;case"MEDIA-SEQUENCE":s=u.startSN=parseInt(v);break;case"TARGETDURATION":u.targetduration=parseFloat(v);break;case"VERSION":u.version=parseInt(v);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":c++,f.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":c=parseInt(v);break;case"KEY":var S=v,w=new p.default(S),M=w.enumeratedString("METHOD"),C=w.URI,R=w.hexadecimalInteger("IV");M&&(l=new E,C&&["AES-128","SAMPLE-AES"].indexOf(M)>=0&&(l.method=M,l.baseuri=e,l.reluri=C,l.key=null,l.iv=R));break;case"START":var O=v,A=new p.default(O),j=A.decimalFloatingPoint("TIME-OFFSET");isNaN(j)||(u.startTimeOffset=j);break;case"MAP":var I=new p.default(v);f.relurl=I.URI,f.rawByteRange=I.BYTERANGE,f.baseurl=e,f.level=n,f.type=i,f.sn="initSegment",u.initSegment=f,f=new T;break;default:b.logger.warn("line parsed but not handled: "+r)}}}return f=h,f&&!f.relurl&&(u.fragments.pop(),o-=f.duration),u.totalduration=o,u.averagetargetduration=o/u.fragments.length,u.endSN=s-1,u}},{key:"loadsuccess",value:function(t,e,n){var i=t.data,r=t.url,a=n.type,s=n.id,o=n.level,u=this.hls;if(this.loaders[a]=void 0,void 0!==r&&0!==r.indexOf("data:")||(r=n.url),e.tload=performance.now(),0===i.indexOf("#EXTM3U"))if(i.indexOf("#EXTINF:")>0){var l="audioTrack"!==a&&"subtitleTrack"!==a,c=isNaN(o)?isNaN(s)?0:s:o,f=this.parseLevelPlaylist(i,r,c,"audioTrack"===a?"audio":"subtitleTrack"===a?"subtitle":"main");f.tload=e.tload,"manifest"===a&&u.trigger(h.default.MANIFEST_LOADED,{levels:[{url:r,details:f}],audioTracks:[],url:r,stats:e}),e.tparsed=performance.now(),f.targetduration?l?u.trigger(h.default.LEVEL_LOADED,{details:f,level:o||0,id:s||0,stats:e}):"audioTrack"===a?u.trigger(h.default.AUDIO_TRACK_LOADED,{details:f,id:s,stats:e}):"subtitleTrack"===a&&u.trigger(h.default.SUBTITLE_TRACK_LOADED,{details:f,id:s,stats:e}):u.trigger(h.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:r,reason:"invalid targetduration"})}else{var d=this.parseMasterPlaylist(i,r);if(d.length){var m=this.parseMasterPlaylistMedia(i,r,"AUDIO"),p=this.parseMasterPlaylistMedia(i,r,"SUBTITLES");if(m.length){var _=!1;m.forEach(function(t){t.url||(_=!0)}),!1===_&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(b.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main"}))}u.trigger(h.default.MANIFEST_LOADED,{levels:d,audioTracks:m,subtitles:p,url:r,stats:e})}else u.trigger(h.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:r,reason:"no level found in manifest"})}else u.trigger(h.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:r,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(t,e){var n,i,r=e.loader;switch(e.type){case"manifest":n=g.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case"level":n=g.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case"audioTrack":n=g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1}r&&(r.abort(),this.loaders[e.type]=void 0),this.hls.trigger(h.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:n,fatal:i,url:r.url,loader:r,response:t,context:e})}},{key:"loadtimeout",value:function(t,e){var n,i,r=e.loader;switch(e.type){case"manifest":n=g.ErrorDetails.MANIFEST_LOAD_TIMEOUT,i=!0;break;case"level":n=g.ErrorDetails.LEVEL_LOAD_TIMEOUT,i=!1;break;case"audioTrack":n=g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,i=!1}r&&(r.abort(),this.loaders[e.type]=void 0),this.hls.trigger(h.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:n,fatal:i,url:r.url,loader:r,context:e})}}]),e}(d.default);n.default=x},{2:2,30:30,31:31,32:32,44:44,50:50}],41:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=Math.pow(2,32)-1,s=function(){function t(){i(this,t)}return r(t,null,[{key:"init",value:function(){t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var e;for(e in t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:n,audio:i};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=a,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,s,u,s,o),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,r))}},{key:"box",value:function(t){for(var e=void 0,n=Array.prototype.slice.call(arguments,1),i=8,r=n.length,a=r;r--;)i+=n[r].byteLength;for(e=new Uint8Array(i),e[0]=i>>24&255,e[1]=i>>16&255,e[2]=i>>8&255,e[3]=255&i,e.set(t,4),r=0,i=8;r<a;r++)e.set(n[r],i),i+=n[r].byteLength;return e}},{key:"hdlr",value:function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])}},{key:"mdat",value:function(e){return t.box(t.types.mdat,e)}},{key:"mdhd",value:function(e,n){n*=e;var i=Math.floor(n/(a+1)),r=Math.floor(n%(a+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}},{key:"mdia",value:function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))}},{key:"mfhd",value:function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}},{key:"minf",value:function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))}},{key:"moof",value:function(e,n,i){return t.box(t.types.moof,t.mfhd(e),t.traf(i,n))}},{key:"moov",value:function(e){for(var n=e.length,i=[];n--;)i[n]=t.trak(e[n]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(t.mvex(e)))}},{key:"mvex",value:function(e){for(var n=e.length,i=[];n--;)i[n]=t.trex(e[n]);return t.box.apply(null,[t.types.mvex].concat(i))}},{key:"mvhd",value:function(e,n){n*=e;var i=Math.floor(n/(a+1)),r=Math.floor(n%(a+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,s)}},{key:"sdtp",value:function(e){var n,i,r=e.samples||[],a=new Uint8Array(4+r.length);for(i=0;i<r.length;i++)n=r[i].flags,a[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return t.box(t.types.sdtp,a)}},{key:"stbl",value:function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))}},{key:"avc1",value:function(e){var n,i,r,a=[],s=[];for(n=0;n<e.sps.length;n++)i=e.sps[n],r=i.byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(i));for(n=0;n<e.pps.length;n++)i=e.pps[n],r=i.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(i));var o=t.box(t.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|e.sps.length].concat(a).concat([e.pps.length]).concat(s))),u=e.width,l=e.height,c=e.pixelRatio[0],h=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,h>>24,h>>16&255,h>>8&255,255&h])))}},{key:"esds",value:function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}},{key:"mp4a",value:function(e){var n=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),t.box(t.types.esds,t.esds(e)))}},{key:"mp3",value:function(e){var n=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))}},{key:"stsd",value:function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))}},{key:"tkhd",value:function(e){var n=e.id,i=e.duration*e.timescale,r=e.width,s=e.height,o=Math.floor(i/(a+1)),u=Math.floor(i%(a+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,s>>8&255,255&s,0,0]))}},{key:"traf",value:function(e,n){var i=t.sdtp(e),r=e.id,s=Math.floor(n/(a+1)),o=Math.floor(n%(a+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o])),t.trun(e,i.length+16+20+8+16+8+8),i)}},{key:"trak",value:function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))}},{key:"trex",value:function(e){var n=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(e,n){var i,r,a,s,o,u,l=e.samples||[],c=l.length,h=12+16*c,f=new Uint8Array(h);for(n+=8+h,f.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),i=0;i<c;i++)r=l[i],a=r.duration,s=r.size,o=r.flags,u=r.cts,f.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*i);return t.box(t.types.trun,f)}},{key:"initSegment",value:function(e){t.types||t.init();var n,i=t.moov(e);return n=new Uint8Array(t.FTYP.byteLength+i.byteLength),n.set(t.FTYP),n.set(i,t.FTYP.byteLength),n}}]),t}();n.default=s},{}],42:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=t(33),o=i(s),u=t(32),l=i(u),c=t(50),h=t(41),f=i(h),d=t(30),g=function(){function t(e,n,i,a){r(this,t),this.observer=e,this.config=n,this.typeSupported=i;var s=navigator.userAgent;this.isSafari=a&&a.indexOf("Apple")>-1&&s&&!s.match("CriOS"),this.ISGenerated=!1}return a(t,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(t){this._initPTS=this._initDTS=t}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(t,e,n,i,r,a,s){if(this.ISGenerated||this.generateIS(t,e,r),this.ISGenerated)if(t.samples.length){var o=this.remuxAudio(t,r,a,s);if(e.samples.length){var u=void 0;o&&(u=o.endPTS-o.startPTS),e.timescale||(c.logger.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,r)),this.remuxVideo(e,r,a,u)}}else{var h=void 0;e.samples.length&&(h=this.remuxVideo(e,r,a)),h&&t.codec&&this.remuxEmptyAudio(t,r,a,h)}n.samples.length&&this.remuxID3(n,r),i.samples.length&&this.remuxText(i,r),this.observer.trigger(l.default.FRAG_PARSED)}},{key:"generateIS",value:function(t,e,n){var i,r,a=this.observer,s=t.samples,o=e.samples,u=this.typeSupported,h="audio/mp4",g={},m={tracks:g},p=void 0===this._initPTS;if(p&&(i=r=1/0),t.config&&s.length&&(t.timescale=t.samplerate,c.logger.log("audio sampling rate : "+t.samplerate),t.isAAC||(u.mpeg?(h="audio/mpeg",t.codec=""):u.mp3&&(t.codec="mp3")),g.audio={container:h,codec:t.codec,initSegment:!t.isAAC&&u.mpeg?new Uint8Array:f.default.initSegment([t]),metadata:{channelCount:t.channelCount}},p&&(i=r=s[0].pts-t.inputTimeScale*n)),e.sps&&e.pps&&o.length){var b=e.inputTimeScale;e.timescale=b,g.video={container:"video/mp4",codec:e.codec,initSegment:f.default.initSegment([e]),metadata:{width:e.width,height:e.height}},p&&(i=Math.min(i,o[0].pts-b*n),r=Math.min(r,o[0].dts-b*n),this.observer.trigger(l.default.INIT_PTS_FOUND,{initPTS:i}))}Object.keys(g).length?(a.trigger(l.default.FRAG_PARSING_INIT_SEGMENT,m),this.ISGenerated=!0,p&&(this._initPTS=i,this._initDTS=r)):a.trigger(l.default.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(t,e,n,i){var r,a,s,o,u,h,g,m=8,p=t.timescale,b=t.samples,_=[],v=b.length,y=this._PTSNormalize,E=this._initDTS;b.sort(function(t,e){var n=t.dts-e.dts,i=t.pts-e.pts;return n||(i||t.id-e.id)});var T=b.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(T<0){c.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(T/90)+" ms to overcome this issue");for(var x=0;x<b.length;x++)b[x].dts+=T}var S=void 0;S=n?this.nextAvcDts:e*p;var w=b[0];u=Math.max(y(w.dts-E,S),0),o=Math.max(y(w.pts-E,S),0);var M=Math.round((u-S)/90);n&&M&&(M>1?c.logger.log("AVC:"+M+" ms hole between fragments detected,filling it"):M<-1&&c.logger.log("AVC:"+-M+" ms overlapping between fragments detected"),u=S,b[0].dts=u+E,o=Math.max(o-M,S),b[0].pts=o+E,c.logger.log("Video/PTS/DTS adjusted: "+Math.round(o/90)+"/"+Math.round(u/90)+",delta:"+M+" ms")),w=b[b.length-1],g=Math.max(y(w.dts-E,S),0),h=Math.max(y(w.pts-E,S),0),h=Math.max(h,g);var C=this.isSafari;C&&(r=Math.round((g-u)/(b.length-1)));for(var R=0,O=0,A=0;A<v;A++){for(var j=b[A],I=j.units,P=I.length,L=0,N=0;N<P;N++)L+=I[N].data.length;O+=L,R+=P,j.length=L,j.dts=C?u+A*r:Math.max(y(j.dts-E,S),u),j.pts=Math.max(y(j.pts-E,S),j.dts)}var D=O+4*R+8;try{a=new Uint8Array(D)}catch(t){return void this.observer.trigger(l.default.ERROR,{type:d.ErrorTypes.MUX_ERROR,details:d.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:D,reason:"fail allocating video mdat "+D})}var k=new DataView(a.buffer);k.setUint32(0,D),a.set(f.default.types.mdat,4);for(var F=0;F<v;F++){for(var V=b[F],B=V.units,U=0,z=void 0,G=0,$=B.length;G<$;G++){var H=B[G],q=H.data,X=H.data.byteLength;k.setUint32(m,X),m+=4,a.set(q,m),m+=X,U+=4+X}if(C)z=Math.max(0,r*Math.round((V.pts-V.dts)/r));else{if(F<v-1)r=b[F+1].dts-V.dts;else{var K=this.config,W=V.dts-b[F>0?F-1:F].dts;if(K.stretchShortVideoTrack){var Y=K.maxBufferHole,Q=K.maxSeekHole,Z=Math.floor(Math.min(Y,Q)*p),J=(i?o+i*p:this.nextAudioPts)-V.pts;J>Z?(r=J-W,r<0&&(r=W),
c.logger.log("It is approximately "+J/90+" ms to the next segment; using duration "+r/90+" ms for the last video frame.")):r=W}else r=W}z=Math.round(V.pts-V.dts)}_.push({size:U,duration:r,cts:z,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:V.key?2:1,isNonSync:V.key?0:1}})}this.nextAvcDts=g+r;var tt=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,_.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var et=_[0].flags;et.dependsOn=2,et.isNonSync=0}t.samples=_,s=f.default.moof(t.sequenceNumber++,u,t),t.samples=[];var nt={data1:s,data2:a,startPTS:o/p,endPTS:(h+r)/p,startDTS:u/p,endDTS:this.nextAvcDts/p,type:"video",nb:_.length,dropped:tt};return this.observer.trigger(l.default.FRAG_PARSING_DATA,nt),nt}},{key:"remuxAudio",value:function(t,e,n,i){var r,a,s,u,h,g,m,p,b,_,v,y,E,T,x,S,w=t.inputTimeScale,M=t.timescale,C=w/M,R=t.isAAC?1024:1152,O=R*C,A=this._PTSNormalize,j=this._initDTS,I=!t.isAAC&&this.typeSupported.mpeg,P=I?0:8,L=[],N=[];if(t.samples.sort(function(t,e){return t.pts-e.pts}),N=t.samples,S=this.nextAudioPts,n|=N.length&&S&&(i&&Math.abs(e-S/w)<.1||Math.abs(N[0].pts-S-j)<20*O),n||(S=e*w),i&&t.isAAC)for(var D=0,k=S;D<N.length;){var F=N[D],V=A(F.pts-j,S),B=V-k;if(B<=-O)c.logger.warn("Dropping 1 audio frame @ "+(k/w).toFixed(3)+"s due to "+Math.abs(1e3*B/w)+" ms overlap."),N.splice(D,1),t.len-=F.unit.length;else if(B>=O&&k){var U=Math.round(B/O);c.logger.warn("Injecting "+U+" audio frame @ "+(k/w).toFixed(3)+"s due to "+1e3*B/w+" ms gap.");for(var z=0;z<U;z++)x=k+j,x=Math.max(x,j),T=o.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),T||(c.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),T=F.unit.subarray()),N.splice(D,0,{unit:T,pts:x,dts:x}),t.len+=T.length,k+=O,D+=1;F.pts=F.dts=k+j,k+=O,D+=1}else Math.abs(B),k+=O,F.pts=F.dts=0===D?j+S:N[D-1].pts+O,D+=1}for(var G=0,$=N.length;G<$;G++){if(a=N[G],u=a.unit,_=a.pts-j,v=a.dts-j,void 0!==b)y=A(_,b),E=A(v,b),s.duration=Math.round((E-b)/C);else{y=A(_,S),E=A(v,S);var H=Math.round(1e3*(y-S)/w),q=0;if(n&&t.isAAC&&H){if(H>0)q=Math.round((y-S)/O),c.logger.log(H+" ms hole between AAC samples detected,filling it"),q>0&&(T=o.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),T||(T=u.subarray()),t.len+=q*T.length);else if(H<-12){c.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(S/w).toFixed(3)+"s/"+(y/w).toFixed(3)+"s/"+-H+"ms"),t.len-=u.byteLength;continue}y=E=S}if(m=Math.max(0,y),p=Math.max(0,E),!(t.len>0))return;var X=I?t.len:t.len+8;try{h=new Uint8Array(X)}catch(t){return void this.observer.trigger(l.default.ERROR,{type:d.ErrorTypes.MUX_ERROR,details:d.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:X,reason:"fail allocating audio mdat "+X})}I||(r=new DataView(h.buffer),r.setUint32(0,X),h.set(f.default.types.mdat,4));for(var K=0;K<q;K++)x=y-(q-K)*O,T=o.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),T||(c.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),T=u.subarray()),h.set(T,P),P+=T.byteLength,s={size:T.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},L.push(s)}h.set(u,P);var W=u.byteLength;P+=W,s={size:W,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},L.push(s),b=E}var Y=0,Q=L.length;if(Q>=2&&(Y=L[Q-2].duration,s.duration=Y),Q){this.nextAudioPts=y+C*Y,t.len=0,t.samples=L,g=I?new Uint8Array:f.default.moof(t.sequenceNumber++,p/C,t),t.samples=[];var Z={data1:g,data2:h,startPTS:m/w,endPTS:this.nextAudioPts/w,startDTS:p/w,endDTS:(E+C*Y)/w,type:"audio",nb:Q};return this.observer.trigger(l.default.FRAG_PARSING_DATA,Z),Z}return null}},{key:"remuxEmptyAudio",value:function(t,e,n,i){var r=t.inputTimeScale,a=t.samplerate?t.samplerate:r,s=r/a,u=this.nextAudioPts,l=(void 0!==u?u:i.startDTS*r)+this._initDTS,h=i.endDTS*r+this._initDTS,f=1024*s,d=Math.ceil((h-l)/f),g=o.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(c.logger.warn("remux empty Audio"),!g)return void c.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var m=[],p=0;p<d;p++){var b=l+p*f;m.push({unit:g,pts:b,dts:b}),t.len+=g.length}t.samples=m,this.remuxAudio(t,e,n)}},{key:"remuxID3",value:function(t,e){var n,i=t.samples.length,r=t.inputTimeScale,a=this._initPTS,s=this._initDTS;if(i){for(var o=0;o<i;o++)n=t.samples[o],n.pts=(n.pts-a)/r,n.dts=(n.dts-s)/r;this.observer.trigger(l.default.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[],e=e}},{key:"remuxText",value:function(t,e){t.samples.sort(function(t,e){return t.pts-e.pts});var n,i=t.samples.length,r=t.inputTimeScale,a=this._initPTS;if(i){for(var s=0;s<i;s++)n=t.samples[s],n.pts=(n.pts-a)/r;this.observer.trigger(l.default.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[],e=e}},{key:"_PTSNormalize",value:function(t,e){var n;if(void 0===e)return t;for(n=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=n;return t}}]),t}();n.default=g},{30:30,32:32,33:33,41:41,50:50}],43:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t(32),s=function(t){return t&&t.__esModule?t:{default:t}}(a),o=function(){function t(e){i(this,t),this.observer=e}return r(t,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(){}},{key:"remux",value:function(t,e,n,i,r,a,o,u){var l=this.observer,c="";t&&(c+="audio"),e&&(c+="video"),l.trigger(s.default.FRAG_PARSING_DATA,{data1:u,startPTS:r,startDTS:r,type:c,nb:1,dropped:0}),l.trigger(s.default.FRAG_PARSED)}}]),t}();n.default=o},{32:32}],44:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=/^(\d+)x(\d+)$/,s=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,o=function(){function t(e){i(this,t),"string"==typeof e&&(e=t.parseAttrList(e));for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n])}return r(t,[{key:"decimalInteger",value:function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}},{key:"hexadecimalInteger",value:function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var n=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)n[i]=parseInt(e.slice(2*i,2*i+2),16);return n}return null}},{key:"hexadecimalIntegerAsNumber",value:function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}},{key:"decimalFloatingPoint",value:function(t){return parseFloat(this[t])}},{key:"enumeratedString",value:function(t){return this[t]}},{key:"decimalResolution",value:function(t){var e=a.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}}],[{key:"parseAttrList",value:function(t){var e,n={};for(s.lastIndex=0;null!==(e=s.exec(t));){var i=e[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),n[e[1]]=i}return n}}]),t}();n.default=o},{}],45:[function(t,e,n){var i={search:function(t,e){for(var n=0,i=t.length-1,r=null,a=null;n<=i;){r=(n+i)/2|0,a=t[r];var s=e(a);if(s>0)n=r+1;else{if(!(s<0))return a;i=r-1}}return null}};e.exports=i},{}],46:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},s=function(t){var e=t;return a.hasOwnProperty(t)&&(e=a[t]),String.fromCharCode(e)},o=15,u=100,l={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},h={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},d=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],g={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){this.verboseFilter[t],this.verboseLevel}},m=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].toString(16));return e},p=function(){function t(e,n,r,a,s){i(this,t),this.foreground=e||"white",this.underline=n||!1,this.italics=r||!1,this.background=a||"black",this.flash=s||!1}return r(t,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(t){for(var e=["foreground","underline","italics","background","flash"],n=0;n<e.length;n++){var i=e[n];t.hasOwnProperty(i)&&(this[i]=t[i])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}},{key:"copy",value:function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),t}(),b=function(){function t(e,n,r,a,s,o){i(this,t),this.uchar=e||" ",this.penState=new p(n,r,a,s,o)}return r(t,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(t,e){this.uchar=t,this.penState.copy(e)}},{key:"setPenState",value:function(t){this.penState.copy(t)}},{key:"equals",value:function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}},{key:"copy",value:function(t){this.uchar=t.uchar,this.penState.copy(t.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),t}(),_=function(){function t(){i(this,t),this.chars=[];for(var e=0;e<u;e++)this.chars.push(new b);this.pos=0,this.currPenState=new p}return r(t,[{key:"equals",value:function(t){for(var e=!0,n=0;n<u;n++)if(!this.chars[n].equals(t.chars[n])){e=!1;break}return e}},{key:"copy",value:function(t){for(var e=0;e<u;e++)this.chars[e].copy(t.chars[e])}},{key:"isEmpty",value:function(){for(var t=!0,e=0;e<u;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}},{key:"setCursor",value:function(t){this.pos!==t&&(this.pos=t),this.pos<0?(g.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>u&&(g.log("ERROR","Too large cursor position "+this.pos),this.pos=u)}},{key:"moveCursor",value:function(t){var e=this.pos+t;if(t>1)for(var n=this.pos+1;n<e+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(e)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(t){t>=144&&this.backSpace();var e=s(t);if(this.pos>=u)return void g.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)}},{key:"clearFromPos",value:function(t){var e;for(e=t;e<u;e++)this.chars[e].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var t=[],e=!0,n=0;n<u;n++){var i=this.chars[n].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")}},{key:"setPenStyles",value:function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}]),t}(),v=function(){function t(){i(this,t),this.rows=[];for(var e=0;e<o;e++)this.rows.push(new _);this.currRow=o-1,this.nrRollUpRows=null,this.reset()}return r(t,[{key:"reset",value:function(){for(var t=0;t<o;t++)this.rows[t].clear();this.currRow=o-1}},{key:"equals",value:function(t){for(var e=!0,n=0;n<o;n++)if(!this.rows[n].equals(t.rows[n])){e=!1;break}return e}},{key:"copy",value:function(t){for(var e=0;e<o;e++)this.rows[e].copy(t.rows[e])}},{key:"isEmpty",value:function(){for(var t=!0,e=0;e<o;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}},{key:"backSpace",value:function(){this.rows[this.currRow].backSpace()}},{key:"clearToEndOfRow",value:function(){this.rows[this.currRow].clearToEndOfRow()}},{key:"insertChar",value:function(t){this.rows[this.currRow].insertChar(t)}},{key:"setPen",value:function(t){this.rows[this.currRow].setPenStyles(t)}},{key:"moveCursor",value:function(t){this.rows[this.currRow].moveCursor(t)}},{key:"setCursor",value:function(t){g.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)}},{key:"setPAC",value:function(t){g.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var n=0;n<o;n++)this.rows[n].clear();var i=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){var a=r.rows[i].cueStartTime;if(a&&a<g.time)for(var s=0;s<this.nrRollUpRows;s++)this.rows[e-this.nrRollUpRows+s+1].copy(r.rows[i+s])}}this.currRow=e;var u=this.rows[this.currRow];if(null!==t.indent){var l=t.indent,c=Math.max(l-1,0);u.setCursor(t.indent),t.color=u.chars[c].penState.foreground}var h={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(h)}},{key:"setBkgData",value:function(t){g.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}},{key:"setRollUpRows",value:function(t){this.nrRollUpRows=t}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void g.log("DEBUG","roll_up but nrRollUpRows not set yet");g.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),g.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(t){t=t||!1;for(var e=[],n="",i=-1,r=0;r<o;r++){var a=this.rows[r].getTextString();a&&(i=r+1,t?e.push("Row "+i+": '"+a+"'"):e.push(a.trim()))}return e.length>0&&(n=t?"["+e.join(" | ")+"]":e.join("\n")),n}},{key:"getTextAndFormat",value:function(){return this.rows}}]),t}(),y=function(){function t(e,n){i(this,t),this.chNr=e,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new v,this.nonDisplayedMemory=new v,this.lastOutputScreen=new v,this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return r(t,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(t){this.outputFilter=t}},{key:"setPAC",value:function(t){this.writeScreen.setPAC(t)}},{key:"setBkgData",value:function(t){this.writeScreen.setBkgData(t)}},{key:"setMode",value:function(t){t!==this.mode&&(this.mode=t,g.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}},{key:"insertChars",value:function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";g.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(g.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){g.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){g.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){g.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(t){g.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}},{key:"ccFON",value:function(){g.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){g.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){g.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){g.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){g.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){g.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){g.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(g.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,g.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(t){g.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}},{key:"ccMIDROW",value:function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var n=Math.floor(t/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=i[n]}g.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)}},{key:"outputDataUpdate",value:function(){var t=g.time;null!==t&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(t,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}]),t}(),E=function(){function t(e,n,r){i(this,t),this.field=e||1,this.outputs=[n,r],this.channels=[new y(1,n),new y(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return r(t,[{key:"getHandler",value:function(t){return this.channels[t].getHandler()}},{key:"setHandler",value:function(t,e){this.channels[t].setHandler(e)}},{key:"addData",value:function(t,e){var n,i,r,a=!1;this.lastTime=t,g.setTime(t);for(var s=0;s<e.length;s+=2)if(i=127&e[s],r=127&e[s+1],0!==i||0!==r){if(g.log("DATA","["+m([e[s],e[s+1]])+"] -> ("+m([i,r])+")"),n=this.parseCmd(i,r),n||(n=this.parseMidrow(i,r)),n||(n=this.parsePAC(i,r)),n||(n=this.parseBackgroundAttributes(i,r)),!n&&(a=this.parseChars(i,r)))if(this.currChNr&&this.currChNr>=0){var o=this.channels[this.currChNr-1];o.insertChars(a)}else g.log("WARNING","No channel found yet. TEXT-MODE?");n?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,g.log("WARNING","Couldn't parse cleaned data "+m([i,r])+" orig: "+m([e[s],e[s+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(t,e){var n=null,i=(20===t||28===t)&&32<=e&&e<=47,r=(23===t||31===t)&&33<=e&&e<=35;if(!i&&!r)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,g.log("DEBUG","Repeated command ("+m([t,e])+") is dropped"),!0;n=20===t||23===t?1:2;var a=this.channels[n-1];return 20===t||28===t?32===e?a.ccRCL():33===e?a.ccBS():34===e?a.ccAOF():35===e?a.ccAON():36===e?a.ccDER():37===e?a.ccRU(2):38===e?a.ccRU(3):39===e?a.ccRU(4):40===e?a.ccFON():41===e?a.ccRDC():42===e?a.ccTR():43===e?a.ccRTD():44===e?a.ccEDM():45===e?a.ccCR():46===e?a.ccENM():47===e&&a.ccEOC():a.ccTO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=n,!0}},{key:"parseMidrow",value:function(t,e){var n=null;return(17===t||25===t)&&32<=e&&e<=47&&((n=17===t?1:2)!==this.currChNr?(g.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[n-1].ccMIDROW(e),g.log("DEBUG","MIDROW ("+m([t,e])+")"),!0))}},{key:"parsePAC",value:function(t,e){var n=null,i=null,r=(17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127,a=(16===t||24===t)&&64<=e&&e<=95;if(!r&&!a)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;n=t<=23?1:2,i=64<=e&&e<=95?1===n?l[t]:h[t]:1===n?c[t]:f[t];var s=this.interpretPAC(i,e);return this.channels[n-1].setPAC(s),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=n,!0}},{key:"interpretPAC",value:function(t,e){var n=e,i={color:null,italics:!1,indent:null,underline:!1,row:t};return n=e>95?e-96:e-64,i.underline=1==(1&n),n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i}},{key:"parseChars",value:function(t,e){var n=null,i=null,r=null;if(t>=25?(n=2,r=t-8):(n=1,r=t),17<=r&&r<=19){var a=e;a=17===r?e+80:18===r?e+112:e+144,g.log("INFO","Special char '"+s(a)+"' in channel "+n),i=[a]}else 32<=t&&t<=127&&(i=0===e?[t]:[t,e]);if(i){var o=m(i);g.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return i}},{key:"parseBackgroundAttributes",value:function(t,e){var n,i,r,a,s=(16===t||24===t)&&32<=e&&e<=47,o=(23===t||31===t)&&45<=e&&e<=47;return!(!s&&!o||(n={},16===t||24===t?(i=Math.floor((e-32)/2),n.background=d[i],e%2==1&&(n.background=n.background+"_semi")):45===e?n.background="transparent":(n.foreground="black",47===e&&(n.underline=!0)),r=t<24?1:2,a=this.channels[r-1],a.setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,0))}},{key:"reset",value:function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)}}]),t}();n.default=E},{}],47:[function(t,e,n){var i=t(53),r={newCue:function(t,e,n,r){for(var a=void 0,s=void 0,o=void 0,u=void 0,l=void 0,c=window.VTTCue||window.TextTrackCue,h=0;h<r.rows.length;h++)if(a=r.rows[h],o=!0,u=0,l="",!a.isEmpty()){for(var f=0;f<a.chars.length;f++)a.chars[f].uchar.match(/\s/)&&o?u++:(l+=a.chars[f].uchar,o=!1);a.cueStartTime=e,e===n&&(n+=1e-4),s=new c(e,n,(0,i.fixLineBreaks)(l.trim())),u>=16?u--:u++,navigator.userAgent.match(/Firefox\//)?s.line=h+1:s.line=h>7?h-2:h+1,s.align="left",s.position=Math.max(0,Math.min(100,u/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(s)}}};e.exports=r},{53:53}],48:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t(49),s=function(t){return t&&t.__esModule?t:{default:t}}(a),o=function(){function t(e,n,r,a){i(this,t),this.hls=e,this.defaultEstimate_=a,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new s.default(n),this.fast_=new s.default(r)}return r(t,[{key:"sample",value:function(t,e){t=Math.max(t,this.minDelayMs_);var n=8e3*e/t,i=t/1e3;this.fast_.sample(i,n),this.slow_.sample(i,n)}},{key:"canEstimate",value:function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),t}();n.default=o},{49:49}],49:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e){i(this,t),this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}return r(t,[{key:"sample",value:function(t,e){var n=Math.pow(this.alpha_,t);this.estimate_=e*(1-n)+n*this.estimate_,this.totalWeight_+=t}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_}}]),t}();n.default=a},{}],50:[function(t,e,n){function i(){}function r(t,e){return e="["+t+"] > "+e}function a(t){var e=self.console[t];return e?function(){for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];i[0]&&(i[0]=r(t,i[0])),e.apply(self.console,i)}:i}function s(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];n.forEach(function(e){l[e]=t[e]?t[e].bind(t):a(e)})}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==$traceurRuntime.typeof(Symbol.iterator)?function(t){return void 0===t?"undefined":$traceurRuntime.typeof(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":$traceurRuntime.typeof(t)},u={trace:i,debug:i,log:i,warn:i,info:i,error:i},l=u;n.enableLogs=function(t){if(!0===t||"object"===(void 0===t?"undefined":o(t))){s(t,"debug","log","info","warn","error");try{l.log()}catch(t){l=u}}else l=u},n.logger=l},{}],51:[function(t,e,n){var i={toString:function(t){for(var e="",n=t.length,i=0;i<n;i++)e+="["+t.start(i).toFixed(3)+","+t.end(i).toFixed(3)+"]";return e}};e.exports=i},{}],52:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){function t(t){return"string"==typeof t&&!!a[t.toLowerCase()]&&t.toLowerCase()}function e(t){return"string"==typeof t&&!!s[t.toLowerCase()]&&t.toLowerCase()}function n(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}function i(i,a,s){var o=this,u=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),l={};u?o=document.createElement("custom"):l.enumerable=!0,o.hasBeenReset=!1;var c="",h=!1,f=i,d=a,g=s,m=null,p="",b=!0,_="auto",v="start",y=50,E="middle",T=50,x="middle";if(Object.defineProperty(o,"id",n({},l,{get:function(){return c},set:function(t){c=""+t}})),Object.defineProperty(o,"pauseOnExit",n({},l,{get:function(){return h},set:function(t){h=!!t}})),Object.defineProperty(o,"startTime",n({},l,{get:function(){return f},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",n({},l,{get:function(){return d},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",n({},l,{get:function(){return g},set:function(t){g=""+t,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",n({},l,{get:function(){return m},set:function(t){m=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",n({},l,{get:function(){return p},set:function(e){var n=t(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");p=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",n({},l,{get:function(){return b},set:function(t){b=!!t,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",n({},l,{get:function(){return _},set:function(t){if("number"!=typeof t&&t!==r)throw new SyntaxError("An invalid number or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",n({},l,{get:function(){return v},set:function(t){var n=e(t);if(!n)throw new SyntaxError("An invalid or illegal string was specified.");v=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",n({},l,{get:function(){return y},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",n({},l,{get:function(){return E},set:function(t){var n=e(t);if(!n)throw new SyntaxError("An invalid or illegal string was specified.");E=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",n({},l,{get:function(){return T},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");T=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",n({},l,{get:function(){return x},set:function(t){var n=e(t);if(!n)throw new SyntaxError("An invalid or illegal string was specified.");x=n,this.hasBeenReset=!0}})),o.displayState=void 0,u)return o}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var r="auto",a={"":!0,lr:!0,rl:!0},s={start:!0,middle:!0,end:!0,left:!0,right:!0};return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}()},{}],53:[function(t,e,n){function i(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new h,this.regionList=[]}function r(t){function e(t,e,n,i){return 3600*(0|t)+60*(0|e)+(0|n)+(0|i)/1e3}var n=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?e(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?e(n[1],n[2],0,n[4]):e(0,n[1],n[2],n[4]):null}function a(){this.values=Object.create(null)}function s(t,e,n,i){var r=i?t.split(i):[t];for(var a in r)if("string"==typeof r[a]){var s=r[a].split(n);if(2===s.length){var o=s[0],u=s[1];e(o,u)}}}function o(t,e,n){function i(){var e=r(t);if(null===e)throw new Error("Malformed timestamp: "+u);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function o(){t=t.replace(/^\s+/,"")}var u=t;if(o(),e.startTime=i(),o(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+u);t=t.substr(3),o(),e.endTime=i(),o(),function(t,e){var i=new a;s(t,function(t,e){switch(t){case"region":for(var r=n.length-1;r>=0;r--)if(n[r].id===e){i.set(t,n[r].region);break}break;case"vertical":i.alt(t,e,["rl","lr"]);break;case"line":var a=e.split(","),s=a[0];i.integer(t,s),
i.percent(t,s)&&i.set("snapToLines",!1),i.alt(t,s,["auto"]),2===a.length&&i.alt("lineAlign",a[1],["start",d,"end"]);break;case"position":a=e.split(","),i.percent(t,a[0]),2===a.length&&i.alt("positionAlign",a[1],["start",d,"end","line-left","line-right","auto"]);break;case"size":i.percent(t,e);break;case"align":i.alt(t,e,["start",d,"end","left","right"])}},/:/,/\s/),e.region=i.get("region",null),e.vertical=i.get("vertical","");var r=i.get("line","auto");"auto"===r&&-1===f.line&&(r=-1),e.line=r,e.lineAlign=i.get("lineAlign","start"),e.snapToLines=i.get("snapToLines",!0),e.size=i.get("size",100),e.align=i.get("align",d);var o=i.get("position","auto");"auto"===o&&50===f.position&&(o="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=o}(t,e)}function u(t){return t.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(n,"__esModule",{value:!0}),n.fixLineBreaks=void 0;var l=t(52),c=function(t){return t&&t.__esModule?t:{default:t}}(l),h=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}};a.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,n){return n?this.has(t)?this.values[t]:e[n]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,n){for(var i=0;i<n.length;++i)if(e===n[i]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e))>=0&&e<=100)&&(this.set(t,e),!0)}};var f=new c.default(0,0,0),d="middle"===f.align?"middle":"center";i.prototype={parse:function(t){function e(){var t=n.buffer,e=0;for(t=u(t);e<t.length&&"\r"!==t[e]&&"\n"!==t[e];)++e;var i=t.substr(0,e);return"\r"===t[e]&&++e,"\n"===t[e]&&++e,n.buffer=t.substr(e),i}var n=this;t&&(n.buffer+=n.decoder.decode(t,{stream:!0}));try{var i;if("INITIAL"===n.state){if(!/\r\n|\n/.test(n.buffer))return this;i=e();var r=i.match(/^WEBVTT([ \t].*)?$/);if(!r||!r[0])throw new Error("Malformed WebVTT signature.");n.state="HEADER"}for(var a=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(a?a=!1:i=e(),n.state){case"HEADER":/:/.test(i)?function(t){s(t,function(t,e){t},/:/)}(i):i||(n.state="ID");continue;case"NOTE":i||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){n.state="NOTE";break}if(!i)continue;if(n.cue=new c.default(0,0,""),n.state="CUE",-1===i.indexOf("--\x3e")){n.cue.id=i;continue}case"CUE":try{o(i,n.cue,n.regionList)}catch(t){n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":var l=-1!==i.indexOf("--\x3e");if(!i||l&&(a=!0)){n.oncue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}n.cue.text&&(n.cue.text+="\n"),n.cue.text+=i;continue;case"BADCUE":i||(n.state="ID");continue}}}catch(t){"CUETEXT"===n.state&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state="INITIAL"===n.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),(t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return t.onflush&&t.onflush(),this}},n.fixLineBreaks=u,n.default=i},{52:52}],54:[function(t,e,n){var i=t(53),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=function(t){var e=parseInt(t.substr(-3)),n=parseInt(t.substr(-6,2)),i=parseInt(t.substr(-9,2)),r=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;return isNaN(e)||isNaN(n)||isNaN(i)||isNaN(r)?-1:(e+=1e3*n,e+=6e4*i,e+=36e5*r)},s=function(t,e,n){var i=t[e],r=t[i.prevCC];if(!r||!r.new&&i.new)return t.ccOffset=t.presentationOffset=i.start,void(i.new=!1);for(;r&&r.new;)t.ccOffset+=i.start-r.start,i.new=!1,i=r,r=t[i.prevCC];t.presentationOffset=n},o={parse:function(t,e,n,i,o,u){var l=String.fromCharCode.apply(null,new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),c="00:00.000",h=0,f=0,d=0,g=[],m=void 0,p=!0,b=new r.default;b.oncue=function(t){var e=n[i],r=n.ccOffset;e&&e.new&&(f?r=n.ccOffset=e.start:s(n,i,d)),d&&!f&&(r=d+n.ccOffset-n.presentationOffset),t.startTime+=r-f,t.endTime+=r-f,t.text=decodeURIComponent(escape(t.text)),t.endTime>0&&g.push(t)},b.onparsingerror=function(t){m=t},b.onflush=function(){if(m&&u)return void u(m);o(g)},l.forEach(function(t){if(p){if(t.startsWith("X-TIMESTAMP-MAP=")){p=!1,t.substr(16).split(",").forEach(function(t){t.startsWith("LOCAL:")?c=t.substr(6):t.startsWith("MPEGTS:")&&(h=parseInt(t.substr(7)))});try{e=e<0?e+8589934592:e,h-=e,f=a(c)/1e3,d=h/9e4,-1===f&&(m=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(e){m=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(p=!1)}b.parse(t+"\n")}),b.flush()}};e.exports=o},{53:53}],55:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t(50),s=function(){function t(e){i(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return r(t,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(t,e,n){this.context=t,this.config=e,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var t,e=this.context;t="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest;var n=this.stats;n.tfirst=0,n.loaded=0;var i=this.xhrSetup;if(i)try{i(t,e.url)}catch(n){t.open("GET",e.url,!0),i(t,e.url)}t.readyState||t.open("GET",e.url,!0),e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()}},{key:"readystatechange",value:function(t){var e=t.currentTarget,n=e.readyState,i=this.stats,r=this.context,s=this.config;if(!i.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(performance.now(),i.trequest)),4===n){var o=e.status;if(o>=200&&o<300){i.tload=Math.max(i.tfirst,performance.now());var u=void 0,l=void 0;"arraybuffer"===r.responseType?(u=e.response,l=u.byteLength):(u=e.responseText,l=u.length),i.loaded=i.total=l;var c={url:e.responseURL,data:u};this.callbacks.onSuccess(c,i,r)}else i.retry>=s.maxRetry||o>=400&&o<499?(a.logger.error(o+" while loading "+r.url),this.callbacks.onError({code:o,text:e.statusText},r)):(a.logger.warn(o+" while loading "+r.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)}},{key:"loadtimeout",value:function(){a.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total);var n=this.callbacks.onProgress;n&&n(e,this.context,null)}}]),t}();n.default=s},{50:50}]},{},[37])(37)}),Class("paella.HLSPlayer",paella.Html5Video,{initialize:function(t,e,n,i,r,a){this.parent(t,e,n,i,r,a,"hls")},_loadDeps:function(){return new Promise(function(t,e){window.$paella_hls?t(window.$paella_hls):require(["resources/deps/hls.min.js"],function(e){window.$paella_hls=e,t(window.$paella_hls)})})},allowZoom:function(){return!0},load:function(){var t=this;if(base.userAgent.system.iOS)return this.parent();var e=this;return new Promise(function(n,i){var r=t._stream.sources.hls;r&&r.length>0?(r=r[0],t._loadDeps().then(function(t){t.isSupported()&&(e._hls=new t,e._hls.loadSource(r.src),e._hls.attachMedia(e.video),e._hls.on(t.Events.LEVEL_SWITCHED,function(t,n){e.qualityIndex=n.level,e.setQuality(n.level)}),e._hls.on(t.Events.ERROR,function(n,i){if(i.fatal)switch(i.type){case t.ErrorTypes.NETWORK_ERROR:base.log.error("paella.HLSPlayer: Fatal network error encountered, try to recover"),e._hls.startLoad();break;case t.ErrorTypes.MEDIA_ERROR:base.log.error("paella.HLSPlayer: Fatal media error encountered, try to recover"),e._hls.recoverMediaError();break;default:base.log.error("paella.HLSPlayer: Fatal Error. Can not recover"),e._hls.destroy()}}),e._hls.on(t.Events.MANIFEST_PARSED,function(){e._deferredAction(function(){n()})}))})):i(new Error("Invalid source"))})},supportAutoplay:function(){return!0},getQualities:function(){var t=this;if(base.userAgent.system.iOS)return new Promise(function(t,e){t([{index:0,res:"",src:"",toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(t){return 0}}])});var e=this;return new Promise(function(n){t._qualities||(e._qualities=[],e._hls.levels.forEach(function(t,n){e._qualities.push(e._getQualityObject(n,{index:n,res:{w:t.width,h:t.height},bitrate:t.bitrate}))})),n(e._qualities)})},printQualityes:function(){var t=this;return new Promise(function(e,n){t.getCurrentQuality().then(function(e){return t.getNextQuality()}).then(function(t){e()})})},setQuality:function(t){return base.userAgent.system.iOS?Promise.resolve():(this.qualityIndex=t,this._hls.nextLevel=t,new Promise(function(t,e){t()}))},getNextQuality:function(){var t=this;return new Promise(function(e,n){var i=t._hls.nextLevel;e(t._qualities[i])})},getCurrentQuality:function(){var t=this;return base.userAgent.system.iOS?Promise.resolve(0):(this.getNextQuality(),new Promise(function(e,n){var i=void 0==t.qualityIndex?t._hls.currentLevel:t.qualityIndex;e(t._qualities[i])}))}}),Class("paella.videoFactories.HLSVideoFactory",{isStreamCompatible:function(t){try{if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS&&paella.utils.userAgent.system.Version.major<=10&&paella.utils.userAgent.system.Version.minor<3)return!1;for(var e in t.sources)if("hls"==e)return!0}catch(t){}return!1},getVideoObject:function(t,e,n){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.HLSPlayer(t,e,n.x,n.y,n.w,n.h)}}),Class("paella.LiveStreamIndicator",paella.VideoOverlayButtonPlugin,{isEditorVisible:function(){return null!=paella.editor.instance},getIndex:function(){return 10},getSubclass:function(){return"liveIndicator"},getAlignment:function(){return"right"},getDefaultToolTip:function(){return base.dictionary.translate("This video is a live stream")},checkEnabled:function(t){t(paella.player.isLiveStream())},setup:function(){},action:function(t){paella.messageBox.showMessage(base.dictionary.translate("Live streaming mode: This is a live video, so, some capabilities of the player are disabled"))},getName:function(){return"es.upv.paella.liveStreamingIndicatorPlugin"}}),paella.plugins.liveStreamIndicator=new paella.LiveStreamIndicator,function t(e,n,i){function r(s,o){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return r(n||t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){var i={};i.encode=function(t){for(var e=[],n=0;n<t.length;++n){var i=t.charCodeAt(n);i<128?e.push(i):i<2048?(e.push(192|i>>6),e.push(128|63&i)):i<65536?(e.push(224|i>>12),e.push(128|63&i>>6),e.push(128|63&i)):(e.push(240|i>>18),e.push(128|63&i>>12),e.push(128|63&i>>6),e.push(128|63&i))}return e},i.decode=function(t){for(var e=[],n=0;n<t.length;){var i=t[n++];i<128||(i<224?(i=(31&i)<<6,i|=63&t[n++]):i<240?(i=(15&i)<<12,i|=(63&t[n++])<<6,i|=63&t[n++]):(i=(7&i)<<18,i|=(63&t[n++])<<12,i|=(63&t[n++])<<6,i|=63&t[n++])),e.push(String.fromCharCode(i))}return e.join("")};var r={};!function(t){var e=function(e){for(var n=0,i=[],r=0|e.length/3;0<r--;){var a=(e[n]<<16)+(e[n+1]<<8)+e[n+2];n+=3,i.push(t.charAt(63&a>>18)),i.push(t.charAt(63&a>>12)),i.push(t.charAt(63&a>>6)),i.push(t.charAt(63&a))}if(2==e.length-n){var a=(e[n]<<16)+(e[n+1]<<8);i.push(t.charAt(63&a>>18)),i.push(t.charAt(63&a>>12)),i.push(t.charAt(63&a>>6)),i.push("=")}else if(1==e.length-n){var a=e[n]<<16;i.push(t.charAt(63&a>>18)),i.push(t.charAt(63&a>>12)),i.push("==")}return i.join("")},n=function(){for(var e=[],n=0;n<t.length;++n)e[t.charCodeAt(n)]=n;return e["=".charCodeAt(0)]=0,e}(),o=function(t){for(var e=0,i=[],r=0|t.length/4;0<r--;){var a=(n[t.charCodeAt(e)]<<18)+(n[t.charCodeAt(e+1)]<<12)+(n[t.charCodeAt(e+2)]<<6)+n[t.charCodeAt(e+3)];i.push(255&a>>16),i.push(255&a>>8),i.push(255&a),e+=4}return i&&("="==t.charAt(e-2)?(i.pop(),i.pop()):"="==t.charAt(e-1)&&i.pop()),i},u={};u.encode=function(t){for(var e=[],n=0;n<t.length;++n)e.push(t.charCodeAt(n));return e},u.decode=function(t){for(var e=0;e<s.length;++e)a[e]=String.fromCharCode(a[e]);return a.join("")},r.decodeArray=function(t){var e=o(t);return new Uint8Array(e)},r.encodeASCII=function(t){var n=u.encode(t);return e(n)},r.decodeASCII=function(t){var e=o(t);return u.decode(e)},r.encode=function(t){var n=i.encode(t);return e(n)},r.decode=function(t){var e=o(t);return i.decode(e)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),void 0!==n&&(n.decode=r.decode,n.decodeArray=r.decodeArray)},{}],2:[function(t,e,n){!function(t){var e={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n=function(t){var n=t;return e.hasOwnProperty(t)&&(n=e[t]),String.fromCharCode(n)},i=15,r=32,a={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},s={17:2,18:4,21:6,22:8,23:10,19:13,20:15},o={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},u={25:2,26:4,29:6,30:8,31:10,27:13,28:15},l=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],c={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){var n=this.verboseFilter[t];this.verboseLevel>=n&&console.log(this.time+" ["+t+"] "+e)}},h=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].toString(16));return e},f=function(t,e,n,i,r){this.foreground=t||"white",this.underline=e||!1,this.italics=n||!1,this.background=i||"black",this.flash=r||!1};f.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(t){for(var e=["foreground","underline","italics","background","flash"],n=0;n<e.length;n++){var i=e[n];t.hasOwnProperty(i)&&(this[i]=t[i])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},copy:function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var d=function(t,e,n,i,r,a){this.uchar=t||" ",this.penState=new f(e,n,i,r,a)};d.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(t,e){this.uchar=t,this.penState.copy(e)},setPenState:function(t){this.penState.copy(t)},equals:function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},copy:function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var g=function(){this.chars=[];for(var t=0;t<r;t++)this.chars.push(new d);this.pos=0,this.currPenState=new f};g.prototype={equals:function(t){for(var e=!0,n=0;n<r;n++)if(!this.chars[n].equals(t.chars[n])){e=!1;break}return e},copy:function(t){for(var e=0;e<r;e++)this.chars[e].copy(t.chars[e])},isEmpty:function(){for(var t=!0,e=0;e<r;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},setCursor:function(t){this.pos!==t&&(this.pos=t),this.pos<0?(c.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>r&&(c.log("ERROR","Too large cursor position "+this.pos),this.pos=r)},moveCursor:function(t){var e=this.pos+t;if(t>1)for(var n=this.pos+1;n<e+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(e)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(t){t>=144&&this.backSpace();var e=n(t);return this.pos>=r?void c.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),void this.moveCursor(1))},clearFromPos:function(t){var e;for(e=t;e<r;e++)this.chars[e].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var t=[],e=!0,n=0;n<r;n++){var i=this.chars[n].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")},setPenStyles:function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}};var m=function(){this.rows=[];for(var t=0;t<i;t++)this.rows.push(new g);this.currRow=14,this.nrRollUpRows=null,this.reset()};m.prototype={reset:function(){for(var t=0;t<i;t++)this.rows[t].clear();this.currRow=14},equals:function(t){for(var e=!0,n=0;n<i;n++)if(!this.rows[n].equals(t.rows[n])){e=!1;break}return e},copy:function(t){for(var e=0;e<i;e++)this.rows[e].copy(t.rows[e])},isEmpty:function(){for(var t=!0,e=0;e<i;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(t){this.rows[this.currRow].insertChar(t)},setPen:function(t){this.rows[this.currRow].setPenStyles(t)},moveCursor:function(t){this.rows[this.currRow].moveCursor(t)},setCursor:function(t){c.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},setPAC:function(t){c.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.currRow=e;var n=this.rows[this.currRow];if(null!==t.indent){var i=t.indent,r=Math.max(i-1,0);n.setCursor(t.indent),t.color=n.chars[r].penState.foreground}var a={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(a)},setBkgData:function(t){c.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},setRollUpRows:function(t){this.nrRollUpRows=t},rollUp:function(){if(null===this.nrRollUpRows)return void c.log("DEBUG","roll_up but nrRollUpRows not set yet");c.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),c.log("INFO","Rolling up")},getDisplayText:function(t){t=t||!1;for(var e=[],n="",r=-1,a=0;a<i;a++){var s=this.rows[a].getTextString();s&&(r=a+1,t?e.push("Row "+r+': "'+s+'"'):e.push(s.trim()))}return e.length>0&&(n=t?"["+e.join(" | ")+"]":e.join("\n")),n},getTextAndFormat:function(){return this.rows}};var p=function(t,e){this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new m,this.nonDisplayedMemory=new m,this.lastOutputScreen=new m,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};p.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(t){this.outputFilter=t},setPAC:function(t){this.writeScreen.setPAC(t)},setBkgData:function(t){this.writeScreen.setBkgData(t)},setMode:function(t){t!==this.mode&&(this.mode=t,c.log("INFO","MODE="+t),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},insertChars:function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";c.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(c.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){c.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){c.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){c.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(t){c.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},cc_FON:function(){c.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){c.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){c.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){c.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){c.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){c.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){c.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(c.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,c.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(t){c.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},cc_MIDROW:function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var n=Math.floor(t/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=i[n]}c.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},outputDataUpdate:function(){var t=c.time;null!==t&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(t,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}};var b=function(t,e,n){this.field=t||1,this.outputs=[e,n],this.channels=[new p(1,e),new p(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};b.prototype={getHandler:function(t){return this.channels[t].getHandler()},setHandler:function(t,e){this.channels[t].setHandler(e)},addData:function(t,e){var n,i,r,a=!1;this.lastTime=t,c.setTime(t);for(var s=0;s<e.length;s+=2)if(i=127&e[s],r=127&e[s+1],0!==i||0!==r){if(c.log("DATA","["+h([e[s],e[s+1]])+"] -> ("+h([i,r])+")"),n=this.parseCmd(i,r),n||(n=this.parseMidrow(i,r)),n||(n=this.parsePAC(i,r)),n||(n=this.parseBackgroundAttributes(i,r)),!n&&(a=this.parseChars(i,r)))if(this.currChNr&&this.currChNr>=0){var o=this.channels[this.currChNr-1];o.insertChars(a)}else c.log("WARNING","No channel found yet. TEXT-MODE?");n?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,c.log("WARNING","Couldn't parse cleaned data "+h([i,r])+" orig: "+h([e[s],e[s+1]])))}else this.dataCounters.padding+=2},parseCmd:function(t,e){var n=null,i=(20===t||28===t)&&32<=e&&e<=47,r=(23===t||31===t)&&33<=e&&e<=35;if(!i&&!r)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,c.log("DEBUG","Repeated command ("+h([t,e])+") is dropped"),!0;n=20===t||23===t?1:2;var a=this.channels[n-1];return 20===t||28===t?32===e?a.cc_RCL():33===e?a.cc_BS():34===e?a.cc_AOF():35===e?a.cc_AON():36===e?a.cc_DER():37===e?a.cc_RU(2):38===e?a.cc_RU(3):39===e?a.cc_RU(4):40===e?a.cc_FON():41===e?a.cc_RDC():42===e?a.cc_TR():43===e?a.cc_RTD():44===e?a.cc_EDM():45===e?a.cc_CR():46===e?a.cc_ENM():47===e&&a.cc_EOC():a.cc_TO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=n,!0},parseMidrow:function(t,e){var n=null;if((17===t||25===t)&&32<=e&&e<=47){if((n=17===t?1:2)!==this.currChNr)return c.log("ERROR","Mismatch channel in midrow parsing"),!1;return this.channels[n-1].cc_MIDROW(e),c.log("DEBUG","MIDROW ("+h([t,e])+")"),!0}return!1},parsePAC:function(t,e){var n=null,i=null,r=(17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127,l=(16===t||24===t)&&64<=e&&e<=95;if(!r&&!l)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;n=t<=23?1:2,i=64<=e&&e<=95?1===n?a[t]:o[t]:1===n?s[t]:u[t];var c=this.interpretPAC(i,e);return this.channels[n-1].setPAC(c),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=n,!0},interpretPAC:function(t,e){var n=e,i={color:null,italics:!1,indent:null,underline:!1,row:t};return n=e>95?e-96:e-64,i.underline=1==(1&n),n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i},parseChars:function(t,e){var i=null,r=null,a=null;if(t>=25?(i=2,a=t-8):(i=1,a=t),17<=a&&a<=19){var s=e;s=17===a?e+80:18===a?e+112:e+144,c.log("INFO","Special char '"+n(s)+"' in channel "+i),r=[s]}else 32<=t&&t<=127&&(r=0===e?[t]:[t,e]);if(r){var o=h(r);c.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r},parseBackgroundAttributes:function(t,e){var n,i,r,a,s=(16===t||24===t)&&32<=e&&e<=47,o=(23===t||31===t)&&45<=e&&e<=47;return!(!s&&!o||(n={},16===t||24===t?(i=Math.floor((e-32)/2),n.background=l[i],e%2==1&&(n.background=n.background+"_semi")):45===e?n.background="transparent":(n.foreground="black",47===e&&(n.underline=!0)),r=t<24?1:2,a=this.channels[r-1],a.setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,0))},reset:function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)}};var _=function(t,e,n){for(var i=0,r=e,a=[];r<e+n;){if(i=t.getUint32(r),6===(31&t.getUint8(r+4)))for(var s=r+5,o=-1;s<r+4+i-1;){o=0;for(var u=255;255===u;)u=t.getUint8(s),o+=u,s++;var l=0;for(u=255;255===u;)u=t.getUint8(s),l+=u,s++;(function(t,e,n,i){if(4!==t||e<8)return null;var r=n.getUint8(i),a=n.getUint16(i+1),s=n.getUint32(i+3),o=n.getUint8(i+7);return 181==r&&49==a&&1195456820==s&&3==o})(o,l,t,s)&&a.push([s,l]),s+=l}r+=i+4}return a},v=function(t,e){var n=e[0],i=[[],[]];n+=8;var r=31&t.getUint8(n);n+=2;for(var a=0;a<r;a++){var s=t.getUint8(n),o=4&s,u=3&s;n++;var l=t.getUint8(n);n++;var c=t.getUint8(n);n++,o&&(127&l)+(127&c)!=0&&(0===u?(i[0].push(l),i[0].push(c)):1===u&&(i[1].push(l),i[1].push(c)))}return i};t.logger=c,t.PenState=f,t.CaptionScreen=m,t.Cea608Parser=b,t.findCea608Nalus=_,t.extractCea608DataFromRange=v}(void 0===n?(void 0).cea608parser={}:n)},{}],3:[function(t,e,n){function i(t){var e,n,i;for(e=[],i=0,n=t.length;i<n;i+=1)t[i].isRoot?e.push("root"):e.push(t[i].name);var r=function(t,e){var n;if(null!==t&&null!==e)for(n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)||(e[n]=t[n]))},a=function(t,e,n){var i,a,s,o,u;if(null!==t&&0!==t.length)for(i=0,a=t.length;i<a;i+=1)s=t[i],e.hasOwnProperty(s.name)&&(n.hasOwnProperty(s.name)?s.merge&&(o=e[s.name],u=n[s.name],"object"==(void 0===o?"undefined":$traceurRuntime.typeof(o))&&"object"==(void 0===u?"undefined":$traceurRuntime.typeof(u))?r(o,u):null!=s.mergeFunction?n[s.name]=s.mergeFunction(o,u):n[s.name]=o+u):n[s.name]=e[s.name])},s=function t(e,n){var i,r,s,o,u,l,c,h=e;if(null!==h.children&&0!==h.children.length)for(i=0,r=h.children.length;i<r;i+=1)if(l=h.children[i],n.hasOwnProperty(l.name))if(l.isArray)for(u=n[l.name+"_asArray"],s=0,o=u.length;s<o;s+=1)c=u[s],a(h.properties,n,c),t(l,c);else c=n[l.name],a(h.properties,n,c),t(l,c)};return{run:function n(i){var r,a,o,u,l,c,h;if(null===i)return i;if("object"!=(void 0===i?"undefined":$traceurRuntime.typeof(i)))return i;for(r=0,a=e.length;r<a;r+=1)"root"===e[r]&&(l=t[r],c=i,s(l,c));for(u in i)if(i.hasOwnProperty(u)&&"__children"!=u){if(-1!==(o=e.indexOf(u)))if(l=t[o],l.isArray)for(h=i[u+"_asArray"],r=0,a=h.length;r<a;r+=1)c=h[r],s(l,c);else c=i[u],s(l,c);n(i[u])}return i}}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=i,e.exports=n.default},{}],4:[function(t,e,n){function i(t,e,n){function i(t){var e=t.localName;return null==e&&(e=t.baseName),null!=e&&""!=e||(e=t.nodeName),e}function r(t){return t.prefix}function a(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):t}function s(t){return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function o(a){if(a.nodeType==v.DOCUMENT_NODE){var u,l,c,h=a.firstChild;for(l=0,c=a.childNodes.length;l<c;l+=1)if(a.childNodes[l].nodeType!==v.COMMENT_NODE){h=a.childNodes[l];break}if(n)u=o(h);else{u={};var f=i(h);u[f]=o(h)}return u}if(a.nodeType==v.ELEMENT_NODE){var u=new Object;u.__cnt=0;for(var d=[],g=a.childNodes,m=0;m<g.length;m++){var h=g.item(m),f=i(h);if(u.__cnt++,null==u[f]){var p=o(h);if("#text"!=f||/[^\s]/.test(p)){var b={};b[f]=p,d.push(b)}u[f]=p,u[f+"_asArray"]=new Array(1),u[f+"_asArray"][0]=u[f]}else{if(null!=u[f]&&!(u[f]instanceof Array)){var y=u[f];u[f]=new Array,u[f][0]=y,u[f+"_asArray"]=u[f]}for(var E=0;null!=u[f][E];)E++;var p=o(h);if("#text"!=f||/[^\s]/.test(p)){var b={};b[f]=p,d.push(b)}u[f][E]=p}}u.__children=d;for(var T=0;T<a.attributes.length;T++){var x=a.attributes.item(T);u.__cnt++;for(var S=x.value,w=0,M=t.length;w<M;w++){var C=t[w];C.test(x)&&(S=C.converter(x.value))}u[e+x.name]=S}var R=r(a);return null!=R&&""!=R&&(u.__cnt++,u.__prefix=R),
1==u.__cnt&&null!=u["#text"]&&(u=u["#text"]),null!=u["#text"]&&(u.__text=u["#text"],_&&(u.__text=s(u.__text)),delete u["#text"],delete u["#text_asArray"]),null!=u["#cdata-section"]&&(u.__cdata=u["#cdata-section"],delete u["#cdata-section"],delete u["#cdata-section_asArray"]),null==u.__text&&null==u.__cdata||(u.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),u}return a.nodeType==v.TEXT_NODE||a.nodeType==v.CDATA_SECTION_NODE?a.nodeValue:a.nodeType==v.COMMENT_NODE?null:void 0}function u(t,e,n,i){var r="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+e;if(null!=n)for(var a=0;a<n.length;a++){var s=n[a],o=t[s];r+=" "+s.substr(1)+"='"+o+"'"}return r+=i?"/>":">"}function l(t,e){return"</"+(null!=t.__prefix?t.__prefix+":":"")+e+">"}function c(t,e){return-1!==t.indexOf(e,t.length-e.length)}function h(t,e){return!!(c(e.toString(),"_asArray")||0==e.toString().indexOf("_")||t[e]instanceof Function)}function f(t){var e=0;if(t instanceof Object)for(var n in t)h(t,n)||e++;return e}function d(t){var e=[];if(t instanceof Object)for(var n in t)-1==n.toString().indexOf("__")&&0==n.toString().indexOf("_")&&e.push(n);return e}function g(t){var e="";return null!=t.__cdata&&(e+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e+=_?a(t.__text):t.__text),e}function m(t){var e="";return t instanceof Object?e+=g(t):null!=t&&(e+=_?a(t):t),e}function p(t,e,n){var i="";if(0==t.length)i+=u(t,e,n,!0);else for(var r=0;r<t.length;r++)i+=u(t[r],e,d(t[r]),!1),i+=b(t[r]),i+=l(t[r],e);return i}function b(t){var e="";if(f(t)>0)for(var n in t)if(!h(t,n)){var i=t[n],r=d(i);if(null==i||void 0==i)e+=u(i,n,r,!0);else if(i instanceof Object)if(i instanceof Array)e+=p(i,n,r);else{var a=f(i);a>0||null!=i.__text||null!=i.__cdata?(e+=u(i,n,r,!1),e+=b(i),e+=l(i,n)):e+=u(i,n,r,!0)}else e+=u(i,n,r,!1),e+=m(i),e+=l(i,n)}return e+=m(t)}null!==e&&void 0!==e||(e="_"),null!==n&&void 0!==n||(n=!1);var _=!1,v={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(t){var e,n,i;if(window.DOMParser){n=new window.DOMParser;try{i=n.parseFromString("<","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(t){}try{e=n.parseFromString(t,"text/xml"),i&&e.getElementsByTagNameNS(i,"parsererror").length&&(e=void 0)}catch(t){}}else 0==t.indexOf("<?")&&(t=t.substr(t.indexOf("?>")+2)),e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t);return e},this.xml2json=function(t){return o(t)},this.xml_str2json=function(t){var e=this.parseXmlString(t);return e?this.xml2json(e):void 0},this.json2xml_str=function(t){return b(t)},this.json2xml=function(t){var e=this.json2xml_str(t);return this.parseXmlString(e)},this.getVersion=function(){return"1.0.11"},this.escapeMode=function(t){_=t}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=i,e.exports=n.default},{}],5:[function(t,e,n){(function(e){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(51),a=i(r),s=t(106),o=i(s),u=t(75),l=i(u),c=t(53),h=i(c),f=t(11),d=window||e,g=d.dashjs;g||(g=d.dashjs={}),g.MediaPlayer=a.default,g.Protection=o.default,g.MetricsReporting=l.default,g.MediaPlayerFactory=h.default,g.Version=(0,f.getVersionString)(),n.default=g,n.MediaPlayer=a.default,n.Protection=o.default,n.MetricsReporting=l.default,n.MediaPlayerFactory=h.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{106:106,11:11,51:51,53:53,75:75}],6:[function(t,e,n){var i={};i.parseBuffer=function(t){return new r(t).parse()},i.Utils={},i.Utils.dataViewToString=function(t,e){var n=e||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(n).decode(t);var i=[],r=0;if("utf-8"===n)for(;r<t.byteLength;){var a=t.getUint8(r++);a<128||(a<224?(a=(31&a)<<6,a|=63&t.getUint8(r++)):a<240?(a=(15&a)<<12,a|=(63&t.getUint8(r++))<<6,a|=63&t.getUint8(r++)):(a=(7&a)<<18,a|=(63&t.getUint8(r++))<<12,a|=(63&t.getUint8(r++))<<6,a|=63&t.getUint8(r++))),i.push(String.fromCharCode(a))}else for(;r<t.byteLength;)i.push(String.fromCharCode(t.getUint8(r++)));return i.join("")},void 0!==n&&(n.parseBuffer=i.parseBuffer,n.Utils=i.Utils),i.Cursor=function(t){this.offset=void 0===t?0:t};var r=function(t){this._raw=new DataView(t),this._cursor=new i.Cursor,this.boxes=[]};r.prototype.fetch=function(t){var e=this.fetchAll(t,!0);return e.length?e[0]:null},r.prototype.fetchAll=function(t,e){var n=[];return r._sweep.call(this,t,n,e),n},r.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var t=a.parse(this);if(void 0===t.type)break;this.boxes.push(t)}return this},r._sweep=function(t,e,n){this.type&&this.type==t&&e.push(this);for(var i in this.boxes){if(e.length&&n)return;r._sweep.call(this.boxes[i],t,e,n)}};var a=function(){this._cursor=new i.Cursor};a.parse=function(t){var e=new a;return e._offset=t._cursor.offset,e._root=t._root?t._root:t,e._raw=t._raw,e._parent=t,e._parseBox(),t._cursor.offset=e._raw.byteOffset+e._raw.byteLength,e},a.prototype._readInt=function(t){var e=null;switch(t){case 8:e=this._raw.getInt8(this._cursor.offset-this._raw.byteOffset);break;case 16:e=this._raw.getInt16(this._cursor.offset-this._raw.byteOffset);break;case 32:e=this._raw.getInt32(this._cursor.offset-this._raw.byteOffset);break;case 64:var n=this._raw.getInt32(this._cursor.offset-this._raw.byteOffset),i=this._raw.getInt32(this._cursor.offset-this._raw.byteOffset+4);e=n*Math.pow(2,32)+i}return this._cursor.offset+=t>>3,e},a.prototype._readUint=function(t){var e=null;switch(t){case 8:e=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset);break;case 16:e=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset);break;case 24:var n=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset),i=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset+2);e=(n<<8)+i;break;case 32:e=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset);break;case 64:var n=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset),i=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset+4);e=n*Math.pow(2,32)+i}return this._cursor.offset+=t>>3,e},a.prototype._readString=function(t){for(var e="",n=0;n<t;n++){var i=this._readUint(8);e+=String.fromCharCode(i)}return e},a.prototype._readTerminatedString=function(){for(var t="";;){var e=this._readUint(8);if(0==e)break;t+=String.fromCharCode(e)}return t},a.prototype._readTemplate=function(t){return this._readUint(t/2)+this._readUint(t/2)/Math.pow(2,t/2)},a.prototype._parseBox=function(){if(this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)return void(this._root._incomplete=!0);switch(this.size=this._readUint(32),this.type=this._readString(4),1==this.size&&(this.largesize=this._readUint(64)),"uuid"==this.type&&(this.usertype=this._readString(16)),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}!this._incomplete&&this._boxParsers[this.type]&&this._boxParsers[this.type].call(this)},a.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},a.prototype._boxParsers={},["moov","trak","tref","mdia","minf","stbl","edts","dinf","mvex","moof","traf","mfra","udta","meco","strk","vttc"].forEach(function(t){a.prototype._boxParsers[t]=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(a.parse(this))}}),a.prototype._boxParsers.elst=function(){this._parseFullBox(),this.entry_count=this._readUint(32),this.entries=[];for(var t=1;t<=this.entry_count;t++){var e={};1==this.version?(e.segment_duration=this._readUint(64),e.media_time=this._readInt(64)):(e.segment_duration=this._readUint(32),e.media_time=this._readInt(32)),e.media_rate_integer=this._readInt(16),e.media_rate_fraction=this._readInt(16),this.entries.push(e)}},a.prototype._boxParsers.emsg=function(){this._parseFullBox(),this.scheme_id_uri=this._readTerminatedString(),this.value=this._readTerminatedString(),this.timescale=this._readUint(32),this.presentation_time_delta=this._readUint(32),this.event_duration=this._readUint(32),this.id=this._readUint(32),this.message_data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},a.prototype._boxParsers.free=a.prototype._boxParsers.skip=function(){this.data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},a.prototype._boxParsers.ftyp=a.prototype._boxParsers.styp=function(){for(this.major_brand=this._readString(4),this.minor_versions=this._readUint(32),this.compatible_brands=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.compatible_brands.push(this._readString(4))},a.prototype._boxParsers.hdlr=function(){this._parseFullBox(),this.pre_defined=this._readUint(32),this.handler_type=this._readString(4),this.reserved=[this._readUint(32),this._readUint(32),this._readUint(32)],this.name=this._readTerminatedString()},a.prototype._boxParsers.mdat=function(){this.data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},a.prototype._boxParsers.mdhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32));var t=this._readUint(16);this.pad=t>>15,this.language=String.fromCharCode(96+(t>>10&31),96+(t>>5&31),96+(31&t)),this.pre_defined=this._readUint(16)},a.prototype._boxParsers.mfhd=function(){this._parseFullBox(),this.sequence_number=this._readUint(32)},a.prototype._boxParsers.mvhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32)),this.rate=this._readTemplate(32),this.volume=this._readTemplate(16),this.reserved1=this._readUint(16),this.reserved2=[this._readUint(32),this._readUint(32)],this.matrix=[];for(var t=0;t<9;t++)this.matrix.push(this._readTemplate(32));this.pre_defined=[];for(var t=0;t<6;t++)this.pre_defined.push(this._readUint(32));this.next_track_ID=this._readUint(32)},a.prototype._boxParsers.payl=function(){var t=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset));this.cue_text=i.Utils.dataViewToString(t)},a.prototype._boxParsers.sidx=function(){this._parseFullBox(),this.reference_ID=this._readUint(32),this.timescale=this._readUint(32),0==this.version?(this.earliest_presentation_time=this._readUint(32),this.first_offset=this._readUint(32)):(this.earliest_presentation_time=this._readUint(64),this.first_offset=this._readUint(64)),this.reserved=this._readUint(16),this.reference_count=this._readUint(16),this.references=[];for(var t=0;t<this.reference_count;t++){var e={},n=this._readUint(32);e.reference_type=n>>31&1,e.referenced_size=2147483647&n,e.subsegment_duration=this._readUint(32);var i=this._readUint(32);e.starts_with_SAP=i>>31&1,e.SAP_type=i>>28&7,e.SAP_delta_time=268435455&i,this.references.push(e)}},a.prototype._boxParsers.ssix=function(){this._parseFullBox(),this.subsegment_count=this._readUint(32),this.subsegments=[];for(var t=0;t<this.subsegment_count;t++){var e={};e.ranges_count=this._readUint(32),e.ranges=[];for(var n=0;n<e.ranges_count;n++){var i={};i.level=this._readUint(8),i.range_size=this._readUint(24),e.ranges.push(i)}this.subsegments.push(e)}},a.prototype._boxParsers.tfdt=function(){this._parseFullBox(),1==this.version?this.baseMediaDecodeTime=this._readUint(64):this.baseMediaDecodeTime=this._readUint(32)},a.prototype._boxParsers.tfhd=function(){this._parseFullBox(),this.track_ID=this._readUint(32),1&this.flags&&(this.base_data_offset=this._readUint(64)),2&this.flags&&(this.sample_description_offset=this._readUint(32)),8&this.flags&&(this.default_sample_duration=this._readUint(32)),16&this.flags&&(this.default_sample_size=this._readUint(32)),32&this.flags&&(this.default_sample_flags=this._readUint(32))},a.prototype._boxParsers.tkhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(32)),this.reserved2=[this._readUint(32),this._readUint(32)],this.layer=this._readUint(16),this.alternate_group=this._readUint(16),this.volume=this._readTemplate(16),this.reserved3=this._readUint(16),this.matrix=[];for(var t=0;t<9;t++)this.matrix.push(this._readTemplate(32));this.width=this._readUint(32),this.height=this._readUint(32)},a.prototype._boxParsers.trun=function(){this._parseFullBox(),this.sample_count=this._readUint(32),1&this.flags&&(this.data_offset=this._readInt(32)),4&this.flags&&(this.first_sample_flags=this._readUint(32)),this.samples=[];for(var t=0;t<this.sample_count;t++){var e={};256&this.flags&&(e.sample_duration=this._readUint(32)),512&this.flags&&(e.sample_size=this._readUint(32)),1024&this.flags&&(e.sample_flags=this._readUint(32)),2048&this.flags&&(0==this.version?e.sample_composition_time_offset=this._readUint(32):e.sample_composition_time_offset=this._readInt(32)),this.samples.push(e)}},a.prototype._boxParsers.vlab=function(){var t=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset));this.source_label=i.Utils.dataViewToString(t)},a.prototype._boxParsers.vttC=function(){var t=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset));this.config=i.Utils.dataViewToString(t)},a.prototype._boxParsers.vtte=function(){}},{}],7:[function(t,e,n){var i=n.decimalAdjust=function(t,e,n){return void 0===n||0==+n?Math[t](e):(e=+e,n=+n,isNaN(e)||"number"!=typeof n||n%1!=0?NaN:(e=e.toString().split("e"),e=Math[t](+(e[0]+"e"+(e[1]?+e[1]-n:-n))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+n:n))))};e.exports={round10:function(t,e){return i("round",t,e)},floor10:function(t,e){return i("floor",t,e)},ceil10:function(t,e){return i("ceil",t,e)}},e.exports.polyfill=function(){Math.round10||(Math.round10=e.exports.round10),Math.floor10||(Math.floor10=e.exports.floor10),Math.ceil10||(Math.ceil10=e.exports.ceil10)}},{}],8:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){c=t}function e(t){l=t}function n(){return l}function i(){var t="",e=null;c&&(e=(new Date).getTime(),t+="["+(e-h)+"]"),t.length>0&&(t+=" "),Array.apply(null,arguments).forEach(function(e){t+=e+" "}),l&&console.log(t),a.trigger(u.default.LOG,{message:t})}var r=this.context,a=(0,s.default)(r).getInstance(),o=void 0,l=void 0,c=void 0,h=void 0;return o={log:i,setLogTimestampVisible:t,setLogToBrowserConsole:e,getLogToBrowserConsole:n},function(){l=!0,c=!0,h=(new Date).getTime()}(),o}Object.defineProperty(n,"__esModule",{value:!0});var a=t(9),s=i(a),o=t(13),u=i(o),l=t(10),c=i(l);r.__dashjs_factory_name="Debug",n.default=c.default.getSingletonFactory(r),e.exports=n.default},{10:10,13:13,9:9}],9:[function(t,e,n){function i(){function t(t,e,n){var r=arguments.length<=3||void 0===arguments[3]?s:arguments[3];if(!t)throw new Error("event type cannot be null or undefined");if(!e||"function"!=typeof e)throw new Error("listener must be a function: "+e);if(!(i(t,e,n)>=0)){a[t]=a[t]||[];var o={callback:e,scope:n,priority:r};a[t].some(function(e,n){if(r>e.priority)return a[t].splice(n,0,o),!0})||a[t].push(o)}}function e(t,e,n){if(t&&e&&a[t]){var r=i(t,e,n);r<0||a[t].splice(r,1)}}function n(t,e){if(t&&a[t]){if(e=e||{},e.hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");e.type=t,a[t].forEach(function(t){return t.callback.call(t.scope,e)})}}function i(t,e,n){var i=-1;return a[t]?(a[t].some(function(t,r){if(t.callback===e&&(!n||n===t.scope))return i=r,!0}),i):i}function r(){a={}}var a={};return{on:t,off:e,trigger:n,reset:r}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r),s=0;i.__dashjs_factory_name="EventBus";var o=a.default.getSingletonFactory(i);o.EVENT_PRIORITY_LOW=s,o.EVENT_PRIORITY_HIGH=5e3,n.default=o,e.exports=n.default},{10:10}],10:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e,n,i){var r=s(i);!r[t]&&e&&(r[t]={instance:e,override:n})}function e(t,e){for(var n in l){var i=l[n];if(i.context===t&&i.name===e)return i.instance}return null}function n(t,e,n){for(var i in l){var r=l[i];if(r.context===t&&r.name===e)return void(l[i].instance=n)}l.push({name:e,context:t,instance:n})}function i(t){return function(e){return void 0===e&&(e={}),{create:function(){return a(t.__dashjs_factory_name,t.apply({context:e},arguments),e,arguments)}}}}function r(t){return function(n){var i=void 0;return void 0===n&&(n={}),{getInstance:function(){return i||(i=e(n,t.__dashjs_factory_name)),i||(i=a(t.__dashjs_factory_name,t.apply({context:n},arguments),n,arguments),l.push({name:t.__dashjs_factory_name,context:n,instance:i})),i}}}}function a(t,e,n,i){var r=s(n),a=r[t];if(a){var u=a.instance;if(!a.override)return u.apply({context:n,factory:o},i);u=u.apply({context:n,factory:o,parent:e},i);for(var l in u)e.hasOwnProperty(l)&&(e[l]=u[l])}return e}function s(t){var e=void 0;return u.forEach(function(n){n===t&&(e=n)}),e||(e=u.push(t)),e}var o=void 0,u=[],l=[];return o={extend:t,getSingletonInstance:e,setSingletonInstance:n,getSingletonFactory:r,getClassFactory:i}}();n.default=i,e.exports=n.default},{}],11:[function(t,e,n){function i(){return r}Object.defineProperty(n,"__esModule",{value:!0}),n.getVersionString=i;var r="2.3.0"},{}],12:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(14),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=function(t){function e(){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.AST_IN_FUTURE="astinfuture",this.BUFFERING_COMPLETED="bufferingCompleted",this.BUFFER_CLEARED="bufferCleared",this.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",this.BYTES_APPENDED="bytesAppended",this.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",this.CHUNK_APPENDED="chunkAppended",this.CURRENT_TRACK_CHANGED="currenttrackchanged",this.DATA_UPDATE_COMPLETED="dataUpdateCompleted",this.DATA_UPDATE_STARTED="dataUpdateStarted",this.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",this.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",this.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",this.INITIALIZATION_LOADED="initializationLoaded",this.INIT_FRAGMENT_LOADED="initFragmentLoaded",this.INIT_REQUESTED="initRequested",this.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",this.LIVE_EDGE_SEARCH_COMPLETED="liveEdgeSearchCompleted",this.LOADING_COMPLETED="loadingCompleted",this.LOADING_PROGRESS="loadingProgress",this.MANIFEST_UPDATED="manifestUpdated",this.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",this.QUOTA_EXCEEDED="quotaExceeded",this.REPRESENTATION_UPDATED="representationUpdated",this.SEGMENTS_LOADED="segmentsLoaded",this.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",this.SOURCEBUFFER_APPEND_COMPLETED="sourceBufferAppendCompleted",this.SOURCEBUFFER_REMOVE_COMPLETED="sourceBufferRemoveCompleted",this.STREAMS_COMPOSED="streamsComposed",this.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",this.STREAM_COMPLETED="streamCompleted",this.STREAM_INITIALIZED="streaminitialized",this.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",this.TIMED_TEXT_REQUESTED="timedTextRequested",this.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",this.URL_RESOLUTION_FAILED="urlResolutionFailed",this.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",this.XLINK_ALL_ELEMENTS_LOADED="xlinkAllElementsLoaded",this.XLINK_ELEMENT_LOADED="xlinkElementLoaded",this.XLINK_READY="xlinkReady"}return r(e,t),e}(o.default);n.default=u,e.exports=n.default},{14:14}],13:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(12),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=function(t){function e(){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return r(e,t),e}(o.default),l=new u;n.default=l,e.exports=n.default},{12:12}],14:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(){i(this,t)}return r(t,[{key:"extend",value:function(t,e){if(t){var n=!!e&&e.override,i=!!e&&e.publicOnly;for(var r in t)!t.hasOwnProperty(r)||this[r]&&!n||i&&-1===t[r].indexOf("public_")||(this[r]=t[r])}}}]),t}();n.default=a,e.exports=n.default},{}],15:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){t&&t.dashManifestModel&&(P=t.dashManifestModel)}function e(){L=[],N={}}function n(t,e){return e.getRepresentationForQuality(t.quality)}function i(t){return N[t.streamInfo.id][t.index]}function r(t){for(var e=L.length,n=0;n<e;n++){var i=L[n];if(t.id===i.id)return i}return null}function a(t,e){var n=new s.default,i=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],r=P.getRepresentationFor(e.index,i);return n.id=e.id,n.quality=e.index,n.bandwidth=P.getBandwidth(r),n.DVRWindow=e.segmentAvailabilityRange,n.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),n.MSETimeOffset=e.MSETimeOffset,n.useCalculatedLiveEdgeTime=e.useCalculatedLiveEdgeTime,n.mediaInfo=o(t,e.adaptation),n}function o(t,e){var n,i=new u.default,r=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];return i.id=e.id,i.index=e.index,i.type=e.type,i.streamInfo=h(t,e.period),i.representationCount=P.getRepresentationCount(r),i.lang=P.getLanguageForAdaptation(r),n=P.getViewpointForAdaptation(r),i.viewpoint=n?n.value:void 0,i.accessibility=P.getAccessibilityForAdaptation(r).map(function(t){var e=t.value,n=e;return t.schemeIdUri&&t.schemeIdUri.search("cea-608")>=0&&void 0!==_.default&&(n=e?"cea-608:"+e:"cea-608",i.embeddedCaptions=!0),n}),i.audioChannelConfiguration=P.getAudioChannelConfigurationForAdaptation(r).map(function(t){return t.value}),i.roles=P.getRolesForAdaptation(r).map(function(t){return t.value}),i.codec=P.getCodec(r),i.mimeType=P.getMimeType(r),i.contentProtection=P.getContentProtectionData(r),i.bitrateList=P.getBitrateListForAdaptation(r),i.contentProtection&&i.contentProtection.forEach(function(t){t.KID=P.getKID(t)}),i.isText=P.getIsTextTrack(i.mimeType),i}function l(t,e,n){t.id=e,t.index=100+parseInt(e.substring(2,3)),t.type="embeddedText",t.codec="cea-608-in-SEI",t.isText=!0,t.isEmbedded=!0,t.lang=e+" "+n,t.roles=["caption"]}function h(t,e){var n=new c.default;return n.id=e.id,n.index=e.index,n.start=e.start,n.duration=e.duration,n.manifestInfo=d(t,e.mpd),n.isLast=1===t.Period_asArray.length||Math.abs(n.start+n.duration-n.manifestInfo.duration)<1,n.isFirst=1===t.Period_asArray.length||P.getRegularPeriods(t,P.getMpd(t))[0].id===e.id,n}function d(t,e){var n=new f.default;return n.DVRWindowSize=e.timeShiftBufferDepth,n.loadedTime=e.manifest.loadedTime,n.availableFrom=e.availabilityStartTime,n.minBufferTime=e.manifest.minBufferTime,n.maxFragmentDuration=e.maxSegmentDuration,n.duration=P.getDuration(t),n.isDynamic=P.getIsDynamic(t),n}function m(t,e,n){var i=P.getAdaptationForType(t,e.index,n,e);if(!i)return null;var a=r(e),s=a.id,u=P.getIndexForAdaptation(i,t,e.index);return N[s]=N[s]||P.getAdaptationsForPeriod(t,a),o(t,N[s][u])}function p(t,e,n){var i,a,s,u,c,h,f=r(e),d=f.id,g=P.getAdaptationsForType(t,e.index,"embeddedText"!==n?n:"video"),m=[];if(!g)return m;for(N[d]=N[d]||P.getAdaptationsForPeriod(t,f),u=0,h=g.length;u<h;u++){if(i=g[u],s=P.getIndexForAdaptation(i,t,e.index),a=o(t,N[d][s]),"embeddedText"===n){var p=a.accessibility.length;for(c=0;c<p;c++)if(a){var b=a.accessibility[c];if(0===b.indexOf("cea-608:")){var _=b.substring(8),v=_.split(";");if("CC"===v[0].substring(0,2))for(c=0;c<v.length;c++)a||(a=o.call(this,t,N[d][s])),l(a,v[c].substring(0,3),v[c].substring(4)),m.push(a),a=null;else for(c=0;c<v.length;c++)a||(a=o.call(this,t,N[d][s])),l(a,"CC"+(c+1),v[c]),m.push(a),a=null}else 0===b.indexOf("cea-608")&&(l(a,"CC1","eng"),m.push(a),a=null)}}a&&"embeddedText"!==n&&m.push(a)}return m}function b(t){var e,n,i,r=[];if(!t)return null;for(e=P.getMpd(t),L=P.getRegularPeriods(t,e),e.checkTime=P.getCheckTime(t,L[0]),N={},n=L.length,i=0;i<n;i++)r.push(h(t,L[i]));return r}function v(t){return d(t,P.getMpd(t))}function E(t,e){var n=t.getRepresentationController().getRepresentationForQuality(e);return t.getIndexHandler().getInitRequest(n)}function T(t,e){var i=n(e,t.getRepresentationController());return t.getIndexHandler().getNextSegmentRequest(i)}function x(t,e,i,r){var a=n(e,t.getRepresentationController());return t.getIndexHandler().getSegmentRequestForTime(a,i,r)}function S(t,e,i){var r=n(e,t.getRepresentationController());return t.getIndexHandler().generateSegmentRequestForTime(r,i)}function w(t){return t.getIndexHandler().getCurrentTime()}function M(t,e){return t.getIndexHandler().setCurrentTime(e)}function C(t,e){var n,a,s=r(e.getStreamInfo()),o=e.getMediaInfo(),u=i(o),l=e.getType();n=o.id,a=n?P.getAdaptationForId(n,t,s.index):P.getAdaptationForIndex(o.index,t,s.index),e.getRepresentationController().updateData(a,u,l)}function R(t,e,n){var i=e.getRepresentationForQuality(n);return i?a(t,i):null}function O(t,e){var n=e.getCurrentRepresentation();return n?a(t,n):null}function A(t,e,n){var i=new g.default,r=t.scheme_id_uri,a=t.value,s=t.timescale,o=t.presentation_time_delta,u=t.event_duration,l=t.id,c=t.message_data,h=n*s+o;return e[r]?(i.eventStream=e[r],i.eventStream.value=a,i.eventStream.timescale=s,i.duration=u,i.id=l,i.presentationTime=h,i.messageData=c,i.presentationTimeDelta=o,i):null}function j(t,e,a){var o=[];return e instanceof c.default?o=P.getEventsForPeriod(t,r(e)):e instanceof u.default?o=P.getEventStreamForAdaptationSet(t,i(e)):e instanceof s.default&&(o=P.getEventStreamForRepresentation(t,n(e,a.getRepresentationController()))),o}function I(){L=[],N={}}var P=void 0,L=void 0,N=void 0;return{initialize:e,convertDataToTrack:a,convertDataToMedia:o,convertDataToStream:h,getDataForTrack:n,getDataForMedia:i,getDataForStream:r,getStreamsInfo:b,getManifestInfo:v,getMediaInfoForType:m,getAllMediaInfoForType:p,getCurrentRepresentationInfo:O,getRepresentationInfoForQuality:R,updateData:C,getInitRequest:E,getNextFragmentRequest:T,getFragmentRequestForTime:x,generateFragmentRequestForTime:S,getIndexHandlerTime:w,setIndexHandlerTime:M,getEventsFor:j,getEvent:A,setConfig:t,reset:I,metricsList:y}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(172),s=i(a),o=t(167),u=i(o),l=t(169),c=i(l),h=t(166),f=i(h),d=t(41),g=i(d),m=t(10),p=i(m),b=t(2),_=i(b),v=t(20),y=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(v);r.__dashjs_factory_name="DashAdapter",n.default=p.default.getSingletonFactory(r),e.exports=n.default},{10:10,166:166,167:167,169:169,172:172,2:2,20:20,41:41}],16:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(e){Q=e,K=Q.getType(),X=Q.isDynamic(),Z=(0,T.default)(N).create(t,X)}function n(){return Q}function i(t){W=t}function r(){return W}function a(){return H}function o(){return Y}function c(){Z=null,W=0,Y=NaN,q=NaN,H=-1,X=null,K=null,Q=null,k.off(h.default.INITIALIZATION_LOADED,P,$),k.off(h.default.SEGMENTS_LOADED,L,$)}function f(t){return t.split("$$").join("$")}function g(t,e){if(null===e||-1===t.indexOf("$RepresentationID$"))return t;var n=e.toString();return t.split("$RepresentationID$").join(n)}function m(t,e,n){var i,r,a=G.resolve(n.path);return a&&e!==a.url&&F.isRelative(e)?(i=a.url,r=a.serviceLocation,e&&(i+=e)):i=e,!F.isRelative(i)&&(t.url=i,t.serviceLocation=r,!0)}function p(t,e){var n,i,r=new s.default;if(n=t.adaptation.period,r.mediaType=e,r.type=l.HTTPRequest.INIT_SEGMENT_TYPE,r.range=t.range,i=n.start,r.availabilityStartTime=B.calcAvailabilityStartTimeFromPresentationTime(i,t.adaptation.period.mpd,X),r.availabilityEndTime=B.calcAvailabilityEndTimeFromPresentationTime(i+n.duration,n.mpd,X),r.quality=t.index,r.mediaInfo=Q.getMediaInfo(),m(r,t.initialization,t))return r}function _(t){return t?p(t,K):null}function E(t){var e,n,i,r=t.adaptation.period,a=t.segmentInfoType,s=!1;return H<0?s=!1:X||H<t.availableSegmentsNumber?(n=(0,y.getSegmentByIndex)(H,t))&&(i=n.presentationStartTime-r.start,e=t.adaptation.period.duration,D(t.segmentInfoType+": "+i+" / "+e),s=("SegmentTimeline"!==a||!X)&&i>=e):s=!0,s}function S(t){return Z.getSegments(t,q,H,w)}function w(t,e){if(t.segments=e,e&&e.length>0&&(Y=isNaN(Y)?e[0].presentationStartTime:Math.min(e[0].presentationStartTime,Y)),X&&isNaN(B.getExpectedLiveEdge())){var n=e.length-1,i=e[n],r=i.presentationStartTime,a=z.getMetricsFor("stream");B.setExpectedLiveEdge(r),z.updateManifestUpdateInfo(U.getCurrentManifestUpdate(a),{presentationStartTime:r})}}function M(t){if(!t)throw new u.default("no representation");return t.segments=null,S(t),t}function C(t,e){var n,i=t.initialization,r="BaseURL"!==t.segmentInfoType&&"SegmentBase"!==t.segmentInfoType&&!t.indexRange
;return t.segmentDuration||t.segments||M(t),t.segmentAvailabilityRange=null,t.segmentAvailabilityRange=B.calcSegmentAvailabilityRange(t,X),t.segmentAvailabilityRange.end<t.segmentAvailabilityRange.start&&!t.useCalculatedLiveEdgeTime?(n=new u.default(x,"no segments are available yet",{availabilityDelay:t.segmentAvailabilityRange.start-t.segmentAvailabilityRange.end}),void k.trigger(h.default.REPRESENTATION_UPDATED,{sender:this,representation:t,error:n})):(e||(H=-1),t.segmentDuration&&M(t),i||V.loadInitialization(t),r||V.loadSegments(t,K,t.indexRange),void(i&&r&&k.trigger(h.default.REPRESENTATION_UPDATED,{sender:this,representation:t})))}function R(t,e,n){var i,r,a,s,o,u=e.segments,l=u?u.length:null,c=-1;if(u&&l>0)for(o=0;o<l;o++)if(r=u[o],a=r.presentationStartTime,s=r.duration,i=void 0===n||null===n?s/2:n,t+i>=a&&t-i<a+s){c=r.availabilityIdx;break}return c}function O(t){if(null===t||void 0===t)return null;var e=new s.default,n=t.representation,i=n.adaptation.period.mpd.manifest.Period_asArray[n.adaptation.period.index].AdaptationSet_asArray[n.adaptation.index].Representation_asArray[n.index].bandwidth,r=t.media;return r=(0,y.replaceTokenForTemplate)(r,"Number",t.replacementNumber),r=(0,y.replaceTokenForTemplate)(r,"Time",t.replacementTime),r=(0,y.replaceTokenForTemplate)(r,"Bandwidth",i),r=g(r,n.id),r=f(r),e.mediaType=K,e.type=l.HTTPRequest.MEDIA_SEGMENT_TYPE,e.range=t.mediaRange,e.startTime=t.presentationStartTime,e.duration=t.duration,e.timescale=n.timescale,e.availabilityStartTime=t.availabilityStartTime,e.availabilityEndTime=t.availabilityEndTime,e.wallStartTime=t.wallStartTime,e.quality=n.index,e.index=t.availabilityIdx,e.mediaInfo=Q.getMediaInfo(),e.adaptationIndex=n.adaptation.index,m(e,r,n)?e:void 0}function A(t,e,n){var i,r,a,o=H,u=!!n&&n.keepIdx,l=n?n.timeThreshold:null,c=!(!n||!n.ignoreIsFinished);return t?(q!==e&&(q=e,D("Getting the request for "+K+" time : "+e)),H=R(e,t,l),S(t),H<0&&(H=R(e,t,l)),H>0&&D("Index for "+K+" time "+e+" is "+H),a=!c&&E(t),a?(i=new s.default,i.action=s.default.ACTION_COMPLETE,i.index=H,i.mediaType=K,i.mediaInfo=Q.getMediaInfo(),D("Signal complete.",i)):(r=(0,y.getSegmentByIndex)(H,t),i=O(r)),u&&o>=0&&(H="SegmentTimeline"===t.segmentInfoType&&X?H:o),i):null}function j(t,e){var n=(t.segmentAvailabilityRange.end-t.segmentAvailabilityRange.start)/2;return t.segments=null,t.segmentAvailabilityRange={start:e-n,end:e+n},A(t,e,{keepIdx:!1,ignoreIsFinished:!0})}function I(t){var e,n,i;return t&&-1!==H?(q=null,H++,D("Getting the next request at index: "+H),i=E(t),i?(e=new s.default,e.action=s.default.ACTION_COMPLETE,e.index=H,e.mediaType=K,e.mediaInfo=Q.getMediaInfo(),D("Signal complete.")):(S(t),n=(0,y.getSegmentByIndex)(H,t),e=O(n),!n&&X&&H--),e):null}function P(t){var e=t.representation;e.segments&&k.trigger(h.default.REPRESENTATION_UPDATED,{sender:this,representation:e})}function L(t){if(!t.error&&K===t.mediaType){var e,n,i,r,a=t.segments,s=t.representation,o=[],u=0;for(e=0,n=a.length;e<n;e++)i=a[e],r=(0,y.getTimeBasedSegment)(B,X,s,i.startTime,i.duration,i.timescale,i.media,i.mediaRange,u),o.push(r),r=null,u++;s.segmentAvailabilityRange={start:o[0].presentationStartTime,end:o[n-1].presentationStartTime},s.availableSegmentsNumber=n,w(s,o),s.initialization&&k.trigger(h.default.REPRESENTATION_UPDATED,{sender:this,representation:s})}}var N=this.context,D=(0,b.default)(N).getInstance().log,k=(0,d.default)(N).getInstance(),F=(0,v.default)(N).getInstance(),V=t.segmentBaseLoader,B=t.timelineConverter,U=t.dashMetrics,z=t.metricsModel,G=t.baseURLController,$=void 0,H=void 0,q=void 0,X=void 0,K=void 0,W=void 0,Y=void 0,Q=void 0,Z=void 0;return $={initialize:e,getStreamProcessor:n,getInitRequest:_,getSegmentRequestForTime:A,getNextSegmentRequest:I,generateSegmentRequestForTime:j,updateRepresentation:C,setCurrentTime:i,getCurrentTime:r,getCurrentIndex:a,getEarliestTime:o,reset:c},function(){H=-1,W=0,Y=NaN,k.on(h.default.INITIALIZATION_LOADED,P,$),k.on(h.default.SEGMENTS_LOADED,L,$)}(),$}Object.defineProperty(n,"__esModule",{value:!0});var a=t(163),s=i(a),o=t(162),u=i(o),l=t(179),c=t(13),h=i(c),f=t(9),d=i(f),g=t(10),m=i(g),p=t(8),b=i(p),_=t(158),v=i(_),y=t(35),E=t(34),T=i(E),x=1;r.__dashjs_factory_name="DashHandler";var S=m.default.getClassFactory(r);S.SEGMENTS_UNAVAILABLE_ERROR_CODE=x,n.default=S,e.exports=n.default},{10:10,13:13,158:158,162:162,163:163,179:179,34:34,35:35,8:8,9:9}],17:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,e){var n;return n=x(C.getValue().Period_asArray[e],t),null===n?null:n.bandwidth}function e(t,e){return T(C.getValue().Period_asArray[e],t)}function n(t,e){return w(C.getValue().Period_asArray[e],t)}function i(t){return f(t,d.TRACK_SWITCH)}function r(t){return f(t,d.BUFFER_LEVEL)}function s(t){var e=r(t);return e?(0,g.round10)(e.level/1e3,-3):0}function u(t){return t.RequestsQueue}function c(t){if(null===t)return null;var e,n,i=t.HttpList,r=null;if(null===i||i.length<=0)return null;for(e=i.length,n=e-1;n>=0;){if(i[n].responsecode){r=i[n];break}n--}return r}function h(t){return null===t?[]:t.HttpList?t.HttpList:[]}function f(t,e){if(null===t)return null;var n=t[e];if(null===n)return null;var i=n.length;return i<=0?null:n[i-1]}function m(t){return f(t,d.DROPPED_FRAMES)}function p(t){return f(t,d.SCHEDULING_INFO)}function b(t){return f(t,d.MANIFEST_UPDATE)}function _(t){return f(t,d.DVR_INFO)}function v(t,e){var n,i,r,s={};if(null===t)return null;for(n=h(t),r=n.length-1;r>=0;r--)if(i=n[r],i.type===a.HTTPRequest.MPD_TYPE){s=E(i._responseHeaders);break}return void 0===s[e]?null:s[e]}function y(t,e){if(null===t)return null;var n,i=c(t);return null===i||null===i._responseHeaders?null:(n=E(i._responseHeaders),void 0===n[e]?null:n[e])}function E(t){var e={};if(!t)return e;for(var n=t.split("\r\n"),i=0,r=n.length;i<r;i++){var a=n[i],s=a.indexOf(": ");s>0&&(e[a.substring(0,s)]=a.substring(s+2))}return e}function T(t,e){var n=x(t,e,!0);return null!==n?n:-1}function x(t,e,n){var i,r,a,s,o,u;for(r=t.AdaptationSet_asArray,o=0;o<r.length;o+=1)for(i=r[o],s=i.Representation_asArray,u=0;u<s.length;u+=1)if(a=s[u],e===a.id)return n?u:a;return null}function S(t,e){return(0,l.default)(M).getInstance().getIsTypeOf(t,e)}function w(t,e){var n,i,r,a;if(!t||!e)return-1;for(i=t.AdaptationSet_asArray,a=0;a<i.length;a+=1)if(n=i[a],r=n.Representation_asArray,S(n,e))return r.length;return-1}var M=this.context,C=(0,o.default)(M).getInstance();return{getBandwidthForRepresentation:t,getIndexForRepresentation:e,getMaxIndexForBufferType:n,getCurrentRepresentationSwitch:i,getLatestBufferLevelVO:r,getCurrentBufferLevel:s,getCurrentHttpRequest:c,getHttpRequests:h,getCurrentDroppedFrames:m,getCurrentSchedulingInfo:p,getCurrentDVRInfo:_,getCurrentManifestUpdate:b,getLatestFragmentRequestHeaderValueByID:y,getLatestMPDRequestHeaderValueByID:v,getRequestsQueue:u}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(179),s=t(100),o=i(s),u=t(22),l=i(u),c=t(10),h=i(c),f=t(20),d=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(f),g=t(7);r.__dashjs_factory_name="DashMetrics",n.default=h.default.getSingletonFactory(r),e.exports=n.default},{10:10,100:100,179:179,20:20,22:22,7:7}],18:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){v=(0,f.default)(d).getInstance(),y=(0,_.default)(d).getInstance(),E=(0,s.default)(d).getInstance()}function e(t){t.baseURLController&&(x=t.baseURLController)}function n(t,e){var i=!0,r=null,a=null,s=new XMLHttpRequest,u=x.resolve(t.path),c=e||{url:u?u.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:s};m("Start searching for initialization."),s.onload=function(){s.status<200||s.status>299||(i=!1,c.bytesLoaded=c.range.end,a=y.parse(s.response),r=o(a),r?(t.range=r,t.initialization=c.url,b.trigger(g.default.INITIALIZATION_LOADED,{representation:t})):(c.range.end=c.bytesLoaded+c.bytesToLoad,n(t,c)))},s.onloadend=s.onerror=function(){i&&(i=!1,v.downloadError("initialization",c.url,s),b.trigger(g.default.INITIALIZATION_LOADED,{representation:t}))},l(s,c),m("Perform init search: "+c.url)}function i(t,e,n,r,s){if(n&&(void 0===n.start||void 0===n.end)){var o=n?n.toString().split("-"):null;n=o?{start:parseFloat(o[0]),end:parseFloat(o[1])}:null}s=s||h;var u=!0,c=null,f=null,d=!!n,g=new XMLHttpRequest,p=x.resolve(t.path),b={url:p?p.url:void 0,range:d?n:{start:0,end:1500},searching:!d,bytesLoaded:r?r.bytesLoaded:0,bytesToLoad:1500,request:g};g.onload=function(){if(!(g.status<200||g.status>299)){var n=b.bytesToLoad,r=g.response.byteLength;if(u=!1,b.bytesLoaded=b.range.end-b.range.start,c=y.parse(g.response),(f=c.getBox("sidx"))&&f.isComplete){var o,l,h=f.references;if(null!==h&&void 0!==h&&h.length>0&&(o=1===h[0].reference_type),o){m("Initiate multiple SIDX load."),b.range.end=b.range.start+f.size;var d,p,_,v,E,T=[],x=0,S=(f.offset||b.range.start)+f.size,w=function(n){n?(T=T.concat(n),++x>=p&&s(T,t,e)):s(null,t,e)};for(d=0,p=h.length;d<p;d++)_=S,v=S+h[d].referenced_size-1,S+=h[d].referenced_size,E={start:_,end:v},i(t,null,E,b,w)}else m("Parsing segments from SIDX."),l=a(f,b),s(l,t,e)}else{if(f)b.range.start=f.offset||b.range.start,b.range.end=b.range.start+(f.size||n);else{if(r<b.bytesLoaded)return void s(null,t,e);var M=c.getLastBox();M&&M.size?(b.range.start=M.offset+M.size,b.range.end=b.range.start+n):b.range.end+=n}i(t,e,b.range,b,s)}}},g.onloadend=g.onerror=function(){u&&(u=!1,v.downloadError("SIDX",b.url,g),s(null,t,e))},l(g,b),m("Perform SIDX load: "+b.url)}function r(){v=null,y=null,E=null,m=null}function a(t,e){for(var n=void 0,i=void 0,r=void 0,a=void 0,s=t.references,o=s.length,l=t.timescale,c=t.earliest_presentation_time,h=e.range.start+t.offset+t.first_offset+t.size,f=[],d=0;d<o;d++)r=s[d].subsegment_duration,a=s[d].referenced_size,n=new u.default,n.duration=r,n.media=e.url,n.startTime=c,n.timescale=l,i=h+a-1,n.mediaRange=h+"-"+i,f.push(n),c+=r,h+=a;return f}function o(t){var e,n,i=t.getBox("ftyp"),r=t.getBox("moov"),a=null;return m("Searching for initialization."),r&&r.isComplete&&(e=i?i.offset:r.offset,n=r.offset+r.size-1,a=e+"-"+n,m("Found the initialization.  Range: "+a)),a}function l(t,e){e.url&&(t.open("GET",E.modifyRequestURL(e.url)),t.responseType="arraybuffer",t.setRequestHeader("Range","bytes="+e.range.start+"-"+e.range.end),t=E.modifyRequestHeader(t),t.send(null))}function h(t,e,n){t?b.trigger(g.default.SEGMENTS_LOADED,{segments:t,representation:e,mediaType:n}):b.trigger(g.default.SEGMENTS_LOADED,{segments:null,representation:e,mediaType:n,error:new c.default(null,"error loading segments",null)})}var d=this.context,m=(0,T.default)(d).getInstance().log,b=(0,p.default)(d).getInstance(),v=void 0,y=void 0,E=void 0,x=void 0;return{setConfig:e,initialize:t,loadInitialization:n,loadSegments:i,reset:r}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(156),s=i(a),o=t(46),u=i(o),l=t(162),c=i(l),h=t(151),f=i(h),d=t(13),g=i(d),m=t(9),p=i(m),b=t(146),_=i(b),v=t(10),y=i(v),E=t(8),T=i(E);r.__dashjs_factory_name="SegmentBaseLoader",n.default=y.default.getSingletonFactory(r),e.exports=n.default},{10:10,13:13,146:146,151:151,156:156,162:162,46:46,8:8,9:9}],19:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){S=(0,p.default)(d).getInstance(),M=(0,_.default)(d).getInstance(),R=(0,w.default)(d).create({errHandler:S,metricsModel:C,requestModifier:M})}function e(t){if(!t.baseURLController||!t.metricsModel)throw new Error("Missing config parameter(s)");O=t.baseURLController,C=t.metricsModel}function n(t){var e=[],n=void 0,i=void 0,r=void 0,a=(0,c.default)(d).create({data:t}),s=void 0;for(a.consumeTag(T.Segment.Cues),i=a.getMatroskaCodedNum();a.moreData()&&a.consumeTagAndSize(T.Segment.Cues.CuePoint,!0);){for(n={},n.CueTime=a.parseTag(T.Segment.Cues.CuePoint.CueTime),n.CueTracks=[];a.moreData()&&a.consumeTagAndSize(T.Segment.Cues.CuePoint.CueTrackPositions,!0);){if(r={},r.Track=a.parseTag(T.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===r.Track)throw new Error("Cue track cannot be 0");r.ClusterPosition=a.parseTag(T.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),a.getPos()+4>i||!a.consumeTag(T.Segment.Cues.CuePoint.CueTrackPositions.CueBlockNumber,!0)?n.CueTracks.push(r):(s=a.getMatroskaCodedNum(),r.BlockNumber=a.getMatroskaUint(s),n.CueTracks.push(r))}if(0===n.CueTracks.length)throw new Error("Mandatory cuetrack not found");e.push(n)}if(0===e.length)throw new Error("mandatory cuepoint not found");return e}function i(t,e,i,r,a){var s=void 0,o=void 0,u=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0;for(o=n(t),u=[],c=0,h=o.length;c<h;c+=1)l=new y.default,s=0,s=c<o.length-1?o[c+1].CueTime-o[c].CueTime:a-o[c].CueTime,l.duration=s,l.media=e,l.startTime=o[c].CueTime,l.timescale=1e3,f=o[c].CueTracks[0].ClusterPosition+i,d=c<o.length-1?o[c+1].CueTracks[0].ClusterPosition+i-1:r-1,l.mediaRange=f+"-"+d,u.push(l);return m("Parsed cues: "+u.length+" cues."),u}function r(t,e,n,r){var a=(0,c.default)(d).create({data:t}),s=void 0,o=void 0,u=n.split("-"),l=null,f={url:e,range:{start:parseFloat(u[0]),end:parseFloat(u[1])},request:l},g=void 0,p=void 0;for(m("Parse EBML header: "+f.url),a.skipOverElement(T.EBML),a.consumeTag(T.Segment),g=a.getMatroskaCodedNum(),g+=a.getPos(),p=a.getPos();a.moreData()&&!a.consumeTagAndSize(T.Segment.Info,!0);)if(!(a.skipOverElement(T.Segment.SeekHead,!0)||a.skipOverElement(T.Segment.Tracks,!0)||a.skipOverElement(T.Segment.Cues,!0)||a.skipOverElement(T.Void,!0)))throw new Error("no valid top level element found");for(;void 0===s;){var b=a.getMatroskaCodedNum(!0),_=a.getMatroskaCodedNum();switch(b){case T.Segment.Info.Duration.tag:s=a[T.Segment.Info.Duration.parse](_);break;default:a.setPos(a.getPos()+_)}}l=h(f);var v=function(t){o=i(t,f.url,p,g,s),r(o)},y=function(){m("Download Error: Cues "+f.url),r(null)};R.load({request:l,success:v,error:y}),m("Perform cues load: "+f.url+" bytes="+f.range.start+"-"+f.range.end)}function a(t,e){var n=null,i=O.resolve(t.path),r=i?i.url:void 0,a=t.range.split("-"),o=e||{range:{start:parseFloat(a[0]),end:parseFloat(a[1])},request:n,url:r,init:!0};m("Start loading initialization."),n=h(o);var u=function(){t.initialization=o.url,b.trigger(s.default.INITIALIZATION_LOADED,{representation:t})},l=function(){b.trigger(s.default.INITIALIZATION_LOADED,{representation:t})};R.load({request:n,success:u,error:l}),m("Perform init load: "+o.url)}function o(t,e,n,i){var a=null,s=O.resolve(t.path),o=s?s.url:void 0,u={bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:a,url:o,init:!1};i=i||l,a=h(u),m("Parsing ebml header");var c=function(a){r(a,o,n,function(n){i(n,t,e)})},f=function(){i(null,t,e)};R.load({request:a,success:c,error:f})}function l(t,e,n){t?b.trigger(s.default.SEGMENTS_LOADED,{segments:t,representation:e,mediaType:n}):b.trigger(s.default.SEGMENTS_LOADED,{segments:null,representation:e,mediaType:n,error:new Error(null,"error loading segments",null)})}function h(t){var e=new x.default;return e.type=t.init?E.HTTPRequest.INIT_SEGMENT_TYPE:E.HTTPRequest.MEDIA_SEGMENT_TYPE,e.url=t.url,e.range=t.range.start+"-"+t.range.end,e}function f(){S=null,M=null,m=null}var d=this.context,m=(0,g.default)(d).getInstance().log,b=(0,u.default)(d).getInstance(),v=void 0,T=void 0,S=void 0,M=void 0,C=void 0,R=void 0,O=void 0;return v={setConfig:e,initialize:t,loadInitialization:a,loadSegments:o,reset:f},function(){T={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"},CueBlockNumber:{tag:21368}}}}},Void:{tag:236,required:!0}}}(),v}Object.defineProperty(n,"__esModule",{value:!0});var a=t(13),s=i(a),o=t(9),u=i(o),l=t(150),c=i(l),h=t(10),f=i(h),d=t(8),g=i(d),m=t(151),p=i(m),b=t(156),_=i(b),v=t(46),y=i(v),E=t(179),T=t(163),x=i(T),S=t(58),w=i(S);r.__dashjs_factory_name="WebmSegmentBaseLoader",n.default=f.default.getSingletonFactory(r),e.exports=n.default},{10:10,13:13,150:150,151:151,156:156,163:163,179:179,46:46,58:58,8:8,9:9}],20:[function(t,e,n){Object.defineProperty(n,"__esModule",{value:!0});n.TCP_CONNECTION="TcpList";n.HTTP_REQUEST="HttpList";n.TRACK_SWITCH="RepSwitchList";n.BUFFER_LEVEL="BufferLevel";n.BUFFER_STATE="BufferState";n.DVR_INFO="DVRInfo";n.DROPPED_FRAMES="DroppedFrames";n.SCHEDULING_INFO="SchedulingInfo";n.REQUESTS_QUEUE="RequestsQueue";n.MANIFEST_UPDATE="ManifestUpdate";n.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo";n.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo";n.PLAY_LIST="PlayList";n.DVB_ERRORS="DVBErrors"},{}],21:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){t.abrController&&(q=t.abrController)}function e(t){H=t,X=H.getIndexHandler()}function n(){return H}function i(){return B}function r(){return U}function a(){return z}function o(){return $}function l(){F.off(A.default.QUALITY_CHANGE_REQUESTED,N,V),F.off(A.default.REPRESENTATION_UPDATED,j,V),F.off(A.default.WALLCLOCK_TIME_UPDATED,I,V),F.off(A.default.BUFFER_LEVEL_UPDATED,L,V),F.off(A.default.LIVE_EDGE_SEARCH_COMPLETED,P,V),B=null,U=-1,z=!0,G=[],q=null,K=null,W=null,Y=null,Q=null,Z=null,J=null,tt=null,et=null,nt=null}function h(t,e,n){var i,r,a=null,s=H.getStreamInfo(),o=q.getTopQualityIndexFor(n,s.id);if(z=!0,F.trigger(A.default.DATA_UPDATE_STARTED,{sender:this}),G=x(e),null===B&&"fragmentedText"!==n?(r=q.getAverageThroughput(n),a=r||q.getInitialBitrateFor(n,s),i=q.getQualityForBitrate(H.getMediaInfo(),a)):i=q.getQualityFor(n,s),i>o&&(i=o),$=b(i),B=t,"video"!==n&&"audio"!==n&&"fragmentedText"!==n)return z=!1,void F.trigger(A.default.DATA_UPDATE_COMPLETED,{sender:this,data:B,currentRepresentation:$});for(var u=0;u<G.length;u++)X.updateRepresentation(G[u],!0)}function d(){var t=new Date,e=o(),n=1e3*W.getTime();Q.addRepresentationSwitch(e.adaptation.type,t,n,e.id)}function m(){var t=J.calcSegmentAvailabilityRange($,H.isDynamic());Q.addDVRInfo(H.getType(),W.getTime(),H.getStreamInfo().manifestInfo,t)}function b(t){return G[t]}function v(t){return G.indexOf(t)}function E(){for(var t=0,e=G.length;t<e;t++){var n=G[t].segmentInfoType;if(null===G[t].segmentAvailabilityRange||null===G[t].initialization||("SegmentBase"===n||"BaseURL"===n)&&!G[t].segments)return!1}return!0}function x(t){var e=Y.getValue();return U=tt.getIndexForAdaptation(B,e,t.period.index),tt.getRepresentationsForAdaptation(e,t)}function w(t){for(var e=void 0,n=0,i=G.length;n<i;n++)e=G[n],e.segmentAvailabilityRange=J.calcSegmentAvailabilityRange(e,t)}function C(){G.forEach(function(t){t.segmentAvailabilityRange=null})}function O(t){var e=t,n=function(){if(!a()){z=!0,F.trigger(A.default.DATA_UPDATE_STARTED,{sender:V}),C();for(var t=0;t<G.length;t++)X.updateRepresentation(G[t],!0)}};z=!1,F.trigger(A.default.AST_IN_FUTURE,{delay:e}),setTimeout(n,e)}function j(t){if(t.sender.getStreamProcessor()===H&&a()){var e,n,i,r=t.representation,s=Q.getMetricsFor("stream"),u=Q.getMetricsFor(o().adaptation.type),l=et.getCurrentManifestUpdate(s),c=!1,h=0;if("dynamic"===r.adaptation.period.mpd.manifest.type){var f=r.segmentAvailabilityRange.end-r.segmentAvailabilityRange.start;h=1e3*(W.computeLiveDelay($.segmentDuration,H.getStreamInfo().manifestInfo.DVRWindowSize)-f)}if(h>0)return m(),O(h),n=new M.default(D,"Segments update failed",null),void F.trigger(A.default.DATA_UPDATE_COMPLETED,{sender:this,data:B,currentRepresentation:$,error:n});if(l){for(var g=0;g<l.trackInfo.length;g++)if(e=l.trackInfo[g],e.index===r.index&&e.mediaType===H.getType()){c=!0;break}c||Q.addManifestUpdateRepresentationInfo(l,r.id,r.index,r.adaptation.period.index,H.getType(),r.presentationTimeOffset,r.startNumber,r.segmentInfoType)}E()&&(z=!1,q.setPlaybackQuality(H.getType(),H.getStreamInfo(),v($)),Q.updateManifestUpdateInfo(l,{latency:$.segmentAvailabilityRange.end-W.getTime()}),i=et.getCurrentRepresentationSwitch(u),i||d(),F.trigger(A.default.DATA_UPDATE_COMPLETED,{sender:this,data:B,currentRepresentation:$}))}}function I(t){t.isDynamic&&w(t.isDynamic)}function P(t){if(!t.error){w(!0),X.updateRepresentation($,!1);var e=Y.getValue(),n=$.adaptation.period,i=K.getActiveStreamInfo();i.isLast&&(n.mpd.checkTime=tt.getCheckTime(e,n),n.duration=tt.getEndTimeForLastPeriod(Y.getValue(),n)-n.start,i.duration=n.duration)}}function L(t){t.sender.getStreamProcessor()===H&&m()}function N(t){t.mediaType===H.getType()&&H.getStreamInfo().id===t.streamInfo.id&&t.oldQuality!==t.newQuality&&($=b(t.newQuality),Z.setSavedBitrateSettings(t.mediaType,$.bandwidth),d())}var D=1,k=this.context,F=(0,R.default)(k).getInstance(),V=void 0,B=void 0,U=void 0,z=void 0,G=void 0,$=void 0,H=void 0,q=void 0,X=void 0,K=void 0,W=void 0,Y=void 0,Q=void 0,Z=void 0,J=void 0,tt=void 0,et=void 0,nt=void 0;return V={initialize:e,setConfig:t,getData:i,getDataIndex:r,isUpdating:a,updateData:h,getStreamProcessor:n,getCurrentRepresentation:o,getRepresentationForQuality:b,reset:l},function(){B=null,U=-1,z=!0,G=[],q=(0,f.default)(k).getInstance(),K=(0,p.default)(k).getInstance(),W=(0,g.default)(k).getInstance(),Y=(0,_.default)(k).getInstance(),Q=(0,y.default)(k).getInstance(),Z=(0,S.default)(k).getInstance(),J=(0,c.default)(k).getInstance(),tt=(0,s.default)(k).getInstance(),et=(0,u.default)(k).getInstance(),nt=(0,T.default)(k).getInstance(),F.on(A.default.QUALITY_CHANGE_REQUESTED,N,V),F.on(A.default.REPRESENTATION_UPDATED,j,V),F.on(A.default.WALLCLOCK_TIME_UPDATED,I,V),F.on(A.default.BUFFER_LEVEL_UPDATED,L,V),F.on(A.default.LIVE_EDGE_SEARCH_COMPLETED,P,V)}(),V}Object.defineProperty(n,"__esModule",{value:!0});var a=t(22),s=i(a),o=t(17),u=i(o),l=t(37),c=i(l),h=t(60),f=i(h),d=t(68),g=i(d),m=t(71),p=i(m),b=t(100),_=i(b),v=t(102),y=i(v),E=t(101),T=i(E),x=t(149),S=i(x),w=t(162),M=i(w),C=t(9),R=i(C),O=t(13),A=i(O),j=t(10),I=i(j);r.__dashjs_factory_name="RepresentationController",n.default=I.default.getClassFactory(r),e.exports=n.default},{10:10,100:100,101:101,102:102,13:13,149:149,162:162,17:17,22:22,37:37,60:60,68:68,71:71,9:9}],22:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,e){var n,i,r,a=!1,s=!1,o=t.ContentComponent_asArray,u="text"!==e?new RegExp(e):new RegExp("(vtt|ttml)");if(t.Representation_asArray.length>0&&t.Representation_asArray[0].hasOwnProperty("codecs")){var l=t.Representation_asArray[0].codecs;if("stpp"===l||"wvtt"===l)return"fragmentedText"===e}if(o){if(o.length>1)return"muxed"===e;o[0]&&o[0].contentType===e&&(a=!0,s=!0)}if(t.hasOwnProperty("mimeType")&&(a=u.test(t.mimeType),s=!0),!s)for(n=0,i=t.Representation_asArray.length;!s&&n<i;)r=t.Representation_asArray[n],r.hasOwnProperty("mimeType")&&(a=u.test(r.mimeType),s=!0),n++;return a}function e(e){return t(e,"audio")}function n(e){return t(e,"video")}function i(e){return t(e,"fragmentedText")}function r(e){return t(e,"text")}function a(e){return t(e,"muxed")}function o(t){return"text/vtt"===t||"application/ttml+xml"===t}function l(t){var e="";return t.hasOwnProperty("lang")&&(e=t.lang.replace(/[^A-Za-z0-9-]/g,"")),e}function h(t){return t.hasOwnProperty("Viewpoint")?t.Viewpoint:null}function d(t){return t.hasOwnProperty("Role_asArray")?t.Role_asArray:[]}function m(t){return t.hasOwnProperty("Accessibility_asArray")?t.Accessibility_asArray:[]}function b(t){return t.hasOwnProperty("AudioChannelConfiguration_asArray")?t.AudioChannelConfiguration_asArray:[]}function v(t){return d(t).filter(function(t){return"main"===t.value})[0]}function E(){return function(t,e){return t.bandwidth-e.bandwidth}}function x(t){return void 0!==t.Representation_asArray&&null!==t.Representation_asArray&&t.Representation_asArray.sort(E()),t}function w(t,e,n){var i,r,a=e.Period_asArray[n].AdaptationSet_asArray;for(i=0,r=a.length;i<r;i++)if(a[i].hasOwnProperty("id")&&a[i].id===t)return a[i];return null}function C(t,e,n){return e.Period_asArray[n].AdaptationSet_asArray[t]}function O(t,e,n){var i,r,a=e.Period_asArray[n].AdaptationSet_asArray;for(i=0,r=a.length;i<r;i++)if(a[i]===t)return i;return-1}function A(e,n,i){var r,a,s=e.Period_asArray[n].AdaptationSet_asArray,o=[];for(r=0,a=s.length;r<a;r++)t(s[r],i)&&o.push(x(s[r]));return o}function j(t,e,n,i){var r=A(t,e,n);if(!r||0===r.length)return null;if(r.length>1&&i)for(var a=ct.getCurrentTrackFor(n,i),s=ht.getAllMediaInfoForType(t,i,n),o=0,u=r.length;o<u;o++){if(a&&ct.isTracksEqual(a,s[o]))return r[o];if(v(r[o]))return r[o]}return r[0]}function I(t){var e=t.Representation_asArray[0];return e.mimeType+';codecs="'+e.codecs+'"'}function P(t){return t.Representation_asArray[0].mimeType}function L(t){return t&&t.hasOwnProperty("cenc:default_KID")?t["cenc:default_KID"]:null}function N(t){return t&&t.hasOwnProperty("ContentProtection_asArray")&&0!==t.ContentProtection_asArray.length?t.ContentProtection_asArray:null}function D(t){var e=!1;return t.hasOwnProperty("type")&&(e="dynamic"===t.type),e}function k(t){var e,n=D(t);return e=!isNaN(t.timeShiftBufferDepth),n&&e}function F(t,e){var n=!1;return t.profiles&&t.profiles.length>0&&(n=-1!==t.profiles.indexOf(e)),n}function V(t){return F(t,"urn:mpeg:dash:profile:isoff-on-demand:2011")}function B(t){return F(t,"urn:dvb:dash:profile:dvb-dash:2014")}function U(t){return t.hasOwnProperty("mediaPresentationDuration")?t.mediaPresentationDuration:Number.MAX_VALUE}function z(t){return t.bandwidth}function G(t){var e=NaN;return t.hasOwnProperty("minimumUpdatePeriod")&&(e=Math.max(parseFloat(t.minimumUpdatePeriod),2)),e}function $(t){return t.Representation_asArray.length}function H(t){if(!t||!t.Representation_asArray||!t.Representation_asArray.length)return null;for(var e=x(t),n=e.Representation_asArray,i=n.length,r=[],a=0;a<i;a++)r.push({bandwidth:n[a].bandwidth,width:n[a].width||0,height:n[a].height||0});return r}function q(t,e){return e.Representation_asArray[t]}function X(t,e){for(var n=void 0,i=void 0,r=void 0,a=void 0,u=void 0,l=x(t.Period_asArray[e.period.index].AdaptationSet_asArray[e.index]),c=[],h=0;h<l.Representation_asArray.length;h++)a=l.Representation_asArray[h],n=new s.default,n.index=h,n.adaptation=e,a.hasOwnProperty("id")&&(n.id=a.id),a.hasOwnProperty("bandwidth")&&(n.bandwidth=a.bandwidth),a.hasOwnProperty("maxPlayoutRate")&&(n.maxPlayoutRate=a.maxPlayoutRate),a.hasOwnProperty("SegmentBase")?(r=a.SegmentBase,n.segmentInfoType="SegmentBase"):a.hasOwnProperty("SegmentList")?(r=a.SegmentList,r.hasOwnProperty("SegmentTimeline")?(n.segmentInfoType="SegmentTimeline",u=r.SegmentTimeline.S_asArray[r.SegmentTimeline.S_asArray.length-1],(!u.hasOwnProperty("r")||u.r>=0)&&(n.useCalculatedLiveEdgeTime=!0)):(n.segmentInfoType="SegmentList",n.useCalculatedLiveEdgeTime=!0)):a.hasOwnProperty("SegmentTemplate")?(r=a.SegmentTemplate,r.hasOwnProperty("SegmentTimeline")?(n.segmentInfoType="SegmentTimeline",u=r.SegmentTimeline.S_asArray[r.SegmentTimeline.S_asArray.length-1],(!u.hasOwnProperty("r")||u.r>=0)&&(n.useCalculatedLiveEdgeTime=!0)):n.segmentInfoType="SegmentTemplate",r.hasOwnProperty("initialization")&&(n.initialization=r.initialization.split("$Bandwidth$").join(a.bandwidth).split("$RepresentationID$").join(a.id))):(r=a.BaseURL,n.segmentInfoType="BaseURL"),r.hasOwnProperty("Initialization")?(i=r.Initialization,i.hasOwnProperty("sourceURL")?n.initialization=i.sourceURL:i.hasOwnProperty("range")&&(n.range=i.range)):a.hasOwnProperty("mimeType")&&o(a.mimeType)&&(n.range=0),r.hasOwnProperty("timescale")&&(n.timescale=r.timescale),r.hasOwnProperty("duration")&&(n.segmentDuration=r.duration/n.timescale),r.hasOwnProperty("startNumber")&&(n.startNumber=r.startNumber),r.hasOwnProperty("indexRange")&&(n.indexRange=r.indexRange),r.hasOwnProperty("presentationTimeOffset")&&(n.presentationTimeOffset=r.presentationTimeOffset/n.timescale),n.MSETimeOffset=lt.calcMSETimeOffset(n),n.path=[e.period.index,e.index,h],c.push(n);return c}function K(t,r){for(var s=void 0,o=void 0,l=t.Period_asArray[r.index],c=[],h=0;h<l.AdaptationSet_asArray.length;h++)o=l.AdaptationSet_asArray[h],s=new u.default,o.hasOwnProperty("id")&&(s.id=o.id),s.index=h,s.period=r,a(o)?s.type="muxed":e(o)?s.type="audio":n(o)?s.type="video":i(o)?s.type="fragmentedText":s.type="text",c.push(s);return c}function W(t,e){var n,i,r=D(t),a=[],s=null,o=null,u=null,l=null;for(i=0,n=t.Period_asArray.length;i<n;i++)o=t.Period_asArray[i],o.hasOwnProperty("start")?(l=new c.default,l.start=o.start):null!==s&&o.hasOwnProperty("duration")&&null!==u?(l=new c.default,l.start=u.start+u.duration,l.duration=o.duration):0!==i||r||(l=new c.default,l.start=0),null!==u&&isNaN(u.duration)&&(u.duration=l.start-u.start),null!==l&&(l.id=Y(o)),null!==l&&o.hasOwnProperty("duration")&&(l.duration=o.duration),null!==l&&(l.index=i,l.mpd=e,a.push(l),s=o,u=l),o=null,l=null;return 0===a.length?a:(null!==u&&isNaN(u.duration)&&(u.duration=tt(t,u)-u.start),a)}function Y(t){if(!t)throw new Error("Period cannot be null or undefined");var e=c.default.DEFAULT_ID;return t.hasOwnProperty("id")&&"__proto__"!==t.id&&(e=t.id),e}function Q(t){var e=new f.default;return e.manifest=t,t.hasOwnProperty("availabilityStartTime")?e.availabilityStartTime=new Date(t.availabilityStartTime.getTime()):e.availabilityStartTime=new Date(t.loadedTime.getTime()),t.hasOwnProperty("availabilityEndTime")&&(e.availabilityEndTime=new Date(t.availabilityEndTime.getTime())),t.hasOwnProperty("suggestedPresentationDelay")&&(e.suggestedPresentationDelay=t.suggestedPresentationDelay),t.hasOwnProperty("timeShiftBufferDepth")&&(e.timeShiftBufferDepth=t.timeShiftBufferDepth),t.hasOwnProperty("maxSegmentDuration")&&(e.maxSegmentDuration=t.maxSegmentDuration),e}function Z(t,e){return lt.calcPresentationTimeFromWallTime(t.loadedTime,e)}function J(t,e){var n,i=NaN;return t.hasOwnProperty("minimumUpdatePeriod")&&(n=Z(t,e),i=n+t.minimumUpdatePeriod),i}function tt(t,e){var n,i=J(t,e);if(t.mediaPresentationDuration)n=t.mediaPresentationDuration;else{if(isNaN(i))throw new Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period.");n=i}return n}function et(t,e){var n=t.Period_asArray,i=n[e.index].EventStream_asArray,r=[];if(i)for(var a=0;a<i.length;a++){var s=new M.default;if(s.period=e,s.timescale=1,!i[a].hasOwnProperty("schemeIdUri"))throw new Error("Invalid EventStream. SchemeIdUri has to be set");s.schemeIdUri=i[a].schemeIdUri,i[a].hasOwnProperty("timescale")&&(s.timescale=i[a].timescale),i[a].hasOwnProperty("value")&&(s.value=i[a].value);for(var o=0;o<i[a].Event_asArray.length;o++){var u=new T.default;u.presentationTime=0,u.eventStream=s,i[a].Event_asArray[o].hasOwnProperty("presentationTime")&&(u.presentationTime=i[a].Event_asArray[o].presentationTime),i[a].Event_asArray[o].hasOwnProperty("duration")&&(u.duration=i[a].Event_asArray[o].duration),i[a].Event_asArray[o].hasOwnProperty("id")&&(u.id=i[a].Event_asArray[o].id),r.push(u)}}return r}function nt(t,e){var n=[];if(!t)return n;for(var i=0;i<t.length;i++){var r=new M.default;if(r.timescale=1,r.representation=e,!t[i].hasOwnProperty("schemeIdUri"))throw new Error("Invalid EventStream. SchemeIdUri has to be set");r.schemeIdUri=t[i].schemeIdUri,t[i].hasOwnProperty("timescale")&&(r.timescale=t[i].timescale),t[i].hasOwnProperty("value")&&(r.value=t[i].value),n.push(r)}return n}function it(t,e){return nt(t.Period_asArray[e.period.index].AdaptationSet_asArray[e.index].InbandEventStream_asArray,null)}function rt(t,e){return nt(t.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].InbandEventStream_asArray,e)}function at(t){var e=D(t),n=t.hasOwnProperty("availabilityStartTime"),i=t.UTCTiming_asArray,r=[]
;return(e||n)&&i&&i.forEach(function(t){var e=new g.default;t.hasOwnProperty("schemeIdUri")&&(e.schemeIdUri=t.schemeIdUri,t.hasOwnProperty("value")&&(e.value=t.value.toString(),r.push(e)))}),r}function st(t){var e=[],n=t.BaseURL_asArray||[t.baseUri],i=!1;return n.some(function(n){if(n){var r=new S.default,a=n.__text||n;return ft.isRelative(a)&&(i=!0,t.baseUri&&(a=t.baseUri+a)),r.url=a,n.hasOwnProperty("serviceLocation")&&n.serviceLocation.length?r.serviceLocation=n.serviceLocation:r.serviceLocation=a,n.hasOwnProperty("dvb:priority")&&(r.dvb_priority=n["dvb:priority"]),n.hasOwnProperty("dvb:weight")&&(r.dvb_weight=n["dvb:weight"]),e.push(r),i}}),e}function ot(t){return t.hasOwnProperty("Location")&&(t.Location=t.Location_asArray[0]),t.Location}var ut=this.context,lt=(0,p.default)(ut).getInstance(),ct=(0,_.default)(ut).getInstance(),ht=(0,y.default)(ut).getInstance(),ft=(0,R.default)(ut).getInstance();return{getIsTypeOf:t,getIsAudio:e,getIsVideo:n,getIsText:r,getIsMuxed:a,getIsTextTrack:o,getIsFragmentedText:i,getIsMain:v,getLanguageForAdaptation:l,getViewpointForAdaptation:h,getRolesForAdaptation:d,getAccessibilityForAdaptation:m,getAudioChannelConfigurationForAdaptation:b,processAdaptation:x,getAdaptationForIndex:C,getIndexForAdaptation:O,getAdaptationForId:w,getAdaptationsForType:A,getAdaptationForType:j,getCodec:I,getMimeType:P,getKID:L,getContentProtectionData:N,getIsDynamic:D,getIsDVR:k,getIsOnDemand:V,getIsDVB:B,getDuration:U,getBandwidth:z,getRefreshDelay:G,getRepresentationCount:$,getBitrateListForAdaptation:H,getRepresentationFor:q,getRepresentationsForAdaptation:X,getAdaptationsForPeriod:K,getRegularPeriods:W,getPeriodId:Y,getMpd:Q,getFetchTime:Z,getCheckTime:J,getEndTimeForLastPeriod:tt,getEventsForPeriod:et,getEventStreams:nt,getEventStreamForAdaptationSet:it,getEventStreamForRepresentation:rt,getUTCTimingSources:at,getBaseURLsFromElement:st,getRepresentationSortFunction:E,getLocation:ot}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(45),s=i(a),o=t(39),u=i(o),l=t(44),c=i(l),h=t(43),f=i(h),d=t(47),g=i(d),m=t(37),p=i(m),b=t(66),_=i(b),v=t(15),y=i(v),E=t(41),T=i(E),x=t(40),S=i(x),w=t(42),M=i(w),C=t(158),R=i(C),O=t(10),A=i(O);r.__dashjs_factory_name="DashManifestModel",n.default=A.default.getSingletonFactory(r),e.exports=n.default},{10:10,15:15,158:158,37:37,39:39,40:40,41:41,42:42,43:43,44:44,45:45,47:47,66:66}],23:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,e){var r;try{var s=window.performance.now();if(!(r=o.xml_str2json(t)))throw new Error("parser error");var l=window.performance.now();u.run(r);var c=window.performance.now();e.setMatchers(a),e.setIron(u),n("Parsing complete: ( xml2json: "+(l-s).toPrecision(3)+"ms, objectiron: "+(c-l).toPrecision(3)+"ms, total: "+((c-s)/1e3).toPrecision(3)+"s)")}catch(e){return i.manifestError("parsing the manifest failed","parse",t,e),null}return r}var e=this.context,n=(0,c.default)(e).getInstance().log,i=(0,s.default)(e).getInstance(),r=void 0,a=void 0,o=void 0,u=void 0;return r={parse:t},function(){a=[new p.default,new _.default,new y.default],o=new g.default(a,"",!0),u=new f.default([new T.default,new S.default])}(),r}Object.defineProperty(n,"__esModule",{value:!0});var a=t(151),s=i(a),o=t(10),u=i(o),l=t(8),c=i(l),h=t(3),f=i(h),d=t(4),g=i(d),m=t(30),p=i(m),b=t(29),_=i(b),v=t(31),y=i(v),E=t(26),T=i(E),x=t(27),S=i(x);r.__dashjs_factory_name="DashParser",n.default=u.default.getClassFactory(r),e.exports=n.default},{10:10,151:151,26:26,27:27,29:29,3:3,30:30,31:31,4:4,8:8}],24:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e,n){i(this,t);this._name=e,this._merge=void 0!==n?n:function(t){return t&&t.length&&t.charAt(0)===t.charAt(0).toUpperCase()}(e)}return r(t,[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}]),t}();n.default=a,e.exports=n.default},{}],25:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t(24),s=function(t){return t&&t.__esModule?t:{default:t}}(a),o=function(){function t(e,n,r,a,o){var u=this;i(this,t),this._name=e||"",this._properties=[],this._children=r||[],this._isRoot=a||!1,this._isArray=o||!0,Array.isArray(n)&&n.forEach(function(t){u._properties.push(new s.default(t))})}return r(t,[{key:"name",get:function(){return this._name}},{key:"isRoot",get:function(){return this._isRoot}},{key:"isArray",get:function(){return this._isArray}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}]),t}();n.default=o,e.exports=n.default},{24:24}],26:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(25),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=function(t){function e(){i(this,e);var t=["profiles","width","height","sar","frameRate","audioSamplingRate","mimeType","segmentProfiles","codecs","maximumSAPPeriod","startWithSAP","maxPlayoutRate","codingDependency","scanType","FramePacking","AudioChannelConfiguration","ContentProtection","EssentialProperty","SupplementalProperty","InbandEventStream"];return a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,"AdaptationSet",t,[new o.default("Representation",t,[new o.default("SubRepresentation",t)])])}return r(e,t),e}(o.default);n.default=u,e.exports=n.default},{25:25}],27:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(25),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=function(t){function e(){i(this,e);var t=["SegmentBase","SegmentTemplate","SegmentList"];return a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,"Period",t,[new o.default("AdaptationSet",t,[new o.default("Representation",t)])])}return r(e,t),e}(o.default);n.default=u,e.exports=n.default},{25:25}],28:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e,n){i(this,t),this._test=e,this._converter=n}return r(t,[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}]),t}();n.default=a,e.exports=n.default},{}],29:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(28),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=60,l=60,c=1e3,h=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,f=function(t){function e(){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,function(t){return h.test(t.value)},function(t){var e=h.exec(t),n=void 0;if(n=Date.UTC(parseInt(e[1],10),parseInt(e[2],10)-1,parseInt(e[3],10),parseInt(e[4],10),parseInt(e[5],10),e[6]&&parseInt(e[6],10)||0,e[7]&&parseFloat(e[7])*c||0),e[9]&&e[10]){var i=parseInt(e[9],10)*l+parseInt(e[10],10);n+=("+"===e[8]?-1:1)*i*u*c}return new Date(n)})}return r(e,t),e}(o.default);n.default=f,e.exports=n.default},{28:28}],30:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(28),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,l=31536e3,c=2592e3,h=86400,f=3600,d=60,g=function(t){function e(){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,function(t){for(var e=["minBufferTime","mediaPresentationDuration","minimumUpdatePeriod","timeShiftBufferDepth","maxSegmentDuration","maxSubsegmentDuration","suggestedPresentationDelay","start","starttime","duration"],n=e.length,i=0;i<n;i++)if(t.nodeName===e[i])return u.test(t.value);return!1},function(t){var e=u.exec(t),n=parseFloat(e[2]||0)*l+parseFloat(e[4]||0)*c+parseFloat(e[6]||0)*h+parseFloat(e[8]||0)*f+parseFloat(e[10]||0)*d+parseFloat(e[12]||0);return void 0!==e[1]&&(n=-n),n})}return r(e,t),e}(o.default);n.default=g,e.exports=n.default},{28:28}],31:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(28),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,l=function(t){function e(){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,function(t){return u.test(t.value)},function(t){return parseFloat(t)})}return r(e,t),e}(o.default);n.default=l,e.exports=n.default},{28:28}],32:[function(t,e,n){function i(){function t(t){t&&t.boxParser&&(i=t.boxParser)}function e(t){var e,n,r,a,s,o,u,l,c,h,f,d=i.parse(t),g=d.getBox("tfhd"),m=d.getBox("tfdt"),p=d.getBox("trun"),b=d.getBox("moof"),_=d.getBox("mfhd");for(h=_.sequence_number,r=p.sample_count,s=m.baseMediaDecodeTime,c=(g.base_data_offset||0)+(p.data_offset||0),o=[],l=0;l<r;l++)u=p.samples[l],e=void 0!==u.sample_duration?u.sample_duration:g.default_sample_duration,a=void 0!==u.sample_size?u.sample_size:g.default_sample_size,n=void 0!==u.sample_composition_time_offset?u.sample_composition_time_offset:0,o.push({dts:s,cts:s+n,duration:e,offset:b.offset+c,size:a}),c+=a,s+=e;return f=s-m.baseMediaDecodeTime,{sampleList:o,sequenceNumber:h,totalDuration:f}}function n(t){var e=i.parse(t),n=e.getBox("mdhd");return n?n.timescale:NaN}var i=void 0;return{getSamplesInfo:e,getMediaTimescaleFromMoov:n,setConfig:t}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="FragmentedTextBoxParser",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],33:[function(t,e,n){function i(t,e){function n(t,n,r,a){var o,u,l,c,h,f,d,g=t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].SegmentList,m=g.SegmentURL_asArray.length,p=[];for(d=t.startNumber,c=(0,s.decideSegmentListRangeForTemplate)(i,e,t,n,r,a),h=Math.max(c.start,0),f=Math.min(c.end,g.SegmentURL_asArray.length-1),o=h;o<=f;o++)l=g.SegmentURL_asArray[o],u=(0,s.getIndexBasedSegment)(i,e,t,o),u.replacementTime=(d+o-1)*t.segmentDuration,u.media=l.media?l.media:"",u.mediaRange=l.mediaRange,u.index=l.index,u.indexRange=l.indexRange,p.push(u),u=null;return t.availableSegmentsNumber=m,p}var i=t.timelineConverter;return{getSegments:n}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r),s=t(35);i.__dashjs_factory_name="ListSegmentsGetter";var o=a.default.getClassFactory(i);n.default=o,e.exports=n.default},{10:10,35:35}],34:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){function n(t,e,n,r,a){var u,c=t.segmentInfoType;return"SegmentBase"!==c&&"BaseURL"!==c&&i(t,n)?("SegmentTimeline"===c?u=s.getSegments(t,e,n,a):"SegmentTemplate"===c?u=o.getSegments(t,e,n,a):"SegmentList"===c&&(u=l.getSegments(t,e,n,a)),r&&r(t,u)):u=t.segments,u}function i(t,e){var n,i,r=t.segments,a=!1;return r&&0!==r.length?(i=r[0].availabilityIdx,n=r[r.length-1].availabilityIdx,a=e<i||e>n):a=!0,a}var r=this.context,a=void 0,s=void 0,o=void 0,l=void 0;return a={getSegments:n},function(){s=(0,u.default)(r).create(t,e),o=(0,c.default)(r).create(t,e),l=(0,f.default)(r).create(t,e)}(),a}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(38),u=i(o),l=t(36),c=i(l),h=t(33),f=i(h);r.__dashjs_factory_name="SegmentsGetter";var d=s.default.getClassFactory(r);n.default=d,e.exports=n.default},{10:10,33:33,36:36,38:38}],35:[function(t,e,n){function i(t,e){for(;t.length<e;)t="0"+t;return t}function r(t,e){return t.representation.startNumber+e}function a(t,e,n){for(var r=void 0,a=void 0,s=void 0,o=void 0,u=void 0,l=void 0,c=e.length,h="%0".length;;){if((r=t.indexOf("$"+e))<0)return t;if((a=t.indexOf("$",r+c))<0)return t;if((s=t.indexOf("%0",r+c))>r&&s<a)switch(o=t.charAt(a-1),u=parseInt(t.substring(s+h,a-1),10),o){case"d":case"i":case"u":l=i(n.toString(),u);break;case"x":l=i(n.toString(16),u);break;case"X":l=i(n.toString(16),u).toUpperCase();break;case"o":l=i(n.toString(8),u);break;default:return t}else l=n;t=t.substring(0,r)+l+t.substring(a+1)}}function s(t,e,n,i){var a,s,o,u;return s=n.segmentDuration,isNaN(s)&&(s=n.adaptation.period.duration),o=n.adaptation.period.start+i*s,u=o+s,a=new f.default,a.representation=n,a.duration=s,a.presentationStartTime=o,a.mediaStartTime=t.calcMediaTimeFromPresentationTime(a.presentationStartTime,n),a.availabilityStartTime=t.calcAvailabilityStartTimeFromPresentationTime(a.presentationStartTime,n.adaptation.period.mpd,e),a.availabilityEndTime=t.calcAvailabilityEndTimeFromPresentationTime(u,n.adaptation.period.mpd,e),a.wallStartTime=t.calcWallTimeForSegment(a,e),a.replacementNumber=r(a,i),a.availabilityIdx=i,a}function o(t,e,n,i,s,o,u,l,c){var h,d,g,m=i/o,p=Math.min(s/o,n.adaptation.period.mpd.maxSegmentDuration);return h=t.calcPresentationTimeFromMediaTime(m,n),d=h+p,g=new f.default,g.representation=n,g.duration=p,g.mediaStartTime=m,g.presentationStartTime=h,g.availabilityStartTime=n.adaptation.period.mpd.manifest.loadedTime,g.availabilityEndTime=t.calcAvailabilityEndTimeFromPresentationTime(d,n.adaptation.period.mpd,e),g.wallStartTime=t.calcWallTimeForSegment(g,e),g.replacementTime=i,g.replacementNumber=r(g,c),u=a(u,"Number",g.replacementNumber),u=a(u,"Time",g.replacementTime),g.media=u,g.mediaRange=l,g.availabilityIdx=c,g}function u(t,e){if(!e||!e.segments)return null;var n,i,r=e.segments.length;if(t<r&&(n=e.segments[t])&&n.availabilityIdx===t)return n;for(i=0;i<r;i++)if((n=e.segments[i])&&n.availabilityIdx===t)return n;return null}function l(t,e,n,i,r){var a,s,o=r||10,u=Number.POSITIVE_INFINITY;return e&&!t.isTimeSyncCompleted()?{start:0,end:u}:!e&&n||i<0?null:(a=Math.max(i-2,0),s=Math.min(i+o,u),{start:a,end:s})}function c(t,e,n,i,r,a){var s,o,l=n.segmentDuration,c=n.adaptation.period.mpd.manifest.minBufferTime,h=n.segmentAvailabilityRange,f={start:t.calcPeriodRelativeTimeFromMpdRelativeTime(n,h.start),end:t.calcPeriodRelativeTimeFromMpdRelativeTime(n,h.end)},d=n.segments,g=2*l,m=a||Math.max(2*c,10*l),p=NaN,b=null;return f.start=Math.max(f.start,0),e&&!t.isTimeSyncCompleted()?(s=Math.floor(f.start/l),o=Math.floor(f.end/l),{start:s,end:o}):(d&&d.length>0?(b=u(r,n),p=b?t.calcPeriodRelativeTimeFromMpdRelativeTime(n,b.presentationStartTime):r>0?r*l:t.calcPeriodRelativeTimeFromMpdRelativeTime(n,i)):p=r>0?r*l:e?f.end:f.start,s=Math.floor(Math.max(p-g,f.start)/l),o=Math.floor(Math.min(s+m/l,f.end/l)),{start:s,end:o})}Object.defineProperty(n,"__esModule",{value:!0}),n.replaceTokenForTemplate=a,n.getIndexBasedSegment=s,n.getTimeBasedSegment=o,n.getSegmentByIndex=u,n.decideSegmentListRangeForTimeline=l,n.decideSegmentListRangeForTemplate=c;var h=t(46),f=function(t){return t&&t.__esModule?t:{default:t}}(h)},{46:46}],36:[function(t,e,n){function i(t,e){function n(t,n,r,a){var o,u,l,c,h,f=t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].SegmentTemplate,d=t.segmentDuration,g=t.segmentAvailabilityRange,m=[],p=null,b=null;for(h=t.startNumber,o=isNaN(d)&&!e?{start:h,end:h}:(0,s.decideSegmentListRangeForTemplate)(i,e,t,n,r,a),l=o.start,c=o.end,u=l;u<=c;u++)b=(0,s.getIndexBasedSegment)(i,e,t,u),b.replacementTime=(h+u-1)*t.segmentDuration,p=f.media,p=(0,s.replaceTokenForTemplate)(p,"Number",b.replacementNumber),p=(0,s.replaceTokenForTemplate)(p,"Time",b.replacementTime),b.media=p,m.push(b),b=null;return isNaN(d)?t.availableSegmentsNumber=1:t.availableSegmentsNumber=Math.ceil((g.end-g.start)/d),m}var i=t.timelineConverter;return{getSegments:n}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r),s=t(35);i.__dashjs_factory_name="TemplateSegmentsGetter";var o=a.default.getClassFactory(i);n.default=o,e.exports=n.default},{10:10,35:35}],37:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){S=0,w=!1,M=NaN,x.on(u.default.LIVE_EDGE_SEARCH_COMPLETED,_,this),x.on(u.default.TIME_SYNCHRONIZATION_COMPLETED,v,this)}function e(){return w}function n(t){w=t}function i(){return S}function r(){return M}function a(t){M=t}function o(t,e,n,i){return i?n&&e.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(e.availabilityStartTime.getTime()+1e3*(t+e.timeShiftBufferDepth)):e.availabilityEndTime:n?new Date(e.availabilityStartTime.getTime()+1e3*(t-S)):e.availabilityStartTime}function l(t,e,n){return o.call(this,t,e,n)}function c(t,e,n){return o.call(this,t,e,n,!0)}function h(t,e){return(t.getTime()-e.mpd.availabilityStartTime.getTime()+1e3*S)/1e3}function f(t,e){return t+(e.adaptation.period.start-e.presentationTimeOffset)}function d(t,e){return t-e.adaptation.period.start+e.presentationTimeOffset}function g(t,e){var n,i,r;return e&&(n=t.representation.adaptation.period.mpd.suggestedPresentationDelay,i=t.presentationStartTime+n,r=new Date(t.availabilityStartTime.getTime()+1e3*i)),r}function m(t,e){var n,i,r=t.adaptation.period.start,a=r+t.adaptation.period.duration,s={start:r,end:a},o=t.segmentDuration||(t.segments&&t.segments.length?t.segments[t.segments.length-1].duration:0);if(!e)return s;if(!w&&t.segmentAvailabilityRange)return t.segmentAvailabilityRange;n=t.adaptation.period.mpd.checkTime,i=h(new Date,t.adaptation.period),r=Math.max(i-t.adaptation.period.mpd.timeShiftBufferDepth,t.adaptation.period.start);var u=isNaN(n)?i:Math.min(n,i),l=t.adaptation.period.start+t.adaptation.period.duration;return a=(u>=l&&u-o<l?l:u)-o,s={start:r,end:a}}function p(t,e){return e-t.adaptation.period.start}function b(t,e){return e+t.adaptation.period.start}function _(t){w||t.error||(S+=t.liveEdge-(M+t.searchTime),w=!0)}function v(t){w||t.error||(S=t.offset/1e3,w=!0)}function y(t){var e=t.presentationTimeOffset;return t.adaptation.period.start-e}function E(){x.off(u.default.LIVE_EDGE_SEARCH_COMPLETED,_,this),x.off(u.default.TIME_SYNCHRONIZATION_COMPLETED,v,this),S=0,w=!1,M=NaN}var T=this.context,x=(0,s.default)(T).getInstance(),S=void 0,w=void 0,M=void 0;return{initialize:t,isTimeSyncCompleted:e,setTimeSyncCompleted:n,getClientTimeOffset:i,getExpectedLiveEdge:r,setExpectedLiveEdge:a,calcAvailabilityStartTimeFromPresentationTime:l,calcAvailabilityEndTimeFromPresentationTime:c,calcPresentationTimeFromWallTime:h,calcPresentationTimeFromMediaTime:f,calcPeriodRelativeTimeFromMpdRelativeTime:p,calcMpdRelativeTimeFromPeriodRelativeTime:b,calcMediaTimeFromPresentationTime:d,calcSegmentAvailabilityRange:m,calcWallTimeForSegment:g,calcMSETimeOffset:y,reset:E}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(9),s=i(a),o=t(13),u=i(o),l=t(10),c=i(l);r.__dashjs_factory_name="TimelineConverter",n.default=c.default.getSingletonFactory(r),e.exports=n.default},{10:10,13:13,9:9}],38:[function(t,e,n){function i(t,e){function n(t,n,r,a){var o,u,l,c,h,f,d,g,m,p,b,_,v,y,E=t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].SegmentTemplate||t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].SegmentList,T=E.SegmentTimeline,x=E.SegmentURL_asArray,S=t.availableSegmentsNumber>0,w=0,M=0,C=-1,R=[],O=!1,A=function(n,r){var a=E.media,o=n.mediaRange;return x&&(a=x[r].media||"",o=x[r].mediaRange),(0,s.getTimeBasedSegment)(i,e,t,w,n.d,y,a,o,C)};for(y=t.timescale,o=T.S_asArray,m=(0,s.decideSegmentListRangeForTimeline)(i,e,n,r,a),m?(_=m.start,v=m.end):b=i.calcMediaTimeFromPresentationTime(n||0,t),l=0,c=o.length;l<c;l++){if(u=o[l],f=0,u.hasOwnProperty("r")&&(f=u.r),u.hasOwnProperty("t")&&(w=u.t,M=w/y),f<0){if((g=o[l+1])&&g.hasOwnProperty("t"))d=g.t/y;else{var j=t.segmentAvailabilityRange?t.segmentAvailabilityRange.end:i.calcSegmentAvailabilityRange(t,e).end;d=i.calcMediaTimeFromPresentationTime(j,t),t.segmentDuration=u.d/y}f=Math.ceil((d-M)/(u.d/y))-1}if(p){if(S)break;C+=f+1}else for(h=0;h<=f;h++){if(C++,m){if(C>v){if(p=!0,S)break;continue}C>=_&&R.push(A(u,C))}else{if(R.length>10){if(p=!0,S)break;continue}O?R.push(A(u,C)):M>=b-u.d/y*1.5&&(O=!0,R.push(A(u,C)))}w+=u.d,M=w/y}}return S||(t.availableSegmentsNumber=C+1),R}var i=t.timelineConverter;return{getSegments:n}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r),s=t(35);i.__dashjs_factory_name="TimelineSegmentsGetter";var o=a.default.getClassFactory(i);n.default=o,e.exports=n.default},{10:10,35:35}],39:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.period=null,this.index=-1,this.type=null};n.default=r,e.exports=n.default},{}],40:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(e,n,r,a){i(this,t),this.url=e||"",this.serviceLocation=n||e||"",this.dvb_priority=r||1,this.dvb_weight=a||1};r.DEFAULT_DVB_PRIORITY=1,r.DEFAULT_DVB_WEIGHT=1,n.default=r,e.exports=n.default},{}],41:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN};n.default=r,e.exports=n.default},{}],42:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""};n.default=r,e.exports=n.default},{}],43:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=NaN,this.clientServerTimeShift=0,this.isClientServerTimeSyncCompleted=!1};n.default=r,e.exports=n.default},{}],44:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null};r.DEFAULT_ID="defaultId",n.default=r,e.exports=n.default},{}],45:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0,this.bandwidth=NaN,this.maxPlayoutRate=NaN};n.default=r,e.exports=n.default},{}],46:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null};n.default=r,e.exports=n.default},{}],47:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.schemeIdUri="",this.value=""};n.default=r,e.exports=n.default},{}],48:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t){var e=function(e){o.trigger(g.default.CHECK_FOR_EXISTENCE_COMPLETED,{request:t,exists:e})};if(t){var n=new u.default(t.url);h.load({request:n,success:function(){e(!0)},error:function(){e(!1)}})}else e(!1)}function n(t){var e=function(e,n){o.trigger(g.default.LOADING_COMPLETED,{request:t,response:e||null,error:n||null,sender:l})};t?h.load({request:t,progress:function(){o.trigger(g.default.LOADING_PROGRESS,{request:t})},success:function(t){e(t)},error:function(t,n,i){e(void 0,new c.default(b,i,n))}}):e(void 0,new c.default(_,v))}function i(){h&&h.abort()}function r(){h&&(h.abort(),h=null)}var a=this.context,o=(0,f.default)(a).getInstance(),l=void 0,h=void 0;return l={checkForExistence:e,load:n,abort:i,reset:r},function(){h=(0,s.default)(a).create({errHandler:t.errHandler,metricsModel:t.metricsModel,requestModifier:t.requestModifier})}(),l}Object.defineProperty(n,"__esModule",{value:!0});var a=t(58),s=i(a),o=t(164),u=i(o),l=t(162),c=i(l),h=t(9),f=i(h),d=t(13),g=i(d),m=t(10),p=i(m),b=1,_=2,v="request is null";r.__dashjs_factory_name="FragmentLoader";var y=p.default.getClassFactory(r);y.FRAGMENT_LOADER_ERROR_LOADING_FAILURE=b,y.FRAGMENT_LOADER_ERROR_NULL_REQUEST=_,n.default=y,e.exports=n.default},{10:10,13:13,162:162,164:164,58:58,9:9}],49:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t){a.trigger(v.default.INTERNAL_MANIFEST_LOADED,{manifest:t.manifest})}function n(t){var e=new f.default(t,m.HTTPRequest.MPD_TYPE);d.load({request:e,success:function(e,n,i){var r,s;i.responseURL&&i.responseURL!==t?(s=o.parseBaseUrl(i.responseURL),r=i.responseURL):(o.isRelative(t)&&(t=o.parseBaseUrl(window.location.href)+t),s=o.parseBaseUrl(t));var u=l.parse(e,p);u?(u.url=r||t,u.originalUrl||(u.originalUrl=u.url),u.baseUri=s,u.loadedTime=new Date,p.resolveManifestOnLoad(u)):a.trigger(v.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new g.default(T,S)})},error:function(e,n,i){a.trigger(v.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new g.default(x,"Failed loading manifest: "+t+", "+i)})}})}function i(){a.off(v.default.XLINK_READY,e,h),p&&(p.reset(),p=null),d&&(d.abort(),d=null)}var r=this.context,a=(0,b.default)(r).getInstance(),o=(0,c.default)(r).getInstance(),l=t.parser,h=void 0,d=void 0,p=void 0;return h={load:n,reset:i},function(){a.on(v.default.XLINK_READY,e,h),d=(0,u.default)(r).create({errHandler:t.errHandler,metricsModel:t.metricsModel,requestModifier:t.requestModifier}),p=(0,s.default)(r).create({errHandler:t.errHandler,metricsModel:t.metricsModel,requestModifier:t.requestModifier})}(),h}Object.defineProperty(n,"__esModule",{value:!0});var a=t(74),s=i(a),o=t(58),u=i(o),l=t(158),c=i(l),h=t(170),f=i(h),d=t(162),g=i(d),m=t(179),p=t(9),b=i(p),_=t(13),v=i(_),y=t(10),E=i(y),T=1,x=2,S="parsing failed";r.__dashjs_factory_name="ManifestLoader";var w=E.default.getClassFactory(r);w.MANIFEST_LOADER_ERROR_PARSING_FAILURE=T,w.MANIFEST_LOADER_ERROR_LOADING_FAILURE=x,n.default=w,e.exports=n.default},{10:10,13:13,158:158,162:162,170:170,179:179,58:58,74:74,9:9}],50:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){
t&&(t.manifestModel&&(S=t.manifestModel),t.dashManifestModel&&(w=t.dashManifestModel))}function e(t){x=t,v=NaN,y=null,T=!1,E=!0,_.on(u.default.STREAMS_COMPOSED,m,this),_.on(u.default.PLAYBACK_STARTED,d,this),_.on(u.default.PLAYBACK_PAUSED,g,this),_.on(u.default.INTERNAL_MANIFEST_LOADED,h,this)}function n(t){l(t)}function i(){return x}function r(){_.off(u.default.PLAYBACK_STARTED,d,this),_.off(u.default.PLAYBACK_PAUSED,g,this),_.off(u.default.STREAMS_COMPOSED,m,this),_.off(u.default.INTERNAL_MANIFEST_LOADED,h,this),E=!0,T=!1,a(),v=NaN}function a(){null!==y&&(clearInterval(y),y=null)}function o(){a(),isNaN(v)||(b("Refresh manifest in "+v+" seconds."),y=setTimeout(c,Math.min(1e3*v,Math.pow(2,31)-1),this))}function l(t){var e,n,i=new Date;S.setValue(t),b("Manifest has been refreshed at "+i+"["+i.getTime()/1e3+"] "),e=w.getRefreshDelay(t),n=((new Date).getTime()-t.loadedTime.getTime())/1e3,v=Math.max(e-n,0),_.trigger(u.default.MANIFEST_UPDATED,{manifest:t}),E||o()}function c(){var t,e;if(!E&&!T){T=!0,t=S.getValue(),e=t.url;var n=w.getLocation(t);n&&(e=n),x.load(e)}}function h(t){t.error||l(t.manifest)}function d(){E=!1,o()}function g(){E=!0,a()}function m(){T=!1}var p=this.context,b=(0,f.default)(p).getInstance().log,_=(0,s.default)(p).getInstance(),v=void 0,y=void 0,E=void 0,T=void 0,x=void 0,S=void 0,w=void 0;return{initialize:e,setManifest:n,getManifestLoader:i,setConfig:t,reset:r}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(9),s=i(a),o=t(13),u=i(o),l=t(10),c=i(l),h=t(8),f=i(h);r.__dashjs_factory_name="ManifestUpdater",n.default=c.default.getSingletonFactory(r),e.exports=n.default},{10:10,13:13,8:8,9:9}],51:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,e,n){return cn=(0,y.default)(He).getInstance(),ln=(0,_.default)(He).getInstance(),cn.supportsMediaSource()?void(Ze||(Ze=!0,en=(0,F.default)(He).getInstance(),dn=(0,u.default)(He).getInstance(),nn=(0,f.default)(He).getInstance(),nn.initialize(),mn=(0,mt.default)(He).getInstance(),gn=(0,bt.default)(He).getInstance(),on=(0,D.default)(He).getInstance(),on.setConfig({adapter:Le()}),ne(),ft(void 0===n||n),t&&Se(t),e&&Re(e),Ke("[dash.js "+U()+"] MediaPlayer has been initialized"))):void ln.capabilityError("mediasource")}function e(){return!!pn&&!!Ye}function n(){if(!Je)throw Ue;(!tn||r()&&Je)&&dn.play()}function i(){if(!Je)throw Ue;dn.pause()}function r(){if(!Je)throw Ue;return dn.isPaused()}function a(){if(!Je)throw Ue;return dn.isSeeking()}function o(t){if(!pn)throw ze;xe().muted=t}function l(){if(!pn)throw ze;return xe().muted}function h(t){if(!pn)throw ze;xe().volume=t}function d(){if(!pn)throw ze;return xe().volume}function m(t){var e=["video","audio","fragmentedText"];if(t){if(-1!==e.indexOf(t)){var n=yt().getCurrentBufferLevel(Et(t));return n||NaN}return Ke("Warning  - getBufferLength requested for invalid type"),NaN}return e.map(function(t){return Nt(t).length>0?yt().getCurrentBufferLevel(Et(t)):Number.MAX_VALUE}).reduce(function(t,e){return Math.min(t,e)})}function b(){var t=ke();return t?t.manifestInfo.DVRWindowSize:0}function v(t){var e=ke();if(!e)return 0;var n=e.range.start+t;return n>e.range.end&&(n=e.range.end),n}function E(t){if(!Je)throw Ue;var e=dn.getIsDynamic()?v(t):t;dn.seek(e)}function x(t){if(!Je)throw Ue;var e=xe().currentTime;if(void 0!==t)e=hn.getTimeRelativeToStreamId(e,t);else if(dn.getIsDynamic()){var n=ke();e=null===n?0:w()-(n.range.end-n.time)}return e}function w(){if(!Je)throw Ue;var t=xe().duration;if(dn.getIsDynamic()){var e,n=ke();if(!n)return 0;e=n.range.end-n.range.start,t=e<n.manifestInfo.DVRWindowSize?e:n.manifestInfo.DVRWindowSize}return t}function C(){if(!Je)throw Ue;return x()<0?NaN:Fe(x())}function O(){if(!Je)throw Ue;return Fe(w())}function j(t,e,n){var i=new Date(1e3*t),r=i.toLocaleDateString(e);return i.toLocaleTimeString(e,{hour12:n})+" "+r}function P(t){t=Math.max(t,0);var e=Math.floor(t/3600),n=Math.floor(t%3600/60),i=Math.floor(t%3600%60);return(0===e?"":e<10?"0"+e.toString()+":":e.toString()+":")+(n<10?"0"+n.toString():n.toString())+":"+(i<10?"0"+i.toString():i.toString())}function N(t,e,n){ut.default.extend(t,e,n,He)}function k(t,e,n){qe.on(t,e,n)}function V(t,e,n){qe.off(t,e,n)}function U(){return(0,lt.getVersionString)()}function G(){return Xe}function H(){if(!pn)throw ze;return pn}function X(t){un.setLiveDelayFragmentCount(t)}function W(t){un.setLiveDelay(t)}function Q(t){un.setUseSuggestedPresentationDelay(t)}function J(t,e){un.setLastBitrateCachingInfo(t,e)}function et(t,e){un.setLastMediaSettingsCachingInfo(t,e)}function it(t,e){en.setMaxAllowedBitrateFor(t,e)}function at(t){return en.getMaxAllowedBitrateFor(t)}function ot(t,e){en.setMaxAllowedRepresentationRatioFor(t,e)}function ct(t){return en.getMaxAllowedRepresentationRatioFor(t)}function ft(t){tn=t}function gt(){return tn}function pt(t){un.setScheduleWhilePaused(t)}function _t(){return un.getScheduleWhilePaused()}function yt(){return gn}function Et(t){return on.getReadOnlyMetricsFor(t)}function Tt(t){if(!Je)throw Ue;return en.getQualityFor(t,hn.getActiveStreamInfo())}function xt(t,e){if(!Je)throw Ue;en.setPlaybackQuality(t,hn.getActiveStreamInfo(),e)}function St(){return en.getLimitBitrateByPortal()}function wt(t){en.setLimitBitrateByPortal(t)}function Mt(){return en.getUsePixelRatioInLimitBitrateByPortal()}function Ct(t){en.setUsePixelRatioInLimitBitrateByPortal(t)}function Rt(t){if(!Je)throw Ue;void 0===bn&&(bn=(0,R.default)(He).getInstance());for(var e=xe().textTracks,n=e.length,i=0;i<n;i++){var r=e[i],a=t===i?"showing":"hidden";r.mode!==a&&(r.mode=a)}bn.setTextTrack()}function Ot(t){if(!Je)throw Ue;var e=Ve();return e?e.getBitrateListFor(t):[]}function At(t,e){en.setInitialBitrateFor(t,e)}function jt(t){if(!Je)throw Ue;return en.getInitialBitrateFor(t)}function It(t,e){en.setInitialRepresentationRatioFor(t,e)}function Pt(t){return en.getInitialRepresentationRatioFor(t)}function Lt(t){if(!Je)throw Ue;return sn.getStreamsInfo(t)}function Nt(t){if(!Je)throw Ue;var e=hn.getActiveStreamInfo();return e?nn.getTracksFor(t,e):[]}function Dt(t,e,n){if(!Je)throw Ue;return n=n||sn.getStreamsInfo(e)[0],n?sn.getAllMediaInfoForType(e,n,t):[]}function kt(t){if(!Je)throw Ue;var e=hn.getActiveStreamInfo();return e?nn.getCurrentTrackFor(t,e):null}function Ft(t,e){nn.setInitialSettings(t,e)}function Vt(t){return nn.getInitialSettings(t)}function Bt(t){if(!Je)throw Ue;nn.setTrack(t)}function Ut(t){return nn.getSwitchMode(t)}function zt(t,e){nn.setSwitchMode(t,e)}function Gt(t){nn.setSelectionModeForInitialTrack(t)}function $t(){return nn.getSelectionModeForInitialTrack()}function Ht(){return en.getAutoSwitchBitrateFor("video")||en.getAutoSwitchBitrateFor("audio")}function qt(t){en.setAutoSwitchBitrateFor("video",t),en.setAutoSwitchBitrateFor("audio",t)}function Xt(t){return en.getAutoSwitchBitrateFor(t)}function Kt(t,e){en.setAutoSwitchBitrateFor(t,e)}function Wt(t){un.setFastSwitchEnabled(t)}function Yt(){return un.getFastSwitchEnabled()}function Qt(t){un.setBufferOccupancyABREnabled(t)}function Zt(t,e){var n=Ie(),i=this,r=function t(r){r.error?e(null,r.error):e(r.manifest),qe.off(rt.default.INTERNAL_MANIFEST_LOADED,t,i),n.reset()};qe.on(rt.default.INTERNAL_MANIFEST_LOADED,r,i);var a=(0,A.default)(He).getInstance();a.initialize(),n.load(a.parseURI(t))}function Jt(t,e){te(t,e);var n=new s.default;n.schemeIdUri=t,n.value=e,un.getUTCTimingSources().push(n)}function te(t,e){var n=un.getUTCTimingSources();n.forEach(function(i,r){i.schemeIdUri===t&&i.value===e&&n.splice(r,1)})}function ee(){un.setUTCTimingSources([])}function ne(){Jt(L.default.DEFAULT_UTC_TIMING_SOURCE.scheme,L.default.DEFAULT_UTC_TIMING_SOURCE.value)}function ie(t){un.setUseManifestDateHeaderTimeSource(t)}function re(t){un.setBufferToKeep(t)}function ae(t){un.setBufferPruningInterval(t)}function se(t){un.setStableBufferTime(t)}function oe(t){un.setBufferTimeAtTopQuality(t)}function ue(t){un.setBufferTimeAtTopQualityLongForm(t)}function le(t){un.setLongFormContentDurationThreshold(t)}function ce(t){un.setRichBufferThreshold(t)}function he(t){un.setBandwidthSafetyFactor(t)}function fe(){return un.getBandwidthSafetyFactor()}function de(t){un.setAbandonLoadTimeout(t)}function ge(t){un.setFragmentRetryAttempts(t)}function me(t){un.setFragmentRetryInterval(t)}function pe(t){un.setXHRWithCredentials(t)}function be(){return Ne()}function _e(t){rn=t}function ve(t){Qe=t}function ye(t){var e=(0,T.default)(He).getInstance();e.setConfig({videoModel:pn}),e.initialize(),e.displayCConTop(t)}function Ee(){return pn?pn.getVideoContainer():null}function Te(t){if(!pn)throw ze;pn.setVideoContainer(t)}function xe(){if(!pn)throw ze;return pn.getElement()}function Se(t){if(!Ze)throw $e;pn=null,t&&(pn=(0,$.default)(He).getInstance(),pn.initialize(),pn.setElement(t),Ne(),De()),Ae()}function we(){return pn?pn.getTTMLRenderingDiv():null}function Me(t){if(!pn)throw ze;pn.setTTMLRenderingDiv(t)}function Ce(){if(!Ye)throw Ge;return Ye}function Re(t){if(!Ze)throw $e;if("string"==typeof t){var e=(0,A.default)(He).getInstance();e.initialize(),Ye=e.parseURI(t)}else Ye=t;Ae()}function Oe(){Re(null),Se(null),Qe=null,rn=null}function Ae(){Je?(Je=!1,sn.reset(),hn.reset(),dn.reset(),en.reset(),fn.reset(),nn.reset(),hn=null,an=null,e()&&Be()):e()&&Be()}function je(){var t=(0,K.default)(He).getInstance();t.initialize();var e=(0,z.default)(He).getInstance();e.initialize(),(0,S.default)(He).getInstance().setConfig({dashManifestModel:mn}),nn.initialize(),nn.setConfig({errHandler:ln}),fn=(0,q.default)(He).getInstance(),fn.initialize(),fn.setConfig({abrRulesCollection:e,synchronizationRulesCollection:t}),hn=(0,c.default)(He).getInstance(),hn.setConfig({capabilities:cn,manifestLoader:Ie(),manifestModel:(0,I.default)(He).getInstance(),dashManifestModel:mn,protectionController:rn,adapter:sn,metricsModel:on,dashMetrics:gn,liveEdgeFinder:(0,p.default)(He).getInstance(),mediaSourceController:(0,Y.default)(He).getInstance(),timeSyncController:(0,B.default)(He).getInstance(),baseURLController:(0,Z.default)(He).getInstance(),errHandler:ln,timelineConverter:(0,vt.default)(He).getInstance()}),hn.initialize(tn,Qe),en.setConfig({abrRulesCollection:e,rulesController:fn,streamController:hn})}function Ie(){return(0,g.default)(He).create({errHandler:ln,parser:Pe(),metricsModel:on,requestModifier:(0,M.default)(He).getInstance()})}function Pe(){return(0,dt.default)(He).create()}function Le(){return sn=(0,ht.default)(He).getInstance(),sn.initialize(),sn.setConfig({dashManifestModel:mn}),sn}function Ne(){if(rn)return rn;var t=dashjs.Protection;if("function"==typeof t){var e=t(He).create();return rt.default.extend(t.events),st.default.extend(t.events,{publicOnly:!0}),rn=e.createProtectionSystem({log:Ke,videoModel:pn,capabilities:cn,eventBus:qe,adapter:sn})}return null}function De(){if(an)return an;var t=dashjs.MetricsReporting;if("function"==typeof t){var e=t(He).create();return an=e.createMetricsReporting({log:Ke,eventBus:qe,mediaElement:xe(),dashManifestModel:mn,metricsModel:on})}return null}function ke(){var t=on.getReadOnlyMetricsFor("video")||on.getReadOnlyMetricsFor("audio");return gn.getCurrentDVRInfo(t)}function Fe(t){var e,n=ke();return n?(e=n.manifestInfo.availableFrom.getTime()/1e3,t+(e+n.range.start)):0}function Ve(){if(!Je)throw Ue;var t=hn.getActiveStreamInfo();return t?hn.getStreamById(t.id):null}function Be(){Je||(Je=!0,Ke("Playback Initialized"),je(),"string"==typeof Ye?hn.load(Ye):hn.loadWithManifest(Ye))}var Ue="You must first call play() to init playback before calling this method",ze="You must first call attachView() to set the video element before calling this method",Ge="You must first call attachSource() with a valid source before calling this method",$e="MediaPlayer not initialized!",He=this.context,qe=(0,nt.default)(He).getInstance(),Xe=(0,tt.default)(He).getInstance(),Ke=Xe.log,We=void 0,Ye=void 0,Qe=void 0,Ze=void 0,Je=void 0,tn=void 0,en=void 0,nn=void 0,rn=void 0,an=void 0,sn=void 0,on=void 0,un=void 0,ln=void 0,cn=void 0,hn=void 0,fn=void 0,dn=void 0,gn=void 0,mn=void 0,pn=void 0,bn=void 0;return We={initialize:t,on:k,off:V,extend:N,attachView:Se,attachSource:Re,isReady:e,play:n,isPaused:r,pause:i,isSeeking:a,seek:E,setMute:o,isMuted:l,setVolume:h,getVolume:d,time:x,duration:w,timeAsUTC:C,durationAsUTC:O,getActiveStream:Ve,getDVRWindowSize:b,getDVRSeekOffset:v,convertToTimeCode:P,formatUTC:j,getVersion:U,getDebug:G,getBufferLength:m,getVideoModel:H,getVideoContainer:Ee,getTTMLRenderingDiv:we,getVideoElement:xe,getSource:Ce,setLiveDelayFragmentCount:X,setLiveDelay:W,useSuggestedPresentationDelay:Q,enableLastBitrateCaching:J,enableLastMediaSettingsCaching:et,setMaxAllowedBitrateFor:it,getMaxAllowedBitrateFor:at,setMaxAllowedRepresentationRatioFor:ot,getMaxAllowedRepresentationRatioFor:ct,setAutoPlay:ft,getAutoPlay:gt,setScheduleWhilePaused:pt,getScheduleWhilePaused:_t,getDashMetrics:yt,getMetricsFor:Et,getQualityFor:Tt,setQualityFor:xt,getLimitBitrateByPortal:St,setLimitBitrateByPortal:wt,getUsePixelRatioInLimitBitrateByPortal:Mt,setUsePixelRatioInLimitBitrateByPortal:Ct,setTextTrack:Rt,getBitrateInfoListFor:Ot,setInitialBitrateFor:At,getInitialBitrateFor:jt,setInitialRepresentationRatioFor:It,getInitialRepresentationRatioFor:Pt,getStreamsFromManifest:Lt,getTracksFor:Nt,getTracksForTypeFromManifest:Dt,getCurrentTrackFor:kt,setInitialMediaSettingsFor:Ft,getInitialMediaSettingsFor:Vt,setCurrentTrack:Bt,getTrackSwitchModeFor:Ut,setTrackSwitchModeFor:zt,setSelectionModeForInitialTrack:Gt,getSelectionModeForInitialTrack:$t,getAutoSwitchQuality:Ht,setAutoSwitchQuality:qt,setFastSwitchEnabled:Wt,getFastSwitchEnabled:Yt,getAutoSwitchQualityFor:Xt,setAutoSwitchQualityFor:Kt,enableBufferOccupancyABR:Qt,setBandwidthSafetyFactor:he,getBandwidthSafetyFactor:fe,setAbandonLoadTimeout:de,retrieveManifest:Zt,addUTCTimingSource:Jt,removeUTCTimingSource:te,clearDefaultUTCTimingSources:ee,restoreDefaultUTCTimingSources:ne,setBufferToKeep:re,setBufferPruningInterval:ae,setStableBufferTime:se,setBufferTimeAtTopQuality:oe,setFragmentLoaderRetryAttempts:ge,setFragmentLoaderRetryInterval:me,setXHRWithCredentials:pe,setBufferTimeAtTopQualityLongForm:ue,setLongFormContentDurationThreshold:le,setRichBufferThreshold:ce,getProtectionController:be,attachProtectionController:_e,setProtectionData:ve,enableManifestDateHeaderTimeSource:ie,displayCaptionsOnTop:ye,attachVideoContainer:Te,attachTTMLRenderingDiv:Me,reset:Oe},function(){Ze=!1,Je=!1,tn=!0,rn=null,Qe=null,sn=null,rt.default.extend(st.default),un=(0,L.default)(He).getInstance()}(),We}Object.defineProperty(n,"__esModule",{value:!0});var a=t(47),s=i(a),o=t(68),u=i(o),l=t(71),c=i(l),h=t(66),f=i(h),d=t(49),g=i(d),m=t(154),p=i(m),b=t(151),_=i(b),v=t(147),y=i(v),E=t(57),T=i(E),x=t(70),S=i(x),w=t(156),M=i(w),C=t(56),R=i(C),O=t(103),A=i(O),j=t(100),I=i(j),P=t(101),L=i(P),N=t(102),D=i(N),k=t(60),F=i(k),V=t(73),B=i(V),U=t(131),z=i(U),G=t(104),$=i(G),H=t(129),q=i(H),X=t(144),K=i(X),W=t(67),Y=i(W),Q=t(61),Z=i(Q),J=t(8),tt=i(J),et=t(9),nt=i(et),it=t(13),rt=i(it),at=t(52),st=i(at),ot=t(10),ut=i(ot),lt=t(11),ct=t(15),ht=i(ct),ft=t(23),dt=i(ft),gt=t(22),mt=i(gt),pt=t(17),bt=i(pt),_t=t(37),vt=i(_t);r.__dashjs_factory_name="MediaPlayer";var yt=ut.default.getClassFactory(r);yt.events=st.default,n.default=yt,e.exports=n.default},{10:10,100:100,101:101,102:102,103:103,104:104,11:11,129:129,13:13,131:131,144:144,147:147,15:15,151:151,154:154,156:156,17:17,22:22,23:23,37:37,47:47,49:49,52:52,56:56,57:57,60:60,61:61,66:66,67:67,68:68,70:70,71:71,73:73,8:8,9:9}],52:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(14),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=function(t){function e(){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.BUFFER_EMPTY="bufferstalled",this.BUFFER_LOADED="bufferloaded",this.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",this.ERROR="error",this.LOG="log",this.MANIFEST_LOADED="manifestloaded",this.METRICS_CHANGED="metricschanged",this.METRIC_CHANGED="metricchanged",this.METRIC_ADDED="metricadded",this.METRIC_UPDATED="metricupdated",this.PERIOD_SWITCH_COMPLETED="streamswitchcompleted",this.PERIOD_SWITCH_STARTED="streamswitchstarted",this.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",this.QUALITY_CHANGE_RENDERED="qualityChangeRendered",this.STREAM_INITIALIZED="streaminitialized",this.TEXT_TRACKS_ADDED="alltexttracksadded",this.TEXT_TRACK_ADDED="texttrackadded",this.CAN_PLAY="canPlay",this.PLAYBACK_ENDED="playbackEnded",this.PLAYBACK_ERROR="playbackError",this.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",this.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",this.PLAYBACK_PAUSED="playbackPaused",this.PLAYBACK_PLAYING="playbackPlaying",this.PLAYBACK_PROGRESS="playbackProgress",this.PLAYBACK_RATE_CHANGED="playbackRateChanged",this.PLAYBACK_SEEKED="playbackSeeked",this.PLAYBACK_SEEKING="playbackSeeking",this.PLAYBACK_STARTED="playbackStarted",this.PLAYBACK_TIME_UPDATED="playbackTimeUpdated"}return r(e,t),e}(o.default),l=new u;n.default=l,e.exports=n.default},{14:14}],53:[function(t,e,n){function i(){window.removeEventListener("load",i),s.createAll()}Object.defineProperty(n,"__esModule",{value:!0});var r=t(51),a=function(t){return t&&t.__esModule?t:{default:t}}(r),s=function(){function t(t,e,n){if(!t||"VIDEO"!==t.nodeName)return null;if(t._dashjs_player)return t._dashjs_player;var r,s=t.id||t.name||"video element";if(!(e=e||[].slice.call(t.querySelectorAll("source")).filter(function(t){return t.type==i})[0])&&t.src)e=document.createElement("source"),e.src=t.src;else if(!e&&!t.src)return null;return n=n||{},r=(0,a.default)(n).create(),r.initialize(t,e.src,t.autoplay),r.getDebug().log("Converted "+s+" to dash.js player and added content: "+e.src),t._dashjs_player=r,r}function e(e,r){var a=[];e=e||"[data-dashjs-player]",r=r||document;for(var s=r.querySelectorAll(e),o=0;o<s.length;o++){var u=t(s[o],null);a.push(u)}for(var l=r.querySelectorAll('source[type="'+i+'"]'),o=0;o<l.length;o++){var c=n(l[o]),u=t(c,null);a.push(u)}return a}function n(t){for(var e=!0;e;){var n=t;if(e=!1,"video"===n.nodeName.toLowerCase())return n;t=n.parentNode,e=!0}}var i="application/dash+xml";return{create:t,createAll:e}}();!(window&&window.dashjs&&window.dashjs.skipAutoCreate)&&window&&window.addEventListener&&("complete"===window.document.readyState?s.createAll():window.addEventListener("load",i)),n.default=s,e.exports=n.default},{51:51}],54:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e){ht=t,(mt=e)&&(J.on(L.default.KEY_ERROR,C,ot),J.on(L.default.SERVER_CERTIFICATE_UPDATED,C,ot),J.on(L.default.LICENSE_REQUEST_COMPLETE,C,ot),J.on(L.default.KEY_SYSTEM_SELECTED,C,ot),J.on(L.default.KEY_SESSION_CREATED,C,ot))}function n(t){lt?$():(J.on(L.default.CURRENT_TRACK_CHANGED,P,ot),U(t))}function i(){for(var t=ut.length,e=0;e<t;e++)ut[e].reset();ut=[],lt=!1,ct=!1,E(),J.off(L.default.CURRENT_TRACK_CHANGED,P,ot)}function r(){bt&&(bt.pause(),bt=null),vt&&(vt.reset(),vt=null),pt.abortSearch(),i(),_t=null,Et=null,et=null,tt=null,nt=null,it=null,Z=null,rt=null,dt=!1,gt=!1,ft={},J.off(L.default.DATA_UPDATE_COMPLETED,q,ot),J.off(L.default.BUFFERING_COMPLETED,H,ot),J.off(L.default.KEY_ERROR,C,ot),J.off(L.default.SERVER_CERTIFICATE_UPDATED,C,ot),J.off(L.default.LICENSE_REQUEST_COMPLETE,C,ot),J.off(L.default.KEY_SYSTEM_SELECTED,C,ot),J.off(L.default.KEY_SESSION_CREATED,C,ot)}function a(){return ht.duration}function o(){return ht.start}function l(){return ht.index}function h(){return ht.id}function d(){return ht}function m(t){return null!==G(t)}function b(t){var e=G(t);return Et.getBitrateList(e)}function v(){yt&&yt.start()}function E(){yt&&yt.clear()}function x(){return lt}function w(){return gt}function C(t){t.error&&(rt.mediaKeySessionError(t.error),Z(t.error),r())}function O(t){return"text"===t.type?t.mimeType:t.type}function j(t,e,n){var i,r,a=t.type;if("muxed"===a&&t)return r="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",Z(r),rt.manifestError(r,"multiplexedrep",tt.getValue()),!1;if("text"===a||"fragmentedText"===a||"embeddedText"===a)return!0;if(i=t.codec,Z(a+" codec: "+i),t.contentProtection&&!it.supportsEncryptedMedia())rt.capabilityError("encryptedmedia");else if(!it.supportsCodec((0,_.default)(Q).getInstance().getElement(),i))return r=a+"Codec ("+i+") is not supported.",rt.manifestError(r,"codec",n),Z(r),!1;return!0}function P(t){if(t.newMediaInfo.streamInfo.id===ht.id){var e=X(t.oldMediaInfo);if(e){var n=bt.getTime(),i=e.getBuffer(),r=t.newMediaInfo,a=tt.getValue(),s=ut.indexOf(e),o=e.getMediaSource();"fragmentedText"!==r.type?(e.reset(!0),F(r,a,o,{buffer:i,replaceIdx:s,currentTime:n}),bt.seek(bt.getTime())):e.updateMediaInfo(a,r)}}}function N(t){return"webm"===t.split("/")[1].toLowerCase()}function k(t){var e=N(t.mimeType)?(0,R.default)(Q).getInstance():(0,M.default)(Q).getInstance();return e.setConfig({baseURLController:st,metricsModel:(0,y.default)(Q).getInstance()}),e.initialize(),(0,S.default)(Q).create({segmentBaseLoader:e,timelineConverter:at,dashMetrics:(0,A.default)(Q).getInstance(),metricsModel:(0,y.default)(Q).getInstance(),baseURLController:st})}function F(t,e,n,i){var r=(0,u.default)(Q).create({indexHandler:k(t),timelineConverter:at,adapter:nt,manifestModel:tt}),a=nt.getAllMediaInfoForType(e,ht,t.type);if(r.initialize(O(t),vt,n,ot,yt),Et.updateTopQualityIndex(t),i?(r.setBuffer(i.buffer),r.getIndexHandler().setCurrentTime(i.currentTime),ut[i.replaceIdx]=r):ut.push(r),"text"===t.type||"fragmentedText"===t.type){for(var s=void 0,o=0;o<a.length;o++)a[o].index===t.index&&(s=o),r.updateMediaInfo(e,a[o]);"fragmentedText"===t.type&&r.updateMediaInfo(e,a[s])}else r.updateMediaInfo(e,t);return r}function V(t,e){var n,i=tt.getValue(),r=nt.getAllMediaInfoForType(i,ht,t),a=null;if(!r||0===r.length)return void Z("No "+t+" data.");for(var s=0,o=r.length;s<o;s++)if(a=r[s],"embeddedText"===t)Tt.addEmbeddedTrack(a);else{if(!j(a,e,i))continue;_t.isMultiTrackSupportedByType(a.type)&&_t.addTrack(a,ht)}"embeddedText"!==t&&0!==_t.getTracksFor(t,ht).length&&(_t.checkInitialMediaSettingsForType(t,ht),n=_t.getCurrentTrackFor(t,ht),F(n,i,e))}function U(t){var e,n=tt.getValue();if(yt=(0,f.default)(Q).getInstance(),yt.initialize(),yt.setConfig({manifestModel:tt,manifestUpdater:et}),e=nt.getEventsFor(n,ht),yt.addInlineEvents(e),dt=!0,V("video",t),V("audio",t),V("text",t),V("fragmentedText",t),V("embeddedText",t),V("muxed",t),$(),ct=!0,dt=!1,0===ut.length){var i="No streams to play.";rt.manifestError(i,"nostreams",n),Z(i)}else pt.initialize(at,ut[0]),z()}function z(){var t=ut.length,e=!!ft.audio||!!ft.video,n=e?new Error(Y,"Data update failed",null):null,i=0;for(i;i<t;i++)if(ut[i].isUpdating()||dt)return;gt=!0,lt=!0,ct&&(mt&&mt.initialize(tt.getValue(),G("audio"),G("video")),J.trigger(L.default.STREAM_INITIALIZED,{streamInfo:ht,error:n}))}function G(t){for(var e=ut.length,n=null,i=0;i<e;i++)if(n=ut[i],n.getType()===t)return n.getMediaInfo();return null}function $(){for(var t=0,e=ut.length;t<e;t++)ut[t].createBuffer()}function H(t){if(t.streamInfo===ht){var e=K(),n=e.length,i=0;for(i;i<n;i++)if(!e[i].isBufferingCompleted())return;J.trigger(L.default.STREAM_BUFFERING_COMPLETED,{streamInfo:ht})}}function q(t){var e=t.sender.getStreamProcessor();e.getStreamInfo()===ht&&(ft[e.getType()]=t.error,z())}function X(t){return!!t&&K().filter(function(e){return e.getType()===t.type})[0]}function K(){var t,e,n=ut.length,i=[],r=0;for(r;r<n;r++)e=ut[r],"audio"!==(t=e.getType())&&"video"!==t&&"fragmentedText"!==t||i.push(e);return i}function W(t){Z("Manifest updated... updating data system wide.");var e=tt.getValue();if(lt=!1,dt=!0,gt=!1,ht=t,yt){var n=nt.getEventsFor(e,ht);yt.addInlineEvents(n)}for(var i=0,r=ut.length;i<r;i++){var a=ut[i],s=nt.getMediaInfoForType(e,ht,a.getType());Et.updateTopQualityIndex(s),a.updateMediaInfo(e,s)}dt=!1,z()}var Y=1,Q=this.context,Z=(0,D.default)(Q).getInstance().log,J=(0,I.default)(Q).getInstance(),tt=t.manifestModel,et=t.manifestUpdater,nt=t.adapter,it=t.capabilities,rt=t.errHandler,at=t.timelineConverter,st=t.baseURLController,ot=void 0,ut=void 0,lt=void 0,ct=void 0,ht=void 0,ft=void 0,dt=void 0,gt=void 0,mt=void 0,pt=void 0,bt=void 0,_t=void 0,vt=void 0,yt=void 0,Et=void 0,Tt=void 0;return ot={initialize:e,activate:n,deactivate:i,getDuration:a,getStartTime:o,getStreamIndex:l,getId:h,getStreamInfo:d,hasMedia:m,getBitrateListFor:b,startEventController:v,isActivated:x,isInitialized:w,updateData:W,reset:r,getProcessors:K},function(){ut=[],lt=!1,ct=!1,ht=null,ft={},dt=!1,gt=!1,pt=(0,s.default)(Q).getInstance(),bt=(0,T.default)(Q).getInstance(),Et=(0,p.default)(Q).getInstance(),_t=(0,c.default)(Q).getInstance(),vt=(0,g.default)(Q).create(),Tt=(0,B.default)(Q).getInstance(),J.on(L.default.BUFFERING_COMPLETED,H,ot),J.on(L.default.DATA_UPDATE_COMPLETED,q,ot)}(),ot}Object.defineProperty(n,"__esModule",{value:!0});var a=t(154),s=i(a),o=t(55),u=i(o),l=t(66),c=i(l),h=t(64),f=i(h),d=t(65),g=i(d),m=t(60),p=i(m),b=t(104),_=i(b),v=t(102),y=i(v),E=t(68),T=i(E),x=t(16),S=i(x),w=t(18),M=i(w),C=t(19),R=i(C),O=t(17),A=i(O),j=t(9),I=i(j),P=t(13),L=i(P),N=t(8),D=i(N),k=t(10),F=i(k),V=t(56),B=i(V);r.__dashjs_factory_name="Stream",n.default=F.default.getClassFactory(r),e.exports=n.default},{10:10,102:102,104:104,13:13,154:154,16:16,17:17,18:18,19:19,55:55,56:56,60:60,64:64,65:65,66:66,68:68,8:8,9:9}],55:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e,n,i,r){tt=t,nt=i,it=r,ut=e,Z=nt.getStreamInfo().manifestInfo.isDynamic,X.initialize(this),rt=(0,s.default)(q).getInstance(),rt.initialize(tt,this),at=H(t),st=(0,p.default)(q).create({metricsModel:(0,T.default)(q).getInstance(),manifestModel:Y,adapter:W,dashMetrics:(0,L.default)(q).getInstance(),dashManifestModel:(0,I.default)(q).getInstance(),timelineConverter:K,rulesController:(0,_.default)(q).getInstance(),mediaPlayerModel:(0,y.default)(q).getInstance()}),at.initialize(tt,n,this),st.initialize(tt,this),lt=(0,S.default)(q).create({metricsModel:(0,T.default)(q).getInstance(),errHandler:(0,F.default)(q).getInstance(),requestModifier:(0,M.default)(q).getInstance()}),ct=st.getFragmentModel(),ct.setLoader(lt),ot=(0,D.default)(q).create(),ot.initialize(this)}function n(t){X.reset(),at&&(at.reset(t),at=null),st&&(st.reset(),st=null),ot&&(ot.reset(),ot=null),ut=null,lt=null,it=null,nt=null,Z=null,J=null,et=[],tt=null}function i(){return ot.isUpdating()}function r(){return tt}function a(){return rt}function o(){return ot}function l(){return lt}function h(){return X}function d(){return ut}function m(){return at.getBuffer()}function b(t){at.setBuffer(t)}function v(){return at}function E(){return ct}function x(){return nt.getStreamInfo()}function w(t,e){e===J||e&&J&&e.type!==J.type||(J=e),-1===et.indexOf(e)&&et.push(e),W.updateData(t,this)}function C(){return et}function O(){return J}function j(){return at.getMediaSource()}function P(){return st}function N(){return it}function k(){st.start()}function V(){st.stop()}function B(){return W.getCurrentRepresentationInfo(Y.getValue(),ot)}function U(t){return W.getRepresentationInfoForQuality(Y.getValue(),ot,t)}function z(){return at.getIsBufferingCompleted()}function G(){return at.getBuffer()||at.createBuffer(J)}function $(){return Z}function H(t){return"video"===t||"audio"===t||"fragmentedText"===t?(0,u.default)(q).create({metricsModel:(0,T.default)(q).getInstance(),manifestModel:Y,sourceBufferController:(0,R.default)(q).getInstance(),errHandler:(0,F.default)(q).getInstance(),streamController:(0,c.default)(q).getInstance(),mediaController:(0,f.default)(q).getInstance(),adapter:W,textSourceBuffer:(0,A.default)(q).getInstance()}):(0,g.default)(q).create({errHandler:(0,F.default)(q).getInstance(),sourceBufferController:(0,R.default)(q).getInstance()})}var q=this.context,X=t.indexHandler,K=t.timelineConverter,W=t.adapter,Y=t.manifestModel,Q=void 0,Z=void 0,J=void 0,tt=void 0,et=void 0,nt=void 0,it=void 0,rt=void 0,at=void 0,st=void 0,ot=void 0,ut=void 0,lt=void 0,ct=void 0;return Q={initialize:e,isUpdating:i,getType:r,getBufferController:v,getABRController:a,getFragmentLoader:l,getFragmentModel:E,getScheduleController:P,getEventController:N,getFragmentController:d,getRepresentationController:o,getIndexHandler:h,getCurrentRepresentationInfo:B,getRepresentationInfoForQuality:U,isBufferingCompleted:z,createBuffer:G,getStreamInfo:x,updateMediaInfo:w,getMediaInfoArr:C,getMediaInfo:O,getMediaSource:j,getBuffer:m,setBuffer:b,start:k,stop:V,isDynamic:$,reset:n},function(){et=[]}(),Q}Object.defineProperty(n,"__esModule",{value:!0});var a=t(60),s=i(a),o=t(63),u=i(o),l=t(71),c=i(l),h=t(66),f=i(h),d=t(72),g=i(d),m=t(69),p=i(m),b=t(129),_=i(b),v=t(101),y=i(v),E=t(102),T=i(E),x=t(48),S=i(x),w=t(156),M=i(w),C=t(70),R=i(C),O=t(56),A=i(O),j=t(22),I=i(j),P=t(17),L=i(P),N=t(21),D=i(N),k=t(151),F=i(k),V=t(10),B=i(V);r.__dashjs_factory_name="StreamProcessor",n.default=B.default.getClassFactory(r),e.exports=n.default},{10:10,101:101,102:102,129:129,151:151,156:156,17:17,21:21,22:22,48:48,56:56,60:60,63:63,66:66,69:69,70:70,71:71,72:72}],56:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,n){k=!1,F=null,H=null,q=!1,X=NaN,K=[],Q=null,A||e();var i=n.getStreamProcessor();if(z=i.getMediaInfoArr(),G.setConfig({videoModel:W}),G.initialize(),$=!N.getIsTextTrack(t),I=(0,c.default)(R).getInstance(),U=(0,u.default)(R).getInstance(),U.setConfig({boxParser:I}),$){H=i.getFragmentModel(),this.buffered=(0,f.default)(R).create(),K=D.getTracksFor("fragmentedText",Y.getActiveStreamInfo());for(var r=D.getCurrentTrackFor("fragmentedText",Y.getActiveStreamInfo()),a=0;a<K.length;a++)if(K[a]===r){Z=a;break}}}function e(){J=[],z=[],W=(0,_.default)(R).getInstance(),G=(0,y.default)(R).getInstance(),G.setConfig({videoModel:W}),G.initialize(),I=(0,c.default)(R).getInstance(),U=(0,u.default)(R).getInstance(),U.setConfig({boxParser:I}),$=!1,Z=null,tt=!1,et=0,rt=[],it=[],nt=null,A=!0}function n(t,e){function n(t,e){var n=new s.default,i={subtitle:"subtitles",caption:"captions"};n.captionData=t,n.lang=e.lang,n.label=e.id,n.index=e.index,n.isTTML=function(){var t=!1;return e.codec&&e.codec.search("stpp")>=0&&(t=!0),e.mimeType&&e.mimeType.search("ttml")>=0&&(t=!0),t}(),n.video=W.getElement(),n.defaultTrack=M(e),n.isFragmented=$,n.isEmbedded=!!e.isEmbedded,n.kind=function(){var t=e.roles.length>0?i[e.roles[0]]:i.caption;return t=t===i.caption||t===i.subtitle?t:i.caption}();var r=(z?z.length:0)+J.length;G.addTextTrack(n,r)}var r,a,o,u,l,c=e.mediaInfo,h=c.type,f=c.mimeType,d=c.codec||f;if(!d)return void O("No text type defined");if("fragmentedText"===h)if(q)if(u=U.getSamplesInfo(t),a=u.sampleList,!Q&&a.length>0&&(Q=a[0].cts-e.start*X),d.search("stpp")>=0)for(F=null!==F?F:C(d),o=0;o<a.length;o++){var m=a[o],p=m.cts,b=p-Q;this.buffered.add(b/X,(b+m.duration)/X);var _=new DataView(t,m.offset,m.size);l=T.default.Utils.dataViewToString(_,"utf-8");try{r=F.parse(l,p/X,(p+m.duration)/X),G.addCaptions(Z,Q/X,r)}catch(t){O("TTML parser error: "+t.message)}}else{var v=[];for(o=0;o<a.length;o++){var y=a[o];y.cts-=Q,this.buffered.add(y.cts/X,(y.cts+y.duration)/X);for(var E=t.slice(y.offset,y.offset+y.size),x=T.default.parseBuffer(E),w=0;w<x.boxes.length;w++){
var R=x.boxes[w];if(O("VTT box1: "+R.type),"vtte"!==R.type&&"vttc"===R.type){O("VTT vttc boxes.length = "+R.boxes.length);for(var A=0;A<R.boxes.length;A++){var j=R.boxes[A];if(O("VTT box2: "+j.type),"payl"===j.type){var I=j.cue_text;O("VTT cue_text = "+I);var L=y.cts/X,N=(y.cts+y.duration)/X;v.push({start:L,end:N,data:I,styles:{}}),O("VTT "+L+"-"+N+" : "+I)}}}}}v.length>0&&G.addCaptions(Z,0,v)}else{for(q=!0,o=0;o<z.length;o++)n(null,z[o]);X=U.getMediaTimescaleFromMoov(t)}else if("text"===h){var _=new DataView(t,0,t.byteLength);l=T.default.Utils.dataViewToString(_,"utf-8");try{r=C(d).parse(l),n(r,c)}catch(t){P.timedTextError(t,"parse",l)}}else if("video"===h)if("InitializationSegment"===e.segmentType){if(0===et)for(et=U.getMediaTimescaleFromMoov(t),o=0;o<J.length;o++)n(null,J[o])}else{if(0===et)return void O("CEA-608: No timescale for embeddedTextTrack yet");u=U.getSamplesInfo(t);var D=u.sequenceNumber;if(!rt[0]&&!rt[1]){var k=void 0,V=void 0;for(o=0;o<J.length;o++){if("CC1"===J[o].id?(0,V=G.getTrackIdxForId("CC1")):"CC3"===J[o].id&&(1,V=G.getTrackIdxForId("CC3")),-1===V)return void O("CEA-608: data before track is ready.");k=function(t,e){function n(t,n,i){var r=null;if(W.getTTMLRenderingDiv())r=g(W.getElement(),t,n,i);else{r=[{start:t,end:n,data:i.getDisplayText(),styles:{}}]}r&&G.addCaptions(e,0,r)}return n}(0,V),rt[o]=new S.default.Cea608Parser(o,{newCue:k},null)}}if(et&&-1==it.indexOf(D)){if(null!==nt&&D!==nt+1)for(o=0;o<rt.length;o++)rt[o]&&rt[o].reset();for(var B=i(t),H=0;H<rt.length;H++){var K=B.fields[H],Y=rt[H];if(Y){for(o=0;o<K.length;o++)Y.addData(K[o][0]/et,K[o][1]);B.endTime&&Y.cueSplitAtTime(B.endTime/et)}}nt=D,it.push(D)}}}function i(t){var e=I.parse(t),n=e.getBox("moof"),i=e.getBox("tfdt"),r=e.getBoxes("trun"),a=null;if(0===r.length)return null;a=r[0],r.length>1&&O("Warning: Too many truns");for(var s=n.offset+a.data_offset,o=a.sample_count,u=s,l=i.baseMediaDecodeTime,c=new DataView(t),h={startTime:null,endTime:null,fields:[[],[]]},f=0,d=0;d<o;d++){for(var g=a.samples[d],m=l+f+g.sample_composition_time_offset,p=S.default.findCea608Nalus(c,u,g.sample_size),b=0;b<p.length;b++)for(var _=S.default.extractCea608DataFromRange(c,p[b]),v=0;v<2;v++)_[v].length>0&&function(t,e,n){var i=t.length;if(i>0){if(e>=t[i-1][0])t.push([e,n]);else for(var r=i-1;r>=0;r--)if(e<t[r][0]){t.splice(r,0,[e,n]);break}}else t.push([e,n])}(h.fields[v],m,_[v]);f+=g.sample_duration,u+=g.sample_size}var y=l+f;return h.startTime=l,h.endTime=y,h}function r(t){for(var e="",n=0;n<t.length;++n){e+=t[n].uchar}return e.length-e.replace(/^\s+/,"").length}function a(t){return"left: "+3.125*t.x+"%; top: "+6.66*t.y1+"%; width: "+(100-3.125*t.x)+"%; height: "+6.66*Math.max(t.y2-1-t.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function o(t){return"red"==t?"rgb(255, 0, 0)":"green"==t?"rgb(0, 255, 0)":"blue"==t?"rgb(0, 0, 255)":"cyan"==t?"rgb(0, 255, 255)":"magenta"==t?"rgb(255, 0, 255)":"yellow"==t?"rgb(255, 255, 0)":"white"==t?"rgb(255, 255, 255)":"black"==t?"rgb(0, 0, 0)":t}function l(t,e){var n=t.videoHeight/15;return e?"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(e.foreground?o(e.foreground):"rgb(255, 255, 255)")+"; font-style: "+(e.italics?"italic":"normal")+"; text-decoration: "+(e.underline?"underline":"none")+"; white-space: pre; background-color: "+(e.background?o(e.background):"transparent")+";":"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function h(t){return t.replace(/^\s+/g,"")}function d(t){return t.replace(/\s+$/g,"")}function g(t,e,n,i){var s=null,o=null,u=!1,c=-1,f={start:e,end:n,spans:[]},g="style_cea608_white_black",m={},p={},b=[],_=void 0,v=void 0;for(_=0;_<15;++_){var y=i.rows[_],E="",T=null;if(!1===y.isEmpty()){var x=r(y.chars);null===s&&(s={x:x,y1:_,y2:_+1,p:[]}),x!==c&&u&&(s.p.push(f),f={start:e,end:n,spans:[]},s.y2=_,s.name="region_"+s.x+"_"+s.y1+"_"+s.y2,!1===m.hasOwnProperty(s.name)?(b.push(s),m[s.name]=s):(o=m[s.name],o.p.contat(s.p)),s={x:x,y1:_,y2:_+1,p:[]});for(var S=0;S<y.chars.length;++S){var w=y.chars[S],M=w.penState;if(null===T||!M.equals(T)){E.trim().length>0&&(f.spans.push({name:g,line:E,row:_}),E="");var C="style_cea608_"+M.foreground+"_"+M.background;M.underline&&(C+="_underline"),M.italics&&(C+="_italics"),p.hasOwnProperty(C)||(p[C]=JSON.parse(JSON.stringify(M))),T=M,g=C}E+=w.uchar}E.trim().length>0&&f.spans.push({name:g,line:E,row:_}),u=!0,c=x}else u=!1,c=-1,s&&(s.p.push(f),f={start:e,end:n,spans:[]},s.y2=_,s.name="region_"+s.x+"_"+s.y1+"_"+s.y2,!1===m.hasOwnProperty(s.name)?(b.push(s),m[s.name]=s):(o=m[s.name],o.p.contat(s.p)),s=null)}s&&(s.p.push(f),s.y2=_+1,s.name="region_"+s.x+"_"+s.y1+"_"+s.y2,!1===m.hasOwnProperty(s.name)?(b.push(s),m[s.name]=s):(o=m[s.name],o.p.contat(s.p)),s=null);var R=[];for(_=0;_<b.length;++_){var O=b[_],A="sub_cea608_"+j++,I=document.createElement("div");I.id=A;var P=a(O);I.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+P;var L=document.createElement("div");L.className="paragraph bodyStyle",L.style.cssText=l(t);var N=document.createElement("div");N.className="cueUniWrapper",N.style.cssText="unicode-bidi: normal; direction: ltr;";for(var D=0;D<O.p.length;++D){var k=O.p[D],F=0;for(v=0;v<k.spans.length;++v){var V=k.spans[v];if(V.line.length>0){if(0!==v&&F!=V.row){var B=document.createElement("br");B.className="lineBreak",N.appendChild(B)}var U=!1;F===V.row&&(U=!0),F=V.row;var z=p[V.name],G=document.createElement("span");G.className="spanPadding "+V.name+" customSpanColor",G.style.cssText=l(t,z),0!==v&&U?v===k.spans.length-1?G.textContent=d(V.line):G.textContent=V.line:0===v&&k.spans.length>1&&V.row===k.spans[1].row?G.textContent=h(V.line):G.textContent=V.line.trim(),N.appendChild(G)}}}L.appendChild(N),I.appendChild(L);var $={bodyStyle:90};for(v in p)p.hasOwnProperty(v)&&($[v]=90);R.push({type:"html",start:e,end:n,cueHTMLElement:I,cueID:A,cellResolution:[32,15],isFromCEA608:!0,regions:b,regionID:O.name,videoHeight:t.videoHeight,videoWidth:t.videoWidth,fontSize:$||{defaultFontSize:"100"},lineHeight:{},linePadding:{}})}return R}function m(){G.deleteAllTextTracks(),k=!1,F=null,U=null,z=null,G=null,$=!1,H=null,q=!1,X=NaN,K=[],W=null,Y=null,A=!1,J=null}function b(t){A||e(),"CC1"===t.id||"CC3"===t.id?J.push(t):O("Warning: Embedded track "+t.id+" not supported!")}function v(){A=!1,J=[],rt=[null,null],it=[],nt=null}function E(){return k}function x(t){t&&(t.errHandler&&(P=t.errHandler),t.adapter&&(L=t.adapter),t.dashManifestModel&&(N=t.dashManifestModel),t.mediaController&&(D=t.mediaController),t.videoModel&&(W=t.videoModel),t.streamController&&(Y=t.streamController),t.textTracks&&(G=t.textTracks),t.VTTParser&&(V=t.VTTParser),t.TTMLParser&&(B=t.TTMLParser))}function w(){for(var t=W.getElement(),e=t.textTracks,n=e.length,i=n-J.length,r=G.getCurrentTrackIdx(),a=0;a<n;a++){var s=e[a];if(k="showing"!==s.mode,"showing"===s.mode){if(r!==a&&(G.setCurrentTrackIdx(a),G.addCaptions(a,0,null),$&&a<i)){var o=D.getCurrentTrackFor("fragmentedText",Y.getActiveStreamInfo()),u=K[a];u!==o&&(H.abortRequests(),G.deleteTrackCues(o),D.setTrack(u),Z=a)}break}}k&&G.setCurrentTrackIdx(-1)}function M(t){var e=!1;return J.length>1?e=t.id&&"CC1"===t.id:1===J.length?t.id&&"CC"===t.id.substring(0,2)&&(e=!0):e=t.index===z[0].index,e}function C(t){var e;return t.search("vtt")>=0?e=V:(t.search("ttml")>=0||t.search("stpp")>=0)&&(e=B,e.setConfig({videoModel:W})),e}var R=this.context,O=(0,p.default)(R).getInstance().log,A=!1,j=0,I=void 0,P=void 0,L=void 0,N=void 0,D=void 0,k=void 0,F=void 0,V=void 0,B=void 0,U=void 0,z=void 0,G=void 0,$=void 0,H=void 0,q=void 0,X=void 0,K=void 0,W=void 0,Y=void 0,Q=void 0,Z=void 0,J=void 0,tt=void 0,et=void 0,nt=void 0,it=void 0,rt=void 0;return{initialize:t,append:n,abort:m,getAllTracksAreDisabled:E,setTextTrack:w,setConfig:x,addEmbeddedTrack:b,resetEmbedded:v}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(171),s=i(a),o=t(32),u=i(o),l=t(146),c=i(l),h=t(148),f=i(h),d=t(10),g=i(d),m=t(8),p=i(m),b=t(104),_=i(b),v=t(57),y=i(v),E=t(6),T=i(E),x=t(2),S=i(x);r.__dashjs_factory_name="TextSourceBuffer",n.default=g.default.getSingletonFactory(r),e.exports=n.default},{10:10,104:104,146:146,148:148,171:171,2:2,32:32,57:57,6:6,8:8}],57:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){R=window.VTTCue||window.TextTrackCue,j=[],I=[],P=-1,L=0,N=0,D=0,k=0,F=null,V=null,z=!1,G=2147483647,B=!!navigator.userAgent.match(/Chrome/)&&!navigator.userAgent.match(/Edge/),void 0!==document.fullscreenElement?U="fullscreenElement":void 0!==document.webkitIsFullScreen?U="webkitIsFullScreen":document.msFullscreenElement?U="msFullscreenElement":document.mozFullScreen&&(U="mozFullScreen")}function e(t){var e=j[t].kind,n=void 0!==j[t].label?j[t].label:j[t].lang,i=j[t].lang,r=B?document.createElement("track"):A.addTextTrack(e,n,i);return B&&(r.kind=e,r.label=n,r.srclang=i),r}function n(t){z=t,F&&!document[U]&&(F.style.zIndex=t?G:null)}function i(t,n){if(j.length===n)return void C("Trying to add too many tracks.");if(j.push(t),void 0===A&&(A=t.video),j.length===n){j.sort(function(t,e){return t.index-e.index}),F=O.getTTMLRenderingDiv();for(var i=-1,r=0;r<j.length;r++){var a=e.call(this,r);I.push(a),j[r].defaultTrack&&(a.default=!0,i=r),B&&A.appendChild(a);var s=A.textTracks[r];s.nonAddedCues=[],F&&(j[r].isTTML||j[r].isEmbedded)?s.renderingType="html":s.renderingType="default",this.addCaptions(r,0,j[r].captionData),M.trigger(u.default.TEXT_TRACK_ADDED)}p.call(this,i),i>=0&&(A.textTracks[i].mode="showing",this.addCaptions(i,0,null)),M.trigger(u.default.TEXT_TRACKS_ADDED,{index:P,tracks:j})}}function r(t,e,n,i,r,a){var s=t/e,o=n/i,u=0,l=0;s>o?(l=e,u=l/i*n):(u=t,l=u/n*i);var c=0,h=0,f=0,d=0;return u/l>r?(d=l,f=l/(1/r),c=(t-f)/2,h=0):(f=u,d=u/r,c=0,h=(e-d)/2),a?{x:c+.1*f,y:h+.1*d,w:.8*f,h:.8*d}:{x:c,y:h,w:f,h:d}}function a(){var t=this.getCurrentTextTrack();if(t&&"html"===t.renderingType){var e=A.clientWidth/A.clientHeight,n=!1;t.isFromCEA608&&(e=3.5/3,n=!0);var i=r.call(this,A.clientWidth,A.clientHeight,A.videoWidth,A.videoHeight,e,n),a=i.w,s=i.h;if(a!=D||s!=k){L=i.x,N=i.y,D=a,k=s,F.style.left=L+"px",F.style.top=N+"px",F.style.width=D+"px",F.style.height=k+"px";for(var o=0;t.activeCues&&o<t.activeCues.length;++o){var u=t.activeCues[o];u.scaleCue(u)}U&&document[U]||z?F.style.zIndex=G:F.style.zIndex=null}}}function o(t,e){return Math.round(.01*t*e).toString()+"px"}function l(t){var e=D,n=k;if(e*n!=0&&t.layout){var i=t.layout,r=o(i.left,e),a=o(i.top,n),s=o(i.width,e),u=o(i.height,n);F.style.left=r,F.style.top=a,F.style.width=s,F.style.height=u;var l=F.firstChild;l&&l.style&&(l.style.left="0px",l.style.top="0px",l.style.width=s,l.style.height=u)}}function c(t){var e,n,i,r=D,a=k,s=[r/t.cellResolution[0],a/t.cellResolution[1]];if(t.linePadding)for(e in t.linePadding)if(t.linePadding.hasOwnProperty(e)){var o=t.linePadding[e];n=(o*s[0]).toString();for(var u=document.getElementsByClassName("spanPadding"),l=0;l<u.length;l++)u[l].style.cssText=u[l].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n),u[l].style.cssText=u[l].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}if(t.fontSize)for(e in t.fontSize)if(t.fontSize.hasOwnProperty(e)){var c=t.fontSize[e]/100;n=(c*s[1]).toString(),i="defaultFontSize"!==e?document.getElementsByClassName(e):document.getElementsByClassName("paragraph");for(var h=0;h<i.length;h++)i[h].style.cssText=i[h].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}if(t.lineHeight)for(e in t.lineHeight)if(t.lineHeight.hasOwnProperty(e)){var f=t.lineHeight[e]/100;n=(f*s[1]).toString(),i=document.getElementsByClassName(e);for(var d=0;d<i.length;d++)i[d].style.cssText=i[d].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}}function h(t,e,n){var i=t>=0?A.textTracks[t]:null,r=this;if(i){if("showing"!==i.mode)return void(n&&n.length>0&&(i.nonAddedCues=i.nonAddedCues.concat(n)));if(n||(n=i.nonAddedCues,i.nonAddedCues=[]),n&&0!==n.length)for(var s in n){var o=void 0,u=n[s];i.cellResolution=u.cellResolution,i.isFromCEA608=u.isFromCEA608,V||"html"!==u.type&&"image"!==u.type||(V=setInterval(a.bind(this),500)),"image"===u.type?(o=new R(u.start-e,u.end-e,""),o.image=u.data,o.id=u.id,o.size=0,o.type="image",o.layout=u.layout,o.scaleCue=l.bind(r),o.onenter=function(){if(F&&"showing"===i.mode){var t=new Image;t.id="ttmlImage_"+this.id,t.src=this.image,t.style.cssText="z-index: 2147483648; pointer-events: none; display: block; visibility: visible !important; position: relative !important;",F.appendChild(t),l.call(r,this)}},o.onexit=function(){if(F)for(var t=F.childNodes,e=0;e<t.length;e++)t[e].id==="ttmlImage_"+this.id&&F.removeChild(t[e])}):"html"===u.type?(o=new R(u.start-e,u.end-e,""),o.cueHTMLElement=u.cueHTMLElement,o.regions=u.regions,o.regionID=u.regionID,o.cueID=u.cueID,o.videoWidth=u.videoWidth,o.videoHeight=u.videoHeight,o.cellResolution=u.cellResolution,o.fontSize=u.fontSize,o.lineHeight=u.lineHeight,o.linePadding=u.linePadding,o.scaleCue=c.bind(r),F.style.left=L+"px",F.style.top=N+"px",F.style.width=D+"px",F.style.height=k+"px",o.onenter=function(){"showing"===i.mode&&(C("Cue "+this.startTime+"-"+this.endTime+" : "+this.cueHTMLElement.id+" : "+this.cueHTMLElement.innerText),F.appendChild(this.cueHTMLElement),c.call(r,this))},o.onexit=function(){for(var t=F.childNodes,e=0;e<t.length;++e)t[e].id===this.cueID&&F.removeChild(t[e])}):(o=new R(u.start-e,u.end-e,u.data),u.styles&&(void 0!==u.styles.align&&o.hasOwnProperty("align")&&(o.align=u.styles.align),void 0!==u.styles.line&&o.hasOwnProperty("line")&&(o.line=u.styles.line),void 0!==u.styles.position&&o.hasOwnProperty("position")&&(o.position=u.styles.position),void 0!==u.styles.size&&o.hasOwnProperty("size")&&(o.size=u.styles.size))),i.addCue(o)}}}function d(){return P>=0?A.textTracks[P]:null}function g(){return P}function m(t){for(var e=-1,n=0;n<A.textTracks.length;n++)if(A.textTracks[n].label===t){e=n;break}return e}function p(t){if(P=t,x.call(this),t>=0){"html"===A.textTracks[t].renderingType?E.call(this):T.call(this)}else T.call(this)}function b(t){return A.textTracks[t]}function _(t){if(t.cues){for(var e=t.cues,n=e.length-1,i=n;i>=0;i--)t.removeCue(e[i]);t.mode="disabled"}}function v(){for(var t=I.length,e=0;e<t;e++)if(B)A.removeChild(I[e]);else{var n=b.call(this,e);n.nonAddedCues=[],_.call(this,n)}I=[],j=[],V&&(clearInterval(V),V=null),x.call(this)}function y(t){A.removeChild(I[t]),I.splice(t,1)}function E(){if(B){var t=document.getElementById("native-cue-style");if(!t){t=document.createElement("style"),t.id="native-cue-style",document.head.appendChild(t);var e=t.sheet;A.id?e.insertRule("#"+A.id+"::cue {background: transparent}",0):0!==A.classList.length?e.insertRule("."+A.className+"::cue {background: transparent}",0):e.insertRule("video::cue {background: transparent}",0)}}}function T(){if(B){var t=document.getElementById("native-cue-style");t&&document.head.removeChild(t)}}function x(){if(F)for(;F.firstChild;)F.removeChild(F.firstChild)}function S(t){t&&t.videoModel&&(O=t.videoModel)}var w=this.context,M=(0,s.default)(w).getInstance(),C=(0,f.default)(w).getInstance().log,R=void 0,O=void 0,A=void 0,j=void 0,I=void 0,P=void 0,L=void 0,N=void 0,D=void 0,k=void 0,F=void 0,V=void 0,B=void 0,U=void 0,z=void 0,G=void 0;return{initialize:t,displayCConTop:n,addTextTrack:i,addCaptions:h,getTextTrack:b,getCurrentTextTrack:d,getCurrentTrackIdx:g,setCurrentTrackIdx:p,getTrackIdxForId:m,deleteTrackCues:_,deleteAllTextTracks:v,deleteTextTrack:y,setConfig:S}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(9),s=i(a),o=t(13),u=i(o),l=t(10),c=i(l),h=t(8),f=i(h);r.__dashjs_factory_name="TextTracks",n.default=c.default.getSingletonFactory(r),e.exports=n.default},{10:10,13:13,8:8,9:9}],58:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t){function e(t,n){var i=t.request,r=new XMLHttpRequest,a=[],s=!0,c=!0,f=new Date,d=f,_=0,v=function(t){c=!1,i.requestStartDate=f,i.requestEndDate=new Date,i.firstByteDate=i.firstByteDate||f,i.checkExistenceOnly||l.addHttpRequest(i.mediaType,null,i.type,i.url,r.responseURL||null,i.serviceLocation||null,i.range||null,i.requestStartDate,i.firstByteDate,i.requestEndDate,r.status,i.duration,r.getAllResponseHeaders(),t?a:null)},y=function(){-1!==g.indexOf(r)&&(g.splice(g.indexOf(r),1),c&&(v(!1),n>0?(n--,p.push(setTimeout(function(){e(t,n)},o.getRetryIntervalForType(i.type)))):(u.downloadError(b[i.type],i.url,i),t.error&&t.error(i,"error",r.statusText),t.complete&&t.complete(i,r.statusText))))},E=function(e){var n=new Date;s&&(s=!1,(!e.lengthComputable||e.lengthComputable&&e.total!==e.loaded)&&(i.firstByteDate=n)),e.lengthComputable&&(i.bytesLoaded=e.loaded,i.bytesTotal=e.total),a.push({s:d,d:n.getTime()-d.getTime(),b:[e.loaded?e.loaded-_:0]}),d=n,_=e.loaded,t.progress&&t.progress()},T=function(){r.status>=200&&r.status<=299&&(v(!0),t.success&&t.success(r.response,r.statusText,r),t.complete&&t.complete(i,r.statusText))};try{var x=h.modifyRequestURL(i.url),S=i.checkExistenceOnly?"HEAD":"GET";r.open(S,x,!0),i.responseType&&(r.responseType=i.responseType),i.range&&r.setRequestHeader("Range","bytes="+i.range),i.requestStartDate||(i.requestStartDate=f),r=h.modifyRequestHeader(r),r.withCredentials=o.getXHRWithCredentials(),r.onload=T,r.onloadend=y,r.onerror=y,r.onprogress=E;var w=(new Date).getTime();isNaN(i.delayLoadingTime)||w>=i.delayLoadingTime?(g.push(r),r.send()):function(){var t={xhr:r};m.push(t),t.delayTimeout=setTimeout(function(){if(-1!==m.indexOf(t)){m.splice(m.indexOf(t),1);try{g.push(t.xhr),t.xhr.send()}catch(e){t.xhr.onerror()}}},i.delayLoadingTime-w)}()}catch(t){r.onerror()}}function n(t){t.request&&e(t,o.getRetryAttemptsForType(t.request.type))}function i(){p.forEach(function(t){return clearTimeout(t)}),p=[],m.forEach(function(t){return clearTimeout(t.delayTimeout)}),m=[],g.forEach(function(t){t.onloadend=t.onerror=t.onprogress=void 0,t.abort()}),g=[]}var a=this.context,o=(0,c.default)(a).getInstance(),u=t.errHandler,l=t.metricsModel,h=t.requestModifier,d=void 0,g=void 0,m=void 0,p=void 0,b=void 0;return d={load:n,abort:i},function(){var t;g=[],m=[],p=[],t={},r(t,s.HTTPRequest.MPD_TYPE,f.default.DOWNLOAD_ERROR_ID_MANIFEST),r(t,s.HTTPRequest.XLINK_EXPANSION_TYPE,f.default.DOWNLOAD_ERROR_ID_XLINK),r(t,s.HTTPRequest.INIT_SEGMENT_TYPE,f.default.DOWNLOAD_ERROR_ID_INITIALIZATION),r(t,s.HTTPRequest.MEDIA_SEGMENT_TYPE,f.default.DOWNLOAD_ERROR_ID_CONTENT),r(t,s.HTTPRequest.INDEX_SEGMENT_TYPE,f.default.DOWNLOAD_ERROR_ID_CONTENT),r(t,s.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,f.default.DOWNLOAD_ERROR_ID_CONTENT),r(t,s.HTTPRequest.OTHER_TYPE,f.default.DOWNLOAD_ERROR_ID_CONTENT),b=t}(),d}Object.defineProperty(n,"__esModule",{value:!0});var s=t(179),o=t(10),u=i(o),l=t(101),c=i(l),h=t(151),f=i(h);a.__dashjs_factory_name="XHRLoader";var d=u.default.getClassFactory(a);n.default=d,e.exports=n.default},{10:10,101:101,151:151,179:179}],59:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e,n){var r=function(i,r){e.resolved=!0,e.resolvedContent=i||null,a.trigger(m.default.XLINK_ELEMENT_LOADED,{element:e,resolveObject:n,error:i||r?null:new s.default(_,"Failed loading Xlink element: "+t)})};if(t===i)r(null,!0);else{var u=new h.default(t,l.HTTPRequest.XLINK_TYPE);o.load({request:u,success:function(t){r(t)},error:function(){r(null)}})}}function n(){o&&(o.abort(),o=null)}var i="urn:mpeg:dash:resolve-to-zero:2013",r=this.context,a=(0,d.default)(r).getInstance(),o=(0,u.default)(r).create({errHandler:t.errHandler,metricsModel:t.metricsModel,requestModifier:t.requestModifier});return{load:e,reset:n}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(162),s=i(a),o=t(58),u=i(o),l=t(179),c=t(170),h=i(c),f=t(9),d=i(f),g=t(13),m=i(g),p=t(10),b=i(p),_=1;r.__dashjs_factory_name="XlinkLoader";var v=b.default.getClassFactory(r);v.XLINK_LOADER_ERROR_LOADING_FAILURE=_,n.default=v,e.exports=n.default},{10:10,13:13,162:162,170:170,179:179,58:58,9:9}],60:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){ot={video:!0,audio:!0},ut={},lt={},ct={},ht={},ft={},dt={},mt={},gt={},bt=!1,_t=!1,xt=(0,c.default)(et).getInstance(),Tt=(0,g.default)(et).getInstance(),vt=(0,S.default)(et).getInstance(),yt=(0,M.default)(et).getInstance(),Et=(0,R.default)(et).getInstance()}function e(t,e){gt[t]=e,mt[t]=mt[t]||{},mt[t].state=A,nt.on(y.default.LOADING_PROGRESS,tt,this)}function n(t){t&&(t.abrRulesCollection&&(rt=t.abrRulesCollection),t.rulesController&&(at=t.rulesController),t.streamController&&(st=t.streamController))}function i(t,e){var n;return ut[e]=ut[e]||{},ut[e].hasOwnProperty(t)||(ut[e][t]=0),n=Q(ut[e][t],t),n=Z(n,t,ut[e][t]),n=J(n,t)}function r(t){var e=xt.getSavedBitrateSettings(t);if(!ht.hasOwnProperty(t))if(ft.hasOwnProperty(t)){var n=vt.getValue(),i=yt.getAdaptationForType(n,0,t).Representation;if(Array.isArray(i)){var r=Math.max(Math.round(i.length*ft[t])-1,0);ht[t]=i[r].bandwidth}else ht[t]=0}else isNaN(e)?ht[t]="video"===t?j:I:ht[t]=e;return ht[t]}function a(t,e){ht[t]=e}function o(t){return ft.hasOwnProperty(t)?ft[t]:null}function l(t,e){ft[t]=e}function h(t){return ht.hasOwnProperty("max")&&ht.max.hasOwnProperty(t)?ht.max[t]:NaN}function d(t,e){ht.max=ht.max||{},ht.max[t]=e}function m(t){return ft.hasOwnProperty("max")&&ft.max.hasOwnProperty(t)?ft.max[t]:1}function b(t,e){ft.max=ft.max||{},ft.max[t]=e}function v(t){return ot[t]}function E(t,e){ot[t]=e}function T(){return bt}function x(t){bt=t}function w(){return _t}function C(t){_t=t}function L(t,e){var n=t.getType(),r=t.getStreamInfo(),a=r.id,o=function(t){var s=i(n,a),o=t.value;o<0&&(o=0),o>s&&(o=s);var u=q(n,r);o!==u&&(mt[n].state===A||o>u)&&(W(n,a,t.confidence),D(n,r,u,o,t.reason)),e&&e()};if(v(n)){var u=rt.getRules(f.default.QUALITY_SWITCH_RULES);at.applyRules(u,t,o,q(n,r),function(t,e){return t=t===s.default.NO_CHANGE?0:t,Math.max(t,e)})}else e&&e()}function N(t,e,n,r){var a=e.id,s=q(t,e);if(null===n||isNaN(n)||n%1!=0)throw new Error("argument is not an integer");n!==s&&n>=0&&n<=i(t,a)&&D(t,e,s,n,r)}function D(t,e,n,i,r){X(t,e.id,i),nt.trigger(y.default.QUALITY_CHANGE_REQUESTED,{mediaType:t,streamInfo:e,oldQuality:n,newQuality:i,reason:r})}function k(t,e){mt[t].state=e}function F(t){return mt[t].state}function V(t,e){var n=B(t);if(!n||0===n.length)return P;for(var i=n.length-1;i>=0;i--){if(1e3*e>=n[i].bitrate)return i}return 0}function B(t){if(!t||!t.bitrateList)return null;for(var e=void 0,n=t.bitrateList,i=t.type,r=[],a=0,s=n.length;a<s;a++)e=new u.default,e.mediaType=i,e.qualityIndex=a,e.bitrate=n[a].bandwidth,e.width=n[a].width,e.height=n[a].height,r.push(e);return r}function U(t,e){dt[t]=e}function z(t){return dt[t]}function G(t){var e=t.type,n=t.streamInfo.id,i=t.representationCount-1;return Y(e,n,i),i}function $(t){var e=t.id,n=q("audio",t),r=q("video",t);return n===i("audio",e)&&r===i("video",e)}function H(){nt.off(y.default.LOADING_PROGRESS,tt,this),clearTimeout(pt),pt=null,t()}function q(t,e){var n=e.id;return lt[n]=lt[n]||{},lt[n].hasOwnProperty(t)||(lt[n][t]=P),lt[n][t]}function X(t,e,n){lt[e]=lt[e]||{},lt[e][t]=n}function K(t,e){return ct[e]=ct[e]||{},ct[e].hasOwnProperty(t)||(ct[e][t]=0),ct[e][t]}function W(t,e,n){ct[e]=ct[e]||{},ct[e][t]=n}function Y(t,e,n){ut[e]=ut[e]||{},ut[e][t]=n}function Q(t,e){var n=h(e);if(isNaN(n)||!gt[e])return t;var i=V(gt[e].getMediaInfo(),n);return Math.min(t,i)}function Z(t,e,n){var i=m(e);return isNaN(i)||i>=1||i<0?t:Math.min(t,Math.round(n*i))}function J(t,e){if("video"!==e||!bt||!gt[e])return t;var n=_t&&window.hasOwnProperty("devicePixelRatio"),i=n?window.devicePixelRatio:1,r=Et.getElement(),a=r.clientWidth*i,s=r.clientHeight*i,o=vt.getValue(),u=yt.getAdaptationForType(o,0,e).Representation,l=t;if(a>0&&s>0){for(;l>0&&u[l]&&a<u[l].width&&a-u[l-1].width<u[l].width-a;)l-=1;u.length-2>=l&&u[l].width===u[l+1].width&&(l=Math.min(t,l+1))}return l}function tt(t){var e=t.request.mediaType;if(v(e)){var n=function(){var n=rt.getRules(f.default.ABANDON_FRAGMENT_RULES),i=gt[e].getScheduleController();if(!i)return{v:void 0};var r=function(n){if(n.confidence===s.default.STRONG&&n.value<q(e,st.getActiveStreamInfo())){var r=i.getFragmentModel(),a=r.getRequests({state:p.default.FRAGMENT_MODEL_LOADING,index:t.request.index})[0];a&&(r.abortRequests(),k(e,O),N(e,st.getActiveStreamInfo(),n.value,n.reason),nt.trigger(y.default.FRAGMENT_LOADING_ABANDONED,{streamProcessor:gt[e],request:a,mediaType:e}),clearTimeout(pt),pt=setTimeout(function(){k(e,A),pt=null},Tt.getAbandonLoadTimeout()))}};at.applyRules(n,gt[e],r,t,function(t,e){return e})}();if("object"==(void 0===n?"undefined":$traceurRuntime.typeof(n)))return n.v}}var et=this.context,nt=(0,_.default)(et).getInstance(),it=void 0,rt=void 0,at=void 0,st=void 0,ot=void 0,ut=void 0,lt=void 0,ct=void 0,ht=void 0,ft=void 0,dt=void 0,gt=void 0,mt=void 0,pt=void 0,bt=void 0,_t=void 0,vt=void 0,yt=void 0,Et=void 0,Tt=void 0,xt=void 0;return it={isPlayingAtTopQuality:$,updateTopQualityIndex:G,getAverageThroughput:z,getBitrateList:B,getQualityForBitrate:V,getMaxAllowedBitrateFor:h,setMaxAllowedBitrateFor:d,getMaxAllowedRepresentationRatioFor:m,setMaxAllowedRepresentationRatioFor:b,getInitialBitrateFor:r,setInitialBitrateFor:a,getInitialRepresentationRatioFor:o,setInitialRepresentationRatioFor:l,setAutoSwitchBitrateFor:E,getAutoSwitchBitrateFor:v,setLimitBitrateByPortal:x,getLimitBitrateByPortal:T,getUsePixelRatioInLimitBitrateByPortal:w,setUsePixelRatioInLimitBitrateByPortal:C,getConfidenceFor:K,getQualityFor:q,getAbandonmentStateFor:F,setAbandonmentStateFor:k,setPlaybackQuality:N,getPlaybackQuality:L,setAverageThroughput:U,getTopQualityIndexFor:i,initialize:e,setConfig:n,reset:H},t(),it}Object.defineProperty(n,"__esModule",{value:!0});var a=t(130),s=i(a),o=t(160),u=i(o),l=t(149),c=i(l),h=t(131),f=i(h),d=t(101),g=i(d),m=t(99),p=i(m),b=t(9),_=i(b),v=t(13),y=i(v),E=t(10),T=i(E),x=t(100),S=i(x),w=t(22),M=i(w),C=t(104),R=i(C),O="abandonload",A="allowload",j=1e3,I=100,P=0;r.__dashjs_factory_name="AbrController";var L=T.default.getSingletonFactory(r);L.ABANDON_LOAD=O,L.QUALITY_DEFAULT=P,n.default=L,e.exports=n.default},{10:10,100:100,101:101,104:104,13:13,130:130,131:131,149:149,160:160,22:22,9:9,99:99}],61:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){d.invalidateSelectedIndexes(t.entry)}function e(t){d.update(t),g.chooseSelectorFromManifest(t)}function n(t){var e=d.getForPath(t),n=e.reduce(function(t,e){var n=g.select(e);return n&&(h.isRelative(n.url)?t.url+=n.url:h.isPathAbsolute(n.url)?t.url=h.parseOrigin(t.url)+n.url:(t.url=n.url,t.serviceLocation=n.serviceLocation)),t},new f.default);if(!h.isRelative(n.url))return n}function i(){d.reset(),g.reset()}function r(t){e(t)}var a=void 0,o=this.context,l=(0,p.default)(o).getInstance(),h=(0,c.default)(o).getInstance(),d=void 0,g=void 0;return a={reset:i,initialize:r,resolve:n},function(){d=(0,s.default)(o).create(),g=(0,u.default)(o).create(),l.on(_.default.SERVICE_LOCATION_BLACKLIST_CHANGED,t,a)}(),a}Object.defineProperty(n,"__esModule",{value:!0});var a=t(98),s=i(a),o=t(145),u=i(o),l=t(158),c=i(l),h=t(40),f=i(h),d=t(10),g=i(d),m=t(9),p=i(m),b=t(13),_=i(b);r.__dashjs_factory_name="BaseURLController",n.default=g.default.getSingletonFactory(r),e.exports=n.default},{10:10,13:13,145:145,158:158,40:40,9:9,98:98}],62:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t){return!!(a.length&&t&&t.length)&&-1!==a.indexOf(t)}function n(t){-1===a.indexOf(t)&&(a.push(t),s.trigger(o,{entry:t}))}function i(t){t.error&&n(t.request.serviceLocation)}function r(){a=[]}var a=[],s=(0,u.default)(this.context).getInstance(),o=t.updateEventName,l=t.loadFailedEventName;return function(){l&&s.on(l,i,this)}(),{add:n,contains:e,reset:r}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(9),u=i(o);r.__dashjs_factory_name="BlackListController",n.default=s.default.getClassFactory(r),e.exports=n.default},{10:10,9:9}],63:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e,n){yt=t,Q(e),At=n,Pt=(0,u.default)(et).getInstance(),Ot=(0,g.default)(et).getInstance(),jt=(0,f.default)(et).getInstance(),Lt=(0,R.default)(et).getInstance(),It=At.getScheduleController(),dt=jt.getQualityFor(yt,At.getStreamInfo()),it.on(y.default.DATA_UPDATE_COMPLETED,V,this),it.on(y.default.INIT_FRAGMENT_LOADED,r,this),it.on(y.default.MEDIA_FRAGMENT_LOADED,o,this),it.on(y.default.QUALITY_CHANGE_REQUESTED,d,this),it.on(y.default.STREAM_COMPLETED,B,this),it.on(y.default.PLAYBACK_PROGRESS,b,this),it.on(y.default.PLAYBACK_TIME_UPDATED,b,this),it.on(y.default.PLAYBACK_RATE_CHANGED,G,this),it.on(y.default.PLAYBACK_SEEKING,m,this),it.on(y.default.WALLCLOCK_TIME_UPDATED,z,this),it.on(y.default.CURRENT_TRACK_CHANGED,U,this,_.default.EVENT_PRIORITY_HIGH),it.on(y.default.SOURCEBUFFER_APPEND_COMPLETED,h,this),it.on(y.default.SOURCEBUFFER_REMOVE_COMPLETED,k,this)}function n(t){if(!t||!bt||!At)return null;var e=null;try{(e=st.createSourceBuffer(bt,t))&&e.hasOwnProperty("initialize")&&e.initialize(yt,this)}catch(t){ot.mediaSourceError("Error creating "+yt+" source buffer.")}return K(e),F(At.getRepresentationInfoForQuality(dt).MSETimeOffset),e}function i(){return At.getStreamInfo().id===ut.getActiveStreamInfo().id}function r(t){t.fragmentModel===At.getFragmentModel()&&(nt("Init fragment finished loading saving to",yt+"'s init cache"),Lt.save(t.chunk),l(t.chunk))}function a(t,e){var n=Lt.extract(t,yt,e);n?l(n):it.trigger(y.default.INIT_REQUESTED,{sender:ft})}function o(t){if(t.fragmentModel===At.getFragmentModel()){var e=t.chunk,n=e.bytes,i=e.quality,r=At.getRepresentationInfoForQuality(i),a=at.getValue(),o=ct.getEventsFor(a,r.mediaInfo,At),u=ct.getEventsFor(a,r,At);if(o.length>0||u.length>0){var c=At.getFragmentModel().getRequests({state:s.default.FRAGMENT_MODEL_EXECUTED,quality:i,index:e.index})[0],h=C(n,c,o,u);At.getEventController().addInbandEvents(h)}e.bytes=I(n),l(e)}}function l(t){Mt=!0,xt=t,st.append(Et,t),"video"===t.mediaInfo.type&&t.mediaInfo.embeddedCaptions&&ht.append(t.bytes,t)}function h(t){if(Et===t.buffer){if(t.error||!P())return t.error.code===c.default.QUOTA_EXCEEDED_ERROR_CODE&&(pt=.8*st.getTotalBufferedTime(Et)),void(t.error.code!==c.default.QUOTA_EXCEEDED_ERROR_CODE&&P()||(it.trigger(y.default.QUOTA_EXCEEDED,{sender:ft,criticalBufferLevel:pt}),D(N())));isNaN(xt.index)||(_t=Math.max(xt.index,_t),x());var e=st.getAllRanges(Et);if(e&&e.length>0)for(var n=0,i=e.length;n<i;n++)nt("Buffered Range for type:",yt,":",e.start(n)," - ",e.end(n));b(),Mt=!1,it.trigger(y.default.BYTES_APPENDED,{sender:ft,quality:xt.quality,startTime:xt.start,index:xt.index,bufferedRanges:e})}}function d(t){dt!==t.newQuality&&yt===t.mediaType&&At.getStreamInfo().id===t.streamInfo.id&&(F(At.getRepresentationInfoForQuality(t.newQuality).MSETimeOffset),dt=t.newQuality)}function m(){vt=0,gt=!1,b()}function b(){v(),E()}function v(){mt=st.getBufferLength(Et,Ot.getTime()),it.trigger(y.default.BUFFER_LEVEL_UPDATED,{sender:ft,bufferLevel:mt}),S()}function E(){i()&&(rt.addBufferState(yt,Tt,It.getBufferTarget()),rt.addBufferLevel(yt,new Date,1e3*mt))}function x(){_t===vt-1&&!gt&&(gt=!0,it.trigger(y.default.BUFFERING_COMPLETED,{sender:ft,streamInfo:At.getStreamInfo()}))}function S(){w(mt<j&&!gt?A:O)}function w(t){Tt===t||"fragmentedText"===yt&&ht.getAllTracksAreDisabled()||(Tt=t,E(),it.trigger(y.default.BUFFER_LEVEL_STATE_CHANGED,{sender:ft,state:t,mediaType:yt,streamInfo:At.getStreamInfo()}),it.trigger(t===O?y.default.BUFFER_LOADED:y.default.BUFFER_EMPTY,{mediaType:yt}),
nt(t===O?"Got enough buffer to start.":"Waiting for more buffer before starting playback."))}function C(t,e,n,i){var r=Math.max(isNaN(e.startTime)?0:e.startTime,0),a=[],s=[];Rt=!1;for(var o=n.concat(i),u=0,l=o.length;u<l;u++)a[o[u].schemeIdUri]=o[u];for(var c=(0,T.default)(et).getInstance().parse(t),h=c.getBoxes("emsg"),u=0,l=h.length;u<l;u++){var f=ct.getEvent(h[u],a,r);f&&s.push(f)}return s}function I(t){if(!Rt)return t;for(var e=t.length,n=Math.pow(256,2),i=Math.pow(256,3),r=new Uint8Array(t.length),a=0,s=0;a<e;){var o=String.fromCharCode(t[a+4],t[a+5],t[a+6],t[a+7]),u=t[a]*i+t[a+1]*n+256*t[a+2]+1*t[a+3];if("emsg"!=o)for(var l=a;l<a+u;l++)r[s]=t[l],s++;a+=u}return r.subarray(0,s)}function P(){return st.getTotalBufferedTime(Et)<pt}function L(){if("fragmentedText"!==yt){var t=Et.buffered.length?Et.buffered.start(0):0,e=Ot.getTime()-t-Pt.getBufferToKeep();e>0&&(nt("pruning buffer: "+e+" seconds."),Ct=!0,st.remove(Et,0,Math.round(t+e),bt))}}function N(){if(!Et)return null;var t=Ot.getTime(),e=At.getFragmentModel().getRequests({state:s.default.FRAGMENT_MODEL_EXECUTED,time:t})[0],n=st.getBufferRange(Et,t),i=e&&!isNaN(e.startTime)?e.startTime:Math.floor(t);return null===n&&Et.buffered.length>0&&(i=Et.buffered.end(Et.buffered.length-1)),{start:Et.buffered.start(0),end:i}}function D(t){t&&Et&&st.remove(Et,t.start,t.end,bt)}function k(t){Et===t.buffer&&(Ct&&(Ct=!1),v(),it.trigger(y.default.BUFFER_CLEARED,{sender:ft,from:t.from,to:t.to,hasEnoughSpaceToAppend:P()}))}function F(t){Et&&Et.timestampOffset!==t&&!isNaN(t)&&(Et.timestampOffset=t)}function V(t){t.sender.getStreamProcessor()!==At||t.error||F(t.currentRepresentation.MSETimeOffset)}function B(t){t.fragmentModel===At.getFragmentModel()&&(vt=t.request.index,x())}function U(t){Et&&t.newMediaInfo.type===yt&&t.newMediaInfo.streamInfo.id===At.getStreamInfo().id&&lt.getSwitchMode(yt)===p.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&D(N())}function z(){++St*(Pt.getWallclockTimeUpdateInterval()/1e3)>=Pt.getBufferPruningInterval()&&!Mt&&(St=0,L())}function G(){S()}function $(){return yt}function H(){return At}function q(t){At=t}function X(){return Et}function K(t){Et=t}function W(){return mt}function Y(){return pt}function Q(t){bt=t}function Z(){return bt}function J(){return gt}function tt(t){it.off(y.default.DATA_UPDATE_COMPLETED,V,this),it.off(y.default.QUALITY_CHANGE_REQUESTED,d,this),it.off(y.default.INIT_FRAGMENT_LOADED,r,this),it.off(y.default.MEDIA_FRAGMENT_LOADED,o,this),it.off(y.default.STREAM_COMPLETED,B,this),it.off(y.default.CURRENT_TRACK_CHANGED,U,this),it.off(y.default.PLAYBACK_PROGRESS,b,this),it.off(y.default.PLAYBACK_TIME_UPDATED,b,this),it.off(y.default.PLAYBACK_RATE_CHANGED,G,this),it.off(y.default.PLAYBACK_SEEKING,m,this),it.off(y.default.WALLCLOCK_TIME_UPDATED,z,this),it.off(y.default.SOURCEBUFFER_APPEND_COMPLETED,h,this),it.off(y.default.SOURCEBUFFER_REMOVE_COMPLETED,k,this),pt=Number.POSITIVE_INFINITY,Tt=A,dt=f.default.QUALITY_DEFAULT,vt=0,_t=0,xt=null,wt=!1,gt=!1,Mt=!1,Ct=!1,Ot=null,At=null,jt=null,It=null,t||(st.abort(bt,Et),st.removeSourceBuffer(bt,Et)),Et=null}var et=this.context,nt=(0,M.default)(et).getInstance().log,it=(0,_.default)(et).getInstance(),rt=t.metricsModel,at=t.manifestModel,st=t.sourceBufferController,ot=t.errHandler,ut=t.streamController,lt=t.mediaController,ct=t.adapter,ht=t.textSourceBuffer,ft=void 0,dt=void 0,gt=void 0,mt=void 0,pt=void 0,bt=void 0,_t=void 0,vt=void 0,yt=void 0,Et=void 0,Tt=void 0,xt=void 0,St=void 0,wt=void 0,Mt=void 0,Ct=void 0,Rt=void 0,Ot=void 0,At=void 0,jt=void 0,It=void 0,Pt=void 0,Lt=void 0;return ft={initialize:e,createBuffer:n,getType:$,getStreamProcessor:H,setStreamProcessor:q,getBuffer:X,setBuffer:K,getBufferLevel:W,getCriticalBufferLevel:Y,setMediaSource:Q,getMediaSource:Z,getIsBufferingCompleted:J,switchInitData:a,reset:tt},function(){dt=f.default.QUALITY_DEFAULT,gt=!1,mt=0,pt=Number.POSITIVE_INFINITY,_t=0,vt=0,Et=null,Tt=A,St=0,wt=!1,Mt=!1,Ct=!1,Rt=!1}(),ft}Object.defineProperty(n,"__esModule",{value:!0});var a=t(99),s=i(a),o=t(101),u=i(o),l=t(70),c=i(l),h=t(60),f=i(h),d=t(68),g=i(d),m=t(66),p=i(m),b=t(9),_=i(b),v=t(13),y=i(v),E=t(146),T=i(E),x=t(10),S=i(x),w=t(8),M=i(w),C=t(152),R=i(C),O="bufferLoaded",A="bufferStalled",j=.5;r.__dashjs_factory_name="BufferController";var I=S.default.getClassFactory(r);I.BUFFER_LOADED=O,I.BUFFER_EMPTY=A,n.default=I,e.exports=n.default},{10:10,101:101,13:13,146:146,152:152,60:60,66:66,68:68,70:70,8:8,9:9,99:99}],64:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){R=!1,v={},y={},E={},T=null,x=100,S=x/1e3,C=(0,s.default)(p).getInstance()}function e(){null!==T&&R&&(clearInterval(T),T=null,R=!1)}function n(){b("Start Event Controller"),R||isNaN(x)||(R=!0,T=setInterval(o,x))}function i(t){if(v={},t)for(var e=0;e<t.length;e++){var n=t[e];v[n.id]=n,b("Add inline event with id "+n.id)}b("Added "+t.length+" inline events")}function r(t){for(var e=0;e<t.length;e++){var n=t[e];n.id in y?b("Repeated event with id "+n.id):(y[n.id]=n,b("Add inband event with id "+n.id))}}function a(){if(E)for(var t=C.getTime(),e=Object.keys(E),n=0;n<e.length;n++){var i=e[n],r=E[i];null!==r&&(r.duration+r.presentationTime)/r.eventStream.timescale<t&&(b("Remove Event "+i+" at time "+t),r=null,delete E[i])}}function o(){l(y),l(v),a()}function u(){var t=w.getValue(),e=t.url;t.hasOwnProperty("Location")&&(e=t.Location),b("Refresh manifest @ "+e),M.getManifestLoader().load(e)}function l(t){var e,n=C.getTime();if(t)for(var i=Object.keys(t),r=0;r<i.length;r++){var a=i[r],s=t[a];void 0!==s&&(0===(e=s.presentationTime/s.eventStream.timescale)||e<=n&&e+S>n)&&(b("Start Event "+a+" at "+n),s.duration>0&&(E[a]=s),s.eventStream.schemeIdUri==g&&s.eventStream.value==m?u():_.trigger(s.eventStream.schemeIdUri,{event:s}),delete t[a])}}function h(t){t&&(t.manifestModel&&(w=t.manifestModel),t.manifestUpdater&&(M=t.manifestUpdater))}function d(){e(),v=null,y=null,E=null,C=null}var g="urn:mpeg:dash:event:2012",m=1,p=this.context,b=(0,c.default)(p).getInstance().log,_=(0,f.default)(p).getInstance(),v=void 0,y=void 0,E=void 0,T=void 0,x=void 0,S=void 0,w=void 0,M=void 0,C=void 0,R=void 0;return{initialize:t,addInlineEvents:i,addInbandEvents:r,clear:e,start:n,setConfig:h,reset:d}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(68),s=i(a),o=t(10),u=i(o),l=t(8),c=i(l),h=t(9),f=i(h);r.__dashjs_factory_name="EventController",n.default=u.default.getSingletonFactory(r),e.exports=n.default},{10:10,68:68,8:8,9:9}],65:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){var e=null;return null!==t&&void 0!==t&&t.byteLength>0&&(e=new Uint8Array(t)),e}function e(t){var e=p[t];return e||(e=(0,l.default)(u).create({metricsModel:(0,h.default)(u).getInstance()}),p[t]=e),e}function n(t){return t&&t.type&&t.type===a.HTTPRequest.INIT_SEGMENT_TYPE}function i(){f.off(m.default.FRAGMENT_LOADING_COMPLETED,s,this);for(var t in p)p[t].reset();p={}}function r(t,e,n){var i=new o.default;return i.streamId=n,i.mediaInfo=e.mediaInfo,i.segmentType=e.type,i.start=e.startTime,i.duration=e.duration,i.end=i.start+i.duration,i.bytes=t,i.index=e.index,i.quality=e.quality,i}function s(t){if(p[t.request.mediaType]===t.sender){var e=t.sender.getScheduleController(),i=t.request,a=t.response,s=n(i),o=e.getStreamProcessor().getStreamInfo().id;if(!a)return void c("No "+i.mediaType+" bytes to push.");var u=r(a,i,o);f.trigger(s?m.default.INIT_FRAGMENT_LOADED:m.default.MEDIA_FRAGMENT_LOADED,{chunk:u,fragmentModel:t.sender})}}var u=this.context,c=(0,v.default)(u).getInstance().log,f=(0,d.default)(u).getInstance(),g=void 0,p=void 0;return g={process:t,getModel:e,isInitializationRequest:n,reset:i},function(){p={},f.on(m.default.FRAGMENT_LOADING_COMPLETED,s,g)}(),g}Object.defineProperty(n,"__esModule",{value:!0});var a=t(179),s=t(161),o=i(s),u=t(99),l=i(u),c=t(102),h=i(c),f=t(9),d=i(f),g=t(13),m=i(g),p=t(10),b=i(p),_=t(8),v=i(_);r.__dashjs_factory_name="FragmentController",n.default=b.default.getClassFactory(r),e.exports=n.default},{10:10,102:102,13:13,161:161,179:179,8:8,9:9,99:99}],66:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){F={},A(),O()}function e(t,e){var n=c(t),r=i(t,e),a=[];return"fragmentedText"===t?void o(r[0]):(n||(n=k.getSavedMediaSettings(t),l(t,n)),void(r&&0!==r.length&&(n&&r.forEach(function(t){R(n,t)&&a.push(t)}),o(0===a.length?j(r):a.length>1?j(a):a[0]))))}function n(t){var e=t?t.type:null,n=t?t.streamInfo.id:null,i=c(e);return!(!t||!x(e)||(F[n]=F[n]||I(),F[n][e].list.indexOf(t)>=0||(F[n][e].list.push(t),i&&R(i,t)&&!r(e,t.streamInfo)&&o(t),0)))}function i(t,e){if(!t||!e)return[];var n=e.id;return F[n]&&F[n][t]?F[n][t].list:[]}function r(t,e){return!t||!e||e&&!F[e.id]?null:F[e.id][t].current}function a(t){var e=t.type,n=t.streamInfo.id;return F[n]&&F[n][e]&&S(F[n][e].current,t)}function o(t){if(t){var e=t.type,n=t.streamInfo,i=n.id,a=r(e,n);if(F[i]&&F[i][e]&&(!a||!S(t,a))){F[i][e].current=t,a&&N.trigger(s.default.CURRENT_TRACK_CHANGED,{oldMediaInfo:a,newMediaInfo:t,switchMode:U[e]});var o=C(t);o&&F[i][e].storeLastSettings&&(o.roles&&(o.role=o.roles[0],delete o.roles),o.accessibility&&(o.accessibility=o.accessibility[0]),o.audioChannelConfiguration&&(o.audioChannelConfiguration=o.audioChannelConfiguration[0]),k.setSavedMediaSettings(e,o))}}}function l(t,e){t&&e&&(V[t]=e)}function c(t){return t?V[t]:null}function h(t,e){return-1!==G.indexOf(e)?void(U[t]=e):void L("track switch mode is not supported: "+e)}function d(t){return U[t]}function m(t){return-1!==$.indexOf(t)?void(B=t):void L("track selection mode is not supported: "+t)}function T(){return B||E}function x(t){return"audio"===t||"video"===t||"text"===t||"fragmentedText"===t}function S(t,e){var n=t.id===e.id,i=t.viewpoint===e.viewpoint,r=t.lang===e.lang,a=t.roles.toString()===e.roles.toString(),s=t.accessibility.toString()===e.accessibility.toString(),o=t.audioChannelConfiguration.toString()===e.audioChannelConfiguration.toString();return n&&i&&r&&a&&s&&o}function w(t){t&&t.errHandler&&(z=t.errHandler)}function M(){t(),D.resetEmbedded()}function C(t){var e={lang:t.lang,viewpoint:t.viewpoint,roles:t.roles,accessibility:t.accessibility,audioChannelConfiguration:t.audioChannelConfiguration};return e.lang||e.viewpoint||e.role&&e.role.length>0||e.accessibility&&e.accessibility.length>0||e.audioChannelConfiguration&&e.audioChannelConfiguration.length>0?e:null}function R(t,e){var n=!t.lang||t.lang===e.lang,i=!t.viewpoint||t.viewpoint===e.viewpoint,r=!t.role||!!e.roles.filter(function(e){return e===t.role})[0],a=!t.accessibility||!!e.accessibility.filter(function(e){return e===t.accessibility})[0],s=!t.audioChannelConfiguration||!!e.audioChannelConfiguration.filter(function(e){return e===t.audioChannelConfiguration})[0];return n&&i&&r&&a&&s}function O(){U={audio:_,video:b}}function A(){V={audio:null,video:null}}function j(t){var e=T(),n=[],i=function(t){var e,n=0,i=[];return t.forEach(function(t){e=Math.max.apply(Math,t.bitrateList.map(function(t){return t.bandwidth})),e>n?(n=e,i=[t]):e===n&&i.push(t)}),i},r=function(t){var e,n=0,i=[];return t.forEach(function(t){e=t.representationCount,e>n?(n=e,i=[t]):e===n&&i.push(t)}),i};switch(e){case v:n=i(t),n.length>1&&(n=r(n));break;case y:n=r(t),n.length>1&&(n=i(t));break;default:L("track selection mode is not supported: "+e)}return n[0]}function I(){return{audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},fragmentedText:{list:[],storeLastSettings:!0,current:null}}}var P=this.context,L=(0,f.default)(P).getInstance().log,N=(0,u.default)(P).getInstance(),D=(0,g.default)(P).getInstance(),k=(0,p.default)(P).getInstance(),F=void 0,V=void 0,B=void 0,U=void 0,z=void 0,G=[_,b],$=[v,y];return{initialize:t,checkInitialMediaSettingsForType:e,addTrack:n,getTracksFor:i,getCurrentTrackFor:r,isCurrentTrack:a,setTrack:o,setInitialSettings:l,getInitialSettings:c,setSwitchMode:h,getSwitchMode:d,setSelectionModeForInitialTrack:m,getSelectionModeForInitialTrack:T,isMultiTrackSupportedByType:x,isTracksEqual:S,setConfig:w,reset:M}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(13),s=i(a),o=t(9),u=i(o),l=t(10),c=i(l),h=t(8),f=i(h),d=t(56),g=i(d),m=t(149),p=i(m),b="neverReplace",_="alwaysReplace",v="highestBitrate",y="widestRange",E=v;r.__dashjs_factory_name="MediaController";var T=c.default.getSingletonFactory(r);T.TRACK_SWITCH_MODE_NEVER_REPLACE=b,T.TRACK_SWITCH_MODE_ALWAYS_REPLACE=_,T.TRACK_SELECTION_MODE_HIGHEST_BITRATE=v,T.TRACK_SELECTION_MODE_WIDEST_RANGE=y,T.DEFAULT_INIT_TRACK_SELECTION_MODE=E,n.default=T,e.exports=n.default},{10:10,13:13,149:149,56:56,8:8,9:9}],67:[function(t,e,n){function i(){function t(){var t="WebKitMediaSource"in window;return"MediaSource"in window?new MediaSource:t?new WebKitMediaSource:null}function e(t,e){var n=window.URL.createObjectURL(t);return e.setSource(n),n}function n(t){t.setSource(null)}function i(t,e){return t.duration!=e&&(t.duration=e),t.duration}function r(t){var e=t.sourceBuffers,n=e.length,i=0;if("open"===t.readyState){for(i;i<n;i++){if(e[i].updating)return;if(0===e[i].buffered.length)return}t.endOfStream()}}return{createMediaSource:t,attachMediaSource:e,detachMediaSource:n,setDuration:i,signalEndOfStream:r}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="MediaSourceController",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],68:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){ft=0,dt=NaN,gt=null,bt=null,vt=!1,mt={},_t=(0,c.default)(J).getInstance()}function e(t){pt=t,it=ht.getElement(),Q(),bt=pt.manifestInfo.isDynamic,dt=pt.start,et.on(g.default.DATA_UPDATE_COMPLETED,L,this),et.on(g.default.LIVE_EDGE_SEARCH_COMPLETED,N,this),et.on(g.default.BYTES_APPENDED,W,this),et.on(g.default.BUFFER_LEVEL_STATE_CHANGED,Y,this),et.on(g.default.PERIOD_SWITCH_STARTED,n,this),vt&&(vt=!1,l())}function n(t){t.fromStreamInfo&&mt[t.fromStreamInfo.id]&&delete mt[t.fromStreamInfo.id]}function i(){return R(!0)+pt.duration-b()}function r(){return b()>0}function a(){return pt.id}function o(){return pt.duration}function l(){if(it){it.autoplay=!0;var t=it.play();t&&"undefined"!=typeof Promise&&t instanceof Promise&&t.catch(function(t){"NotAllowedError"===t.name&&et.trigger(g.default.PLAYBACK_NOT_ALLOWED),tt("Caught pending play exception - continuing ("+t+")")})}else vt=!0}function h(){if(it)return it.paused}function d(){it&&(it.pause(),it.autoplay=!1)}function m(){if(it)return it.seeking}function p(t){ht&&(tt("Requesting seek to time: "+t),ht.setCurrentTime(t))}function b(){if(it)return it.currentTime}function v(){if(it)return it.playbackRate}function y(){if(it)return it.played}function E(){if(it)return it.ended}function T(){return bt}function x(t){dt=t}function S(){return dt}function w(t,e){var n=lt.getMpd(ut.getValue()),i=void 0;i=_t.getUseSuggestedPresentationDelay()&&n.hasOwnProperty("suggestedPresentationDelay")?n.suggestedPresentationDelay:_t.getLiveDelay()?_t.getLiveDelay():isNaN(t)?2*pt.manifestInfo.minBufferTime:t*_t.getLiveDelayFragmentCount();var r=Math.max(e-10,e/2);return Math.min(i,r)}function M(){ht&&it&&(et.off(g.default.DATA_UPDATE_COMPLETED,L,this),et.off(g.default.BUFFER_LEVEL_STATE_CHANGED,Y,this),et.off(g.default.LIVE_EDGE_SEARCH_COMPLETED,N,this),et.off(g.default.BYTES_APPENDED,W,this),j(),Z()),ht=null,pt=null,it=null,bt=null,t()}function C(t){t&&(t.streamController&&(rt=t.streamController),t.timelineConverter&&(at=t.timelineConverter),t.metricsModel&&(st=t.metricsModel),t.dashMetrics&&(ot=t.dashMetrics),t.manifestModel&&(ut=t.manifestModel),t.dashManifestModel&&(lt=t.dashManifestModel),t.adapter&&(ct=t.adapter),t.videoModel&&(ht=t.videoModel))}function R(t){var e=void 0,n=(0,u.default)(J).getInstance().getURIFragmentData(),i=parseInt(n.s,10),r=parseInt(n.t,10),a=NaN;if(t||(a=isNaN(i)?r:i),bt)!isNaN(a)&&a>1262304e3&&((e=a-pt.manifestInfo.availableFrom.getTime()/1e3)>dt||e<dt-pt.manifestInfo.DVRWindowSize)&&(e=null),e=e||dt;else if(!isNaN(a)&&a<Math.max(pt.manifestInfo.duration,pt.duration)&&a>=0)e=a;else{var s=mt[pt.id];void 0===s&&(s=rt.getActiveStreamCommonEarliestTime()),e=Math.max(s,pt.start)}return e}function O(t){var e=st.getReadOnlyMetricsFor("video")||st.getReadOnlyMetricsFor("audio"),n=ot.getCurrentDVRInfo(e),i=n?n.range:null;return i?t>=i.start&&t<=i.end?t:Math.max(i.end-2*pt.manifestInfo.minBufferTime,i.start):NaN}function A(){if(null===gt){var t=function(){K()};gt=setInterval(t,_t.getWallclockTimeUpdateInterval())}}function j(){clearInterval(gt),gt=null}function I(){var t=R(!1);t>0&&(p(t),tt("Starting playback at offset: "+t))}function P(){if(!h()&&bt&&0!==it.readyState){var t=b(),e=O(t);!isNaN(e)&&e!==t&&p(e)}}function L(t){if(!t.error){var e=ct.convertDataToTrack(ut.getValue(),t.currentRepresentation),n=e.mediaInfo.streamInfo;pt.id===n.id&&(pt=n,P())}}function N(t){t.error||0===it.readyState||I()}function D(){et.trigger(g.default.CAN_PLAY)}function k(){tt("Native video element event: play"),P(),A(),et.trigger(g.default.PLAYBACK_STARTED,{startTime:b()})}function F(){tt("Native video element event: playing"),et.trigger(g.default.PLAYBACK_PLAYING,{playingTime:b()})}function V(){tt("Native video element event: pause"),et.trigger(g.default.PLAYBACK_PAUSED,{ended:E()})}function B(){var t=b();tt("Seeking to: "+t),A(),et.trigger(g.default.PLAYBACK_SEEKING,{seekTime:t})}function U(){tt("Native video element event: seeked"),et.trigger(g.default.PLAYBACK_SEEKED)}function z(){var t=b();t!==ft&&(ft=t,et.trigger(g.default.PLAYBACK_TIME_UPDATED,{timeToEnd:i(),time:t}))}function G(){et.trigger(g.default.PLAYBACK_PROGRESS)}function $(){var t=v();tt("Native video element event: ratechange: ",t),et.trigger(g.default.PLAYBACK_RATE_CHANGED,{playbackRate:t})}function H(){tt("Native video element event: loadedmetadata"),(!bt&&pt.isFirst||at.isTimeSyncCompleted())&&I(),et.trigger(g.default.PLAYBACK_METADATA_LOADED),A()}function q(){tt("Native video element event: ended"),d(),j(),et.trigger(g.default.PLAYBACK_ENDED)}function X(t){var e=t.target||t.srcElement;et.trigger(g.default.PLAYBACK_ERROR,{error:e.error})}function K(){et.trigger(g.default.WALLCLOCK_TIME_UPDATED,{isDynamic:bt,time:new Date})}function W(t){var e=t.bufferedRanges;if(e&&e.length){var n=Math.max(e.start(0),pt.start),i=void 0===mt[pt.id]?n:Math.max(mt[pt.id],n);i!==mt[pt.id]&&(!bt&&R(!0)<i&&b()<i&&p(i),mt[pt.id]=i)}}function Y(t){t.streamInfo.id===pt.id&&ht.setStallState(t.mediaType,t.state===s.default.BUFFER_EMPTY)}function Q(){it.addEventListener("canplay",D),it.addEventListener("play",k),it.addEventListener("playing",F),it.addEventListener("pause",V),it.addEventListener("error",X),it.addEventListener("seeking",B),it.addEventListener("seeked",U),it.addEventListener("timeupdate",z),it.addEventListener("progress",G),it.addEventListener("ratechange",$),it.addEventListener("loadedmetadata",H),it.addEventListener("ended",q)}function Z(){it.removeEventListener("canplay",D),it.removeEventListener("play",k),it.removeEventListener("playing",F),it.removeEventListener("pause",V),it.removeEventListener("error",X),it.removeEventListener("seeking",B),it.removeEventListener("seeked",U),it.removeEventListener("timeupdate",z),it.removeEventListener("progress",G),it.removeEventListener("ratechange",$),it.removeEventListener("loadedmetadata",H),it.removeEventListener("ended",q)}var J=this.context,tt=(0,_.default)(J).getInstance().log,et=(0,f.default)(J).getInstance(),nt=void 0,it=void 0,rt=void 0,at=void 0,st=void 0,ot=void 0,ut=void 0,lt=void 0,ct=void 0,ht=void 0,ft=void 0,dt=void 0,gt=void 0,mt=void 0,pt=void 0,bt=void 0,_t=void 0,vt=void 0;return nt={initialize:e,setConfig:C,getStreamStartTime:R,getTimeToStreamEnd:i,isPlaybackStarted:r,getStreamId:a,getStreamDuration:o,getTime:b,getPlaybackRate:v,getPlayedRanges:y,getEnded:E,getIsDynamic:T,setLiveStartTime:x,getLiveStartTime:S,computeLiveDelay:w,play:l,isPaused:h,pause:d,isSeeking:m,seek:p,reset:M},t(),nt}Object.defineProperty(n,"__esModule",{value:!0});var a=t(63),s=i(a),o=t(103),u=i(o),l=t(101),c=i(l),h=t(9),f=i(h),d=t(13),g=i(d),m=t(10),p=i(m),b=t(8),_=i(b);r.__dashjs_factory_name="PlaybackController",n.default=p.default.getSingletonFactory(r),e.exports=n.default},{10:10,101:101,103:103,13:13,63:63,8:8,9:9}],69:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e){pt=t,Pt=e,Dt=(0,j.default)(at).getInstance(),At=(0,o.default)(at).getInstance(),jt=(0,d.default)(at).getInstance(),It=(0,l.default)(at).getInstance(),Lt=(0,V.default)(at).getInstance(),Nt=Pt.getFragmentController(),kt=Pt.getBufferController(),_t=Nt.getModel(pt),_t.setScheduleController(this),vt=Pt.isDynamic(),Bt=gt.getScheduleWhilePaused(),Ft=(0,m.default)(at).create({dashMetrics:(0,w.default)(at).getInstance(),metricsModel:(0,E.default)(at).getInstance(),textSourceBuffer:(0,v.default)(at).getInstance()}),Vt=(0,b.default)(at).create({adapter:(0,C.default)(at).getInstance(),sourceBufferController:(0,O.default)(at).getInstance(),textSourceBuffer:(0,v.default)(at).getInstance()}),ft.getIsTextTrack(pt)&&ot.on(N.default.TIMED_TEXT_REQUESTED,z,this),ot.on(N.default.LIVE_EDGE_SEARCH_COMPLETED,q,this),ot.on(N.default.QUALITY_CHANGE_REQUESTED,p,this),ot.on(N.default.DATA_UPDATE_STARTED,L,this),ot.on(N.default.DATA_UPDATE_COMPLETED,y,this),ot.on(N.default.FRAGMENT_LOADING_COMPLETED,M,this),ot.on(N.default.STREAM_COMPLETED,S,this),ot.on(N.default.STREAM_INITIALIZED,T,this),ot.on(N.default.BUFFER_LEVEL_STATE_CHANGED,k,this),ot.on(N.default.BUFFER_CLEARED,D,this),ot.on(N.default.BYTES_APPENDED,A,this),ot.on(N.default.INIT_REQUESTED,c,this),ot.on(N.default.QUOTA_EXCEEDED,F,this),ot.on(N.default.BUFFER_LEVEL_STATE_CHANGED,k,this),ot.on(N.default.PLAYBACK_STARTED,G,this),ot.on(N.default.PLAYBACK_SEEKING,$,this),ot.on(N.default.PLAYBACK_RATE_CHANGED,H,this),ot.on(N.default.PLAYBACK_TIME_UPDATED,R,this),ot.on(N.default.URL_RESOLUTION_FAILED,B,this),ot.on(N.default.FRAGMENT_LOADING_ABANDONED,I,this)}function n(){bt&&(it(),Tt=!1,Et?f(yt.quality):u(0),Et&&(Et=!1),st("Schedule controller starting for "+pt))}function i(){Tt||(Tt=!0,clearTimeout(Rt),st("Schedule controller stopping for "+pt))}function r(){if(!(Tt||Mt||!kt||At.isPaused()&&!Bt)){s();var t=Gt.length>0;if(Ft.execute(Pt,pt,Lt.isVideoTrackPresent())||t){var e=function(){if(yt.quality!==zt)zt=yt.quality,kt.switchInitData(Pt.getStreamInfo().id,yt.quality);else{var t=Vt.execute(Pt,Gt.shift());t?_t.executeRequest(t):(Mt=!1,u(250))}};Mt=!0,t?e():It.getPlaybackQuality(Pt,e)}else u(500)}}function s(){var t=1.5*yt.fragmentDuration,e=_t.getRequests({state:x.default.FRAGMENT_MODEL_EXECUTED,time:At.getTime()+t,threshold:0})[0];e&&-1===Gt.indexOf(e)&&!ft.getIsTextTrack(pt)&&(!jt.isCurrentTrack(e.mediaInfo)||gt.getFastSwitchEnabled()&&e.quality<yt.quality&&kt.getBufferLevel()>=t&&It.getAbandonmentStateFor(pt)!==l.default.ABANDON_LOAD?(g(e),st("Reloading outdated fragment at index: ",e.index)):e.quality>yt.quality&&K(At.getTime()+kt.getBufferLevel()))}function u(t){clearTimeout(Rt),Rt=setTimeout(r,t)}function c(t){t.sender.getStreamProcessor()===Pt&&f(yt.quality)}function f(t){zt=t;var e=ct.getInitRequest(Pt,t);e&&(Mt=!0,_t.executeRequest(e))}function g(t){Gt.push(t)}function p(t){if(pt===t.mediaType&&Pt.getStreamInfo().id===t.streamInfo.id){if(null===(yt=Pt.getRepresentationInfoForQuality(t.newQuality))||void 0===yt)throw new Error("Unexpected error! - currentRepresentationInfo is null or undefined");nt(new Date,a.PlayListTrace.REPRESENTATION_SWITCH_STOP_REASON),it()}}function _(t){var e=_t.getRequests({state:x.default.FRAGMENT_MODEL_EXECUTED,time:At.getTime(),threshold:0})[0];e&&At.getTime()>=e.startTime&&(e.quality!==Ut&&t&&ot.trigger(N.default.QUALITY_CHANGE_RENDERED,{mediaType:pt,oldQuality:Ut,newQuality:e.quality}),Ut=e.quality)}function y(t){t.error||t.sender.getStreamProcessor()!==Pt||(yt=ct.convertDataToTrack(lt.getValue(),t.currentRepresentation))}function T(t){t.error||Pt.getStreamInfo().id!==t.streamInfo.id||(yt=Pt.getCurrentRepresentationInfo(),vt&&null===Dt.getLiveEdge()||(bt=!0),Tt&&n())}function S(t){t.fragmentModel===_t&&(i(),Mt=!1,st("Stream is complete"))}function M(t){t.sender===_t&&(ft.getIsTextTrack(pt)&&(Mt=!1),t.error&&t.serviceLocation&&!Tt&&g(t.request))}function R(){_(!0)}function A(t){t.sender.getStreamProcessor()===Pt&&(Mt=!1,u(0))}function I(t){t.streamProcessor===Pt&&(g(t.request),Mt=!1,u(0))}function L(t){t.sender.getStreamProcessor()===Pt&&i()}function D(t){t.sender.getStreamProcessor()===Pt&&(_t.removeExecutedRequestsBeforeTime(t.to),t.hasEnoughSpaceToAppend&&!kt.getIsBufferingCompleted()&&Tt&&n())}function k(t){t.sender.getStreamProcessor()!==Pt||t.state!==h.default.BUFFER_EMPTY||At.isSeeking()||(st("Buffer is empty! Stalling!"),nt(new Date,a.PlayListTrace.REBUFFERING_REASON))}function F(t){t.sender.getStreamProcessor()===Pt&&i()}function B(){_t.abortRequests(),i()}function z(t){t.sender.getStreamProcessor()===Pt&&f(t.index)}function G(){Tt&&n()}function $(t){Ot=t.seekTime,Y(0),Tt&&n();var e=ht.getCurrentManifestUpdate(ut.getMetricsFor("stream")),i=yt.DVRWindow?yt.DVRWindow.end-At.getTime():NaN;ut.updateManifestUpdateInfo(e,{latency:i})}function H(t){St&&(St.playbackspeed=t.playbackRate.toString())}function q(t){if(!t.error){var e=yt.mediaInfo.streamInfo.manifestInfo.DVRWindowSize/2,i=t.liveEdge-At.computeLiveDelay(yt.fragmentDuration,e),r=ht.getCurrentManifestUpdate(ut.getMetricsFor("stream")),a=At.getLiveStartTime(),s=ct.getFragmentRequestForTime(Pt,yt,i,{ignoreIsFinished:!0});Ot=a,(isNaN(a)||s.startTime>a)&&(At.setLiveStartTime(s.startTime),Ot=s.startTime),ut.updateManifestUpdateInfo(r,{currentTime:Ot,presentationStartTime:t.liveEdge,latency:t.liveEdge-Ot,clientTimeOffset:dt.getClientTimeOffset()}),bt=!0,Tt&&n()}}function X(){return Ot}function K(t){Ot=t}function W(){return _t}function Y(t){Ct=t}function Q(){return Ct}function Z(){return Pt}function J(){return Ft.getBufferTarget(Pt,pt,Lt.isVideoTrackPresent())}function tt(t){xt=t}function et(t,e){nt(t,e),xt=null}function nt(t,e){if(xt&&!1===wt){var n=St.start,i=t.getTime()-n.getTime();St.duration=i,St.stopreason=e,xt.trace.push(St),wt=!0}}function it(){xt&&!0===wt&&yt&&(wt=!1,St=new a.PlayListTrace,St.representationid=yt.id,St.start=new Date,St.mstart=1e3*At.getTime(),St.playbackspeed=At.getPlaybackRate().toString())}function rt(){ot.off(N.default.LIVE_EDGE_SEARCH_COMPLETED,q,this),ot.off(N.default.DATA_UPDATE_STARTED,L,this),ot.off(N.default.DATA_UPDATE_COMPLETED,y,this),ot.off(N.default.BUFFER_LEVEL_STATE_CHANGED,k,this),ot.off(N.default.QUALITY_CHANGE_REQUESTED,p,this),ot.off(N.default.FRAGMENT_LOADING_COMPLETED,M,this),ot.off(N.default.STREAM_COMPLETED,S,this),ot.off(N.default.STREAM_INITIALIZED,T,this),ot.off(N.default.QUOTA_EXCEEDED,F,this),ot.off(N.default.BYTES_APPENDED,A,this),ot.off(N.default.BUFFER_CLEARED,D,this),ot.off(N.default.INIT_REQUESTED,c,this),ot.off(N.default.PLAYBACK_RATE_CHANGED,H,this),ot.off(N.default.PLAYBACK_SEEKING,$,this),ot.off(N.default.PLAYBACK_STARTED,G,this),ot.off(N.default.PLAYBACK_TIME_UPDATED,R,this),ot.off(N.default.URL_RESOLUTION_FAILED,B,this),ot.off(N.default.FRAGMENT_LOADING_ABANDONED,I,this),ft.getIsTextTrack(pt)&&ot.off(N.default.TIMED_TEXT_REQUESTED,z,this),i(),_(!1),Mt=!1,Ct=0,Ot=NaN,At=null,xt=null}var at=this.context,st=(0,U.default)(at).getInstance().log,ot=(0,P.default)(at).getInstance(),ut=t.metricsModel,lt=t.manifestModel,ct=t.adapter,ht=t.dashMetrics,ft=t.dashManifestModel,dt=t.timelineConverter,gt=t.mediaPlayerModel,mt=void 0,pt=void 0,bt=void 0,_t=void 0,vt=void 0,yt=void 0,Et=void 0,Tt=void 0,xt=void 0,St=void 0,wt=void 0,Mt=void 0,Ct=void 0,Rt=void 0,Ot=void 0,At=void 0,jt=void 0,It=void 0,Pt=void 0,Lt=void 0,Nt=void 0,Dt=void 0,kt=void 0,Ft=void 0,Vt=void 0,Bt=void 0,Ut=void 0,zt=void 0,Gt=void 0;return mt={initialize:e,getStreamProcessor:Z,getSeekTarget:X,setSeekTarget:K,getFragmentModel:W,setTimeToLoadDelay:Y,getTimeToLoadDelay:Q,replaceRequest:g,start:n,stop:i,reset:rt,setPlayList:tt,getBufferTarget:J,finalisePlayList:et},function(){Et=!0,zt=NaN,Ut=NaN,Gt=[],Tt=!1,xt=null,St=null,wt=!0,Mt=!1,Ct=0,Ot=NaN}(),mt}Object.defineProperty(n,"__esModule",{value:!0});var a=t(181),s=t(68),o=i(s),u=t(60),l=i(u),c=t(63),h=i(c),f=t(66),d=i(f),g=t(140),m=i(g),p=t(141),b=i(p),_=t(56),v=i(_),y=t(102),E=i(y),T=t(99),x=i(T),S=t(17),w=i(S),M=t(15),C=i(M),R=t(70),O=i(R),A=t(154),j=i(A),I=t(9),P=i(I),L=t(13),N=i(L),D=t(10),k=i(D),F=t(71),V=i(F),B=t(8),U=i(B);r.__dashjs_factory_name="ScheduleController",n.default=k.default.getClassFactory(r),e.exports=n.default},{10:10,102:102,13:13,140:140,141:141,15:15,154:154,17:17,181:181,56:56,60:60,63:63,66:66,68:68,70:70,71:71,8:8,9:9,99:99}],70:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,e){var n=e.codec,i=null;try{if(n.match(/application\/mp4;\s*codecs="(stpp|wvtt)"/i))throw new S.default("not really supported");i=t.addSourceBuffer(n)}catch(t){if(!e.isText&&-1===n.indexOf('codecs="stpp"')&&-1===n.indexOf('codecs="wvtt"'))throw t;i=(0,s.default)(v).getInstance(),i.setConfig({errHandler:(0,f.default)(v).getInstance(),adapter:(0,c.default)(v).getInstance(),dashManifestModel:x,mediaController:(0,u.default)(v).getInstance(),videoModel:(0,T.default)(v).getInstance(),streamController:(0,g.default)(v).getInstance(),textTracks:(0,p.default)(v).getInstance(),VTTParser:(0,_.default)(v).getInstance(),TTMLParser:(0,y.default)(v).getInstance()})}return i}function e(t,e){try{t.removeSourceBuffer(e)}catch(t){}}function n(t,e,n){var i,r,a=null,s=0,o=0,u=null,l=null,c=0,h=n||.15;try{a=t.buffered}catch(t){return null}if(null!==a&&void 0!==a){for(r=0,i=a.length;r<i;r++)if(s=a.start(r),o=a.end(r),null===u)c=Math.abs(s-e),e>=s&&e<o?(u=s,l=o):c<=h&&(u=s,l=o);else{if(!((c=s-l)<=h))break;l=o}if(null!==u)return{start:u,end:l}}return null}function i(t){try{return t.buffered}catch(t){return null}}function r(t){var e,n,r=i(t),a=0;if(!r)return a;for(n=0,e=r.length;n<e;n++)a+=r.end(n)-r.start(n);return a}function a(t,e,i){var r;return r=n(t,e,i),null===r?0:r.end-e}function o(t,e){if(!e)return null;var n,r,a,s,o,u,l,c,h,f=i(e);if(!f)return null;for(var d=0,g=f.length;d<g;d++){if(c=t.length>d,o=c?{start:t.start(d),end:t.end(d)}:null,n=f.start(d),r=f.end(d),!o)return h={start:n,end:r};if(a=o.start===n,s=o.end===r,!a||!s){if(a)h={start:o.end,end:r};else{if(!s)return h={start:n,end:r};h={start:n,end:o.start}}return u=t.length>d+1?{start:t.start(d+1),end:t.end(d+1)}:null,l=d+1<g?{start:f.start(d+1),end:f.end(d+1)}:null,!u||l&&l.start===u.start&&l.end===u.end||(h.end=u.start),h}}return null}function l(t,e){var n=e.bytes,i="append"in t?"append":"appendBuffer"in t?"appendBuffer":null,r="Object"===Object.prototype.toString.call(t).slice(8,-1);if(i)try{b(t,function(){r?t[i](n,e):t[i](n),b(t,function(){E.trigger(R.default.SOURCEBUFFER_APPEND_COMPLETED,{buffer:t,bytes:n})})})}catch(e){E.trigger(R.default.SOURCEBUFFER_APPEND_COMPLETED,{buffer:t,bytes:n,error:new S.default(e.code,e.message,null)})}}function h(t,e,n,i){try{b(t,function(){e>=0&&n>e&&"ended"!==i.readyState&&t.remove(e,n),b(t,function(){E.trigger(R.default.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:t,from:e,to:n})})})}catch(i){E.trigger(R.default.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:t,from:e,to:n,error:new S.default(i.code,i.message,null)})}}function d(t,e){try{"open"===t.readyState?e.abort():e.setTextTrack&&"ended"===t.readyState&&e.abort()}catch(t){}}function m(t){t&&t.dashManifestModel&&(x=t.dashManifestModel)}function b(t,e){var n,i=function(){t.updating||(clearInterval(n),e())},r=function n(){t.updating||(t.removeEventListener("updateend",n,!1),e())};if(!t.updating)return void e();if("function"==typeof t.addEventListener)try{t.addEventListener("updateend",r,!1)}catch(t){n=setInterval(i,50)}else n=setInterval(i,50)}var v=this.context,E=(0,M.default)(v).getInstance(),x=void 0;return{append:l,remove:h,abort:d,createSourceBuffer:t,removeSourceBuffer:e,
getBufferRange:n,getAllRanges:i,getTotalBufferedTime:r,getBufferLength:a,getRangeDifference:o,setConfig:m}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(56),s=i(a),o=t(66),u=i(o),l=t(15),c=i(l),h=t(151),f=i(h),d=t(71),g=i(d),m=t(57),p=i(m),b=t(159),_=i(b),v=t(157),y=i(v),E=t(104),T=i(E),x=t(162),S=i(x),w=t(9),M=i(w),C=t(13),R=i(C),O=t(10),A=i(O);r.__dashjs_factory_name="SourceBufferController";var j=A.default.getSingletonFactory(r);j.QUOTA_EXCEEDED_ERROR_CODE=22,n.default=j,e.exports=n.default},{10:10,104:104,13:13,15:15,151:151,157:157,159:159,162:162,56:56,57:57,66:66,71:71,9:9}],71:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,e){mt=t,gt=e,ct.initialize(),ut=(0,C.default)(q).getInstance(),Q=(0,c.default)(q).getInstance(),Q.setConfig({log:X,manifestModel:J,dashManifestModel:tt}),Q.initialize(Z),Et=(0,_.default)(q).getInstance(),Tt=(0,s.default)(q).getInstance(),Tt.setConfig({streamController:W,timelineConverter:ct,metricsModel:nt,dashMetrics:it,manifestModel:J,dashManifestModel:tt,adapter:et,videoModel:Et}),K.on(g.default.TIME_SYNCHRONIZATION_COMPLETED,P,this),K.on(g.default.PLAYBACK_SEEKING,h,this),K.on(g.default.PLAYBACK_TIME_UPDATED,o,this),K.on(g.default.PLAYBACK_ENDED,l,this),K.on(g.default.PLAYBACK_ERROR,a,this),K.on(g.default.PLAYBACK_STARTED,d,this),K.on(g.default.PLAYBACK_PAUSED,m,this),K.on(g.default.MANIFEST_UPDATED,L,this),K.on(g.default.STREAM_BUFFERING_COMPLETED,b,this)}function e(t,e){e=e||new Date,Mt&&(ft&&ft.getProcessors().forEach(function(n){var i=n.getScheduleController();i&&i.finalisePlayList(e,t)}),nt.addPlayList(Mt),Mt=null)}function n(t){Mt=new x.PlayList,Mt.start=new Date,Mt.mstart=1e3*Tt.getTime(),Mt.starttype=t,ft&&ft.getProcessors().forEach(function(t){var e=t.getScheduleController();e&&e.setPlayList(Mt)})}function i(t,e,n){K.trigger(t,{fromStreamInfo:e?e.getStreamInfo():null,toStreamInfo:n.getStreamInfo()})}function r(){ft.isActivated()&&wt&&0===ft.getStreamInfo().index&&(ft.startEventController(),mt&&Tt.play())}function a(t){if(t.error){var e="";switch(t.error.code){case 1:e="MEDIA_ERR_ABORTED";break;case 2:e="MEDIA_ERR_NETWORK";break;case 3:e="MEDIA_ERR_DECODE";break;case 4:e="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:e="MEDIA_ERR_ENCRYPTED";break;default:e="UNKNOWN"}_t=!0,t.error.msExtendedCode&&(e+=" (0x"+(t.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),X("Video Element Error: "+e),t.error&&X(t.error),lt.mediaSourceError(e),$()}}function o(t){if(N()){var e=Et.getPlaybackQuality();e&&nt.addDroppedFrames("video",e)}Tt.isSeeking()||t.timeToEnd<H&&at.signalEndOfStream(yt)}function l(){var t=v();t&&M(ft,t,NaN),e(t?x.PlayListTrace.END_OF_PERIOD_STOP_REASON:x.PlayListTrace.END_OF_CONTENT_STOP_REASON)}function h(t){var i=E(t.seekTime);i&&i!==ft?(e(x.PlayListTrace.END_OF_PERIOD_STOP_REASON),M(ft,i,t.seekTime)):e(x.PlayListTrace.USER_REQUEST_STOP_REASON),n(x.PlayList.SEEK_START_REASON)}function d(){wt?(wt=!1,n(x.PlayList.INITIAL_PLAYOUT_START_REASON)):St&&(St=!1,n(x.PlayList.RESUME_FROM_PAUSE_START_REASON))}function m(t){t.ended||(St=!0,e(x.PlayListTrace.USER_REQUEST_STOP_REASON))}function b(t){yt&&t.streamInfo.isLast&&at.signalEndOfStream(yt)}function v(){var t=ft.getStreamInfo().start,e=ft.getStreamInfo().duration;return ht.filter(function(n){return n.getStreamInfo().start===t+e})[0]}function E(t){var e=0,n=null,i=ht.length;i>0&&(e+=ht[0].getStartTime());for(var r=0;r<i;r++)if(n=ht[r],e+=n.getDuration(),t<e)return n;return null}function T(t,e){for(var n=null,i=0,r=0,a=null,s=ht.length,o=0;o<s;o++){if(n=ht[o],r=n.getStartTime(),a=n.getDuration(),Number.isFinite(r)&&(i=r),n.getId()===e)return t-i;Number.isFinite(a)&&(i+=a)}return null}function S(){var t=[];return ft.getProcessors().forEach(function(e){t.push(e.getIndexHandler().getEarliestTime())}),Math.min.apply(Math,t)}function M(t,e,n){function r(){isNaN(n)?function(){var t=Tt.getStreamStartTime(!0);ft.getProcessors().forEach(function(e){et.setIndexHandlerTime(e,t)}),Tt.seek(t)}():Tt.seek(n),Tt.play(),ft.startEventController(),pt=!1,i(g.default.PERIOD_SWITCH_COMPLETED,t,e)}!pt&&t&&e&&t!==e&&(pt=!0,i(g.default.PERIOD_SWITCH_STARTED,t,e),t.deactivate(),ft=e,Tt.initialize(ft.getStreamInfo()),Ct=D(),R(r))}function R(t){function e(){X("MediaSource is open!"),window.URL.revokeObjectURL(n),yt.removeEventListener("sourceopen",e),yt.removeEventListener("webkitsourceopen",e),O(),ft.activate(yt),t&&t()}var n=void 0;yt?at.detachMediaSource(Et):yt=at.createMediaSource(),yt.addEventListener("sourceopen",e,!1),yt.addEventListener("webkitsourceopen",e,!1),n=at.attachMediaSource(yt,Et),X("MediaSource attached to element.  Waiting on open...")}function O(){var t,e;t=ft.getStreamInfo().manifestInfo.duration,e=at.setDuration(yt,t),X("Duration successfully set to: "+e)}function A(){var t,e,n,r,a,s,o,l=J.getValue(),c=nt.getMetricsFor("stream"),h=it.getCurrentManifestUpdate(c),f=[];if(l){s=et.getStreamsInfo(l),dt&&(K.trigger(g.default.PROTECTION_CREATED,{controller:dt,manifest:l}),dt.setMediaElement(Et.getElement()),gt&&dt.setProtectionData(gt));try{if(0===s.length)throw new Error("There are no streams");for(nt.updateManifestUpdateInfo(h,{currentTime:Tt.getTime(),buffered:Et.getElement().buffered,presentationStartTime:s[0].start,clientTimeOffset:ct.getClientTimeOffset()}),bt=!0,r=0,e=s.length;r<e;r++){for(t=s[r],a=0,n=ht.length;a<n;a++)ht[a].getId()===t.id&&(o=ht[a],f.push(o),o.updateData(t));o||(o=(0,u.default)(q).create({manifestModel:J,manifestUpdater:Q,adapter:et,timelineConverter:ct,capabilities:Y,errHandler:lt,baseURLController:ot}),o.initialize(t,dt),K.on(g.default.STREAM_INITIALIZED,I,this),f.push(o),ft&&o.updateData(t)),nt.addManifestUpdateStreamInfo(h,t.id,t.index,t.start,t.duration),o=null}ht=f,ft||(ft=ht[0],i(g.default.PERIOD_SWITCH_STARTED,null,ft),Tt.initialize(ft.getStreamInfo()),i(g.default.PERIOD_SWITCH_COMPLETED,null,ft)),yt||R(),bt=!1,j()}catch(t){lt.manifestError(t.message,"nostreamscomposed",l),vt=!0,$()}}}function j(){if(!bt){var t=ht.length,e=0;for(r(),e;e<t;e++)if(!ht[e].isInitialized())return;K.trigger(g.default.STREAMS_COMPOSED)}}function I(){j()}function P(){A()}function L(t){if(t.error)vt=!0,$();else{var e,n,i=t.manifest,r=et.getStreamsInfo(i)[0],a=et.getMediaInfoForType(i,r,"video")||et.getMediaInfoForType(i,r,"audio");a&&(e=et.getDataForMedia(a),(n=tt.getRepresentationsForAdaptation(i,e)[0].useCalculatedLiveEdgeTime)&&(X("SegmentTimeline detected using calculated Live Edge Time"),xt.setUseManifestDateHeaderTimeSource(!1)));var s=tt.getUTCTimingSources(t.manifest),o=!tt.getIsDynamic(i)||n?s:s.concat(xt.getUTCTimingSources()),u=(0,p.default)(q).getInstance().isManifestHTTPS();o.forEach(function(t){t.value.replace(/.*?:\/\//g,"")===y.default.DEFAULT_UTC_TIMING_SOURCE.value.replace(/.*?:\/\//g,"")&&(t.value=t.value.replace(u?new RegExp(/^(http:)?\/\//i):new RegExp(/^(https:)?\/\//i),u?"https://":"http://"),X("Matching default timing source protocol to manifest protocol: ",t.value))}),ot.initialize(i),st.setConfig({metricsModel:nt,dashMetrics:it}),st.initialize(o,xt.getUseManifestDateHeaderTimeSource())}}function N(){return void 0===Ct&&(Ct=D()),Ct}function D(){var t=!1;return ft.getProcessors().forEach(function(e){"video"===e.getMediaInfo().type&&(t=!0)}),t}function k(){return mt}function F(){return ft?ft.getStreamInfo():null}function V(t){return ft.getId()===t.id}function B(t){return ht.filter(function(e){return e.getId()===t})[0]}function U(t){Z.load(t)}function z(t){Q.setManifest(t)}function G(t){t&&(t.capabilities&&(Y=t.capabilities),t.manifestLoader&&(Z=t.manifestLoader),t.manifestModel&&(J=t.manifestModel),t.dashManifestModel&&(tt=t.dashManifestModel),t.protectionController&&(dt=t.protectionController),t.adapter&&(et=t.adapter),t.metricsModel&&(nt=t.metricsModel),t.dashMetrics&&(it=t.dashMetrics),t.liveEdgeFinder&&(rt=t.liveEdgeFinder),t.mediaSourceController&&(at=t.mediaSourceController),t.timeSyncController&&(st=t.timeSyncController),t.baseURLController&&(ot=t.baseURLController),t.errHandler&&(lt=t.errHandler),t.timelineConverter&&(ct=t.timelineConverter))}function $(){st.reset(),e(_t||vt?x.PlayListTrace.FAILURE_STOP_REASON:x.PlayListTrace.USER_REQUEST_STOP_REASON);for(var t=0,n=ht.length;t<n;t++){var i=ht[t];K.off(g.default.STREAM_INITIALIZED,I,this),i.reset(_t)}ht=[],K.off(g.default.PLAYBACK_TIME_UPDATED,o,this),K.off(g.default.PLAYBACK_SEEKING,h,this),K.off(g.default.PLAYBACK_ERROR,a,this),K.off(g.default.PLAYBACK_STARTED,d,this),K.off(g.default.PLAYBACK_PAUSED,m,this),K.off(g.default.PLAYBACK_ENDED,l,this),K.off(g.default.MANIFEST_UPDATED,L,this),K.off(g.default.STREAM_BUFFERING_COMPLETED,b,this),ot.reset(),Q.reset(),nt.clearAllCurrentMetrics(),J.setValue(null),Z.reset(),ct.reset(),rt.reset(),et.reset(),ut.reset(),pt=!1,bt=!1,ft=null,_t=!1,vt=!1,Ct=void 0,wt=!0,St=!1,yt&&(at.detachMediaSource(Et),yt=null),Et=null,dt&&(dt.setMediaElement(null),dt=null,gt=null,J.getValue()&&K.trigger(g.default.PROTECTION_DESTROYED,{data:J.getValue().url})),K.trigger(g.default.STREAM_TEARDOWN_COMPLETE)}var H=1,q=this.context,X=(0,w.default)(q).getInstance().log,K=(0,f.default)(q).getInstance(),W=void 0,Y=void 0,Q=void 0,Z=void 0,J=void 0,tt=void 0,et=void 0,nt=void 0,it=void 0,rt=void 0,at=void 0,st=void 0,ot=void 0,ut=void 0,lt=void 0,ct=void 0,ht=void 0,ft=void 0,dt=void 0,gt=void 0,mt=void 0,pt=void 0,bt=void 0,_t=void 0,vt=void 0,yt=void 0,Et=void 0,Tt=void 0,xt=void 0,St=void 0,wt=void 0,Mt=void 0,Ct=void 0;return W={initialize:t,getAutoPlay:k,getActiveStreamInfo:F,isStreamActive:V,isVideoTrackPresent:N,getStreamById:B,getTimeRelativeToStreamId:T,load:U,loadWithManifest:z,getActiveStreamCommonEarliestTime:S,setConfig:G,reset:$},function(){dt=null,ht=[],xt=(0,y.default)(q).getInstance(),mt=!0,pt=!1,bt=!1,St=!1,wt=!0,Mt=null,_t=!1,vt=!1}(),W}Object.defineProperty(n,"__esModule",{value:!0});var a=t(68),s=i(a),o=t(54),u=i(o),l=t(50),c=i(l),h=t(9),f=i(h),d=t(13),g=i(d),m=t(103),p=i(m),b=t(104),_=i(b),v=t(101),y=i(v),E=t(10),T=i(E),x=t(181),S=t(8),w=i(S),M=t(152),C=i(M);r.__dashjs_factory_name="StreamController",n.default=T.default.getSingletonFactory(r),e.exports=n.default},{10:10,101:101,103:103,104:104,13:13,152:152,181:181,50:50,54:54,68:68,8:8,9:9}],72:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e,n){y=t,a(e),E=n,T=E.getRepresentationController()}function n(t){try{v=g.createSourceBuffer(_,t),b||(v.hasOwnProperty("initialize")&&v.initialize(y,this),b=!0)}catch(t){m.mediaSourceError("Error creating "+y+" source buffer.")}return v}function i(){return v}function r(t){v=t}function a(t){_=t}function o(){return E}function l(t){d.off(u.default.DATA_UPDATE_COMPLETED,c,this),d.off(u.default.INIT_FRAGMENT_LOADED,h,this),t||(g.abort(_,v),g.removeSourceBuffer(_,v))}function c(t){t.sender.getStreamProcessor()===E&&d.trigger(u.default.TIMED_TEXT_REQUESTED,{index:0,sender:t.sender})}function h(t){t.fragmentModel===E.getFragmentModel()&&t.chunk.bytes&&g.append(v,t.chunk)}var f=this.context,d=(0,s.default)(f).getInstance(),g=t.sourceBufferController,m=t.errHandler,p=void 0,b=void 0,_=void 0,v=void 0,y=void 0,E=void 0,T=void 0;return p={initialize:e,createBuffer:n,getBuffer:i,setBuffer:r,getStreamProcessor:o,setMediaSource:a,reset:l},function(){b=!1,_=null,v=null,y=null,E=null,T=null,d.on(u.default.DATA_UPDATE_COMPLETED,c,this),d.on(u.default.INIT_FRAGMENT_LOADED,h,this)}(),p}Object.defineProperty(n,"__esModule",{value:!0});var a=t(9),s=i(a),o=t(13),u=i(o),l=t(10),c=i(l);r.__dashjs_factory_name="TextController",n.default=c.default.getClassFactory(r),e.exports=n.default},{10:10,13:13,9:9}],73:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,e){I=e,O=0,A=!1,j=!1,P={"urn:mpeg:dash:utc:http-head:2014":E,"urn:mpeg:dash:utc:http-xsdate:2014":y.bind(null,f),"urn:mpeg:dash:utc:http-iso:2014":y.bind(null,d),"urn:mpeg:dash:utc:direct:2014":v,"urn:mpeg:dash:utc:http-head:2012":E,"urn:mpeg:dash:utc:http-xsdate:2012":y.bind(null,f),"urn:mpeg:dash:utc:http-iso:2012":y.bind(null,d),"urn:mpeg:dash:utc:direct:2012":v,"urn:mpeg:dash:utc:http-ntp:2014":_,"urn:mpeg:dash:utc:ntp:2014":_,"urn:mpeg:dash:utc:sntp:2014":_},r()||(S(t),a(!0))}function e(t){t&&(t.metricsModel&&(L=t.metricsModel),t.dashMetrics&&(N=t.dashMetrics))}function n(){return l()}function i(t){A=t}function r(){return A}function a(t){j=t}function o(t){O=t}function l(){return O}function h(t){var e,n,i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/,r=i.exec(t);return e=Date.UTC(parseInt(r[1],10),parseInt(r[2],10)-1,parseInt(r[3],10),parseInt(r[4],10),parseInt(r[5],10),r[6]&&(parseInt(r[6],10)||0),r[7]&&1e3*parseFloat(r[7])||0),r[9]&&r[10]&&(n=60*parseInt(r[9],10)+parseInt(r[10],10),e+=("+"===r[8]?-1:1)*n*60*1e3),new Date(e).getTime()}function f(t){var e=Date.parse(t);return isNaN(e)&&(e=h(t)),e}function d(t){return Date.parse(t)}function b(t){return Date.parse(t)}function _(t,e,n){n()}function v(t,e,n){var i=f(t);return isNaN(i)?void n():void e(i)}function y(t,e,n,i,r){var a,s,o=!1,u=new XMLHttpRequest,l=r?"HEAD":"GET",c=e.match(/\S+/g);e=c.shift(),a=function(){o||(o=!0,c.length?y(t,c.join(" "),n,i,r):i())},s=function(){var e,i;200===u.status&&(e=r?u.getResponseHeader("Date"):u.response,i=t(e),isNaN(i)||(n(i),o=!0))},u.open(l,e),u.timeout=p||0,u.onload=s,u.onloadend=a,u.send()}function E(t,e,n){y(b,t,e,n,!0)}function T(){var t=L.getReadOnlyMetricsFor("stream"),e=N.getLatestMPDRequestHeaderValueByID(t,"Date"),n=null!==e?new Date(e).getTime():Number.NaN;isNaN(n)?x(!0):(o(n-(new Date).getTime()),x(!1,n/1e3,O))}function x(t,e,n){i(!1),R.trigger(c.default.TIME_SYNCHRONIZATION_COMPLETED,{time:e,offset:n,error:t?new s.default(m):null})}function S(t,e){var n=e||0,r=t[n],a=function(t,e){var n=!t||!e;n&&I?T():x(n,t,e)};i(!0),r?P.hasOwnProperty(r.schemeIdUri)?P[r.schemeIdUri](r.value,function(t){var e=(new Date).getTime(),n=t-e;o(n),C("Local time:      "+new Date(e)),C("Server time:     "+new Date(t)),C("Difference (ms): "+n),a(t,n)},function(){S(t,n+1)}):S(t,n+1):(o(0),a())}function w(){a(!1),i(!1)}var M=this.context,C=(0,g.default)(M).getInstance().log,R=(0,u.default)(M).getInstance(),O=void 0,A=void 0,j=void 0,I=void 0,P=void 0,L=void 0,N=void 0;return{initialize:t,getOffsetToDeviceTimeMs:n,setConfig:e,reset:w}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(162),s=i(a),o=t(9),u=i(o),l=t(13),c=i(l),h=t(10),f=i(h),d=t(8),g=i(d),m=1,p=5e3;r.__dashjs_factory_name="TimeSyncController";var b=f.default.getSingletonFactory(r);b.TIME_SYNC_FAILED_ERROR_CODE=m,b.HTTP_TIMEOUT_MS=p,n.default=b,e.exports=n.default},{10:10,13:13,162:162,8:8,9:9}],74:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t){C=t}function n(t){R=t}function i(t){var e;A=new g.default(C,"",!0),O=t,e=h(O.Period_asArray,O,v,b),a(e,v,b)}function r(){S.off(c.default.XLINK_ELEMENT_LOADED,o,M),j&&(j.reset(),j=null)}function a(t,e,n){var i,r,a,s={};for(s.elements=t,s.type=e,s.resolveType=n,0===s.elements.length&&l(s),a=0;a<s.elements.length;a++)i=s.elements[a],r=w.isHTTPURL(i.url)?i.url:i.originalContent.BaseURL+i.url,j.load(r,i,s)}function o(t){var e,n,i,r="";e=t.element,n=t.resolveObject,e.resolvedContent&&(i=e.resolvedContent.indexOf(">")+1,r=e.resolvedContent.substr(0,i)+"<response>"+e.resolvedContent.substr(i)+"</response>",e.resolvedContent=A.xml_str2json(r)),m(n)&&l(n)}function l(t){var e,n,i=[];if(f(t),t.resolveType===_&&S.trigger(c.default.XLINK_READY,{manifest:O}),t.resolveType===b)switch(t.type){case v:for(e=0;e<O[v+"_asArray"].length;e++)n=O[v+"_asArray"][e],n.hasOwnProperty(y+"_asArray")&&(i=i.concat(h(n[y+"_asArray"],n,y,b))),n.hasOwnProperty(E+"_asArray")&&(i=i.concat(h(n[E+"_asArray"],n,E,b)));a(i,y,b);break;case y:S.trigger(c.default.XLINK_READY,{manifest:O})}}function h(t,e,n,i){var r,a,s,o=[];for(a=t.length-1;a>=0;a--)r=t[a],r.hasOwnProperty("xlink:href")&&r["xlink:href"]===T&&t.splice(a,1);for(a=0;a<t.length;a++)r=t[a],r.hasOwnProperty("xlink:href")&&r.hasOwnProperty("xlink:actuate")&&r["xlink:actuate"]===i&&(s=d(r["xlink:href"],e,n,a,i,r),o.push(s));return o}function f(t){var e,n,i,r,a,s,o=[];for(r=t.elements.length-1;r>=0;r--){if(e=t.elements[r],n=e.type+"_asArray",e.resolvedContent&&1){if(e.resolvedContent)for(a=0;a<e.resolvedContent[n].length;a++)i=e.resolvedContent[n][a],o.push(i)}else delete e.originalContent["xlink:actuate"],delete e.originalContent["xlink:href"],o.push(e.originalContent);for(e.parentElement[n].splice(e.index,1),s=0;s<o.length;s++)e.parentElement[n].splice(e.index+s,0,o[s]);o=[]}t.elements.length>0&&R.run(O)}function d(t,e,n,i,r,a){return{url:t,parentElement:e,type:n,index:i,resolveType:r,originalContent:a,resolvedContent:null,resolved:!1}}function m(t){var e,n;for(e=0;e<t.elements.length;e++)if(n=t.elements[e],!1===n.resolved)return!1;return!0}var x=this.context,S=(0,u.default)(x).getInstance(),w=(0,p.default)(x).getInstance(),M=void 0,C=void 0,R=void 0,O=void 0,A=void 0,j=void 0;return M={resolveManifestOnLoad:i,setMatchers:e,setIron:n,reset:r},function(){S.on(c.default.XLINK_ELEMENT_LOADED,o,M),j=(0,s.default)(x).create({errHandler:t.errHandler,metricsModel:t.metricsModel,requestModifier:t.requestModifier})}(),M}Object.defineProperty(n,"__esModule",{value:!0});var a=t(59),s=i(a),o=t(9),u=i(o),l=t(13),c=i(l),h=t(10),f=i(h),d=t(4),g=i(d),m=t(158),p=i(m),b="onLoad",_="onActuate",v="Period",y="AdaptationSet",E="EventStream",T="urn:mpeg:dash:resolve-to-zero:2013";r.__dashjs_factory_name="XlinkController",n.default=f.default.getClassFactory(r),e.exports=n.default},{10:10,13:13,158:158,4:4,59:59,9:9}],75:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){return r=(0,s.default)(i).getInstance({eventBus:t.eventBus,metricsModel:t.metricsModel}),(0,c.default)(i).create(t)}function e(){return(0,g.default)(i).getInstance()}function n(){return(0,f.default)(i).getInstance()}var i=this.context,r=void 0;return{createMetricsReporting:t,getReportingFactory:e,getMetricsHandlerFactory:n}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(89),s=i(a),o=t(76),u=i(o),l=t(77),c=i(l),h=t(82),f=i(h),d=t(87),g=i(d),m=t(10),p=i(m);r.__dashjs_factory_name="MetricsReporting";var b=p.default.getClassFactory(r);b.events=u.default,n.default=b,e.exports=n.default},{10:10,76:76,77:77,82:82,87:87,89:89}],76:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(14),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=function(t){function e(){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",this.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer"}return r(e,t),e}(o.default),l=new u;n.default=l,e.exports=n.default},{14:14}],77:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(e){if(!e.error){var n=Object.keys(i);(0,u.default)(r).getInstance({dashManifestModel:t.dashManifestModel}).getMetrics(e.manifest).forEach(function(e){var a=JSON.stringify(e);if(i.hasOwnProperty(a))n.splice(a,1);else try{var o=(0,s.default)(r).create(t);o.initialize(e),i[a]=o}catch(t){}}),n.forEach(function(t){i[t].reset(),delete i[t]}),a.trigger(f.default.METRICS_INITIALISATION_COMPLETE)}}function n(){Object.keys(i).forEach(function(t){i[t].reset()}),i={}}var i={},r=this.context,a=t.eventBus;return function(){a.on(g.default.MANIFEST_UPDATED,e),a.on(g.default.STREAM_TEARDOWN_COMPLETE,n)}(),{}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(78),s=i(a),o=t(91),u=i(o),l=t(10),c=i(l),h=t(76),f=i(h),d=t(13),g=i(d);r.__dashjs_factory_name="MetricsCollectionController",n.default=c.default.getClassFactory(r),e.exports=n.default},{10:10,13:13,76:76,78:78,91:91}],78:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(e){try{a=(0,u.default)(s).create({mediaElement:t.mediaElement}),a.initialize(e.Range),r=(0,c.default)(s).create({log:t.log}),r.initialize(e.Reporting,a),i=(0,f.default)(s).create({log:t.log,eventBus:t.eventBus}),i.initialize(e.metrics,r)}catch(t){throw n(),t}}function n(){i&&i.reset(),r&&r.reset(),a&&a.reset()}var i=void 0,r=void 0,a=void 0,s=this.context;return{initialize:e,reset:n}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(80),u=i(o),l=t(81),c=i(l),h=t(79),f=i(h);r.__dashjs_factory_name="MetricsController",n.default=s.default.getClassFactory(r),e.exports=n.default},{10:10,79:79,80:80,81:81}],79:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t){r.forEach(function(e){e.handleNewMetric(t.metric,t.value,t.mediaType)})}function n(t,n){t.split(",").forEach(function(t,e,i){var a;if(-1!==t.indexOf("(")&&-1===t.indexOf(")")){var s=i[e+1];s&&-1===s.indexOf("(")&&-1!==s.indexOf(")")&&(t+=","+s,delete i[e+1])}(a=l.create(t,n))&&r.push(a)}),u.on(c.default.METRIC_ADDED,e,a),u.on(c.default.METRIC_UPDATED,e,a)}function i(){u.off(c.default.METRIC_ADDED,e,a),u.off(c.default.METRIC_UPDATED,e,a),r.forEach(function(t){return t.reset()}),r=[]}var r=[],a=void 0,o=this.context,u=t.eventBus,l=(0,s.default)(o).getInstance({log:t.log,eventBus:t.eventBus});return a={initialize:n,reset:i}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(82),s=i(a),o=t(10),u=i(o),l=t(52),c=i(l);r.__dashjs_factory_name="MetricsHandlersController",n.default=u.default.getClassFactory(r),e.exports=n.default},{10:10,52:52,82:82}],80:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t){t&&t.length&&(t.forEach(function(t){var e=t.starttime,n=e+t.duration;o.add(e,n)}),r=!!t[0]._useWallClockTime)}function n(){o.clear()}function i(){var t,e=o.length;if(!e)return!0;t=r?(new Date).getTime()/1e3:l.currentTime;for(var n=0;n<e;n+=1){var i=o.start(n),a=o.end(n);if(i<=t&&t<a)return!0}return!1}var r=!1,a=this.context,s=void 0,o=void 0,l=t.mediaElement;return s={initialize:e,reset:n,isEnabled:i},function(){o=(0,u.default)(a).create()}(),s}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(148),u=i(o);r.__dashjs_factory_name="RangeController",n.default=s.default.getClassFactory(r),e.exports=n.default},{10:10,148:148}],81:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e){t.some(function(t){var n=a.create(t,e);if(n)return r.push(n),!0})}function n(){r.forEach(function(t){return t.reset()}),r=[]}function i(t,e){r.forEach(function(n){return n.report(t,e)})}var r=[],a=(0,u.default)(this.context).getInstance({log:t.log});return{initialize:e,reset:n,report:i}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(87),u=i(o);r.__dashjs_factory_name="ReportingController",n.default=s.default.getClassFactory(r),e.exports=n.default},{10:10,87:87}],82:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(e,n){var i,u=e.match(a);if(u){try{i=o[u[1]](s).create({eventBus:t.eventBus}),i.initialize(u[1],n,u[3],u[5])}catch(t){i=null,r("MetricsHandlerFactory: Could not create handler for type "+u[1]+" with args "+u[3]+", "+u[5]+" ("+t.message+")")}return i}}function n(t,e){o[t]=e}function i(t){delete o[t]}var r=t.log,a=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,s=this.context,o={BufferLevel:u.default,DVBErrors:c.default,HttpList:f.default,PlayList:g.default,RepSwitchList:g.default,TcpList:g.default};return{create:e,register:n,unregister:i}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(83),u=i(o),l=t(84),c=i(l),h=t(86),f=i(h),d=t(85),g=i(d);r.__dashjs_factory_name="MetricsHandlerFactory",n.default=s.default.getSingletonFactory(r),e.exports=n.default},{10:10,83:83,84:84,85:85,86:86}],83:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){try{return Object.keys(d).map(function(t){return d[t]}).reduce(function(t,e){return t.level<e.level?t:e})}catch(t){return}}function e(){var e=t();e&&c!==e.t&&(c=e.t,a.report(o,e))}function n(t,n,i){n&&(s=f.validateN(i),a=n,o=f.reconstructFullMetricName(t,i),l=setInterval(e,s))}function i(){clearInterval(l),l=null,s=0,a=null,c=null}function r(t,e,n){"BufferLevel"===t&&(d[n]=e)}var a=void 0,s=void 0,o=void 0,l=void 0,c=void 0,h=this.context,f=(0,u.default)(h).getInstance(),d=[];return{initialize:n,reset:i,handleNewMetric:r}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(90),u=i(o);r.__dashjs_factory_name="BufferLevelHandler",n.default=s.default.getClassFactory(r),e.exports=n.default},{10:10,90:90}],84:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(){s.off(u.default.METRICS_INITIALISATION_COMPLETE,e,this),s.trigger(u.default.BECAME_REPORTING_PLAYER)}function n(t,n){n&&(a=n,s.on(u.default.METRICS_INITIALISATION_COMPLETE,e,this))}function i(){a=null}function r(t,e){"DVBErrors"===t&&a&&a.report(t,e)}var a=void 0,s=t.eventBus;return{initialize:n,reset:i,handleNewMetric:r}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(76),u=i(o);n.default=s.default.getClassFactory(r),e.exports=n.default},{10:10,76:76}],85:[function(t,e,n){function i(){function t(t,e){i=t,r=e}function e(){r=null,i=void 0}function n(t,e){t===i&&r&&r.report(i,e)}var i=void 0,r=void 0;return{initialize:t,reset:e,handleNewMetric:n}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="GenericMetricHandler",n.default=a.default.getClassFactory(i),e.exports=n.default},{10:10}],86:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){var t=c;t.length&&r&&r.report(o,t),c=[]}function e(e,n,i,u){n&&(a=h.validateN(i),r=n,u&&u.length&&(s=u),o=h.reconstructFullMetricName(e,i,u),l=setInterval(t,a))}function n(){clearInterval(l),l=null,a=null,s=null,c=[],r=null}function i(t,e){"HttpList"===t&&(s&&s!==e.type||c.push(e))}var r=void 0,a=void 0,s=void 0,o=void 0,l=void 0,c=[],h=(0,u.default)(this.context).getInstance();return{initialize:e,reset:n,handleNewMetric:i}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(90),u=i(o);r.__dashjs_factory_name="HttpListHandler",n.default=s.default.getClassFactory(r),e.exports=n.default},{10:10,90:90}],87:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e){var n;try{n=r[t.schemeIdUri](a).create(),n.initialize(t,e)}catch(e){n=null,s("ReportingFactory: could not create Reporting with schemeIdUri "+t.schemeIdUri+" ("+e.message+")")}return n}function n(t,e){r[t]=e}function i(t){delete r[t]}var r={"urn:dvb:dash:reporting:2014":u.default},a=this.context,s=t.log;return{create:e,register:n,unregister:i}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(88),u=i(o);r.__dashjs_factory_name="ReportingFactory",n.default=s.default.getSingletonFactory(r),e.exports=n.default},{10:10,88:88}],88:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,e,n){var i=new XMLHttpRequest,r=function(){var t=m.indexOf(i);-1!==t&&(m.splice(t,1),i.status>=200&&i.status<300?e&&e():n&&n())};m.push(i);try{i.open("GET",t),i.onloadend=r,i.onerror=r,i.send()}catch(t){i.onerror()}}function e(e,n){Array.isArray(n)||(n=[n]),l&&d.isEnabled()&&n.forEach(function(n){var i=a.serialise(n);o&&"DVBErrors"!==e&&(i="metricname="+e+"&"+i),i=f+"?"+i,t(i,null,function(){l=!1})})}function n(t,e){var n;if(d=e,!(f=t["dvb:reportingUrl"]))throw new Error("required parameter missing (dvb:reportingUrl)");h||(n=t["dvb:probability"]||t["dvb:priority"]||0,n&&(1e3===n||n/1e3>=s.random())&&(l=!0),h=!0)}function i(){g||(m.forEach(function(t){return t.abort()}),m=[]),h=!1,l=!1,f=null,d=null}var r=this.context,a=(0,u.default)(r).getInstance(),s=(0,c.default)(r).getInstance(),o=!0,l=!1,h=!1,f=null,d=null,g=!0,m=[];return{report:e,initialize:n,reset:i}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(92),u=i(o),l=t(93),c=i(l);r.__dashjs_factory_name="DVBReporting",n.default=s.default.getClassFactory(r),e.exports=n.default},{10:10,92:92,93:93}],89:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t){var e=new s.default;if(b){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.mpdurl||(e.mpdurl=b.originalUrl||b.url),e.terror||(e.terror=new Date),p.addDVBErrors(e)}}function n(t){t.error||(b=t.manifest)}function i(t){e({errorcode:s.default.BASE_URL_CHANGED,servicelocation:t.entry})}function r(){e({errorcode:s.default.BECAME_REPORTER})}function a(t){(0===t.responsecode||t.responsecode>=400||t.responsecode<100||t.responsecode>=600)&&e({errorcode:t.responsecode||s.default.CONNECTION_ERROR,url:t.url,terror:t.tresponse,servicelocation:t._serviceLocation})}function o(t){switch(t.metric){case"HttpList":a(t.value)}}function l(t){var n;switch(t.error?t.error.code:0){case MediaError.MEDIA_ERR_NETWORK:n=s.default.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:n=s.default.CORRUPT_MEDIA_OTHER;break;default:return}e({errorcode:n})}function h(){m.on(u.default.MANIFEST_UPDATED,n,g),m.on(u.default.SERVICE_LOCATION_BLACKLIST_CHANGED,i,g),m.on(c.default.METRIC_ADDED,o,g),m.on(c.default.METRIC_UPDATED,o,g),m.on(c.default.PLAYBACK_ERROR,l,g),m.on(f.default.BECAME_REPORTING_PLAYER,r,g)}function d(){m.off(u.default.MANIFEST_UPDATED,n,g),m.off(u.default.SERVICE_LOCATION_BLACKLIST_CHANGED,i,g),m.off(c.default.METRIC_ADDED,o,g),m.off(c.default.METRIC_UPDATED,o,g),m.off(c.default.PLAYBACK_ERROR,l,g),m.off(f.default.BECAME_REPORTING_PLAYER,r,g)}var g=void 0,m=t.eventBus,p=t.metricsModel,b=void 0;return g={initialise:h,reset:d},h(),g}Object.defineProperty(n,"__esModule",{value:!0});var a=t(94),s=i(a),o=t(13),u=i(o),l=t(52),c=i(l),h=t(76),f=i(h),d=t(10),g=i(d);r.__dashjs_factory_name="DVBErrorsTranslator",n.default=g.default.getSingletonFactory(r),e.exports=n.default},{10:10,13:13,52:52,76:76,94:94}],90:[function(t,e,n){function i(){return{reconstructFullMetricName:function(t,e,n){var i=t;return e&&(i+="("+e,n&&n.length&&(i+=","+n),i+=")"),i},validateN:function(t){if(!t)throw new Error("missing n");if(isNaN(t))throw new Error("n is NaN");if(t<0)throw new Error("n must be positive");return t}}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="HandlerHelpers",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],91:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e,n){var r,a,s=i.getMpd(t),o=0;return e?o=s.availabilityStartTime.getTime()/1e3:(r=this.getRegularPeriods(t,s),r.length&&(o=r[0].start)),a=o,n&&n.hasOwnProperty("starttime")&&(a+=n.starttime),a}function n(t){var n=[];return t.Metrics_asArray&&t.Metrics_asArray.forEach(function(r){var a=new s.default,o=i.getIsDynamic(t);r.hasOwnProperty("metrics")&&(a.metrics=r.metrics,r.Range_asArray&&r.Range_asArray.forEach(function(n){var r=new u.default;r.starttime=e(t,o,n),n.hasOwnProperty("duration")?r.duration=n.duration:r.duration=i.getDuration(t),r._useWallClockTime=o,a.Range.push(r)}),r.Reporting_asArray&&(r.Reporting_asArray.forEach(function(t){var e=new c.default
;if(t.hasOwnProperty("schemeIdUri")){e.schemeIdUri=t.schemeIdUri;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);a.Reporting.push(e)}}),n.push(a)))}),n}var i=t.dashManifestModel;return{getMetrics:n}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(95),s=i(a),o=t(96),u=i(o),l=t(97),c=i(l),h=t(10),f=i(h);r.__dashjs_factory_name="ManifestParsing",n.default=f.default.getSingletonFactory(r),e.exports=n.default},{10:10,95:95,96:96,97:97}],92:[function(t,e,n){function i(){function t(e){var n,i,r=[],a=[];for(n in e)if(e.hasOwnProperty(n)&&0!==n.indexOf("_")){if(i=e[n],void 0!==i&&null!==i||(i=""),Array.isArray(i)){if(!i.length)continue;a=[],i.forEach(function(e){var n="Object"!==Object.prototype.toString.call(e).slice(8,-1);a.push(n?e:t(e))}),i=encodeURIComponent(a.join(","))}else"string"==typeof i?i=encodeURIComponent(i):i instanceof Date?i=i.toISOString():"number"==typeof i&&(i=Math.round(i));r.push(n+"="+i)}return r.join("&")}return{serialise:t}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="MetricSerialiser",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],93:[function(t,e,n){function i(){function t(){n&&(s||(s=new i(a)),n.getRandomValues(s),o=0)}function e(e,i){var a;return e||(e=0),i||(i=1),n?(o===s.length&&t(),a=s[o]/r,o+=1):a=Math.random(),a*(i-e)+e}var n=window.crypto||window.msCrypto,i=Uint32Array,r=Math.pow(2,8*i.BYTES_PER_ELEMENT)-1,a=10,s=void 0,o=void 0,u=void 0;return u={random:e},t(),u}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="RNG",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],94:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};r.SSL_CONNECTION_FAILED_PREFIX="SSL",r.DNS_RESOLUTION_FAILED="C00",r.HOST_UNREACHABLE="C01",r.CONNECTION_REFUSED="C02",r.CONNECTION_ERROR="C03",r.CORRUPT_MEDIA_ISOBMFF="M00",r.CORRUPT_MEDIA_OTHER="M01",r.BASE_URL_CHANGED="F00",r.BECAME_REPORTER="S00",n.default=r,e.exports=n.default},{}],95:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.metrics="",this.Range=[],this.Reporting=[]};n.default=r,e.exports=n.default},{}],96:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1};n.default=r,e.exports=n.default},{}],97:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.schemeIdUri="",this.value=""};n.default=r,e.exports=n.default},{}],98:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(){function t(t,e,n){var i=g.getBaseURLsFromElement(n);t[e]?m.areSimpleEquivalent(i,t[e].data.baseUrls)||(t[e].data.baseUrls=i,t[e].data.selectedIdx=f):t[e]=new d(i)}function e(e){var n=g.getBaseURLsFromElement(e);m.areSimpleEquivalent(n,c.data.baseUrls)||(c.data.baseUrls=n,c.data.selectedIdx=f),e.Period_asArray&&e.Period_asArray.forEach(function(e,n){t(c.children,n,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach(function(e,i){t(c.children[n].children,i,e),e.Representation_asArray&&e.Representation_asArray.sort(g.getRepresentationSortFunction()).forEach(function(e,r){t(c.children[n].children[i].children,r,e)})})})}function n(t,e){var i=e||c;t(i.data),i.children&&i.children.forEach(function(e){return n(t,e)})}function i(t){n(function(e){isNaN(e.selectedIdx)||t===e.baseUrls[e.selectedIdx].serviceLocation&&(e.selectedIdx=f)})}function r(t){e(t)}function a(){c=new d}function s(t){var e=c,n=[e.data];return t.forEach(function(t){(e=e.children[t])&&n.push(e.data)}),n.filter(function(t){return t.baseUrls.length})}var u=void 0,c=void 0,h=this.context,g=(0,o.default)(h).getInstance(),m=(0,l.default)(h).getInstance();return u={reset:a,update:r,getForPath:s,invalidateSelectedIndexes:i},function(){c=new d}(),u}Object.defineProperty(n,"__esModule",{value:!0});var s=t(22),o=i(s),u=t(155),l=i(u),c=t(10),h=i(c),f=NaN,d=function t(e,n){r(this,t),this.data={baseUrls:e||null,selectedIdx:n||f},this.children=[]};a.__dashjs_factory_name="BaseURLTreeModel",n.default=h.default.getClassFactory(a),e.exports=n.default},{10:10,155:155,22:22}],99:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t){j=t}function n(t){R=t}function i(){return R}function r(t){var e=function(t,e){return t.action===f.default.ACTION_COMPLETE&&t.action===e.action},n=function(t,e){return!isNaN(t.index)&&t.startTime===e.startTime&&t.adaptationIndex===e.adaptationIndex},i=function(t,e){return isNaN(t.index)&&isNaN(e.index)&&t.quality===e.quality};return function(r){var a=!1;return r.some(function(r){if(n(t,r)||i(t,r)||e(t,r))return a=!0}),a}(O)}function a(t){var e=t.state instanceof Array?t.state:[t.state],n=[];return e.forEach(function(e){var i=v(e);n=n.concat(_(i,t))}),n}function o(t){O=O.filter(function(e){return isNaN(e.startTime)||e.startTime>=t})}function l(){j.abort(),A=[]}function c(t){switch(t.action){case f.default.ACTION_COMPLETE:O.push(t),y(t,p),w.trigger(u.default.STREAM_COMPLETED,{request:t,fragmentModel:this});break;case f.default.ACTION_DOWNLOAD:y(t,m),A.push(t),h(t);break;default:S("Unknown request action.")}}function h(t){w.trigger(u.default.FRAGMENT_LOADING_STARTED,{sender:C,request:t}),j.load(t)}function d(t,e,n){for(var i=t.length-1,r=i;r>=0;r--){var a=t[r],s=a.startTime,o=s+a.duration;if(n=void 0!==n?n:a.duration/2,!isNaN(s)&&!isNaN(o)&&e+n>=s&&e-n<o||isNaN(s)&&isNaN(e))return a}return null}function _(t,e){return e.hasOwnProperty("time")?[d(t,e.time,e.threshold)]:t.filter(function(t){for(var n in e)if("state"!==n&&e.hasOwnProperty(n)&&t[n]!=e[n])return!1;return!0})}function v(t){var e=void 0;switch(t){case m:e=A;break;case p:e=O;break;default:e=[]}return e}function y(t,e){M.addSchedulingInfo(t.mediaType,new Date,t.type,t.startTime,t.availabilityStartTime,t.duration,t.quality,t.range,e),M.addRequestsQueue(t.mediaType,A,O)}function E(t){t.sender===j&&(A.splice(A.indexOf(t.request),1),t.response&&!t.error&&O.push(t.request),y(t.request,t.error?b:p),w.trigger(u.default.FRAGMENT_LOADING_COMPLETED,{request:t.request,response:t.response,error:t.error,sender:this}))}function T(){w.off(u.default.LOADING_COMPLETED,E,this),j&&(j.reset(),j=null),O=[],A=[]}var x=this.context,S=(0,g.default)(x).getInstance().log,w=(0,s.default)(x).getInstance(),M=t.metricsModel,C=void 0,R=void 0,O=void 0,A=void 0,j=void 0;return C={setLoader:e,setScheduleController:n,getScheduleController:i,getRequests:a,isFragmentLoaded:r,removeExecutedRequestsBeforeTime:o,abortRequests:l,executeRequest:c,reset:T},function(){R=null,j=null,O=[],A=[],w.on(u.default.LOADING_COMPLETED,E,C)}(),C}Object.defineProperty(n,"__esModule",{value:!0});var a=t(9),s=i(a),o=t(13),u=i(o),l=t(10),c=i(l),h=t(163),f=i(h),d=t(8),g=i(d),m="loading",p="executed",b="failed";r.__dashjs_factory_name="FragmentModel";var _=c.default.getClassFactory(r);_.FRAGMENT_MODEL_LOADING=m,_.FRAGMENT_MODEL_EXECUTED=p,_.FRAGMENT_MODEL_CANCELED="canceled",_.FRAGMENT_MODEL_FAILED=b,n.default=_,e.exports=n.default},{10:10,13:13,163:163,8:8,9:9}],100:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){return r}function e(t){r=t,t&&i.trigger(u.default.MANIFEST_LOADED,{data:t})}var n=this.context,i=(0,s.default)(n).getInstance(),r=void 0;return{getValue:t,setValue:e}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(9),s=i(a),o=t(13),u=i(o),l=t(10),c=i(l);r.__dashjs_factory_name="ManifestModel",n.default=c.default.getSingletonFactory(r),e.exports=n.default},{10:10,13:13,9:9}],101:[function(t,e,n){function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(){function t(t){Ut=t}function e(){return Ut}function n(t){Dt=t}function r(){return Dt}function a(t){kt=t}function s(){return kt}function u(t){jt=t}function A(){return isNaN(jt)?Gt?b:p:jt}function j(t){It=t}function I(){return It}function P(t){Pt=t}function L(){return Pt}function N(t){Lt=t}function D(){return Lt}function k(t){Nt=t}function F(){return Nt}function V(t){Ct=t}function B(){return Ct}function U(t,e){Ot.enabled=t,void 0===e||isNaN(e)||"number"!=typeof e||(Ot.ttl=e)}function z(){return Ot}function G(t,e){At.enabled=t,void 0===e||isNaN(e)||"number"!=typeof e||(At.ttl=e)}function $(){return At}function H(t){Rt=t}function q(){return Rt}function X(t){Ft[o.HTTPRequest.MEDIA_SEGMENT_TYPE]=t}function K(t,e){Ft[t]=e}function W(){return Ft[o.HTTPRequest.MEDIA_SEGMENT_TYPE]}function Y(t){return Ft[t]}function Q(t){Vt[o.HTTPRequest.MEDIA_SEGMENT_TYPE]=t}function Z(t,e){Vt[t]=e}function J(){return Vt[o.HTTPRequest.MEDIA_SEGMENT_TYPE]}function tt(t){return Vt[t]}function et(t){Bt=t}function nt(){return Bt}function it(t){Mt=t}function rt(){return Mt}function at(t){St=t}function st(t){wt=t}function ot(){return St}function ut(){return wt}function lt(t){Et=t}function ct(){return Et}function ht(t){Tt=t}function ft(){return Tt}function dt(t){xt=t}function gt(){return xt}function mt(t){zt=!!t}function pt(){return zt}function bt(){return Gt}function _t(t){Gt=t}function vt(){}var yt=void 0,Et=void 0,Tt=void 0,xt=void 0,St=void 0,wt=void 0,Mt=void 0,Ct=void 0,Rt=void 0,Ot=void 0,At=void 0,jt=void 0,It=void 0,Pt=void 0,Lt=void 0,Nt=void 0,Dt=void 0,kt=void 0,Ft=void 0,Vt=void 0,Bt=void 0,Ut=void 0,zt=void 0,Gt=void 0;return yt={setBufferOccupancyABREnabled:t,getBufferOccupancyABREnabled:e,setBandwidthSafetyFactor:n,getBandwidthSafetyFactor:r,setAbandonLoadTimeout:a,getAbandonLoadTimeout:s,setLastBitrateCachingInfo:U,getLastBitrateCachingInfo:z,setLastMediaSettingsCachingInfo:G,getLastMediaSettingsCachingInfo:$,setStableBufferTime:u,getStableBufferTime:A,setBufferTimeAtTopQuality:j,getBufferTimeAtTopQuality:I,setBufferTimeAtTopQualityLongForm:P,getBufferTimeAtTopQualityLongForm:L,setLongFormContentDurationThreshold:N,getLongFormContentDurationThreshold:D,setRichBufferThreshold:k,getRichBufferThreshold:F,setBufferToKeep:V,getBufferToKeep:B,setBufferPruningInterval:H,getBufferPruningInterval:q,setFragmentRetryAttempts:X,getFragmentRetryAttempts:W,setRetryAttemptsForType:K,getRetryAttemptsForType:Y,setFragmentRetryInterval:Q,getFragmentRetryInterval:J,setRetryIntervalForType:Z,getRetryIntervalForType:tt,setWallclockTimeUpdateInterval:et,getWallclockTimeUpdateInterval:nt,setScheduleWhilePaused:it,getScheduleWhilePaused:rt,getUseSuggestedPresentationDelay:ft,setUseSuggestedPresentationDelay:ht,setLiveDelayFragmentCount:at,getLiveDelayFragmentCount:ot,getLiveDelay:ut,setLiveDelay:st,setUseManifestDateHeaderTimeSource:lt,getUseManifestDateHeaderTimeSource:ct,setUTCTimingSources:dt,getUTCTimingSources:gt,setXHRWithCredentials:mt,getXHRWithCredentials:pt,setFastSwitchEnabled:_t,getFastSwitchEnabled:bt,reset:vt},function(){var t,e;xt=[],Tt=!1,Et=!0,Mt=!0,Ut=!1,Gt=!1,Ot={enabled:!0,ttl:c},At={enabled:!0,ttl:h},St=l,wt=void 0,Ct=g,Rt=m,jt=NaN,It=_,Pt=v,Lt=y,Nt=E,Dt=f,kt=d,Bt=R,zt=O,t={},i(t,o.HTTPRequest.MPD_TYPE,S),i(t,o.HTTPRequest.XLINK_EXPANSION_TYPE,M),i(t,o.HTTPRequest.MEDIA_SEGMENT_TYPE,T),i(t,o.HTTPRequest.INIT_SEGMENT_TYPE,T),i(t,o.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,T),i(t,o.HTTPRequest.INDEX_SEGMENT_TYPE,T),i(t,o.HTTPRequest.OTHER_TYPE,T),Ft=t,e={},i(e,o.HTTPRequest.MPD_TYPE,w),i(e,o.HTTPRequest.XLINK_EXPANSION_TYPE,C),i(e,o.HTTPRequest.MEDIA_SEGMENT_TYPE,x),i(e,o.HTTPRequest.INIT_SEGMENT_TYPE,x),i(e,o.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,x),i(e,o.HTTPRequest.INDEX_SEGMENT_TYPE,x),i(e,o.HTTPRequest.OTHER_TYPE,x),Vt=e}(),yt}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=function(t){return t&&t.__esModule?t:{default:t}}(a),o=t(179),u={scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"http://time.akamai.com/?iso"},l=4,c=36e4,h=36e4,f=.9,d=1e4,g=30,m=30,p=12,b=20,_=30,v=60,y=600,E=20,T=3,x=1e3,S=3,w=500,M=1,C=500,R=50,O=!1;r.__dashjs_factory_name="MediaPlayerModel";var A=s.default.getSingletonFactory(r);A.DEFAULT_UTC_TIMING_SOURCE=u,n.default=A,e.exports=n.default},{10:10,179:179}],102:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){t&&t.adapter&&(G=t.adapter)}function e(){U.trigger(R.default.METRICS_CHANGED)}function n(t){U.trigger(R.default.METRIC_CHANGED,{mediaType:t}),e()}function i(t,e,i){U.trigger(R.default.METRIC_UPDATED,{mediaType:t,metric:e,value:i}),n(t)}function r(t,e,i){U.trigger(R.default.METRIC_ADDED,{mediaType:t,metric:e,value:i}),n(t)}function a(t){delete $[t],n(t)}function o(){$={},e()}function c(t){return $.hasOwnProperty(t)?$[t]:null}function f(t){var e;return $.hasOwnProperty(t)?e=$[t]:(e=new s.default,$[t]=e),e}function g(t,e,n,i,a,s){var o=new u.default;return o.tcpid=e,o.dest=n,o.topen=i,o.tclose=a,o.tconnect=s,f(t).TcpList.push(o),r(t,G.metricsList.TCP_CONNECTION,o),o}function p(t,e,n,i){var r=new l.HTTPRequestTrace;return r.s=e,r.d=n,r.b=i,t.trace.push(r),t.interval||(t.interval=0),t.interval+=n,r}function _(t,e,n,i,a,s,o,u,c,h,d,g,m,b){var v=new l.HTTPRequest;return a&&a!==i&&(_(t,null,n,i,null,null,o,u,null,null,null,g,null,null),v.actualurl=a),v.tcpid=e,v.type=n,v.url=i,v.range=o,v.trequest=u,v.tresponse=c,v.responsecode=d,v._tfinish=h,v._stream=t,v._mediaduration=g,v._responseHeaders=m,v._serviceLocation=s,b?b.forEach(function(t){p(v,t.s,t.d,t.b)}):(delete v.interval,delete v.trace),f(t).HttpList.push(v),r(t,G.metricsList.HTTP_REQUEST,v),v}function E(t,e,n,i,a){var s=new h.default;return s.t=e,s.mt=n,s.to=i,a?s.lto=a:delete s.lto,f(t).RepSwitchList.push(s),r(t,G.metricsList.TRACK_SWITCH,s),s}function x(t,e,n){var i=new d.default;return i.t=e,i.level=n,f(t).BufferLevel.push(i),r(t,G.metricsList.BUFFER_LEVEL,i),i}function w(t,e,n){var i=new m.default;return i.target=n,i.state=e,f(t).BufferState.push(i),r(t,G.metricsList.BUFFER_STATE,i),i}function C(t,e,n,i){var a=new b.default;return a.time=e,a.range=i,a.manifestInfo=n,f(t).DVRInfo.push(a),r(t,G.metricsList.DVR_INFO,a),a}function O(t,e){var n=new v.default,i=f(t).DroppedFrames;return n.time=e.creationTime,n.droppedFrames=e.droppedVideoFrames,i.length>0&&i[i.length-1]==n?i[i.length-1]:(i.push(n),r(t,G.metricsList.DROPPED_FRAMES,n),n)}function A(t,e,n,i,a,s,o,u,l){var c=new T.default;return c.mediaType=t,c.t=e,c.type=n,c.startTime=i,c.availabilityStartTime=a,c.duration=s,c.quality=o,c.range=u,c.state=l,f(t).SchedulingInfo.push(c),r(t,G.metricsList.SCHEDULING_INFO,c),c}function j(t,e,n){var i=new M.default;i.loadingRequests=e,i.executedRequests=n,f(t).RequestsQueue=i,r(t,G.metricsList.REQUESTS_QUEUE,i)}function P(t,e,n,i,a,s,o,u,l,c){var h=new y.ManifestUpdate,d=f("stream");return h.mediaType=t,h.type=e,h.requestTime=n,h.fetchTime=i,h.availabilityStartTime=a,h.presentationStartTime=s,h.clientTimeOffset=o,h.currentTime=u,h.buffered=l,h.latency=c,d.ManifestUpdate.push(h),r(t,G.metricsList.MANIFEST_UPDATE,h),h}function L(t,e){if(t){for(var n in e)t[n]=e[n];i(t.mediaType,G.metricsList.MANIFEST_UPDATE,t)}}function N(t,e,n,r,a){if(t){var s=new y.ManifestUpdateStreamInfo;return s.id=e,s.index=n,s.start=r,s.duration=a,t.streamInfo.push(s),i(t.mediaType,G.metricsList.MANIFEST_UPDATE_STREAM_INFO,t),s}return null}function D(t,e,n,r,a,s,o,u){if(t){var l=new y.ManifestUpdateTrackInfo;return l.id=e,l.index=n,l.streamIndex=r,l.mediaType=a,l.startNumber=o,l.fragmentInfoType=u,l.presentationTimeOffset=s,t.trackInfo.push(l),i(t.mediaType,G.metricsList.MANIFEST_UPDATE_TRACK_INFO,t),l}return null}function k(t){var e="stream";return t.trace&&Array.isArray(t.trace)?t.trace.forEach(function(t){t.hasOwnProperty("subreplevel")&&!t.subreplevel&&delete t.subreplevel}):delete t.trace,f(e).PlayList.push(t),r(e,G.metricsList.PLAY_LIST,t),t}function F(t){var e="stream";return f(e).DVBErrors.push(t),r(e,G.metricsList.DVB_ERRORS,t),t}function V(t,e){var n=new I.default;return n._s=e,f(t).BolaState=[n],r(t,"BolaState",n),n}var B=this.context,U=(0,S.default)(B).getInstance(),z=void 0,G=void 0,$=void 0;return z={metricsChanged:e,metricChanged:n,metricUpdated:i,metricAdded:r,clearCurrentMetricsForType:a,clearAllCurrentMetrics:o,getReadOnlyMetricsFor:c,getMetricsFor:f,addTcpConnection:g,addHttpRequest:_,addRepresentationSwitch:E,addBufferLevel:x,addBufferState:w,addDVRInfo:C,addDroppedFrames:O,addSchedulingInfo:A,addRequestsQueue:j,addManifestUpdate:P,updateManifestUpdateInfo:L,addManifestUpdateStreamInfo:N,addManifestUpdateRepresentationInfo:D,addPlayList:k,addDVBErrors:F,updateBolaState:V,setConfig:t},function(){$={}}(),z}Object.defineProperty(n,"__esModule",{value:!0});var a=t(168),s=i(a),o=t(185),u=i(o),l=t(179),c=t(182),h=i(c),f=t(175),d=i(f),g=t(176),m=i(g),p=t(177),b=i(p),_=t(178),v=i(_),y=t(180),E=t(184),T=i(E),x=t(9),S=i(x),w=t(183),M=i(w),C=t(13),R=i(C),O=t(10),A=i(O),j=t(174),I=i(j);r.__dashjs_factory_name="MetricsModel",n.default=A.default.getSingletonFactory(r),e.exports=n.default},{10:10,13:13,168:168,174:174,175:175,176:176,177:177,178:178,179:179,180:180,182:182,183:183,184:184,185:185,9:9}],103:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){a=new s.default,o=[],u=!1}function e(){return a}function n(){return o}function i(){return u}function r(t){function e(t,e,n,i){var r=i[0].split(/[=]/);return i.push({key:r[0],value:r[1]}),i.shift(),i}function n(t,e,n){return e>0&&(c&&0===o.length?o=n[e].split(/[&]/):h&&(i=n[e].split(/[&]/))),n}if(!t)return null;var i=[],r=new RegExp(/[?]/),s=new RegExp(/[#]/),l=new RegExp(/^(https:)?\/\//i),c=r.test(t),h=s.test(t);return u=l.test(t),t.split(/[?#]/).map(n),o.length>0&&(o=o.reduce(e,null)),i.length>0&&(i=i.reduce(e,null),i.forEach(function(t){a[t.key]=t.value})),t}var a=void 0,o=void 0,u=void 0;return{initialize:t,parseURI:r,getURIFragmentData:e,getURIQueryData:n,isManifestHTTPS:i}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(173),s=i(a),o=t(10),u=i(o);r.__dashjs_factory_name="URIQueryAndFragmentModel",n.default=u.default.getSingletonFactory(r),e.exports=n.default},{10:10,173:173}],104:[function(t,e,n){function i(){function t(){y=[]}function e(t){!b||b.readyState<2||(b.playbackRate=t)}function n(t){if(b.currentTime!=t)try{b.currentTime=t}catch(e){0===b.readyState&&e.code===e.INVALID_STATE_ERR&&setTimeout(function(){b.currentTime=t},400)}}function i(){return b}function r(t){b=t,b.preload="auto"}function a(t){t?b.src=t:(b.removeAttribute("src"),b.load())}function s(){return b.src}function o(){return v}function u(t){v=t}function l(){return _}function c(t){_=t,_.style.position="absolute",_.style.display="flex",_.style.overflow="hidden",_.style.pointerEvents="none",_.style.top=0,_.style.left=0}function h(t,e){m(t,e)}function f(){return y.length>0}function d(t){var n=void 0;null===t||b.seeking||-1!==y.indexOf(t)||(y.push(t),1===y.length&&(n=document.createEvent("Event"),n.initEvent("waiting",!0,!1),E=b.playbackRate,e(0),b.dispatchEvent(n)))}function g(t){var n=y.indexOf(t),i=void 0;null!==t&&(-1!==n&&y.splice(n,1),!1===f()&&0===b.playbackRate&&(i=document.createEvent("Event"),i.initEvent("playing",!0,!1),e(E||1),b.dispatchEvent(i)))}function m(t,e){e?d(t):g(t)}function p(){var t="webkitDroppedFrameCount"in b,e="getVideoPlaybackQuality"in b,n=null;return e?n=b.getVideoPlaybackQuality():t&&(n={droppedVideoFrames:b.webkitDroppedFrameCount,creationTime:new Date}),n}var b=void 0,_=void 0,v=void 0,y=void 0,E=void 0;return{initialize:t,setCurrentTime:n,setStallState:h,getElement:i,setElement:r,setSource:a,getSource:s,getVideoContainer:o,setVideoContainer:u,getTTMLRenderingDiv:l,setTTMLRenderingDiv:c,getPlaybackQuality:p}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="VideoModel",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],105:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=t(1),s=function(t){return t&&t.__esModule?t:{default:t}}(a),o=function(){function t(){i(this,t)}return r(t,null,[{key:"findCencContentProtection",value:function(t){for(var e=null,n=0;n<t.length;++n){var i=t[n];"urn:mpeg:dash:mp4protection:2011"===i.schemeIdUri.toLowerCase()&&"cenc"===i.value.toLowerCase()&&(e=i)}return e}},{key:"getPSSHData",value:function(t){var e=8,n=new DataView(t),i=n.getUint8(e);return e+=20,i>0&&(e+=4+16*n.getUint32(e)),e+=4,t.slice(e)}},{key:"getPSSHForKeySystem",value:function(e,n){var i=t.parsePSSHList(n);return i.hasOwnProperty(e.uuid.toLowerCase())?i[e.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(t){return"pssh"in t?s.default.decodeArray(t.pssh.__text).buffer:null}},{key:"parsePSSHList",value:function(t){if(null===t)return[];for(var e=new DataView(t),n={},i=0;1;){var r=void 0,a=void 0,s=void 0,o=void 0,u=i;if(i>=e.buffer.byteLength)break;if(r=e.getUint32(i),a=i+r,i+=4,1886614376===e.getUint32(i))if(i+=4,0===(s=e.getUint8(i))||1===s){i++,i+=3,o="";var l=void 0,c=void 0;for(l=0;l<4;l++)c=e.getUint8(i+l).toString(16),o+=1===c.length?"0"+c:c;for(i+=4,o+="-",l=0;l<2;l++)c=e.getUint8(i+l).toString(16),o+=1===c.length?"0"+c:c;for(i+=2,o+="-",l=0;l<2;l++)c=e.getUint8(i+l).toString(16),o+=1===c.length?"0"+c:c;for(i+=2,o+="-",l=0;l<2;l++)c=e.getUint8(i+l).toString(16),o+=1===c.length?"0"+c:c;for(i+=2,o+="-",l=0;l<6;l++)c=e.getUint8(i+l).toString(16),o+=1===c.length?"0"+c:c;i+=6,o=o.toLowerCase(),e.getUint32(i),i+=4,n[o]=e.buffer.slice(u,a),i=a}else i=a;else i=a}return n}}]),t}();n.default=o,e.exports=n.default},{1:1}],106:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){var n=null,r=(0,u.default)(i).getInstance();r.setConfig({log:t.log}),r.initialize();var a=e(t);return!n&&a&&(n=(0,s.default)(i).create({protectionModel:a,protectionKeyController:r,adapter:t.adapter,eventBus:t.eventBus,log:t.log}),t.capabilities.setEncryptedMediaSupported(!0)),n}function e(t){var e=t.log,r=t.eventBus,a=t.videoModel.getElement();return void 0!==a.onencrypted&&void 0!==a.mediaKeys&&void 0!==navigator.requestMediaKeySystemAccess&&"function"==typeof navigator.requestMediaKeySystemAccess?(e("EME detected on this user agent! (ProtectionModel_21Jan2015)"),(0,f.default)(i).create({log:e,eventBus:r})):n(a,y)?(e("EME detected on this user agent! (ProtectionModel_3Feb2014)"),(0,g.default)(i).create({log:e,eventBus:r,api:n(a,y)})):n(a,v)?(e("EME detected on this user agent! (ProtectionModel_01b)"),(0,p.default)(i).create({log:e,eventBus:r,api:n(a,v)})):(e("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null)}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];if("function"==typeof t[i[Object.keys(i)[0]]])return i}return null}var i=this.context;return{createProtectionSystem:t}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(108),s=i(a),o=t(109),u=i(o),l=t(107),c=i(l),h=t(114),f=i(h),d=t(115),g=i(d),m=t(113),p=i(m),b=t(10),_=i(b),v=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],y=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];r.__dashjs_factory_name="Protection";var E=_.default.getClassFactory(r);E.events=c.default,n.default=E,e.exports=n.default},{10:10,107:107,108:108,109:109,113:113,114:114,115:115}],107:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(14),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=function(t){function e(){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.INTERNAL_KEY_MESSAGE="internalKeyMessage",this.INTERNAL_KEY_SYSTEM_SELECTED="internalKeySystemSelected",this.KEY_ADDED="public_keyAdded",this.KEY_ERROR="public_keyError",this.KEY_MESSAGE="public_keyMessage",this.KEY_SESSION_CLOSED="public_keySessionClosed",this.KEY_SESSION_CREATED="public_keySessionCreated",this.KEY_SESSION_REMOVED="public_keySessionRemoved",this.KEY_STATUSES_CHANGED="public_keyStatusesChanged",this.KEY_SYSTEM_ACCESS_COMPLETE="keySystemAccessComplete",this.KEY_SYSTEM_SELECTED="public_keySystemSelected",this.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",this.NEED_KEY="needkey",this.PROTECTION_CREATED="public_protectioncreated",this.PROTECTION_DESTROYED="public_protectiondestroyed",this.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",this.TEARDOWN_COMPLETE="protectionTeardownComplete",this.VIDEO_ELEMENT_SELECTED="videoElementSelected"}return r(e,t),e}(o.default),l=new u;n.default=l,e.exports=n.default},{14:14}],108:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e,n){if(!P){var i;e||n||(i=S.getStreamsInfo(t)[0]),A=e||(i?S.getMediaInfoForType(t,i,"audio"):null),j=n||(i?S.getMediaInfoForType(t,i,"video"):null);var r=j||A,a=T.getSupportedKeySystemsFromContentProtection(r.contentProtection);a&&a.length>0&&_(a,!0),P=!0}}function n(t){var e=s.default.getPSSHForKeySystem(D,t);if(e){for(var n=x.getAllInitData(),i=0;i<n.length;i++)if(T.initDataEquals(e,n[i]))return void M("DRM: Ignoring initData because we have already seen it!");try{x.createKeySession(e,L)}catch(t){w.trigger(u.default.KEY_SESSION_CREATED,{data:null,error:"Error creating key session! "+t.message})}}else w.trigger(u.default.KEY_SESSION_CREATED,{data:null,error:"Selected key system is "+D.systemString+".  needkey/encrypted event contains no initData corresponding to that key system!"})}function i(t){x.loadKeySession(t)}function r(t){x.removeKeySession(t)}function a(t){x.closeKeySession(t)}function o(t){x.setServerCertificate(t)}function l(t){t?(x.setMediaElement(t),w.on(u.default.NEED_KEY,E,this),w.on(u.default.INTERNAL_KEY_MESSAGE,y,this)):null===t&&(x.setMediaElement(t),w.off(u.default.NEED_KEY,E,this),w.off(u.default.INTERNAL_KEY_MESSAGE,y,this))}function h(t){L=t}function d(t){N=t}function g(t){I=t}function m(){l(null),D=void 0,x&&(x.reset(),x=null)}function b(t){var e=null,n=t.systemString;return I&&(e=n in I?I[n]:null),e}function _(t,e){var i=this,r=[],a=[];j&&a.push(new c.default(j.codec,N)),A&&r.push(new c.default(A.codec,N));var s,o=new f.default(r,a,"optional","temporary"===L?"optional":"required",[L]),l=[];if(D){for(s=0;s<t.length;s++)if(D===t[s].ks){var h=function(){l.push({ks:t[s].ks,configs:[o]});var r=function r(a){w.off(u.default.KEY_SYSTEM_ACCESS_COMPLETE,r,i),a.error?e||w.trigger(u.default.KEY_SYSTEM_SELECTED,{error:"DRM: KeySystem Access Denied! -- "+a.error}):(M("DRM: KeySystem Access Granted"),w.trigger(u.default.KEY_SYSTEM_SELECTED,{data:a.data}),n(t[s].initData))};return w.on(u.default.KEY_SYSTEM_ACCESS_COMPLETE,r,i),x.requestKeySystemAccess(l),"break"}();if("break"===h)break}}else if(void 0===D){D=null,O.push(t);for(var d=0;d<t.length;d++)l.push({ks:t[d].ks,configs:[o]});var g,m=function t(n){w.off(u.default.KEY_SYSTEM_ACCESS_COMPLETE,t,i),n.error?(D=void 0,w.off(u.default.INTERNAL_KEY_SYSTEM_SELECTED,p,i),e||w.trigger(u.default.KEY_SYSTEM_SELECTED,{data:null,error:"DRM: KeySystem Access Denied! -- "+n.error})):(g=n.data,M("DRM: KeySystem Access Granted ("+g.keySystem.systemString+")!  Selecting key system..."),x.selectKeySystem(g))},p=function t(r){if(w.off(u.default.INTERNAL_KEY_SYSTEM_SELECTED,t,i),w.off(u.default.KEY_SYSTEM_ACCESS_COMPLETE,m,i),r.error)D=void 0,e||w.trigger(u.default.KEY_SYSTEM_SELECTED,{data:null,error:"DRM: Error selecting key system! -- "+r.error});else{D=x.getKeySystem(),w.trigger(u.default.KEY_SYSTEM_SELECTED,{data:g});for(var a=0;a<O.length;a++)for(s=0;s<O[a].length;s++)if(D===O[a][s].ks){n(O[a][s].initData);break}}};w.on(u.default.INTERNAL_KEY_SYSTEM_SELECTED,p,i),w.on(u.default.KEY_SYSTEM_ACCESS_COMPLETE,m,i),x.requestKeySystemAccess(l)}else O.push(t)}function v(t,e){w.trigger(u.default.LICENSE_REQUEST_COMPLETE,{data:t,error:e})}function y(t){if(M("DRM: onKeyMessage"),t.error)return void M(t.error);var e=t.data;w.trigger(u.default.KEY_MESSAGE,{data:e});var n=e.messageType?e.messageType:"license-request",i=e.message,r=e.sessionToken,a=b(D),o=D.systemString,l=T.getLicenseServer(D,a,n),c={sessionToken:r,messageType:n};if(!l)return M("DRM: License server request not required for this message (type = "+t.data.messageType+").  Session ID = "+r.getSessionID()),void v(c);if(T.isClearKey(D)){var h=T.processClearKeyLicenseRequest(a,i);if(h)return M("DRM: ClearKey license request handled by application!"),v(c),void x.updateKeySession(r,h)}var f=new XMLHttpRequest,d=null;if(a)if(a.serverURL){var g=a.serverURL;"string"==typeof g&&""!==g?d=g:"object"==(void 0===g?"undefined":$traceurRuntime.typeof(g))&&g.hasOwnProperty(n)&&(d=g[n])}else a.laURL&&""!==a.laURL&&(d=a.laURL);else(d=D.getLicenseServerURLFromInitData(s.default.getPSSHData(r.initData)))||(d=t.data.laURL);if(!(d=l.getServerURLFromMessage(d,i,n)))return void v(c,"DRM: No license server URL specified!");f.open(l.getHTTPMethod(n),d,!0),f.responseType=l.getResponseType(o,n),f.onload=function(){200==this.status?(v(c),x.updateKeySession(r,l.getLicenseMessage(this.response,o,n))):v(c,"DRM: "+o+' update, XHR status is "'+this.statusText+'" ('+this.status+"), expected to be 200. readyState is "+this.readyState+".  Response is "+(this.response?l.getErrorResponse(this.response,o,n):"NONE"))},f.onabort=function(){v(c,"DRM: "+o+' update, XHR aborted. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)},f.onerror=function(){v(c,"DRM: "+o+' update, XHR error. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)};var m=function(t){var e;if(t)for(e in t)"authorization"===e.toLowerCase()&&(f.withCredentials=!0),f.setRequestHeader(e,t[e])};a&&m(a.httpRequestHeaders),m(D.getRequestHeadersFromMessage(i)),a&&a.withCredentials&&(f.withCredentials=!0),f.send(D.getLicenseRequestFromMessage(i))}function E(t){if(M("DRM: onNeedKey"),
"cenc"!==t.key.initDataType)return void M("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+t.key.initDataType);var e=t.key.initData;ArrayBuffer.isView(e)&&(e=e.buffer),M("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(e)));var n=T.getSupportedKeySystems(e,I);return 0===n.length?void M("DRM: Received needkey event with initData, but we don't support any of the key systems!"):void _(n,!1)}var T=t.protectionKeyController,x=t.protectionModel,S=t.adapter,w=t.eventBus,M=t.log,C=void 0,R=void 0,O=void 0,A=void 0,j=void 0,I=void 0,P=void 0,L=void 0,N=void 0,D=void 0;return C={initialize:e,createKeySession:n,loadKeySession:i,removeKeySession:r,closeKeySession:a,setServerCertificate:o,setMediaElement:l,setSessionType:h,setRobustnessLevel:d,setProtectionData:g,reset:m},function(){R=T.getKeySystems(),O=[],P=!1,L="temporary",N="",u.default.extend(p.default.events)}(),C}Object.defineProperty(n,"__esModule",{value:!0});var a=t(105),s=i(a),o=t(13),u=i(o),l=t(126),c=i(l),h=t(125),f=i(h),d=t(10),g=i(d),m=t(106),p=i(m);r.__dashjs_factory_name="ProtectionController",n.default=g.default.getClassFactory(r),e.exports=n.default},{10:10,105:105,106:106,125:125,126:126,13:13}],109:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){t&&t.log&&(b=t.log)}function e(){v=[];var t;t=(0,f.default)(m).getInstance(),v.push(t),t=(0,c.default)(m).getInstance(),v.push(t),t=(0,u.default)(m).getInstance(),v.push(t),E=t}function n(){return v}function i(t){for(var e=0;e<v.length;e++)if(v[e].systemString===t)return v[e];return null}function r(t){return t===E}function a(t,e){if(t.byteLength===e.byteLength){for(var n=new Uint8Array(t),i=new Uint8Array(e),r=0;r<n.length;r++)if(n[r]!==i[r])return!1;return!0}return!1}function o(t){var e,n,i,r,a=[];if(t)for(i=0;i<v.length;++i)for(n=v[i],r=0;r<t.length;++r)if(e=t[r],e.schemeIdUri.toLowerCase()===n.schemeIdURI){var s=n.getInitData(e);s&&a.push({ks:v[i],initData:s})}return a}function l(t,e){var n,i=[],r=s.default.parsePSSHList(t);for(n=0;n<v.length;++n){var a=v[n].systemString,o=!e||a in e;v[n].uuid in r&&o&&i.push({ks:v[n],initData:r[v[n].uuid]})}return i}function h(t,e,n){if("license-release"===n||"individualization-request"===n)return null;var i=null;return e&&e.hasOwnProperty("drmtoday")?i=(0,g.default)(m).getInstance():"com.widevine.alpha"===t.systemString?i=(0,_.default)(m).getInstance():"com.microsoft.playready"===t.systemString?i=(0,p.default)(m).getInstance():"org.w3.clearkey"===t.systemString&&(i=(0,y.default)(m).getInstance()),i}function d(t,e){try{return E.getClearKeysFromProtectionData(t,e)}catch(t){return b("Failed to retrieve clearkeys from ProtectionData"),null}}var m=this.context,b=void 0,v=void 0,E=void 0;return{initialize:e,isClearKey:r,initDataEquals:a,getKeySystems:n,getKeySystemBySystemString:i,getSupportedKeySystemsFromContentProtection:o,getSupportedKeySystems:l,getLicenseServer:h,processClearKeyLicenseRequest:d,setConfig:t}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(105),s=i(a),o=t(110),u=i(o),l=t(112),c=i(l),h=t(111),f=i(h),d=t(117),g=i(d),m=t(118),p=i(m),b=t(119),_=i(b),v=t(116),y=i(v),E=t(10),T=i(E);r.__dashjs_factory_name="ProtectionKeyController",n.default=T.default.getSingletonFactory(r),e.exports=n.default},{10:10,105:105,110:110,111:111,112:112,116:116,117:117,118:118,119:119}],110:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,e){var n=null;if(t){for(var i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e))),r=[],a=0;a<i.kids.length;a++){var o=i.kids[a],l=t.clearkeys.hasOwnProperty(o)?t.clearkeys[o]:null;if(!l)throw new Error("DRM: ClearKey keyID ("+o+") is not known!");r.push(new s.default(o,l))}n=new u.default(r)}return n}function e(t){return c.default.parseInitDataFromContentProtection(t)}function n(){return null}function i(t){return new Uint8Array(t)}function r(){return null}return{uuid:d,schemeIdURI:m,systemString:g,getInitData:e,getRequestHeadersFromMessage:n,getLicenseRequestFromMessage:i,getLicenseServerURLFromInitData:r,getClearKeysFromProtectionData:t}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(123),s=i(a),o=t(120),u=i(o),l=t(105),c=i(l),h=t(10),f=i(h),d="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",g="org.w3.clearkey",m="urn:uuid:"+d;r.__dashjs_factory_name="KeySystemClearKey",n.default=f.default.getSingletonFactory(r),e.exports=n.default},{10:10,105:105,120:120,123:123}],111:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){var e,n,i={},r=new DOMParser,s="utf16"===a?new Uint16Array(t):new Uint8Array(t);e=String.fromCharCode.apply(null,s),n=r.parseFromString(e,"application/xml");for(var o=n.getElementsByTagName("name"),u=n.getElementsByTagName("value"),l=0;l<o.length;l++)i[o[l].childNodes[0].nodeValue]=u[l].childNodes[0].nodeValue;return i.hasOwnProperty("Content")&&(i["Content-Type"]=i.Content,delete i.Content),i}function e(t){var e,n,i=null,r=new DOMParser,s="utf16"===a?new Uint16Array(t):new Uint8Array(t);if(e=String.fromCharCode.apply(null,s),n=r.parseFromString(e,"application/xml"),n.getElementsByTagName("Challenge")[0]){var o=n.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;o&&(i=f.default.decode(o))}return i}function n(t){if(t)for(var e=new DataView(t),n=e.getUint16(4,!0),i=6,r=new DOMParser,a=0;a<n;a++){var s=e.getUint16(i,!0);i+=2;var o=e.getUint16(i,!0);if(i+=2,1===s){var u=t.slice(i,i+o),l=String.fromCharCode.apply(null,new Uint16Array(u)),c=r.parseFromString(l,"application/xml");if(c.getElementsByTagName("LA_URL")[0]){var h=c.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(h)return h}if(c.getElementsByTagName("LUI_URL")[0]){var f=c.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(f)return f}}else i+=o}return null}function i(t){var e,n,i,r,a,o=new Uint8Array([112,115,115,104,0,0,0,0]),u=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),l=0,c=null;if("pssh"in t)return s.default.parseInitDataFromContentProtection(t);if("pro"in t)c=f.default.decodeArray(t.pro.__text);else{if(!("prheader"in t))return null;c=f.default.decodeArray(t.prheader.__text)}return e=c.length,n=4+o.length+u.length+4+e,i=new ArrayBuffer(n),r=new Uint8Array(i),a=new DataView(i),a.setUint32(l,n),l+=4,r.set(o,l),l+=o.length,r.set(u,l),l+=u.length,a.setUint32(l,e),l+=4,r.set(c,l),l+=e,r.buffer}function r(t){if("utf8"!==t&&"utf16"!==t)throw new u.default("Illegal PlayReady message format! -- "+t);a=t}var a="utf16";return{uuid:d,schemeIdURI:m,systemString:g,getInitData:i,getRequestHeadersFromMessage:t,getLicenseRequestFromMessage:e,getLicenseServerURLFromInitData:n,setPlayReadyMessageFormat:r}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(105),s=i(a),o=t(162),u=i(o),l=t(10),c=i(l),h=t(1),f=i(h),d="9a04f079-9840-4286-ab92-e65be0885f95",g="com.microsoft.playready",m="urn:uuid:"+d;r.__dashjs_factory_name="KeySystemPlayReady",n.default=c.default.getSingletonFactory(r),e.exports=n.default},{1:1,10:10,105:105,162:162}],112:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){return s.default.parseInitDataFromContentProtection(t)}function e(){return null}function n(t){return new Uint8Array(t)}function i(){return null}return{uuid:l,schemeIdURI:h,systemString:c,getInitData:t,getRequestHeadersFromMessage:e,getLicenseRequestFromMessage:n,getLicenseServerURLFromInitData:i}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(105),s=i(a),o=t(10),u=i(o),l="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",c="com.widevine.alpha",h="urn:uuid:"+l;r.__dashjs_factory_name="KeySystemWidevine",n.default=u.default.getSingletonFactory(r),e.exports=n.default},{10:10,105:105}],113:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(){O&&x();for(var t=0;t<L.length;t++)d(L[t]);w.trigger(_.default.TEARDOWN_COMPLETE)}function n(){return A}function i(){for(var t=[],e=0;e<P.length;e++)t.push(P[e].initData);for(var e=0;e<L.length;e++)t.push(L[e].initData);return t}function r(t){var e=O;e||(e=document.createElement("video"));for(var n=!1,i=0;i<t.length;i++)for(var r=t[i].ks.systemString,a=t[i].configs,s=null,o=null,u=0;u<a.length;u++){var l=a[u].videoCapabilities;if(l&&0!==l.length){o=[];for(var c=0;c<l.length;c++)""!==e.canPlayType(l[c].contentType,r)&&o.push(l[c])}if(o&&(!o||0!==o.length)){n=!0;var h=new g.default(s,o),f=j.getKeySystemBySystemString(r);w.trigger(_.default.KEY_SYSTEM_ACCESS_COMPLETE,{data:new p.default(f,h)});break}}n||w.trigger(_.default.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})}function a(t){A=t.keySystem,w.trigger(_.default.INTERNAL_KEY_SYSTEM_SELECTED)}function o(t){O!==t&&(O&&x(),(O=t)&&(O.addEventListener(C.keyerror,D),O.addEventListener(C.needkey,D),O.addEventListener(C.keymessage,D),O.addEventListener(C.keyadded,D),w.trigger(_.default.VIDEO_ELEMENT_SELECTED)))}function l(t){if(!A)throw new Error("Can not create sessions until you have selected a key system");if(N||0===L.length){var e={sessionID:null,initData:t,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return P.push(e),O[C.generateKeyRequest](A.systemString,new Uint8Array(t)),e}throw new Error("Multiple sessions not allowed!")}function h(t,e){var n=t.sessionID;if(j.isClearKey(A))for(var i=0;i<e.keyPairs.length;i++)O[C.addKey](A.systemString,e.keyPairs[i].key,e.keyPairs[i].keyID,n);else O[C.addKey](A.systemString,new Uint8Array(e),t.initData,n)}function d(t){O[C.cancelKeyRequest](A.systemString,t.sessionID)}function m(){}function b(){}function v(){}function E(){return{handleEvent:function(t){var e=null;switch(t.type){case C.needkey:var n=ArrayBuffer.isView(t.initData)?t.initData.buffer:t.initData;w.trigger(_.default.NEED_KEY,{key:new u.default(n,"cenc")});break;case C.keyerror:if(e=T(L,t.sessionId),e||(e=T(P,t.sessionId)),e){var i="";switch(t.errorCode.code){case 1:i+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:i+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:i+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:i+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:i+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:i+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}i+="  System Code = "+t.systemCode,w.trigger(_.default.KEY_ERROR,{data:new c.default(e,i)})}else M("No session token found for key error");break;case C.keyadded:e=T(L,t.sessionId),e||(e=T(P,t.sessionId)),e?(M("DRM: Key added."),w.trigger(_.default.KEY_ADDED,{data:e})):M("No session token found for key added");break;case C.keymessage:if(N=null!==t.sessionId&&void 0!==t.sessionId,N?!(e=T(L,t.sessionId))&&P.length>0&&(e=P.shift(),L.push(e),e.sessionID=t.sessionId):P.length>0&&(e=P.shift(),L.push(e),0!==P.length&&I.mediaKeyMessageError("Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!")),e){var r=ArrayBuffer.isView(t.message)?t.message.buffer:t.message;e.keyMessage=r,w.trigger(_.default.INTERNAL_KEY_MESSAGE,{data:new f.default(e,r,t.defaultURL)})}else M("No session token found for key message")}}}}function T(t,e){if(e&&t){for(var n=t.length,i=0;i<n;i++)if(t[i].sessionID==e)return t[i];return null}return null}function x(){O.removeEventListener(C.keyerror,D),O.removeEventListener(C.needkey,D),O.removeEventListener(C.keymessage,D),O.removeEventListener(C.keyadded,D)}var S=this.context,w=t.eventBus,M=t.log,C=t.api,R=void 0,O=void 0,A=void 0,j=void 0,I=void 0,P=void 0,L=void 0,N=void 0,D=void 0;return R={getAllInitData:i,requestKeySystemAccess:r,getKeySystem:n,selectKeySystem:a,setMediaElement:o,createKeySession:l,updateKeySession:h,closeKeySession:d,setServerCertificate:m,loadKeySession:b,removeKeySession:v,reset:e},function(){O=null,A=null,P=[],L=[],j=(0,s.default)(S).getInstance(),I=(0,y.default)(S).getInstance(),D=E()}(),R}Object.defineProperty(n,"__esModule",{value:!0});var a=t(109),s=i(a),o=t(127),u=i(o),l=t(121),c=i(l),h=t(122),f=i(h),d=t(125),g=i(d),m=t(124),p=i(m),b=t(13),_=i(b),v=t(151),y=i(v),E=t(10),T=i(E);r.__dashjs_factory_name="ProtectionModel_01b",n.default=T.default.getClassFactory(r),e.exports=n.default},{10:10,109:109,121:121,122:122,124:124,125:125,127:127,13:13,151:151}],114:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(){var t,e=R.length;if(0!==e)for(var n=function(t){T(t),0===R.length&&(M?(M.removeEventListener("encrypted",O),M.setMediaKeys(null).then(function(){I.trigger(p.default.TEARDOWN_COMPLETE)})):I.trigger(p.default.TEARDOWN_COMPLETE))},i=0;i<e;i++)t=R[i],function(e){t.session.closed.then(function(){n(e)}),y(t).catch(function(){n(e)})}(t);else I.trigger(p.default.TEARDOWN_COMPLETE)}function n(){return w}function i(){for(var t=[],e=0;e<R.length;e++)t.push(R[e].initData);return t}function r(t){v(t,0)}function a(t){t.mksa.createMediaKeys().then(function(e){w=t.keySystem,C=e,M&&M.setMediaKeys(C),I.trigger(p.default.INTERNAL_KEY_SYSTEM_SELECTED)}).catch(function(){I.trigger(p.default.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+t.keySystem.systemString+")! Could not create MediaKeys -- TODO"})})}function o(t){M!==t&&(M&&(M.removeEventListener("encrypted",O),M.setMediaKeys(null)),(M=t)&&(M.addEventListener("encrypted",O),C&&M.setMediaKeys(C)))}function l(t){if(!w||!C)throw new Error("Can not set server certificate until you have selected a key system");C.setServerCertificate(t).then(function(){P("DRM: License server certificate successfully updated."),I.trigger(p.default.SERVER_CERTIFICATE_UPDATED)}).catch(function(t){I.trigger(p.default.SERVER_CERTIFICATE_UPDATED,{error:"Error updating server certificate -- "+t.name})})}function h(t,e){if(!w||!C)throw new Error("Can not create sessions until you have selected a key system");var n=C.createSession(e),i=x(n,t,e);n.generateRequest("cenc",t).then(function(){P("DRM: Session created.  SessionID = "+i.getSessionID()),I.trigger(p.default.KEY_SESSION_CREATED,{data:i})}).catch(function(t){T(i),I.trigger(p.default.KEY_SESSION_CREATED,{data:null,error:"Error generating key request -- "+t.name})})}function d(t,e){var n=t.session;A.isClearKey(w)&&(e=e.toJWK()),n.update(e).catch(function(e){I.trigger(p.default.KEY_ERROR,{data:new c.default(t,"Error sending update() message! "+e.name)})})}function m(t){if(!w||!C)throw new Error("Can not load sessions until you have selected a key system");var e=C.createSession();e.load(t).then(function(n){if(n){var i=x(e);P("DRM: Session created.  SessionID = "+i.getSessionID()),I.trigger(p.default.KEY_SESSION_CREATED,{data:i})}else I.trigger(p.default.KEY_SESSION_CREATED,{data:null,error:"Could not load session! Invalid Session ID ("+t+")"})}).catch(function(e){I.trigger(p.default.KEY_SESSION_CREATED,{data:null,error:"Could not load session ("+t+")! "+e.name})})}function b(t){t.session.remove().then(function(){P("DRM: Session removed.  SessionID = "+t.getSessionID()),I.trigger(p.default.KEY_SESSION_REMOVED,{data:t.getSessionID()})},function(e){I.trigger(p.default.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+t.getSessionID()+"). "+e.name})})}function _(t){y(t).catch(function(e){T(t),I.trigger(p.default.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+t.getSessionID()+") "+e.name})})}function v(t,e){!function(e){var n=t[e].ks,i=t[e].configs;navigator.requestMediaKeySystemAccess(n.systemString,i).then(function(t){var e="function"==typeof t.getConfiguration?t.getConfiguration():null,i=new g.default(n,e);i.mksa=t,I.trigger(p.default.KEY_SYSTEM_ACCESS_COMPLETE,{data:i})}).catch(function(){++e<t.length?v(t,e):I.trigger(p.default.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied!"})})}(e)}function y(t){var e=t.session;return e.removeEventListener("keystatuseschange",t),e.removeEventListener("message",t),e.close()}function E(){return{handleEvent:function(t){switch(t.type){case"encrypted":if(t.initData){var e=ArrayBuffer.isView(t.initData)?t.initData.buffer:t.initData;I.trigger(p.default.NEED_KEY,{key:new u.default(e,t.initDataType)})}}}}}function T(t){for(var e=0;e<R.length;e++)if(R[e]===t){R.splice(e,1);break}}function x(t,e,n){var i={session:t,initData:e,handleEvent:function(t){switch(t.type){case"keystatuseschange":I.trigger(p.default.KEY_STATUSES_CHANGED,{data:this});break;case"message":var e=ArrayBuffer.isView(t.message)?t.message.buffer:t.message;I.trigger(p.default.INTERNAL_KEY_MESSAGE,{data:new f.default(this,e,void 0,t.messageType)})}},getSessionID:function(){return t.sessionId},getExpirationTime:function(){return t.expiration},getKeyStatuses:function(){return t.keyStatuses},getSessionType:function(){return n}};return t.addEventListener("keystatuseschange",i),t.addEventListener("message",i),t.closed.then(function(){T(i),P("DRM: Session closed.  SessionID = "+i.getSessionID()),I.trigger(p.default.KEY_SESSION_CLOSED,{data:i.getSessionID()})}),R.push(i),i}var S,w,M,C,R,O,A,j=this.context,I=t.eventBus,P=t.log;return S={getAllInitData:i,requestKeySystemAccess:r,getKeySystem:n,selectKeySystem:a,setMediaElement:o,setServerCertificate:l,createKeySession:h,updateKeySession:d,loadKeySession:m,removeKeySession:b,closeKeySession:_,reset:e},function(){w=null,M=null,C=null,R=[],A=(0,s.default)(j).getInstance(),O=E()}(),S}Object.defineProperty(n,"__esModule",{value:!0});var a=t(109),s=i(a),o=t(127),u=i(o),l=t(121),c=i(l),h=t(122),f=i(h),d=t(124),g=i(d),m=t(13),p=i(m),b=t(10),_=i(b);r.__dashjs_factory_name="ProtectionModel_21Jan2015",n.default=_.default.getClassFactory(r),e.exports=n.default},{10:10,109:109,121:121,122:122,124:124,127:127,13:13}],115:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(){try{for(var t=0;t<I.length;t++)d(I[t]);R&&R.removeEventListener(M.needkey,P),S.trigger(_.default.TEARDOWN_COMPLETE)}catch(t){S.trigger(_.default.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+t.message})}}function n(){return O}function i(){for(var t=[],e=0;e<I.length;e++)t.push(I[e].initData);return t}function r(t){for(var e=!1,n=0;n<t.length;n++)for(var i=t[n].ks.systemString,r=t[n].configs,a=null,s=null,o=0;o<r.length;o++){var u=r[o].audioCapabilities,l=r[o].videoCapabilities;if(u&&0!==u.length){a=[];for(var c=0;c<u.length;c++)window[M.MediaKeys].isTypeSupported(i,u[c].contentType)&&a.push(u[c])}if(l&&0!==l.length){s=[];for(var h=0;h<l.length;h++)window[M.MediaKeys].isTypeSupported(i,l[h].contentType)&&s.push(l[h])}if(!(!a&&!s||a&&0===a.length||s&&0===s.length)){e=!0;var f=new g.default(a,s),d=L.getKeySystemBySystemString(i);S.trigger(_.default.KEY_SYSTEM_ACCESS_COMPLETE,{data:new p.default(d,f)});break}}e||S.trigger(_.default.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})}function a(t){try{A=t.mediaKeys=new window[M.MediaKeys](t.keySystem.systemString),O=t.keySystem,j=t,R&&E(),S.trigger(_.default.INTERNAL_KEY_SYSTEM_SELECTED)}catch(t){S.trigger(_.default.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+O.systemString+")! Could not create MediaKeys -- TODO"})}}function o(t){R!==t&&(R&&R.removeEventListener(M.needkey,P),(R=t)&&(R.addEventListener(M.needkey,P),A&&E()))}function l(t){if(!O||!A||!j)throw new Error("Can not create sessions until you have selected a key system");var e=null;if(null!==j.ksConfiguration.videoCapabilities&&j.ksConfiguration.videoCapabilities.length>0&&(e=j.ksConfiguration.videoCapabilities[0]),null===e&&null!==j.ksConfiguration.audioCapabilities&&j.ksConfiguration.audioCapabilities.length>0&&(e=j.ksConfiguration.audioCapabilities[0]),null===e)throw new Error("Can not create sessions for unknown content types.");var n=e.contentType,i=A.createSession(n,new Uint8Array(t)),r=T(i,t);i.addEventListener(M.error,r),i.addEventListener(M.message,r),i.addEventListener(M.ready,r),i.addEventListener(M.close,r),I.push(r),w("DRM: Session created.  SessionID = "+r.getSessionID()),S.trigger(_.default.KEY_SESSION_CREATED,{data:r})}function h(t,e){var n=t.session;L.isClearKey(O)?n.update(new Uint8Array(e.toJWK())):n.update(new Uint8Array(e))}function d(t){var e=t.session;e.removeEventListener(M.error,t),e.removeEventListener(M.message,t),e.removeEventListener(M.ready,t),e.removeEventListener(M.close,t);for(var n=0;n<I.length;n++)if(I[n]===t){I.splice(n,1);break}e[M.release]()}function m(){}function b(){}function v(){}function y(){return{handleEvent:function(t){switch(t.type){case M.needkey:if(t.initData){var e=ArrayBuffer.isView(t.initData)?t.initData.buffer:t.initData;S.trigger(_.default.NEED_KEY,{key:new u.default(e,"cenc")})}}}}}function E(){var t=null,e=function(){R.removeEventListener("loadedmetadata",t),R[M.setMediaKeys](A),S.trigger(_.default.VIDEO_ELEMENT_SELECTED)};R.readyState>=1?e():(t=e.bind(this),R.addEventListener("loadedmetadata",t))}function T(t,e){return{session:t,initData:e,getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(t){switch(t.type){case M.error:;S.trigger(_.default.KEY_ERROR,{data:new c.default(this,"KeyError")});break;case M.message:var e=ArrayBuffer.isView(t.message)?t.message.buffer:t.message;S.trigger(_.default.INTERNAL_KEY_MESSAGE,{data:new f.default(this,e,t.destinationURL)});break;case M.ready:w("DRM: Key added."),S.trigger(_.default.KEY_ADDED);break;case M.close:w("DRM: Session closed.  SessionID = "+this.getSessionID()),S.trigger(_.default.KEY_SESSION_CLOSED,{data:this.getSessionID()})}}}}var x=this.context,S=t.eventBus,w=t.log,M=t.api,C=void 0,R=void 0,O=void 0,A=void 0,j=void 0,I=void 0,P=void 0,L=void 0;return C={getAllInitData:i,requestKeySystemAccess:r,getKeySystem:n,selectKeySystem:a,setMediaElement:o,createKeySession:l,updateKeySession:h,closeKeySession:d,setServerCertificate:m,loadKeySession:b,removeKeySession:v,reset:e},function(){R=null,O=null,A=null,j=null,I=[],L=(0,s.default)(x).getInstance(),P=y()}(),C}Object.defineProperty(n,"__esModule",{value:!0});var a=t(109),s=i(a),o=t(127),u=i(o),l=t(121),c=i(l),h=t(122),f=i(h),d=t(125),g=i(d),m=t(124),p=i(m),b=t(13),_=i(b),v=t(10),y=i(v);r.__dashjs_factory_name="ProtectionModel_3Feb2014",n.default=y.default.getClassFactory(r),e.exports=n.default},{10:10,109:109,121:121,122:122,124:124,125:125,127:127,13:13}],116:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,e){var n=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e)));t+="/?";for(var i=0;i<n.kids.length;i++)t+=n.kids[i]+"&";return t=t.substring(0,t.length-1)}function e(){return"GET"}function n(){return"json"}function i(t){if(!t.hasOwnProperty("keys"))return null;for(var e=[],n=0;n<t.keys.length;n++){var i=t.keys[n],r=i.kid.replace(/=/g,""),a=i.k.replace(/=/g,"");e.push(new s.default(r,a))}return new u.default(e)}function r(t){return String.fromCharCode.apply(null,new Uint8Array(t))}return{getServerURLFromMessage:t,getHTTPMethod:e,getResponseType:n,getLicenseMessage:i,getErrorResponse:r}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(123),s=i(a),o=t(120),u=i(o),l=t(10),c=i(l);r.__dashjs_factory_name="ClearKey",n.default=c.default.getSingletonFactory(r),e.exports=n.default},{10:10,120:120,123:123}],117:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){return t}function e(){return"POST"}function n(t){return a[t].responseType}function i(t,e){return a[e].getLicenseMessage(t)}function r(t,e){return a[e].getErrorResponse(t)}var a={"com.widevine.alpha":{responseType:"json",getLicenseMessage:function(t){return u.default.decodeArray(t.license)},getErrorResponse:function(t){return t}},"com.microsoft.playready":{responseType:"arraybuffer",getLicenseMessage:function(t){return t},getErrorResponse:function(t){return String.fromCharCode.apply(null,new Uint8Array(t))}}};return{getServerURLFromMessage:t,getHTTPMethod:e,getResponseType:n,getLicenseMessage:i,getErrorResponse:r}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(1),u=i(o);r.__dashjs_factory_name="DRMToday",n.default=s.default.getSingletonFactory(r),e.exports=n.default},{1:1,10:10}],118:[function(t,e,n){function i(){function t(t){return t}function e(){return"POST"}function n(){return"arraybuffer"}function i(t){return t}function r(t){return String.fromCharCode.apply(null,new Uint8Array(t))}return{getServerURLFromMessage:t,getHTTPMethod:e,getResponseType:n,getLicenseMessage:i,getErrorResponse:r}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="PlayReady",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],119:[function(t,e,n){function i(){function t(t){return t}function e(){return"POST"}function n(){return"arraybuffer"}function i(t){return t}function r(t){return String.fromCharCode.apply(null,new Uint8Array(t))}return{getServerURLFromMessage:t,getHTTPMethod:e,getResponseType:n,getLicenseMessage:i,getErrorResponse:r}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="Widevine",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],120:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e,n){if(i(this,t),n&&"persistent"!==n&&"temporary"!==n)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=e,this.type=n}return r(t,[{key:"toJWK",value:function(){var t,e=this.keyPairs.length,n={keys:[]};for(t=0;t<e;t++){var i={kty:"oct",alg:"A128KW",kid:this.keyPairs[t].keyID,k:this.keyPairs[t].key};n.keys.push(i)}this.type&&(n.type=this.type);var r=JSON.stringify(n),a=r.length,s=new ArrayBuffer(a),o=new Uint8Array(s);for(t=0;t<a;t++)o[t]=r.charCodeAt(t);return s}}]),t}();n.default=a,e.exports=n.default},{}],121:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(e,n){i(this,t),this.sessionToken=e,this.error=n};n.default=r,e.exports=n.default},{}],122:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(e,n,r,a){i(this,t),this.sessionToken=e,this.message=n,this.defaultURL=r,this.messageType=a||"license-request"};n.default=r,e.exports=n.default},{}],123:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(e,n){i(this,t),this.keyID=e,this.key=n};n.default=r,e.exports=n.default},{}],124:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(e,n){i(this,t),this.keySystem=e,this.ksConfiguration=n};n.default=r,e.exports=n.default},{}],125:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(e,n,r,a,s){i(this,t),this.initDataTypes=["cenc"],this.audioCapabilities=e,this.videoCapabilities=n,this.distinctiveIdentifier=r,this.persistentState=a,this.sessionTypes=s};n.default=r,e.exports=n.default},{}],126:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(e,n){i(this,t),this.contentType=e,this.robustness=n};n.default=r,e.exports=n.default},{}],127:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(e,n){i(this,t),this.initData=e,this.initDataType=n};n.default=r,e.exports=n.default},{}],128:[function(t,e,n){function i(t){function e(){return o.mediaInfo.streamInfo}function n(){return o.mediaInfo}function i(){return o}function r(){return l}function a(){return o.mediaInfo.streamInfo.manifestInfo}function s(){return u}var o=t.streamProcessor.getCurrentRepresentationInfo(),u=t.streamProcessor,l=t.currentValue;return{getStreamInfo:e,getMediaInfo:n,getTrackInfo:i,getCurrentValue:r,getManifestInfo:a,getStreamProcessor:s}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="RulesContext",n.default=a.default.getClassFactory(i),e.exports=n.default},{10:10}],129:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){o={}}function e(t){t&&(t.abrRulesCollection&&(o[m]=t.abrRulesCollection),t.synchronizationRulesCollection&&(o[p]=t.synchronizationRulesCollection))}function n(t,e,n,i,a){var s,o,l={},c={},h=t.length,f=h,d=r(e,i),g=function(t){var e,r,s;if(t.value!==u.default.NO_CHANGE){var o=a(l[t.priority],t.value);o!==l[t.priority]&&(l[t.priority]=o,c[t.priority]=t.reason)}--h||(l[u.default.WEAK]!==u.default.NO_CHANGE&&(s=u.default.WEAK,e=l[u.default.WEAK],r=c[u.default.WEAK]),l[u.default.DEFAULT]!==u.default.NO_CHANGE&&(s=u.default.DEFAULT,e=l[u.default.DEFAULT],r=c[u.default.DEFAULT]),l[u.default.STRONG]!==u.default.NO_CHANGE&&(s=u.default.STRONG,e=l[u.default.STRONG],r=c[u.default.STRONG]),s!=u.default.STRONG&&s!=u.default.WEAK&&(s=u.default.DEFAULT),n(void 0!==e?{value:e,confidence:s,reason:r}:{value:i,confidence:s,reason:{name:"NO_CHANGE"}}))};for(l[u.default.STRONG]=u.default.NO_CHANGE,l[u.default.WEAK]=u.default.NO_CHANGE,l[u.default.DEFAULT]=u.default.NO_CHANGE,o=0;o<f;o++)s=t[o],s.execute(d,g)}function i(){var t,e,n=o[m],i=o[p],r=(n.getRules(c.default.QUALITY_SWITCH_RULES)||[]).concat(n.getRules(c.default.ABANDON_FRAGMENT_RULES)||[]).concat(i.getRules(f.default.TIME_SYNCHRONIZED_RULES)||[]).concat(i.getRules(f.default.BEST_GUESS_RULES)||[]),a=r.length;for(e=0;e<a;e++)t=r[e],"function"==typeof t.reset&&t.reset();o={}}function r(t,e){return(0,s.default)(a).create({streamProcessor:t,currentValue:e})}var a=this.context,o=void 0;return{initialize:t,setConfig:e,applyRules:n,reset:i}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(128),s=i(a),o=t(130),u=i(o),l=t(131),c=i(l),h=t(144),f=i(h),d=t(10),g=i(d),m=0,p=1;r.__dashjs_factory_name="RulesController";var b=g.default.getSingletonFactory(r);b.ABR_RULE=m,b.SYNC_RULE=p,n.default=b,e.exports=n.default},{10:10,128:128,130:130,131:131,144:144}],130:[function(t,e,n){function i(t,e,n){return{value:void 0===t?s:t,priority:void 0===e?o:e,reason:void 0===n?null:n}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r),s=999,o=.5;i.__dashjs_factory_name="SwitchRequest";var u=a.default.getClassFactory(i);u.NO_CHANGE=s,u.DEFAULT=o,u.STRONG=1,u.WEAK=0,n.default=u,e.exports=n.default},{10:10}],131:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){i=[],r=[];var t=(0,y.default)(n).getInstance(),e=(0,T.default)(n).getInstance();(0,
_.default)(n).getInstance().getBufferOccupancyABREnabled()?(i.push((0,g.default)(n).create({metricsModel:t,dashMetrics:(0,T.default)(n).getInstance()})),r.push((0,p.default)(n).create({metricsModel:t,dashMetrics:(0,T.default)(n).getInstance()}))):(i.push((0,s.default)(n).create({metricsModel:t,dashMetrics:e})),i.push((0,u.default)(n).create({metricsModel:t,dashMetrics:e})),i.push((0,c.default)(n).create({metricsModel:t})),r.push((0,f.default)(n).create()))}function e(t){switch(t){case w:return i;case M:return r;default:return null}}var n=this.context,i=void 0,r=void 0;return{initialize:t,getRules:e}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(137),s=i(a),o=t(135),u=i(o),l=t(136),c=i(l),h=t(132),f=i(h),d=t(134),g=i(d),m=t(133),p=i(m),b=t(101),_=i(b),v=t(102),y=i(v),E=t(17),T=i(E),x=t(10),S=i(x),w="qualitySwitchRules",M="abandonFragmentRules";r.__dashjs_factory_name="ABRRulesCollection";var C=S.default.getSingletonFactory(r);C.QUALITY_SWITCH_RULES=w,C.ABANDON_FRAGMENT_RULES=M,n.default=C,e.exports=n.default},{10:10,101:101,102:102,132:132,133:133,134:134,135:135,136:136,137:137,17:17}],132:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){g={},m={},p=[],b=(0,u.default)(h).getInstance()}function e(t,e){g[t]=g[t]||{},g[t][e]=g[t][e]||{}}function n(t,e){p[t]=p[t]||[],p[t].push(e)}function i(t,i){var a=t.getMediaInfo(),u=a.type,f=t.getCurrentValue().request,_=(0,s.default)(h).create(s.default.NO_CHANGE,s.default.WEAK,{name:r.__dashjs_factory_name});if(!isNaN(f.index)){e(u,f.index);var v=g[u][f.index];if(null===v||null===f.firstByteDate||m.hasOwnProperty(v.id))return void i(_);if(void 0===v.firstByteTime&&(p[u]=[],v.firstByteTime=f.firstByteDate.getTime(),v.segmentDuration=f.duration,v.bytesTotal=f.bytesTotal,v.id=f.index),v.bytesLoaded=f.bytesLoaded,v.elapsedTime=(new Date).getTime()-v.firstByteTime,v.bytesLoaded>0&&v.elapsedTime>0&&n(u,Math.round(8*v.bytesLoaded/v.elapsedTime)),p[u].length>=c&&v.elapsedTime>l&&v.bytesLoaded<v.bytesTotal){var y=p[u].reduce(function(t,e){return t+e},0);if(v.measuredBandwidthInKbps=Math.round(y/p[u].length),v.estimatedTimeOfDownload=(8*v.bytesTotal/v.measuredBandwidthInKbps/1e3).toFixed(2),v.estimatedTimeOfDownload<v.segmentDuration*o||0===t.getTrackInfo().quality)return void i(_);if(!m.hasOwnProperty(v.id)){var E=t.getStreamProcessor().getABRController(),T=v.bytesTotal-v.bytesLoaded,x=E.getBitrateList(a),S=E.getQualityForBitrate(a,v.measuredBandwidthInKbps*b.getBandwidthSafetyFactor());T>v.bytesTotal*x[S].bitrate/x[E.getQualityFor(u,a.streamInfo)].bitrate&&(_.value=S,_.priority=s.default.STRONG,_.reason.throughput=v.measuredBandwidthInKbps,m[v.id]=v,d("AbandonRequestsRule ( ",u,"frag id",v.id,") is asking to abandon and switch to quality to ",S," measured bandwidth was",v.measuredBandwidthInKbps),delete g[u][v.id])}}else v.bytesLoaded===v.bytesTotal&&delete g[u][v.id]}i(_)}function a(){t()}var o=1.8,l=500,c=5,h=this.context,d=(0,f.default)(h).getInstance().log,g=void 0,m=void 0,p=void 0,b=void 0,_={execute:i,reset:a};return t(),_}Object.defineProperty(n,"__esModule",{value:!0});var a=t(130),s=i(a),o=t(101),u=i(o),l=t(10),c=i(l),h=t(8),f=i(h);r.__dashjs_factory_name="AbandonRequestsRule",n.default=c.default.getClassFactory(r),e.exports=n.default},{10:10,101:101,130:130,8:8}],133:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e,n){b[t]={index:e,quality:n}}function n(t,e,n){var i=b[t];return!i||e!==i.index||n<i.quality}function i(t,i){var a=t.getMediaInfo(),u=a.type,f=m.getReadOnlyMetricsFor(u),p=t.getCurrentValue(),_=p.request,v=(0,s.default)(c).create(s.default.NO_CHANGE,s.default.WEAK,{name:r.__dashjs_factory_name});if(0===f.BolaState.length)return h("WARNING: executing BolaAbandonRule before initializing BolaRule"),b[u]=null,void i(v);var y=f.BolaState[0]._s,E=_.index,T=_.quality;if(isNaN(E)||0===T||!n(u,E,T)||!_.firstByteDate)return void i(v);var x=Date.now(),S=x-_.firstByteDate.getTime(),w=_.bytesLoaded,M=_.bytesTotal,C=M-w,R=_.duration,O=d.getCurrentBufferLevel(f)?d.getCurrentBufferLevel(f):0,A=O+y.virtualBuffer,j=8*w/(.001*S),I=y.bandwidthSafetyFactor*j,P=.001*(_.firstByteDate.getTime()-_.requestStartDate.getTime());P<.001*l&&(P=.001*l);var L=P+8*M/I,N="";g.default.BOLA_DEBUG&&(N="index="+E+" quality="+T+" bytesLoaded/bytesTotal="+w+"/"+M+" bufferLevel="+O+" timeSince1stByte="+(S/1e3).toFixed(3)+" estThroughput="+(I/1e6).toFixed(3)+" latency="+P.toFixed(3));var D=M*y.bitrates[0]/y.bitrates[T],k=C-P*I/8;if(k<1&&(k=1),S<o||C<=D||O>y.bufferTarget||k<=D||L<=R)return void i(v);var F=A-P;F<0&&(F=0);for(var V=0;V+1<T&&M*y.bitrates[V+1]/y.bitrates[T]<k;)++V;var B=T;if(y.state===g.default.BOLA_STATE_STARTUP){B=0;for(var U=0;U<=V&&!(8*(D=M*y.bitrates[U]/y.bitrates[T])/R>I);++U)B=U}else for(var z=(y.Vp*(y.utilities[T]+y.gp)-F)/k,U=0;U<=V;++U){D=M*y.bitrates[U]/y.bitrates[T];var G=(y.Vp*(y.utilities[U]+y.gp)-F)/D;G>z&&(B=U,z=G)}var $=y.rebufferSafetyFactor*j*(O-P)/8;if(B===T&&k>$&&(B=V),B===T)return void i(v);for(;B>0&&!((D=M*y.bitrates[B]/y.bitrates[T])<=$);)--B;y.lastQuality=B,m.updateBolaState(u,y),g.default.BOLA_DEBUG&&h("BolaDebug "+u+" BolaAbandonRule abandon to "+B+" - "+N),e(u,E,T),v.value=B,v.priority=s.default.STRONG,v.reason.state=y.state,v.reason.throughput=j,v.reason.bufferLevel=O,v.reason.bytesLoaded=_.bytesLoaded,v.reason.bytesTotal=_.bytesTotal,v.reason.elapsedTimeMs=S,i(v)}function a(){b={}}var o=500,l=200,c=this.context,h=(0,f.default)(c).getInstance().log,d=t.dashMetrics,m=t.metricsModel,p=void 0,b=void 0,_=void 0;return p={execute:i,reset:a},function(){b={},_=(0,u.default)(c).getInstance()}(),p}Object.defineProperty(n,"__esModule",{value:!0});var a=t(130),s=i(a),o=t(101),u=i(o),l=t(10),c=i(l),h=t(8),f=i(h),d=t(134),g=i(d);r.__dashjs_factory_name="BolaAbandonRule",n.default=c.default.getClassFactory(r),e.exports=n.default},{10:10,101:101,130:130,134:134,8:8}],134:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(){V={},B=[],U=(0,c.default)(P).getInstance(),z=(0,f.default)(P).getInstance(),G=(0,m.default)(P).getInstance(),k.on(v.default.BUFFER_EMPTY,p,F),k.on(v.default.PLAYBACK_SEEKING,_,F),k.on(v.default.PERIOD_SWITCH_STARTED,y,F)}function n(t){return t.map(function(t){return Math.log(t)})}function i(t,e,i,r){var a=NaN;if(r?(a=0,r.forEach(function(t,e){t>r[a]&&(a=e)})):(r=n(i),a=r.length-1),0===a)return null;var s=1-r[0]+(r[a]-r[0])/(e/t-1),o=t/(r[0]+s-1);return{utilities:r,gp:s,Vp:o}}function a(t){var e={},n=t.getMediaInfo(),r=t.getStreamProcessor(),a=t.getStreamInfo(),s=t.getTrackInfo(),o=r.isDynamic(),u=a.manifestInfo.duration,l=s.fragmentDuration,c=n.bitrateList.map(function(t){return t.bandwidth}),h=i(M,C,c,null);if(null===h)return e.state=T,e;if(e.state=x,e.bitrates=c,e.utilities=h.utilities,e.Vp=h.Vp,e.gp=h.gp,e.isDynamic=o,e.movieDuration=u,e.fragmentDuration=l,e.bandwidthSafetyFactor=U.getBandwidthSafetyFactor(),e.rebufferSafetyFactor=R,e.bufferTarget=U.getStableBufferTime(),e.lastQuality=0,e.virtualBuffer=0,e.throughputCount=o?j:I,w){for(var f="",d=0;d<c.length;++d){var g=h.utilities[d],m=c[d],p=0;if(d>0){var b=h.utilities[d-1],_=c[d-1];p=h.Vp*((b*m-g*_)/(m-_)+h.gp)}var v=h.Vp*(g+h.gp);f+="\n"+d+":"+(1e-6*c[d]).toFixed(3)+"Mbps "+p.toFixed(3)+"/"+v.toFixed(3)}L("BolaDebug "+n.type+" bitrates"+f)}return e}function o(t,e){for(var n=t.bitrates.length,i=NaN,r=NaN,a=0;a<n;++a){var s=(t.Vp*(t.utilities[a]+t.gp)-e)/t.bitrates[a];(isNaN(r)||s>=r)&&(r=s,i=a)}return i}function u(t,e){for(var n=N.getHttpRequests(t),i=[],r=n.length-1;r>=0&&i.length<e;--r){var a=n[r];a.type===d.HTTPRequest.MEDIA_SEGMENT_TYPE&&a._tfinish&&a.tresponse&&a.trace&&i.push(a)}return i}function l(t,e,n){var i=u(t,e);if(0===i.length)return 0;for(var r=0,a="",s=0;s<i.length;++s){var o=.001*(i[s]._tfinish.getTime()-i[s].trequest.getTime()),l=8*i[s].trace.reduce(function(t,e){return t+e.b[0]},0);w&&(a+=" "+(1e-6*l).toFixed(3)+"/"+o.toFixed(3)+"="+(1e-6*l/o).toFixed(3)+"Mbps"),r+=o/l}return w&&L("BolaDebug "+n+" BolaRule recent throughput = "+(i.length/(1e6*r)).toFixed(3)+"Mbps:"+a),i.length/r}function h(t,e){var n=0;return t.bitrates.some(function(t,i){return t>e||(n=i,!1)}),n}function g(t,e){var n=u(t,1);if(0===n.length)return 0;var i=n[0],r=Date.now(),a=i._tfinish.getTime();a>r&&(a=r);var s=V[e];V[e]=r;var o=0;return o=s&&s>a?r-s:r-a,o<=0?0:.001*o}function p(){w&&L("BolaDebug BUFFER_EMPTY"),B.forEach(function(t){var e=D.getReadOnlyMetricsFor(t);if(0!==e.BolaState.length){var n=e.BolaState[0]._s;n.state===S&&(n.virtualBuffer=0,D.updateBolaState(t,n))}})}function _(t){w&&L("BolaDebug PLAYBACK_SEEKING "+t.seekTime.toFixed(3)),B.forEach(function(t){var e=D.getReadOnlyMetricsFor(t);if(0!==e.BolaState.length){var n=e.BolaState[0]._s;n.state!==T&&(n.state=x),D.updateBolaState(t,n)}})}function y(){}function O(t,e){var n=t.getStreamProcessor();n.getScheduleController().setTimeToLoadDelay(0);var i=(0,s.default)(P).create(s.default.NO_CHANGE,s.default.WEAK,{name:r.__dashjs_factory_name}),u=t.getMediaInfo(),c=u.type,f=D.getReadOnlyMetricsFor(c);if(0===f.BolaState.length){w&&L("BolaDebug "+c+"\nBolaDebug "+c+" BolaRule for state=- fragmentStart="+G.getIndexHandlerTime(t.getStreamProcessor()).toFixed(3));var d=a(t);D.updateBolaState(c,d);var m=0;if(d.state!==T){B.push(c);var p=l(f,d.throughputCount,c);if(0===p)return w&&L("BolaDebug "+c+" BolaRule quality unchanged for INITIALIZE"),void e(i);m=h(d,p*d.bandwidthSafetyFactor),d.lastQuality=m,i.value=m,i.priority=s.default.DEFAULT,i.reason.state=d.state,i.reason.throughput=p}return w&&L("BolaDebug "+c+" BolaRule quality "+m+" for INITIALIZE"),void e(i)}var b=f.BolaState[0]._s;if(b.state===T)return w&&L("BolaDebug "+c+" BolaRule quality 0 for ONE_BITRATE"),void e(i);var _=b.bitrates,v=b.utilities;w&&L("BolaDebug "+c+"\nBolaDebug "+c+" EXECUTE BolaRule for state="+b.state+" fragmentStart="+G.getIndexHandlerTime(t.getStreamProcessor()).toFixed(3));var y=N.getCurrentBufferLevel(f)?N.getCurrentBufferLevel(f):0,E=l(f,b.throughputCount,c);y<=.1&&(b.virtualBuffer=0);var M=g(f,c);M>0&&(b.virtualBuffer+=M),b.virtualBuffer<0&&(b.virtualBuffer=0);var C=y+b.virtualBuffer,O=o(b,C);if(w&&L("BolaDebug "+c+" BolaRule bufferLevel="+y.toFixed(3)+"(+"+b.virtualBuffer.toFixed(3)+"="+C.toFixed(3)+") recentThroughput="+(1e-6*E).toFixed(3)+" tentativeQuality="+O),b.state===x){var m=h(b,E*b.bandwidthSafetyFactor);if(y>b.fragmentDuration/R){b.state=S;for(var A=0,j=0;j<m;++j){var I=b.Vp*(b.gp+(_[m]*v[j]-_[j]*v[m])/(_[m]-_[j]));I>A&&(A=I)}A>y&&(b.virtualBuffer=A-y)}return w&&L("BolaDebug "+c+" BolaRule quality "+m+" for STARTUP"),b.lastQuality=m,D.updateBolaState(c,b),i.value=m,i.priority=s.default.DEFAULT,i.reason.state=x,i.reason.throughput=E,void e(i)}if(O>b.lastQuality){var m=h(b,E);O>m&&(m<b.lastQuality&&(m=b.lastQuality),O=m)}if(E>0)for(var k=R*E*y/b.fragmentDuration;O>0&&_[O]>k;)--O;var F=0;F=C-b.Vp*(v[O]+b.gp),F>0&&(F>b.virtualBuffer?(F-=b.virtualBuffer,b.virtualBuffer=0):(b.virtualBuffer-=F,F=0)),F>0?O===_.length-1?F=0:n.getScheduleController().setTimeToLoadDelay(1e3*F):F=0,b.lastQuality=O,D.updateBolaState(c,b),i.value=O,i.priority=s.default.DEFAULT,i.reason.state=b.state,i.reason.throughput=E,i.reason.bufferLevel=y,w&&L("BolaDebug "+c+" BolaRule quality "+O+" delay="+F.toFixed(3)+" for STEADY"),e(i)}function A(){k.off(v.default.BUFFER_EMPTY,p,F),k.off(v.default.PLAYBACK_SEEKING,_,F),k.off(v.default.PERIOD_SWITCH_STARTED,y,F),e()}var j=2,I=3,P=this.context,L=(0,E.default)(P).getInstance().log,N=t.dashMetrics,D=t.metricsModel,k=(0,b.default)(P).getInstance(),F=void 0,V=void 0,B=void 0,U=void 0,z=void 0,G=void 0;return F={execute:O,reset:A},e(),F}Object.defineProperty(n,"__esModule",{value:!0});var a=t(130),s=i(a),o=t(10),u=i(o),l=t(101),c=i(l),h=t(68),f=i(h),d=t(179),g=t(15),m=i(g),p=t(9),b=i(p),_=t(13),v=i(_),y=t(8),E=i(y),T=0,x=1,S=2,w=!1,M=10,C=30,R=.5;r.__dashjs_factory_name="BolaRule";var O=u.default.getClassFactory(r);O.BOLA_STATE_ONE_BITRATE=T,O.BOLA_STATE_STARTUP=x,O.BOLA_STATE_STEADY=S,O.BOLA_DEBUG=w,n.default=O,e.exports=n.default},{10:10,101:101,13:13,130:130,15:15,179:179,68:68,8:8,9:9}],135:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e){var n=(new Date).getTime()/1e3,i=t.getMediaInfo(),u=t.getTrackInfo(),g=i.type,m=isNaN(u.fragmentDuration)?2:u.fragmentDuration/2,p=t.getCurrentValue(),b=t.getStreamProcessor(),_=b.getABRController(),v=l.getReadOnlyMetricsFor(g),y=h.getCurrentBufferLevel(v),E=v.BufferState.length>0?v.BufferState[v.BufferState.length-1]:null,T=i.representationCount-1,x=(0,s.default)(a).create(s.default.NO_CHANGE,s.default.WEAK,{name:r.__dashjs_factory_name});return n-f<m||_.getAbandonmentStateFor(g)===c.default.ABANDON_LOAD?void e(x):(null!==E&&y>E.target&&y-E.target>d.getRichBufferThreshold()&&i.representationCount>1&&(x.value=T,x.priority=s.default.STRONG,x.reason.bufferLevel=y,x.reason.bufferTarget=E.target),x.value!==s.default.NO_CHANGE&&x.value!==p&&o("BufferOccupancyRule requesting switch to index: ",x.value,"type: ",g," Priority: ",x.priority===s.default.DEFAULT?"Default":x.priority===s.default.STRONG?"Strong":"Weak"),void e(x))}function n(){f=0}var i=void 0,a=this.context,o=(0,g.default)(a).getInstance().log,l=t.metricsModel,h=t.dashMetrics,f=void 0,d=void 0;return i={execute:e,reset:n},function(){f=0,d=(0,u.default)(a).getInstance()}(),i}Object.defineProperty(n,"__esModule",{value:!0});var a=t(130),s=i(a),o=t(101),u=i(o),l=t(60),c=i(l),h=t(10),f=i(h),d=t(8),g=i(d);r.__dashjs_factory_name="BufferOccupancyRule",n.default=f.default.getClassFactory(r),e.exports=n.default},{10:10,101:101,130:130,60:60,8:8}],136:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e){var i=(new Date).getTime(),a=t.getMediaInfo().type,c=t.getCurrentValue(),h=d.getReadOnlyMetricsFor(a),f=h.BufferState.length>0?h.BufferState[h.BufferState.length-1]:null,g=(0,s.default)(o).create(s.default.NO_CHANGE,s.default.WEAK,{name:r.__dashjs_factory_name});return i-b<_||null===f?void e(g):(n(a,f.state),f.state===u.default.BUFFER_EMPTY&&void 0!==m[a].firstBufferLoadedEvent&&(g.value=0,g.priority=s.default.STRONG,g.reason.bufferState=f.state,g=(0,s.default)(o).create(0,s.default.STRONG)),g.value!==s.default.NO_CHANGE&&g.value!==c&&l("InsufficientBufferRule requesting switch to index: ",g.value,"type: ",a," Priority: ",g.priority===s.default.DEFAULT?"Default":g.priority===s.default.STRONG?"Strong":"Weak"),b=i,void e(g))}function n(t,e){m[t]=m[t]||{},m[t].state=e,e!==u.default.BUFFER_LOADED||m[t].firstBufferLoadedEvent||(m[t].firstBufferLoadedEvent=!0)}function i(){m={}}function a(){h.off(f.default.PLAYBACK_SEEKING,i,g),m={},b=0}var o=this.context,l=(0,p.default)(o).getInstance().log,h=(0,c.default)(o).getInstance(),d=t.metricsModel,g=void 0,m=void 0,b=void 0,_=void 0;return g={execute:e,reset:a},function(){m={},b=0,_=1e3,h.on(f.default.PLAYBACK_SEEKING,i,g)}(),g}Object.defineProperty(n,"__esModule",{value:!0});var a=t(130),s=i(a),o=t(63),u=i(o),l=t(9),c=i(l),h=t(13),f=i(h),d=t(10),g=i(d),m=t(8),p=i(m);r.__dashjs_factory_name="InsufficientBufferRule",n.default=g.default.getClassFactory(r),e.exports=n.default},{10:10,13:13,130:130,63:63,8:8,9:9}],137:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(){w=[],M={audio:{threshold:_,value:NaN},video:{threshold:p,value:NaN}},C=(0,f.default)(E).getInstance()}function n(t,e){w[t]=w[t]||[],w[t].push(e)}function i(t,e){var n=Math.min(w[t].length,e?g:m),i=w[t].slice(-1*n,w[t].length);return i.length>1&&i.reduce(function(t,e){return(t*y<=e||t>=e*v)&&n++,e}),n=Math.min(w[t].length,n),w[t].slice(-1*n,w[t].length)}function a(t,e){var n=i(t,e),r=0;if(n.length>0){r=n.reduce(function(t,e){return t+e},0)/n.length}return w[t].length>=h&&w[t].shift(),r/1e3*C.getBandwidthSafetyFactor()}function o(t,e){var i=t.getMediaInfo(),o=i.type,l=t.getCurrentValue(),h=S.getReadOnlyMetricsFor(o),f=t.getStreamProcessor(),g=f.getABRController(),m=f.isDynamic(),p=x.getCurrentHttpRequest(h),b=h.BufferState.length>0?h.BufferState[h.BufferState.length-1]:null,_=(0,s.default)(E).create(s.default.NO_CHANGE,s.default.WEAK,{name:r.__dashjs_factory_name});if(!h||!p||p.type!==d.HTTPRequest.MEDIA_SEGMENT_TYPE||!b)return void e(_);var v=void 0;if(p.trace&&p.trace.length){v=p._tfinish.getTime()-p.tresponse.getTime()+1;var y=p.trace.reduce(function(t,e){return t+e.b[0]},0),w=Math.round(8*y/(v/1e3));v<=M[o].threshold?M[o].value=w/1e3:(M[o].value=NaN,n(o,w))}var C=Math.round(isNaN(M[o].value)?a(o,m):M[o].value);if(g.setAverageThroughput(o,C),g.getAbandonmentStateFor(o)!==c.default.ABANDON_LOAD){if(b.state===u.default.BUFFER_LOADED||m){var R=g.getQualityForBitrate(i,C);f.getScheduleController().setTimeToLoadDelay(0),_.value=R,_.priority=s.default.DEFAULT,_.reason.throughput=C}_.value!==s.default.NO_CHANGE&&_.value!==l&&T("ThroughputRule requesting switch to index: ",_.value,"type: ",o," Priority: ",_.priority===s.default.DEFAULT?"Default":_.priority===s.default.STRONG?"Strong":"Weak","Average throughput",Math.round(C),"kbps")}e(_)}function l(){e()}var h=20,g=3,m=4,p=50,_=5,v=1.3,y=1.3,E=this.context,T=(0,b.default)(E).getInstance().log,x=t.dashMetrics,S=t.metricsModel,w=void 0,M=void 0,C=void 0,R={execute:o,reset:l};return e(),R}Object.defineProperty(n,"__esModule",{value:!0});var a=t(130),s=i(a),o=t(63),u=i(o),l=t(60),c=i(l),h=t(101),f=i(h),d=t(179),g=t(10),m=i(g),p=t(8),b=i(p);r.__dashjs_factory_name="ThroughputRule",n.default=m.default.getClassFactory(r),e.exports=n.default},{10:10,101:101,130:130,179:179,60:60,63:63,8:8}],138:[function(t,e,n){function i(t){function e(t){var e,i=0;return t&&t.some(function(t,e){return i=e,!n.contains(t.serviceLocation)})&&(e=t[i]),e}var n=t.blacklistController;return{select:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="BasicSelector",n.default=a.default.getClassFactory(i),e.exports=n.default},{10:10}],139:[function(t,e,n){function i(t){function e(t){var e=[],n=function(t){return!e.length||!t.dvb_priority||-1===e.indexOf(t.dvb_priority)},i=function(t){return!r.contains(t.serviceLocation)||(t.dvb_priority&&e.push(t.dvb_priority),!1)};return t.filter(i).filter(n)}function n(t){var e,n,i=function(t,e){var n=t.dvb_priority-e.dvb_priority;return isNaN(n)?0:n},r=function(t,e,n){return!e||n[0].dvb_priority&&t.dvb_priority&&n[0].dvb_priority===t.dvb_priority},a=0,s=[],o=0;if(n=t.sort(i).filter(r),n.length)return n.length>1&&(n.forEach(function(t){a+=t.dvb_weight,s.push(a)}),e=Math.floor(Math.random()*(a-1)),s.every(function(t,n){return o=n,!(e<t)})),n[o]}function i(t){return t&&n(e(t))}var r=t.blacklistController;return{select:i}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="DVBSelector",n.default=a.default.getClassFactory(i),e.exports=n.default},{10:10}],140:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e,i){return r.getCurrentBufferLevel(a.getReadOnlyMetricsFor(e))<n(t,e,i)}function n(t,e,n){var i=NaN,s=t.getCurrentRepresentationInfo();if("fragmentedText"===e)i=o.getAllTracksAreDisabled()?0:s.fragmentDuration;else if("audio"===e&&n){var u=r.getCurrentBufferLevel(a.getReadOnlyMetricsFor("video"));i=Math.floor(Math.max(u,s.fragmentDuration))}else{var c=s.mediaInfo.streamInfo,h=t.getABRController();if(h.isPlayingAtTopQuality(c)){var f=c.manifestInfo.duration>=l.getLongFormContentDurationThreshold();i=f?l.getBufferTimeAtTopQualityLongForm():l.getBufferTimeAtTopQuality()}else i=l.getStableBufferTime()}return i}var i=this.context,r=t.dashMetrics,a=t.metricsModel,o=t.textSourceBuffer,l=void 0,c=void 0,h={execute:e,getBufferTarget:n};return function(){l=(0,s.default)(i).getInstance(),c=(0,u.default)(i).getInstance()}(),h}Object.defineProperty(n,"__esModule",{value:!0});var a=t(101),s=i(a),o=t(68),u=i(o),l=t(10),c=i(l);r.__dashjs_factory_name="BufferLevelRule",n.default=c.default.getClassFactory(r),e.exports=n.default},{10:10,101:101,68:68}],141:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e){var n=t.getCurrentRepresentationInfo(),s=n.mediaInfo,u=s.type,l=t.getScheduleController(),c=l.getSeekTarget(),h=!isNaN(c),f=t.getBuffer(),d=h?c:r.getIndexHandlerTime(t);if(isNaN(d)||"fragmentedText"===u&&o.getAllTracksAreDisabled())return null;if(h&&l.setSeekTarget(NaN),f){var g=a.getBufferRange(t.getBuffer(),d);null!==g&&(i("Prior to making a request for time, NextFragmentRequestRule is aligning index handler's currentTime with bufferedRange.end.",d," was changed to ",g.end),d=g.end)}var m=void 0;return e?(d=e.startTime+e.duration/2,m=r.getFragmentRequestForTime(t,n,d,{timeThreshold:0,ignoreIsFinished:!0})):(m=r.getFragmentRequestForTime(t,n,d,{keepIdx:!h}),m&&t.getFragmentModel().isFragmentLoaded(m)&&(m=r.getNextFragmentRequest(t,n)),m&&(r.setIndexHandlerTime(t,m.startTime+m.duration),m.delayLoadingTime=(new Date).getTime()+l.getTimeToLoadDelay(),l.setTimeToLoadDelay(0))),m}var n=this.context,i=(0,s.default)(n).getInstance().log,r=t.adapter,a=t.sourceBufferController,o=t.textSourceBuffer;return{execute:e}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(8),s=i(a),o=t(10),u=i(o);r.__dashjs_factory_name="NextFragmentRequestRule",n.default=u.default.getClassFactory(r),e.exports=n.default},{10:10,8:8}],142:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e){var n,o;if(x=e,w=t.getStreamProcessor(),S=w.getFragmentLoader(),v=t.getTrackInfo(),E=v.fragmentDuration,o=v.DVRWindow,p=o.end,v.useCalculatedLiveEdgeTime){var u=g.getExpectedLiveEdge();return g.setExpectedLiveEdge(p),void x((0,s.default)(l).create(u,T))}b={start:Math.max(0,p-d),end:p+d},_=Math.floor((o.end-o.start)/2),n=f.getFragmentRequestForTime(w,v,p,{ignoreIsFinished:!0}),i(p,a,r,n)}function n(){p=NaN,b=null,_=NaN,v=null,y=!1,E=NaN,w=null,S=null}function i(t,e,n,r){var a;if(null===r)a=f.generateFragmentRequestForTime(w,v,t),i(t,e,n,a);else{var s=function i(r){h.off(c.default.CHECK_FOR_EXISTENCE_COMPLETED,i,this),r.exists?e(r.request,t):n(r.request,t)};h.on(c.default.CHECK_FOR_EXISTENCE_COMPLETED,s,this),S.checkForExistence(r)}}function r(t,e){var n,u,c;return y?void o(!1,e):(c=e-p,n=c>0?p-c:p+Math.abs(c)+_,void(n<b.start&&n>b.end?x((0,s.default)(l).create(null,T)):(u=f.getFragmentRequestForTime(w,v,n,{ignoreIsFinished:!0}),i(n,a,r,u))))}function a(t,e){var n,r,a=t.startTime;if(!y){if(!v.fragmentDuration)return void x((0,s.default)(l).create(a,T));if(y=!0,b.end=a+2*_,e===p)return r=e+E,n=f.getFragmentRequestForTime(w,v,r,{ignoreIsFinished:!0}),void i(r,function(){o(!0,r)},function(){x((0,s.default)(l).create(r,T))},n)}o(!0,e)}function o(t,e){var n,o,u;t?b.start=e:b.end=e,n=Math.floor(b.end-b.start)<=E,n?x((0,s.default)(l).create(t?e:e-E,T)):(u=(b.start+b.end)/2,o=f.getFragmentRequestForTime(w,v,u,{ignoreIsFinished:!0}),i(u,a,r,o))}var l=this.context,h=(0,u.default)(l).getInstance(),f=t.adapter,g=t.timelineConverter,m=void 0,p=void 0,b=void 0,_=void 0,v=void 0,y=void 0,E=void 0,T=void 0,x=void 0,S=void 0,w=void 0;return m={execute:e,reset:n},function(){p=NaN,b=null,_=NaN,v=null,y=!1,E=NaN,T=s.default.DEFAULT}(),m}Object.defineProperty(n,"__esModule",{value:!0});var a=t(130),s=i(a),o=t(9),u=i(o),l=t(13),c=i(l),h=t(10),f=i(h),d=43200;r.__dashjs_factory_name="LiveEdgeBinarySearchRule",n.default=f.default.getClassFactory(r),e.exports=n.default},{10:10,13:13,130:130,9:9}],143:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(t,e){var r=t.getTrackInfo(),a=r.DVRWindow.end,o=s.default.DEFAULT;if(r.useCalculatedLiveEdgeTime){var u=i.getExpectedLiveEdge();i.setExpectedLiveEdge(a),e((0,s.default)(n).create(u,o))}else e((0,s.default)(n).create(a,o))}var n=this.context,i=t.timelineConverter;return{execute:e}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(130),s=i(a),o=t(10),u=i(o);r.__dashjs_factory_name="LiveEdgeWithTimeSynchronizationRule",n.default=u.default.getClassFactory(r),e.exports=n.default},{10:10,130:130}],144:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(){i=[],r=[],i.push((0,f.default)(n).create({timelineConverter:(0,u.default)(n).getInstance()})),r.push((0,c.default)(n).create({timelineConverter:(0,u.default)(n).getInstance(),adapter:(0,g.default)(n).getInstance()}))}function e(t){switch(t){case m:return i;case p:return r;default:return null}}var n=this.context,i=void 0,r=void 0;return{initialize:t,getRules:e}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(37),u=i(o),l=t(142),c=i(l),h=t(143),f=i(h),d=t(15),g=i(d),m="withAccurateTimeSourceRules",p="bestGuestRules";r.__dashjs_factory_name="SynchronizationRulesCollection";var b=s.default.getSingletonFactory(r);b.TIME_SYNCHRONIZED_RULES=m,b.BEST_GUESS_RULES=p,n.default=b,e.exports=n.default},{10:10,142:142,143:143,15:15,37:37}],145:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){m=a.getIsDVB(t)?d:h}function e(t){var e=t.baseUrls,n=t.selectedIdx;if(!isNaN(n))return e[n];var i=m.select(e);return i?(t.selectedIdx=e.indexOf(i),i):void r.trigger(u.default.URL_RESOLUTION_FAILED,{error:new Error(v,y)})}function n(){l.reset()}var i=this.context,r=(0,s.default)(i).getInstance(),a=(0,c.default)(i).getInstance(),o=void 0,l=void 0,h=void 0,d=void 0,m=void 0;return o={chooseSelectorFromManifest:t,select:e,reset:n},function(){l=(0,f.default)(i).create({updateEventName:u.default.SERVICE_LOCATION_BLACKLIST_CHANGED,loadFailedEventName:u.default.FRAGMENT_LOADING_COMPLETED}),h=(0,p.default)(i).create({blacklistController:l}),d=(0,g.default)(i).create({blacklistController:l}),m=h}(),o}Object.defineProperty(n,"__esModule",{value:!0});var a=t(9),s=i(a),o=t(13),u=i(o),l=t(22),c=i(l),h=t(62),f=i(h),d=t(139),g=i(d),m=t(138),p=i(m),b=t(10),_=i(b),v=1,y="Failed to resolve a valid URL";r.__dashjs_factory_name="BaseURLSelector";var E=_.default.getClassFactory(r);E.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=v,E.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE=y,n.default=E,e.exports=n.default},{10:10,13:13,138:138,139:139,22:22,62:62,9:9}],146:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){if(!t)return null;void 0===t.fileStart&&(t.fileStart=0);var n=c.default.parseBuffer(t),i=(0,s.default)(e).create();return i.setData(n),i}var e=this.context;return{parse:t}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(153),s=i(a),o=t(10),u=i(o),l=t(6),c=i(l);r.__dashjs_factory_name="BoxParser",n.default=u.default.getSingletonFactory(r),e.exports=n.default},{10:10,153:153,6:6}],147:[function(t,e,n){function i(){function t(){var t="WebKitMediaSource"in window,e="MediaSource"in window;return t||e}function e(){return a}function n(t){a=t}function i(t,e){var n=t.canPlayType(e);return"probably"===n||"maybe"===n}var r=void 0,a=void 0;return r={supportsMediaSource:t,supportsEncryptedMedia:e,supportsCodec:i,setEncryptedMediaSupported:n},function(){a=!1}(),r}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="Capabilities",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],148:[function(t,e,n){function i(){function t(t,e){var n=0;for(n=0;n<this.customTimeRangeArray.length&&t>this.customTimeRangeArray[n].start;n++);for(this.customTimeRangeArray.splice(n,0,{start:t,end:e}),n=0;n<this.customTimeRangeArray.length-1;n++)this.mergeRanges(n,n+1)&&n--;this.length=this.customTimeRangeArray.length}function e(){this.customTimeRangeArray=[],this.length=0}function n(t,e){for(var n=0;n<this.customTimeRangeArray.length;n++)if(t<=this.customTimeRangeArray[n].start&&e>=this.customTimeRangeArray[n].end)this.customTimeRangeArray.splice(n,1),n--;else{if(t>this.customTimeRangeArray[n].start&&e<this.customTimeRangeArray[n].end){this.customTimeRangeArray.splice(n+1,0,{start:e,end:this.customTimeRangeArray[n].end}),this.customTimeRangeArray[n].end=t;break}t>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end?this.customTimeRangeArray[n].end=t:e>this.customTimeRangeArray[n].start&&e<this.customTimeRangeArray[n].end&&(this.customTimeRangeArray[n].start=e)}this.length=this.customTimeRangeArray.length}function i(t,e){var n=this.customTimeRangeArray[t],i=this.customTimeRangeArray[e];return n.start<=i.start&&i.start<=n.end&&n.end<=i.end?(n.end=i.end,this.customTimeRangeArray.splice(e,1),!0):i.start<=n.start&&n.start<=i.end&&i.end<=n.end?(n.start=i.start,this.customTimeRangeArray.splice(e,1),!0):i.start<=n.start&&n.start<=i.end&&n.end<=i.end?(this.customTimeRangeArray.splice(t,1),!0):n.start<=i.start&&i.start<=n.end&&i.end<=n.end&&(this.customTimeRangeArray.splice(e,1),!0)}function r(t){return this.customTimeRangeArray[t].start}function a(t){return this.customTimeRangeArray[t].end}return{customTimeRangeArray:[],length:0,add:t,clear:e,remove:n,mergeRanges:i,start:r,end:a}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="CustomTimeRanges",n.default=a.default.getClassFactory(i),e.exports=n.default},{10:10}],149:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){if(void 0!==_)return _;_=!1;var e;try{"undefined"!=typeof window&&(e=window[t])}catch(t){return p("Warning: DOMStorage access denied: "+t.message),_}if(!e||t!==g&&t!==m)return _;try{e.setItem("1","1"),e.removeItem("1"),_=!0}catch(t){p("Warning: DOMStorage is supported, but cannot be used: "+t.message)}return _}function e(){t(g)&&h.forEach(function(t){var e=localStorage.getItem(t.oldKey);if(e){localStorage.removeItem(t.oldKey);try{localStorage.setItem(t.newKey,e)}catch(t){p(t.message)}}})}function n(){return 6e5*Math.round((new Date).getTime()/6e5)}function i(e,n){return t(e)&&v["get"+n+"CachingInfo"]().enabled}function r(t){if(!i(g,"LastMediaSettings"))return null;var e=d.replace(/\?/,t),n=JSON.parse(localStorage.getItem(e))||{},r=(new Date).getTime()-parseInt(n.timestamp,10)>=v.getLastMediaSettingsCachingInfo().ttl||!1,a=n.settings;return r&&(localStorage.removeItem(e),a=null),a}function a(t){var e=NaN;if(i(g,"LastBitrate")){var n=f.replace(/\?/,t),r=JSON.parse(localStorage.getItem(n))||{},a=(new Date).getTime()-parseInt(r.timestamp,10)>=v.getLastBitrateCachingInfo().ttl||!1,s=parseInt(r.bitrate,10);isNaN(s)||a?a&&localStorage.removeItem(n):(e=s,p("Last saved bitrate for "+t+" was "+s))}return e}function s(t,e){if(i(g,"LastMediaSettings")){var r=d.replace(/\?/,t);try{localStorage.setItem(r,JSON.stringify({settings:e,timestamp:n()}))}catch(t){p(t.message)}}}function o(t,e){if(i(g,"LastBitrate")&&e){var r=f.replace(/\?/,t);try{localStorage.setItem(r,JSON.stringify({bitrate:e/1e3,timestamp:n()}))}catch(t){p(t.message)}}}var l=this.context,p=(0,c.default)(l).getInstance().log,b=void 0,_=void 0,v=void 0;return b={getSavedBitrateSettings:a,setSavedBitrateSettings:o,getSavedMediaSettings:r,setSavedMediaSettings:s,isSupported:t},function(){v=(0,u.default)(l).getInstance(),e()}(),b}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(101),u=i(o),l=t(8),c=i(l),h=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],f="dashjs_?_bitrate",d="dashjs_?_settings",g="localStorage",m="sessionStorage";r.__dashjs_factory_name="DOMStorage";var p=s.default.getSingletonFactory(r);n.default=p,e.exports=n.default},{10:10,101:101,8:8}],150:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){function e(){return g}function n(t){g=t}function i(t,e){var n=!0,i=0,r=void 0,a=void 0;if(void 0===e&&(e=!1),t.tag>16777215?(d.getUint32(g)!==t.tag&&(n=!1),i=4):t.tag>65535?(r=d.getUint16(g),
a=d.getUint8(g+2),256*r+a!==t.tag&&(n=!1),i=3):t.tag>255?(d.getUint16(g)!==t.tag&&(n=!1),i=2):(d.getUint8(g)!==t.tag&&(n=!1),i=1),!n&&t.required&&!e)throw new u.default("required tag not found");return n&&(g+=i),n}function r(t,e){var n=i(t,e);return n&&o(),n}function a(t){var e=void 0;return i(t),e=o(),f[t.parse](e)}function s(t,e){var n=i(t,e),r=void 0;return n&&(r=o(),g+=r),n}function o(t){var e=1,n=128,i=-1,r=0,a=d.getUint8(g),s=void 0;for(s=0;s<8;s+=1){if((a&n)===n){r=void 0===t?a&~n:a,i=s;break}n>>=1}for(s=0;s<i;s+=1,e+=1)r=r<<8|255&d.getUint8(g+e);return g+=e,r}function l(t){var e=void 0;switch(t){case 4:e=d.getFloat32(g),g+=4;break;case 8:e=d.getFloat64(g),g+=8}return e}function c(t){var e=0,n=void 0;for(n=0;n<t;n+=1)e<<=8,e|=255&d.getUint8(g+n);return g+=t,e}function h(){return g<d.byteLength}var f=void 0,d=new DataView(t.data),g=0;return f={getPos:e,setPos:n,consumeTag:i,consumeTagAndSize:r,parseTag:a,skipOverElement:s,getMatroskaCodedNum:o,getMatroskaFloat:l,getMatroskaUint:c,moreData:h}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(162),u=i(o);r.__dashjs_factory_name="EBMLParser",n.default=s.default.getClassFactory(r),e.exports=n.default},{10:10,162:162}],151:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){c.trigger(u.default.ERROR,{error:"capability",event:t})}function e(t,e,n){c.trigger(u.default.ERROR,{error:"download",event:{id:t,url:e,request:n}})}function n(t,e,n,i){c.trigger(u.default.ERROR,{error:"manifestError",event:{message:t,id:e,manifest:n,event:i}})}function i(t,e,n){c.trigger(u.default.ERROR,{error:"cc",event:{message:t,id:e,cc:n}})}function r(t){c.trigger(u.default.ERROR,{error:"mediasource",event:t})}function a(t){c.trigger(u.default.ERROR,{error:"key_session",event:t})}function o(t){c.trigger(u.default.ERROR,{error:"key_message",event:t})}var l=this.context,c=(0,s.default)(l).getInstance();return{capabilityError:t,downloadError:e,manifestError:n,timedTextError:i,mediaSourceError:r,mediaKeySessionError:a,mediaKeyMessageError:o}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(9),s=i(a),o=t(13),u=i(o),l=t(10),c=i(l);r.__dashjs_factory_name="ErrorHandler";var h=c.default.getSingletonFactory(r);h.CAPABILITY_ERROR_MEDIASOURCE="mediasource",h.CAPABILITY_ERROR_MEDIAKEYS="mediakeys",h.DOWNLOAD_ERROR_ID_MANIFEST="manifest",h.DOWNLOAD_ERROR_ID_SIDX="SIDX",h.DOWNLOAD_ERROR_ID_CONTENT="content",h.DOWNLOAD_ERROR_ID_INITIALIZATION="initialization",h.DOWNLOAD_ERROR_ID_XLINK="xlink",h.MANIFEST_ERROR_ID_CODEC="codec",h.MANIFEST_ERROR_ID_PARSE="parse",h.MANIFEST_ERROR_ID_NOSTREAMS="nostreams",h.TIMED_TEXT_ERROR_ID_PARSE="parse",n.default=h,e.exports=n.default},{10:10,13:13,9:9}],152:[function(t,e,n){function i(){function t(t){var e=t.streamId,n=t.mediaInfo.type,r=t.quality;i[e]=i[e]||{},i[e][n]=i[e][n]||{},i[e][n][r]=t}function e(t,e,n){return i[t][e][n]}function n(){i={}}var i={};return{save:t,extract:e,reset:n}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="InitCache",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],153:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){return t&&l&&l.boxes&&0!==l.boxes.length?o(l.fetch(t)):null}function e(t){for(var e=void 0,n=l.fetchAll(t),i=[],r=0,a=n.length;r<a;r++)(e=o(n[r]))&&i.push(e);return i}function n(t){l=t}function i(){if(!l||!l.boxes||!l.boxes.length)return null;var t=l.boxes[l.boxes.length-1].type,n=e(t);return n[n.length-1]}function r(){return l._cursor.offset}function a(t,e,n){for(var i in n)e[i]=t[n[i]]}function o(t){if(!t)return null;var e,n,i=new s.default;switch(a(t,i,c),t.hasOwnProperty("_incomplete")&&(i.isComplete=!t._incomplete),i.type){case"sidx":if(a(t,i,h),i.references)for(e=0,n=i.references.length;e<n;e++)a(t.references[e],i.references[e],f);break;case"emsg":a(t,i,d);break;case"mdhd":a(t,i,g);break;case"mfhd":a(t,i,m);break;case"tfhd":a(t,i,p);break;case"tfdt":a(t,i,b);break;case"trun":if(a(t,i,_),i.samples)for(e=0,n=i.samples.length;e<n;e++)a(t.samples[e],i.samples[e],v)}return i}var u=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,g=void 0,m=void 0,p=void 0,b=void 0,_=void 0,v=void 0;return u={getBox:t,getBoxes:e,setData:n,getLastBox:i,getOffset:r},function(){c={offset:"_offset",size:"size",type:"type"},h={references:"references",timescale:"timescale",earliest_presentation_time:"earliest_presentation_time",first_offset:"first_offset"},f={reference_type:"reference_type",referenced_size:"referenced_size",subsegment_duration:"subsegment_duration"},d={id:"id",value:"value",timescale:"timescale",scheme_id_uri:"scheme_id_uri",presentation_time_delta:"presentation_time_delta",event_duration:"event_duration",message_data:"message_data"},g={timescale:"timescale"},m={sequence_number:"sequence_number"},p={base_data_offset:"base_data_offset",sample_description_index:"sample_description_index",default_sample_duration:"default_sample_duration",default_sample_size:"default_sample_size",default_sample_flags:"default_sample_flags",flags:"flags"},b={version:"version",baseMediaDecodeTime:"baseMediaDecodeTime",flags:"flags"},_={sample_count:"sample_count",first_sample_flags:"first_sample_flags",data_offset:"data_offset",flags:"flags",samples:"samples"},v={sample_size:"sample_size",sample_duration:"sample_duration",sample_composition_time_offset:"sample_composition_time_offset"}}(),u}Object.defineProperty(n,"__esModule",{value:!0});var a=t(165),s=i(a),o=t(10),u=i(o);r.__dashjs_factory_name="IsoFile",n.default=u.default.getClassFactory(r),e.exports=n.default},{10:10,165:165}],154:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t,e){h=t,d=e,p=!1,_=NaN,y=null,m=(0,g.default)(o).getInstance(),E=s.default.BEST_GUESS_RULES,l.on(f.default.STREAM_INITIALIZED,a,this)}function e(){p=!1,_=NaN}function n(){return y}function i(){l.off(f.default.STREAM_INITIALIZED,a,this),e(),y=null,h=null,d=null,p=!1,_=NaN,E=null,m=null}function r(t){var e=((new Date).getTime()-_)/1e3;y=t.value,l.trigger(f.default.LIVE_EDGE_SEARCH_COMPLETED,{liveEdge:y,searchTime:e,error:null===y?new u.default(b,"live edge has not been found",null):null})}function a(t){!d.isDynamic()||p||t.error||(E=h.isTimeSyncCompleted()?s.default.TIME_SYNCHRONIZED_RULES:s.default.BEST_GUESS_RULES,v=(0,s.default)(o).getInstance().getRules(E),p=!0,_=(new Date).getTime(),m.applyRules(v,d,r,null,function(t,e){return e}))}var o=this.context,l=(0,c.default)(o).getInstance(),h=void 0,d=void 0,m=void 0,p=void 0,_=void 0,v=void 0,y=void 0,E=void 0;return{initialize:t,abortSearch:e,getLiveEdge:n,reset:i}}Object.defineProperty(n,"__esModule",{value:!0});var a=t(144),s=i(a),o=t(162),u=i(o),l=t(9),c=i(l),h=t(13),f=i(h),d=t(129),g=i(d),m=t(10),p=i(m),b=1;r.__dashjs_factory_name="LiveEdgeFinder";var _=p.default.getSingletonFactory(r);_.LIVE_EDGE_NOT_FOUND_ERROR_CODE=b,n.default=_,e.exports=n.default},{10:10,129:129,13:13,144:144,162:162,9:9}],155:[function(t,e,n){function i(){function t(t,e){return JSON.stringify(t)===JSON.stringify(e)}return{areSimpleEquivalent:t}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="ObjectUtils",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],156:[function(t,e,n){function i(){function t(t){return t}function e(t){return t}return{modifyRequestURL:t,modifyRequestHeader:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="RequestModifier",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],157:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){t&&t.videoModel&&(tt=t.videoModel)}function e(t){if(t.hasOwnProperty("begin")&&t.hasOwnProperty("end")){return[d(t.begin),d(t.end)]}return null}function n(){var t="cue_TTML_"+et;return et++,t}function i(t,e,n){function i(t,e){if(t.hasOwnProperty(e)){var n=t[e];a.indexOf(n)<0&&a.push(n)}}for(var r=[],a=[],s=[],o=0;o<t.length;o++){var u=t[o];i(u,"begin"),i(u,"end")}if(0===a.length)return s;if(void 0!==e&&void 0!==n){for(var o=0;o<a.length;o++){var l=d(a[o]);e<l&&l<n&&r.push(l)}r.push(e),r.push(n)}else for(var o=0;o<a.length;o++)r.push(d(a[o]));r.sort(function(t,e){return t-e});for(var o=0;o<r.length-1;o++)s.push([r[o],r[o+1]]);return s}function r(t,e){return"undefined"!=typeof startInterval&&t<e&&(t=e),t}function a(t,e){return void 0!==e&&t>e&&(t=e),t}function s(t,e,n){var i=d(t.begin),s=d(t.end);return i=r(i,e),s=a(s,n),void 0!==e&&void 0!==n&&(s<e||i>n)?(D("TTML: Cue "+i+"-"+s+" outside interval "+e+"-"+n),null):[i,s]}function o(t,n){var i=!0;if(t.hasOwnProperty("span")){var r=e(t.span);null!==r&&(i=r[0]<n[1]&&r[1]>n[0])}return i}function l(t,r,a){var l=void 0,c=void 0,h=void 0,f=void 0,d="",p=new u.default([],"",!1);if(!(V=p.xml_str2json(t)))throw new Error("TTML document could not be parsed");if(tt.getTTMLRenderingDiv()&&(f="html"),!(l=V.tt))throw new Error("TTML document lacks tt element");var b=g(l,"http://www.w3.org/ns/ttml");if(b&&m(l,b),h=l["tts:extent"],!(c=l.head))throw new Error("TTML document lacks head element");if(c.layout&&(U=c.layout.region_asArray),c.styling&&(B=c.styling.style_asArray),!l.body)throw new Error("TTML document lacks body element");var E=O(),T=tt.getElement().clientWidth,x=tt.getElement().clientHeight,S=[T/E[0],x/E[1]];q["font-size"]=S[1]+"px;";var R=[];if(U)for(var L=0;L<U.length;L++)R.push(M(JSON.parse(JSON.stringify(U[L])),S));var N=g(V.tt,"http://www.w3.org/ns/ttml#parameter");l.hasOwnProperty(N+":frameRate")&&(l.frameRate=parseInt(l[N+":frameRate"],10));for(var k=[],F=l.body_asArray[0].__children,H=0;H<F.length;H++){var X=F[H].div,K=null;if(null===(K=e(X))){var W=X.p_asArray;if(null===K&&(!W||0===W.length))return d="TTML has div that contains no timing and no paragraphs.",D(d),k;for(var Y=0;Y<W.length;Y++){var Q=W[Y],Z=Q.span_asArray,J=[];if(Q.hasOwnProperty("begin")&&Q.hasOwnProperty("end")){var et=s(Q,r,a);null!==et&&J.push(et)}else J=i(Z,r,a);if(0!==J.length)for(var nt=Q.__children,it=0;it<J.length;it++){for(var rt=J[it],at=[],st=0;st<nt.length;st++){var ot=nt[st];o(ot,rt)&&at.push(ot)}if(0!==at.length)if("html"===f){G={},$={},z={};var ut=I(Q,X,S),lt=P(Q,S),ct=lt[1];lt=lt[0];var ht=document.createElement("div");ht.className=ct;var ft=j(at,S);ft.className="cueDirUniWrapper",_("unicode-bidi",lt)&&(ft.style.cssText+=v("unicode-bidi",lt),y("unicode-bidi",lt)),_("direction",lt)&&(ft.style.cssText+=v("direction",lt),y("direction",lt)),_("padding-left",lt)&&_("padding-right",lt)&&(ft.innerHTML=A(ft,lt)),_("padding-left",lt)&&_("padding-right",lt)&&(y("padding-left",lt),y("padding-right",lt));var dt="";if(_("regionID",ut)){var gt=v("regionID",ut);dt=gt.slice(gt.indexOf(":")+1,gt.length-1)}lt&&(ht.style.cssText=lt.join(" ")+"display:flex;"),ut&&(ut=ut.join(" ")),ht.appendChild(ft);var mt=document.createElement("div");mt.appendChild(ht),mt.id=n(),mt.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+ut,0===Object.keys(z).length&&(z.defaultFontSize="100"),k.push({start:rt[0],end:rt[1],type:"html",cueHTMLElement:mt,regions:R,regionID:dt,cueID:mt.id,videoHeight:x,videoWidth:T,cellResolution:E,fontSize:z||{defaultFontSize:"100"},lineHeight:G,linePadding:$})}else{var pt="",bt=at;bt.length&&bt.forEach(function(t){if(t.hasOwnProperty("span")){var e=t.span.__children;e.forEach(function(t){e.hasOwnProperty("metadata")||(t.hasOwnProperty("#text")?pt+=t["#text"].replace(/[\r\n]+/gm," ").trim():"br"in t&&(pt+="\n"))})}else pt+=t.hasOwnProperty("br")?"\n":t["#text"].replace(/[\r\n]+/gm," ").trim()}),k.push({start:rt[0],end:rt[1],data:pt,type:"text"})}}else d="TTML: Empty paragraph"}}else{var _t=void 0;if(X.region){_t=w(C(U,X.region),h)}_t||(_t=w(X,h));var vt=l.head.metadata.image_asArray;if(void 0!==X["smpte:backgroundImage"])for(var yt=0;yt<vt.length;yt++)"#"+vt[yt]["xml:id"]===X["smpte:backgroundImage"]&&k.push({start:K[0],end:K[1],id:n(),data:"data:image/"+vt[yt].imagetype.toLowerCase()+";base64, "+vt[yt].__text,type:"image",layout:_t})}}if(""!==d&&D(d),k.length>0)return k;throw new Error(d)}function d(t){var e,n,i;if(!F.test(t))return NaN;if(e=t.split(":"),n=parseFloat(e[0])*h+parseFloat(e[1])*f+parseFloat(e[2]),e[3]){if(!(i=V.tt.frameRate)||isNaN(i))return NaN;n+=parseFloat(e[3])/i}return n}function g(t,e){var n=Object.keys(t).filter(function(n){return("xmlns"===n.split(":")[0]||"xmlns"===n.split(":")[1])&&t[n]===e}).map(function(t){return t.split(":")[2]||t.split(":")[1]});return 1!=n.length?null:n[0]}function m(t,e){for(var n in t)if(t.hasOwnProperty(n)){if(("object"==$traceurRuntime.typeof(t[n])||t[n]instanceof Object)&&!Array.isArray(t[n]))m(t[n],e);else if(Array.isArray(t[n]))for(var i=0;i<t[n].length;i++)m(t[n][i],e);var r=n.slice(n.indexOf(e)+e.length+1);t[r]=t[n],delete t[n]}}function p(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function b(t){var e=t.slice(1),n=e.match(/.{2}/g),i=parseFloat(parseInt(parseInt(n[3],16)/255*1e3,10)/1e3);return"rgba("+n.slice(0,3).map(function(t){return parseInt(t,16)}).join(",")+","+i+");"}function _(t,e){for(var n=0;n<e.length;n++)if(e[n].indexOf(t)>-1)return!0;return!1}function v(t,e){for(var n=0;n<e.length;n++)if(e[n].indexOf(t)>-1)return e[n];return null}function y(t,e){e.splice(e.indexOf(v(t,e)),1)}function E(t,e){for(var n=0;n<t.length;n++)for(var i=0;i<e.length;i++)t[n]&&t[n].split(":")[0].indexOf(e[i].split(":")[0])>-1&&t.splice(n,1);return t.concat(e)}function T(t,e,n){var i=[];for(var r in t)if(t.hasOwnProperty(r)){var a=r.replace("ebutts:","");a=a.replace("xml:",""),a=a.replace("tts:",""),a=p(a),t[a]=t[r],delete t[r]}if("line-padding"in t){var s=parseFloat(t["line-padding"].slice(t["line-padding"].indexOf(":")+1,t["line-padding"].indexOf("c")));"id"in t&&($[t.id]=s);var o=s*e[0]+"px;";i.push("padding-left:"+o),i.push("padding-right:"+o)}if("font-size"in t){var u=parseFloat(t["font-size"].slice(t["font-size"].indexOf(":")+1,t["font-size"].indexOf("%")));"id"in t&&(z[t.id]=u);var l=u/100*e[1]+"px;";i.push("font-size:"+l)}if("line-height"in t)if("normal"===t["line-height"])i.push("line-height: normal;");else{var c=parseFloat(t["line-height"].slice(t["line-height"].indexOf(":")+1,t["line-height"].indexOf("%")));"id"in t&&(G[t.id]=c);var h=c/100*e[1]+"px;";i.push("line-height:"+h)}"font-family"in t&&(t["font-family"]in X?i.push(X[t["font-family"]]):i.push("font-family:"+t["font-family"]+";")),"text-align"in t&&t["text-align"]in K&&(i.push(K[t["text-align"]][0]),i.push(K[t["text-align"]][1])),"multi-row-align"in t&&(_("text-align",i)&&"auto"!=t["multi-row-align"]&&y("text-align",i),t["multi-row-align"]in W&&i.push(W[t["multi-row-align"]]));var f;return"background-color"in t&&(t["background-color"].indexOf("#")>-1&&t["background-color"].length-1==8?(f=b(t["background-color"]),i.push("background-color: "+f)):i.push("background-color:"+t["background-color"]+";")),"color"in t&&(t.color.indexOf("#")>-1&&t.color.length-1==8?(f=b(t.color),i.push("color: "+f)):i.push("color:"+t.color+";")),"wrap-option"in t&&(t["wrap-option"]in Y?i.push(Y[t["wrap-option"]]):i.push("white-space:"+t["wrap-option"])),"unicode-bidi"in t&&(t["unicode-bidi"]in Q?i.push(Q[t["unicode-bidi"]]):i.push("unicode-bidi:"+t["unicode-bidi"])),"font-style"in t&&i.push("font-style:"+t["font-style"]+";"),"font-weight"in t&&i.push("font-weight:"+t["font-weight"]+";"),"direction"in t&&i.push("direction:"+t.direction+";"),"text-decoration"in t&&i.push("text-decoration:"+t["text-decoration"]+";"),n&&(i=i.concat(M(t,e))),V.tt.hasOwnProperty("xml:space")&&"preserve"===V.tt["xml:space"]&&i.push("white-space: pre;"),i}function x(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i["xml:id"]===e||i.id===e)return i}return null}function S(t,e,n){var i=[];return t.match(/\S+/g).forEach(function(t){var r=x(B,t);if(r){var a=T(JSON.parse(JSON.stringify(r)),e,n);i=i.concat(a)}}),i}function w(t,e){var n=/([\d\.]+)(%|px)\s+([\d\.]+)(%|px)/;if("tts:extent"in t&&"tts:origin"in t){var i=n.exec(t["tts:extent"]),r=n.exec(t["tts:origin"]);if(null===i||null===r)return D("Bad extent or origin: "+t["tts:extent"]+" "+t["tts:origin"]),null;var a=parseFloat(i[1]),s=parseFloat(i[3]),o=parseFloat(r[1]),u=parseFloat(r[3]);if(e){var l=n.exec(e);if(null===l||"px"!==l[2]||"px"!==l[4])return D("Bad tt.extent: "+e),null;var c=parseFloat(l[1]),h=parseFloat(l[3]);"px"===i[2]&&(a=a/c*100),"px"===i[4]&&(s=s/h*100),"px"===r[2]&&(o=o/c*100),"px"===r[4]&&(u=u/h*100)}return{left:o,top:u,width:a,height:s}}return null}function M(t,e){var n=[];for(var i in t){var r=i.replace("tts:","");r=r.replace("xml:",""),r=p(r),t[r]=t[i],r!==i&&delete t[i]}if("extent"in t){var a=t.extent.split(/\s/);n.push("width: "+a[0]+";"),n.push("height: "+a[1]+";")}if("origin"in t){var s=t.origin.split(/\s/);n.push("left: "+s[0]+";"),n.push("top: "+s[1]+";")}if("display-align"in t&&n.push(Z[t["display-align"]]),"writing-mode"in t&&n.push(J[t["writing-mode"]]),"style"in t){var o=S(t.style,e,!0);n=n.concat(o)}return"padding"in t&&n.push("padding:"+t.padding+";"),"overflow"in t&&n.push("overflow:"+t.overflow+";"),"show-background"in t&&n.push("show-background:"+t["show-background"]+";"),"id"in t&&n.push("regionID:"+t.id+";"),n}function C(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i["xml:id"]===e||i.id===e)return i}return null}function R(t,e){var n=[];return t.match(/\S+/g).forEach(function(t){var i=C(U,t);if(i){var r=M(JSON.parse(JSON.stringify(i)),e);n=n.concat(r)}}),n}function O(){var t=[32,15];return V.tt.hasOwnProperty("ttp:cellResolution")?V.tt["ttp:cellResolution"].split(" ").map(parseFloat):t}function A(t,e){for(var n=v("padding-left",e),i=v("padding-right",e),r=n.concat(" "+i+" "),a="",s="",o="",u=Array.prototype.slice.call(t.children),l=t.getElementsByClassName("lineBreak")[0],c=u.indexOf(l),h=[];-1!=c;)h.push(c),c=u.indexOf(l,c+1);var f="</span>",d="<br>",g='<span class="spanPadding" style="-webkit-box-decoration-break: clone; box-decoration-break: clone; ';if(h.length)h.forEach(function(t,e){if(0===e){for(var n="",i=0;i<t;i++)a+=u[i].outerHTML,0===i&&(n=r.concat(u[i].style.cssText));a=g+n+'">'+a}for(var l="",c=t+1;c<u.length;c++)s+=u[c].outerHTML,c===u.length-1&&(l+=r.concat(u[c].style.cssText));s=g+l+'">'+s,a&&s&&e===h.length-1?o+=a+f+d+s+f:a&&s&&e!==h.length-1?o+=a+f+d+s+f+d:a&&!s?o+=a+f:!a&&s&&e===h.length-1?o+=s+f:!a&&s&&e!==h.length-1&&(o+=s+f+d)});else{for(var m="",p=0;p<u.length;p++)m+=u[p].style.cssText;o=g+r+m+'">'+t.innerHTML+f}return o}function j(t,e){var n=document.createElement("div");return t.forEach(function(t){if(!t.hasOwnProperty("metadata"))if(t.hasOwnProperty("span")){var i=t.span.__children,r=document.createElement("span");if(t.span.hasOwnProperty("style")){var a=S(t.span.style,e);r.className="spanPadding "+t.span.style,r.style.cssText=a.join(" ")}i.forEach(function(t){if(!i.hasOwnProperty("metadata"))if(t.hasOwnProperty("#text")){var e=document.createTextNode(t["#text"]);r.appendChild(e)}else if("br"in t){r.hasChildNodes()&&n.appendChild(r);var a=document.createElement("br");a.className="lineBreak",n.appendChild(a);var s=document.createElement("span");s.className=r.className,s.style.cssText=r.style.cssText,r=s}}),n.appendChild(r)}else if(t.hasOwnProperty("br")){var s=document.createElement("br");s.className="lineBreak",n.appendChild(s)}else if(t.hasOwnProperty("#text")){var o=document.createElement("span");o.textContent=t["#text"],n.appendChild(o)}}),n}function I(t,e,n){var i,r,a=[],s=t.region,o=e.region;return o&&(i=R(o,n)),s?(r=a.concat(R(s,n)),a=i?E(i,r):r):i&&(a=i),L(a,H),a}function P(t,e){var n,i,r,a=[],s=t.style,o=V.tt.body.style,u=V.tt.body.div.style,l="";return o&&(n=S(o,e),l="paragraph "+o),u&&(i=S(u,e),n?(i=E(n,i),l+=" "+u):l="paragraph "+u),s?(r=S(s,e),n&&i?(a=E(i,r),l+=" "+s):n?(a=E(n,r),l+=" "+s):i?(a=E(i,r),l+=" "+s):(a=r,l="paragraph "+s)):n&&!i?a=n:!n&&i&&(a=i),L(a,q),[a,l]}function L(t,e){for(var n in e)e.hasOwnProperty(n)&&(_(n,t)||t.push(n+":"+e[n]))}var N=this.context,D=(0,c.default)(N).getInstance().log,k=void 0,F=void 0,V=void 0,B=void 0,U=void 0,z=void 0,G=void 0,$=void 0,H=void 0,q=void 0,X=void 0,K=void 0,W=void 0,Y=void 0,Q=void 0,Z=void 0,J=void 0,tt=void 0,et=0;return k={parse:l,setConfig:t},function(){F=/^([0-9][0-9]+):([0-5][0-9]):([0-5][0-9])|(60)(\.([0-9])+)?$/,z={},G={},$={},H={top:"auto;",left:"auto;",width:"90%;",height:"10%;","align-items":"flex-start;",overflow:"visible;","-ms-writing-mode":"lr-tb, horizontal-tb;","-webkit-writing-mode":"horizontal-tb;","-moz-writing-mode":"horizontal-tb;","writing-mode":"horizontal-tb;"},q={color:"rgb(255,255,255);",direction:"ltr;","font-family":"monospace, sans-serif;","font-style":"normal;","line-height":"normal;","font-weight":"normal;","text-align":"start;","justify-content":"flex-start;","text-decoration":"none;","unicode-bidi":"normal;","white-space":"normal;",width:"100%;"},X={monospace:"font-family: monospace;",sansSerif:"font-family: sans-serif;",serif:"font-family: serif;",monospaceSansSerif:"font-family: monospace, sans-serif;",monospaceSerif:"font-family: monospace, serif;",proportionalSansSerif:"font-family: Arial;",proportionalSerif:"font-family: Times New Roman;",default:"font-family: monospace, sans-serif;"},K={right:["justify-content: flex-end;","text-align: right;"],start:["justify-content: flex-start;","text-align: start;"],center:["justify-content: center;","text-align: center;"],end:["justify-content: flex-end;","text-align: end;"],left:["justify-content: flex-start;","text-align: left;"]},W={start:"text-align: start;",center:"text-align: center;",end:"text-align: end;",auto:""},Y={wrap:"white-space: normal;",noWrap:"white-space: nowrap;"},Q={normal:"unicode-bidi: normal;",embed:"unicode-bidi: embed;",bidiOverride:"unicode-bidi: bidi-override;"},Z={before:"align-items: flex-start;",center:"align-items: center;",after:"align-items: flex-end;"},J={lrtb:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;",rltb:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;direction: rtl;unicode-bidi: bidi-override;",tbrl:"-webkit-writing-mode: vertical-rl;writing-mode: vertical-rl;-webkit-text-orientation: upright;text-orientation: upright;",tblr:"-webkit-writing-mode: vertical-lr;writing-mode: vertical-lr;-webkit-text-orientation: upright;text-orientation: upright;",lr:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;",rl:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;direction: rtl;",tb:"-webkit-writing-mode: vertical-rl;writing-mode: vertical-rl;-webkit-text-orientation: upright;text-orientation: upright;"}}(),k}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(4),u=i(o),l=t(8),c=i(l),h=3600,f=60;r.__dashjs_factory_name="TTMLParser",n.default=s.default.getSingletonFactory(r),e.exports=n.default},{10:10,4:4,8:8}],158:[function(t,e,n){function i(){function t(t){var e="";return-1!==t.indexOf("/")&&(-1!==t.indexOf("?")&&(t=t.substring(0,t.indexOf("?"))),e=t.substring(0,t.lastIndexOf("/")+1)),e}function e(t){var e=t.match(o);return e?e[1]:""}function n(t){return!a.test(t)}function i(t){return a.test(t)&&"/"===t.charAt(0)}function r(t){return s.test(t)}var a=/^(?:(?:[a-z]+:)?\/)?\//i,s=/^https?:\/\//i,o=/^(https?:\/\/[^\/]+)\/?/i;return{parseBaseUrl:t,parseOrigin:e,isRelative:n,isPathAbsolute:i,isHTTPURL:r}}Object.defineProperty(n,"__esModule",{value:!0});var r=t(10),a=function(t){return t&&t.__esModule?t:{default:t}}(r);i.__dashjs_factory_name="URLUtils",n.default=a.default.getSingletonFactory(i),e.exports=n.default},{10:10}],159:[function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function r(){function t(t){var i,a,o=[];t=t.split(l),i=t.length,a=-1;for(var u=0;u<i;u++){var f=t[u];if(f.length>0&&"WEBVTT"!==f&&f.match(c)){var d=n(f),g=d.cuePoints,m=d.styles,p=r(t,u+1),b=e(g[0].replace(h,"")),_=e(g[1].replace(h,""));!isNaN(b)&&!isNaN(_)&&b>=a&&_>b?""!==p?(a=b,o.push({start:b,end:_,data:p,styles:m})):s("Skipping cue due to empty/malformed cue text"):s("Skipping cue due to incorrect cue timing")}}return o}function e(t){var e=t.split(":"),n=e.length-1;return t=60*parseInt(e[n-1],10)+parseFloat(e[n]),2===n&&(t+=3600*parseInt(e[0],10)),t}function n(t){var e=t.split(c),n=e[1].split(f);return n.shift(),e[1]=n[0],n.shift(),{cuePoints:e,styles:i(n)}}function i(t){var e={};return t.forEach(function(t){if(t.split(/:/).length>1){var n=t.split(/:/)[1];n&&-1!=n.search(/%/)&&(n=parseInt(n.replace(/%/,""),10)),(t.match(/align/)||t.match(/A/))&&(e.align=n),(t.match(/line/)||t.match(/L/))&&(e.line=n),(t.match(/position/)||t.match(/P/))&&(e.position=n),(t.match(/size/)||t.match(/S/))&&(e.size=n)}}),e}function r(t,e){for(var n=void 0,i=e,r="",a="";""!==t[i]&&i<t.length;)i++;if((n=i-e)>1)for(var s=0;s<n;s++){if(a=t[e+s],a.match(c)){r="";break}r+=a,s!==n-1&&(r+="\n")}else a=t[e],a.match(c)||(r=a);return decodeURI(r)}var a=this.context,s=(0,u.default)(a).getInstance().log,o=void 0,l=void 0,c=void 0,h=void 0,f=void 0;return o={parse:t},function(){l=/(?:\r\n|\r|\n)/gm,c=/-->/,h=/(^[\s]+|[\s]+$)/g,f=/\s\b/g}(),o}Object.defineProperty(n,"__esModule",{value:!0});var a=t(10),s=i(a),o=t(8),u=i(o);r.__dashjs_factory_name="VTTParser",n.default=s.default.getSingletonFactory(r),e.exports=n.default},{10:10,8:8}],160:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.qualityIndex=NaN};n.default=r,e.exports=n.default},{}],161:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN};n.default=r,e.exports=n.default},{}],162:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(e,n,r){i(this,t),this.code=e||null,this.message=n||null,this.data=r||null};n.default=r,e.exports=n.default},{}],163:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.action=t.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer"};r.ACTION_DOWNLOAD="download",r.ACTION_COMPLETE="complete",n.default=r,e.exports=n.default},{}],164:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(163),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=function(t){function e(t){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.url=t||null,this.checkForExistenceOnly=!0}return r(e,t),e}(o.default);n.default=u,e.exports=n.default},{163:163}],165:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.offset=NaN,this.type=null,this.size=NaN,this.isComplete=!0};n.default=r,e.exports=n.default},{}],166:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.DVRWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null};n.default=r,e.exports=n.default},{}],167:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null};n.default=r,e.exports=n.default},{}],168:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[],this.BolaState=[]};n.default=r,e.exports=n.default},{}],169:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0,this.isFirst=!0};n.default=r,e.exports=n.default},{}],170:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":$traceurRuntime.typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(t,e,n){for(var i=!0;i;){var r=t,a=e,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var l=Object.getPrototypeOf(r);if(null===l)return;t=l,e=a,n=s,i=!0,o=l=void 0}},s=t(163),o=function(t){return t&&t.__esModule?t:{default:t}}(s),u=function(t){function e(t,n){i(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.url=t||null,this.type=n||null,this.mediaType="stream",this.responseType="text"}return r(e,t),e}(o.default);n.default=u,e.exports=n.default},{163:163}],171:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.video=null,this.captionData=null,this.label=null,this.lang=null,this.defaultTrack=!1,this.kind=null,this.isFragmented=!1,this.isEmbedded=!1};n.default=r,e.exports=n.default},{}],172:[function(t,e,n){function i(t,e){
if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null};n.default=r,e.exports=n.default},{}],173:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null};n.default=r,e.exports=n.default},{}],174:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this._s=void 0};n.default=r,e.exports=n.default},{}],175:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.t=null,this.level=null};n.default=r,e.exports=n.default},{}],176:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=t(63),a=function(t){return t&&t.__esModule?t:{default:t}}(r),s=function t(){i(this,t),this.target=null,this.state=a.default.BUFFER_EMPTY};n.default=s,e.exports=n.default},{63:63}],177:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.time=null,this.range=null,this.manifestInfo=null};n.default=r,e.exports=n.default},{}],178:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.time=null,this.droppedFrames=null};n.default=r,e.exports=n.default},{}],179:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this._stream=null,this._tfinish=null,this._mediaduration=null,this._responseHeaders=null,this._serviceLocation=null},a=function t(){i(this,t),this.s=null,this.d=null,this.b=[]};r.MPD_TYPE="MPD",r.XLINK_EXPANSION_TYPE="XLinkExpansion",r.INIT_SEGMENT_TYPE="InitializationSegment",r.INDEX_SEGMENT_TYPE="IndexSegment",r.MEDIA_SEGMENT_TYPE="MediaSegment",r.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",r.OTHER_TYPE="other",n.HTTPRequest=r,n.HTTPRequestTrace=a},{}],180:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.trackInfo=[]},a=function t(){i(this,t),this.id=null,this.index=null,this.start=null,this.duration=null},s=function t(){i(this,t),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null};n.ManifestUpdate=r,n.ManifestUpdateStreamInfo=a,n.ManifestUpdateTrackInfo=s},{}],181:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};r.INITIAL_PLAYOUT_START_REASON="initial_playout",r.SEEK_START_REASON="seek",r.RESUME_FROM_PAUSE_START_REASON="resume",r.METRICS_COLLECTION_START_REASON="metrics_collection_start";var a=function t(){i(this,t),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};a.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",a.REBUFFERING_REASON="rebuffering",a.USER_REQUEST_STOP_REASON="user_request",a.END_OF_PERIOD_STOP_REASON="end_of_period",a.END_OF_CONTENT_STOP_REASON="end_of_content",a.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",a.FAILURE_STOP_REASON="failure",n.PlayList=r,n.PlayListTrace=a},{}],182:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.t=null,this.mt=null,this.to=null,this.lto=null};n.default=r,e.exports=n.default},{}],183:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.loadingRequests=[],this.executedRequests=[]};n.default=r,e.exports=n.default},{}],184:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null};n.default=r,e.exports=n.default},{}],185:[function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t),this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null};n.default=r,e.exports=n.default},{}]},{},[5]),Class("paella.MpegDashVideo",paella.Html5Video,{_posterFrame:null,_player:null,initialize:function(t,e,n,i,r,a){this.parent(t,e,n,i,r,a)},_loadDeps:function(){return new Promise(function(t,e){window.$paella_mpd?t(window.$paella_mpd):require(["resources/deps/dash.all.js"],function(){window.$paella_mpd=!0,t(window.$paella_mpd)})})},_getQualityObject:function(t,e,n){var i=n.length,r=Math.round(100*e/i),a=0==e?"min":e==i-1?"max":r+"%";return{index:e,res:{w:null,h:null},bitrate:t.bitrate,src:null,toString:function(){return r},shortLabel:function(){return a},compare:function(t){return this.bitrate-t.bitrate}}},load:function(){var t=this,e=this;return new Promise(function(n,i){var r=t._stream.sources.mpd;r&&r.length>0?(r=r[0],t._loadDeps().then(function(){var t=dashjs.MediaPlayer().create();t.initialize(e.video,r.src,!0),t.getDebug().setLogToBrowserConsole(!1),e._player=t,t.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED,function(i,r){t.getBitrateInfoListFor("video");e._deferredAction(function(){e._firstPlay||(e._player.pause(),e._firstPlay=!0),n()})})})):i(new Error("Invalid source"))})},supportAutoplay:function(){return!0},getQualities:function(){var t=this;return new Promise(function(e){t._deferredAction(function(){t._qualities||(t._qualities=[],t._player.getBitrateInfoListFor("video").sort(function(t,e){return t.bitrate-e.bitrate}).forEach(function(e,n,i){t._qualities.push(t._getQualityObject(e,n,i))}),t.autoQualityIndex=t._qualities.length,t._qualities.push({index:t.autoQualityIndex,res:{w:null,h:null},bitrate:-1,src:null,toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(t){return this.bitrate-t.bitrate}})),e(t._qualities)})})},setQuality:function(t){var e=this;return new Promise(function(n,i){var r=e._player.getQualityFor("video");t==e.autoQualityIndex?(e._player.setAutoSwitchQuality(!0),n()):t!=r?(e._player.setAutoSwitchQuality(!1),e._player.off(dashjs.MediaPlayer.events.METRIC_CHANGED),e._player.on(dashjs.MediaPlayer.events.METRIC_CHANGED,function(t,i){"metricchanged"==t.type&&r!=e._player.getQualityFor("video")&&(r=e._player.getQualityFor("video"),n())}),e._player.setQualityFor("video",t)):n()})},getCurrentQuality:function(){var t=this;return new Promise(function(e,n){if(t._player.getAutoSwitchQuality())e({index:t.autoQualityIndex,res:{w:null,h:null},bitrate:-1,src:null,toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(t){return this.bitrate-t.bitrate}});else{var i=t._player.getQualityFor("video");e(t._getQualityObject(t._qualities[i],i,t._player.getBitrateInfoListFor("video")))}})},unFreeze:function(){return paella_DeferredNotImplemented()},freeze:function(){return paella_DeferredNotImplemented()},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}}),Class("paella.videoFactories.MpegDashVideoFactory",{isStreamCompatible:function(t){try{if(base.userAgent.system.iOS)return!1;for(var e in t.sources)if("mpd"==e)return!0}catch(t){}return!1},getVideoObject:function(t,e,n){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.MpegDashVideo(t,e,n.x,n.y,n.w,n.h)}}),Class("paella.plugins.MultipleQualitiesPlugin",paella.ButtonPlugin,{_available:[],getAlignment:function(){return"right"},getSubclass:function(){return"showMultipleQualitiesPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 550},getName:function(){return"es.upv.paella.multipleQualitiesPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Change video quality")},closeOnMouseOut:function(){return!0},checkEnabled:function(t){var e=this;paella.player.videoContainer.getQualities().then(function(n){e._available=n,t(n.length>1)})},setup:function(){var t=this;this.setQualityLabel(),paella.events.bind(paella.events.qualityChanged,function(e){t.setQualityLabel()})},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(t){var e=this;this._available.forEach(function(n){n.shortLabel();t.appendChild(e.getItemButton(n))})},getItemButton:function(t){var e=document.createElement("div"),n=this;return paella.player.videoContainer.getCurrentQuality().then(function(i,r){var a=t.shortLabel();e.className=n.getButtonItemClass(a,t.index==i),e.id=a,e.innerHTML=a,e.data=t,$(e).click(function(t){$(".multipleQualityItem").removeClass("selected"),$(".multipleQualityItem."+this.data.toString()).addClass("selected"),paella.player.videoContainer.setQuality(this.data.index).then(function(){paella.player.controls.hidePopUp(n.getName()),n.setQualityLabel()})})}),e},setQualityLabel:function(){var t=this;paella.player.videoContainer.getCurrentQuality().then(function(e){t.setText(e.shortLabel())})},getButtonItemClass:function(t,e){return"multipleQualityItem "+t+(e?" selected":"")}}),paella.plugins.multipleQualitiesPlugin=new paella.plugins.MultipleQualitiesPlugin,Class("paella.plugins.PIPModePlugin",paella.ButtonPlugin,{getIndex:function(){return 551},getAlignment:function(){return"right"},getSubclass:function(){return"PIPModeButton"},getName:function(){return"es.upv.paella.pipModePlugin"},checkEnabled:function(t){var e=paella.player.videoContainer.masterVideo(),n=e.video;t(!(!n||!n.webkitSetPresentationMode))},getDefaultToolTip:function(){return base.dictionary.translate("Set picture-in-picture mode.")},setup:function(){},action:function(t){var e=paella.player.videoContainer.masterVideo().video;"picture-in-picture"==e.webkitPresentationMode?e.webkitSetPresentationMode("inline"):e.webkitSetPresentationMode("picture-in-picture")}}),paella.plugins.pipModePlugin=new paella.plugins.PIPModePlugin,Class("paella.plugins.PlayPauseButtonPlugin",paella.ButtonPlugin,{playSubclass:"playButton",pauseSubclass:"pauseButton",getAlignment:function(){return"left"},getSubclass:function(){return this.playSubclass},getName:function(){return"es.upv.paella.playPauseButtonPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Play")},getIndex:function(){return 110},checkEnabled:function(t){t(!paella.player.isLiveStream()||base.userAgent.system.Android||base.userAgent.system.iOS)},setup:function(){var t=this;paella.player.playing()&&this.changeSubclass(t.pauseSubclass),paella.events.bind(paella.events.play,function(e){t.changeSubclass(t.pauseSubclass),t.setToolTip(paella.dictionary.translate("Pause"))}),paella.events.bind(paella.events.pause,function(e){t.changeSubclass(t.playSubclass),t.setToolTip(paella.dictionary.translate("Play"))})},action:function(t){paella.player.videoContainer.paused().then(function(t){t?paella.player.play():paella.player.pause()})}}),paella.plugins.playPauseButtonPlugn=new paella.plugins.PlayPauseButtonPlugin,Class("paella.plugins.PlayButtonOnScreen",paella.EventDrivenPlugin,{containerId:"paella_plugin_PlayButtonOnScreen",container:null,enabled:!0,isPlaying:!1,showIcon:!0,firstPlay:!1,checkEnabled:function(t){t(!paella.player.isLiveStream()||base.userAgent.system.Android||base.userAgent.system.iOS)},getIndex:function(){return 1010},getName:function(){return"es.upv.paella.playButtonOnScreenPlugin"},setup:function(){function t(){var t=jQuery(e.container).innerWidth(),i=jQuery(e.container).innerHeight();n.width=t,n.height=i;var r=t<i?t/3:i/3,a=n.getContext("2d");a.translate((t-r)/2,(i-r)/2),a.beginPath(),a.arc(r/2,r/2,r/2,0,2*Math.PI,!0),a.closePath(),a.strokeStyle="white",a.lineWidth=10,a.stroke(),a.fillStyle="#8f8f8f",a.fill(),a.beginPath(),a.moveTo(r/3,r/4),a.lineTo(3*r/4,r/2),a.lineTo(r/3,3*r/4),a.lineTo(r/3,r/4),a.closePath(),a.fillStyle="white",a.fill(),a.stroke()}var e=this;this.container=document.createElement("div"),this.container.className="playButtonOnScreen",this.container.id=this.containerId,this.container.style.width="100%",this.container.style.height="100%",paella.player.videoContainer.domElement.appendChild(this.container),$(this.container).click(function(t){e.onPlayButtonClick()});var n=document.createElement("canvas");n.className="playButtonOnScreenIcon",this.container.appendChild(n),paella.events.bind(paella.events.resize,t),t()},getEvents:function(){return[paella.events.endVideo,paella.events.play,paella.events.pause,paella.events.showEditor,paella.events.hideEditor]},onEvent:function(t,e){switch(t){case paella.events.endVideo:this.endVideo();break;case paella.events.play:this.play();break;case paella.events.pause:this.pause();break;case paella.events.showEditor:this.showEditor();break;case paella.events.hideEditor:this.hideEditor()}},onPlayButtonClick:function(){this.firstPlay=!0,this.checkStatus()},endVideo:function(){this.isPlaying=!1,this.checkStatus()},play:function(){this.isPlaying=!0,this.showIcon=!1,this.checkStatus()},pause:function(){this.isPlaying=!1,this.showIcon=!1,this.checkStatus()},showEditor:function(){this.enabled=!1,this.checkStatus()},hideEditor:function(){this.enabled=!0,this.checkStatus()},checkStatus:function(){this.enabled&&this.isPlaying||!this.enabled||!this.showIcon?$(this.container).hide():$(this.container).show()}}),new paella.plugins.PlayButtonOnScreen,Class("paella.plugins.PlaybackRate",paella.ButtonPlugin,{buttonItems:null,buttons:[],selected_button:null,defaultRate:null,_domElement:null,available_rates:null,getAlignment:function(){return"left"},getSubclass:function(){return"showPlaybackRateButton"},getIndex:function(){return 140},getMinWindowSize:function(){return 500},getName:function(){return"es.upv.paella.playbackRatePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Set playback rate")},checkEnabled:function(t){t(!base.userAgent.browser.IsMobileVersion&&null!=dynamic_cast("paella.Html5Video",paella.player.videoContainer.masterVideo()))},closeOnMouseOut:function(){return!0},setup:function(){this.defaultRate=1,this.available_rates=this.config.availableRates||[.75,1,1.25,1.5]},buildContent:function(t){var e=this;e._domElement=t,this.buttonItems={},this.available_rates.forEach(function(n){t.appendChild(e.getItemButton(n+"x",n))})},getItemButton:function(t,e){var n=document.createElement("div");return n.className=1==e?this.getButtonItemClass(t,!0):this.getButtonItemClass(t,!1),n.id=t+"_button",n.innerHTML=t,n.data={label:t,rate:e,plugin:this},$(n).click(function(t){this.data.plugin.onItemClick(this,this.data.label,this.data.rate)}),n},onItemClick:function(t,e,n){var i=this;paella.player.videoContainer.setPlaybackRate(n),this.setText(e),paella.player.controls.hidePopUp(this.getName());for(var r=i._domElement.children,a=0;a<r.length;a++)r[a].className=i.getButtonItemClass(a,!1);t.className=i.getButtonItemClass(a,!0)},getText:function(){return"1x"},getProfileItemButton:function(t,e){var n=document.createElement("div");return n.className=this.getButtonItemClass(t,!1),n.id=t+"_button",n.data={profile:t,profileData:e,plugin:this},$(n).click(function(t){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),n},getButtonItemClass:function(t,e){return"playbackRateItem "+t+(e?" selected":"")}}),paella.plugins.playbackRate=new paella.plugins.PlaybackRate,Class("paella.plugins.RatePlugin",paella.ButtonPlugin,{buttonItems:null,buttons:[],selected_button:null,score:0,count:0,myScore:0,canVote:!1,scoreContainer:{header:null,rateButtons:null},getAlignment:function(){return"right"},getSubclass:function(){return"rateButtonPlugin"},getIndex:function(){return 540},getMinWindowSize:function(){return 500},getName:function(){return"es.upv.paella.ratePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Rate this video")},checkEnabled:function(t){var e=this;paella.data.read("rate",{id:paella.initDelegate.getId()},function(n,i){n&&"object"==$traceurRuntime.typeof(n)&&(e.score=Number(n.mean).toFixed(1),e.count=n.count,e.myScore=n.myScore,e.canVote=n.canVote),t(i)})},setup:function(){},setScore:function(t){this.score=t,this.updateScore()},closeOnMouseOut:function(){return!0},updateHeader:function(){var t=base.dictionary.translate("Not rated");this.count>0&&(t='<i class="glyphicon glyphicon-star"></i>',t+=" "+this.score+", "+this.count+" "+base.dictionary.translate("votes")),this.scoreContainer.header.innerHTML="\n\t\t<div>\n\t\t\t<h4>"+base.dictionary.translate("Video score")+":</h4>\n\t\t\t<h5>\n\t\t\t\t"+t+"\n\t\t\t</h5>\n\t\t\t</h4>\n\t\t\t<h4>"+base.dictionary.translate("Vote:")+"</h4>\n\t\t</div>\n\t\t"},updateRateButtons:function(){if(this.scoreContainer.rateButtons.className="rateButtons",this.buttons=[],this.canVote){this.scoreContainer.rateButtons.innerHTML="";for(var t=0;t<5;++t){var e=this.getStarButton(t+1);this.buttons.push(e),this.scoreContainer.rateButtons.appendChild(e)}}else this.scoreContainer.rateButtons.innerHTML="<h5>"+base.dictionary.translate("Login to vote")+"</h5>";this.updateVote()},buildContent:function(t){this._domElement=t;var e=document.createElement("div");t.appendChild(e),e.className="rateContainerHeader",this.scoreContainer.header=e,this.updateHeader();var n=document.createElement("div");this.scoreContainer.rateButtons=n,t.appendChild(n),this.updateRateButtons()},getStarButton:function(t){var e=this,n=document.createElement("i");return n.data={score:t,active:!1},n.className="starButton glyphicon glyphicon-star-empty",$(n).click(function(t){e.vote(this.data.score)}),n},vote:function(t){var e=this;this.myScore=t;var n={mean:this.score,count:this.count,myScore:t,canVote:this.canVote};paella.data.write("rate",{id:paella.initDelegate.getId()},n,function(t){paella.data.read("rate",{id:paella.initDelegate.getId()},function(t,n){t&&"object"==$traceurRuntime.typeof(t)&&(e.score=Number(t.mean).toFixed(1),e.count=t.count,e.myScore=t.myScore,e.canVote=t.canVote),e.updateHeader(),e.updateRateButtons()})})},updateVote:function(){var t=this;this.buttons.forEach(function(e,n){e.className=n<t.myScore?"starButton glyphicon glyphicon-star":"starButton glyphicon glyphicon-star-empty"})}}),paella.plugins.ratePlugin=new paella.plugins.RatePlugin,Class("paella.RTMPVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_duration:0,_paused:!0,_flashId:null,_swfContainer:null,_flashVideo:null,_volume:1,initialize:function(t,e,n,i,r,a){this.parent(t,e,"div",n,i,r,a),this._flashId=t+"Movie";var s=this;this._stream.sources.rtmp.sort(function(t,e){return t.res.h-e.res.h});var o=function(t,e){if("loadedmetadata"==t||"pause"==t||s._isReady||(s._isReady=!0,s._duration=e.duration,$(s.swfContainer).trigger("paella:flashvideoready")),"progress"==t){try{s.flashVideo.setVolume(s._volume)}catch(t){}base.log.debug("Flash video event: "+t+", progress: "+s.flashVideo.currentProgress())}else"ended"==t?(base.log.debug("Flash video event: "+t),paella.events.trigger(paella.events.pause),paella.player.controls.showControls()):base.log.debug("Flash video event: "+t)},u=function(t,e){e=e.split(",");for(var n={},i=0;i<e.length;++i){var r=e[i].split(":"),a=r[0],s=r[1];"NaN"==s?s=NaN:/^true$/i.test(s)?s=!0:/^false$/i.test(s)?s=!1:isNaN(parseFloat(s))||(s=parseFloat(s)),n[a]=s}o(t,n)};paella.events.bind(paella.events.flashVideoEvent,function(t,e){s.flashId==e.source&&u(e.eventName,e.values)}),Object.defineProperty(this,"swfContainer",{get:function(){return s._swfContainer}}),Object.defineProperty(this,"flashId",{get:function(){return s._flashId}}),Object.defineProperty(this,"flashVideo",{get:function(){return s._flashVideo}})},_createSwfObject:function(t,e){var n=this.identifier,i={wmode:"transparent"},r=document.createElement("div");if(this.domElement.appendChild(r),r.id=n+"Movie",this._swfContainer=r,swfobject.hasFlashPlayerVersion("9.0.0"))swfobject.embedSWF(t,r.id,"100%","100%","9.0.0","",e,i,null,function(t){if(0==t.success){var e=document.createElement("div"),n=document.createElement("h3");n.innerHTML=base.dictionary.translate("Flash player problem");var i=document.createElement("div");i.innerHTML=base.dictionary.translate("A problem occurred trying to load flash player.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>")+"<br>"+base.dictionary.translate("If the problem presist, contact us.");var r=document.createElement("a");r.setAttribute("href","http://www.adobe.com/go/getflash"),r.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',e.appendChild(n),e.appendChild(i),e.appendChild(r),paella.messageBox.showError(e.innerHTML)}});else{var a=document.createElement("div"),s=document.createElement("h3");s.innerHTML=base.dictionary.translate("Flash player needed");var o=document.createElement("div");o.innerHTML=base.dictionary.translate("You need at least Flash player 9 installed.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>");var u=document.createElement("a");u.setAttribute("href","http://www.adobe.com/go/getflash"),u.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',a.appendChild(s),a.appendChild(o),a.appendChild(u),paella.messageBox.showError(a.innerHTML)}return $("#"+r.id)[0]},_deferredAction:function(t){var e=this;return new Promise(function(n,i){e.ready?n(t()):$(e.swfContainer).bind("paella:flashvideoready",function(){e._ready=!0,n(t())})})},_getQualityObject:function(t,e){return{index:t,res:e.res,src:e.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(t){return this.res.w*this.res.h-t.res.w*t.res.h}}},getVideoData:function(){var t=this,e=this;return new Promise(function(n,i){t._deferredAction(function(){var t={duration:e.flashVideo.duration(),currentTime:e.flashVideo.getCurrentTime(),volume:e.flashVideo.getVolume(),paused:e._paused,ended:e._ended,res:{w:e.flashVideo.getWidth(),h:e.flashVideo.getHeight()}};n(t)})})},setPosterFrame:function(t){if(null==this._posterFrame){this._posterFrame=t;var e=document.createElement("img");e.src=t,e.className="videoPosterFrameImage",e.alt="poster frame",this.domElement.appendChild(e),this._posterFrameElement=e}},setAutoplay:function(t){this._autoplay=t},load:function(){var t=this._stream.sources.rtmp;null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(t));var e=this._currentQuality<t.length?t[this._currentQuality]:null;if(e){if(function(t){return t.src&&"object"==$traceurRuntime.typeof(t.src)&&t.src.server&&t.src.stream}(e)){var n=!1;void 0===e.src.requiresSubscription&&paella.player.config.player.rtmpSettings?n=paella.player.config.player.rtmpSettings.requiresSubscription||!1:e.src.requiresSubscription&&(n=e.src.requiresSubscription);var i={};return this._autoplay&&(i.autoplay=this._autoplay),"true"==base.parameters.get("debug")&&(i.debugMode=!0),i.playerId=this.flashId,i.isLiveStream=void 0!==e.isLiveStream&&e.isLiveStream,i.server=e.src.server,i.stream=e.src.stream,i.subscribe=n,paella.player.config.player.rtmpSettings&&void 0!==paella.player.config.player.rtmpSettings.bufferTime&&(i.bufferTime=paella.player.config.player.rtmpSettings.bufferTime),this._flashVideo=this._createSwfObject("resources/deps/player_streaming.swf",i),$(this.swfContainer).trigger("paella:flashvideoready"),this._deferredAction(function(){return e})}return paella_DeferredRejected(new Error("Invalid video data"))}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},getQualities:function(){var t=this;return new Promise(function(e,n){setTimeout(function(){var n=[],i=t._stream.sources.rtmp,r=-1;i.forEach(function(e){r++,n.push(t._getQualityObject(r,e))}),e(n)},50)})},setQuality:function(t){var e=this;return t=void 0!==t&&null!==t?t:0,new Promise(function(n,i){var r=(e._paused,e._stream.sources.rtmp);if(e._currentQuality=t<r.length?t:0,r[t].isLiveStream)return n();e._currentTime;e.load().then(function(){n()})})},getCurrentQuality:function(){var t=this;return new Promise(function(e,n){e(t._getQualityObject(t._currentQuality,t._stream.sources.rtmp[t._currentQuality]))})},play:function(){var t=this;return this._deferredAction(function(){t._posterFrameElement&&(t._posterFrameElement.parentNode.removeChild(t._posterFrameElement),t._posterFrameElement=null),t._paused=!1,t.flashVideo.play()})},pause:function(){var t=this;return this._deferredAction(function(){t._paused=!0,t.flashVideo.pause()})},isPaused:function(){var t=this;return this._deferredAction(function(){return t._paused})},duration:function(){var t=this;return this._deferredAction(function(){return t.flashVideo.duration()})},setCurrentTime:function(t){var e=this;return this._deferredAction(function(){var n=e.flashVideo.duration();e.flashVideo.seekTo(100*t/n)})},currentTime:function(){var t=this;return this._deferredAction(function(){return t.flashVideo.getCurrentTime()})},setVolume:function(t){var e=this;return this._volume=t,this._deferredAction(function(){e.flashVideo.setVolume(t)})},volume:function(){var t=this;return this._deferredAction(function(){return t.flashVideo.getVolume()})},setPlaybackRate:function(t){var e=this;return this._deferredAction(function(){e._playbackRate=t})},playbackRate:function(){var t=this;return this._deferredAction(function(){return t._playbackRate})},goFullScreen:function(){return paella_DeferredNotImplemented()},unFreeze:function(){return this._deferredAction(function(){})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.RTMPVideoFactory",{isStreamCompatible:function(t){try{if(base.userAgent.system.iOS||base.userAgent.system.Android)return!1;for(var e in t.sources)if("rtmp"==e)return!0}catch(t){}return!1},getVideoObject:function(t,e,n){return new paella.RTMPVideo(t,e,n.x,n.y,n.w,n.h)}}),Class("paella.plugins.CaptionsSearchPlugIn",paella.SearchServicePlugIn,{getName:function(){return"es.upv.paella.search.captionsSearchPlugin"},search:function(t,e){paella.captions.search(t,e)}}),new paella.plugins.CaptionsSearchPlugIn,Class("paella.plugins.SearchPlugin",paella.ButtonPlugin,{_open:!1,_sortDefault:"time",_colorSearch:!1,_localImages:null,_searchTimer:null,_searchTimerTime:1500,_searchBody:null,getAlignment:function(){return"right"},getSubclass:function(){return"searchButton"},getMinWindowSize:function(){return 550},getName:function(){return"es.upv.paella.searchPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Search")},getIndex:function(){return 510},closeOnMouseOut:function(){return!0},checkEnabled:function(t){t(!0)},setup:function(){var t=this;$(".searchButton").click(function(e){t._open?t._open=!1:(t._open=!0,setTimeout(function(){$("#searchBarInput").focus()},0))}),t._localImages=paella.initDelegate.initParams.videoLoader.frameList,t._colorSearch=t.config.colorSearch||!1,t._sortDefault=t.config.sortType||"time",paella.events.bind(paella.events.controlBarWillHide,function(e){t._open&&paella.player.controls.cancelHideBar()})},prettyTime:function(t){var e=Math.floor(t/3600)%24;e=("00"+e).slice(e.toString().length);var n=Math.floor(t/60)%60;n=("00"+n).slice(n.toString().length);var i=Math.floor(t%60);return i=("00"+i).slice(i.toString().length),e+":"+n+":"+i},search:function(t,e){paella.searchService.search(t,e)},getPreviewImage:function(t){var e=this,n=Object.keys(e._localImages);n.push(t),n.sort(function(t,e){return parseInt(t)-parseInt(e)});var i=n.indexOf(t)-1;i=i>0?i:0;var r=n[i];return r=parseInt(r),e._localImages[r].url},createLoadingElement:function(t){var e=document.createElement("div");e.className="loader";e.innerHTML='<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve"><path fill="#000" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z"><animateTransform attributeType="xml"attributeName="transform"type="rotate"from="0 25 25"to="360 25 25"dur="0.6s"repeatCount="indefinite"/></path></svg>',t.appendChild(e);var n=document.createElement("p");n.className="sBodyText",n.innerHTML=base.dictionary.translate("Searching")+"...",t.appendChild(n)},createNotResultsFound:function(t){var e=document.createElement("div");e.className="noResults",e.innerHTML=base.dictionary.translate("Sorry! No results found."),t.appendChild(e)},doSearch:function(t,e){var n=this;$(e).empty(),n.createLoadingElement(e),n.search(t,function(t,i){if($(e).empty(),!t)if(0==i.length)n.createNotResultsFound(e);else for(var r=0;r<i.length;r++){"score"==n._sortDefault&&i.sort(function(t,e){return e.score-t.score}),"time"==n._sortDefault&&i.sort(function(t,e){return t.time-e.time});var a=document.createElement("div");a.className="sBodyInnerContainer",n._colorSearch&&(i[r].score<=.3&&$(a).addClass("redScore"),i[r].score>=.7&&$(a).addClass("greenScore"));var s=document.createElement("div");s.className="TimePicContainer";var o=document.createElement("img");o.className="sBodyPicture",o.src=n.getPreviewImage(i[r].time);var u=document.createElement("p");u.className="sBodyText",u.innerHTML="<span class='timeSpan'>"+n.prettyTime(i[r].time)+"</span>"+i[r].content,s.appendChild(o),a.appendChild(s),a.appendChild(u),e.appendChild(a),a.setAttribute("sec",i[r].time),$(a).hover(function(){$(this).css("background-color","#faa166")},function(){$(this).removeAttr("style")}),$(a).click(function(){var t=$(this).attr("sec");paella.player.videoContainer.seekToTime(t),paella.player.play()})}})},buildContent:function(t){var e=this,n=document.createElement("div")
;n.className="searchPluginContainer";var i=document.createElement("div");i.className="searchBody",n.appendChild(i),e._searchBody=i;var r=document.createElement("div");r.className="searchBar",n.appendChild(r);var a=document.createElement("input");a.className="searchBarInput",a.type="text",a.id="searchBarInput",a.name="searchString",a.placeholder=base.dictionary.translate("Search"),r.appendChild(a),$(a).change(function(){var t=$(a).val();null!=e._searchTimer&&e._searchTimer.cancel(),""!=t&&e.doSearch(t,i)}),$(a).keyup(function(t){if(13!=t.keyCode){var n=$(a).val();null!=e._searchTimer&&e._searchTimer.cancel(),""!=n?e._searchTimer=new base.Timer(function(t){e.doSearch(n,i)},e._searchTimerTime):$(e._searchBody).empty()}}),$(a).focus(function(){paella.keyManager.enabled=!1}),$(a).focusout(function(){paella.keyManager.enabled=!0}),t.appendChild(n)}}),paella.plugins.searchPlugin=new paella.plugins.SearchPlugin,Class("paella.plugins.SocialPlugin",paella.ButtonPlugin,{buttonItems:null,socialMedia:null,getAlignment:function(){return"right"},getSubclass:function(){return"showSocialPluginButton"},getIndex:function(){return 560},getMinWindowSize:function(){return 600},getName:function(){return"es.upv.paella.socialPlugin"},checkEnabled:function(t){t(!0)},getDefaultToolTip:function(){return base.dictionary.translate("Share this video")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buttons:[],selected_button:null,closeOnMouseOut:function(){return!0},initialize:function(){if(this.parent(),"es"==base.dictionary.currentLanguage()){var t={"Custom size:":"Tamaño personalizado:","Choose your embed size. Copy the text and paste it in your html page.":"Elija el tamaño del video a embeber. Copie el texto y péguelo en su página html.","Width:":"Ancho:","Height:":"Alto:"};base.dictionary.addDictionary(t)}},setup:function(){var t=this,e={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40};$(this.button).keyup(function(n){t.isPopUpOpen()&&(n.keyCode==e.Up?t.selected_button>0&&(t.selected_button<t.buttons.length&&(t.buttons[t.selected_button].className="socialItemButton "+t.buttons[t.selected_button].data.mediaData),t.selected_button--,t.buttons[t.selected_button].className=t.buttons[t.selected_button].className+" selected"):n.keyCode==e.Down?t.selected_button<t.buttons.length-1&&(t.selected_button>=0&&(t.buttons[t.selected_button].className="socialItemButton "+t.buttons[t.selected_button].data.mediaData),t.selected_button++,t.buttons[t.selected_button].className=t.buttons[t.selected_button].className+" selected"):n.keyCode==e.Return&&t.onItemClick(t.buttons[t.selected_button].data.mediaData))})},buildContent:function(t){var e=this;this.buttonItems={},this.socialMedia=["facebook","twitter","embed"],this.socialMedia.forEach(function(n){var i=e.getSocialMediaItemButton(n);e.buttonItems[e.socialMedia.indexOf(n)]=i,t.appendChild(i),e.buttons.push(i)}),this.selected_button=this.buttons.length},getSocialMediaItemButton:function(t){var e=document.createElement("div");return e.className="socialItemButton "+t,e.id=t+"_button",e.data={mediaData:t,plugin:this},$(e).click(function(t){this.data.plugin.onItemClick(this.data.mediaData)}),e},onItemClick:function(t){var e=this.getVideoUrl();switch(t){case"twitter":window.open("http://twitter.com/home?status="+e);break;case"facebook":window.open("http://www.facebook.com/sharer.php?u="+e);break;case"embed":this.embedPress()}paella.player.controls.hidePopUp(this.getName())},getVideoUrl:function(){return document.location.href},embedPress:function(){var t=document.location.protocol+"//"+document.location.host,e=document.location.pathname,n=e.split("/");n.length>0&&(n[n.length-1]="embed.html");var i=paella.initDelegate.getId(),r=t+n.join("/")+"?id="+i,a="<div style='display:inline-block;'>     <div class='embedSizeButton' style='width:110px; height:73px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 620x349 </span></div>    <div class='embedSizeButton' style='width:100px; height:65px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 540x304 </span></div>    <div class='embedSizeButton' style='width:90px;  height:58px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 460x259 </span></div>    <div class='embedSizeButton' style='width:80px;  height:50px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 380x214 </span></div>    <div class='embedSizeButton' style='width:70px;  height:42px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 300x169 </span></div></div><div style='display:inline-block; vertical-align:bottom; margin-left:10px;'>    <div>"+base.dictionary.translate("Custom size:")+"</div>    <div>"+base.dictionary.translate("Width:")+" <input id='social_embed_width-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div>    <div>"+base.dictionary.translate("Height:")+" <input id='social_embed_height-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div></div>",s="<div id='embedContent' style='text-align:left; font-size:14px; color:black;'><div id=''>"+a+"</div> <div id=''>"+base.dictionary.translate("Choose your embed size. Copy the text and paste it in your html page.")+"</div> <div id=''><textarea id='social_embed-textarea' class='social_embed-textarea' rows='4' cols='1' style='font-size:12px; width:95%; overflow:auto; margin-top:5px; color:black;'></textarea></div>  </div>";paella.messageBox.showMessage(s,{closeButton:!0,width:"750px",height:"210px",onClose:function(){}});var o=$("#social_embed_width-input")[0],u=$("#social_embed_height-input")[0];o.onkeyup=function(t){var e=parseInt(o.value),n=parseInt(u.value);isNaN(e)?o.value="":e<300?$("#social_embed-textarea")[0].value="Embed width too low. The minimum value is a width of 300.":(isNaN(n)&&(n=(e/(16/9)).toFixed(),u.value=n),$("#social_embed-textarea")[0].value='<iframe allowfullscreen src="'+r+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+e+'" height="'+n+'"></iframe>')};for(var l=$(".embedSizeButton"),c=0;c<l.length;c+=1){l[c].onclick=function(t){var e=t.target?t.target.textContent:t.toElement.textContent;if(e){var n=e.split("x");o.value=n[0],u.value=n[1],$("#social_embed-textarea")[0].value='<iframe allowfullscreen src="'+r+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+n[0]+'" height="'+n[1]+'"></iframe>'}}}}}),paella.plugins.socialPlugin=new paella.plugins.SocialPlugin;var MyTabBarExamplePlugin=Class.create(paella.TabBarPlugin,{getSubclass:function(){return"test"},getTabName:function(){return"TabBar Example"},getName:function(){return"es.upv.paella.test.tabBarExamplePlugin"},buildContent:function(t){t.innerHTML="<p>This is a Paella Extended tab bar plugin</p>"}});new MyTabBarExamplePlugin,Class("paella.plugins.VideoLoadTestPlugin",paella.EventDrivenPlugin,{startTime:0,endTime:0,initialize:function(){if(this.parent(),this.startTime=Date.now(),"es"==base.dictionary.currentLanguage()){var t={"Video loaded in {0} seconds":"Video cargado en {0} segundos"};base.dictionary.addDictionary(t)}},getName:function(){return"es.upv.paella.test.videoLoadPlugin"},checkEnabled:function(t){t(!0)},getEvents:function(){return[paella.events.loadComplete]},onEvent:function(t,e){switch(t){case paella.events.loadComplete:this.onLoadComplete()}},onLoadComplete:function(){this.endTime=Date.now();var t=(this.endTime-this.startTime)/1e3;this.showOverlayMessage(base.dictionary.translate("Video loaded in {0} seconds").replace(/\{0\}/g,t))},showOverlayMessage:function(t){var e=paella.player.videoContainer.overlayContainer,n={left:40,top:50,width:430,height:80},i=document.createElement("div");i.className="videoLoadTestOverlay";var r=document.createElement("div");r.className="btn",r.innerHTML="X",r.onclick=function(){e.removeElement(i)};var a=document.createElement("div");a.className="videoLoadTest",a.innerHTML=t,a.appendChild(r),i.appendChild(a),e.addElement(i,n)}}),paella.plugins.videoLoadTestPlugin=new paella.plugins.VideoLoadTestPlugin,Class("paella.plugins.ThemeChooserPlugin",paella.ButtonPlugin,{currentUrl:null,currentMaster:null,currentSlave:null,availableMasters:[],availableSlaves:[],getAlignment:function(){return"right"},getSubclass:function(){return"themeChooserPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 600},getName:function(){return"es.upv.paella.themeChooserPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Change theme")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},checkEnabled:function(t){t(paella.player.config.skin&&paella.player.config.skin.available&&paella.player.config.skin.available instanceof Array&&paella.player.config.skin.available.length>0?!0:!1)},buildContent:function(t){var e=this;paella.player.config.skin.available.forEach(function(n){var i=document.createElement("div");i.className="themebutton",i.innerHTML=n.replace("-"," ").replace("_"," "),$(i).click(function(t){paella.utils.skin.set(n),paella.player.controls.hidePopUp(e.getName())}),t.appendChild(i)})}}),paella.plugins.themeChooserPlugin=new paella.plugins.ThemeChooserPlugin,paella.plugins.translectures={},Class("paella.captions.translectures.Caption",paella.captions.Caption,{initialize:function(t,e,n,i,r,a){this.parent(t,e,n,i,a),this._captionsProvider="translecturesCaptionsProvider",this._editURL=r},canEdit:function(t){t(!1,void 0!=this._editURL&&""!=this._editURL)},goToEdit:function(){var t=this;paella.player.auth.userData().then(function(e){1==e.isAnonymous?t.askForAnonymousOrLoginEdit():t.doEdit()})},doEdit:function(){window.location.href=this._editURL},doLoginAndEdit:function(){paella.player.auth.login(this._editURL)},askForAnonymousOrLoginEdit:function(){var t=this,e=document.createElement("div");e.className="translecturesCaptionsMessageBox";var n=document.createElement("div");n.className="title",n.innerHTML=base.dictionary.translate("You are trying to modify the transcriptions, but you are not Logged in!"),e.appendChild(n);var i=document.createElement("div");i.className="authMethodsContainer",e.appendChild(i);var r=document.createElement("div");r.className="authMethod",i.appendChild(r);var a=document.createElement("a");a.href="#",a.style.color="#004488",r.appendChild(a);var s=document.createElement("img");s.src="resources/style/caption_mlangs_anonymous.png",s.alt="Anonymous",s.style.height="100px",a.appendChild(s);var o=document.createElement("p");o.innerHTML=base.dictionary.translate("Continue editing the transcriptions anonymously"),a.appendChild(o),$(a).click(function(){t.doEdit()}),r=document.createElement("div"),r.className="authMethod",i.appendChild(r),a=document.createElement("a"),a.href="#",a.style.color="#004488",r.appendChild(a),s=document.createElement("img"),s.src="resources/style/caption_mlangs_lock.png",s.alt="Login",s.style.height="100px",a.appendChild(s),o=document.createElement("p"),o.innerHTML=base.dictionary.translate("Log in and edit the transcriptions"),a.appendChild(o),$(a).click(function(){t.doLoginAndEdit()}),paella.messageBox.showElement(e)}}),Class("paella.plugins.translectures.CaptionsPlugIn",paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.translecture.captionsPlugin"},getEvents:function(){return[]},onEvent:function(t,e){},checkEnabled:function(t){var e=this,n=paella.player.videoIdentifier;if(void 0==this.config.tLServer||void 0==this.config.tLdb)base.log.warning(this.getName()+" plugin not configured!"),t(!1);else{var i=(this.config.tLServer+"/langs?db=${tLdb}&id=${videoId}").replace(/\$\{videoId\}/gi,n).replace(/\$\{tLdb\}/gi,this.config.tLdb);base.ajax.get({url:i},function(r,a,s,o){0==r.scode?(r.langs.forEach(function(t){var i,r=(e.config.tLServer+"/dfxp?format=1&pol=0&db=${tLdb}&id=${videoId}&lang=${tl.lang.code}").replace(/\$\{videoId\}/gi,n).replace(/\$\{tLdb\}/gi,e.config.tLdb).replace(/\$\{tl.lang.code\}/gi,t.code);e.config.tLEdit&&(i=e.config.tLEdit.replace(/\$\{videoId\}/gi,n).replace(/\$\{tLdb\}/gi,e.config.tLdb).replace(/\$\{tl.lang.code\}/gi,t.code));var a=t.value;switch(t.type){case 0:a+=" ("+paella.dictionary.translate("Auto")+")";break;case 1:a+=" ("+paella.dictionary.translate("Under review")+")"}var s=new paella.captions.translectures.Caption(t.code,"dfxp",r,{code:t.code,txt:a},i);paella.captions.addCaptions(s)}),t(!1)):(base.log.debug("Error getting available captions from translectures: "+i),t(!1))},function(e,n,r){base.log.debug("Error getting available captions from translectures: "+i),t(!1)})}}}),new paella.plugins.translectures.CaptionsPlugIn,new(Class(paella.userTracking.SaverPlugIn,{type:"userTrackingSaverPlugIn",getName:function(){return"es.upv.paella.usertracking.elasticsearchSaverPlugin"},checkEnabled:function(t){this._url=this.config.url,this._index=this.config.index||"paellaplayer",this._type=this.config.type||"usertracking";var e=!0;void 0==this._url&&(e=!1,base.log.debug("No ElasticSearch URL found in config file. Disabling ElasticSearch PlugIn")),t(e)},log:function(t,e){var n=e;"object"!=$traceurRuntime.typeof(n)&&(n={value:n}),paella.player.videoContainer.currentTime().then(function(e){var i={date:new Date,video:paella.initDelegate.getId(),playing:!paella.player.videoContainer.paused(),time:parseInt(e+paella.player.videoContainer.trimStart()),event:t,params:n};paella.ajax.post({url:this._url+"/"+this._index+"/"+this._type+"/",params:JSON.stringify(i)})})}})),new(Class(paella.userTracking.SaverPlugIn,{getName:function(){return"es.upv.paella.usertracking.GoogleAnalyticsSaverPlugin"},checkEnabled:function(t){var e=this.config.trackingID,n=this.config.domain||"auto";e?(base.log.debug("Google Analitycs Enabled"),function(t,e,n,i,r,a,s){t.GoogleAnalyticsObject=r,t[r]=t[r]||function(){(t[r].q=t[r].q||[]).push(arguments)},t[r].l=1*new Date,a=e.createElement(n),s=e.getElementsByTagName(n)[0],a.async=1,a.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(a,s)}(window,document,"script",0,"__gaTracker"),__gaTracker("create",e,n),__gaTracker("send","pageview"),t(!0)):(base.log.debug("No Google Tracking ID found in config file. Disabling Google Analitycs PlugIn"),t(!1))},log:function(t,e){if(void 0===this.config.category||!0===this.config.category){var n=this.config.category||"PaellaPlayer",i=t,r="";try{r=JSON.stringify(e)}catch(t){}__gaTracker("send","event",n,i,r)}}}));var bg={};bg.utils={},Reflect.defineProperty=Reflect.defineProperty||Object.defineProperty,function(t){t.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}(),bg.utils.initWebGLContext=function(t){var e={gl:null,supported:!1,experimental:!1};try{e.gl=t.getContext("webgl",{preserveDrawingBuffer:!0}),e.supported=null!=e.gl}catch(t){e.supported=!1}if(!e.supported)try{e.gl=t.getContext("experimental-webgl",{preserveDrawingBuffer:!0}),e.supported=null!=e.gl,e.experimental=!0}catch(t){}return e&&(e.gl.uuid=Symbol(e.gl)),e},bg.utils.isBigEndian=function(){var t=new Uint32Array(1);new Uint8Array(t.buffer);return t[0]=255,255==t[3]},bg.utils.isLittleEndian=function(){var t=new Uint32Array(1);new Uint8Array(t.buffer);return t[0]=255,255==t[0]};var e=function(){function t(t){this.system={},this.browser={},t||(t=navigator.userAgent),this.parseOperatingSystem(t),this.parseBrowser(t)}return $traceurRuntime.createClass(t,{parseOperatingSystem:function(t){this.system.OSX=/Macintosh/.test(t),this.system.Windows=/Windows/.test(t),this.system.iPhone=/iPhone/.test(t),this.system.iPodTouch=/iPod/.test(t),this.system.iPad=/iPad/.test(t),this.system.iOS=this.system.iPhone||this.system.iPad||this.system.iPodTouch,this.system.Android=/Android/.test(t),this.system.Linux=!this.system.Android&&/Linux/.test(t),this.system.OSX?(this.system.OSName="OS X",this.parseOSXVersion(t)):this.system.Windows?(this.system.OSName="Windows",this.parseWindowsVersion(t)):this.system.Linux?(this.system.OSName="Linux",this.parseLinuxVersion(t)):this.system.iOS?(this.system.OSName="iOS",this.parseIOSVersion(t)):this.system.Android&&(this.system.OSName="Android",this.parseAndroidVersion(t))},parseBrowser:function(t){if(this.browser.Version={},this.browser.Safari=/Version\/([\d\.]+) Safari\//.test(t),this.browser.Safari&&(this.browser.Name="Safari",this.browser.Vendor="Apple",this.browser.Version.versionString=RegExp.$1),this.browser.Chrome=/Chrome\/([\d\.]+) Safari\//.test(t),this.browser.Chrome&&(this.browser.Name="Chrome",this.browser.Vendor="Google",this.browser.Version.versionString=RegExp.$1),this.browser.Opera=/Opera\/[\d\.]+/.test(t),this.browser.Opera){this.browser.Name="Opera",this.browser.Vendor="Opera Software";/Version\/([\d\.]+)/.test(t);this.browser.Version.versionString=RegExp.$1}if(this.browser.Firefox=/Gecko\/[\d\.]+ Firefox\/([\d\.]+)/.test(t),this.browser.Firefox&&(this.browser.Name="Firefox",this.browser.Vendor="Mozilla Foundation",this.browser.Version.versionString=RegExp.$1),this.browser.Edge=/Edge\/(.*)/.test(t),this.browser.Edge){var e=/Edge\/(.*)/.exec(t);this.browser.Name="Edge",this.browser.Chrome=!1,this.browser.Vendor="Microsoft",this.browser.Version.versionString=e[1]}if(this.browser.Explorer=/MSIE ([\d\.]+)/.test(t),this.browser.Explorer)this.browser.Name="Internet Explorer",this.browser.Vendor="Microsoft",this.browser.Version.versionString=RegExp.$1;else{var n=/\Mozilla\/5.0 \(([^)]+)\) like Gecko/,i=n.exec(t);if(i){n=/rv:(.*)/;var r=n.exec(i[1]);this.browser.Explorer=!0,this.browser.Name="Internet Explorer",this.browser.Vendor="Microsoft",this.browser.Version.versionString=r?r[1]:"unknown"}}this.system.iOS?(this.browser.IsMobileVersion=!0,this.browser.MobileSafari=/Version\/([\d\.]+) Mobile/.test(t),this.browser.MobileSafari&&(this.browser.Name="Mobile Safari",this.browser.Vendor="Apple",this.browser.Version.versionString=RegExp.$1),this.browser.Android=!1):this.system.Android?(this.browser.IsMobileVersion=!0,this.browser.Android=/Version\/([\d\.]+) Mobile/.test(t),this.browser.MobileSafari?(this.browser.Name="Android Browser",this.browser.Vendor="Google",this.browser.Version.versionString=RegExp.$1):(this.browser.Chrome=/Chrome\/([\d\.]+)/.test(t),this.browser.Name="Chrome",this.browser.Vendor="Google",this.browser.Version.versionString=RegExp.$1),this.browser.Safari=!1):this.browser.IsMobileVersion=!1,this.parseBrowserVersion(t)},parseBrowserVersion:function(t){/([\d]+)\.([\d]+)\.*([\d]*)/.test(this.browser.Version.versionString)&&(this.browser.Version.major=Number(RegExp.$1),this.browser.Version.minor=Number(RegExp.$2),this.browser.Version.revision=RegExp.$3?Number(RegExp.$3):0)},parseOSXVersion:function(t){var e=/Mac OS X (\d+_\d+_*\d*)/.test(t)?RegExp.$1:"";switch(this.system.Version={},""!=e?/(\d+)_(\d+)_*(\d*)/.test(e)&&(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0):(e=/Mac OS X (\d+\.\d+\.*\d*)/.test(t)?RegExp.$1:"Unknown",/(\d+)\.(\d+)\.*(\d*)/.test(e)&&(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0)),this.system.Version.major||(this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.revision=0),this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision,this.system.Version.minor){case 0:this.system.Version.name="Cheetah";break;case 1:this.system.Version.name="Puma";break;case 2:this.system.Version.name="Jaguar";break;case 3:this.system.Version.name="Panther";break;case 4:this.system.Version.name="Tiger";break;case 5:this.system.Version.name="Leopard";break;case 6:this.system.Version.name="Snow Leopard";break;case 7:this.system.Version.name="Lion";break;case 8:this.system.Version.name="Mountain Lion"}},parseWindowsVersion:function(t){if(this.system.Version={},/NT (\d+)\.(\d*)/.test(t)){this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=0,this.system.Version.stringValue="NT "+this.system.Version.major+"."+this.system.Version.minor;var e=this.system.Version.major,n=this.system.Version.minor;5==e?this.system.Version.name=0==n?"2000":"XP":6==e&&(0==n?this.system.Version.name="Vista":1==n?this.system.Version.name="7":2==n&&(this.system.Version.name="8"))}else this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.name="Unknown",this.system.Version.stringValue="Unknown"},parseLinuxVersion:function(t){this.system.Version={},this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.revision=0,this.system.Version.name="",this.system.Version.stringValue="Unknown distribution"},parseIOSVersion:function(t){this.system.Version={},/iPhone OS (\d+)_(\d+)_*(\d*)/i.test(t)?(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0,this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision,this.system.Version.name="iOS"):(this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.name="Unknown",this.system.Version.stringValue="Unknown")},parseAndroidVersion:function(t){this.system.Version={},/Android (\d+)\.(\d+)\.*(\d*)/.test(t)?(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0,this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision):(this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.revision=0),/Build\/([a-zA-Z]+)/.test(t)?this.system.Version.name=RegExp.$1:this.system.Version.name="Unknown version",this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision},getInfoString:function(){return navigator.userAgent}},{})}();bg.utils.UserAgent=e,bg.utils.userAgent=new e}(window),function(){function t(t,e,n){var i=new XMLHttpRequest;return i.open("GET",t,!0),i.addEventListener("load",function(){200===i.status?e(i):n(new Error("Error receiving data: "+i.status+", url: "+t))},!1),i.addEventListener("error",function(){n(new Error("Cannot make AJAX request. Url: "+t))},!1),i}var e=[],n=[],i=function(){function i(){}return $traceurRuntime.createClass(i,{},{GetExtension:function(t){var e=/\.([a-z0-9-_]*)$/i.exec(t);return e&&e[1].toLowerCase()||""},IsFormat:function(t,e){return null!=e.find(function(t){return t==this},i.GetExtension(t))},IsImage:function(t){return i.IsFormat(t,["jpg","jpeg","gif","png"])},IsBinary:function(t){var e=void 0!==arguments[1]?arguments[1]:["vwglb"];return i.IsFormat(t,e)},IsVideo:function(t){var e=void 0!==arguments[1]?arguments[1]:["mp4","m4v","ogg","ogv","m3u8","webm"];return i.IsFormat(t,e)},LoadMultiple:function(t){var e=[];return t.forEach(function(t){e.push(i.Load(t))}),Promise.all(e).then(function(e){var n={};return t.forEach(function(t,i){n[t]=e[i]}),n})},Load:function(t){var e=null;switch(!0){case t.constructor===Array:e=i.LoadMultiple;break;case i.IsImage(t):e=i.LoadImage;break;case i.IsBinary(t):e=i.LoadBinary;break;case i.IsVideo(t):e=i.LoadVideo;break;case"json"==i.GetExtension(t):e=i.LoadJson;break;default:e=i.LoadText}return e(t)},LoadText:function(e){return new Promise(function(n,i){t(e,function(t){n(t.responseText)},function(t){i(t)}).send()})},LoadVideo:function(t){return new Promise(function(e,i){var r=document.createElement("video");n.push(r),r.crossOrigin="",r.autoplay=!0,r.setAttribute("playsinline",null),r.addEventListener("canplay",function(t){var i=n.indexOf(t.target);-1!=i&&n.splice(i,1),e(event.target),bg.emitImageLoadEvent(event.target)}),r.addEventListener("error",function(e){i(new Error("Error loading video: "+t))}),r.addEventListener("abort",function(e){i(new Error("Error loading video: "+t))}),r.src=t})},LoadBinary:function(e){return new Promise(function(n,i){var r=t(e,function(t){n(t.response)},function(t){i(t)});r.responseType="arraybuffer",r.send()})},LoadImage:function(t){return new Promise(function(n,i){var r=new Image;e.push(r),r.crossOrigin="",r.addEventListener("load",function(t){var i=e.indexOf(t.target);-1!=i&&e.splice(i,1),n(t.target),bg.emitImageLoadEvent(t.target)}),r.addEventListener("error",function(e){i(new Error("Error loading image: "+t))}),r.addEventListener("abort",function(e){i(new Error("Image load aborted: "+t))}),r.src=t})},LoadJson:function(e){return new Promise(function(n,i){t(e,function(t){try{n(JSON.parse(t.responseText))}catch(t){i(new Error("Error parsing JSON data"))}},function(t){i(t)}).send()})}})}();bg.utils.Resource=i}(),function(){var t=null,e=function(){function e(){}return $traceurRuntime.createClass(e,{get id(){return this._engineId},get texture(){return this._texture},get pipeline(){return this._pipeline},get polyList(){return this._polyList},get shader(){return this._shader},get colorBuffer(){return this._colorBuffer},get textureBuffer(){return this._textureBuffer},get shaderSource(){return this._shaderSource}},{Set:function(e){t=e},Get:function(){return t}})}();bg.Engine=e}(),function(){var t=function(){function t(){}return $traceurRuntime.createClass(t,{init:function(){},frame:function(t){},willDisplay:function(t,e){},display:function(t,e){},didDisplay:function(t,e){},reshape:function(t,e,n,i){},keyDown:function(t){},keyUp:function(t){},mouseUp:function(t){},mouseDown:function(t){},mouseMove:function(t){},mouseOut:function(t){},mouseDrag:function(t){},mouseWheel:function(t){},touchStart:function(t){},touchMove:function(t){},touchEnd:function(t){}},{})}();bg.LifeCycle=t}(),bg.app={},function(){var t=function(){function t(t){var e=this;if(this._domElem=t,this._domElem.style.MozUserSelect="none",this._domElem.style.WebkitUserSelect="none",this._domElem.setAttribute("onselectstart","return false"),!function(){return e._context=bg.utils.initWebGLContext(t),e._context.supported}())throw new Error("Sorry, your browser does not support WebGL.")}return $traceurRuntime.createClass(t,{get context(){return this._context},get domElement(){return this._domElem},get width(){return this._domElem.clientWidth},get height(){return this._domElem.clientHeight},screenshot:function(t,e,n){var i="",r={};e&&(n=n||e,i=this.domElement.style.cssText,r.width=this.domElement.width,r.height=this.domElement.height,this.domElement.style.cssText="top:auto;left:auto;bottom:auto;right:auto;width:"+e+"px;height:"+n+"px;",this.domElement.width=e,this.domElement.height=n,bg.app.MainLoop.singleton.windowController.reshape(e,n),bg.app.MainLoop.singleton.windowController.postRedisplay(),bg.app.MainLoop.singleton.windowController.display());var a=this.domElement.toDataURL(t);return e&&(this.domElement.style.cssText=i,this.domElement.width=r.width,this.domElement.height=r.height,bg.app.MainLoop.singleton.windowController.reshape(r.width,r.height),bg.app.MainLoop.singleton.windowController.postRedisplay(),bg.app.MainLoop.singleton.windowController.display()),a}},{})}();bg.app.Canvas=t;var e=function(){function t(t){this._context=t}return $traceurRuntime.createClass(t,{get context(){return this._context},set context(t){this._context=t}},{})}();bg.app.ContextObject=e}(),function(){bg.app.SpecialKey={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,PAGE_UP:33,PAGEDOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46};var t=function(){function t(t){this.key=t}return $traceurRuntime.createClass(t,{isSpecialKey:function(){return t.IsSpecialKey(this.key)}},{IsSpecialKey:function(t){Object.keys(bg.app.SpecialKey).some(function(e){return bg.app.SpecialKey[e]==t})}})}();bg.app.KeyboardEvent=t,bg.app.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2,NONE:-1};var e=function(){function t(){var t=void 0!==arguments[0]?arguments[0]:bg.app.MouseButton.NONE,e=void 0!==arguments[1]?arguments[1]:-1,n=void 0!==arguments[2]?arguments[2]:-1,i=void 0!==arguments[3]?arguments[3]:0;this.button=t,this.x=e,this.y=n,this.delta=i}return $traceurRuntime.createClass(t,{},{})}();bg.app.MouseEvent=e;var n=function(){function t(t){this.touches=t}return $traceurRuntime.createClass(t,{},{})}();bg.app.TouchEvent=n}(),function(){function t(){requestAnimFrame(t),i()}function e(){if(n(),window.addEventListener("resize",function(t){n()}),!p.canvas)throw new Error("Configuration error in MainLoop: no canvas defined");var t=p.canvas.domElement;t.addEventListener("mousedown",function(t){return r(t),t.preventDefault(),!1}),t.addEventListener("mousemove",function(t){return a(t),t.preventDefault(),!1}),t.addEventListener("mouseout",function(t){return s(),t.preventDefault(),!1}),t.addEventListener("mouseover",function(t){return o(t),t.preventDefault(),!1}),t.addEventListener("mouseup",function(t){return u(t),t.preventDefault(),!1}),t.addEventListener("touchstart",function(t){return h(t),t.preventDefault(),!1}),t.addEventListener("touchmove",function(t){return f(t),t.preventDefault(),!1}),t.addEventListener("touchend",function(t){return d(t),t.preventDefault(),!1});var e=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";t.addEventListener(e,function(t){return l(t),t.preventDefault(),!1}),window.addEventListener("keydown",function(t){g(t)}),window.addEventListener("keyup",function(t){m(t)}),t.oncontextmenu=function(t){return!1}}function n(){p.canvas&&p.windowController&&(p.canvas.domElement.width=p.canvas.width,p.canvas.domElement.height=p.canvas.height,p.windowController.reshape(p.canvas.width,p.canvas.height))}function i(){p.redisplay&&(-1==_&&(_=Date.now()),p.windowController.frame(Date.now()-_),p.windowController.display(),_=Date.now(),p._redisplay=p.updateMode==bg.app.FrameUpdate.AUTO)}function r(t){var e=p.canvas.domElement.getBoundingClientRect();switch(b.pos.x=t.clientX-e.left,b.pos.y=t.clientY-e.top,t.button){case bg.app.MouseButton.LEFT:b.leftButton=!0;break;case bg.app.MouseButton.MIDDLE:b.middleButton=!0;break;case bg.app.MouseButton.RIGHT:b.rightButton=!0}p.windowController.mouseDown(new bg.app.MouseEvent(t.button,b.pos.x,b.pos.y))}function a(t){var e=p.canvas.domElement.getBoundingClientRect();b.pos.x=t.clientX-e.left,b.pos.y=t.clientY-e.top;var n=new bg.app.MouseEvent(bg.app.MouseButton.NONE,b.pos.x,b.pos.y);p.windowController.mouseMove(n),b.anyButton&&p.windowController.mouseDrag(n)}function s(){p.windowController.mouseOut(new bg.app.MouseEvent(bg.app.MouseButton.NONE,b.pos.x,b.pos.y)),b.leftButton&&(b.leftButton=!1,p.windowController.mouseUp(new bg.app.MouseEvent(bg.app.MouseButton.LEFT,b.pos.x,b.pos.y))),b.middleButton&&(b.middleButton=!1,p.windowController.mouseUp(new bg.app.MouseEvent(bg.app.MouseButton.MIDDLE,b.pos.x,b.pos.y))),b.rightButton&&(p.windowController.mouseUp(new bg.app.MouseEvent(bg.app.MouseButton.RIGHT,b.pos.x,b.pos.y)),b.rightButton=!1)}function o(t){a(t)}function u(t){switch(t.button){case bg.app.MouseButton.LEFT:b.leftButton=!1;break;case bg.app.MouseButton.MIDDLE:b.middleButton=!1;break;case bg.app.MouseButton.RIGHT:b.rightButton=!1}var e=p.canvas.domElement.getBoundingClientRect();b.pos.x=t.clientX-e.left,b.pos.y=t.clientY-e.top,p.windowController.mouseUp(new bg.app.MouseEvent(t.button,b.pos.x,b.pos.y))}function l(t){var e=p.canvas.domElement.getBoundingClientRect();b.pos.x=t.clientX-e.left,b.pos.y=t.clientY-e.top;var n=t.wheelDelta?-1*t.wheelDelta:10*t.detail
;p.windowController.mouseWheel(new bg.app.MouseEvent(bg.app.MouseButton.NONE,b.pos.x,b.pos.y,n))}function c(t){for(var e=p.canvas.domElement.getBoundingClientRect(),n=[],i=0;i<t.touches.length;++i){var r=t.touches[i];n.push({identifier:r.identifier,x:r.clientX-e.left,y:r.clientY-e.top,force:r.force,rotationAngle:r.rotationAngle,radiusX:r.radiusX,radiusY:r.radiusY})}return new bg.app.TouchEvent(n)}function h(t){p.windowController.touchStart(c(t))}function f(t){p.windowController.touchMove(c(t))}function d(t){p.windowController.touchEnd(c(t))}function g(t){var e=bg.app.KeyboardEvent.IsSpecialKey(t.keyCode)?t.keyCode:String.fromCharCode(t.keyCode);p.windowController.keyDown(new bg.app.KeyboardEvent(e))}function m(t){var e=bg.app.KeyboardEvent.IsSpecialKey(t.keyCode)?t.keyCode:String.fromCharCode(t.keyCode);p.windowController.keyUp(new bg.app.KeyboardEvent(e))}var p=null,b={leftButton:!1,middleButton:!1,rightButton:!1,pos:{x:-1,y:-1}};Object.defineProperty(b,"anyButton",{get:function(){return this.leftButton||this.middleButton||this.rightButton}});var _=-1,v=function(){function t(){}return $traceurRuntime.createClass(t,{},{LeftButton:function(){return b.leftButton},MiddleButton:function(){return b.middleButton},RightButton:function(){return b.rightButton},Position:function(){return b.pos}})}();bg.app.Mouse=v,bg.app.FrameUpdate={AUTO:0,MANUAL:1};var y=function(){function i(){this._canvas=null,this._windowController=null,this._updateMode=bg.app.FrameUpdate.AUTO,this._redisplay=!0}return $traceurRuntime.createClass(i,{get canvas(){return this._canvas},set canvas(t){this._canvas=new bg.app.Canvas(t)},get windowController(){return this._windowController},get updateMode(){return this._updateMode},set updateMode(t){this._updateMode=t,this._updateMode==bg.app.FrameUpdate.AUTO&&(this._redisplay=!0)},get redisplay(){return this._redisplay},get mouseButtonStatus(){return b},run:function(n){this._windowController=n,this.postRedisplay(),this.windowController.init(),e(),t()},postRedisplay:function(){this._redisplay=!0},postReshape:function(){n()}},{})}();bg.app.MainLoop={},Object.defineProperty(bg.app.MainLoop,"singleton",{get:function(){return p||(p=new y),p}})}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{postRedisplay:function(){bg.app.MainLoop.singleton.postRedisplay()},postReshape:function(){bg.app.MainLoop.singleton.postReshape()},get canvas(){return bg.app.MainLoop.singleton.canvas},get context(){return bg.app.MainLoop.singleton.canvas.context},get gl(){return bg.app.MainLoop.singleton.canvas.context.gl}},{},t)}(bg.LifeCycle);bg.app.WindowController=t}(),bg.base={},bg.s_log=[],bg.log=function(t){console.log&&console.log(t),bg.s_log.push(t)},bg.flushLog=function(){console.log&&bg.s_log.forEach(function(t){console.log(t)}),bg.s_log=[]},bg.emitImageLoadEvent=function(t){var e=new CustomEvent("bg2e:image-load",{image:t});document.dispatchEvent(e)},bg.bindImageLoadEvent=function(t){document.addEventListener("bg2e:image-load",t)},bg.Axis={NONE:0,X:1,Y:2,Z:3},function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._shader=null,this._inputVars=[]}return $traceurRuntime.createClass(e,{get inputVars(){return this._inputVars},get shader(){return this._shader},setupShaderSource:function(t){var e=this;this._shader=new bg.base.Shader(this.context),this._inputVars=[];var n=[],i=[];t.forEach(function(t){t.params.forEach(function(t){t&&("buffer"==t.role?(e._inputVars[t.target]=t.name,n.push(t.name)):"value"==t.role&&i.push(t.name))}),e._shader.addShaderSource(t.type,t.toString())}),this._shader.link(),this._shader.status?this._shader.initVars(n,i):(bg.log(this._shader.compileError),this._shader.compileErrorSource&&(bg.log("Shader source:"),bg.log(this._shader.compileErrorSource)),bg.log(this._shader.linkError))},beginDraw:function(){},setupVars:function(){},setActive:function(){this.shader.setActive(),this.beginDraw()},clearActive:function(){this.shader.clearActive()},bindPolyList:function(t){var e=this.shader;this.inputVars.vertex&&e.setInputBuffer(this.inputVars.vertex,t.vertexBuffer,3),this.inputVars.normal&&e.setInputBuffer(this.inputVars.normal,t.normalBuffer,3),this.inputVars.tex0&&e.setInputBuffer(this.inputVars.tex0,t.texCoord0Buffer,2),this.inputVars.tex1&&e.setInputBuffer(this.inputVars.tex1,t.texCoord1Buffer,2),this.inputVars.tex2&&e.setInputBuffer(this.inputVars.tex2,t.texCoord2Buffer,2),this.inputVars.color&&e.setInputBuffer(this.inputVars.color,t.colorBuffer,4),this.inputVars.tangent&&e.setInputBuffer(this.inputVars.tangent,t.tangentBuffer,3),this.setupVars()},unbind:function(){var t=this.shader;this.inputVars.vertex&&t.disableInputBuffer(this.inputVars.vertex),this.inputVars.normal&&t.disableInputBuffer(this.inputVars.normal),this.inputVars.tex0&&t.disableInputBuffer(this.inputVars.tex0),this.inputVars.tex1&&t.disableInputBuffer(this.inputVars.tex1),this.inputVars.tex2&&t.disableInputBuffer(this.inputVars.tex2),this.inputVars.color&&t.disableInputBuffer(this.inputVars.color),this.inputVars.tangent&&t.disableInputBuffer(this.inputVars.tangent)}},{},t)}(bg.app.ContextObject);bg.base.Effect=e;var n=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._frame=new bg.base.PolyList(t),this._frame.vertex=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],this._frame.texCoord0=[1,1,0,1,0,0,1,0],this._frame.index=[0,1,2,2,3,0],this._frame.build(),this.rebuildShaders()}return $traceurRuntime.createClass(n,{rebuildShaders:function(){this.setupShaderSource([this.vertexShaderSource,this.fragmentShaderSource])},get vertexShaderSource(){return this._vertexShaderSource||(this._vertexShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),this._vertexShaderSource.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,{name:"fsTexCoord",dataType:"vec2",role:"out"}]),"webgl1"==bg.Engine.Get().id&&this._vertexShaderSource.setMainBody("\n\t\t\t\t\tgl_Position = vec4(inVertex,1.0);\n\t\t\t\t\tfsTexCoord = inTex0;")),this._vertexShaderSource},get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter({name:"fsTexCoord",dataType:"vec2",role:"in"}),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tgl_FragColor = vec4(1.0,0.0,0.0,1.0);")),this._fragmentShaderSource},drawSurface:function(t){this.setActive(),this._surface=t,this.bindPolyList(this._frame),this._frame.draw(),this.unbind(),this.clearActive()}},{},e)}(e);bg.base.TextureEffect=n}(),function(){var t=function(){function t(){}return $traceurRuntime.createClass(t,{acceptType:function(t,e){return!1},load:function(t,e,n){return new Promise(function(t,e){e(new Error("Not implemented"))})}},{})}();bg.base.LoaderPlugin=t;var e=[],n=function(){function t(){}return $traceurRuntime.createClass(t,{},{RegisterPlugin:function(t){e.push(t)},Load:function(e,n){return new Promise(function(i,r){bg.utils.Resource.Load(n).then(function(i){return t.LoadData(e,n,i)}).then(function(t){i(t)}).catch(function(t){r(t)})})},LoadData:function(t,n,i){return new Promise(function(r,a){var s=null;if(e.some(function(t){if(t.acceptType(n,i))return s=t,!0}),!s)return a(new Error("No suitable plugin found for load "+n));r(s.load(t,n,i))})}})}();bg.base.Loader=n}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e);var i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT);i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,{name:"fsTexCoord",dataType:"vec2",role:"out"}]),r.addParameter([t().inputs.material.texture,{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&(i.setMainBody("\n\t\t\t\tgl_Position = vec4(inVertex,1.0);\n\t\t\t\tfsTexCoord = inTex0;"),r.setMainBody("gl_FragColor = texture2D(inTexture,fsTexCoord);")),this.setupShaderSource([i,r])}return $traceurRuntime.createClass(n,{setupVars:function(){var t=null;this._surface instanceof bg.base.Texture?t=this._surface:this._surface instanceof bg.base.RenderSurface&&(t=this._surface.getTexture(0)),t&&this.shader.setTexture("inTexture",t,bg.base.TextureUnit.TEXTURE_0)}},{},e)}(bg.base.TextureEffect);bg.base.DrawTextureEffect=e}(),function(){function t(){return bg.base.ShaderLibrary.Get()}function e(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.normal,t().inputs.buffers.tangent,t().inputs.buffers.tex0,t().inputs.buffers.tex1]),i.addParameter(t().inputs.matrix.all),i.addParameter([{name:"inLightProjectionMatrix",dataType:"mat4",role:"value"},{name:"inLightViewMatrix",dataType:"mat4",role:"value"}]),i.addParameter([{name:"fsPosition",dataType:"vec3",role:"out"},{name:"fsTex0Coord",dataType:"vec2",role:"out"},{name:"fsTex1Coord",dataType:"vec2",role:"out"},{name:"fsNormal",dataType:"vec3",role:"out"},{name:"fsTangent",dataType:"vec3",role:"out"},{name:"fsBitangent",dataType:"vec3",role:"out"},{name:"fsSurfaceToView",dataType:"vec3",role:"out"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"out"}]),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\t\tmat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.5, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.0, 0.5, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.5, 0.5, 0.5, 1.0);\n\t\t\t\t\t\n\t\t\t\t\tvec4 viewPos = inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tgl_Position = inProjectionMatrix * viewPos;\n\t\t\t\t\t\n\t\t\t\t\tfsNormal = normalize((inNormalMatrix * vec4(inNormal,1.0)).xyz);\n\t\t\t\t\tfsTangent = normalize((inNormalMatrix * vec4(inTangent,1.0)).xyz);\n\t\t\t\t\tfsBitangent = cross(fsNormal,fsTangent);\n\t\t\t\t\t\n\t\t\t\t\tfsVertexPosFromLight = ScaleMatrix * inLightProjectionMatrix * inLightViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\t\n\t\t\t\t\tfsTex0Coord = inTex0;\n\t\t\t\t\tfsTex1Coord = inTex1;\n\t\t\t\t\tfsPosition = viewPos.xyz;")),i}function n(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),r.addParameter(t().inputs.material.all),r.addParameter(t().inputs.lighting.all),r.addParameter(t().inputs.shadows.all),r.addParameter(t().inputs.colorCorrection.all),r.addParameter([{name:"fsPosition",dataType:"vec3",role:"in"},{name:"fsTex0Coord",dataType:"vec2",role:"in"},{name:"fsTex1Coord",dataType:"vec2",role:"in"},{name:"fsNormal",dataType:"vec3",role:"in"},{name:"fsTangent",dataType:"vec3",role:"in"},{name:"fsBitangent",dataType:"vec3",role:"in"},{name:"fsSurfaceToView",dataType:"vec3",role:"in"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"in"}]),r.addFunction(t().functions.materials.all),r.addFunction(t().functions.colorCorrection.all),r.addFunction(t().functions.utils.unpack),r.addFunction(t().functions.utils.random),r.addFunction(t().functions.lighting.all),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\tvec4 diffuseColor = samplerColor(inTexture,fsTex0Coord,inTextureOffset,inTextureScale);\n\t\t\t\t\tif (diffuseColor.a>=inAlphaCutoff) {\t\n\t\t\t\t\t\tvec4 lightmapColor = samplerColor(inLightMap,fsTex1Coord,inLightMapOffset,inLightMapScale);\n\t\t\t\t\t\tvec3 normalMap = samplerNormal(inNormalMap,fsTex0Coord,inNormalMapOffset,inNormalMapScale);\n\t\t\t\t\t\tnormalMap = combineNormalWithMap(fsNormal,fsTangent,fsBitangent,normalMap);\n\t\t\t\t\t\tvec4 shadowColor = vec4(1.0);\n\t\t\t\t\t\tif (inReceiveShadows) {\n\t\t\t\t\t\t\tshadowColor = getShadowColor(fsVertexPosFromLight,inShadowMap,inShadowMapSize,inShadowType,inShadowStrength,inShadowBias,inShadowColor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvec4 specular = specularColor(inSpecularColor,inShininessMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinShininessMaskChannel,inShininessMaskInvert);\n\t\t\t\t\t\tfloat lightEmission = applyTextureMask(inLightEmission,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMaskChannel,inLightEmissionMaskInvert);\n\t\t\t\t\t\tdiffuseColor = diffuseColor * inDiffuseColor * lightmapColor;\n\t\t\t\t\t\tvec4 light = getDirectionalLight(inLightAmbient,inLightDiffuse,inLightSpecular,inShininess,\n\t\t\t\t\t\t\t\t\t\t\t\t-inLightDirection,fsPosition,normalMap,\n\t\t\t\t\t\t\t\t\t\t\t\tdiffuseColor,specular,shadowColor);\n\t\t\t\t\t\t\n\t\t\t\t\t\tlight.rgb = clamp(light.rgb + (lightEmission * diffuseColor.rgb), vec3(0.0), vec3(1.0));\n\t\t\t\t\t\t// TODO: Select mode\n\t\t\t\t\t\tgl_FragColor = colorCorrection(light,inHue,inSaturation,inLightness,inBrightness,inContrast);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}")),r}var i=null,r=null,a=function(){function t(){this._hue=1,this._saturation=1,this._lightness=1,this._brightness=.5,this._contrast=.5}return $traceurRuntime.createClass(t,{set hue(t){this._hue=t},get hue(){return this._hue},set saturation(t){this._saturation=t},get saturation(){return this._saturation},set lightness(t){this._lightness=t},get lightness(){return this._lightness},set brightness(t){this._brightness=t},get brightness(){return this._brightness},set contrast(t){this._contrast=t},get contrast(){return this._contrast},apply:function(t){var e=void 0!==arguments[1]?arguments[1]:{hue:"inHue",saturation:"inSaturation",lightness:"inLightness",brightness:"inBrightness",contrast:"inContrast"};t.setValueFloat(e.hue,this._hue),t.setValueFloat(e.saturation,this._saturation),t.setValueFloat(e.lightness,this._lightness),t.setValueFloat(e.brightness,this._brightness),t.setValueFloat(e.contrast,this._contrast)}},{})}();bg.base.ColorCorrectionSettings=a;var s=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._material=null,this._light=null,this._lightTransform=bg.Matrix4.Identity(),this._shadowMap=null;var r=[e(),n()];this.setupShaderSource(r),this._colorCorrection=new bg.base.ColorCorrectionSettings}return $traceurRuntime.createClass(i,{get material(){return this._material},set material(t){this._material=t},get light(){return this._light},set light(t){this._light=t},get lightTransform(){return this._lightTransform},set lightTransform(t){this._lightTransform=t},set shadowMap(t){this._shadowMap=t},get shadowMap(){return this._shadowMap},get colorCorrection(){return this._colorCorrection},set colorCorrection(t){this._colorCorrection=t},beginDraw:function(){if(this._light){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst),n=this.shadowMap?this.shadowMap.viewMatrix:new bg.Matrix4(this._lightTransform);this.shader.setMatrix4("inLightProjectionMatrix",this.shadowMap?this.shadowMap.projection:this._light.projection);var i=this.shadowMap?this.shadowMap.shadowColor:bg.Color.Transparent();this.shader.setMatrix4("inLightViewMatrix",n),this.shader.setValueInt("inShadowType",this._shadowMap.shadowType),this.shader.setTexture("inShadowMap",this._shadowMap.texture,bg.base.TextureUnit.TEXTURE_5),this.shader.setVector2("inShadowMapSize",this._shadowMap.size),this.shader.setValueFloat("inShadowStrength",this._light.shadowStrength),this.shader.setVector4("inShadowColor",i),this.shader.setValueFloat("inShadowBias",this._light.shadowBias),this.shader.setValueInt("inCastShadows",this._light.castShadows),this.shader.setVector4("inLightAmbient",this._light.ambient),this.shader.setVector4("inLightDiffuse",this._light.diffuse),this.shader.setVector4("inLightSpecular",this._light.specular);var r=e.mult(this._lightTransform).rotation.multVector(this._light.direction).xyz;this.shader.setVector3("inLightDirection",r)}else{var a=bg.Color.Black();this.shader.setVector4("inLightAmbient",a),this.shader.setVector4("inLightDiffuse",a),this.shader.setVector4("inLightSpecular",a),this.shader.setVector3("inLightDirection",new bg.Vector3(0,0,0))}this.colorCorrection.apply(this.shader)},setupVars:function(){if(this.material){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst),this.shader.setMatrix4("inNormalMatrix",t.normalMatrix),this.shader.setMatrix4("inViewMatrixInv",t.viewMatrixInvert);var n=bg.base.TextureCache.WhiteTexture(this.context),i=bg.base.TextureCache.BlackTexture(this.context),r=bg.base.TextureCache.NormalTexture(this.context),a=this.material.texture||n,s=this.material.lightmap||n,o=this.material.normalMap||r,u=this.material.shininessMask||i,l=this.material.lightEmissionMask||n;this.shader.setVector4("inDiffuseColor",this.material.diffuse),this.shader.setVector4("inSpecularColor",this.material.specular),this.shader.setValueFloat("inShininess",this.material.shininess),this.shader.setTexture("inShininessMask",u,bg.base.TextureUnit.TEXTURE_3),this.shader.setVector4("inShininessMaskChannel",this.material.shininessMaskChannelVector),this.shader.setValueInt("inShininessMaskInvert",this.material.shininessMaskInvert),this.shader.setValueFloat("inLightEmission",this.material.lightEmission),this.shader.setTexture("inLightEmissionMask",l,bg.base.TextureUnit.TEXTURE_4),this.shader.setVector4("inLightEmissionMaskChannel",this.material.lightEmissionMaskChannelVector),this.shader.setValueInt("inLightEmissionMaskInvert",this.material.lightEmissionMaskInvert),this.shader.setTexture("inTexture",a,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setTexture("inLightMap",s,bg.base.TextureUnit.TEXTURE_1),this.shader.setVector2("inLightMapOffset",this.material.lightmapOffset),this.shader.setVector2("inLightMapScale",this.material.lightmapScale),this.shader.setTexture("inNormalMap",o,bg.base.TextureUnit.TEXTURE_2),this.shader.setVector2("inNormalMapScale",this.material.normalMapScale),this.shader.setVector2("inNormalMapOffset",this.material.normalMapOffset),this.shader.setValueInt("inReceiveShadows",this.material.receiveShadows),this.shader.setValueInt("inSelectMode",!1)}}},{},t)}(bg.base.Effect);bg.base.ForwardEffect=s}(),function(){bg.base.LightType={DIRECTIONAL:4,SPOT:1,POINT:5,DISABLED:10};var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._enabled=!0,this._type=bg.base.LightType.DIRECTIONAL,this._direction=new bg.Vector3(0,0,-1),this._ambient=new bg.Color(.2,.2,.2,1),this._diffuse=new bg.Color(.9,.9,.9,1),this._specular=bg.Color.White(),this._attenuation=new bg.Vector3(1,.5,.1),this._spotCutoff=20,this._spotExponent=30,this._shadowStrength=.7,this._cutoffDistance=-1,this._castShadows=!0,this._shadowBias=2e-5,this._projection=bg.Matrix4.Ortho(-10,10,-10,10,.5,300)}return $traceurRuntime.createClass(e,{clone:function(t){var e=new bg.base.Light(t||this.context);return e.assign(this),e},assign:function(t){this.enabled=t.enabled,this.type=t.type,this.direction.assign(t.direction),this.ambient.assign(t.ambient),this.diffuse.assign(t.diffuse),this.specular.assign(t.specular),this.attenuation.assign(t.attenuation),this.spotCutoff=t.spotCutoff,this.spotExponent=t.spotExponent,this.shadowStrength=t.shadowStrength,this.cutoffDistance=t.cutoffDistance,this.castShadows=t.castShadows,this.shadowBias=t.shadowBias},get enabled(){return this._enabled},set enabled(t){this._enabled=t},get type(){return this._type},set type(t){this._type=t},get direction(){return this._direction},set direction(t){this._direction=t},get ambient(){return this._ambient},set ambient(t){this._ambient=t},get diffuse(){return this._diffuse},set diffuse(t){this._diffuse=t},get specular(){return this._specular},set specular(t){this._specular=t},get attenuationVector(){return this._attenuation},get constantAttenuation(){return this._attenuation.x},get linearAttenuation(){return this._attenuation.y},get quadraticAttenuation(){return this._attenuation.z},set attenuationVector(t){this._attenuation=t},set constantAttenuation(t){this._attenuation.x=t},set linearAttenuation(t){this._attenuation.y=t},set quadraticAttenuation(t){this._attenuation.z=t},get cutoffDistance(){return this._cutoffDistance},set cutoffDistance(t){this._cutoffDistance=t},get spotCutoff(){return this._spotCutoff},set spotCutoff(t){this._spotCutoff=t},get spotExponent(){return this._spotExponent},set spotExponent(t){this._spotExponent=t},get shadowStrength(){return this._shadowStrength},set shadowStrength(t){this._shadowStrength=t},get castShadows(){return this._castShadows},set castShadows(t){this._castShadows=t},get shadowBias(){return this._shadowBias},set shadowBias(t){this._shadowBias=t},get projection(){return this._projection},set projection(t){this._projection=t}},{},t)}(bg.app.ContextObject);bg.base.Light=t}(),function(){function t(t,e,n){var i=null;return e&&((i=bg.base.TextureCache.Get(t).find(n))||(bg.log("Texture "+n+" not found. Loading texture"),i=new bg.base.Texture(t),i.create(),i.bind(),i.minFilter=bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST,i.magFilter=bg.base.TextureFilter.LINEAR,i.setImage(e),i.fileName=n,bg.base.TextureCache.Get(t).register(n,i))),i}function e(t){return/^(f|ht)tps?:\/\//i.test(t)}function n(t,n,i){var r=null;return n&&(e(n)||("/"!=i.slice(-1)&&(i+="/"),n=""+i+n),(r=bg.base.TextureCache.Get(t).find(n))||(r=new bg.base.Texture(t),r.create(),r.fileName=n,bg.base.TextureCache.Get(t).register(n,r),function(t,e){bg.utils.Resource.Load(t).then(function(n){e.bind(),r.minFilter=bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST,r.magFilter=bg.base.TextureFilter.LINEAR,e.fileName=t,e.setImage(n)})}(n,r))),r}function i(t){return t?t.fileName:""}function r(t){return new bg.Vector4(0==t?1:0,1==t?1:0,2==t?1:0,3==t?1:0)}bg.base.MaterialFlag={DIFFUSE:1,SPECULAR:2,SHININESS:4,LIGHT_EMISSION:8,REFRACTION_AMOUNT:16,REFLECTION_AMOUNT:32,TEXTURE:64,LIGHT_MAP:128,NORMAL_MAP:256,TEXTURE_OFFSET:512,TEXTURE_SCALE:1024,LIGHT_MAP_OFFSET:2048,LIGHT_MAP_SCALE:4096,NORMAL_MAP_OFFSET:8192,NORMAL_MAP_SCALE:16384,CAST_SHADOWS:32768,RECEIVE_SHADOWS:65536,ALPHA_CUTOFF:1<<17,SHININESS_MASK:1<<18,SHININESS_MASK_CHANNEL:1<<19,SHININESS_MASK_INVERT:1<<20,LIGHT_EMISSION_MASK:1<<21,LIGHT_EMISSION_MASK_CHANNEL:1<<22,LIGHT_EMISSION_MASK_INVERT:1<<23,REFLECTION_MASK:1<<24,REFLECTION_MASK_CHANNEL:1<<25,REFLECTION_MASK_INVERT:1<<26,CULL_FACE:1<<27};var a=function(){function t(t){this._modifierFlags=0,this._diffuse=bg.Color.White(),this._specular=bg.Color.White(),this._shininess=0,this._lightEmission=0,this._refractionAmount=0,this._reflectionAmount=0,this._texture=null,this._lightmap=null,this._normalMap=null,this._textureOffset=new bg.Vector2,this._textureScale=new bg.Vector2(1),this._lightmapOffset=new bg.Vector2,this._lightmapScale=new bg.Vector2(1),this._normalMapOffset=new bg.Vector2,this._normalMapScale=new bg.Vector2(1),this._castShadows=!0,this._receiveShadows=!0,this._alphaCutoff=.5,this._shininessMask=null,this._shininessMaskChannel=0,this._shininessMaskInvert=!1,this._lightEmissionMask=null,this._lightEmissionMaskChannel=0,this._lightEmissionMaskInvert=!1,this._reflectionMask=null,this._reflectionMaskChannel=0,this._reflectionMaskInvert=!1,this._cullFace=!0,t&&(void 0!==t.diffuseR&&void 0!==t.diffuseG&&void 0!==t.diffuseB&&(this.diffuse=new bg.Color(t.diffuseR,t.diffuseG,t.diffuseB,t.diffuseA?t.diffuseA:1)),void 0!==t.specularR&&void 0!==t.specularG&&void 0!==t.specularB&&(this.specular=new bg.Color(t.specularR,t.specularG,t.specularB,t.specularA?t.specularA:1)),void 0!==t.shininess&&(this.shininess=t.shininess),void 0!==t.lightEmission&&(this.lightEmission=t.lightEmission),void 0!==t.refractionAmount&&(this.refractionAmount=t.refractionAmount),void 0!==t.reflectionAmount&&(this.reflectionAmount=t.reflectionAmount),void 0!==t.texture&&(this.texture=t.texture),void 0!==t.lightmap&&(this.lightmap=t.lightmap),void 0!==t.normalMap&&(this.normalMap=t.normalMap),void 0!==t.textureOffsetX&&void 0!==t.textureOffsetY&&(this.textureOffset=new bg.Vector2(t.textureOffsetX,t.textureOffsetY)),void 0!==t.textureScaleX&&void 0!==t.textureScaleY&&(this.textureScale=new bg.Vector2(t.textureScaleX,t.textureScaleY)),void 0!==t.lightmapOffsetX&&void 0!==t.lightmapOffsetY&&(this.lightmapOffset=new bg.Vector2(t.lightmapOffsetX,t.lightmapOffsetY)),void 0!==t.lightmapScaleX&&void 0!==t.lightmapScaleY&&(this.lightmapScale=new bg.Vector2(t.lightmapScaleX,t.lightmapScaleY)),void 0!==t.normalMapScaleX&&void 0!==t.normalMapScaleY&&(this.normalMapScale=new bg.Vector2(t.normalMapScaleX,t.normalMapScaleY)),void 0!==t.normalMapOffsetX&&void 0!==t.normalMapOffsetY&&(this.normalMapOffset=new bg.Vector2(t.normalMapOffsetX,t.normalMapOffsetY)),void 0!==t.castShadows&&(this.castShadows=t.castShadows),void 0!==t.receiveShadows&&(this.receiveShadows=t.receiveShadows),void 0!==t.alphaCutoff&&(this.alphaCutoff=t.alphaCutoff),void 0!==t.shininessMask&&(this.shininessMask=t.shininessMask),void 0!==t.shininessMaskChannel&&(this.shininessMaskChannel=t.shininessMaskChannel),void 0!==t.invertShininessMask&&(this.shininessMaskInvert=t.invertShininessMask),void 0!==t.lightEmissionMask&&(this.lightEmissionMask=t.lightEmissionMask),void 0!==t.lightEmissionMaskChannel&&(this.lightEmissionMaskChannel=t.lightEmissionMaskChannel),void 0!==t.invertLightEmissionMask&&(this.lightEmissionMaskInvert=t.invertLightEmissionMask),void 0!==t.reflectionMask&&(this.reflectionMask=t.reflectionMask),void 0!==t.reflectionMaskChannel&&(this.reflectionMaskChannel=t.reflectionMaskChannel),void 0!==t.invertReflectionMask&&(this.reflectionMaskInvert=t.reflectionMaskInvert))}return $traceurRuntime.createClass(t,{get modifierFlags(){return this._modifierFlags},set modifierFlags(t){this._modifierFlags=t},setEnabled:function(t){this._modifierFlags=this._modifierFlags|t},isEnabled:function(t){return 0!=(this._modifierFlags&t)},get diffuse(){return this._diffuse},get specular(){return this._specular},get shininess(){return this._shininess},get lightEmission(){return this._lightEmission},get refractionAmount(){return this._refractionAmount},get reflectionAmount(){return this._reflectionAmount},get texture(){return this._texture},get lightmap(){return this._lightmap},get normalMap(){return this._normalMap},get textureOffset(){return this._textureOffset},get textureScale(){return this._textureScale},get lightmapOffset(){return this._lightmapOffset},get lightmapScale(){return this._lightmapScale},get normalMapOffset(){return this._normalMapOffset},get normalMapScale(){return this._normalMapScale},get castShadows(){return this._castShadows},get receiveShadows(){return this._receiveShadows},get alphaCutoff(){return this._alphaCutoff},get shininessMask(){return this._shininessMask},get shininessMaskChannel(){return this._shininessMaskChannel},get shininessMaskInvert(){return this._shininessMaskInvert},get lightEmissionMask(){return this._lightEmissionMask},get lightEmissionMaskChannel(){return this._lightEmissionMaskChannel},get lightEmissionMaskInvert(){return this._lightEmissionMaskInvert},get reflectionMask(){return this._reflectionMask},get reflectionMaskChannel(){return this._reflectionMaskChannel},get reflectionMaskInvert(){return this._reflectionMaskInvert},get cullFace(){return this._cullFace},set diffuse(t){this._diffuse=t,this.setEnabled(bg.base.MaterialFlag.DIFFUSE)},set specular(t){this._specular=t,this.setEnabled(bg.base.MaterialFlag.SPECULAR)},set shininess(t){isNaN(t)||(this._shininess=t,this.setEnabled(bg.base.MaterialFlag.SHININESS))},set lightEmission(t){isNaN(t)||(this._lightEmission=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION))},set refractionAmount(t){isNaN(t)||(this._refractionAmount=t,this.setEnabled(bg.base.MaterialFlag.REFRACTION_AMOUNT))},set reflectionAmount(t){isNaN(t)||(this._reflectionAmount=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_AMOUNT))},set texture(t){this._texture=t,this.setEnabled(bg.base.MaterialFlag.TEXTURE)},set lightmap(t){this._lightmap=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_MAP)},set normalMap(t){this._normalMap=t,this.setEnabled(bg.base.MaterialFlag.NORMAL_MAP)},set textureOffset(t){this._textureOffset=t,this.setEnabled(bg.base.MaterialFlag.TEXTURE_OFFSET)},set textureScale(t){this._textureScale=t,this.setEnabled(bg.base.MaterialFlag.TEXTURE_SCALE)},set lightmapOffset(t){this._lightmapOffset=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_MAP_OFFSET)},set lightmapScale(t){this._lightmapScale=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_MAP_SCALE)},set normalMapOffset(t){this._normalMapOffset=t,this.setEnabled(bg.base.MaterialFlag.NORMAL_MAP_OFFSET)},set normalMapScale(t){this._normalMapScale=t,this.setEnabled(bg.base.MaterialFlag.NORMAL_MAP_SCALE)},set castShadows(t){this._castShadows=t,this.setEnabled(bg.base.MaterialFlag.CAST_SHADOWS)},set receiveShadows(t){this._receiveShadows=t,this.setEnabled(bg.base.MaterialFlag.RECEIVE_SHADOWS)},set alphaCutoff(t){isNaN(t)||(this._alphaCutoff=t,this.setEnabled(bg.base.MaterialFlag.ALPHA_CUTOFF))},set shininessMask(t){this._shininessMask=t,this.setEnabled(bg.base.MaterialFlag.SHININESS_MASK)},set shininessMaskChannel(t){this._shininessMaskChannel=t,this.setEnabled(bg.base.MaterialFlag.SHININESS_MASK_CHANNEL)},set shininessMaskInvert(t){this._shininessMaskInvert=t,this.setEnabled(bg.base.MaterialFlag.SHININESS_MASK_INVERT)},set lightEmissionMask(t){this._lightEmissionMask=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK)},set lightEmissionMaskChannel(t){this._lightEmissionMaskChannel=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL)},set lightEmissionMaskInvert(t){this._lightEmissionMaskInvert=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT)},set reflectionMask(t){this._reflectionMask=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_MASK)},set reflectionMaskChannel(t){this._reflectionMaskChannel=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL)},set reflectionMaskInvert(t){this._reflectionMaskInvert=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_MASK_INVERT)},set cullFace(t){this._cullFace=t,this.setEnabled(bg.base.MaterialFlag.CULL_FACE)},clone:function(){var e=new t;return e.assign(this),e},assign:function(t){this._modifierFlags=t._modifierFlags,this._diffuse=t._diffuse,this._specular=t._specular,this._shininess=t._shininess,this._lightEmission=t._lightEmission,this._refractionAmount=t._refractionAmount,this._reflectionAmount=t._reflectionAmount,this._texture=t._texture,this._lightmap=t._lightmap,this._normalMap=t._normalMap,this._textureOffset=t._textureOffset,this._textureScale=t._textureScale,this._lightmapOffset=t._lightmapOffset,this._lightmapScale=t._lightmapScale,this._normalMapOffset=t._normalMapOffset,this._normalMapScale=t._normalMapScale,this._castShadows=t._castShadows,this._receiveShadows=t._receiveShadows,this._alphaCutoff=t._alphaCutoff,this._shininessMask=t._shininessMask,this._shininessMaskChannel=t._shininessMaskChannel,this._shininessMaskInvert=t._shininessMaskInvert,this._lightEmissionMask=t._lightEmissionMask,this._lightEmissionMaskChannel=t._lightEmissionMaskChannel,this._lightEmissionMaskInvert=t._lightEmissionMaskInvert,this._reflectionMask=t._reflectionMask,this._reflectionMaskChannel=t._reflectionMaskChannel,this._reflectionMaskInvert=t._reflectionMaskInvert,this._cullFace=t._cullFace}},{})}();bg.base.MaterialModifier=a;var s=function(){function e(){this._diffuse=bg.Color.White(),this._specular=bg.Color.White(),this._shininess=0,this._lightEmission=0,this._refractionAmount=0,this._reflectionAmount=0,this._texture=null,this._lightmap=null,this._normalMap=null,this._textureOffset=new bg.Vector2,this._textureScale=new bg.Vector2(1),this._lightmapOffset=new bg.Vector2,this._lightmapScale=new bg.Vector2(1),this._normalMapOffset=new bg.Vector2,this._normalMapScale=new bg.Vector2(1),this._castShadows=!0,this._receiveShadows=!0,this._alphaCutoff=.5,
this._shininessMask=null,this._shininessMaskChannel=0,this._shininessMaskInvert=!1,this._lightEmissionMask=null,this._lightEmissionMaskChannel=0,this._lightEmissionMaskInvert=!1,this._reflectionMask=null,this._reflectionMaskChannel=0,this._reflectionMaskInvert=!1,this._cullFace=!0}return $traceurRuntime.createClass(e,{clone:function(){var t=new e;return t.assign(this),t},assign:function(t){this._diffuse=new bg.Color(t.diffuse),this._specular=new bg.Color(t.specular),this._shininess=t.shininess,this._lightEmission=t.lightEmission,this._refractionAmount=t.refractionAmount,this._reflectionAmount=t.reflectionAmount,this._texture=t.texture,this._lightmap=t.lightmap,this._normalMap=t.normalMap,this._textureOffset=new bg.Vector2(t.textureOffset),this._textureScale=new bg.Vector2(t.textureScale),this._lightmapOffset=new bg.Vector2(t.ligthmapOffset),this._lightmapScale=new bg.Vector2(t.lightmapScale),this._normalMapOffset=new bg.Vector2(t.normalMapOffset),this._normalMapScale=new bg.Vector2(t.normalMapScale),this._castShadows=t.castShadows,this._receiveShadows=t.receiveShadows,this._alphaCutoff=t.alphaCutoff,this._shininessMask=t.shininessMask,this._shininessMaskChannel=t.shininessMaskChannel,this._shininessMaskInvert=t.shininessMaskInvert,this._lightEmissionMask=t.lightEmissionMask,this._lightEmissionMaskChannel=t.lightEmissionMaskChannel,this._lightEmissionMaskInvert=t.lightEmissionMaskInvert,this._reflectionMask=t.reflectionMask,this._reflectionMaskChannel=t.reflectionMaskChannel,this._reflectionMaskInvert=t.reflectionMaskInvert,this._cullFace=t.cullFace},get isTransparent(){return this._diffuse.a<1},get diffuse(){return this._diffuse},get specular(){return this._specular},get shininess(){return this._shininess},get lightEmission(){return this._lightEmission},get refractionAmount(){return this._refractionAmount},get reflectionAmount(){return this._reflectionAmount},get texture(){return this._texture},get lightmap(){return this._lightmap},get normalMap(){return this._normalMap},get textureOffset(){return this._textureOffset},get textureScale(){return this._textureScale},get lightmapOffset(){return this._lightmapOffset},get lightmapScale(){return this._lightmapScale},get normalMapOffset(){return this._normalMapOffset},get normalMapScale(){return this._normalMapScale},get castShadows(){return this._castShadows},get receiveShadows(){return this._receiveShadows},get alphaCutoff(){return this._alphaCutoff},get shininessMask(){return this._shininessMask},get shininessMaskChannel(){return this._shininessMaskChannel},get shininessMaskInvert(){return this._shininessMaskInvert},get lightEmissionMask(){return this._lightEmissionMask},get lightEmissionMaskChannel(){return this._lightEmissionMaskChannel},get lightEmissionMaskInvert(){return this._lightEmissionMaskInvert},get reflectionMask(){return this._reflectionMask},get reflectionMaskChannel(){return this._reflectionMaskChannel},get reflectionMaskInvert(){return this._reflectionMaskInvert},get cullFace(){return this._cullFace},set diffuse(t){this._diffuse=t},set specular(t){this._specular=t},set shininess(t){isNaN(t)||(this._shininess=t)},set lightEmission(t){isNaN(t)||(this._lightEmission=t)},set refractionAmount(t){this._refractionAmount=t},set reflectionAmount(t){this._reflectionAmount=t},set texture(t){this._texture=t},set lightmap(t){this._lightmap=t},set normalMap(t){this._normalMap=t},set textureOffset(t){this._textureOffset=t},set textureScale(t){this._textureScale=t},set lightmapOffset(t){this._lightmapOffset=t},set lightmapScale(t){this._lightmapScale=t},set normalMapOffset(t){this._normalMapOffset=t},set normalMapScale(t){this._normalMapScale=t},set castShadows(t){this._castShadows=t},set receiveShadows(t){this._receiveShadows=t},set alphaCutoff(t){isNaN(t)||(this._alphaCutoff=t)},set shininessMask(t){this._shininessMask=t},set shininessMaskChannel(t){this._shininessMaskChannel=t},set shininessMaskInvert(t){this._shininessMaskInvert=t},set lightEmissionMask(t){this._lightEmissionMask=t},set lightEmissionMaskChannel(t){this._lightEmissionMaskChannel=t},set lightEmissionMaskInvert(t){this._lightEmissionMaskInvert=t},set reflectionMask(t){this._reflectionMask=t},set reflectionMaskChannel(t){this._reflectionMaskChannel=t},set reflectionMaskInvert(t){this._reflectionMaskInvert=t},set cullFace(t){this._cullFace=t},get lightEmissionMaskChannelVector(){return r(this.lightEmissionMaskChannel)},get shininessMaskChannelVector(){return r(this.shininessMaskChannel)},get reflectionMaskChannelVector(){return r(this.reflectionMaskChannel)},copyMaterialSettings:function(t,e){e&bg.base.MaterialFlag.DIFFUSE&&(t.diffuse=this.diffuse),e&bg.base.MaterialFlag.SPECULAR&&(t.specular=this.specular),e&bg.base.MaterialFlag.SHININESS&&(t.shininess=this.shininess),e&bg.base.MaterialFlag.LIGHT_EMISSION&&(t.lightEmission=this.lightEmission),e&bg.base.MaterialFlag.REFRACTION_AMOUNT&&(t.refractionAmount=this.refractionAmount),e&bg.base.MaterialFlag.REFLECTION_AMOUNT&&(t.reflectionAmount=this.reflectionAmount),e&bg.base.MaterialFlag.TEXTURE&&(t.texture=this.texture),e&bg.base.MaterialFlag.LIGHT_MAP&&(t.lightmap=this.lightmap),e&bg.base.MaterialFlag.NORMAL_MAP&&(t.normalMap=this.normalMap),e&bg.base.MaterialFlag.TEXTURE_OFFSET&&(t.textureOffset=this.textureOffset),e&bg.base.MaterialFlag.TEXTURE_SCALE&&(t.textureScale=this.textureScale),e&bg.base.MaterialFlag.LIGHT_MAP_OFFSET&&(t.lightmapOffset=this.lightmapOffset),e&bg.base.MaterialFlag.LIGHT_MAP_SCALE&&(t.lightmapScale=this.lightmapScale),e&bg.base.MaterialFlag.NORMAL_MAP_OFFSET&&(t.normalMapOffset=this.normalMapOffset),e&bg.base.MaterialFlag.NORMAL_MAP_SCALE&&(t.normalMapScale=this.normalMapScale),e&bg.base.MaterialFlag.CAST_SHADOWS&&(t.castShadows=this.castShadows),e&bg.base.MaterialFlag.RECEIVE_SHADOWS&&(t.receiveShadows=this.receiveShadows),e&bg.base.MaterialFlag.ALPHA_CUTOFF&&(t.alphaCutoff=this.alphaCutoff),e&bg.base.MaterialFlag.SHININESS_MASK&&(t.shininessMask=this.shininessMask),e&bg.base.MaterialFlag.SHININESS_MASK_CHANNEL&&(t.shininessMaskChannel=this.shininessMaskChannel),e&bg.base.MaterialFlag.SHININESS_MASK_INVERT&&(t.shininessMaskInvert=this.shininessMaskInvert),e&bg.base.MaterialFlag.LIGHT_EMISSION_MASK&&(t.lightEmissionMask=this.lightEmissionMask),e&bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL&&(t.lightEmissionMaskChannel=this.lightEmissionMaskChannel),e&bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT&&(t.lightEmissionMaskInvert=this.lightEmissionMaskInvert),e&bg.base.MaterialFlag.REFLECTION_MASK&&(t.reflectionMask=this.reflectionMask),e&bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL&&(t.reflectionMaskChannel=this.reflectionMaskChannel),e&bg.base.MaterialFlag.REFLECTION_MASK_INVERT&&(t.reflectionMaskInvert=this.reflectionMaskInvert),e&bg.base.MaterialFlag.CULL_FACE&&(t.cullFace=this.cullFace)},applyModifier:function(t,e,i){e.isEnabled(bg.base.MaterialFlag.DIFFUSE)&&(this.diffuse=e.diffuse),e.isEnabled(bg.base.MaterialFlag.SPECULAR)&&(this.specular=e.specular),e.isEnabled(bg.base.MaterialFlag.SHININESS)&&(this.shininess=e.shininess),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION)&&(this.lightEmission=e.lightEmission),e.isEnabled(bg.base.MaterialFlag.REFRACTION_AMOUNT)&&(this.refractionAmount=e.refractionAmount),e.isEnabled(bg.base.MaterialFlag.REFLECTION_AMOUNT)&&(this.reflectionAmount=e.reflectionAmount),e.isEnabled(bg.base.MaterialFlag.TEXTURE)&&(this.texture=n(t,e.texture,i)),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP)&&(this.lightmap=n(t,e.lightmap,i)),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP)&&(this.normalMap=n(t,e.normalMap,i)),e.isEnabled(bg.base.MaterialFlag.TEXTURE_OFFSET)&&(this.textureOffset=e.textureOffset),e.isEnabled(bg.base.MaterialFlag.TEXTURE_SCALE)&&(this.textureScale=e.textureScale),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_OFFSET)&&(this.lightmapOffset=e.lightmapOffset),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_SCALE)&&(this.lightmapScale=e.lightmapScale),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_OFFSET)&&(this.normalMapOffset=e.normalMapOffset),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_SCALE)&&(this.normalMapScale=e.normalMapScale),e.isEnabled(bg.base.MaterialFlag.CAST_SHADOWS)&&(this.castShadows=e.castShadows),e.isEnabled(bg.base.MaterialFlag.RECEIVE_SHADOWS)&&(this.receiveShadows=e.receiveShadows),e.isEnabled(bg.base.MaterialFlag.ALPHA_CUTOFF)&&(this.alphaCutoff=e.alphaCutoff),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK)&&(this.shininessMask=n(t,e.shininessMask,i)),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_CHANNEL)&&(this.shininessMaskChannel=e.shininessMaskChannel),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_INVERT)&&(this.shininessMaskInvert=e.shininessMaskInvert),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK)&&(this.lightEmissionMask=n(t,e.lightEmissionMask,i)),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL)&&(this.lightEmissionMaskChannel=e.lightEmissionMaskChannel),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT)&&(this.lightEmissionMaskInvert=e.lightEmissionMaskInvert),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK)&&(this.reflectionMask=n(t,e.reflectionMask,i)),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL)&&(this.reflectionMaskChannel=e.reflectionMaskChannel),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_INVERT)&&(this.reflectionMaskInvert=e.reflectionMaskInvert),e.isEnabled(bg.base.MaterialFlag.CULL_FACE)&&(this.cullFace=e.cullFace)},getModifierWithMask:function(t){var e=new a;e.isEnabled(bg.base.MaterialFlag.DIFFUSE)&&(e.diffuse=this.diffuse),e.isEnabled(bg.base.MaterialFlag.SPECULAR)&&(e.specular=this.specular),e.isEnabled(bg.base.MaterialFlag.SHININESS)&&(e.shininess=this.shininess),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION)&&(e.lightEmission=this.lightEmission),e.isEnabled(bg.base.MaterialFlag.REFRACTION_AMOUNT)&&(e.refractionAmount=this.refractionAmount),e.isEnabled(bg.base.MaterialFlag.REFLECTION_AMOUNT)&&(e.reflectionAmount=this.reflectionAmount),e.isEnabled(bg.base.MaterialFlag.TEXTURE)&&(e.texture=i(this.texture)),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP)&&(e.lightmap=i(this.lightmap)),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP)&&(e.normalMap=i(this.normalMap)),e.isEnabled(bg.base.MaterialFlag.TEXTURE_OFFSET)&&(e.textureOffset=this.textureOffset),e.isEnabled(bg.base.MaterialFlag.TEXTURE_SCALE)&&(e.textureScale=this.textureScale),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_OFFSET)&&(e.lightmapOffset=this.lightmapOffset),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_SCALE)&&(e.lightmapScale=this.lightmapScale),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_OFFSET)&&(e.normalMapOffset=this.normalMapOffset),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_SCALE)&&(e.normalMapScale=this.normalMapScale),e.isEnabled(bg.base.MaterialFlag.CAST_SHADOWS)&&(e.castShadows=this.castShadows),e.isEnabled(bg.base.MaterialFlag.RECEIVE_SHADOWS)&&(e.receiveShadows=this.receiveShadows),e.isEnabled(bg.base.MaterialFlag.ALPHA_CUTOFF)&&(e.alphaCutoff=this.alphaCutoff),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK)&&(e.shininessMask=i(this.shininessMask)),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_CHANNEL)&&(e.shininessMaskChannel=this.shininessMaskChannel),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_INVERT)&&(e.shininessMaskInvert=this.shininessMaskInvert),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK)&&(e.lightEmissionMask=i(this.lightEmissionMask)),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL)&&(e.lightEmissionMaskChannel=this.lightEmissionMaskChannel),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT)&&(e.lightEmissionMaskInver=this.lightEmissionMaskInver),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK)&&(e.reflectionMask=i(this.reflectionMask)),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL)&&(e.reflectionMaskChannel=this.reflectionMaskChannel),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_INVERT)&&(e.reflectionMaskInvert=this.reflectionMaskInvert),e.isEnabled(bg.base.MaterialFlag.CULL_FACE)&&(e.cullFace=this.cullFace),e.setFlags(t)}},{GetMaterialWithJson:function(n,i,r){function a(t,e){return e?t?t+e:e:null}var s=new e;return void 0===i.cullFace&&(i.cullFace=!0),s.diffuse.set(i.diffuseR,i.diffuseG,i.diffuseB,i.diffuseA),s.specular.set(i.specularR,i.specularG,i.specularB,i.specularA),s.shininess=i.shininess,s.lightEmission=i.lightEmission,s.refractionAmount=i.refractionAmount,s.reflectionAmount=i.reflectionAmount,s.textureOffset.set(i.textureOffsetX,i.textureOffsetY),s.textureScale.set(i.textureScaleX,i.textureScaleY),s.lightmapOffset.set(i.lightmapOffsetX,i.lightmapOffsetY),s.lightmapScale.set(i.lightmapScaleX,i.lightmapScaleY),s.normalMapOffset.set(i.normalMapOffsetX,i.normalMapOffsetY),s.normalMapScale.set(i.normalMapScaleX,i.normalMapScaleY),s.alphaCutoff=i.alphaCutoff,s.castShadows=i.castShadows,s.receiveShadows=i.receiveShadows,s.shininessMaskChannel=i.shininessMaskChannel,s.shininessMaskInvert=i.invertShininessMask,s.lightEmissionMaskChannel=i.lightEmissionMaskChannel,s.lightEmissionMaskInvert=i.invertLightEmissionMask,s.reflectionMaskChannel=i.reflectionMaskChannel,s.reflectionMaskInvert=i.invertReflectionMask,s.cullFace=i.cullFace,r&&"/"!=r[r.length-1]&&(r+="/"),i.texture=a(r,i.texture),i.lightmap=a(r,i.lightmap),i.normalMap=a(r,i.normalMap),i.shininessMask=a(r,i.shininessMask),i.lightEmissionMask=a(r,i.lightEmissionMask),i.reflectionMask=a(r,i.reflectionMask),new Promise(function(e,r){var a=[];i.texture&&a.push(i.texture),i.lightmap&&-1==a.indexOf(i.lightmap)&&a.push(i.lightmap),i.normalMap&&-1==a.indexOf(i.normalMap)&&a.push(i.normalMap),i.shininessMask&&-1==a.indexOf(i.shininessMask)&&a.push(i.shininessMask),i.lightEmissionMask&&-1==a.indexOf(i.lightEmissionMask)&&a.push(i.lightEmissionMask),i.reflectionMask&&-1==a.indexOf(i.reflectionMask)&&a.push(i.reflectionMask),bg.utils.Resource.Load(a).then(function(r){s.texture=t(n,r[i.texture],i.texture),s.lightmap=t(n,r[i.lightmap],i.lightmap),s.normalMap=t(n,r[i.normalMap],i.normalMap),s.shininessMask=t(n,r[i.shininessMask],i.shininessMask),s.lightEmissionMask=t(n,r[i.lightEmissionMask],i.lightEmissionMask),s.reflectionMask=t(n,r[i.reflectionMask],i.reflectionMask),e(s)})})}})}();bg.base.Material=s}(),function(){var t=function(){function t(){this._matrix=new bg.Matrix4.Identity,this._stack=[],this._changed=!0}return $traceurRuntime.createClass(t,{get changed(){return this._changed},set changed(t){this._changed=t},push:function(){this._stack.push(new bg.Matrix4(this._matrix))},set:function(t){return this._matrix.assign(t),this._changed=!0,this},mult:function(t){return this._matrix.mult(t),this._changed=!0,this},identity:function(){return this._matrix.identity(),this._changed=!0,this},translate:function(t,e,n){return this._matrix.translate(t,e,n),this._changed=!0,this},rotate:function(t,e,n,i){return this._matrix.rotate(t,e,n,i),this._changed=!0,this},scale:function(t,e,n){return this._matrix.scale(t,e,n),this._changed=!0,this},perspective:function(t,e,n,i){return this._matrix.identity().perspective(t,e,n,i),this._changed=!0,this},frustum:function(t,e,n,i,r,a){return this._matrix.identity().frustum(t,e,n,i,r,a),this._changed=!0,this},ortho:function(t,e,n,i,r,a){return this._matrix.identity().ortho(t,e,n,i,r,a),this._changed=!0,this},invert:function(){return this._matrix.invert(),this._changed=!0,this},get matrix(){return this._changed=!0,this._matrix},get matrixConst(){return this._matrix},pop:function(){return this._stack.length&&(this._matrix.assign(this._stack.pop()),this._changed=!0),this._matrix}},{})}();bg.base.MatrixStack=t;var e=null,n=function(){function n(){this._modelMatrixStack=new t,this._viewMatrixStack=new t,this._projectionMatrixStack=new t,this._modelViewMatrix=new bg.Matrix4.Identity,this._normalMatrix=new bg.Matrix4.Identity}return $traceurRuntime.createClass(n,{get modelMatrixStack(){return this._modelMatrixStack},get viewMatrixStack(){return this._viewMatrixStack},get projectionMatrixStack(){return this._projectionMatrixStack},get modelViewMatrix(){return(!this._modelViewMatrix||this._modelMatrixStack.changed||this._viewMatrixStack.changed)&&(this._modelViewMatrix=new bg.Matrix4(this._viewMatrixStack._matrix),this._modelViewMatrix.mult(this._modelMatrixStack._matrix),this._modelMatrixStack.changed=!1,this._viewMatrixStack.changed=!1),this._modelViewMatrix},get normalMatrix(){return(!this._normalMatrix||this._modelMatrixStack.changed||this._viewMatrixStack.changed)&&(this._normalMatrix=new bg.Matrix4(this.modelViewMatrix),this._normalMatrix.invert(),this._normalMatrix.traspose(),this._modelMatrixStack.changed=!1),this._normalMatrix},get viewMatrixInvert(){return this._viewMatrixInvert&&!this._viewMatrixStack.changed||(this._viewMatrixInvert=new bg.Matrix4(this.viewMatrixStack.matrixConst),this._viewMatrixInvert.invert()),this._viewMatrixInvert}},{Current:function(){return e||(e=new n),e},SetCurrent:function(t){return e=t}})}();bg.base.MatrixState=n}(),function(){function t(t){t._effect&&t._effect.setActive(),t.renderSurface.setActive(),bg.Engine.Get().pipeline.setViewport(t.context,t._viewport),bg.Engine.Get().pipeline.setDepthTestEnabled(t.context,t._depthTest),bg.Engine.Get().pipeline.setCullFace(t.context,t._cullFace),bg.Engine.Get().pipeline.setBlendEnabled(t.context,t._blend),bg.Engine.Get().pipeline.setBlendMode(t.context,t._blendMode)}bg.base.ClearBuffers={COLOR:null,DEPTH:null,COLOR_DEPTH:null},bg.base.BlendMode={NORMAL:1,MULTIPLY:2,ADD:3,SUBTRACT:4,ALPHA_ADD:5,ALPHA_SUBTRACT:6},bg.base.OpacityLayer={TRANSPARENT:1,OPAQUE:2,GIZMOS:4,SELECTION:8,ALL:15,NONE:0};var e=function(){function t(t){this.initFlags(t),bg.base.ClearBuffers.COLOR_DEPTH=bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH}return $traceurRuntime.createClass(t,{initFlags:function(t){},setViewport:function(t,e){},clearBuffers:function(t,e,n){},setDepthTestEnabled:function(t,e){},setBlendEnabled:function(t,e){},setBlendMode:function(t,e){},setCullFace:function(t,e){}},{})}();bg.base.PipelineImpl=e;var n=null,i=function(e){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._opacityLayer=bg.base.OpacityLayer.ALL,this._viewport=new bg.Viewport(0,0,200,200),this._clearColor=bg.Color.Black(),this._effect=null,this._textureEffect=null,this._depthTest=!0,this._cullFace=!0,this._renderSurface=null,this._blend=!1,this._blendMode=bg.base.BlendMode.NORMAL,this._buffersToClear=bg.base.ClearBuffers.COLOR_DEPTH}return $traceurRuntime.createClass(i,{get isCurrent(){return n==this},set opacityLayer(t){this._opacityLayer=t},get opacityLayer(){return this._opacityLayer},shouldDraw:function(t){return t&&(t.isTransparent&&0!=(this._opacityLayer&bg.base.OpacityLayer.TRANSPARENT)||!t.isTransparent&&0!=(this._opacityLayer&bg.base.OpacityLayer.OPAQUE))},get effect(){return this._effect},set effect(t){this._effect=t,this._effect&&this.isCurrent&&this._effect.setActive()},get textureEffect(){return this._textureEffect||(this._textureEffect=new bg.base.DrawTextureEffect(this.context)),this._textureEffect},set textureEffect(t){this._textureEffect=t},set buffersToClear(t){this._buffersToClear=t},get buffersToClear(){return this._buffersToClear},get renderSurface(){return this._renderSurface||(this._renderSurface=new bg.base.ColorSurface(this.context),this._renderSurface.setActive()),this._renderSurface},set renderSurface(t){this._renderSurface=t,this.isCurrent&&this._renderSurface.setActive()},draw:function(t){if(this._effect&&t&&this.isCurrent){var e=this.cullFace;this._effect.bindPolyList(t),this._effect.material&&(this.cullFace=this._effect.material.cullFace),t.draw(),this._effect.unbind(),this.cullFace=e}},drawTexture:function(t){var e=this.depthTest;this.depthTest=!1,this.textureEffect.drawSurface(t),this.depthTest=e},get blend(){return this._blend},set blend(t){this._blend=t,this.isCurrent&&bg.Engine.Get().pipeline.setBlendEnabled(this.context,this._blend)},get blendMode(){return this._blendMode},set blendMode(t){this._blendMode=t,this.isCurrent&&bg.Engine.Get().pipeline.setBlendMode(this.context,this._blendMode)},get viewport(){return this._viewport},set viewport(t){this._viewport=t,this.renderSurface.resizeOnViewportChanged&&(this.renderSurface.size=new bg.Vector2(t.width,t.height)),this.isCurrent&&bg.Engine.Get().pipeline.setViewport(this.context,this._viewport)},clearBuffers:function(t){this.isCurrent&&(t=void 0!==t?t:this._buffersToClear,bg.Engine.Get().pipeline.clearBuffers(this.context,this._clearColor,t))},get clearColor(){return this._clearColor},set clearColor(t){this._clearColor=t},get depthTest(){return this._depthTest},set depthTest(t){this._depthTest=t,this.isCurrent&&bg.Engine.Get().pipeline.setDepthTestEnabled(this.context,this._depthTest)},get cullFace(){return this._cullFace},set cullFace(t){this._cullFace=t,this.isCurrent&&bg.Engine.Get().pipeline.setCullFace(this.context,this._cullFace)}},{SetCurrent:function(e){(n=e)&&t(n)},Current:function(){return n}},e)}(bg.app.ContextObject);bg.base.Pipeline=i}(),function(){function t(t){if(t.texCoord0&&t.vertex){t._tangent=[];for(var e=[],n={},i=0;i<t.index.length-2;i+=3){var r=3*t.index[i],a=3*t.index[i+1],s=3*t.index[i+2],o=2*t.index[i],u=2*t.index[i+1],l=2*t.index[i+2],c=new bg.Vector3(t.vertex[r],t.vertex[r+1],t.vertex[r+2]),h=new bg.Vector3(t.vertex[a],t.vertex[a+1],t.vertex[a+2]),f=new bg.Vector3(t.vertex[s],t.vertex[s+1],t.vertex[s+2]),d=new bg.Vector2(t.texCoord0[o],t.texCoord0[o+1]),g=new bg.Vector2(t.texCoord0[u],t.texCoord0[u+1]),m=new bg.Vector2(t.texCoord0[l],t.texCoord0[l+1]),p=new bg.Vector3(h).sub(c),b=new bg.Vector3(f).sub(c),_=g.x-d.x,v=g.y-d.y,y=m.x-d.x,E=m.y-d.y,T=1/(_*E-y*v),x=new bg.Vector3(T*(E*p.x-v*b.x),T*(E*p.y-v*b.y),T*(E*p.z-v*b.z));x.normalize(),void 0===n[r]&&(e.push(x.x),e.push(x.y),e.push(x.z),n[r]=x),void 0===n[a]&&(e.push(x.x),e.push(x.y),e.push(x.z),n[a]=x),void 0===n[s]&&(e.push(x.x),e.push(x.y),e.push(x.z),n[s]=x)}return e}}var e=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){},create:function(t){},build:function(t,e,n,i,r,a,s,o,u,l){return!1},draw:function(t,e,n,i){},destroy:function(t,e){}},{})}();bg.base.PolyListImpl=e,bg.base.DrawMode={TRIANGLES:null,TRIANGLE_FAN:null,TRIANGLE_STRIP:null};var n=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._plist=null,this._drawMode=bg.base.DrawMode.TRIANGLES,this._name="",this._groupName="",this._visible=!0,this._vertex=[],this._normal=[],this._texCoord0=[],this._texCoord1=[],this._texCoord2=[],this._color=[],this._tangent=[],this._index=[]}return $traceurRuntime.createClass(n,{clone:function(){var t=new n(this.context),e=function(t,e){t.forEach(function(t){e.push(t)})};return t.name=this.name+" clone",t.groupName=this.groupName,t.visible=this.visible,t.drawMode=this.drawMode,e(this.vertex,t.vertex),e(this.normal,t.normal),e(this.texCoord0,t.texCoord0),e(this.texCoord1,t.texCoord1),e(this.texCoord2,t.texCoord02),e(this.color,t.color),e(this.index,t.index),t.build(),t},get name(){return this._name},set name(t){this._name=t},get groupName(){return this._groupName},set groupName(t){this._groupName=t},get visible(){return this._visible},set visible(t){this._visible=t},get drawMode(){return this._drawMode},set drawMode(t){this._drawMode=t},set vertex(t){this._vertex=t},set normal(t){this._normal=t},set texCoord0(t){this._texCoord0=t},set texCoord1(t){this._texCoord1=t},set texCoord2(t){this._texCoord2=t},set color(t){this._color=t},set index(t){this._index=t},get vertex(){return this._vertex},get normal(){return this._normal},get texCoord0(){return this._texCoord0},get texCoord1(){return this._texCoord1},get texCoord2(){return this._texCoord2},get color(){return this._color},get tangent(){return this._tangent},get index(){return this._index},get vertexBuffer(){return this._plist.vertexBuffer},get normalBuffer(){return this._plist.normalBuffer},get texCoord0Buffer(){return this._plist.tex0Buffer},get texCoord1Buffer(){return this._plist.tex1Buffer},get texCoord2Buffer(){return this._plist.tex2Buffer},get colorBuffer(){return this._plist.colorBuffer},get tangentBuffer(){return this._plist.tangentBuffer},get indexBuffer(){return this._plist.indexBuffer},build:function(){var e=bg.Engine.Get().polyList;return this._plist&&(e.destroy(this.context,this._plist),this._tangent=[]),this._tangent=t(this),this._plist=e.create(this.context),e.build(this.context,this._plist,this._vertex,this._normal,this._texCoord0,this._texCoord1,this._texCoord2,this._color,this._tangent,this._index)},draw:function(){bg.Engine.Get().polyList.draw(this.context,this._plist,this.drawMode,this.index.length)},destroy:function(){this._plist&&bg.Engine.Get().polyList.destroy(this.context,this._plist),this._plist=null,this._name="",this._vertex=[],this._normal=[],this._texCoord0=[],this._texCoord1=[],this._texCoord2=[],this._color=[],this._tangent=[],this._index=[]},applyTransform:function(t){var e=new bg.Matrix4(t),n=new bg.Matrix4(t.getMatrix3());if(this.normal.length>0&&this.normal.length!=this.vertex.length)throw new Error("Unexpected number of normal coordinates found in polyList");for(var i=0;i<this.vertex.length-2;i+=3){var r=new bg.Vector4(this.vertex[i],this.vertex[i+1],this.vertex[i+2],1);if(r=e.multVector(r),this.vertex[i]=r.x,this.vertex[i+1]=r.y,this.vertex[i+2]=r.z,this.normal.length){var a=new bg.Vector4(this.normal[i],this.normal[i+1],this.normal[i+2],1);a=n.multVector(a),this.normal[i]=a.x,this.normal[i+1]=a.y,this.normal[i+2]=a.z}}this.build()}},{},e)}(bg.app.ContextObject);bg.base.PolyList=n}(),function(){function t(){return bg.base.ShaderLibrary.Get()}function e(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex]),i.addParameter(t().inputs.matrix.all),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t")),i}function n(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\tgl_FragColor = vec4(1.0,0.0,0.0,1.0);\n\t\t\t\t")),r}var i=null,r=null,a=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t);var r=[e(),n()];this.setupShaderSource(r)}return $traceurRuntime.createClass(i,{beginDraw:function(){},setupVars:function(){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst)}},{},t)}(bg.base.Effect);bg.base.RedEffect=a}(),function(){var t=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){},create:function(t,e){},setActive:function(t,e){},readBuffer:function(t,e,n){},resize:function(t,e,n){},destroy:function(t,e){},supportType:function(t){},supportFormat:function(t){},maxColorAttachments:function(){}},{})}();bg.base.RenderSurfaceBufferImpl=t;var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._size=new bg.Vector2(256),this._renderSurface=null,this._resizeOnViewportChanged=!0}return $traceurRuntime.createClass(e,{get size(){return this._size},set size(t){this._size.x==t.x&&this._size.y==t.y||(this._size=t,this.surfaceImpl.resize(this.context,this._renderSurface,t))},get surfaceImpl(){return null},get resizeOnViewportChanged(){return this._resizeOnViewportChanged},set resizeOnViewportChanged(t){this._resizeOnViewportChanged=t},create:function(t){t||(t=e.DefaultAttachments()),this._renderSurface=this.surfaceImpl.create(this.context,t)},setActive:function(){this.surfaceImpl.setActive(this.context,this._renderSurface)},readBuffer:function(t){return this.surfaceImpl.readBuffer(this.context,this._renderSurface,t,this.size)},destroy:function(){this.surfaceImpl.destroy(this.context,this._renderSurface),this._renderSurface=null}},{DefaultAttachments:function(){return[{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]},SupportFormat:function(t){return bg.Engine.Get().colorBuffer.supportFormat(t)},SupportType:function(t){return bg.Engine.Get().colorBuffer.supportType(t)},MaxColorAttachments:function(){return bg.Engine.Get().textureBuffer.maxColorAttachments}},t)}(bg.app.ContextObject);bg.base.RenderSurface=e,bg.base.RenderSurfaceType={RGBA:null,DEPTH:null},bg.base.RenderSurfaceFormat={UNSIGNED_BYTE:null,UNSIGNED_SHORT:null,FLOAT:null,RENDERBUFFER:null};var n=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{get surfaceImpl(){return bg.Engine.Get().colorBuffer}},{MaxColorAttachments:function(){return bg.Engine.Get().colorBuffer.maxColorAttachments}},t)}(e);bg.base.ColorSurface=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{get surfaceImpl(){return bg.Engine.Get().textureBuffer},getTexture:function(){var t=void 0!==arguments[0]?arguments[0]:0;return this._renderSurface.attachments[t]&&this._renderSurface.attachments[t].texture}},{MaxColorAttachments:function(){return bg.Engine.Get().textureBuffer.maxColorAttachments}},t)}(e);bg.base.TextureSurface=i}(),function(){function t(t){Reflect.defineProperty(t,"all",{get:function(){if(!this._all){this._all=[];for(var e in t)"object"==$traceurRuntime.typeof(t[e])&&t[e].name&&this._all.push(t[e])}return this._all}})}var e=null,n=function(){function n(){var e=bg[bg.Engine.Get().id].shaderLibrary;for(var n in e)this[n]=e[n];t(this.inputs.matrix),Object.defineProperty(this.inputs.matrix,"modelViewProjection",{get:function(){return[this.model,this.view,this.projection]}}),t(this.inputs.material),t(this.inputs.lighting),t(this.inputs.shadows),t(this.inputs.colorCorrection),t(this.functions.materials),t(this.functions.colorCorrection),t(this.functions.lighting),t(this.functions.utils)}return $traceurRuntime.createClass(n,{},{Get:function(){return e||(e=new n),e}})}();bg.base.ShaderLibrary=n;var i=function(){function t(){}return $traceurRuntime.createClass(t,{header:function(t){return""},parameter:function(t,e){return e.name},func:function(t,e){return e.name}},{})}();bg.base.ShaderSourceImpl=i;var r=function(){function t(t){this._type=t,this._params=[],this._functions=[],this._requiredExtensions=[],this._header=""}return $traceurRuntime.createClass(t,{get type(){return this._type},get params(){return this._params},get header(){return this._header},get functions(){return this._functions},addParameter:function(t){t instanceof Array?this._params=$traceurRuntime.spread(this._params,t):this._params.push(t),this._params.push(null)},addFunction:function(t){t instanceof Array?this._functions=$traceurRuntime.spread(this._functions,t):this._functions.push(t)},setMainBody:function(t){this.addFunction({returnType:"void",name:"main",params:{},body:t})},appendHeader:function(t){this._header+=t+"\n"},toString:function(){var t=this,e=bg.Engine.Get().shaderSource,n=e.header(this.type)+"\n"+this._header+"\n\n";return this.params.forEach(function(i){n+=e.parameter(t.type,i)+"\n"}),this.functions.forEach(function(i){n+="\n"+e.func(t.type,i)+"\n"}),n}},{FormatSource:function(t){var e="",n=t.replace(/^\n*/,"").replace(/\n*$/,"").split("\n"),i=100;return n.forEach(function(t){var e=/(\t*)/.exec(t)[0].length;i>e&&(i=e)}),n.forEach(function(t){var n=/(\t*)/.exec(t)[0].length,r=n-i;e+=t.slice(n-r,t.length)+"\n"}),e.replace(/^\n*/,"").replace(/\n*$/,"")}})}();bg.base.ShaderSource=r}(),function(){function t(t){var e="";return t.split("\n").forEach(function(t,n){++n,e+=(n<10?"00":n<100?"0":"")+n+" | "+t+"\n"}),e}var e=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){},setActive:function(t,e){},create:function(t){},addShaderSource:function(t,e,n,i){},link:function(t,e){},initVars:function(t,e,n,i){},setInputBuffer:function(t,e,n,i,r){},
setValueInt:function(t,e,n,i){},setValueFloat:function(t,e,n,i){},setValueVector2:function(t,e,n,i){},setValueVector3:function(t,e,n,i){},setValueVector4:function(t,e,n,i){},setValueVector2v:function(t,e,n,i){},setValueVector3v:function(t,e,n,i){},setValueVector4v:function(t,e,n,i){},setValueMatrix3:function(t,e,n,i,r){},setValueMatrix4:function(t,e,n,i,r){},setTexture:function(t,e,n,i,r){}},{})}();bg.base.ShaderImpl=e,bg.base.ShaderType={VERTEX:null,FRAGMENT:null};var n=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._shader=bg.Engine.Get().shader.create(t),this._linked=!1,this._compileError=null,this._linkError=null}return $traceurRuntime.createClass(n,{get shader(){return this._shader},get compileError(){return this._compileError},get compileErrorSource(){return this._compileErrorSource},get linkError(){return this._linkError},get status(){return null==this._compileError&&null==this._linkError},addShaderSource:function(e,n){return this._linked?this._compileError="Tying to attach a shader to a linked program":this._compileError||(this._compileError=bg.Engine.Get().shader.addShaderSource(this.context,this._shader,e,n),this._compileError&&(this._compileErrorSource=t(n))),null==this._compileError},link:function(){return this._linkError=null,this._linked?this._linkError="Shader already linked":(this._linkError=bg.Engine.Get().shader.link(this.context,this._shader),this._linked=null==this._linkError),this._linked},setActive:function(){bg.Engine.Get().shader.setActive(this.context,this._shader)},clearActive:function(){n.ClearActive(this.context)},initVars:function(t,e){bg.Engine.Get().shader.initVars(this.context,this._shader,t,e)},setInputBuffer:function(t,e,n){bg.Engine.Get().shader.setInputBuffer(this.context,this._shader,t,e,n)},disableInputBuffer:function(t){bg.Engine.Get().shader.disableInputBuffer(this.context,this._shader,t)},setValueInt:function(t,e){bg.Engine.Get().shader.setValueInt(this.context,this._shader,t,e)},setValueFloat:function(t,e){bg.Engine.Get().shader.setValueFloat(this.context,this._shader,t,e)},setVector2:function(t,e){bg.Engine.Get().shader.setValueVector2(this.context,this._shader,t,e)},setVector3:function(t,e){bg.Engine.Get().shader.setValueVector3(this.context,this._shader,t,e)},setVector4:function(t,e){bg.Engine.Get().shader.setValueVector4(this.context,this._shader,t,e)},setVector2Ptr:function(t,e){bg.Engine.Get().shader.setValueVector2v(this.context,this._shader,t,e)},setVector3Ptr:function(t,e){bg.Engine.Get().shader.setValueVector3v(this.context,this._shader,t,e)},setVector4Ptr:function(t,e){bg.Engine.Get().shader.setValueVector4v(this.context,this._shader,t,e)},setMatrix3:function(t,e){var n=void 0!==arguments[2]&&arguments[2];bg.Engine.Get().shader.setValueMatrix3(this.context,this._shader,t,n,e)},setMatrix4:function(t,e){var n=void 0!==arguments[2]&&arguments[2];bg.Engine.Get().shader.setValueMatrix4(this.context,this._shader,t,n,e)},setTexture:function(t,e,n){bg.Engine.Get().shader.setTexture(this.context,this._shader,t,e,n)}},{ClearActive:function(t){bg.Engine.Get().shader.setActive(t,null)}},e)}(bg.app.ContextObject);bg.base.Shader=n}(),function(){function t(){return bg.base.ShaderLibrary.Get()}function e(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,null,t().inputs.matrix.model,t().inputs.matrix.view,t().inputs.matrix.projection,null,{name:"fsTexCoord",dataType:"vec2",role:"out"}]),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\tfsTexCoord = inTex0;\n\t\t\t\t")),i}function n(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),r.addParameter([t().inputs.material.castShadows,t().inputs.material.texture,t().inputs.material.textureOffset,t().inputs.material.textureScale,t().inputs.material.alphaCutoff,null,{name:"fsTexCoord",dataType:"vec2",role:"in"}]),r.addFunction(t().functions.utils.pack),r.addFunction(t().functions.materials.samplerColor),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\n\t\t\t\tfloat alpha = samplerColor(inTexture,fsTexCoord,inTextureOffset,inTextureScale).a;\n\t\t\t\tif (inCastShadows && alpha>inAlphaCutoff) {\n\t\t\t\t\tgl_FragColor = pack(gl_FragCoord.z);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdiscard;\n\t\t\t\t}")),r}var i=null,r=null,a=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._material=null,this._light=null,this._lightTransform=null,this.setupShaderSource([e(),n()])}return $traceurRuntime.createClass(i,{get material(){return this._material},set material(t){this._material=t},get light(){return this._light},set light(t){this._light=t},get lightTransform(){return this._lightTransform},set lightTransform(t){this._lightTransform=t},setupVars:function(){if(this.material&&this.light&&this.lightTransform){var t=bg.base.MatrixState.Current();this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",this.lightTransform),this.shader.setMatrix4("inProjectionMatrix",this.light.projection),this.shader.setValueInt("inCastShadows",this.material.castShadows);var e=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context);this.shader.setTexture("inTexture",e,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setValueFloat("inAlphaCutoff",this.material.alphaCutoff)}}},{},t)}(bg.base.Effect);bg.base.ShadowMapEffect=a,bg.base.ShadowType={HARD:0,SOFT:1,STRATIFIED:2};var s=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._pipeline=new bg.base.Pipeline(t),this._pipeline.renderSurface=new bg.base.TextureSurface(t),this._pipeline.renderSurface.create(),this._pipeline.effect=new bg.base.ShadowMapEffect(t),this._matrixState=new bg.base.MatrixState,this._drawVisitor=new bg.scene.DrawVisitor(this._pipeline,this._matrixState),this._shadowMapSize=new bg.Vector2(2048),this._pipeline.viewport=new bg.Viewport(0,0,this._shadowMapSize.width,this._shadowMapSize.height),this._shadowType=bg.base.ShadowType.SOFT,this._projection=bg.Matrix4.Ortho(-15,15,-15,15,1,50),this._viewMatrix=bg.Matrix4.Identity(),this._shadowColor=bg.Color.Black()}return $traceurRuntime.createClass(e,{get size(){return this._shadowMapSize},set size(t){this._shadowMapSize=t,this._pipeline.viewport=new bg.Viewport(0,0,t.width,t.height)},get shadowType(){return this._shadowType},set shadowType(t){this._shadowType=t},get shadowColor(){return this._shadowColor},set shadowColor(t){this._shadowColor=t},get viewMatrix(){return this._viewMatrix},get projection(){return this._projection},get texture(){return this._pipeline.renderSurface.getTexture(0)},update:function(t,e,n,i){var r=bg.base.MatrixState.Current();if(bg.base.MatrixState.SetCurrent(this._matrixState),this._pipeline.effect.light=n,this._viewMatrix=new bg.Matrix4(i),n.type==bg.base.LightType.DIRECTIONAL){var a=this._viewMatrix.rotation,s=e.transform.matrix.position,o=new bg.Matrix4(e.transform.matrix),u=s.add(o.forwardVector.scale(-e.focus));window.camera=e,window.cameraTransform=e.transform.matrix,this._viewMatrix.identity().translate(u).mult(a).translate(0,0,10).invert(),n.projection=bg.Matrix4.Ortho(-e.focus,e.focus,-e.focus,e.focus,1,300*e.focus)}this._projection=n.projection,this._pipeline.effect.lightTransform=this._viewMatrix,bg.base.Pipeline.SetCurrent(this._pipeline),this._pipeline.clearBuffers(bg.base.ClearBuffers.COLOR_DEPTH),t.accept(this._drawVisitor),bg.base.MatrixState.SetCurrent(r)}},{},t)}(bg.app.ContextObject);bg.base.ShadowMap=s}(),function(){var t={},e=8,n=function(){function n(t){this._context=t,this._textures={}}return $traceurRuntime.createClass(n,{find:function(t){return this._textures[t]},register:function(t,e){e instanceof bg.base.Texture&&(this._textures[t]=e)},unregister:function(t){this._textures[t]&&delete this._textures[t]},clear:function(){this._textures={}}},{SetColorTextureSize:function(t){e=t},GetColorTextureSize:function(){return e},WhiteTexture:function(t){var i=n.Get(t),r=i.find("static-white-color-texture");return r||(r=bg.base.Texture.WhiteTexture(t,new bg.Vector2(e)),i.register("static-white-color-texture",r)),r},BlackTexture:function(t){var i=n.Get(t),r=i.find("static-black-color-texture");return r||(r=bg.base.Texture.BlackTexture(t,new bg.Vector2(e)),i.register("static-black-color-texture",r)),r},NormalTexture:function(t){var i=n.Get(t),r=i.find("static-normal-color-texture");return r||(r=bg.base.Texture.NormalTexture(t,new bg.Vector2(e)),i.register("static-normal-color-texture",r)),r},RandomTexture:function(t){var e=n.Get(t),i=e.find("static-random-color-texture");return i||(i=bg.base.Texture.RandomTexture(t,new bg.Vector2(64)),e.register("static-random-color-texture",i)),i},Get:function(e){return t[e.uuid]||(t[e.uuid]=new n(e)),t[e.uuid]}})}();bg.base.TextureCache=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{acceptType:function(t,e){return bg.utils.Resource.IsImage(t)},load:function(t,e,n){return new Promise(function(i,r){if(n){var a=bg.base.TextureCache.Get(t).find(e);a||(bg.log("Texture "+e+" not found. Loading texture"),a=new bg.base.Texture(t),a.create(),a.bind(),a.minFilter=bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST,a.magFilter=bg.base.TextureFilter.LINEAR,a.setImage(n),a.fileName=e,bg.base.TextureCache.Get(t).register(e,a)),i(a)}else r(new Error("Error loading texture image data"))})}},{},t)}(bg.base.LoaderPlugin);bg.base.TextureLoaderPlugin=i;var r=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{acceptType:function(t,e){return bg.utils.Resource.IsVideo(t)},load:function(t,e,n){return new Promise(function(i,r){if(n){var a=new bg.base.Texture(t);a.create(),a.bind(),a.setVideo(n),a.fileName=e,i(a)}else r(new Error("Error loading video texture data"))})}},{},t)}(bg.base.LoaderPlugin);bg.base.VideoTextureLoaderPlugin=r}(),function(){bg.base.TextureUnit={TEXTURE_0:0,TEXTURE_1:1,TEXTURE_2:2,TEXTURE_3:3,TEXTURE_4:4,TEXTURE_5:5,TEXTURE_6:6,TEXTURE_7:7,TEXTURE_8:8,TEXTURE_9:9,TEXTURE_10:10,TEXTURE_11:11,TEXTURE_12:12,TEXTURE_13:13,TEXTURE_14:14,TEXTURE_15:15,TEXTURE_16:16,TEXTURE_17:17,TEXTURE_18:18,TEXTURE_19:19,TEXTURE_20:20,TEXTURE_21:21,TEXTURE_22:22,TEXTURE_23:23,TEXTURE_24:24,TEXTURE_25:25,TEXTURE_26:26,TEXTURE_27:27,TEXTURE_28:28,TEXTURE_29:29,TEXTURE_30:30},bg.base.TextureWrap={REPEAT:null,CLAMP:null},bg.base.TextureFilter={NEAREST_MIPMAP_NEAREST:null,LINEAR_MIPMAP_NEAREST:null,NEAREST_MIPMAP_LINEAR:null,LINEAR_MIPMAP_LINEAR:null,NEAREST:null,LINEAR:null},bg.base.TextureTarget={TEXTURE_2D:null,CUBE_MAP:null,POSITIVE_X_FACE:null,NEGATIVE_X_FACE:null,POSITIVE_Y_FACE:null,NEGATIVE_Y_FACE:null,POSITIVE_Z_FACE:null,NEGATIVE_Z_FACE:null};var t=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){console.log("TextureImpl: initFlags() method not implemented")},create:function(t){return console.log("TextureImpl: create() method not implemented"),null},setActive:function(t,e){console.log("TextureImpl: setActive() method not implemented")},bind:function(t,e,n){console.log("TextureImpl: bind() method not implemented")},unbind:function(t,e){console.log("TextureImpl: unbind() method not implemented")},setTextureWrapX:function(t,e,n,i){console.log("TextureImpl: setTextureWrapX() method not implemented")},setTextureWrapY:function(t,e,n,i){console.log("TextureImpl: setTextureWrapY() method not implemented")},setImage:function(t,e,n,i,r,a,s){console.log("TextureImpl: setImage() method not implemented")},setImageRaw:function(t,e,n,i,r,a,s,o){console.log("TextureImpl: setImageRaw() method not implemented")},setVideo:function(t,e,n,i,r){console.log("TextureImpl: setVideo() method not implemented")},updateVideoData:function(t,e,n,i){console.log("TextureImpl: updateVideoData() method not implemented")},destroy:function(t,e){console.log("TextureImpl: destroy() method not implemented")}},{})}();bg.base.TextureImpl=t;var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._texture=null,this._fileName="",this._size=new bg.Vector2(0),this._target=bg.base.TextureTarget.TEXTURE_2D,this._minFilter=bg.base.TextureFilter.LINEAR,this._magFilter=bg.base.TextureFilter.LINEAR,this._wrapX=bg.base.TextureWrap.REPEAT,this._wrapY=bg.base.TextureWrap.REPEAT,this._video=null}return $traceurRuntime.createClass(e,{get texture(){return this._texture},get target(){return this._target},set target(t){this._target=t},get fileName(){return this._fileName},set fileName(t){this._fileName=t},set minFilter(t){this._minFilter=t},set magFilter(t){this._magFilter=t},get minFilter(){return this._minFilter},get magFilter(){return this._magFilter},set wrapX(t){this._wrapX=t},set wrapY(t){this._wrapY=t},get wrapX(){return this._wrapX},get wrapY(){return this._wrapY},get size(){return this._size},get video(){return this._video},create:function(){null!==this._texture&&this.destroy(),this._texture=bg.Engine.Get().texture.create(this.context)},setActive:function(t){bg.Engine.Get().texture.setActive(this.context,t)},bind:function(){bg.Engine.Get().texture.bind(this.context,this._target,this._texture)},unbind:function(){e.Unbind(this.context,this._target)},setImage:function(t,e){void 0===e&&(e=!0),this._size.width=t.width,this._size.height=t.height,bg.Engine.Get().texture.setTextureWrapX(this.context,this._target,this._texture,this._wrapX),bg.Engine.Get().texture.setTextureWrapY(this.context,this._target,this._texture,this._wrapY),bg.Engine.Get().texture.setImage(this.context,this._target,this._minFilter,this._magFilter,this._texture,t,e)},setImageRaw:function(t,e,n,i,r){i||(i=this.context.RGBA),r||(r=this.context.UNSIGNED_BYTE),this._size.width=t,this._size.height=e,bg.Engine.Get().texture.setTextureWrapX(this.context,this._target,this._texture,this._wrapX),bg.Engine.Get().texture.setTextureWrapY(this.context,this._target,this._texture,this._wrapY),bg.Engine.Get().texture.setImageRaw(this.context,this._target,this._minFilter,this._magFilter,this._texture,t,e,n,i,r)},setVideo:function(t,e){void 0===e&&(e=!0),this._size.width=t.videoWidth,this._size.height=t.videoHeight,bg.Engine.Get().texture.setVideo(this.context,this._target,this._texture,t,e),this._video=t},destroy:function(){bg.Engine.Get().texture.destroy(this.context,this._texture),this._texture=null,this._minFilter=null,this._magFilter=null,this._fileName=""},valid:function(){return null!==this._texture},update:function(){bg.Engine.Get().texture.updateVideoData(this.context,this._target,this._texture,this._video)}},{ColorTexture:function(t,e,n){var i=new bg.base.Texture(t);i.create(),i.bind();for(var r=n.width*n.height*4,a=[],s=0;s<r;s+=4)a[s]=255*e.r,a[s+1]=255*e.g,a[s+2]=255*e.b,a[s+3]=255*e.a;return a=new Uint8Array(a),i.minFilter=bg.base.TextureFilter.NEAREST,i.magFilter=bg.base.TextureFilter.NEAREST,i.setImageRaw(n.width,n.height,a),i.unbind(),i},WhiteTexture:function(t,n){return e.ColorTexture(t,bg.Color.White(),n)},NormalTexture:function(t,n){return e.ColorTexture(t,new bg.Color(.5,.5,1,1),n)},BlackTexture:function(t,n){return e.ColorTexture(t,bg.Color.Black(),n)},RandomTexture:function(t,e){var n=new bg.base.Texture(t);n.create(),n.bind();for(var i=e.width*e.height*4,r=[],a=0;a<i;a+=4){var s=new bg.Vector3(2*bg.Math.random()-1,2*bg.Math.random()-1,0);s.normalize(),r[a]=255*s.x,r[a+1]=255*s.y,r[a+2]=255*s.z,r[a+3]=1}return r=new Uint8Array(r),n.minFilter=bg.base.TextureFilter.NEAREST,n.magFilter=bg.base.TextureFilter.NEAREST,n.setImageRaw(e.width,e.height,r),n.unbind(),n},SetActive:function(t,e){bg.Engine.Get().texture.setActive(t,e)},Unbind:function(t,e){e||(e=bg.base.TextureTarget.TEXTURE_2D),bg.Engine.Get().texture.unbind(t,e)}},t)}(bg.app.ContextObject);bg.base.Texture=e}(),function(){bg.Math={PI:3.141592653589793,DEG_TO_RAD:.01745329251994,RAD_TO_DEG:57.29577951308233,PI_2:1.5707963267948966,PI_4:.785398163397448,TWO_PI:6.283185307179586,EPSILON:1e-7,Array:Float32Array,FLOAT_MAX:3.402823e38,checkZero:function(t){return t>-this.EPSILON&&t<this.EPSILON?0:t},equals:function(t,e){return Math.abs(t-e)<this.EPSILON},degreesToRadians:function(t){return Math.fround(this.checkZero(t*this.DEG_TO_RAD))},radiansToDegrees:function(t){return Math.fround(this.checkZero(t*this.RAD_TO_DEG))},sin:function(t){return Math.fround(this.checkZero(Math.sin(t)))},cos:function(t){return Math.fround(this.checkZero(Math.cos(t)))},tan:function(t){return Math.fround(this.checkZero(Math.tan(t)))},cotan:function(t){return Math.fround(this.checkZero(1/this.tan(t)))},atan:function(t){return Math.fround(this.checkZero(Math.atan(t)))},atan2:function(t,e){return Math.fround(this.checkZero(Math.atan2f(t,e)))},random:function(){return Math.random()},max:function(t,e){return Math.fround(Math.max(t,e))},min:function(t,e){return Math.fround(Math.min(t,e))},abs:function(t){return Math.fround(Math.abs(t))},sqrt:function(t){return Math.fround(Math.sqrt(t))},lerp:function(t,e,n){return Math.fround((1-n)*t+n*e)},square:function(t){return Math.fround(t*t)}};var t=function(){function t(t){this._target=t}return $traceurRuntime.createClass(t,{get target(){return this._target},set target(t){this._target=t},apply:function(){console.log("WARNING: MatrixStrategy::apply() not overloaded by the child class.")}},{})}();bg.MatrixStrategy=t}(),function(){var t=function(){function t(){var t=void 0!==arguments[0]?arguments[0]:1,e=void 0!==arguments[1]?arguments[1]:0,n=void 0!==arguments[2]?arguments[2]:0,i=void 0!==arguments[3]?arguments[3]:0,r=void 0!==arguments[4]?arguments[4]:1,a=void 0!==arguments[5]?arguments[5]:0,s=void 0!==arguments[6]?arguments[6]:0,o=void 0!==arguments[7]?arguments[7]:0,u=void 0!==arguments[8]?arguments[8]:1;this._m=new bg.Math.Array(9),"number"==typeof t?(this._m[0]=t,this._m[1]=e,this._m[2]=n,this._m[3]=i,this._m[4]=r,this._m[5]=a,this._m[6]=s,this._m[7]=o,this._m[8]=u):this.assign(t)}return $traceurRuntime.createClass(t,{get m(){return this._m},get m00(){return this._m[0]},get m01(){return this._m[1]},get m02(){return this._m[2]},get m10(){return this._m[3]},get m11(){return this._m[4]},get m12(){return this._m[5]},get m20(){return this._m[6]},get m21(){return this._m[7]},get m22(){return this._m[8]},set m00(t){this._m[0]=t},set m01(t){this._m[1]=t},set m02(t){this._m[2]=t},set m10(t){this._m[3]=t},set m11(t){this._m[4]=t},set m12(t){this._m[5]=t},set m20(t){this._m[6]=t},set m21(t){this._m[7]=t},set m22(t){this._m[8]=t},zero:function(){return this._m[0]=this._m[1]=this._m[2]=this._m[3]=this._m[4]=this._m[5]=this._m[6]=this._m[7]=this._m[8]=0,this},identity:function(){return this._m[0]=1,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=1,this._m[5]=0,this._m[6]=0,this._m[7]=0,this._m[8]=1,this},isZero:function(){return 0==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&0==this._m[4]&&0==this._m[5]&&0==this._m[6]&&0==this._m[7]&&0==this._m[8]},isIdentity:function(){return 1==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&1==this._m[4]&&0==this._m[5]&&0==this._m[6]&&0==this._m[7]&&1==this._m[8]},row:function(t){return new bg.Vector3(this._m[3*t],this._m[3*t+1],this._m[3*t+2])},setRow:function(t,e){return this._m[3*t]=e._v[0],this._m[3*t+1]=e._v[1],this._m[3*t+2]=e._v[2],this},get length(){return this._m.length},traspose:function(){var t=new bg.Vector3(this._m[0],this._m[3],this._m[6]),e=new bg.Vector3(this._m[1],this._m[4],this._m[7]),n=new bg.Vector3(this._m[2],this._m[5],this._m[8]);return this.setRow(0,t),this.setRow(1,e),this.setRow(2,n),this},elemAtIndex:function(t){return this._m[t]},assign:function(t){return 9==t.length?(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=t._m[3],this._m[4]=t._m[4],this._m[5]=t._m[5],this._m[6]=t._m[6],this._m[7]=t._m[7],this._m[8]=t._m[8]):16==t.length&&(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=t._m[4],this._m[4]=t._m[5],this._m[5]=t._m[6],this._m[6]=t._m[8],this._m[7]=t._m[9],this._m[8]=t._m[10]),this},equals:function(t){return this._m[0]==t._m[0]&&this._m[1]==t._m[1]&&this._m[2]==t._m[2]&&this._m[3]==t._m[3]&&this._m[4]==t._m[4]&&this._m[5]==t._m[5]&&this._m[6]==t._m[6]&&this._m[7]==t._m[7]&&this._m[8]==t._m[8]},notEquals:function(t){return this._m[0]!=t._m[0]||this._m[1]!=t._m[1]||this._m[2]!=t._m[2]&&this._m[3]!=t._m[3]||this._m[4]!=t._m[4]||this._m[5]!=t._m[5]&&this._m[6]!=t._m[6]||this._m[7]!=t._m[7]||this._m[8]!=t._m[8]},mult:function(t){if("number"==typeof t)this._m[0]*=t,this._m[1]*=t,this._m[2]*=t,this._m[3]*=t,this._m[4]*=t,this._m[5]*=t,this._m[6]*=t,this._m[7]*=t,this._m[8]*=t;else{var e=this._m,n=t._m,i=new bg.Math.Array(9);i[0]=n[0]*e[0]+n[1]*e[1]+n[2]*e[2],i[1]=n[0]*e[1]+n[1]*e[4]+n[2]*e[7],i[2]=n[0]*e[2]+n[1]*e[5]+n[2]*e[8],i[3]=n[3]*e[0]+n[4]*e[3]+n[5]*e[6],i[4]=n[3]*e[1]+n[4]*e[4]+n[5]*e[7],i[5]=n[3]*e[2]+n[4]*e[5]+n[5]*e[8],i[6]=n[6]*e[0]+n[7]*e[3]+n[8]*e[6],i[7]=n[6]*e[1]+n[7]*e[4]+n[8]*e[7],i[8]=n[6]*e[2]+n[7]*e[5]+n[8]*e[8],this._m=i}return this},isNan:function(){return!(Math.isNaN(_m[0])||Math.isNaN(_m[1])||Math.isNaN(_m[2])||Math.isNaN(_m[3])||Math.isNaN(_m[4])||Math.isNaN(_m[5])||Math.isNaN(_m[6])||Math.isNaN(_m[7])||Math.isNaN(_m[8]))},toString:function(){return"["+this._m[0]+", "+this._m[1]+", "+this._m[2]+"]\n ["+this._m[3]+", "+this._m[4]+", "+this._m[5]+"]\n ["+this._m[6]+", "+this._m[7]+", "+this._m[8]+"]"}},{Identity:function(){return new bg.Matrix3(1,0,0,0,1,0,0,0,1)}})}();bg.Matrix3=t;var e=function(){function t(){var t=void 0!==arguments[0]?arguments[0]:0,e=void 0!==arguments[1]?arguments[1]:0,n=void 0!==arguments[2]?arguments[2]:0,i=void 0!==arguments[3]?arguments[3]:0,r=void 0!==arguments[4]?arguments[4]:0,a=void 0!==arguments[5]?arguments[5]:0,s=void 0!==arguments[6]?arguments[6]:0,o=void 0!==arguments[7]?arguments[7]:0,u=void 0!==arguments[8]?arguments[8]:0,l=void 0!==arguments[9]?arguments[9]:0,c=void 0!==arguments[10]?arguments[10]:0,h=void 0!==arguments[11]?arguments[11]:0,f=void 0!==arguments[12]?arguments[12]:0,d=void 0!==arguments[13]?arguments[13]:0,g=void 0!==arguments[14]?arguments[14]:0,m=void 0!==arguments[15]?arguments[15]:0;this._m=new bg.Math.Array(16),"number"==typeof t?(this._m[0]=t,this._m[1]=e,this._m[2]=n,this._m[3]=i,this._m[4]=r,this._m[5]=a,this._m[6]=s,this._m[7]=o,this._m[8]=u,this._m[9]=l,this._m[10]=c,this._m[11]=h,this._m[12]=f,this._m[13]=d,this._m[14]=g,this._m[15]=m):this.assign(t)}return $traceurRuntime.createClass(t,{get m(){return this._m},get m00(){return this._m[0]},get m01(){return this._m[1]},get m02(){return this._m[2]},get m03(){return this._m[3]},get m10(){return this._m[4]},get m11(){return this._m[5]},get m12(){return this._m[6]},get m13(){return this._m[7]},get m20(){return this._m[8]},get m21(){return this._m[9]},get m22(){return this._m[10]},get m23(){return this._m[11]},get m30(){return this._m[12]},get m31(){return this._m[13]},get m32(){return this._m[14]},get m33(){return this._m[15]},set m00(t){this._m[0]=t},set m01(t){this._m[1]=t},set m02(t){this._m[2]=t},set m03(t){this._m[3]=t},set m10(t){this._m[4]=t},set m11(t){this._m[5]=t},set m12(t){this._m[6]=t},set m13(t){this._m[7]=t},set m20(t){this._m[8]=t},set m21(t){this._m[9]=t},set m22(t){this._m[10]=t},set m23(t){this._m[11]=t},set m30(t){this._m[12]=t},set m31(t){this._m[13]=t},set m32(t){this._m[14]=t},set m33(t){this._m[15]=t},zero:function(){return this._m[0]=0,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=0,this._m[5]=0,this._m[6]=0,this._m[7]=0,this._m[8]=0,this._m[9]=0,this._m[10]=0,this._m[11]=0,this._m[12]=0,this._m[13]=0,this._m[14]=0,this._m[15]=0,this},identity:function(){return this._m[0]=1,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=0,this._m[5]=1,this._m[6]=0,this._m[7]=0,this._m[8]=0,this._m[9]=0,this._m[10]=1,this._m[11]=0,this._m[12]=0,this._m[13]=0,this._m[14]=0,this._m[15]=1,this},isZero:function(){return 0==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&0==this._m[4]&&0==this._m[5]&&0==this._m[6]&&0==this._m[7]&&0==this._m[8]&&0==this._m[9]&&0==this._m[10]&&0==this._m[11]&&0==this._m[12]&&0==this._m[13]&&0==this._m[14]&&0==this._m[15]},isIdentity:function(){return 1==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&0==this._m[4]&&1==this._m[5]&&0==this._m[6]&&0==this._m[7]&&0==this._m[8]&&0==this._m[9]&&1==this._m[10]&&0==this._m[11]&&0==this._m[12]&&0==this._m[13]&&0==this._m[14]&&1==this._m[15]},row:function(t){return new bg.Vector4(this._m[4*t],this._m[4*t+1],this._m[4*t+2],this._m[4*t+3])},setRow:function(t,e){return this._m[4*t]=e._v[0],this._m[4*t+1]=e._v[1],this._m[4*t+2]=e._v[2],this._m[4*t+3]=e._v[3],this},get length(){return this._m.length},getMatrix3:function(){return new bg.Matrix3(this._m[0],this._m[1],this._m[2],this._m[4],this._m[5],this._m[6],this._m[8],this._m[9],this._m[10])},perspective:function(t,e,n,i){return this.assign(bg.Matrix4.Perspective(t,e,n,i)),this},frustum:function(t,e,n,i,r,a){return this.assign(bg.Matrix4.Frustum(t,e,n,i,r,a)),this},ortho:function(t,e,n,i,r,a){return this.assign(bg.Matrix4.Ortho(t,e,n,i,r,a)),this},lookAt:function(t,e,n){return this.assign(bg.Matrix4.LookAt(t,e,n)),this},translate:function(t,e,n){return this.mult(bg.Matrix4.Translation(t,e,n)),this},rotate:function(t,e,n,i){return this.mult(bg.Matrix4.Rotation(t,e,n,i)),this},scale:function(t,e,n){return this.mult(bg.Matrix4.Scale(t,e,n)),this},elemAtIndex:function(t){return this._m[t]},assign:function(t){return 9==t.length?(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=0,this._m[4]=t._m[3],this._m[5]=t._m[4],this._m[6]=t._m[5],this._m[7]=0,this._m[8]=t._m[6],this._m[9]=t._m[7],this._m[10]=t._m[8],this._m[11]=0,this._m[12]=0,this._m[13]=0,this._m[14]=0,this._m[15]=1):16==t.length&&(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=t._m[3],this._m[4]=t._m[4],this._m[5]=t._m[5],this._m[6]=t._m[6],this._m[7]=t._m[7],this._m[8]=t._m[8],this._m[9]=t._m[9],this._m[10]=t._m[10],this._m[11]=t._m[11],this._m[12]=t._m[12],this._m[13]=t._m[13],this._m[14]=t._m[14],this._m[15]=t._m[15]),this},equals:function(t){return this._m[0]==t._m[0]&&this._m[1]==t._m[1]&&this._m[2]==t._m[2]&&this._m[3]==t._m[3]&&this._m[4]==t._m[4]&&this._m[5]==t._m[5]&&this._m[6]==t._m[6]&&this._m[7]==t._m[7]&&this._m[8]==t._m[8]&&this._m[9]==t._m[9]&&this._m[10]==t._m[10]&&this._m[11]==t._m[11]&&this._m[12]==t._m[12]&&this._m[13]==t._m[13]&&this._m[14]==t._m[14]&&this._m[15]==t._m[15]},notEquals:function(t){return this._m[0]!=t._m[0]||this._m[1]!=t._m[1]||this._m[2]!=t._m[2]||this._m[3]!=t._m[3]||this._m[4]!=t._m[4]||this._m[5]!=t._m[5]||this._m[6]!=t._m[6]||this._m[7]!=t._m[7]||this._m[8]!=t._m[8]||this._m[9]!=t._m[9]||this._m[10]!=t._m[10]||this._m[11]!=t._m[11]||this._m[12]!=t._m[12]||this._m[13]!=t._m[13]||this._m[14]!=t._m[14]||this._m[15]!=t._m[15]},mult:function(t){if("number"==typeof t)return this._m[0]*=t,this._m[1]*=t,this._m[2]*=t,this._m[3]*=t,this._m[4]*=t,this._m[5]*=t,this._m[6]*=t,this._m[7]*=t,this._m[8]*=t,this._m[9]*=t,this._m[10]*=t,this._m[11]*=t,this._m[12]*=t,this._m[13]*=t,this._m[14]*=t,this._m[15]*=t,this;var e=this._m,n=t._m,i=new bg.Math.Array(16);return i[0]=n[0]*e[0]+n[1]*e[4]+n[2]*e[8]+n[3]*e[12],i[1]=n[0]*e[1]+n[1]*e[5]+n[2]*e[9]+n[3]*e[13],i[2]=n[0]*e[2]+n[1]*e[6]+n[2]*e[10]+n[3]*e[14],i[3]=n[0]*e[3]+n[1]*e[7]+n[2]*e[11]+n[3]*e[15],i[4]=n[4]*e[0]+n[5]*e[4]+n[6]*e[8]+n[7]*e[12],i[5]=n[4]*e[1]+n[5]*e[5]+n[6]*e[9]+n[7]*e[13],i[6]=n[4]*e[2]+n[5]*e[6]+n[6]*e[10]+n[7]*e[14],i[7]=n[4]*e[3]+n[5]*e[7]+n[6]*e[11]+n[7]*e[15],i[8]=n[8]*e[0]+n[9]*e[4]+n[10]*e[8]+n[11]*e[12],i[9]=n[8]*e[1]+n[9]*e[5]+n[10]*e[9]+n[11]*e[13],i[10]=n[8]*e[2]+n[9]*e[6]+n[10]*e[10]+n[11]*e[14],i[11]=n[8]*e[3]+n[9]*e[7]+n[10]*e[11]+n[11]*e[15],i[12]=n[12]*e[0]+n[13]*e[4]+n[14]*e[8]+n[15]*e[12],i[13]=n[12]*e[1]+n[13]*e[5]+n[14]*e[9]+n[15]*e[13],i[14]=n[12]*e[2]+n[13]*e[6]+n[14]*e[10]+n[15]*e[14],i[15]=n[12]*e[3]+n[13]*e[7]+n[14]*e[11]+n[15]*e[15],this._m=i,this},multVector:function(t){"object"==$traceurRuntime.typeof(t)&&t._v&&t._v.length>=3&&(t=t._v);var e=t[0],n=t[1],i=t[2];return new bg.Vector4(this._m[0]*e+this._m[4]*n+this._m[8]*i+1*this._m[12],this._m[1]*e+this._m[5]*n+this._m[9]*i+1*this._m[13],this._m[2]*e+this._m[6]*n+this._m[10]*i+1*this._m[14],this._m[3]*e+this._m[7]*n+this._m[11]*i+1*this._m[15])},invert:function(){var t=this._m[0],e=this._m[1],n=this._m[2],i=this._m[3],r=this._m[4],a=this._m[5],s=this._m[6],o=this._m[7],u=this._m[8],l=this._m[9],c=this._m[10],h=this._m[11],f=this._m[12],d=this._m[13],g=this._m[14],m=this._m[15],p=t*a-e*r,b=t*s-n*r,_=t*o-i*r,v=e*s-n*a,y=e*o-i*a,E=n*o-i*s,T=u*d-l*f,x=u*g-c*f,S=u*m-h*f,w=l*g-c*d,M=l*m-h*d,C=c*m-h*g,R=p*C-b*M+_*w+v*S-y*x+E*T;return R?(R=1/R,this._m[0]=(a*C-s*M+o*w)*R,this._m[1]=(n*M-e*C-i*w)*R,this._m[2]=(d*E-g*y+m*v)*R,this._m[3]=(c*y-l*E-h*v)*R,this._m[4]=(s*S-r*C-o*x)*R,this._m[5]=(t*C-n*S+i*x)*R,this._m[6]=(g*_-f*E-m*b)*R,this._m[7]=(u*E-c*_+h*b)*R,this._m[8]=(r*M-a*S+o*T)*R,this._m[9]=(e*S-t*M-i*T)*R,this._m[10]=(f*y-d*_+m*p)*R,this._m[11]=(l*_-u*y-h*p)*R,this._m[12]=(a*x-r*w-s*T)*R,this._m[13]=(t*w-e*x+n*T)*R,this._m[14]=(d*b-f*v-g*p)*R,this._m[15]=(u*v-l*b+c*p)*R,this):(this.zero(),this)},traspose:function(){var t=new bg.Vector4(this._m[0],this._m[4],this._m[8],this._m[12]),e=new bg.Vector4(this._m[1],this._m[5],this._m[9],this._m[13]),n=new bg.Vector4(this._m[2],this._m[6],this._m[10],this._m[14]),i=new bg.Vector4(this._m[3],this._m[7],this._m[11],this._m[15]);return this.setRow(0,t),this.setRow(1,e),this.setRow(2,n),this.setRow(3,i),this},get rotation(){return new bg.Matrix4(this._m[0],this._m[1],this._m[2],0,this._m[4],this._m[5],this._m[6],0,this._m[8],this._m[9],this._m[10],0,0,0,0,1)},get position(){return new bg.Vector3(this._m[12],this._m[13],this._m[14])},transformDirection:function(t){var e=new bg.Vector3(t),n=new bg.Matrix4(this);return n.setRow(3,new bg.Vector4(0,0,0,1)),e.assign(n.multVector(e).xyz),e.normalize(),e},get forwardVector(){return this.transformDirection(new bg.Vector3(0,0,1))},get rightVector(){return this.transformDirection(new bg.Vector3(1,0,0))},get upVector(){return this.transformDirection(new bg.Vector3(0,1,0))},get backwardVector(){return this.transformDirection(new bg.Vector3(0,0,-1))},get leftVector(){return this.transformDirection(new bg.Vector3(-1,0,0))},get downVector(){return this.transformDirection(new bg.Vector3(0,-1,0))},isNan:function(){return Number.isNaN(this._m[0])||Number.isNaN(this._m[1])||Number.isNaN(this._m[2])||Number.isNaN(this._m[3])||Number.isNaN(this._m[4])||Number.isNaN(this._m[5])||Number.isNaN(this._m[6])||Number.isNaN(this._m[7])||Number.isNaN(this._m[8])||Number.isNaN(this._m[9])||Number.isNaN(this._m[10])||Number.isNaN(this._m[11])||Number.isNaN(this._m[12])||Number.isNaN(this._m[13])||Number.isNaN(this._m[14])||Number.isNaN(this._m[15])},getOrthoValues:function(){return[(1+get23())/get22(),-(1-get23())/get22(),(1-get13())/get11(),-(1+get13())/get11(),-(1+get03())/get00(),(1-get03())/get00()]},getPerspectiveValues:function(){return[get23()/(get22()-1),get23()/(get22()+1),near*(get12()-1)/get11(),near*(get12()+1)/get11(),near*(get02()-1)/get00(),near*(get02()+1)/get00()]},toString:function(){return"["+this._m[0]+", "+this._m[1]+", "+this._m[2]+", "+this._m[3]+"]\n ["+this._m[4]+", "+this._m[5]+", "+this._m[6]+", "+this._m[7]+"]\n ["+this._m[8]+", "+this._m[9]+", "+this._m[10]+", "+this._m[11]+"]\n ["+this._m[12]+", "+this._m[13]+", "+this._m[14]+", "+this._m[15]+"]"}},{Unproject:function(t,e,n,i,r,a){var s=new bg.Matrix4(r);s.mult(i),s.invert();var o=new bg.Vector4((t-a.y)/a.width*2-1,(e-a.x)/a.height*2-1,2*n-1,1),u=new bg.Vector4(s.multVector(o));return 0==u.z?u.set(0):u.set(u.x/u.w,u.y/u.w,u.z/u.w,u.w/u.w),u},Identity:function(){return new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},Perspective:function(t,e,n,i){var r=bg.Math.tan(t*bg.Math.PI/360)*n,a=r*e
;return bg.Matrix4.Frustum(-a,a,-r,r,n,i)},Frustum:function(t,e,n,i,r,a){var s=new bg.Matrix4,o=e-t,u=i-n,l=a-r;return s.setRow(0,new bg.Vector4(2*r/o,0,0,0)),s.setRow(1,new bg.Vector4(0,2*r/u,0,0)),s.setRow(2,new bg.Vector4((e+t)/o,(i+n)/u,-(a+r)/l,-1)),s.setRow(3,new bg.Vector4(0,0,-a*r*2/l,0)),s},Ortho:function(t,e,n,i,r,a){var s=new bg.Matrix4,o=e-t,u=i-n,l=a-r;return s._m[0]=2/o,s._m[1]=0,s._m[2]=0,s._m[3]=0,s._m[4]=0,s._m[5]=2/u,s._m[6]=0,s._m[7]=0,s._m[8]=0,s._m[9]=0,s._m[10]=-2/l,s._m[11]=0,s._m[12]=-(t+e)/o,s._m[13]=-(i+n)/u,s._m[14]=-(a+r)/l,s._m[15]=1,s},LookAt:function(t,e,n){var i=new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),r=new bg.Vector3(e);r.sub(t);var a=new bg.Vector3(n);r.normalize();var s=new bg.Vector3(r);return s.cross(a),a.assign(s),a.cross(r),i.set00(s.x),i.set10(s.y),i.set20(s.z),i.set01(a.x),i.set11(a.y),i.set21(a.z),i.set02(-r.x),i.set12(-r.y),i.set22(-r.z),i.setRow(3,new vwgl.Vector4(-t.x,-t.y,-t.z,1)),i},Translation:function(t,e,n){return"object"==$traceurRuntime.typeof(t)&&t._v&&t._v.length>=3&&(e=t._v[1],n=t._v[2],t=t._v[0]),new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,t,e,n,1)},Rotation:function(t,e,n,i){var r=new bg.Vector3(e,n,i);r.normalize();var a=(new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),bg.Math.cos(t)),s=1-a,o=bg.Math.sin(t);return new bg.Matrix4(r.x*r.x*s+a,r.x*r.y*s+r.z*o,r.x*r.z*s-r.y*o,0,r.y*r.x*s-r.z*o,r.y*r.y*s+a,r.y*r.z*s+r.x*o,0,r.z*r.x*s+r.y*o,r.z*r.y*s-r.x*o,r.z*r.z*s+a,0,0,0,0,1)},Scale:function(t,e,n){return"object"==$traceurRuntime.typeof(t)&&t._v&&t._v.length>=3&&(t=t._v[0],e=t._v[1],n=t._v[2]),new bg.Matrix4(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1)}})}();bg.Matrix4=e}(),function(){var t=function(){function t(t){this._v=t}return $traceurRuntime.createClass(t,{get v(){return this._v},get length(){return this._v.length},get x(){return this._v[0]},set x(t){this._v[0]=t},get y(){return this._v[1]},set y(t){this._v[1]=t},magnitude:function(){for(var t=0,e=0;e<this._v.length;++e){var n=this._v[e];t+=bg.Math.square(n)}return bg.Math.sqrt(t)}},{MinComponents:function(t,e){var n=Math.min(t.length,e.length),i=null;switch(n){case 2:i=new bg.Vector2;break;case 3:i=new bg.Vector3;break;case 4:i=new bg.Vector4}for(var r=0;r<n;++r)i._v[r]=t._v[r]<e._v[r]?t._v[r]:e._v[r];return i},MaxComponents:function(t,e){var n=Math.min(t.length,e.length),i=null;switch(n){case 2:i=new bg.Vector2;break;case 3:i=new bg.Vector3;break;case 4:i=new bg.Vector4}for(var r=0;r<n;++r)i._v[r]=t._v[r]>e._v[r]?t._v[r]:e._v[r];return i}})}();bg.VectorBase=t,bg.Vector=t;var e=function(t){function e(){var t=void 0!==arguments[0]?arguments[0]:0,n=arguments[1];$traceurRuntime.superConstructor(e).call(this,new bg.Math.Array(2)),t instanceof e?(this._v[0]=t._v[0],this._v[1]=t._v[1]):(void 0===n&&(n=t),this._v[0]=t,this._v[1]=n)}return $traceurRuntime.createClass(e,{distance:function(t){return new bg.Vector2(this._v[0]-t._v[0],this._v[1]-t._v[1]).magnitude()},normalize:function(){var t=this.magnitude();return this._v[0]=this._v[0]/t,this._v[1]=this._v[1]/t,this},add:function(t){return this._v[0]+=t._v[0],this._v[1]+=t._v[1],this},sub:function(t){return this._v[0]-=t._v[0],this._v[1]-=t._v[1],this},dot:function(t){return this._v[0]*t._v[0]+this._v[1]*t._v[1]},scale:function(t){return this._v[0]*=t,this._v[1]*=t,this},elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1]},set:function(t,e){void 0===e&&(e=t),this._v[0]=t,this._v[1]=e},get width(){return this._v[0]},get height(){return this._v[1]},set width(t){this._v[0]=t},set height(t){this._v[1]=t},get aspectRatio(){return this._v[0]/this._v[1]},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])},toString:function(){return"["+this._v+"]"}},{Add:function(t,n){return new e(t.x+n.x,t.y+n.y)},Sub:function(t,n){return new e(t.x-n.x,t.y-n.y)}},t)}(t);bg.Vector2=e;var n=function(t){function n(){var t=void 0!==arguments[0]?arguments[0]:0,i=void 0!==arguments[1]?arguments[1]:0,r=void 0!==arguments[2]?arguments[2]:0;$traceurRuntime.superConstructor(n).call(this,new bg.Math.Array(3)),t instanceof e?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=i):t instanceof n?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2]):(void 0===i&&(i=t),void 0===r&&(r=i),this._v[0]=t,this._v[1]=i,this._v[2]=r)}return $traceurRuntime.createClass(n,{get z(){return this._v[2]},set z(t){this._v[2]=t},normalize:function(){var t=this.magnitude();return this._v[0]=this._v[0]/t,this._v[1]=this._v[1]/t,this._v[2]=this._v[2]/t,this},distance:function(t){return new bg.Vector3(this._v[0]-t._v[0],this._v[1]-t._v[1],this._v[2]-t._v[2]).magnitude()},add:function(t){return this._v[0]+=t._v[0],this._v[1]+=t._v[1],this._v[2]+=t._v[2],this},sub:function(t){return this._v[0]-=t._v[0],this._v[1]-=t._v[1],this._v[2]-=t._v[2],this},dot:function(t){return this._v[0]*t._v[0]+this._v[1]*t._v[1]+this._v[2]*t._v[2]},scale:function(t){return this._v[0]*=t,this._v[1]*=t,this._v[2]*=t,this},cross:function(t){var e=this._v[1]*t._v[2]-this._v[2]*t._v[1],n=this._v[2]*t._v[0]-this._v[0]*t._v[2],i=this._v[0]*t._v[1]-this._v[1]*t._v[0];return this._v[0]=e,this._v[1]=n,this._v[2]=i,this},elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]&&this._v[2]==t._v[2]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]||this._v[2]!=t._v[2]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],t._v.length>=3&&(this._v[2]=t._v[2])},set:function(t,e,n){this._v[0]=t,this._v[1]=void 0===e?t:e,this._v[2]=void 0===e?t:void 0===n?e:n},get width(){return this._v[0]},get height(){return this._v[1]},get depth(){return this._v[2]},set width(t){this._v[0]=t},set height(t){this._v[1]=t},set depth(t){this._v[2]=t},get xy(){return new bg.Vector2(this._v[0],this._v[1])},get yz(){return new bg.Vector2(this._v[1],this._v[2])},get xz(){return new bg.Vector2(this._v[0],this._v[2])},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])||isNaN(this._v[2])},toString:function(){return"["+this._v+"]"}},{Add:function(t,e){return new n(t.x+e.x,t.y+e.y,t.z+e.z)},Sub:function(t,e){return new n(t.x-e.x,t.y-e.y,t.z-e.z)}},t)}(t);bg.Vector3=n;var i=function(t){function i(){var t=void 0!==arguments[0]?arguments[0]:0,r=void 0!==arguments[1]?arguments[1]:0,a=void 0!==arguments[2]?arguments[2]:0,s=void 0!==arguments[3]?arguments[3]:0;$traceurRuntime.superConstructor(i).call(this,new bg.Math.Array(4)),t instanceof e?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=r,this._v[3]=a):t instanceof n?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=r):t instanceof i?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=t._v[3]):(void 0===r&&(r=t),void 0===a&&(a=r),void 0===s&&(s=a),this._v[0]=t,this._v[1]=r,this._v[2]=a,this._v[3]=s)}return $traceurRuntime.createClass(i,{get z(){return this._v[2]},set z(t){this._v[2]=t},get w(){return this._v[3]},set w(t){this._v[3]=t},normalize:function(){var t=this.magnitude();return this._v[0]=this._v[0]/t,this._v[1]=this._v[1]/t,this._v[2]=this._v[2]/t,this._v[3]=this._v[3]/t,this},distance:function(t){return new bg.Vector4(this._v[0]-t._v[0],this._v[1]-t._v[1],this._v[2]-t._v[2],this._v[3]-t._v[3]).magnitude()},add:function(t){return this._v[0]+=t._v[0],this._v[1]+=t._v[1],this._v[2]+=t._v[2],this._v[3]+=t._v[3],this},sub:function(t){return this._v[0]-=t._v[0],this._v[1]-=t._v[1],this._v[2]-=t._v[2],this._v[3]-=t._v[3],this},dot:function(t){return this._v[0]*t._v[0]+this._v[1]*t._v[1]+this._v[2]*t._v[2]+this._v[3]*t._v[3]},scale:function(t){return this._v[0]*=t,this._v[1]*=t,this._v[2]*=t,this._v[3]*=t,this},elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]&&this._v[2]==t._v[2]&&this._v[3]==t._v[3]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]||this._v[2]!=t._v[2]||this._v[3]!=t._v[3]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],t._v.length>=3&&(this._v[2]=t._v[2]),4==t._v.length&&(this._v[3]=t._v[3])},set:function(t,e,n,i){this._v[0]=t,this._v[1]=void 0===e?t:e,this._v[2]=void 0===e?t:void 0===n?e:n,this._v[3]=void 0===e?t:void 0===n?e:void 0===i?n:i},get r(){return this._v[0]},get g(){return this._v[1]},get b(){return this._v[2]},get a(){return this._v[3]},set r(t){this._v[0]=t},set g(t){this._v[1]=t},set b(t){this._v[2]=t},set a(t){this._v[3]=t},get xy(){return new bg.Vector2(this._v[0],this._v[1])},get yz(){return new bg.Vector2(this._v[1],this._v[2])},get xz(){return new bg.Vector2(this._v[0],this._v[2])},get xyz(){return new bg.Vector3(this._v[0],this._v[1],this._v[2])},get width(){return this._v[2]},get height(){return this._v[3]},set width(t){this._v[2]=t},set height(t){this._v[3]=t},get aspectRatio(){return 0!=this._v[3]?this._v[2]/this._v[3]:1},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])||isNaN(this._v[2])||isNaN(this._v[3])},toString:function(){return"["+this._v+"]"}},{Add:function(t,e){return new i(t.x+e.x,t.y+e.y,t.z+e.z,t.w+e.w)},Sub:function(t,e){return new i(t.x-e.x,t.y-e.y,t.z-e.z,t.w-e.w)},Yellow:function(){return new bg.Vector4(1,1,0,1)},Orange:function(){return new bg.Vector4(1,.5,0,1)},Red:function(){return new bg.Vector4(1,0,0,1)},Violet:function(){return new bg.Vector4(.5,0,1,1)},Blue:function(){return new bg.Vector4(0,0,1,1)},Green:function(){return new bg.Vector4(0,1,0,1)},White:function(){return new bg.Vector4(1,1,1,1)},LightGray:function(){return new bg.Vector4(.8,.8,.8,1)},Gray:function(){return new bg.Vector4(.5,.5,.5,1)},DarkGray:function(){return new bg.Vector4(.2,.2,.2,1)},Black:function(){return new bg.Vector4(0,0,0,1)},Brown:function(){return new bg.Vector4(.4,.2,0,1)},Transparent:function(){return new bg.Vector4(0,0,0,0)}},t)}(t);bg.Vector4=i,bg.Size2D=e,bg.Size3D=n,bg.Position2D=e,bg.Viewport=i,bg.Color=i;var r=function(t){function e(){var t=void 0!==arguments[0]?arguments[0]:0,n=void 0!==arguments[1]?arguments[1]:0,i=void 0!==arguments[2]?arguments[2]:0,r=void 0!==arguments[3]?arguments[3]:0,a=void 0!==arguments[4]?arguments[4]:0,s=void 0!==arguments[5]?arguments[5]:0;$traceurRuntime.superConstructor(e).call(this,new bg.Math.Array(6)),this._v[0]=t,this._v[1]=n,this._v[2]=i,this._v[3]=r,this._v[4]=a,this._v[5]=s}return $traceurRuntime.createClass(e,{elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]&&this._v[2]==t._v[2]&&this._v[3]==t._v[3]&&this._v[4]==t._v[4]&&this._v[5]==t._v[5]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]||this._v[2]!=t._v[2]||this._v[3]!=t._v[3]||this._v[4]!=t._v[4]||this._v[5]!=t._v[5]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=t._v[3],this._v[4]=t._v[4],this._v[5]=t._v[5]},set:function(t,e,n,i,r,a){this._v[0]=t,this._v[1]=void 0===e?t:e,this._v[2]=void 0===e?t:n,this._v[3]=void 0===e?t:i,this._v[4]=void 0===e?t:r,this._v[5]=void 0===e?t:a},get left(){return this._v[0]},get right(){return this._v[1]},get bottom(){return this._v[2]},get top(){return this._v[3]},get back(){return this._v[4]},get front(){return this._v[5]},set left(t){this._v[0]=t},set right(t){this._v[1]=t},set bottom(t){this._v[2]=t},set top(t){this._v[3]=t},set back(t){this._v[4]=t},set front(t){this._v[5]=t},get width(){return Math.abs(this._v[1]-this._v[0])},get height(){return Math.abs(this._v[3]-this._v[2])},get depth(){return Math.abs(this._v[5]-this._v[4])},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])||isNaN(this._v[2])||isNaN(this._v[3])||isNaN(this._v[4])||isNaN(this._v[5])},toString:function(){return"["+this._v+"]"},isInBounds:function(t){return t.x>=this._v[0]&&t.x<=this._v[1]&&t.y>=this._v[2]&&t.y<=this._v[3]&&t.z>=this._v[4]&&t.z<=this._v[5]}},{},t)}(t);bg.Bounds=r;var a=function(t){function e(t,n,i,r){$traceurRuntime.superConstructor(e).call(this),void 0===t?this.zero():void 0===n?t._v&&t._v.lenght>=4?this.clone(t):t._m&&9==t._m.length?this.initWithMatrix3(t):t._m&&16==t._m.length?this.initWithMatrix4(t):this.zero():void 0!==t&&void 0!==n&&void 0!==i&&void 0!==r?this.initWithValues(t,n,i,r):this.zero()}return $traceurRuntime.createClass(e,{initWithValues:function(t,e,n,i){return this._v[0]=e*bg.Math.sin(t/2),this._v[1]=n*bg.Math.sin(t/2),this._v[2]=i*bg.Math.sin(t/2),this._v[3]=bg.Math.cos(t/2),this},clone:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=t._v[3]},initWithMatrix3:function(t){var e=bg.Math.sqrt(1+t._m[0]+t._m[4]+t._m[8])/2,n=4*e;this._v[0]=(t._m[7]-t._m[5])/e,this._v[1]=(t._m[2]-t._m[6])/n,this._v[2]=(t._m[3]-t._m[1])/n,this._v[3]=e},initWithMatrix4:function(t){var e=bg.Math.sqrt(1+t._m[0]+t._m[5]+t._m[10])/2,n=4*e;this._v[0]=(t._m[9]-t._m[6])/e,this._v[1]=(t._m[2]-t._m[8])/n,this._v[2]=(t._m[4]-t._m[1])/n,this._v[3]=e},getMatrix4:function(){var t=bg.Matrix4.Identity(),e=this._v;return t.setRow(0,new bg.Vector4(1-2*e[1]*e[1]-2*e[2]*e[2],2*e[0]*e[1]-2*e[2]*e[3],2*e[0]*e[2]+2*e[1]*e[3],0)),t.setRow(1,new bg.Vector4(2*e[0]*e[1]+2*e[2]*e[3],1-2*e[0]*e[0]-2*e[2]*e[2],2*e[1]*e[2]-2*e[0]*e[3],0)),t.setRow(2,new bg.Vector4(2*e[0]*e[2]-2*e[1]*e[3],2*e[1]*e[2]+2*e[0]*e[3],1-2*e[0]*e[0]-2*e[1]*e[1],0)),t},getMatrix3:function(){var t=bg.Matrix3.Identity(),e=this._v;return t.setRow(0,new bg.Vector3(1-2*e[1]*e[1]-2*e[2]*e[2],2*e[0]*e[1]-2*e[2]*e[3],2*e[0]*e[2]+2*e[1]*e[3])),t.setRow(1,new bg.Vector3(2*e[0]*e[1]+2*e[2]*e[3],1-2*e[0]*e[0]-2*e[2]*e[2],2*e[1]*e[2]-2*e[0]*e[3])),t.setRow(2,new bg.Vector3(2*e[0]*e[2]-2*e[1]*e[3],2*e[1]*e[2]+2*e[0]*e[3],1-2*e[0]*e[0]-2*e[1]*e[1])),t}},{MakeWithMatrix:function(t){return new e(t)}},t)}(i);bg.Quaternion=a}(),bg.physics={},function(){bg.physics.IntersectionType={NONE:0,POINT:1,LLINE:2};var t=function(){function t(){this._type=null,this._p0=null,this._p1=null}return $traceurRuntime.createClass(t,{get type(){return this._type},get point(){return this._p0},get endPoint(){return this._p1},intersects:function(){return!1}},{RayToPlane:function(t,e){return new bg.physics.RayToPlaneIntersection(t,e)}})}();bg.physics.Intersection=t;var e=function(t){function e(t,n){$traceurRuntime.superConstructor(e).call(this),this._ray=null,this._p0=null,this._type=bg.physics.IntersectionType.POINT;var i=new bg.Vector3(n.origin),r=new bg.Vector3(n.normal),a=new bg.Vector3(t.start),s=new bg.Vector3(t.vector),o=i.sub(a).dot(r),u=s.dot(r);if(0!=u){var l=o/u;l>t.magnitude||(this._ray=bg.physics.Ray.RayWithVector(t.vector,t.start,l),this._p0=this._ray.end)}}return $traceurRuntime.createClass(e,{get ray(){return this._ray},intersects:function(){return null!=this._ray&&null!=this._p0}},{},t)}(bg.physics.Intersection);bg.physics.RayToPlaneIntersection=e}(),function(){var t=function(){function t(){this._transform=bg.Matrix4.Identity()}return $traceurRuntime.createClass(t,{get transform(){return this._transform},set transform(t){this._transform=t},applyTransform:function(t){},calculateTransform:function(){}},{})}();bg.physics.Joint=t,bg.physics.LinkTransformOrder={TRANSLATE_ROTATE:1,ROTATE_TRANSLATE:0};var e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._offset=new bg.Vector3,this._eulerRotation=new bg.Vector3,this._transformOrder=bg.physics.LinkTransformOrder.TRANSLATE_ROTATE}return $traceurRuntime.createClass(e,{applyTransform:function(t){t.mult(this.transform)},assign:function(t){this.yaw=t.yaw,this.pitch=t.pitch,this.roll=t.roll,this.offset.assign(t.offset),this.transformOrder=t.transformOrder},get offset(){return this._offset},set offset(t){this._offset=t,this.calculateTransform()},get eulerRotation(){return this._eulerRotation},set eulerRotation(t){this._eulerRotation=t,this.calculateTransform()},get yaw(){return this._eulerRotation.x},get pitch(){return this._eulerRotation.y},get roll(){return this._eulerRotation.z},set yaw(t){this._eulerRotation.x=t,this.calculateTransform()},set pitch(t){this._eulerRotation.y=t,this.calculateTransform()},set roll(t){this._eulerRotation.z=t,this.calculateTransform()},get transformOrder(){return this._transformOrder},set transformOrder(t){this._transformOrder=t,this.calculateTransform()},multTransform:function(t){switch(this.transformOrder){case bg.physics.LinkTransformOrder.TRANSLATE_ROTATE:t.translate(this.offset.x,this.offset.y,this.offset.z),this.multRotation(t);break;case bg.physics.LinkTransformOrder.TRANSLATE_ROTATE:this.multRotation(t),t.translate(this.offset.x,this.offset.y,this.offset.z)}},multRotation:function(t){t.rotate(this.eulerRotation.z,0,0,1).rotate(this.eulerRotation.y,0,1,0).rotate(this.eulerRotation.x,1,0,0)},calculateTransform:function(){this.transform.identity(),this.multTransform(this.transform)},deserialize:function(t){}},{},t)}(t);bg.physics.LinkJoint=e}(),function(){var t=function(){function t(t,e,n){if(t=t instanceof bg.Vector3&&t,e=e instanceof bg.Vector3&&e,n=n instanceof bg.Vector3&&n,t&&!e)this._normal=new bg.Vector3(t),this._origin=new bg.Vector3(0);else if(t&&e&&!n)this._normal=new bg.Vector3(t),this._origin=new bg.Vector3(e);else if(t&&e&&n){var i=new bg.Vector3(t);i.sub(e);var r=new bg.Vector3(n);r.sub(t),this._origin=new bg.Vector3(p1),this._normal=new bg.Vector3(i),this._normal.cross(r).normalize()}else this._origin=new bg.Vector3(0),this._normal=new bg.Vector3(0,1,0)}return $traceurRuntime.createClass(t,{get normal(){return this._normal},set normal(t){this._normal.assign(t)},get origin(){return this._origin},set origin(t){this._origin.assign(t)},toString:function(){return"P0: "+this._origin.toString()+", normal:"+this._normal.toString()},valid:function(){return!this._origin.isNan()&&!this._normal.isNan()},assign:function(t){return this._origin.assign(t._origin),this._normal.assign(t._normal),this},equals:function(t){return this._origin.equals(t._origin)&&this._normal.equals(t._normal)}},{})}();bg.physics.Plane=t}(),function(){function t(t){t._vector=new bg.Vector3(t._end),t._vector.sub(t._start),t._magnitude=t._vector.magnitude(),t._vector.normalize()}var e=function(){function e(e,n){this._start=e||new bg.Vector3,this._end=n||new bg.Vector3(1),t(this)}return $traceurRuntime.createClass(e,{setWithPoints:function(e,n){return this._start.assign(e),this._end.assign(n),t(),this},setWithVector:function(e,n,i){this._start.assign(n),this._end.assign(n);var r=new bg.Vector3(e);return r.normalize().scale(i),this._end.add(r),t(this),this},setWithScreenPoint:function(e,n,i,r){var a=bg.Matrix4.Unproject(e.x,e.y,0,i,n,r),s=bg.Matrix4.Unproject(e.x,e.y,1,i,n,r);return this._start=a.xyz,this._end=s.xyz,t(this),this},assign:function(t){this._start.assign(t.start),this._end.assign(t.end),this._vector.assign(t.vector),this._magnitude.assign(t.magnitude)},get start(){return this._start},set start(e){this._start.assign(e),t(this)},get end(){return this._end},set end(t){this._end.assign(t)},get vector(){return this._vector},get magnitude(){return this._magnitude},toString:function(){return"start: "+this.start.toString()+", end: "+this.end.toString()}},{RayWithPoints:function(t,n){return new e(t,n)},RayWithVector:function(t,n,i){var r=new e;return r.setWithVector(t,n,i),r},RayWithScreenPoint:function(t,n,i,r){var a=new e;return a.setWithScreenPoint(t,n,i,r),a}})}();bg.physics.Ray=e}(),bg.scene={},function(){var t={},e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._node=null}return $traceurRuntime.createClass(e,{clone:function(){return bg.log("WARNING: Component with typeid "+this.typeId+" does not implmement the clone() method."),null},get node(){return this._node},get typeId(){return this._typeId},removedFromNode:function(t){},addedToNode:function(t){},deserialize:function(t){},component:function(t){return this._node&&this._node.component(t)},get camera(){return this.component("bg.scene.Camera")},get chain(){return this.component("bg.scene.Chain")},get drawable(){return this.component("bg.scene.Drawable")},get inputJoint(){return this.component("bg.scene.InputJoint")},get outputJoint(){return this.component("bg.scene.OutputJoint")},get light(){return this.component("bg.scene.Light")},get transform(){return this.component("bg.scene.Transform")}},{Factory:function(t){}},t)}(bg.LifeCycle);bg.scene.Component=e,bg.scene.registerComponent=function(e,n,i){var r=/function (.+)\(/.exec(n.toString()),a=r&&r.length>1?r[1]:"";e[a]=n,n.prototype._typeId=i||a,t[n]=n}}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._context=t}return $traceurRuntime.createClass(e,{get context(){return this._context},set context(t){this._context=t}},{},t)}(bg.LifeCycle),e=function(t){function e(t){var n=void 0!==arguments[1]?arguments[1]:"";$traceurRuntime.superConstructor(e).call(this,t),this._name=n,this._enabled=!0,this._components={}}return $traceurRuntime.createClass(e,{cloneComponents:function(){var t=new bg.scene.Node(this.context,this.name?"copy of "+this.name:"");t.enabled=this.enabled,forEachComponent(function(e){t.addComponent(e.clone())})},get name(){return this._name},set name(t){this._name=t},get enabled(){return this._enabled},set enabled(t){this._enabled=t},addComponent:function(t){t._node&&t._node.removeComponent(t),t._node=this,this._components[t.typeId]=t,t.addedToNode(this)},removeComponent:function(t){var e="",n=null;return"string"==typeof t?(e=t,n=this.component(t)):t instanceof bg.scene.Component&&(n=t,e=t.typeId),this._components[e]==n&&null!=n&&(delete this._components[e],n.removedFromNode(this),!0)},component:function(t){return this._components[t]},forEachComponent:function(t){var e=Object.keys(this._components),n=!0,i=!1,r=void 0;try{for(var a=void 0,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;t(this._components[o],o,this._components)}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}},someComponent:function(t){var e=Object.keys(this._components),n=!0,i=!1,r=void 0;try{for(var a=void 0,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;if(t(this._components[o],o,this._components))return!0}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return!1},everyComponent:function(t){var e=Object.keys(this._components),n=!0,i=!1,r=void 0;try{for(var a=void 0,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;if(!t(this._components[o],o,this._components))return!1}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return!0},destroy:function(){var t=this;this.forEachComponent(function(e){e.removedFromNode(t)}),this._components={}},init:function(){this.forEachComponent(function(t){t.init()})},frame:function(t){this.forEachComponent(function(e){e._initialized_||(e.init(),e._initialized_=!0),e.frame(t)})},willDisplay:function(t,e){this.forEachComponent(function(n){n.willDisplay(t,e)})},display:function(t,e){this.forEachComponent(function(n){n.display(t,e)})},didDisplay:function(t,e){this.forEachComponent(function(n){n.didDisplay(t,e)})},reshape:function(t,e,n,i){this.forEachComponent(function(t){t.reshape(n,i)})},keyDown:function(t){this.forEachComponent(function(e){e.keyDown(t)})},keyUp:function(t){this.forEachComponent(function(e){e.keyUp(t)})},mouseUp:function(t){this.forEachComponent(function(e){e.mouseUp(t)})},mouseDown:function(t){this.forEachComponent(function(e){e.mouseDown(t)})},mouseMove:function(t){this.forEachComponent(function(e){e.mouseMove(t)})},mouseOut:function(t){this.forEachComponent(function(e){e.mouseOut(t)})},mouseDrag:function(t){this.forEachComponent(function(e){e.mouseDrag(t)})},mouseWheel:function(t){this.forEachComponent(function(e){e.mouseWheel(t)})},touchStart:function(t){this.forEachComponent(function(e){e.touchStart(t)})},touchMove:function(t){this.forEachComponent(function(e){e.touchMove(t)})},touchEnd:function(t){this.forEachComponent(function(e){e.touchEnd(t)})}},{},t)}(t);bg.scene.SceneObject=e}(),function(){function t(e,n){return!(!e||!n)&&(e._parent==n||t(e._parent,n))}var e=function(e){function n(t){var e=void 0!==arguments[1]?arguments[1]:"";$traceurRuntime.superConstructor(n).call(this,t,e),this._children=[],this._parent=null}return $traceurRuntime.createClass(n,{addChild:function(t){t&&!this.isAncientOf(t)&&t!=this&&(t.parent&&t.parent.removeChild(t),this._children.push(t),t._parent=this)},removeChild:function(t){var e=this._children.indexOf(t);e>=0&&this._children.splice(e,1)},get children(){return this._children},get parent(){return this._parent},get sceneRoot(){return this._parent?this._parent.sceneRoot():this},haveChild:function(t){return-1!=this._children.indexOf(t)},isAncientOf:function(e){t(this,e)},accept:function(t){t.visit(this),this._children.forEach(function(e){e.accept(t)}),t.didVisit(this)},acceptReverse:function(t){this._parent&&this._parent.acceptReverse(t),t.visit(this)},destroy:function(){$traceurRuntime.superGet(this,n.prototype,"destroy").call(this),this._children.forEach(function(t){t.destroy()}),this._children=[]}},{},e)}(bg.scene.SceneObject);bg.scene.Node=e;var n=function(){function t(){}return $traceurRuntime.createClass(t,{visit:function(t){},didVisit:function(t){}},{})}();bg.scene.NodeVisitor=n}(),function(){var t=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._near=.1,this._far=100,this._viewport=new bg.Viewport(0,0,512,512)}return $traceurRuntime.createClass(i,{clone:function(){console.log("WARNING: ProjectionStrategy::clone() method not implemented by child class.")},get near(){return this._near},set near(t){this._near=t,apply()},get far(){return this._far},set far(t){this._far=t},get viewport(){return this._viewport},set viewport(t){this._viewport=t}},{Factory:function(t){var i=null;return t&&("PerspectiveProjectionMethod"==t.type?i=new e:"OpticalProjectionMethod"==t.type&&(i=new n),i&&i.deserialize(t)),i}},t)}(bg.MatrixStrategy);bg.scene.ProjectionStrategy=t;var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._fov=60}return $traceurRuntime.createClass(e,{clone:function(){var t=new e;return t.near=this.near,t.far=this.far,t.viewport=this.viewport,t.fov=this.fov,t},get fov(){return this._fov},set fov(t){this._fov=t},apply:function(){this.target&&this.target.perspective(this.fov,this.viewport.aspectRatio,this.near,this.far)},deserialize:function(t){this.near=t.near,this.far=t.far,this.fov=t.fov}},{},t)}(t);bg.scene.PerspectiveProjectionStrategy=e;var n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._focalLength=50,this._frameSize=35}return $traceurRuntime.createClass(e,{clone:function(){var t=new e;return t.near=this.near,t.far=this.far,t.viewport=this.viewport,t.focalLength=this.focalLength,t.frameSize=this.frameSize,t},get focalLength(){return this._focalLength},set focalLength(t){this._focalLength=t},get frameSize(){return this._frameSize},set frameSize(t){this._frameSize=t},apply:function(){if(this.target){var t=2*bg.Math.atan(this.frameSize/(this.focalLength/2));t=bg.Math.radiansToDegrees(t),this.target.perspective(t,this.viewport.aspectRatio,this.near,this.far)}},deserialize:function(t){this.frameSize=t.frameSize,this.focalLength=t.focalLength,this.near=t.near,this.far=t.far}},{},t)}(t);bg.scene.OpticalProjectionStrategy=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._projection=bg.Matrix4.Perspective(60,1,.1,100),this._viewport=new bg.Viewport(0,0,512,512),this._visitor=new bg.scene.TransformVisitor,this._rebuildTransform=!0,this._clearBuffers=bg.base.ClearBuffers.COLOR_DEPTH,this._focus=5,this._projectionStrategy=null}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.Camera;return t._projection=new bg.Matrix4(this._projection),t._viewport=new bg.Matrix4(this._viewport),t._projectionStrategy=this._projectionStrategy?this._projectionStrategy.clone():null,t},get projection(){return this._projection},set projection(t){this._projectionStrategy||(this._projection=t)},get viewport(){return this._viewport},set viewport(t){this._viewport=t,this._projectionStrategy&&(this._projectionStrategy.viewport=t,this._projectionStrategy.apply())},get focus(){return this._focus},set focus(t){this._focus=t},get projectionStrategy(){return this._projectionStrategy},set projectionStrategy(t){this._projectionStrategy=t,this._projectionStrategy&&(this._projectionStrategy.target=this._projection)},get clearBuffers(){return this._clearBuffers},set clearBuffers(t){this._clearBuffers=t},get modelMatrix(){return this._rebuildTransform&&this.node&&(this._visitor.matrix.identity(),this.node.acceptReverse(this._visitor),this._rebuildTransform=!1),this._visitor.matrix},get viewMatrix(){return this._viewMatrix&&!this._rebuildTransform||(this._viewMatrix=new bg.Matrix4(this.modelMatrix),this._viewMatrix.invert()),this._viewMatrix},frame:function(t){this._rebuildTransform=!0}},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,i,"bg.scene.Camera")}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).call(this)}return $traceurRuntime.createClass(e,{clone:function(){return new bg.scene.Chain},willDisplay:function(t,e){if(this.node){var n=bg.Matrix4.Identity();this.node.children.forEach(function(t){var e=t.component("bg.scene.Transform"),i=t.component("bg.scene.InputChainJoint"),r=t.component("bg.scene.OutputChainJoint");i?i.joint.applyTransform(n):n.identity(),e&&e.matrix.assign(n),r&&r.joint.applyTransform(n)})}},deserialize:function(t){}},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,t,"bg.scene.Chain");var e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._joint=new bg.physics.LinkJoint}return $traceurRuntime.createClass(e,{get joint(){return this._joint},set joint(t){this._joint=t},deserialize:function(t){}},{},t)}(bg.scene.Component);bg.scene.ChainJoint=e;var n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),t?this.joint=t:this.joint.transformOrder=bg.physics.LinkTransformOrder.ROTATE_TRANSLATE}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.InputChainJoint;return t.joint.assign(this.joint),t}},{},t)}(e);bg.scene.registerComponent(bg.scene,n,"bg.scene.InputChainJoint");var i=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),t?this.joint=t:this.joint.transformOrder=bg.physics.LinkTransformOrder.TRANSLATE_ROTATE}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.OutputChainJoint;return t.joint.assign(this.joint),t}},{},t)}(e);bg.scene.registerComponent(bg.scene,i,"bg.scene.OutputChainJoint")}(),function(){var t=function(t){function e(){var t=void 0!==arguments[0]?arguments[0]:"";$traceurRuntime.superConstructor(e).call(this),this._name=t,this._items=[]}return $traceurRuntime.createClass(e,{get name(){return this._name},set name(t){this._name=t},clone:function(t){var e=new bg.scene.Drawable;return e.name=t||"copy of "+this.name,this.forEach(function(t,n,i){e.addPolyList(t.clone(),n.clone(),i?new bg.Matrix4(i):null)}),e},instance:function(t){var e=new bg.scene.Drawable;return e.name=t||"copy of "+this.name,this.forEach(function(t,n,i){e.addPolyList(t,n.clone(),i?new bg.Matrix4(i):null)}),e},addPolyList:function(t,e){var n=void 0!==arguments[2]?arguments[2]:null;return!(!t||-1!=this.indexOf(t))&&(e=e||new bg.base.Material,this._items.push({polyList:t,material:e,transform:n}),!0)},removePolyList:function(t){var e=this.indexOf(t);e>=0&&this._items.splice(e,1)},indexOf:function(t){var e=-1;return this._items.some(function(t,n){if(t.polyList==t)return e=n,!0}),e},replacePolyList:function(t,e){return t>=0&&t<this._items.length&&(this._items[t].polyList=e,!0)},replaceMaterial:function(t,e){return t>=0&&t<this._items.length&&(this._items[t].material=e,!0)},replaceTransform:function(t,e){return t>=0&&t<this._items.length&&(this._items[t].transform=e,!0)},getPolyList:function(t){return t>=0&&t<this._items.length&&this._items[t].polyList},getMaterial:function(t){
return t>=0&&t<this._items.length&&this._items[t].material},getTransform:function(t){return t>=0&&t<this._items.length&&this._items[t].transform},forEach:function(t){var e=!0,n=!1,i=void 0;try{for(var r=void 0,a=this._items[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;t(s.polyList,s.material,s.transform)}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}},some:function(t){var e=!0,n=!1,i=void 0;try{for(var r=void 0,a=this._items[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;if(t(s.polyList,s.material,s.transform))return!0}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return!1},every:function(t){var e=!0,n=!1,i=void 0;try{for(var r=void 0,a=this._items[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;if(!t(s.polyList,s.material,s.transform))return!1}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return!0},display:function(t,e){if(!t.effect)throw new Error("Could not draw component: invalid effect found.");this.node.enabled&&this.forEach(function(n,i,r){if(n.visible){var a=t.effect.material;r&&(e.modelMatrixStack.push(),e.modelMatrixStack.mult(r)),t.shouldDraw(i)&&(t.effect.material=i,t.draw(n)),r&&e.modelMatrixStack.pop(),t.effect.material=a}})},setGroupVisible:function(t){var e=void 0===arguments[1]||arguments[1];this.forEach(function(n){n.groupName==t&&(n.visible=e)})},hideGroup:function(t){this.setGroupVisible(t,!1)},showGroup:function(t){this.setGroupVisible(t,!0)},setVisibleByName:function(t){var e=void 0===arguments[1]||arguments[1];this.some(function(n){if(n.name==t)return n.visible=e,!0})},showByName:function(t){this.setVisibleByName(t,!0)},hideByName:function(t){this.setVisibleByName(t,!1)},deserialize:function(t){}},{InstanceNode:function(t){var n=new bg.scene.Node(t.context,t.name?"copy of "+t.name:"");return n.enabled=t.enabled,t.forEachComponent(function(t){var i=null;i=t instanceof e?t.instance():t.clone(),n.addComponent(i)}),n}},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,t,"bg.scene.Drawable")}(),function(){function t(t){n.push(t)}function e(t){var e=n.indexOf(t);-1!=e&&n.splice(e,1)}var n=[],i=function(i){function r(){var t=void 0!==arguments[0]?arguments[0]:null;$traceurRuntime.superConstructor(r).call(this),this._light=t,this._visitor=new bg.scene.TransformVisitor,this._rebuildTransform=!0}return $traceurRuntime.createClass(r,{clone:function(){var t=new bg.scene.Light;return t.light=this.light.clone(),t},get light(){return this._light},set light(t){this._light=t},get transform(){return this._rebuildTransform&&this.node&&(this._visitor.matrix.identity(),this.node.acceptReverse(this._visitor),this._rebuildTransform=!1),this._visitor.matrix},frame:function(t){this._rebuildTransform=!0},removedFromNode:function(t){e(this)},addedToNode:function(e){t(this)}},{GetActiveLights:function(){return n}},i)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,i,"bg.scene.Light")}(),function(){function t(t,e,n,i){var r=new bg.base.PolyList(t),a=e/2,s=n/2,o=i/2;return r.vertex=[a,-s,-o,-a,-s,-o,-a,s,-o,a,s,-o,a,-s,o,a,-s,-o,a,s,-o,a,s,o,-a,-s,o,a,-s,o,a,s,o,-a,s,o,-a,-s,-o,-a,-s,o,-a,s,o,-a,s,-o,-a,s,o,a,s,o,a,s,-o,-a,s,-o,a,-s,o,-a,-s,o,-a,-s,-o,a,-s,-o],r.normal=[0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],r.texCoord0=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],r.texCoord1=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],r.index=[0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8,12,13,14,14,15,12,16,17,18,18,19,16,20,21,22,22,23,20],r.build(),r}function e(t,e,n){var i=e/2,r=n/2,a=new bg.base.PolyList(t);return a.vertex=[-i,0,-r,i,0,-r,i,0,r,i,0,r,-i,0,r,-i,0,-r],a.normal=[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],a.texCoord0=[0,0,1,0,1,1,1,1,0,1,0,0],a.texCoord1=[0,0,1,0,1,1,1,1,0,1,0,0],a.index=[2,1,0,5,4,3],a.build(),a}function n(t,e,n,i){var r=new bg.base.PolyList(t);++n;var a,s,o=1/(i-1),u=1/(n-1),l=[],c=[],h=[],f=[];for(a=0;a<i;a++)for(s=0;s<n;s++){var d=bg.Math.sin(-bg.Math.PI_2+bg.Math.PI*a*o),g=bg.Math.cos(2*bg.Math.PI*s*u)*bg.Math.sin(bg.Math.PI*a*o),m=bg.Math.sin(2*bg.Math.PI*s*u)*bg.Math.sin(bg.Math.PI*a*o);h.push(s*u),h.push(a*o),c.push(g,d,m),l.push(g*e,d*e,m*e)}for(a=0;a<i-1;a++)for(s=0;s<n-1;s++){var p=a*n+s,b=a*n+(s+1),_=(a+1)*n+(s+1),v=(a+1)*n+s;f.push(p),f.push(v),f.push(_),f.push(_),f.push(b),f.push(p)}return r.vertex=l,r.normal=c,r.texCoord0=h,r.texCoord1=h,r.index=f,r.build(),r}function i(t,e){var n=new bg.scene.Drawable(e);return n.addPolyList(t),n}var r=function(){function r(){}return $traceurRuntime.createClass(r,{},{Cube:function(e){var n=void 0!==arguments[1]?arguments[1]:1,r=arguments[2],a=arguments[3];return r=r||n,a=a||n,i(t(e,n,r,a),"Cube")},Plane:function(t){var n=void 0!==arguments[1]?arguments[1]:1,r=arguments[2];return r=r||n,i(e(t,n,r),"Cube")},Sphere:function(t){var e=void 0!==arguments[1]?arguments[1]:1,r=void 0!==arguments[2]?arguments[2]:20,a=arguments[3];return a=a||r,i(n(t,e,r,a),"Cube")}})}();bg.scene.PrimitiveFactory=r}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),this._matrix=t||bg.Matrix4.Identity(),this._globalMatrixValid=!1,this._transformVisitor=new bg.scene.TransformVisitor}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.Transform;return t.matrix=new bg.Matrix4(this.matrix),t},get matrix(){return this._matrix},set matrix(t){this._matrix=t},get globalMatrix(){return this._globalMatrixValid||(this._transformVisitor.clear(),this.node.acceptReverse(this._transformVisitor),this._globalMatrix=this._transformVisitor.matrix),this._globalMatrix},deserialize:function(t){t.transformStrategy||t.transformMatrix},willDisplay:function(t,e){this.node&&this.node.enabled&&(e.modelMatrixStack.push(),e.modelMatrixStack.mult(this.matrix))},didDisplay:function(t,e){this.node&&this.node.enabled&&e.modelMatrixStack.pop(),this._globalMatrixValid=!1}},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,t,"bg.scene.Transform")}(),function(){var t=function(t){function e(t,n){$traceurRuntime.superConstructor(e).call(this),this._pipeline=t||bg.base.Pipeline.Current(),this._matrixState=n||bg.base.MatrixState.Current()}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline},get matrixState(){return this._matrixState},visit:function(t){t.willDisplay(this.pipeline,this.matrixState),t.display(this.pipeline,this.matrixState)},didVisit:function(t){t.didDisplay(this.pipeline,this.matrixState)}},{},t)}(bg.scene.NodeVisitor);bg.scene.DrawVisitor=t;var e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._delta=0}return $traceurRuntime.createClass(e,{get delta(){return this._delta},set delta(t){this._delta=t},visit:function(t){t.frame(this.delta)}},{},t)}(bg.scene.NodeVisitor);bg.scene.FrameVisitor=e;var n=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._matrix=bg.Matrix4.Identity()}return $traceurRuntime.createClass(e,{get matrix(){return this._matrix},clear:function(){this._matrix=bg.Matrix4.Identity()},visit:function(t){var e=t.component("bg.scene.Transform");e&&this._matrix.mult(e.matrix)}},{},t)}(bg.scene.NodeVisitor);bg.scene.TransformVisitor=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{visit:function(t){this._operation&&t[this._operation](this._event)},keyDown:function(t,e){this._operation="keyDown",this._event=e,t.accept(this)},keyUp:function(t,e){this._operation="keyUp",this._event=e,t.accept(this)},mouseUp:function(t,e){this._operation="mouseUp",this._event=e,t.accept(this)},mouseDown:function(t,e){this._operation="mouseDown",this._event=e,t.accept(this)},mouseMove:function(t,e){this._operation="mouseMove",this._event=e,t.accept(this)},mouseOut:function(t,e){this._operation="mouseOut",this._event=e,t.accept(this)},mouseDrag:function(t,e){this._operation="mouseDrag",this._event=e,t.accept(this)},mouseWheel:function(t,e){this._operation="mouseWheel",this._event=e,t.accept(this)},touchStart:function(t,e){this._operation="touchStart",this._event=e,t.accept(this)},touchMove:function(t,e){this._operation="touchMove",this._event=e,t.accept(this)},touchEnd:function(t,e){this._operation="touchEnd",this._event=e,t.accept(this)}},{},t)}(bg.scene.NodeVisitor);bg.scene.InputVisitor=i;var r=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this.clear()}return $traceurRuntime.createClass(e,{get min(){return this._min},get max(){return this._max},get size(){return this._size},clear:function(){this._min=new bg.Vector3(bg.Math.FLOAT_MAX,bg.Math.FLOAT_MAX,bg.Math.FLOAT_MAX),this._max=new bg.Vector3(-bg.Math.FLOAT_MAX,-bg.Math.FLOAT_MAX,-bg.Math.FLOAT_MAX),this._size=new bg.Vector3(0,0,0)},visit:function(t){var e=bg.Matrix4.Identity();if(t.component("bg.scene.Transform")&&(e=t.component("bg.scene.Transform").globalMatrix),t.component("bg.scene.Drawable")){var n=new bg.tools.BoundingBox(t.component("bg.scene.Drawable"),new bg.Matrix4(e));this._min=bg.Vector.MinComponents(this._min,n.min),this._max=bg.Vector.MaxComponents(this._max,n.max),this._size=bg.Vector3.Sub(this._max,this._min)}}},{},t)}(bg.scene.NodeVisitor);bg.scene.BoundingBoxVisitor=r}(),function(){function t(t,e){var n=new Uint8Array(t,e,4);return n=String.fromCharCode(n[0])+String.fromCharCode(n[1])+String.fromCharCode(n[2])+String.fromCharCode(n[3])}function e(t,e){return new DataView(t,e,4).getInt32(0)}function n(t,e){return new DataView(t,e,4).getFloat32(0)}function i(t,e){for(var n={offset:0,data:[]},i=new DataView(t,e,64),r=0;r<16;++r)n.data[r]=i.getFloat32(4*r,!1);return n.offset+=64,n}function r(t,n){var i={offset:0,data:""},r=e(t,n);i.offset+=4;for(var a=new Uint8Array(t,n+4,r),s=0;s<r;++s)i.data+=String.fromCharCode(a[s]);return i.offset+=r,i}function a(t,n){var i={offset:0,data:[]},r=e(t,n);i.offset+=4;for(var a=new DataView(t,n+4,4*r),s=0;s<r;++s)i.data[s]=a.getFloat32(4*s,!1);return i.offset+=4*r,i}function s(t,n){var i={offset:0,data:[]},r=e(t,n);i.offset+=4;for(var a=new DataView(t,n+4,4*r),s=0;s<r;++s)i.data[s]=a.getInt32(4*s,!1);return i.offset+=4*r,i}function o(t,e,n){var i=new bg.physics[n.type];i.offset=new(Function.prototype.bind.apply(bg.Vector3,$traceurRuntime.spread([null],n.offset))),i.roll=n.roll,i.pitch=n.pitch,i.yaw=n.yaw;var r=new bg.scene[e](i);t.addComponent(r)}var u=function(){function u(t,e){this._context=t}return $traceurRuntime.createClass(u,{loadDrawable:function(t,e){this._jointData=null;var n=this.parseData(t);return this.createDrawable(n,e)},parseData:function(o){var u=[],l=null,c=0,h=new Uint8Array(o,0,8);c=8;var f=String.fromCharCode(h[4])+String.fromCharCode(h[5])+String.fromCharCode(h[6])+String.fromCharCode(h[7]);if(1==h[0])throw"Could not open the model file. This file has been saved as computer (little endian) format, try again saving it in network (big endian) format";if("hedr"!=f)throw"File format error. Expecting header";var d={maj:h[1],min:h[2],rev:h[3]};bg.log("vwglb file version: "+d.maj+"."+d.min+"."+d.rev+", big endian");e(o,c);c+=4;var g=t(o,c);if(c+=4,"mtrl"!=g)throw"File format error. Expecting materials definition";var m=r(o,c);if(c+=m.offset,l=JSON.parse(m.data),"proj"==t(o,c)){c+=4,c+=r(o,c).offset,n(o,c),c+=4;var p=i(o,c);c+=p.offset;var b=(p.data,i(o,c));c+=b.offset,b.data}if("join"==t(o,c)){c+=4;var _=r(o,c);c+=_.offset;var v=_.data;try{this._jointData=JSON.parse(v)}catch(t){throw new Error("VWGLB file format reader: Error parsing joint data")}}var y=t(o,c);if("plst"!=y)throw"File format error. Expecting poly list";var E=!1;c+=4;for(var T,x,S,w,M,C,R,O;!E;){y=t(o,c),c+=4;var A=null,j=null;switch(y){case"pnam":A=r(o,c),c+=A.offset,T=A.data;break;case"mnam":A=r(o,c),c+=A.offset,x=A.data;break;case"varr":var I=a(o,c);c+=I.offset,S=I.data;break;case"narr":var P=a(o,c);c+=P.offset,w=P.data;break;case"t0ar":j=a(o,c),c+=j.offset,M=j.data;break;case"t1ar":j=a(o,c),c+=j.offset,C=j.data;break;case"t2ar":j=a(o,c),c+=j.offset,R=j.data;break;case"indx":var L=s(o,c);c+=L.offset,O=L.data;break;case"plst":case"endf":var N={name:T,matName:x,vertices:S,normal:w,texcoord0:M,texcoord1:C,texcoord2:R,indices:O};u.push(N),T="",x="",S=null,w=null,M=null,C=null,R=null,O=null;break;default:throw"File format exception. Unexpected poly list member found"}E="endf"==y}var D={version:d,polyList:u,materials:{}};return l.forEach(function(t){D.materials[t.name]=t}),D},createDrawable:function(t,e){var n=this,i=new bg.scene.Drawable(this.context);i._version=t.version;var r=[];return t.polyList.forEach(function(a){var s=t.materials[a.matName],o=new bg.base.PolyList(n._context);o.name=a.name,o.vertex=a.vertices||o.vertex,o.normal=a.normal||o.normal,o.texCoord0=a.texcoord0||o.texCoord0,o.texCoord1=a.texcoord1||o.texCoord1,o.texCoord2=a.texcoord2||o.texCoord2,o.index=a.indices||o.index,o.groupName=s.groupName,o.visible=s.visible,o.build(),r.push(bg.base.Material.GetMaterialWithJson(n._context,s,e).then(function(t){i.addPolyList(o,t)}))}),Promise.all(r).then(function(){return i})},addComponents:function(t){if(this._jointData){var e=null,n=null;this._jointData.input&&(e=this._jointData.input),this._jointData.output&&this._jointData.output.length&&(n=this._jointData.output[0]),e&&o(t,"InputChainJoint",e),n&&o(t,"OutputChainJoint",n)}}},{})}(),l=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{acceptType:function(t,e){return"vwglb"==bg.utils.Resource.GetExtension(t)},load:function(t,e,n){return new Promise(function(i,r){if(n)try{var a=new u(t,n),s=e.substr(0,e.lastIndexOf("/"));a.loadDrawable(n,s).then(function(e){var n=new bg.scene.Node(t,e.name);n.addComponent(e),a.addComponents(n),i(n)})}catch(t){r(t)}else r(new Error("Error loading drawable. Data is null"))})}},{},t)}(bg.base.LoaderPlugin);bg.base.VWGLBLoaderPlugin=l}(),bg.manipulation={},function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._gizmoOpacity=.9}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline||(this._pipeline=new bg.base.Pipeline(this.context),this._pipeline.blendMode=bg.base.BlendMode.NORMAL,this._pipeline.effect=new bg.manipulation.GizmoEffect(this.context)),this._pipeline},get matrixState(){return this._matrixState||(this._matrixState=new bg.base.MatrixState),this._matrixState},get drawVisitor(){return this._drawVisitor||(this._drawVisitor=new bg.scene.DrawVisitor(this.pipeline,this.matrixState)),this._drawVisitor},get gizmoOpacity(){return this._gizmoOpacity},set gizmoOpacity(t){this._gizmoOpacity=t},get working(){return this._working},startAction:function(t,e){if(this._working=!0,this._startPoint=e,this._currentGizmoData=t,this._currentGizmoData&&this._currentGizmoData.node){var n=this._currentGizmoData.node.component("bg.manipulation.Gizmo");n&&n.beginDrag(this._currentGizmoData.action,e)}},move:function(t,e){if(this._currentGizmoData&&this._currentGizmoData.node){var n=this._currentGizmoData.node.component("bg.manipulation.Gizmo");n&&(t.y=e.viewport.height-t.y,n.drag(this._currentGizmoData.action,this._startPoint,t,e)),this._startPoint=t}},endAction:function(){if(this._currentGizmoData&&this._currentGizmoData.node){var t=this._currentGizmoData.node.component("bg.manipulation.Gizmo");t&&t.endDrag(this._currentGizmoData.action)}this._working=!1,this._startPoint=null,this._currentGizmoData=null},drawGizmos:function(t,e){var n=void 0===arguments[2]||arguments[2],i=bg.base.Pipeline.Current(),r=bg.base.MatrixState.Current();bg.base.Pipeline.SetCurrent(this.pipeline),bg.base.MatrixState.SetCurrent(this.matrixState),this.pipeline.viewport=e.viewport,this.pipeline.effect.matrixState=this.matrixState,n&&this.pipeline.clearBuffers(bg.base.ClearBuffers.DEPTH),this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix);var a=this.pipeline.opacityLayer;this.pipeline.opacityLayer=bg.base.OpacityLayer.NONE,this.pipeline.blend=!0,this.pipeline.effect.gizmoOpacity=this.gizmoOpacity,t.accept(this.drawVisitor),this.pipeline.blend=!1,this.pipeline.opacityLayer=a,i&&bg.base.Pipeline.SetCurrent(i),r&&bg.base.MatrixState.SetCurrent(r)}},{},t)}(bg.app.ContextObject);bg.manipulation.GizmoManager=t}(),function(){function t(){o[bg.webgl1.EngineId]={vertex:"\n\t\t\tattribute vec3 inVertex;\n\t\t\tattribute vec2 inTexCoord;\n\t\t\t\n\t\t\tuniform mat4 inModelMatrix;\n\t\t\tuniform mat4 inViewMatrix;\n\t\t\tuniform mat4 inProjectionMatrix;\n\t\t\t\n\t\t\tvarying vec2 fsTexCoord;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tfsTexCoord = inTexCoord;\n\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t}\n\t\t\t",fragment:"\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tuniform sampler2D inTexture;\n\t\t\tuniform float inOpacity;\n\t\t\t\n\t\t\tvarying vec2 fsTexCoord;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = vec4(texture2D(inTexture,fsTexCoord).rgb,inOpacity);\n\t\t\t}\n\t\t\t"}}function e(t){return/rotate.*fine/i.test(t.name)?bg.manipulation.GizmoAction.ROTATE_FINE:/rotate/i.test(t.name)?bg.manipulation.GizmoAction.ROTATE:/translate/i.test(t.name)?bg.manipulation.GizmoAction.TRANSLATE:void 0}function n(t,n,i){return new Promise(function(r,a){bg.base.Loader.Load(t,n).then(function(t){var n=t.component("bg.scene.Drawable"),a=[];n&&n.forEach(function(t,n){a.push({id:bg.manipulation.Selectable.GetIdentifier(),type:bg.manipulation.SelectableType.GIZMO,plist:t,material:n,action:e(t),node:i})}),r(a)}).catch(function(t){a(t)})})}function i(t,e,n,i,r){r||(r=0);var a=new bg.Vector3(n);a.sub(i).normalize();var s=new bg.Vector3(e);s.sub(i).normalize();var o=a.dot(s),u=Math.acos(o);if(u>=r||0==r){0!=r&&(u=u>=2*r?2*r:r);t.dot(a.cross(s))<0&&(u*=-1);var l=new bg.Quaternion(u,t.x,t.y,t.z);if(l.normalize(),!isNaN(l.x))return l}return new bg.Quaternion(0,0,1,0)}function r(t,e){var n=new bg.Matrix4(t.transform.matrix),i=n.rotation,r=n.position;switch(t._lastPickPoint||(t._lastPickPoint=e.ray.end,t._translateOffset=new bg.Vector3(r),t._translateOffset.sub(e.ray.end)),Math.abs(t.plane)){case bg.Axis.X:n=bg.Matrix4.Translation(r.x,e.point.y+t._translateOffset.y,e.point.z+t._translateOffset.z);break;case bg.Axis.Y:n=bg.Matrix4.Translation(e.point.x+t._translateOffset.x,r.y,e.point.z+t._translateOffset.z);break;case bg.Axis.Z:n=bg.Matrix4.Translation(e.point.x+t._translateOffset.x,e.point.y+t._translateOffset.y,r.z)}return n.mult(i),t._lastPickPoint=e.point,n}function a(t,e,n){var r=new bg.Matrix4(t.transform.matrix),a=r.rotation,s=r.position;if(t._lastPickPoint||(t._lastPickPoint=e.ray.end,t._translateOffset=new bg.Vector3(s),t._translateOffset.sub(e.ray.end)),n){var o=new bg.Matrix4(a);a=i(t.planeAxis,t._lastPickPoint,e.point,s),0==a.x&&0==a.y&&0==a.z&&1==a.w||(r=bg.Matrix4.Translation(s).mult(a.getMatrix4()).mult(o),t._lastPickPoint=e.point)}else{var u=new bg.Matrix4(a);a=i(t.planeAxis,t._lastPickPoint,e.point,s,bg.Math.degreesToRadians(22.5)),0==a.x&&0==a.y&&0==a.z&&1==a.w||(r=bg.Matrix4.Translation(s).mult(a.getMatrix4()).mult(u),t._lastPickPoint=e.point)}return r}function s(t,e){var n=e.viewMatrixStack.matrix.forwardVector,i=e.viewMatrixStack.matrix.upVector,r=new bg.Vector3(1,0,0),a=new bg.Vector3(0,1,0),s=new bg.Vector3(0,0,1),o=new bg.Vector3(-1,0,0),u=new bg.Vector3(0,-1,0),l=new bg.Vector3(0,0,-1);if(Math.acos(i.dot(a))>.9)t.plane=bg.Axis.Y;else{var c=[Math.acos(n.dot(r)),Math.acos(n.dot(a)),Math.acos(n.dot(s)),Math.acos(n.dot(o)),Math.acos(n.dot(u)),Math.acos(n.dot(l))],h=c[0],f=0;switch(c.reduce(function(t,e,n){e<h&&(f=n,h=e)}),f){case 0:t.plane=-bg.Axis.X;break;case 1:t.plane=bg.Axis.Y;break;case 2:t.plane=bg.Axis.Z;break;case 3:t.plane=bg.Axis.X;break;case 4:t.plane=-bg.Axis.Y;break;case 5:t.plane=-bg.Axis.Z}}}var o={},u=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e),t(),this._gizmoOpacity=1}return $traceurRuntime.createClass(n,{get inputVars(){return{vertex:"inVertex",tex0:"inTexCoord"}},set matrixState(t){this._matrixState=t},get matrixState(){return this._matrixState},set texture(t){this._texture=t},get texture(){return this._texture},set gizmoOpacity(t){this._gizmoOpacity=t},get gizmoOpacity(){return this._gizmoOpacity},get shader(){return this._shader||(this._shader=new bg.base.Shader(this.context),this._shader.addShaderSource(bg.base.ShaderType.VERTEX,o[bg.webgl1.EngineId].vertex),this._shader.addShaderSource(bg.base.ShaderType.FRAGMENT,o[bg.webgl1.EngineId].fragment),this._shader.link(),this._shader.status?this._shader.initVars(["inVertex","inTexCoord"],["inModelMatrix","inViewMatrix","inProjectionMatrix","inTexture","inOpacity"]):(console.log(this._shader.compileError),console.log(this._shader.linkError))),this._shader},setupVars:function(){this.shader.setMatrix4("inModelMatrix",this.matrixState.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",new bg.Matrix4(this.matrixState.viewMatrixStack.matrixConst)),this.shader.setMatrix4("inProjectionMatrix",this.matrixState.projectionMatrixStack.matrixConst),this.shader.setTexture("inTexture",this.texture,bg.base.TextureUnit.TEXTURE_0),this.shader.setValueFloat("inOpacity",this.gizmoOpacity)}},{},e)}(bg.base.Effect);bg.manipulation.GizmoEffect=u,bg.manipulation.GizmoAction={TRANSLATE:1,ROTATE:2,ROTATE_FINE:3,NONE:99};var l={},c=function(){function t(t){this._context=t,this._gizmos={}}return $traceurRuntime.createClass(t,{find:function(t){return this._gizmos[t]},register:function(t,e){this._gizmos[t]=e},unregister:function(t){this._gizmos[t]&&delete this._gizmos[t]},clear:function(){this._gizmos={}}},{Get:function(e){return l[e.uuid]||(l[e.uuid]=new t(e)),l[e.uuid]}})}();bg.manipulation.GizmoCache=c;var h=function(t){function e(t){var n=void 0===arguments[1]||arguments[1];$traceurRuntime.superConstructor(e).call(this),this._gizmoPath=t,this._offset=new bg.Vector3(0),this._visible=n,this._gizmoTransform=bg.Matrix4.Identity(),this._gizmoP=bg.Matrix4.Identity()}return $traceurRuntime.createClass(e,{clone:function(){var t=new e(this._gizmoPath);return t.offset.assign(this._offset),t.visible=this._visible,t},get offset(){return this._offset},set offset(t){this._offset=t},get visible(){return this._visible},set visible(t){this._visible=t},get gizmoTransform(){return this._gizmoTransform},beginDrag:function(t,e){},drag:function(t,e,n,i){},endDrag:function(t){},findId:function(t){var e=null;return this._gizmoItems&&this._gizmoItems.some(function(n){if(n.id.r==t.r&&n.id.g==t.g&&n.id.b==t.b&&n.id.a==t.a)return e=n,!0}),e},init:function(){var t=this;this._error||(this._gizmoItems=[],n(this.node.context,this._gizmoPath,this.node).then(function(e){t._gizmoItems=e}).catch(function(e){throw t._error=!0,e}))},frame:function(t){},display:function(t,e){if(this._gizmoItems&&this.visible){if(e.modelMatrixStack.push(),e.modelMatrixStack.set(this._gizmoP).mult(this.gizmoTransform),t.effect instanceof bg.manipulation.ColorPickEffect&&t.opacityLayer&bg.base.OpacityLayer.GIZMOS){var n=t.depthTest;t.depthTest=!1,this._gizmoItems.forEach(function(e){t.effect.pickId=new bg.Color(e.id.a/255,e.id.b/255,e.id.g/255,e.id.r/255),t.draw(e.plist)}),t.depthTest=n}else t.effect instanceof bg.manipulation.GizmoEffect&&this._gizmoItems.forEach(function(e){t.effect.texture=e.material.texture,t.draw(e.plist)});e.modelMatrixStack.pop()}}},{},t)}(bg.scene.Component),f=function(t){function e(t){var n=void 0===arguments[1]||arguments[1];$traceurRuntime.superConstructor(e).call(this,t,n),this._plane=bg.Axis.Y,this._autoPlaneMode=!0}return $traceurRuntime.createClass(e,{get plane(){return this._plane},set plane(t){this._plane=t},get autoPlaneMode(){return this._autoPlaneMode},set autoPlaneMode(t){this._autoPlaneMode=t},get planeAxis(){switch(Math.abs(this.plane)){case bg.Axis.X:return new bg.Vector3(1,0,0);case bg.Axis.Y:return new bg.Vector3(0,1,0);case bg.Axis.Z:return new bg.Vector3(0,0,1)}},get gizmoTransform(){var t=bg.Matrix4.Identity();switch(this.plane){case bg.Axis.X:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),0,0,-1);case bg.Axis.Y:break;case bg.Axis.Z:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),1,0,0);case-bg.Axis.X:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),0,0,1);case-bg.Axis.Y:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(180),0,-1,0);case-bg.Axis.Z:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),-1,0,0)}return t},clone:function(){var t=new e(this._gizmoPath);return t.offset.assign(this._offset),t.visible=this._visible,t},init:function(){$traceurRuntime.superGet(this,e.prototype,"init").call(this),this._gizmoP=bg.Matrix4.Translation(this.transform.matrix.position)},display:function(t,n){this._gizmoItems&&this.visible&&(this.autoPlaneMode&&s(this,n),$traceurRuntime.superGet(this,e.prototype,"display").call(this,t,n))},beginDrag:function(t,e){this._lastPickPoint=null},drag:function(t,e,n,i){if(this.transform){var s=new bg.physics.Plane(this.planeAxis),o=bg.physics.Ray.RayWithScreenPoint(n,i.projection,i.viewMatrix,i.viewport),u=bg.physics.Intersection.RayToPlane(o,s);if(u.intersects()){var l=new bg.Matrix4(this.transform.matrix);switch(this._gizmoP=bg.Matrix4.Translation(this.transform.matrix.position),t){case bg.manipulation.GizmoAction.TRANSLATE:l=r(this,u);break;case bg.manipulation.GizmoAction.ROTATE:l=a(this,u,!1);break;case bg.manipulation.GizmoAction.ROTATE_FINE:l=a(this,u,!0)}this.transform.matrix=l}}},endDrag:function(t){this._lastPickPoint=null}},{},t)}(h);bg.scene.registerComponent(bg.manipulation,h,"bg.manipulation.Gizmo"),bg.scene.registerComponent(bg.manipulation,f,"bg.manipulation.Gizmo")}(),function(){function t(){e[bg.webgl1.EngineId]={vertex:"\n\t\t\tattribute vec3 inVertex;\n\t\t\t\n\t\t\tuniform mat4 inModelMatrix;\n\t\t\tuniform mat4 inViewMatrix;\n\t\t\tuniform mat4 inProjectionMatrix;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t}\n\t\t\t",fragment:"\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tuniform vec4 inColorId;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = inColorId;\n\t\t\t}\n\t\t\t"}}var e={},n=function(n){function i(e){$traceurRuntime.superConstructor(i).call(this,e),t()}return $traceurRuntime.createClass(i,{get inputVars(){return{vertex:"inVertex"}},set matrixState(t){this._matrixState=t},get matrixState(){return this._matrixState},set pickId(t){this._pickId=t},get pickId(){return this._pickId||bg.Color.Transparent()},get shader(){return this._shader||(this._shader=new bg.base.Shader(this.context),this._shader.addShaderSource(bg.base.ShaderType.VERTEX,e[bg.webgl1.EngineId].vertex),this._shader.addShaderSource(bg.base.ShaderType.FRAGMENT,e[bg.webgl1.EngineId].fragment),this._shader.link(),this._shader.status?this._shader.initVars(["inVertex"],["inModelMatrix","inViewMatrix","inProjectionMatrix","inColorId"]):(console.log(this._shader.compileError),console.log(this._shader.linkError))),this._shader},setupVars:function(){this.shader.setMatrix4("inModelMatrix",this.matrixState.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",new bg.Matrix4(this.matrixState.viewMatrixStack.matrixConst)),this.shader.setMatrix4("inProjectionMatrix",this.matrixState.projectionMatrixStack.matrixConst),this.shader.setVector4("inColorId",this.pickId)}},{},n)}(bg.base.Effect);bg.manipulation.ColorPickEffect=n;var i=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),this._target=t}return $traceurRuntime.createClass(e,{get target(){return this._target},set target(t){this._target=t,this._result=null},get result(){return this._result},visit:function(t){var e=t.component("bg.manipulation.Selectable"),n=t.component("bg.manipulation.Gizmo");n&&!n.visible&&(n=null),this._result=this._result||e&&e.findId(this.target)||n&&n.findId(this.target)}},{},t)}(bg.scene.NodeVisitor);bg.manipulation.FindPickIdVisitor=i;var r=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline||(this._pipeline=new bg.base.Pipeline(this.context),this._pipeline.effect=new n(this.context),this._renderSurface=new bg.base.TextureSurface(this.context),this._renderSurface.create(),this._pipeline.renderSurface=this._renderSurface,this._pipeline.clearColor=new bg.Color(0,0,0,0)),this._pipeline},get matrixState(){return this._matrixState||(this._matrixState=new bg.base.MatrixState),this._matrixState},get drawVisitor(){return this._drawVisitor||(this._drawVisitor=new bg.scene.DrawVisitor(this.pipeline,this.matrixState)),this._drawVisitor},pick:function(t,e,n){var r=bg.base.Pipeline.Current(),a=bg.base.MatrixState.Current();bg.base.Pipeline.SetCurrent(this.pipeline),bg.base.MatrixState.SetCurrent(this.matrixState),this.pipeline.viewport=e.viewport,this.pipeline.effect.matrixState=this.matrixState,this.pipeline.clearBuffers(bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH),this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix);var s=this.pipeline.opacityLayer;this.pipeline.opacityLayer=bg.base.OpacityLayer.SELECTION,t.accept(this.drawVisitor),this.pipeline.opacityLayer=bg.base.OpacityLayer.GIZMOS,t.accept(this.drawVisitor),this.pipeline.opacityLayer=s;var o=this.pipeline.renderSurface.readBuffer(new bg.Viewport(n.x,n.y,1,1)),u={r:o[3],g:o[2],b:o[1],a:o[0]},l=new i(u);return t.accept(l),r&&bg.base.Pipeline.SetCurrent(r),a&&bg.base.MatrixState.SetCurrent(a),l.result}},{},t)}(bg.app.ContextObject);bg.manipulation.MousePicker=r}(),function(){function t(){255==a?(a=0,e()):++a}function e(){255==s?(s=0,n()):++s}function n(){255==o?(o=0,i()):++o}function i(){255==u?(u=0,bg.log("WARNING: Maximum number of picker identifier reached.")):++u}function r(){return t(),{r:a,g:s,b:s,a:u}}var a=0,s=0,o=0,u=0,l=!1;bg.manipulation.SelectableType={PLIST:1,GIZMO:2};var c=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._initialized=!1,this._selectablePlist=[]}return $traceurRuntime.createClass(e,{clone:function(){return new e},buildIdentifier:function(){this._initialized=!1,this._selectablePlist=[]},findId:function(t){var e=null;return this._selectablePlist.some(function(n){if(n.id.r==t.r&&n.id.g==t.g&&n.id.b==t.b&&n.id.a==t.a)return e=n,!0}),e},frame:function(t){var e=this;!this._initialized&&this.drawable&&(this.drawable.forEach(function(t,n){var i=r();e._selectablePlist.push({id:i,type:bg.manipulation.SelectableType.PLIST,plist:t,material:n,drawable:e.drawable,node:e.node})}),this._initialized=!0)},display:function(t,e){t.effect instanceof bg.manipulation.ColorPickEffect&&t.opacityLayer&bg.base.OpacityLayer.SELECTION&&this._selectablePlist.forEach(function(e){t.effect.pickId=new bg.Color(e.id.a/255,e.id.b/255,e.id.g/255,e.id.r/255),t.draw(e.plist)})}},{SetSelectMode:function(t){l=t},GetIdentifier:function(){return r()}},t)}(bg.scene.Component);bg.scene.registerComponent(bg.manipulation,c,"bg.manipulation.Selectable")}(),function(){function t(t){var n=bg.app.Mouse.LeftButton(),i=bg.app.Mouse.MiddleButton(),r=bg.app.Mouse.RightButton();switch(!0){case n==t._rotateButtons.left&&i==t._rotateButtons.middle&&r==t._rotateButtons.right:return e.ROTATE;case n==t._panButtons.left&&i==t._panButtons.middle&&r==t._panButtons.right:return e.PAN;case n==t._zoomButtons.left&&i==t._zoomButtons.middle&&r==t._zoomButtons.right:return e.ZOOM}}var e={ROTATE:0,PAN:1,ZOOM:2},n=function(n){function i(){$traceurRuntime.superConstructor(i).call(this),this._rotateButtons={left:!0,middle:!1,right:!1},this._panButtons={left:!1,middle:!1,right:!0},this._zoomButtons={left:!1,middle:!0,right:!1},this._rotation=new bg.Vector2,this._distance=5,this._center=new bg.Vector3,this._rotationSpeed=.2,this._forward=0,this._left=0,this._wheelSpeed=1,this._minFocus=2,this._minPitch=.1,
this._maxPitch=85,this._minDistance=.4,this._maxDistance=24,this._maxX=15,this._minX=-15,this._minY=.1,this._maxY=2,this._maxZ=15,this._minZ=-15}return $traceurRuntime.createClass(i,{setRotateButtons:function(t,e,n){this._rotateButtons={left:t,middle:e,right:n}},setPanButtons:function(t,e,n){this._panButtons={left:t,middle:e,right:n}},setZoomButtons:function(t,e,n){this._zoomButtons={left:t,middle:e,right:n}},get rotation(){return this._rotation},set rotation(t){this._rotation=t},get distance(){return this._distance},set distance(t){this._distance=t},get center(){return this._center},set center(t){this._center=t},get whellSpeed(){this._wheelSpeed},set wheelSpeed(t){this._wheelSpeed=t},get minCameraFocus(){return this._minFocus},set minCameraFocus(t){this._minFocus=t},get minPitch(){return this._minPitch},set minPitch(t){this._minPitch=t},get maxPitch(){return this._maxPitch},set maxPitch(t){this._maxPitch=t},get minDistance(){return this._minDistance},set minDistance(t){this._minDistance=t},get maxDistance(){return this._maxDistance},set maxDistance(t){this._maxDistance=t},frame:function(t){if(this.transform){var e=this.transform.matrix.forwardVector,n=this.transform.matrix.leftVector;e.scale(this._forward),n.scale(this._left),this._center.add(e).add(n);var i=this._rotation.x>this._minPitch?this._rotation.x:this._minPitch;i=i<this._maxPitch?i:this._maxPitch,this._rotation.x=i,this._distance=this._distance>this._minDistance?this._distance:this._minDistance,this._distance=this._distance<this._maxDistance?this._distance:this._maxDistance,this._center.x<this._minX?this._center.x=this._minX:this._center.x>this._maxX&&(this._center.x=this._maxX),this._center.y<this._minY?this._center.y=this._minY:this._center.y>this._maxY&&(this._center.y=this._maxY),this._center.z<this._minZ?this._center.z=this._minZ:this._center.z>this._maxZ&&(this._center.z=this._maxZ),this.transform.matrix.identity().translate(this._center).rotate(bg.Math.degreesToRadians(this._rotation.y),0,1,0).rotate(bg.Math.degreesToRadians(i),-1,0,0).translate(0,0,this._distance)}this.camera&&(this.camera.focus=this._distance>this._minFocus?this._distance:this._minFocus)},mouseDown:function(t){this._lastPos=new bg.Vector2(t.x,t.y)},mouseDrag:function(n){if(this.transform&&this._lastPos){var i=new bg.Vector2(this._lastPos.y-n.y,this._lastPos.x-n.x);switch(this._lastPos.set(n.x,n.y),t(this)){case e.ROTATE:i.x=-1*i.x,this._rotation.add(i.scale(.5));break;case e.PAN:var r=this.transform.matrix.upVector,a=this.transform.matrix.leftVector;r.scale(-.001*i.x*this._distance),a.scale(-.001*i.y*this._distance),this._center.add(r).add(a);break;case e.ZOOM:this._distance+=.01*i.x*this._distance}}},mouseWheel:function(t){var e=this._distance>.01?this._distance:.01;this._distance+=.001*t.delta*e*this._wheelSpeed},touchStart:function(t){this._lastTouch=t.touches},touchMove:function(t){if(this._lastTouch.length==t.touches.length&&this.transform)if(1==this._lastTouch.length){var e=this._lastTouch[0],n=t.touches[0],i=new bg.Vector2(-1*(e.y-n.y),e.x-n.x);this._rotation.add(i.scale(.5))}else if(2==this._lastTouch.length){var r=this._lastTouch[0],a=this._lastTouch[1],s=null,o=null;t.touches.forEach(function(t){t.identifier==r.identifier?s=t:t.identifier==a.identifier&&(o=t)});var u=Math.round(new bg.Vector2(r.x,r.y).sub(new bg.Vector3(a.x,a.y)).magnitude()),l=Math.round(new bg.Vector2(s.x,s.y).sub(new bg.Vector3(o.x,o.y)).magnitude()),c=new bg.Vector2(r.y-s.y,a.x-o.x),h=this.transform.matrix.upVector,f=this.transform.matrix.leftVector;h.scale(-.001*c.x*this._distance),f.scale(-.001*c.y*this._distance),this._center.add(h).add(f),this._distance+=.005*(u-l)*this._distance}this._lastTouch=t.touches}},{},n)}(bg.scene.Component),i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{},{},t)}(bg.scene.Component),r=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.manipulation,n,"bg.manipulation.OrbitCameraController"),bg.scene.registerComponent(bg.manipulation,i,"bg.manipulation.FPSCameraController"),bg.scene.registerComponent(bg.manipulation,r,"bg.manipulation.TargetCameraController")}(),bg.tools={},function(){var t=function(){function t(t,e){this._min=new bg.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._max=new bg.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._center=null,this._size=null,this._halfSize=null,this._vertexArray=[],e=e||bg.Matrix4.Identity(),t instanceof bg.scene.Drawable?this.addDrawable(t,e):t instanceof bg.scene.PolyList&&this.addPolyList(t,e)}return $traceurRuntime.createClass(t,{clear:function(){this._min=bg.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._max=bg.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._center=this._size=this._halfSize=null},get min(){return this._min},get max(){return this._max},get center(){if(!this._center){this.halfSize;this._center=bg.Vector3.Add(this.halfSize,this._min)}return this._center},get size(){return this._size||(this._size=bg.Vector3.Sub(this.max,this.min)),this._size},get halfSize(){return this._halfSize||(this._halfSize=new bg.Vector3(this.size),this._halfSize.scale(.5)),this._halfSize},addPolyList:function(t,e){this._center=this._size=this._halfSize=null;for(var n=0;n<t.vertex.length;n+=3){var i=e.multVector(new bg.Vector3(t.vertex[n],t.vertex[n+1],t.vertex[n+2]));i.x<this._min.x&&(this._min.x=i.x),i.y<this._min.y&&(this._min.y=i.y),i.z<this._min.z&&(this._min.z=i.z),i.x>this._max.x&&(this._max.x=i.x),i.z>this._max.z&&(this._max.z=i.z),i.y>this._max.y&&(this._max.y=i.y)}},addDrawable:function(t,e){var n=this;t.forEach(function(t,i,r){var a=new bg.Matrix4(e);r&&a.mult(r),n.addPolyList(t,a)})}},{})}();bg.tools.BoundingBox=t}(),bg.render={},function(){var t=function(t){function e(t){var n=void 0!==arguments[1]?arguments[1]:bg.base.OpacityLayer.ALL;$traceurRuntime.superConstructor(e).call(this,t),this._pipeline=new bg.base.Pipeline(t),this._pipeline.opacityLayer=n,this._matrixState=bg.base.MatrixState.Current(),this._drawVisitor=new bg.scene.DrawVisitor(this._pipeline,this._matrixState),this._settings={}}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline},get opacityLayer(){return this._pipeline.opacityLayer},get drawVisitor(){return this._drawVisitor},get matrixState(){return this._matrixState},set settings(t){this._settings=t},get settings(){return this._settings},draw:function(t,e){}},{},t)}(bg.app.ContextObject);bg.render.RenderLayer=t}(),function(){bg.render.RenderPath={FORWARD:1,DEFERRED:2},bg.render.RaytracerQuality={low:{maxSamples:20,rayIncrement:.05},mid:{maxSamples:50,rayIncrement:.025},high:{maxSamples:100,rayIncrement:.0125},extreme:{maxSamples:200,rayIncrement:.0062}};var t={debug:{enabled:!1},ambientOcclusion:{enabled:!0,sampleRadius:.4,kernelSize:16,blur:2,maxDistance:300},raytracer:{enabled:!0,quality:bg.render.RaytracerQuality.mid}},e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e),this._frameVisitor=new bg.scene.FrameVisitor,this._settings=t,this._clearColor=bg.Color.Black()}return $traceurRuntime.createClass(n,{get isSupported(){return!1},create:function(){console.log("ERROR: Error creating renderer. The renderer class must implemente the create() method.")},get clearColor(){return this._clearColor},set clearColor(t){this._clearColor=t},frame:function(t,e){this._frameVisitor.delta=e,t.accept(this._frameVisitor)},display:function(t,e){this.draw(t,e)},get settings(){return this._settings}},{Create:function(t,e){var n=null;if(e==bg.render.RenderPath.DEFERRED&&(n=new bg.render.DeferredRenderer(t)),(e==bg.render.RenderPath.FORWARD||n&&!n.isSupported)&&(n=new bg.render.ForwardRenderer(t)),!n.isSupported)throw new Error("No suitable renderer found.");return n.create(),n}},e)}(bg.app.ContextObject);bg.render.Renderer=e}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inLighting",dataType:"sampler2D",role:"value"},{name:"inDiffuse",dataType:"sampler2D",role:"value"},{name:"inPositionMap",dataType:"sampler2D",role:"value"},{name:"inSSAO",dataType:"sampler2D",role:"value"},{name:"inReflection",dataType:"sampler2D",role:"value"},{name:"inMaterial",dataType:"sampler2D",role:"value"},{name:"inOpaqueDepthMap",dataType:"sampler2D",role:"value"},{name:"inViewSize",dataType:"vec2",role:"value"},{name:"inSSAOBlur",dataType:"int",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&(this._fragmentShaderSource.addFunction(t().functions.blur.blur),this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tvec4 lighting = texture2D(inLighting,fsTexCoord);\n\t\t\t\t\tvec4 diffuse = texture2D(inDiffuse,fsTexCoord);\n\t\t\t\t\tvec4 pos = texture2D(inPositionMap,fsTexCoord);\n\t\t\t\t\tvec4 ssao = blur(inSSAO,fsTexCoord,inSSAOBlur,inViewSize);\n\t\t\t\t\tvec4 reflect = texture2D(inReflection,fsTexCoord);\n\t\t\t\t\tvec4 material = texture2D(inMaterial,fsTexCoord);\n\t\t\t\t\tvec4 opaqueDepth = texture2D(inOpaqueDepthMap,fsTexCoord);\n\t\t\t\t\tif (pos.z<opaqueDepth.z && opaqueDepth.w<1.0) {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfloat reflectionAmount = material.b;\n\t\t\t\t\t\tvec3 finalColor = lighting.rgb * (1.0 - reflectionAmount);\n\t\t\t\t\t\tfinalColor += reflect.rgb * reflectionAmount;\n\t\t\t\t\t\tfinalColor *= ssao.rgb;\n\t\t\t\t\t\tgl_FragColor = vec4(finalColor,diffuse.a);\n\t\t\t\t\t}"))),this._fragmentShaderSource},setupVars:function(){this.shader.setVector2("inViewSize",new bg.Vector2(this.viewport.width,this.viewport.height)),this.shader.setTexture("inLighting",this._surface.lightingMap,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inDiffuse",this._surface.diffuseMap,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inPositionMap",this._surface.positionMap,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inSSAO",this._surface.ssaoMap,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inReflection",this._surface.reflectionMap,bg.base.TextureUnit.TEXTURE_4),this.shader.setTexture("inMaterial",this._surface.materialMap,bg.base.TextureUnit.TEXTURE_5),this.shader.setTexture("inOpaqueDepthMap",this._surface.opaqueDepthMap,bg.base.TextureUnit.TEXTURE_6),this.shader.setValueInt("inSSAOBlur",this.ssaoBlur)},set viewport(t){this._viewport=t},get viewport(){return this._viewport},set clearColor(t){this._clearColor=t},get clearColor(){return this._clearColor},set ssaoBlur(t){this._ssaoBlur=t},get ssaoBlur(){return this._ssaoBlur},get colorCorrection(){return this._colorCorrection||(this._colorCorrection={hue:1,saturation:1,lightness:1,brightness:.5,contrast:.5}),this._colorCorrection}},{},e)}(bg.base.TextureEffect);bg.render.DeferredMixEffect=e}(),function(){function t(t,e,n,i){var r=new bg.base.Pipeline(t);return r.renderSurface=n,void 0!==i?(r.opacityLayer=i,r.effect=e):r.textureEffect=e,r}function e(e){var n=e.context,i=e._surfaces,r=e._opacityLayer;e._gbufferUbyte=t(n,new bg.render.GBufferEffect(n),i.gbufferUByteSurface,r),e._gbufferFloat=t(n,new bg.render.PositionGBufferEffect(n),i.gbufferFloatSurface,r),e._shadow=t(n,new bg.render.ShadowEffect(n),i.shadowSurface,bg.base.OpacityLayer.ALL),e._lighting=t(n,new bg.render.LightingEffect(n),i.lightingSurface),e._ssao=t(n,new bg.render.SSAOEffect(n),i.ssaoSurface),e._ssao.clearColor=bg.Color.White(),e._ssrt=t(n,new bg.render.SSRTEffect(n),i.ssrtSurface);var a=e.matrixState;e.ubyteVisitor=new bg.scene.DrawVisitor(e._gbufferUbyte,a),e.floatVisitor=new bg.scene.DrawVisitor(e._gbufferFloat,a),e.shadowVisitor=new bg.scene.DrawVisitor(e._shadow,a),e._mix=t(n,new bg.render.DeferredMixEffect(n),i.mixSurface)}bg.render.SurfaceType={UNDEFINED:0,OPAQUE:1,TRANSPARENT:2};var n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._type=bg.render.SurfaceType.UNDEFINED,this._gbufferUByteSurface=null,this._gbufferFloatSurface=null,this._lightingSurface=null,this._shadowSurface=null,this._ssaoSurface=null,this._mixSurface=null,this._ssrtSurface=null,this._opaqueSurfaces=null}return $traceurRuntime.createClass(e,{createOpaqueSurfaces:function(){this._type=bg.render.SurfaceType.OPAQUE,this.createCommon()},createTransparentSurfaces:function(t){this._type=bg.render.SurfaceType.TRANSPARENT,this._opaqueSurfaces=t,this.createCommon()},resize:function(t){var e=new bg.Vector2(t.width,t.height);this._gbufferUByteSurface.size=e,this._gbufferFloatSurface.size=e,this._lightingSurface.size=e,this._shadowSurface.size=e,this._ssaoSurface.size=e,this._ssrtSurface.size=e,this._mixSurface.size=e},get type(){return this._type},get gbufferUByteSurface(){return this._gbufferUByteSurface},get gbufferFloatSurface(){return this._gbufferFloatSurface},get lightingSurface(){return this._lightingSurface},get shadowSurface(){return this._shadowSurface},get ssaoSurface(){return this._ssaoSurface},get ssrtSurface(){return this._ssrtSurface},get mixSurface(){return this._mixSurface},get diffuse(){return this._gbufferUByteSurface.getTexture(0)},get specular(){return this._gbufferUByteSurface.getTexture(1)},get normal(){return this._gbufferUByteSurface.getTexture(2)},get material(){return this._gbufferUByteSurface.getTexture(3)},get position(){return this._gbufferFloatSurface.getTexture(0)},get lighting(){return this._lightingSurface.getTexture()},get shadow(){return this._shadowSurface.getTexture()},get ambientOcclusion(){return this._ssaoSurface.getTexture()},get reflection(){return this._ssrtSurface.getTexture()},get mix(){return this._mixSurface.getTexture()},get reflectionColor(){return this._type==bg.render.SurfaceType.OPAQUE?this.lighting:this._opaqueSurfaces.lighting},get reflectionDepth(){return this._type==bg.render.SurfaceType.OPAQUE?this.position:this._opaqueSurfaces.position},get mixDepthMap(){return this._type==bg.render.SurfaceType.OPAQUE?this.position:this._opaqueSurfaces.position},createCommon:function(){var t=this.context;this._gbufferUByteSurface=new bg.base.TextureSurface(t),this._gbufferUByteSurface.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._gbufferUByteSurface.resizeOnViewportChanged=!1,this._gbufferFloatSurface=new bg.base.TextureSurface(t),this._gbufferFloatSurface.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.FLOAT},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._gbufferFloatSurface.resizeOnViewportChanged=!1,this._lightingSurface=new bg.base.TextureSurface(t),this._lightingSurface.create(),this._lightingSurface.resizeOnViewportChanged=!1,this._shadowSurface=new bg.base.TextureSurface(t),this._shadowSurface.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._shadowSurface.resizeOnViewportChanged=!1,this._ssaoSurface=new bg.base.TextureSurface(t),this._ssaoSurface.create(),this._ssaoSurface.resizeOnViewportChanged=!1,this._ssrtSurface=new bg.base.TextureSurface(t),this._ssrtSurface.create(),this._ssrtSurface.resizeOnViewportChanged=!1,this._mixSurface=new bg.base.TextureSurface(t),this._mixSurface.create(),this._mixSurface.resizeOnViewportChanged=!1}},{},t)}(bg.app.ContextObject);bg.render.DeferredRenderSurfaces=n;var i=function(t){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{createOpaque:function(){this._opacityLayer=bg.base.OpacityLayer.OPAQUE,this._surfaces=new bg.render.DeferredRenderSurfaces(this.context),this._surfaces.createOpaqueSurfaces(),e(this)},createTransparent:function(t){this._opacityLayer=bg.base.OpacityLayer.TRANSPARENT,this._surfaces=new bg.render.DeferredRenderSurfaces(this.context),this._surfaces.createTransparentSurfaces(t),e(this),this._gbufferUbyte.blend=!0,this._gbufferUbyte.setBlendMode=bg.base.BlendMode.NORMAL,this._gbufferUbyte.clearColor=bg.Color.Transparent(),this._lighting.clearColor=bg.Color.Black(),this.pipeline.clearColor=bg.Color.Transparent()},set shadowMap(t){this._shadowMap=t},get shadowMap(){return this._shadowMap},get pipeline(){return this._mix},get texture(){return this.maps.mix},draw:function(t,e){this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix),this.matrixState.modelMatrixStack.identity(),this.performDraw(t,e)},get maps(){return this._surfaces},resize:function(t){var e=t.viewport;this.maps.resize(new bg.Size2D(e.width,e.height))},performDraw:function(t,e){var n=this;bg.base.Pipeline.SetCurrent(this._gbufferUbyte),this._gbufferUbyte.viewport=e.viewport,this._gbufferUbyte.clearBuffers(),t.accept(this.ubyteVisitor),bg.base.Pipeline.SetCurrent(this._gbufferFloat),this._gbufferFloat.viewport=e.viewport,this._gbufferFloat.clearBuffers(),t.accept(this.floatVisitor),this._lighting.viewport=e.viewport,this._lighting.clearcolor=bg.Color.White(),this._shadow.viewport=e.viewport,bg.scene.Light.GetActiveLights().forEach(function(i){i.light&&i.light.enabled&&i.node&&i.node.enabled&&(i.light.type!=bg.base.LightType.DIRECTIONAL&&i.light.type!=bg.base.LightType.SPOT||(n._shadowMap.update(t,e,i.light,i.transform),bg.base.Pipeline.SetCurrent(n._shadow),n._shadow.viewport=e.viewport,n._shadow.clearBuffers(),n._shadow.effect.light=i.light,n._shadow.effect.shadowMap=n._shadowMap,t.accept(n.shadowVisitor)),bg.base.Pipeline.SetCurrent(n._lighting),n._lighting.textureEffect.light=i.light,n._lighting.textureEffect.lightTransform=i.transform,n._lighting.textureEffect.shadowMap=n.maps.shadow,n._lighting.drawTexture(n.maps))});var i=this.settings.ambientOcclusion.enabled,r=this.settings.raytracer.enabled,a=new bg.Viewport(e.viewport);if(this._ssao.textureEffect.enabled=i,this._ssao.textureEffect.settings.kernelSize=this.settings.ambientOcclusion.kernelSize,this._ssao.textureEffect.settings.sampleRadius=this.settings.ambientOcclusion.sampleRadius,this._ssao.textureEffect.settings.maxDistance=this.settings.ambientOcclusion.maxDistance,i&&(bg.base.Pipeline.SetCurrent(this._ssao),this._ssao.viewport=e.viewport,this._ssao.clearBuffers(),this._ssao.textureEffect.viewport=e.viewport,this._ssao.textureEffect.projectionMatrix=e.projection,this._ssao.drawTexture(this.maps)),bg.base.Pipeline.SetCurrent(this._ssrt),r){this._ssrt.viewport=a,this._ssrt.clearBuffers(),this._ssrt.textureEffect.quality=this.settings.raytracer.quality;var s=e.node.component("bg.scene.Transform");if(s){var o=new bg.Matrix4(e.projection);o.mult(e.viewMatrix),this._ssrt.textureEffect.cameraPosition=o.multVector(s.matrix.position).xyz}this._ssrt.textureEffect.projectionMatrix=e.projection,this._ssrt.drawTexture(this.maps)}bg.base.Pipeline.SetCurrent(this.pipeline),this.pipeline.viewport=e.viewport,this.pipeline.clearBuffers(),this.pipeline.textureEffect.viewport=e.viewport,this.pipeline.textureEffect.ssaoBlur=i?this.settings.ambientOcclusion.blur:1,this.pipeline.drawTexture({lightingMap:this.maps.lighting,diffuseMap:this.maps.diffuse,positionMap:this.maps.position,ssaoMap:i?this.maps.ambientOcclusion:bg.base.TextureCache.WhiteTexture(this.context),reflectionMap:r?this.maps.reflection:this.maps.lighting,materialMap:this.maps.material,opaqueDepthMap:this.maps.mixDepthMap})}},{},t)}(bg.render.RenderLayer);bg.render.DeferredRenderLayer=i}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._size=new bg.Size2D(0)}return $traceurRuntime.createClass(e,{get isSupported(){return bg.base.RenderSurface.MaxColorAttachments()>5&&bg.base.RenderSurface.SupportFormat(bg.base.RenderSurfaceFormat.FLOAT)&&bg.base.RenderSurface.SupportType(bg.base.RenderSurfaceType.DEPTH)},get pipeline(){return this._pipeline},create:function(){var t=this.context;this._opaqueLayer=new bg.render.DeferredRenderLayer(t),this._opaqueLayer.settings=this.settings,this._opaqueLayer.createOpaque(),this._transparentLayer=new bg.render.DeferredRenderLayer(t),this._transparentLayer.settings=this.settings,this._transparentLayer.createTransparent(this._opaqueLayer.maps),this._shadowMap=new bg.base.ShadowMap(t),this._shadowMap.size=new bg.Vector2(2048),this._opaqueLayer.shadowMap=this._shadowMap,this._transparentLayer.shadowMap=this._shadowMap,this._pipeline=new bg.base.Pipeline(t),this._pipeline.textureEffect=new bg.render.RendererMixEffect(t)},draw:function(t,e){this._size.width==e.viewport.width&&this._size.height==e.viewport.height||(this._opaqueLayer.resize(e),this._transparentLayer.resize(e)),this._opaqueLayer.draw(t,e),this._transparentLayer.draw(t,e),bg.base.Pipeline.SetCurrent(this.pipeline),this.pipeline.viewport=e.viewport,this.pipeline.clearBuffers(),this.pipeline.drawTexture({opaque:this._opaqueLayer.texture,transparent:this._transparentLayer.texture,transparentNormal:this._transparentLayer.maps.normal,opaqueDepth:this._opaqueLayer.maps.position,transparentDepth:this._transparentLayer.maps.position})}},{},t)}(bg.render.Renderer);bg.render.DeferredRenderer=t}(),function(){var t=function(t){function e(t,n){$traceurRuntime.superConstructor(e).call(this,t,n),this._pipeline.effect=new bg.base.ForwardEffect(t),this._pipeline.opacityLayer=n,this._lightComponent=null,n==bg.base.OpacityLayer.TRANSPARENT&&(this._pipeline.buffersToClear=bg.base.ClearBuffers.NONE,this._pipeline.blend=!0,this._pipeline.blendMode=bg.base.BlendMode.NORMAL)}return $traceurRuntime.createClass(e,{set lightComponent(t){this._lightComponent=t},get lightComponent(){return this._lightComponent},set shadowMap(t){this._shadowMap=t},get shadowMap(){return this._shadowMap},draw:function(t,e){bg.base.Pipeline.SetCurrent(this._pipeline),this._pipeline.viewport=e.viewport,0!=e.clearBuffers&&this._pipeline.clearBuffers(),this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix),this.willDraw(t,e),t.accept(this._drawVisitor),this.performDraw(t,e)},willDraw:function(t,e){this._lightComponent&&(this._pipeline.effect.light=this._lightComponent.light,this._pipeline.effect.lightTransform=this._lightComponent.transform,this._pipeline.effect.shadowMap=this._shadowMap)},performDraw:function(t,e){this._pipeline.viewport=e.viewport,t.accept(this.drawVisitor)}},{},t)}(bg.render.RenderLayer);bg.render.ForwardRenderLayer=t}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get isSupported(){return!0},create:function(){var t=this.context;this._transparentLayer=new bg.render.ForwardRenderLayer(t,bg.base.OpacityLayer.TRANSPARENT),this._opaqueLayer=new bg.render.ForwardRenderLayer(t,bg.base.OpacityLayer.OPAQUE),this._shadowMap=new bg.base.ShadowMap(t),this._shadowMap.size=new bg.Vector2(2048)},draw:function(t,e){var n=null;bg.scene.Light.GetActiveLights().some(function(t){if(t.light&&t.light.enabled)return n=t,!0}),n&&(this._shadowMap.update(t,e,n.light,n.transform),this._opaqueLayer.lightComponent=n,this._opaqueLayer.shadowMap=this._shadowMap,this._transparentLayer.lightComponent=n,this._transparentLayer.shadowMap=this._shadowMap),this._opaqueLayer.pipeline.clearColor=this.clearColor,this._opaqueLayer.draw(t,e),this._transparentLayer.draw(t,e)}},{},t)}(bg.render.Renderer);bg.render.ForwardRenderer=t}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=null,n=null,i=null,r=null,a={gbuffer_ubyte_vertex:function(){return e||(e=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),e.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.normal,t().inputs.buffers.tangent,t().inputs.buffers.tex0,t().inputs.buffers.tex1]),e.addParameter(t().inputs.matrix.all),e.addParameter([{name:"fsPosition",dataType:"vec3",role:"out"},{name:"fsTex0Coord",dataType:"vec2",role:"out"},{name:"fsTex1Coord",dataType:"vec2",role:"out"},{name:"fsNormal",dataType:"vec3",role:"out"},{name:"fsTangent",dataType:"vec3",role:"out"},{name:"fsBitangent",dataType:"vec3",role:"out"}]),"webgl1"==bg.Engine.Get().id&&e.setMainBody("\n\t\t\t\t\tvec4 viewPos = inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tgl_Position = inProjectionMatrix * viewPos;\n\t\t\t\t\t\n\t\t\t\t\tfsNormal = normalize((inNormalMatrix  * vec4(inNormal,1.0)).xyz);\n\t\t\t\t\tfsTangent = normalize((inNormalMatrix * vec4(inTangent,1.0)).xyz);\n\t\t\t\t\tfsBitangent = cross(fsNormal,fsTangent);\n\t\t\t\t\t\n\t\t\t\t\tfsTex0Coord = inTex0;\n\t\t\t\t\tfsTex1Coord = inTex1;\n\t\t\t\t\tfsPosition = viewPos.xyz;")),e},gbuffer_ubyte_fragment:function(){return n||(n=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),n.appendHeader("#extension GL_EXT_draw_buffers : require"),n.addParameter([{name:"fsPosition",dataType:"vec3",role:"in"},{name:"fsTex0Coord",dataType:"vec2",role:"in"},{name:"fsTex1Coord",dataType:"vec2",role:"in"},{name:"fsNormal",dataType:"vec3",role:"in"},{name:"fsTangent",dataType:"vec3",role:"in"},{name:"fsBitangent",dataType:"vec3",role:"int"}]),n.addParameter(t().inputs.material.all),n.addFunction(t().functions.materials.all),"webgl1"==bg.Engine.Get().id&&n.setMainBody("\n\t\t\t\t\t\tvec4 lightMap = samplerColor(inLightMap,fsTex1Coord,inLightMapOffset,inLightMapScale);\n\t\t\t\t\t\tvec4 diffuse = samplerColor(inTexture,fsTex0Coord,inTextureOffset,inTextureScale) * inDiffuseColor * lightMap;\n\t\t\t\t\t\tif (diffuse.a>=inAlphaCutoff) {\n\t\t\t\t\t\t\tvec3 normal = samplerNormal(inNormalMap,fsTex0Coord,inNormalMapOffset,inNormalMapScale);\n\t\t\t\t\t\t\tnormal = combineNormalWithMap(fsNormal,fsTangent,fsBitangent,normal);\n\t\t\t\t\t\t\tvec4 specular = specularColor(inSpecularColor,inShininessMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinShininessMaskChannel,inShininessMaskInvert);\n\t\t\t\t\t\t\tfloat lightEmission = applyTextureMask(inLightEmission,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMaskChannel,inLightEmissionMaskInvert);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfloat reflectionMask = applyTextureMask(inReflection,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinReflectionMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinReflectionMaskChannel,inReflectionMaskInvert);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tgl_FragData[0] = diffuse;\n\t\t\t\t\t\t\tgl_FragData[1] = specular;\n\t\t\t\t\t\t\tgl_FragData[2] = vec4(normal * 0.5 + 0.5, 1.0);\n\t\t\t\t\t\t\tgl_FragData[3] = vec4(lightEmission,inShininess/255.0,reflectionMask,float(inCastShadows));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}")),n},gbuffer_float_vertex:function(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,null,t().inputs.matrix.model,t().inputs.matrix.view,t().inputs.matrix.projection,null,{name:"fsPosition",dataType:"vec4",role:"out"},{name:"fsTex0Coord",dataType:"vec2",role:"out"}]),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\t\tfsPosition = inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tfsTex0Coord = inTex0;\n\t\t\t\t\t\n\t\t\t\t\tgl_Position = inProjectionMatrix * fsPosition;")),i},gbuffer_float_fragment:function(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),r.addParameter([t().inputs.material.texture,t().inputs.material.textureScale,t().inputs.material.textureOffset,null,{name:"fsPosition",dataType:"vec4",role:"in"},{name:"fsTex0Coord",dataType:"vec2",role:"in"}]),r.addFunction(t().functions.materials.samplerColor),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\tfloat alpha = samplerColor(inTexture,fsTex0Coord,inTextureOffset,inTextureScale).a;\n\t\t\t\t\t// TODO: texture alpha\n\t\t\t\t\t// if (a<alphaCutoff....etc)\n\t\t\t\t\t\n\t\t\t\t\tgl_FragColor = vec4(fsPosition.xyz,gl_FragCoord.z);")),r}},s=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t);var n=[a.gbuffer_ubyte_vertex(),a.gbuffer_ubyte_fragment()];this._material=null,this.setupShaderSource(n)}return $traceurRuntime.createClass(e,{get material(){return this._material},set material(t){this._material=t},setupVars:function(){if(this.material){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst),this.shader.setMatrix4("inNormalMatrix",t.normalMatrix),this.shader.setMatrix4("inViewMatrixInv",t.viewMatrixInvert);var n=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context),i=this.material.lightmap||bg.base.TextureCache.WhiteTexture(this.context),r=this.material.normalMap||bg.base.TextureCache.NormalTexture(this.context);this.shader.setVector4("inDiffuseColor",this.material.diffuse),this.shader.setVector4("inSpecularColor",this.material.specular),this.shader.setValueFloat("inShininess",this.material.shininess),this.shader.setValueFloat("inLightEmission",this.material.lightEmission),this.shader.setValueFloat("inAlphaCutoff",this.material.alphaCutoff),this.shader.setTexture("inTexture",n,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setTexture("inLightMap",i,bg.base.TextureUnit.TEXTURE_1),this.shader.setVector2("inLightMapOffset",this.material.lightmapOffset),this.shader.setVector2("inLightMapScale",this.material.lightmapScale),this.shader.setTexture("inNormalMap",r,bg.base.TextureUnit.TEXTURE_2),this.shader.setVector2("inNormalMapScale",this.material.normalMapScale),this.shader.setVector2("inNormalMapOffset",this.material.normalMapOffset);var a=this.material.shininessMask||bg.base.TextureCache.BlackTexture(this.context),s=this.material.lightEmissionMask||bg.base.TextureCache.WhiteTexture(this.context),o=this.material.reflectionMask||bg.base.TextureCache.BlackTexture(this.context);this.shader.setTexture("inShininessMask",a,bg.base.TextureUnit.TEXTURE_3),this.shader.setVector4("inShininessMaskChannel",this.material.shininessMaskChannelVector),this.shader.setValueInt("inShininessMaskInvert",this.material.shininessMaskInvert),this.shader.setTexture("inLightEmissionMask",s,bg.base.TextureUnit.TEXTURE_4),this.shader.setVector4("inLightEmissionMaskChannel",this.material.lightEmissionMaskChannelVector),this.shader.setValueInt("inLightEmissionMaskInvert",this.material.lightEmissionMaskInvert),this.shader.setValueFloat("inReflection",this.material.reflectionAmount),this.shader.setTexture("inReflectionMask",o,bg.base.TextureUnit.TEXTURE_5),this.shader.setVector4("inReflectionMaskChannel",this.material.reflectionMaskChannelVector),this.shader.setValueInt("inReflectionMaskInvert",this.material.reflectionMaskInvert),this.shader.setValueInt("inCastShadows",this.material.castShadows)}}},{},t)}(bg.base.Effect),o=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t);var n=[a.gbuffer_float_vertex(),a.gbuffer_float_fragment()];this._material=null,this.setupShaderSource(n)}return $traceurRuntime.createClass(e,{get material(){return this._material},set material(t){this._material=t},setupVars:function(){if(this.material){
var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst);var n=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context);this.shader.setTexture("inTexture",n,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale)}}},{},t)}(bg.base.Effect);bg.render.PositionGBufferEffect=o,bg.render.GBufferEffect=s}(),function(){function t(t,e,n,i){bg.base.Pipeline.SetCurrent(t),t.viewport=i.viewport,t.clearBuffers(bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH),n.accept(e)}var e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._pipelines={ubyte:new bg.base.Pipeline(t),float:new bg.base.Pipeline(t)};var e=new bg.base.TextureSurface(t);e.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._pipelines.ubyte.effect=new bg.render.GBufferEffect(t),this._pipelines.ubyte.renderSurface=e;var i=new bg.base.TextureSurface(t);i.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.FLOAT},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._pipelines.float.effect=new bg.render.PositionGBufferEffect(t),this._pipelines.float.renderSurface=i,this._ubyteDrawVisitor=new bg.scene.DrawVisitor(this._pipelines.ubyte,this._matrixState),this._floatDrawVisitor=new bg.scene.DrawVisitor(this._pipelines.float,this._matrixState)}return $traceurRuntime.createClass(n,{get diffuse(){return this._pipelines.ubyte.renderSurface.getTexture(0)},get specular(){return this._pipelines.ubyte.renderSurface.getTexture(1)},get normal(){return this._pipelines.ubyte.renderSurface.getTexture(2)},get material(){return this._pipelines.ubyte.renderSurface.getTexture(3)},get position(){return this._pipelines.float.renderSurface.getTexture(0)},get shadow(){return this._pipelines.ubyte.renderSurface.getTexture(4)},update:function(e,n){t(this._pipelines.ubyte,this._ubyteDrawVisitor,e,n),t(this._pipelines.float,this._floatDrawVisitor,e,n)}},{},e)}(bg.app.ContextObject);bg.render.GBufferSet=e}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inDiffuse",dataType:"sampler2D",role:"value"},{name:"inSpecular",dataType:"sampler2D",role:"value"},{name:"inNormal",dataType:"sampler2D",role:"value"},{name:"inMaterial",dataType:"sampler2D",role:"value"},{name:"inPosition",dataType:"sampler2D",role:"value"},{name:"inShadowMap",dataType:"sampler2D",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),this._fragmentShaderSource.addParameter(t().inputs.lighting.all),this._fragmentShaderSource.addFunction(t().functions.utils.all),this._fragmentShaderSource.addFunction(t().functions.lighting.all),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tvec4 diffuse = texture2D(inDiffuse,fsTexCoord);\n\t\t\t\t\tvec4 specular = texture2D(inSpecular,fsTexCoord);\n\t\t\t\t\tvec3 normal = texture2D(inNormal,fsTexCoord).xyz * 2.0 - 1.0;\n\t\t\t\t\tvec4 material = texture2D(inMaterial,fsTexCoord);\n\t\t\t\t\tvec4 position = texture2D(inPosition,fsTexCoord);\n\t\t\t\t\t\n\t\t\t\t\tvec4 shadowColor = texture2D(inShadowMap,fsTexCoord);\n\t\t\t\t\tfloat shininess = material.g * 255.0;\n\t\t\t\t\tgl_FragColor = getDirectionalLight(inLightAmbient,inLightDiffuse,inLightSpecular,shininess,\n\t\t\t\t\t\t\t\t\t\t-inLightDirection,position.rgb,normal,diffuse,specular,shadowColor);")),this._fragmentShaderSource},setupVars:function(){if(this.shader.setTexture("inDiffuse",this._surface.diffuse,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inSpecular",this._surface.specular,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inNormal",this._surface.normal,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inMaterial",this._surface.material,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inPosition",this._surface.position,bg.base.TextureUnit.TEXTURE_4),this.shader.setTexture("inShadowMap",this._shadowMap,bg.base.TextureUnit.TEXTURE_5),this.light){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setVector4("inLightAmbient",this._light.ambient),this.shader.setVector4("inLightDiffuse",this._light.diffuse),this.shader.setVector4("inLightSpecular",this._light.specular);var n=e.mult(this._lightTransform).rotation.multVector(this._light.direction).xyz;this.shader.setVector3("inLightDirection",n)}},get light(){return this._light},set light(t){this._light=t},get lightTransform(){return this._lightTransform},set lightTransform(t){this._lightTransform=t},get shadowMap(){return this._shadowMap},set shadowMap(t){this._shadowMap=t}},{},e)}(bg.base.TextureEffect);bg.render.LightingEffect=e}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inOpaque",dataType:"sampler2D",role:"value"},{name:"inTransparent",dataType:"sampler2D",role:"value"},{name:"inTransparentNormal",dataType:"sampler2D",role:"value"},{name:"inOpaqueDepth",dataType:"sampler2D",role:"value"},{name:"inTransparentDepth",dataType:"sampler2D",role:"value"},{name:"inRefractionAmount",dataType:"float",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\t\tvec4 opaque = texture2D(inOpaque,fsTexCoord);\n\t\t\t\t\t\tvec4 transparent = texture2D(inTransparent,fsTexCoord);\n\t\t\t\t\t\tvec3 normal = texture2D(inTransparentNormal,fsTexCoord).rgb * 2.0 - 1.0;\n\t\t\t\t\t\tif (transparent.a>0.0) {\n\t\t\t\t\t\t\tfloat refractionFactor = inRefractionAmount / texture2D(inTransparentDepth,fsTexCoord).z;\n\t\t\t\t\t\t\tvec2 offset = fsTexCoord - normal.xy * refractionFactor;\n\t\t\t\t\t\t\tvec4 opaqueDepth = texture2D(inOpaqueDepth,offset);\n\t\t\t\t\t\t\tvec4 transparentDepth = texture2D(inTransparentDepth,offset);\n\t\t\t\t\t\t\t//if (opaqueDepth.w>transparentDepth.w) {\n\t\t\t\t\t\t\t\topaque = texture2D(inOpaque,offset);\n\t\t\t\t\t\t\t//}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvec3 color = opaque.rgb * (1.0 - transparent.a) + transparent.rgb * transparent.a;\n\t\t\t\t\t\tgl_FragColor = vec4(color, 1.0);\n\t\t\t\t\t\t")),this._fragmentShaderSource},setupVars:function(){this.shader.setTexture("inOpaque",this._surface.opaque,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inTransparent",this._surface.transparent,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inTransparentNormal",this._surface.transparentNormal,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inOpaqueDepth",this._surface.opaqueDepth,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inTransparentDepth",this._surface.transparentDepth,bg.base.TextureUnit.TEXTURE_4),this.shader.setValueFloat("inRefractionAmount",this.settings.refractionAmount)},get settings(){return this._settings||(this._currentKernelSize=0,this._settings={refractionAmount:.01}),this._settings}},{},t)}(bg.base.TextureEffect);bg.render.RendererMixEffect=t}(),function(){function t(){return bg.base.ShaderLibrary.Get()}bg.render.ShadowType={HARD:1,SOFT:2};var e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e);var i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT);i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,null,t().inputs.matrix.model,t().inputs.matrix.view,t().inputs.matrix.projection,{name:"inLightProjectionMatrix",dataType:"mat4",role:"value"},{name:"inLightViewMatrix",dataType:"mat4",role:"value"},null,{name:"fsTexCoord",dataType:"vec2",role:"out"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"out"}]),r.addParameter(t().inputs.shadows.all),r.addFunction(t().functions.utils.unpack),r.addFunction(t().functions.lighting.getShadowColor),r.addParameter([t().inputs.material.receiveShadows,t().inputs.material.texture,t().inputs.material.textureOffset,t().inputs.material.textureScale,t().inputs.material.alphaCutoff,null,{name:"fsTexCoord",dataType:"vec2",role:"in"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"in"}]),r.addFunction(t().functions.materials.samplerColor),"webgl1"==bg.Engine.Get().id&&(i.setMainBody("\n\t\t\t\t\tmat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.5, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.0, 0.5, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.5, 0.5, 0.5, 1.0);\n\t\t\t\t\t\n\t\t\t\t\tfsVertexPosFromLight = ScaleMatrix * inLightProjectionMatrix * inLightViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tfsTexCoord = inTex0;\n\t\t\t\t\t\n\t\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);"),r.setMainBody("\n\t\t\t\t\tfloat alpha = samplerColor(inTexture,fsTexCoord,inTextureOffset,inTextureScale).a;\n\t\t\t\t\tif (alpha>inAlphaCutoff) {\n\t\t\t\t\t\tvec4 shadowColor = vec4(1.0);\n\t\t\t\t\t\tif (inReceiveShadows) {\n\t\t\t\t\t\t\tshadowColor = getShadowColor(fsVertexPosFromLight,inShadowMap,inShadowMapSize,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t inShadowType,inShadowStrength,inShadowBias,inShadowColor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tgl_FragColor = shadowColor;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}")),this.setupShaderSource([i,r])}return $traceurRuntime.createClass(n,{beginDraw:function(){if(this.light&&this.shadowMap){var t=bg.base.MatrixState.Current(),e=(new bg.Matrix4(t.viewMatrixStack.matrixConst),this.shadowMap.viewMatrix);this.shader.setMatrix4("inLightProjectionMatrix",this.shadowMap.projection),this.shader.setMatrix4("inLightViewMatrix",e),this.shader.setValueInt("inShadowType",this.shadowMap.shadowType),this.shader.setTexture("inShadowMap",this.shadowMap.texture,bg.base.TextureUnit.TEXTURE_1),this.shader.setVector2("inShadowMapSize",this.shadowMap.size),this.shader.setValueFloat("inShadowStrength",this.light.shadowStrength),this.shader.setVector4("inShadowColor",this.shadowMap.shadowColor),this.shader.setValueFloat("inShadowBias",this.light.shadowBias)}},setupVars:function(){if(this.material&&this.light){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst);var n=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context);this.shader.setTexture("inTexture",n,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setValueFloat("inAlphaCutoff",this.material.alphaCutoff),this.shader.setValueInt("inReceiveShadows",this.material.receiveShadows)}},get material(){return this._material},set material(t){this._material=t},get light(){return this._light},set light(t){this._light=t},get shadowMap(){return this._shadowMap},set shadowMap(t){this._shadowMap=t}},{},e)}(bg.base.Effect);bg.render.ShadowEffect=e}(),function(){var t=64,e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inViewportSize",dataType:"vec2",role:"value"},{name:"inPositionMap",dataType:"sampler2D",role:"value"},{name:"inNormalMap",dataType:"sampler2D",role:"value"},{name:"inProjectionMatrix",dataType:"mat4",role:"value"},{name:"inRandomMap",dataType:"sampler2D",role:"value"},{name:"inRandomMapSize",dataType:"vec2",role:"value"},{name:"inSampleRadius",dataType:"float",role:"value"},{name:"inKernelOffsets",dataType:"vec3",role:"value",vec:t},{name:"inKernelSize",dataType:"int",role:"value"},{name:"inSSAOColor",dataType:"vec4",role:"value"},{name:"inEnabled",dataType:"bool",role:"value"},{name:"inMaxDistance",dataType:"float",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tif (!inEnabled) discard;\n\t\t\t\t\telse {\n\t\t\t\t\t\tvec3 normal = texture2D(inNormalMap,fsTexCoord).xyz * 2.0 - 1.0;\n\t\t\t\t\t\tvec4 vertexPos = texture2D(inPositionMap,fsTexCoord);\n\t\t\t\t\t\tif (distance(vertexPos.xyz,vec3(0))>inMaxDistance || vertexPos.w==1.0) {\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tvec2 noiseScale = vec2(inViewportSize.x/inRandomMapSize.x,inViewportSize.y/inRandomMapSize.y);\n\t\t\t\t\t\t\tvec3 randomVector = texture2D(inRandomMap, fsTexCoord * noiseScale).xyz * 2.0 - 1.0;\n\t\t\t\t\t\t\tvec3 tangent = normalize(randomVector - normal * dot(randomVector, normal));\n\t\t\t\t\t\t\tvec3 bitangent = cross(normal,tangent);\n\t\t\t\t\t\t\tmat3 tbn = mat3(tangent, bitangent, normal);\n\n\t\t\t\t\t\t\tfloat occlusion = 0.0;\n\t\t\t\t\t\t\tfor (int i=0; i<"+t+"; ++i) {\n\t\t\t\t\t\t\t\tif (inKernelSize==i) break;\n\t\t\t\t\t\t\t\tvec3 samplePos = tbn * inKernelOffsets[i];\n\t\t\t\t\t\t\t\tsamplePos = samplePos * inSampleRadius + vertexPos.xyz;\n\n\t\t\t\t\t\t\t\tvec4 offset = inProjectionMatrix * vec4(samplePos, 1.0);\t// -w, w\n\t\t\t\t\t\t\t\toffset.xyz /= offset.w;\t// -1, 1\n\t\t\t\t\t\t\t\toffset.xyz = offset.xyz * 0.5 + 0.5;\t// 0, 1\n\n\t\t\t\t\t\t\t\tvec4 sampleRealPos = texture2D(inPositionMap, offset.xy);\n\t\t\t\t\t\t\t\tif (samplePos.z<sampleRealPos.z) {\n\t\t\t\t\t\t\t\t\tfloat dist = distance(vertexPos.xyz, sampleRealPos.xyz);\n\t\t\t\t\t\t\t\t\tocclusion += dist<inSampleRadius ? 1.0:0.0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tocclusion = 1.0 - (occlusion / float(inKernelSize));\n\t\t\t\t\t\t\tgl_FragColor = clamp(vec4(occlusion, occlusion, occlusion, 1.0) + inSSAOColor, 0.0, 1.0);\n\t\t\t\t\t\t\t//gl_FragColor = vec4(1.0, 0.0, 0.0 ,1.0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}")),this._fragmentShaderSource},setupVars:function(){this.settings.kernelSize>t&&(this.settings.kernelSize=t),this.shader.setVector2("inViewportSize",new bg.Vector2(this.viewport.width,this.viewport.height)),this.shader.setTexture("inPositionMap",this._surface.position,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inNormalMap",this._surface.normal,bg.base.TextureUnit.TEXTURE_1),this.shader.setMatrix4("inProjectionMatrix",this.projectionMatrix),this.shader.setTexture("inRandomMap",this.randomMap,bg.base.TextureUnit.TEXTURE_2),this.shader.setVector2("inRandomMapSize",this.randomMap.size),this.shader.setValueFloat("inSampleRadius",this.settings.sampleRadius),this.shader.setVector3Ptr("inKernelOffsets",this.kernelOffsets),this.shader.setValueInt("inKernelSize",this.settings.kernelSize),this.shader.setVector4("inSSAOColor",this.settings.color),this.shader.setValueInt("inEnabled",this.settings.enabled),this.shader.setValueFloat("inMaxDistance",this.settings.maxDistance)},get viewport(){return this._viewport},set viewport(t){this._viewport=t},get projectionMatrix(){return this._projectionMatrix},set projectionMatrix(t){this._projectionMatrix=t},get randomMap(){return this._randomMap||(this._randomMap=bg.base.TextureCache.RandomTexture(this.context)),this._randomMap},set randomMap(t){this._randomMap=t},get settings(){return this._settings||(this._currentKernelSize=0,this._settings={kernelSize:32,sampleRadius:.3,color:bg.Color.Black(),blur:4,maxDistance:100,enabled:!0}),this._settings},get kernelOffsets(){if(this._currentKernelSize!=this.settings.kernelSize){this._kernelOffsets=[];for(var t=0;t<3*this.settings.kernelSize;t+=3){var e=new bg.Vector3(2*bg.Math.random()-1,2*bg.Math.random()-1,bg.Math.random());e.normalize();var n=t/3/this.settings.kernelSize;n=bg.Math.lerp(.1,1,n*n),e.scale(n),this._kernelOffsets.push(e.x),this._kernelOffsets.push(e.y),this._kernelOffsets.push(e.z)}this._currentKernelSize=this.settings.kernelSize}return this._kernelOffsets}},{},e)}(bg.base.TextureEffect);bg.render.SSAOEffect=e}(),function(){bg.render.RaytracerQuality={low:{maxSamples:20,rayIncrement:.05},mid:{maxSamples:50,rayIncrement:.025},high:{maxSamples:100,rayIncrement:.0125},extreme:{maxSamples:200,rayIncrement:.0062}};var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get fragmentShaderSource(){if(!this._fragmentShaderSource){this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT);var t=this.quality;this._fragmentShaderSource.addParameter([{name:"inPositionMap",dataType:"sampler2D",role:"value"},{name:"inNormalMap",dataType:"sampler2D",role:"value"},{name:"inLightingMap",dataType:"sampler2D",role:"value"},{name:"inMaterialMap",dataType:"sampler2D",role:"value"},{name:"inSamplePosMap",dataType:"sampler2D",role:"value"},{name:"inProjectionMatrix",dataType:"mat4",role:"value"},{name:"inCameraPos",dataType:"vec3",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\t\tvec3 normal = texture2D(inNormalMap,fsTexCoord).xyz * 2.0 - 1.0;\n\t\t\t\t\t\tvec4 vertexPos = texture2D(inPositionMap,fsTexCoord);\n\t\t\t\t\t\tvec3 cameraVector = vertexPos.xyz - inCameraPos;\n\t\t\t\t\t\tvec3 rayDirection = reflect(cameraVector,normal);\n\t\t\t\t\t\tvec4 lighting = texture2D(inLightingMap,fsTexCoord);\n\t\t\t\t\t\tvec4 material = texture2D(inMaterialMap,fsTexCoord);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat increment = "+t.rayIncrement+";\n\t\t\t\t\t\tvec4 result = vec4(0.0,0.0,0.0,0.0);\n\t\t\t\t\t\tif (material.b>0.0) {\t// material[2] is reflectionAmount\n\t\t\t\t\t\t\tresult = vec4(0.0,0.0,0.0,1.0);\n\t\t\t\t\t\t\tfor (float i=0.0; i<"+t.maxSamples+".0; ++i) {\n\t\t\t\t\t\t\t\tif (i=="+t.maxSamples+".0) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat radius = i * increment;\n\t\t\t\t\t\t\t\tincrement *= 1.01;\n\t\t\t\t\t\t\t\tvec3 ray = vertexPos.xyz + rayDirection * radius;\n\n\t\t\t\t\t\t\t\tvec4 offset = inProjectionMatrix * vec4(ray, 1.0);\t// -w, w\n\t\t\t\t\t\t\t\toffset.xyz /= offset.w;\t// -1, 1\n\t\t\t\t\t\t\t\toffset.xyz = offset.xyz * 0.5 + 0.5;\t// 0, 1\n\n\t\t\t\t\t\t\t\tvec4 rayActualPos = texture2D(inSamplePosMap, offset.xy);\n\t\t\t\t\t\t\t\tfloat hitDistance = rayActualPos.z - ray.z;\n\t\t\t\t\t\t\t\tif (rayActualPos.w<0.6) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (offset.x>1.0 || offset.y>1.0) {\n\t\t\t\t\t\t\t\t\tresult = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (hitDistance>0.02 && hitDistance<0.4) {\n\t\t\t\t\t\t\t\t\tresult = texture2D(inLightingMap,offset.xy);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (result.a==0.0) {\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tgl_FragColor = result;\n\t\t\t\t\t\t}")}return this._fragmentShaderSource},setupVars:function(){this.shader.setTexture("inPositionMap",this._surface.position,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inNormalMap",this._surface.normal,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inLightingMap",this._surface.reflectionColor,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inMaterialMap",this._surface.material,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inSamplePosMap",this._surface.reflectionDepth,bg.base.TextureUnit.TEXTURE_4),this.shader.setMatrix4("inProjectionMatrix",this._projectionMatrix),this.shader.setVector3("inCameraPos",this._cameraPos)},get projectionMatrix(){return this._projectionMatrix},set projectionMatrix(t){this._projectionMatrix=t},get cameraPosition(){return this._cameraPos},set cameraPosition(t){this._cameraPos=t},get quality(){return this._quality||bg.render.RaytracerQuality.low},set quality(t){this._quality&&this._quality.maxSamples==t.maxSamples&&this._quality.rayIncrement==t.rayIncrement||(this._quality=t,this._fragmentShaderSource=null,this.rebuildShaders())},get settings(){return this._settings,this._settings}},{},t)}(bg.base.TextureEffect);bg.render.SSRTEffect=t}(),bg.webgl1={},function(){var t="webgl1";bg.webgl1.EngineId=t;var e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e),bg.webgl1.Extensions.Get(e),this._engineId=t,this._texture=new bg.webgl1.TextureImpl(e),this._pipeline=new bg.webgl1.PipelineImpl(e),this._polyList=new bg.webgl1.PolyListImpl(e),this._shader=new bg.webgl1.ShaderImpl(e),this._colorBuffer=new bg.webgl1.ColorRenderSurfaceImpl(e),this._textureBuffer=new bg.webgl1.TextureRenderSurfaceImpl(e),this._shaderSource=new bg.webgl1.ShaderSourceImpl}return $traceurRuntime.createClass(n,{},{},e)}(bg.Engine);bg.webgl1.Engine=e}(),function(){bg.webgl1.shaderLibrary={inputs:{},functions:{}};var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{header:function(t){return"precision highp float;\nprecision highp int;"},parameter:function(t,e){if(!e)return"\n";var n="";switch(e.role){case"buffer":n="attribute";break;case"value":n="uniform";break;case"in":case"out":n="varying"}var i="";return e.vec&&(i="["+e.vec+"]"),n+" "+e.dataType+" "+e.name+i+";"},func:function(t,e){if(!e)return"\n";var n="";for(var i in e.params)n+=e.params[i]+" "+i+",";return(e.returnType+" "+e.name+"("+n+") {").replace(",)",")")+("\n"+bg.base.ShaderSource.FormatSource(e.body)).replace(/\n/g,"\n\t")+"\n}"}},{},t)}(bg.base.ShaderSourceImpl);bg.webgl1.ShaderSourceImpl=t}(),function(){var t=null,e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{getExtension:function(t){return this.context.getExtension(t)},get textureFloat(){return void 0===this._textureFloat&&(this._textureFloat=this.getExtension("OES_texture_float")),this._textureFloat},get depthTexture(){return void 0===this._depthTexture&&(this._depthTexture=this.getExtension("WEBGL_depth_texture")),this._depthTexture},get drawBuffers(){return void 0===this._drawBuffers&&(this._drawBuffers=this.getExtension("WEBGL_draw_buffers")),this._drawBuffers}},{Get:function(e){return t||(t=new n(e)),t}},e)}(bg.app.ContextObject);bg.webgl1.Extensions=e}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){bg.base.ClearBuffers.COLOR=t.COLOR_BUFFER_BIT,bg.base.ClearBuffers.DEPTH=t.DEPTH_BUFFER_BIT},setViewport:function(t,e){t.viewport(e.x,e.y,e.width,e.height)},clearBuffers:function(t,e,n){t.clearColor(e.r,e.g,e.b,e.a),t.clear(n)},setDepthTestEnabled:function(t,e){e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)},setCullFace:function(t,e){e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE)},setBlendEnabled:function(t,e){e?t.enable(t.BLEND):t.disable(t.BLEND)},setBlendMode:function(t,e){switch(e){case bg.base.BlendMode.NORMAL:t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.MULTIPLY:t.blendFunc(t.ZERO,t.SRC_COLOR),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.ADD:t.blendFunc(t.ONE,t.ONE),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.SUBTRACT:t.blendFunc(t.ONE,t.ONE),t.blendEquation(t.FUNC_SUBTRACT);break;case bg.base.BlendMode.ALPHA_ADD:t.blendFunc(t.SRC_ALPHA,t.SRC_ALPHA),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.ALPHA_SUBTRACT:t.blendFunc(t.SRC_ALPHA,t.SRC_ALPHA),t.blendEquation(t.FUNC_SUBTRACT)}}},{},t)}(bg.base.PipelineImpl);bg.webgl1.PipelineImpl=t}(),function(){function t(t,e,n,i){var r=null;return e.length&&(r=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),i),r.itemSize=n,r.numItems=e.length/n),r}function e(t,e){return e&&t.deleteBuffer(e),null}var n=function(n){function i(){$traceurRuntime.superConstructor(i).apply(this,arguments)}return $traceurRuntime.createClass(i,{initFlags:function(t){bg.base.DrawMode.TRIANGLES=t.TRIANGLES,bg.base.DrawMode.TRIANGLE_FAN=t.TRIANGLE_FAN,bg.base.DrawMode.TRIANGLE_STRIP=t.TRIANGLE_STRIP},create:function(t){return{vertexBuffer:null,normalBuffer:null,tex0Buffer:null,tex1Buffer:null,tex2Buffer:null,colorBuffer:null,tangentBuffer:null,indexBuffer:null}},build:function(e,n,i,r,a,s,o,u,l,c){return n.vertexBuffer=t(e,i,3,e.STATIC_DRAW),n.normalBuffer=t(e,r,3,e.STATIC_DRAW),n.tex0Buffer=t(e,a,2,e.STATIC_DRAW),n.tex1Buffer=t(e,s,2,e.STATIC_DRAW),n.tex2Buffer=t(e,o,2,e.STATIC_DRAW),n.colorBuffer=t(e,u,4,e.STATIC_DRAW),n.tangentBuffer=t(e,l,3,e.STATIC_DRAW),c.length>0&&(n.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),e.STATIC_DRAW),n.indexBuffer.itemSize=3,n.indexBuffer.numItems=c.length),n.vertexBuffer&&n.indexBuffer},draw:function(t,e,n,i){t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.indexBuffer),t.drawElements(n,i,t.UNSIGNED_SHORT,0)},destroy:function(t,n){t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),n.vertexBuffer=e(t,n.vertexBuffer),n.normalBuffer=e(t,n.normalBuffer),n.tex0Buffer=e(t,n.tex0Buffer),n.tex1Buffer=e(t,n.tex1Buffer),n.tex2Buffer=e(t,n.tex2Buffer),n.colorBuffer=e(t,n.colorBuffer),n.tangentBuffer=e(t,n.tangentBuffer),n.indexBuffer=e(t,n.indexBuffer)}},{},n)}(bg.base.PolyListImpl);bg.webgl1.PolyListImpl=n}(),function(){function t(){return o.drawBuffers?o.drawBuffers.MAX_COLOR_ATTACHMENTS||o.drawBuffers.MAX_COLOR_ATTACHMENTS_WEBGL:1}function e(t){switch(!0){case t.type==bg.base.RenderSurfaceType.RGBA&&t.format==bg.base.RenderSurfaceFormat.UNSIGNED_BYTE:case t.type==bg.base.RenderSurfaceType.RGBA&&t.format==bg.base.RenderSurfaceFormat.FLOAT:case t.type==bg.base.RenderSurfaceType.DEPTH&&t.format==bg.base.RenderSurfaceFormat.RENDERBUFFER:case t.type==bg.base.RenderSurfaceType.DEPTH&&t.format==bg.base.RenderSurfaceFormat.UNSIGNED_SHORT:return!0;default:return!1}}function n(t){switch(t){case bg.base.RenderSurfaceType.RGBA:return"RGBA";case bg.base.RenderSurfaceType.DEPTH:return"DEPTH";default:return"unknown"}}function i(t){switch(t){case bg.base.RenderSurfaceFormat.UNSIGNED_BYTE:return"UNSIGNED_BYTE";case bg.base.RenderSurfaceFormat.FLOAT:return"FLOAT";case bg.base.RenderSurfaceFormat.RENDERBUFFER:return"RENDERBUFFER";case bg.base.RenderSurfaceFormat.UNSIGNED_SHORT:return"UNSIGNED_SHORT";default:return"unknown"}}function r(r){var a=0,s=t(),u=null;return r.every(function(t,l){return e(t)?t.type==bg.base.RenderSurfaceType.DEPTH&&l!=r.length-1?(u="Error in attachment "+l+": Depth attachment must be specified as the last attachment. Specified at index "+l+" of "+(r.length-1),!1):(t.type==bg.base.RenderSurfaceType.RGBA&&++a,t.format!=bg.base.RenderSurfaceFormat.FLOAT||o.textureFloat?t.type!=bg.base.RenderSurfaceType.DEPTH||t.format==bg.base.RenderSurfaceFormat.RENDERBUFFER||o.depthTexture?!(a>s)||(u="Error in attachment "+l+": Maximum number of "+s+" color attachment exceeded.",!1):(u="Error in attachment "+l+": Depth texture attachment requested, but the requiered extension is not present: WEBGL_depth_texture.",!1):(u="Error in attachment "+l+": Floating point render surface requested, but the required extension is not present: OES_texture_float.",!1)):(u="Error in attachment "+l+": Invalid combination of type and format ("+n(t.type)+" is incompatible with "+i(t.format)+").",!1)}),u}function a(t,e,n,i){if(n.format==bg.base.RenderSurfaceFormat.RENDERBUFFER){var r=t.createRenderbuffer();return t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,r),t.bindRenderbuffer(t.RENDERBUFFER,null),{_renderbuffer:r}}var a=new bg.base.Texture(t),s=n.format,o=n.type;return a.create(),a.bind(),a.minFilter=bg.base.TextureFilter.LINEAR,a.magFilter=bg.base.TextureFilter.LINEAR,a.wrapX=bg.base.TextureWrap.CLAMP,a.wrapY=bg.base.TextureWrap.CLAMP,a.setImageRaw(e.width,e.height,null,o,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+i,t.TEXTURE_2D,a._texture,0),a.unbind(),a}function s(t,e,n,i){if(n.texture&&(n.texture.bind(),n.texture.setImageRaw(e.width,e.height,null,n.type,n.format),n.texture.unbind()),n.renderbuffer){var r=n.renderbuffer._renderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}}var o=null,u=function(e){function n(){$traceurRuntime.superConstructor(n).apply(this,arguments)}return $traceurRuntime.createClass(n,{initFlags:function(t){bg.base.RenderSurfaceType.RGBA=t.RGBA,bg.base.RenderSurfaceType.DEPTH=t.DEPTH_COMPONENT,bg.base.RenderSurfaceFormat.UNSIGNED_BYTE=t.UNSIGNED_BYTE,bg.base.RenderSurfaceFormat.UNSIGNED_SHORT=t.UNSIGNED_SHORT,bg.base.RenderSurfaceFormat.FLOAT=t.FLOAT,bg.base.RenderSurfaceFormat.RENDERBUFFER=t.RENDERBUFFER,o=bg.webgl1.Extensions.Get()},supportType:function(t){switch(t){case bg.base.RenderSurfaceType.RGBA:return!0;case bg.base.RenderSurfaceType.DEPTH:return null!=o.depthTexture;default:return!1}},supportFormat:function(t){switch(t){case bg.base.RenderSurfaceFormat.UNSIGNED_BYTE:case bg.base.RenderSurfaceFormat.UNSIGNED_SHORT:return!0;case bg.base.RenderSurfaceFormat.FLOAT:return null!=o.textureFloat;default:return!1}},get maxColorAttachments(){return t()}},{},e)}(bg.base.RenderSurfaceBufferImpl),l=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{create:function(t){return{}},setActive:function(t,e,n){t.bindFramebuffer(t.FRAMEBUFFER,null)},resize:function(t,e,n){},destroy:function(t,e){}},{},t)}(u);bg.webgl1.ColorRenderSurfaceImpl=l;var c=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){},create:function(t,e){var n=r(e);if(n)throw new Error(n);var i=new bg.Vector2(256),s={fbo:t.createFramebuffer(),size:i,attachments:[]};t.bindFramebuffer(t.FRAMEBUFFER,s.fbo);var u=[];return e.forEach(function(e,n){var r=a(t,i,e,n);r instanceof bg.base.Texture&&u.push(o.drawBuffers?o.drawBuffers.COLOR_ATTACHMENT0_WEBGL+n:t.COLOR_ATTACHMENT0),s.attachments.push({texture:r instanceof bg.base.Texture?r:null,renderbuffer:r instanceof bg.base.Texture?null:r,format:e.format,type:e.type})}),u.length>1&&o.drawBuffers.drawBuffersWEBGL(u),t.bindFramebuffer(t.FRAMEBUFFER,null),s},setActive:function(t,e){t.bindFramebuffer(t.FRAMEBUFFER,e.fbo)},readBuffer:function(t,e,n,i){var r=new Uint8Array(n.width*n.height*4);return t.readPixels(n.x,i.height-n.y,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,r),r},resize:function(t,e,n){e.size.width=n.width,e.size.height=n.height,e.attachments.forEach(function(e,i){s(t,n,e,i)})},destroy:function(t,e){t.bindFramebuffer(t.FRAMEBUFFER,null);var n=e&&e.attachments;e.fbo&&t.deleteFramebuffer(e.fbo),n&&n.forEach(function(e){
e.texture?e.texture.destroy():e.renderbuffer&&t.deleteRenderbuffer(e.renderbuffer._renderbuffer)}),e.fbo=null,e.size=null,e.attachments=null}},{},t)}(u);bg.webgl1.TextureRenderSurfaceImpl=c}(),function(){var t={textureInput:"sampler2D",texCoord:"vec2",size:"int",samplerSize:"vec2"},e="\n\t\tvec2 texelSize = 1.0 / samplerSize;\n\t\tvec3 result = vec3(0.0);\n\t\tvec2 hlim = vec2(float(-size) * 0.5 + 0.5);\n\t\tfor (int x=0; x<25; ++x) {\n\t\t\tif (x==size) break;\n\t\t\tfor (int y=0; y<25; ++y) {\n\t\t\t\tif (y==size) break;\n\t\t\t\tvec2 offset = (hlim + vec2(float(x), float(y))) * texelSize;\n\t\t\t\tresult += texture2D(textureInput, texCoord + offset).rgb;\n\t\t\t}\n\t\t}\n\t\treturn vec4(result / float(size * size), 1.0);\n\t\t";bg.webgl1.shaderLibrary.functions.blur={gaussianBlur:{returnType:"vec4",name:"gaussianBlur",params:t,body:e},blur:{returnType:"vec4",name:"blur",params:t,body:e}}}(),function(){bg.webgl1.shaderLibrary.functions.colorCorrection={rgb2hsv:{returnType:"vec3",name:"rgb2hsv",params:{c:"vec3"},body:"\n\t\t\t\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\t\t\t\tvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n\t\t\t\tvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n\t\t\t\tfloat d = q.x - min(q.w, q.y);\n\t\t\t\tfloat e = 1.0e-10;\n\t\t\t\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);"},hsv2rgb:{returnType:"vec3",name:"hsv2rgb",params:{c:"vec3"},body:"\n\t\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);"},applyBrightness:{returnType:"vec4",name:"applyBrightness",params:{color:"vec4",brightness:"float"},body:"\n\t\t\t\t\treturn clamp(vec4(color.rgb + brightness - 0.5,1.0),0.0,1.0);\n\t\t\t\t"},applyContrast:{returnType:"vec4",name:"applyContrast",params:{color:"vec4",contrast:"float"},body:"\n\t\t\t\treturn clamp(vec4((color.rgb * max(contrast + 0.5,0.0)),1.0),0.0,1.0);"},applySaturation:{returnType:"vec4",name:"applySaturation",params:{color:"vec4",hue:"float",saturation:"float",lightness:"float"},body:"\n\t\t\t\tvec3 fragRGB = clamp(color.rgb + vec3(0.001),0.0,1.0);\n\t\t\t\tvec3 fragHSV = rgb2hsv(fragRGB);\n\t\t\t\tlightness -= 0.01;\n\t\t\t\tfloat h = hue;\n\t\t\t\tfragHSV.x *= h;\n\t\t\t\tfragHSV.yz *= vec2(saturation,lightness);\n\t\t\t\tfragHSV.x = mod(fragHSV.x, 1.0);\n\t\t\t\tfragHSV.y = mod(fragHSV.y, 1.0);\n\t\t\t\tfragHSV.z = mod(fragHSV.z, 1.0);\n\t\t\t\tfragRGB = hsv2rgb(fragHSV);\n\t\t\t\treturn clamp(vec4(hsv2rgb(fragHSV), color.w),0.0,1.0);"},colorCorrection:{returnType:"vec4",name:"colorCorrection",params:{fragColor:"vec4",hue:"float",saturation:"float",lightness:"float",brightness:"float",contrast:"float"},body:"\n\t\t\t\treturn applyContrast(applyBrightness(applySaturation(fragColor,hue,saturation,lightness),brightness),contrast);"}}}(),function(){bg.webgl1.shaderLibrary.inputs={buffers:{vertex:{name:"inVertex",dataType:"vec3",role:"buffer",target:"vertex"},normal:{name:"inNormal",dataType:"vec3",role:"buffer",target:"normal"},tangent:{name:"inTangent",dataType:"vec3",role:"buffer",target:"tangent"},tex0:{name:"inTex0",dataType:"vec2",role:"buffer",target:"tex0"},tex1:{name:"inTex1",dataType:"vec2",role:"buffer",target:"tex1"},tex2:{name:"inTex2",dataType:"vec2",role:"buffer",target:"tex2"},color:{name:"inColor",dataType:"vec4",role:"buffer",target:"color"}},matrix:{model:{name:"inModelMatrix",dataType:"mat4",role:"value"},view:{name:"inViewMatrix",dataType:"mat4",role:"value"},projection:{name:"inProjectionMatrix",dataType:"mat4",role:"value"},normal:{name:"inNormalMatrix",dataType:"mat4",role:"value"},viewInv:{name:"inViewMatrixInv",dataType:"mat4",role:"value"}},material:{diffuse:{name:"inDiffuseColor",dataType:"vec4",role:"value"},specular:{name:"inSpecularColor",dataType:"vec4",role:"value"},shininess:{name:"inShininess",dataType:"float",role:"value"},shininessMask:{name:"inShininessMask",dataType:"sampler2D",role:"value"},shininessMaskChannel:{name:"inShininessMaskChannel",dataType:"vec4",role:"value"},shininessMaskInvert:{name:"inShininessMaskInvert",dataType:"bool",role:"value"},lightEmission:{name:"inLightEmission",dataType:"float",role:"value"},lightEmissionMask:{name:"inLightEmissionMask",dataType:"sampler2D",role:"value"},lightEmissionMaskChannel:{name:"inLightEmissionMaskChannel",dataType:"vec4",role:"value"},lightEmissionMaskInvert:{name:"inLightEmissionMaskInvert",dataType:"bool",role:"value"},texture:{name:"inTexture",dataType:"sampler2D",role:"value"},textureOffset:{name:"inTextureOffset",dataType:"vec2",role:"value"},textureScale:{name:"inTextureScale",dataType:"vec2",role:"value"},alphaCutoff:{name:"inAlphaCutoff",dataType:"float",role:"value"},lightMap:{name:"inLightMap",dataType:"sampler2D",role:"value"},lightMapOffset:{name:"inLightMapOffset",dataType:"vec2",role:"value"},lightMapScale:{name:"inLightMapScale",dataType:"vec2",role:"value"},normalMap:{name:"inNormalMap",dataType:"sampler2D",role:"value"},normalMapOffset:{name:"inNormalMapOffset",dataType:"vec2",role:"value"},normalMapScale:{name:"inNormalMapScale",dataType:"vec2",role:"value"},reflection:{name:"inReflection",dataType:"float",role:"value"},reflectionMask:{name:"inReflectionMask",dataType:"sampler2D",role:"value"},reflectionMaskChannel:{name:"inReflectionMaskChannel",dataType:"vec4",role:"value"},reflectionMaskInvert:{name:"inReflectionMaskInvert",dataType:"bool",role:"value"},castShadows:{name:"inCastShadows",dataType:"bool",role:"value"},receiveShadows:{name:"inReceiveShadows",dataType:"bool",role:"value"}},lighting:{type:{name:"inLightType",dataType:"int",role:"value"},position:{name:"inLightPosition",dataType:"vec3",role:"value"},direction:{name:"inLightDirection",dataType:"vec3",role:"value"},ambient:{name:"inLightAmbient",dataType:"vec4",role:"value"},diffuse:{name:"inLightDiffuse",dataType:"vec4",role:"value"},specular:{name:"inLightSpecular",dataType:"vec4",role:"value"},attenuation:{name:"inLightAttenuation",dataType:"vec3",role:"value"},spotExponent:{name:"inSpotExponent",dataType:"float",role:"value"},spotCutoff:{name:"inSpotCutoff",dataType:"float",role:"value"},cutoffDistance:{name:"inLightCutoffDistance",dataType:"float",role:"value"},exposure:{name:"inLightExposure",dataType:"float",role:"value"},castShadows:{name:"inLightCastShadows",dataType:"bool",role:"value"}},shadows:{shadowMap:{name:"inShadowMap",dataType:"sampler2D",role:"value"},shadowMapSize:{name:"inShadowMapSize",dataType:"vec2",role:"value"},shadowStrength:{name:"inShadowStrength",dataType:"float",role:"value"},shadowColor:{name:"inShadowColor",dataType:"vec4",role:"value"},shadowBias:{name:"inShadowBias",dataType:"float",role:"value"},shadowType:{name:"inShadowType",dataType:"int",role:"value"}},colorCorrection:{hue:{name:"inHue",dataType:"float",role:"value"},saturation:{name:"inSaturation",dataType:"float",role:"value"},lightness:{name:"inLightness",dataType:"float",role:"value"},brightness:{name:"inBrightness",dataType:"float",role:"value"},contrast:{name:"inContrast",dataType:"float",role:"value"}}}}(),function(){bg.webgl1.shaderLibrary.functions.lighting={getDirectionalLight:{returnType:"vec4",name:"getDirectionalLight",params:{ambient:"vec4",diffuse:"vec4",specular:"vec4",shininess:"float",direction:"vec3",vertexPos:"vec3",normal:"vec3",matDiffuse:"vec4",matSpecular:"vec4",shadowColor:"vec4"},body:"\n\t\t\t\tvec3 color = ambient.rgb * matDiffuse.rgb;\n\t\t\t\tvec3 diffuseWeight = max(0.0, dot(normal,direction)) * diffuse.rgb;\n\t\t\t\tcolor += min(diffuseWeight,shadowColor.rgb) * matDiffuse.rgb;\n\t\t\t\tif (shininess>0.0) {\n\t\t\t\t\tvec3 eyeDirection = normalize(-vertexPos);\n\t\t\t\t\tvec3 reflectionDirection = normalize(reflect(-direction,normal));\n\t\t\t\t\tfloat specularWeight = clamp(pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininess), 0.0, 1.0);\n\t\t\t\t\tvec3 specularColor = specularWeight * pow(shadowColor.rgb,vec3(10.0));\n\t\t\t\t\tcolor += specularColor * specular.rgb * matSpecular.rgb;\n\t\t\t\t}\n\t\t\t\treturn vec4(color,1.0);"},getShadowColor:{returnType:"vec4",name:"getShadowColor",params:{vertexPosFromLight:"vec4",shadowMap:"sampler2D",shadowMapSize:"vec2",shadowType:"int",shadowStrength:"float",shadowBias:"float",shadowColor:"vec4"},body:"\n\t\t\t\tfloat visibility = 1.0;\n\t\t\t\tvec3 depth = vertexPosFromLight.xyz / vertexPosFromLight.w;\n\t\t\t\tconst float kShadowBorderOffset = 3.0;\n\t\t\t\tfloat shadowBorderOffset = kShadowBorderOffset / shadowMapSize.x;\n\t\t\t\tfloat bias = shadowBias;\n\t\t\t\tvec4 shadow = vec4(1.0);\n\t\t\t\tif (shadowType==0) {\t// hard\n\t\t\t\t\tfloat shadowDepth = unpack(texture2D(shadowMap,depth.xy));\n\t\t\t\t\tif (shadowDepth<depth.z - bias &&\n\t\t\t\t\t\t(depth.x>0.0 && depth.x<1.0 && depth.y>0.0 && depth.y<1.0))\n\t\t\t\t\t{\n\t\t\t\t\t\tvisibility = 1.0 - shadowStrength;\n\t\t\t\t\t}\n\t\t\t\t\tshadow = clamp(shadowColor + visibility,0.0,1.0);\n\t\t\t\t}\n\t\t\t\telse if (shadowType==1 || shadowType==2) {\t// soft / soft stratified (not supported on webgl, fallback to soft)\n\t\t\t\t\tvec2 poissonDisk[4];\n\t\t\t\t\tpoissonDisk[0] = vec2( -0.94201624, -0.39906216 );\n\t\t\t\t\tpoissonDisk[1] = vec2( 0.94558609, -0.76890725 );\n\t\t\t\t\tpoissonDisk[2] = vec2( -0.094184101, -0.92938870 );\n\t\t\t\t\tpoissonDisk[3] = vec2( 0.34495938, 0.29387760 );\n\t\t\t\t\t\n\t\t\t\t\tfor (int i=0; i<4; ++i) {\n\t\t\t\t\t\tfloat shadowDepth = unpack(texture2D(shadowMap, depth.xy + poissonDisk[i]/1000.0));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (shadowDepth<depth.z - bias\n\t\t\t\t\t\t\t&& (depth.x>0.0 && depth.x<1.0 && depth.y>0.0 && depth.y<1.0)) {\n\t\t\t\t\t\t\tvisibility -= (shadowStrength) * 0.25;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tshadow = clamp(shadowColor + visibility,0.0,1.0);\n\t\t\t\t}\n\t\t\t\treturn shadow;"}}}(),function(){bg.webgl1.shaderLibrary.functions.materials={samplerColor:{returnType:"vec4",name:"samplerColor",params:{sampler:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2"},body:"\n\t\t\t\treturn texture2D(sampler,uv * scale + offset);"},samplerNormal:{returnType:"vec3",name:"samplerNormal",params:{sampler:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2"},body:"\n\t\t\t\treturn normalize(samplerColor(sampler,uv,offset,scale).xyz * 2.0 - 1.0);\n\t\t\t\t"},combineNormalWithMap:{returnType:"vec3",name:"combineNormalWithMap",params:{normalCoord:"vec3",tangent:"vec3",bitangent:"vec3",normalMapValue:"vec3"},body:"\n\t\t\t\tmat3 tbnMat = mat3( tangent.x, bitangent.x, normalCoord.x,\n\t\t\t\t\t\t\ttangent.y, bitangent.y, normalCoord.y,\n\t\t\t\t\t\t\ttangent.z, bitangent.z, normalCoord.z\n\t\t\t\t\t\t);\n\t\t\t\treturn normalize(normalMapValue * tbnMat);"},applyTextureMask:{returnType:"float",name:"applyTextureMask",params:{value:"float",textureMask:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2",channelMask:"vec4",invert:"bool"},body:"\n\t\t\t\tfloat mask;\n\t\t\t\tvec4 color = samplerColor(textureMask,uv,offset,scale);\n\t\t\t\tmask = color.r * channelMask.r +\n\t\t\t\t\t\t color.g * channelMask.g +\n\t\t\t\t\t\t color.b * channelMask.b +\n\t\t\t\t\t\t color.a * channelMask.a;\n\t\t\t\tif (!invert) {\n\t\t\t\t\tmask = 1.0 - mask;\n\t\t\t\t}\n\t\t\t\treturn value * mask;"},specularColor:{returnType:"vec4",name:"specularColor",params:{specular:"vec4",shininessMask:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2",channelMask:"vec4",invert:"bool"},body:"\n\t\t\t\tfloat maskValue = applyTextureMask(1.0, shininessMask,uv,offset,scale,channelMask,invert);\n\t\t\t\treturn vec4(specular.rgb * maskValue, 1.0);"}}}(),function(){bg.webgl1.shaderLibrary.functions.utils={pack:{returnType:"vec4",name:"pack",params:{depth:"float"},body:"\n\t\t\t\tconst vec4 bitSh = vec4(256 * 256 * 256,\n\t\t\t\t\t\t\t\t\t\t256 * 256,\n\t\t\t\t\t\t\t\t\t\t256,\n\t\t\t\t\t\t\t\t\t\t1.0);\n\t\t\t\tconst vec4 bitMsk = vec4(0,\n\t\t\t\t\t\t\t\t\t\t1.0 / 256.0,\n\t\t\t\t\t\t\t\t\t\t1.0 / 256.0,\n\t\t\t\t\t\t\t\t\t\t1.0 / 256.0);\n\t\t\t\tvec4 comp = fract(depth * bitSh);\n\t\t\t\tcomp -= comp.xxyz * bitMsk;\n\t\t\t\treturn comp;"},unpack:{returnType:"float",name:"unpack",params:{color:"vec4"},body:"\n\t\t\t\tconst vec4 bitShifts = vec4(1.0 / (256.0 * 256.0 * 256.0),\n\t\t\t\t\t\t\t\t\t\t\t1.0 / (256.0 * 256.0),\n\t\t\t\t\t\t\t\t\t\t\t1.0 / 256.0,\n\t\t\t\t\t\t\t\t\t\t\t1.0);\n\t\t\t\treturn dot(color, bitShifts);"},random:{returnType:"float",name:"random",params:{seed:"vec3",i:"int"},body:"\n\t\t\t\tvec4 seed4 = vec4(seed,i);\n\t\t\t\tfloat dot_product = dot(seed4, vec4(12.9898,78.233,45.164,94.673));\n\t\t\t\treturn fract(sin(dot_product) * 43758.5453);"}}}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){bg.base.ShaderType.VERTEX=t.VERTEX_SHADER,bg.base.ShaderType.FRAGMENT=t.FRAGMENT_SHADER},setActive:function(t,e){t.useProgram(e&&e.program)},create:function(t){return{program:t.createProgram(),attribLocations:{},uniformLocations:{}}},addShaderSource:function(t,e,n,i){var r=null;if(e&&e.program){var a=t.createShader(n);t.shaderSource(a,i),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?t.attachShader(e.program,a):r=t.getShaderInfoLog(a),t.deleteShader(a)}else r="Could not attach shader. Invalid shader program";return r},link:function(t,e){var n=null;return e&&e.program?(t.linkProgram(e.program),t.getProgramParameter(e.program,t.LINK_STATUS)||(n=t.getProgramInfoLog(e.program))):n="Could not link shader. Invalid shader program",n},initVars:function(t,e,n,i){n.forEach(function(n){e.attribLocations[n]=t.getAttribLocation(e.program,n)}),i.forEach(function(n){e.uniformLocations[n]=t.getUniformLocation(e.program,n)})},setInputBuffer:function(t,e,n,i,r){if(i&&e&&e.program){var a=e.attribLocations[n];-1!=a&&(t.bindBuffer(t.ARRAY_BUFFER,i),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,r,t.FLOAT,!1,0,0))}},disableInputBuffer:function(t,e,n){t.disableVertexAttribArray(e.attribLocations[n])},setValueInt:function(t,e,n,i){t.uniform1i(e.uniformLocations[n],i)},setValueFloat:function(t,e,n,i){t.uniform1f(e.uniformLocations[n],i)},setValueVector2:function(t,e,n,i){t.uniform2fv(e.uniformLocations[n],i.v)},setValueVector3:function(t,e,n,i){t.uniform3fv(e.uniformLocations[n],i.v)},setValueVector4:function(t,e,n,i){t.uniform4fv(e.uniformLocations[n],i.v)},setValueVector2v:function(t,e,n,i){t.uniform2fv(e.uniformLocations[n],i)},setValueVector3v:function(t,e,n,i){t.uniform3fv(e.uniformLocations[n],i)},setValueVector4v:function(t,e,n,i){t.uniform4fv(e.uniformLocations[n],i)},setValueMatrix3:function(t,e,n,i,r){t.uniformMatrix3fv(e.uniformLocations[n],i,r.m)},setValueMatrix4:function(t,e,n,i,r){t.uniformMatrix4fv(e.uniformLocations[n],i,r.m)},setTexture:function(t,e,n,i,r){i.setActive(r),i.bind(),t.uniform1i(e.uniformLocations[n],r)}},{},t)}(bg.base.ShaderImpl);bg.webgl1.ShaderImpl=t}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){bg.base.TextureWrap.REPEAT=t.REPEAT,bg.base.TextureWrap.CLAMP=t.CLAMP_TO_EDGE,bg.base.TextureFilter.NEAREST_MIPMAP_NEAREST=t.NEAREST_MIPMAP_NEAREST,bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST=t.LINEAR_MIPMAP_NEAREST,bg.base.TextureFilter.NEAREST_MIPMAP_LINEAR=t.NEAREST_MIPMAP_LINEAR,bg.base.TextureFilter.LINEAR_MIPMAP_LINEAR=t.LINEAR_MIPMAP_LINEAR,bg.base.TextureFilter.NEAREST=t.NEAREST,bg.base.TextureFilter.LINEAR=t.LINEAR,bg.base.TextureTarget.TEXTURE_2D=t.TEXTURE_2D,bg.base.TextureTarget.CUBE_MAP=t.TEXTURE_CUBE_MAP,bg.base.TextureTarget.POSITIVE_X_FACE=t.TEXTURE_CUBE_MAP_POSITIVE_X,bg.base.TextureTarget.NEGATIVE_X_FACE=t.TEXTURE_CUBE_MAP_NEGATIVE_X,bg.base.TextureTarget.POSITIVE_Y_FACE=t.TEXTURE_CUBE_MAP_POSITIVE_Y,bg.base.TextureTarget.NEGATIVE_Y_FACE=t.TEXTURE_CUBE_MAP_NEGATIVE_Y,bg.base.TextureTarget.POSITIVE_Z_FACE=t.TEXTURE_CUBE_MAP_POSITIVE_Z,bg.base.TextureTarget.NEGATIVE_Z_FACE=t.TEXTURE_CUBE_MAP_NEGATIVE_Z},requireMipmaps:function(t,e){return t==bg.base.TextureFilter.NEAREST_MIPMAP_NEAREST||t==bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST||t==bg.base.TextureFilter.NEAREST_MIPMAP_LINEAR||t==bg.base.TextureFilter.LINEAR_MIPMAP_LINEAR||e==bg.base.TextureFilter.NEAREST_MIPMAP_NEAREST||e==bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST||e==bg.base.TextureFilter.NEAREST_MIPMAP_LINEAR||e==bg.base.TextureFilter.LINEAR_MIPMAP_LINEAR},create:function(t){return t.createTexture()},setActive:function(t,e){t.activeTexture(t.TEXTURE0+e)},bind:function(t,e,n){t.bindTexture(e,n)},unbind:function(t,e){this.bind(t,e,null)},setTextureWrapX:function(t,e,n,i){t.texParameteri(e,t.TEXTURE_WRAP_S,i)},setTextureWrapY:function(t,e,n,i){t.texParameteri(e,t.TEXTURE_WRAP_T,i)},setImage:function(t,e,n,i,r,a,s){s&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texParameteri(e,t.TEXTURE_MIN_FILTER,n),t.texParameteri(e,t.TEXTURE_MAG_FILTER,i),t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a),this.requireMipmaps(n,i)&&t.generateMipmap(e)},setImageRaw:function(t,e,n,i,r,a,s,o,u,l){u||(u=t.RGBA),l||(l=t.UNSIGNED_BYTE),l==bg.base.RenderSurfaceFormat.FLOAT&&(n=bg.base.TextureFilter.NEAREST,i=bg.base.TextureFilter.NEAREST),t.texParameteri(e,t.TEXTURE_MIN_FILTER,n),t.texParameteri(e,t.TEXTURE_MAG_FILTER,i),t.texImage2D(e,0,u,a,s,0,u,l,o),this.requireMipmaps(n,i)&&t.generateMipmap(e)},setVideo:function(t,e,n,i,r){r&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)},updateVideoData:function(t,e,n,i){t.bindTexture(e,n),t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.bindTexture(e,null)},destroy:function(t,e){t.deleteTexture(this._texture)}},{},t)}(bg.base.TextureImpl);bg.webgl1.TextureImpl=t}(),Class("paella.Video360",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(t,e,n,i,r,a,s){function o(){if(u.canvasController){u.canvasController.canvas.domElement}}this.parent(t,e,"canvas",0,0,1280,720),this._streamName=s||"video360";var u=this;paella.player.videoContainer.disablePlayOnClick(),this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(t,e){return t.res.h-e.res.h}),this.video=null,new paella.Timer(function(t){o()},500).repeat=!0},defaultProfile:function(){return"chroma"},_setVideoElem:function(t){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)},_loadDeps:function(){return new Promise(function(t,e){window.$paella_mpd?defer.resolve(window.$paella_mpd):require(["resources/deps/bg2e.js"],function(){window.$paella_bg2e=!0,t(window.$paella_bg2e)})})},_deferredAction:function(t){var e=this;return new Promise(function(n,i){e.video?n(t()):$(e.video).bind("canplay",function(){e._ready=!0,n(t())})})},_getQualityObject:function(t,e){return{index:t,res:e.res,src:e.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(t){return this.res.w*this.res.h-t.res.w*t.res.h}}},allowZoom:function(){return!1},getVideoData:function(){var t=this,e=this;return new Promise(function(n,i){t._deferredAction(function(){n({duration:e.video.duration,currentTime:e.video.currentTime,volume:e.video.volume,paused:e.video.paused,ended:e.video.ended,res:{w:e.video.videoWidth,h:e.video.videoHeight}})})})},setPosterFrame:function(t){this._posterFrame=t},setAutoplay:function(t){this._autoplay=t,t&&this.video&&this.video.setAttribute("autoplay",t)},load:function(){var t=this;return new Promise(function(e,n){t._loadDeps().then(function(){var i=t._stream.sources[t._streamName];null===t._currentQuality&&t._videoQualityStrategy&&(t._currentQuality=t._videoQualityStrategy.getQualityIndex(i));var r=t._currentQuality<i.length?i[t._currentQuality]:null;t.video=null,r?(t.canvasController=null,buildVideo360Canvas(r,t.domElement).then(function(n){t.canvasController=n,t.video=n.video,t.video.pause(),e(r)})):n(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){var t=this;return new Promise(function(e,n){setTimeout(function(){var n=[],i=t._stream.sources[t._streamName],r=-1;i.forEach(function(e){r++,n.push(t._getQualityObject(r,e))}),e(n)},10)})},setQuality:function(t){var e=this;return new Promise(function(n){var i=e.video.paused,r=e._stream.sources[e._streamName];e._currentQuality=t<r.length?t:0;var a=e.video.currentTime;e.freeze().then(function(){return e._ready=!1,e.load()}).then(function(){i||e.play(),$(e.video).on("seeked",function(){e.unFreeze(),n(),$(e.video).off("seeked")}),e.video.currentTime=a})})},getCurrentQuality:function(){var t=this;return new Promise(function(e){e(t._getQualityObject(t._currentQuality,t._stream.sources[t._streamName][t._currentQuality]))})},play:function(){var t=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,t.video.play()})},pause:function(){var t=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,t.video.pause()})},isPaused:function(){var t=this;return this._deferredAction(function(){return t.video.paused})},duration:function(){var t=this;return this._deferredAction(function(){return t.video.duration})},setCurrentTime:function(t){var e=this;return this._deferredAction(function(){e.video.currentTime=t,$(e.video).on("seeked",function(){e.canvasController.postRedisplay(),$(e.video).off("seeked")})})},currentTime:function(){var t=this;return this._deferredAction(function(){return t.video.currentTime})},setVolume:function(t){var e=this;return this._deferredAction(function(){e.video.volume=t})},volume:function(){var t=this;return this._deferredAction(function(){return t.video.volume})},setPlaybackRate:function(t){var e=this;return this._deferredAction(function(){e.video.playbackRate=t})},playbackRate:function(){var t=this;return this._deferredAction(function(){return t.video.playbackRate})},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){var t=this;return this._deferredAction(function(){var e=document.getElementById(t.video.className+"canvas");$(e).remove()})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.Video360Factory",{isStreamCompatible:function(t){try{if(paella.ChromaVideo._loaded)return!1;if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var e in t.sources)if("video360"==e)return!0}catch(t){}return!1},getVideoObject:function(t,e,n){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Video360(t,e,n.x,n.y,n.w,n.h)}});var bg={};bg.utils={},Reflect.defineProperty=Reflect.defineProperty||Object.defineProperty,function(t){t.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}(),bg.utils.initWebGLContext=function(t){var e={gl:null,supported:!1,experimental:!1};try{e.gl=t.getContext("webgl",{preserveDrawingBuffer:!0}),e.supported=null!=e.gl}catch(t){e.supported=!1}if(!e.supported)try{e.gl=t.getContext("experimental-webgl",{preserveDrawingBuffer:!0}),e.supported=null!=e.gl,e.experimental=!0}catch(t){}return e&&(e.gl.uuid=Symbol(e.gl)),e},bg.utils.isBigEndian=function(){var t=new Uint32Array(1);new Uint8Array(t.buffer);return t[0]=255,255==t[3]},bg.utils.isLittleEndian=function(){var t=new Uint32Array(1);new Uint8Array(t.buffer);return t[0]=255,255==t[0]};var e=function(){function t(t){this.system={},this.browser={},t||(t=navigator.userAgent),this.parseOperatingSystem(t),this.parseBrowser(t)}return $traceurRuntime.createClass(t,{parseOperatingSystem:function(t){this.system.OSX=/Macintosh/.test(t),this.system.Windows=/Windows/.test(t),this.system.iPhone=/iPhone/.test(t),this.system.iPodTouch=/iPod/.test(t),this.system.iPad=/iPad/.test(t),this.system.iOS=this.system.iPhone||this.system.iPad||this.system.iPodTouch,this.system.Android=/Android/.test(t),this.system.Linux=!this.system.Android&&/Linux/.test(t),this.system.OSX?(this.system.OSName="OS X",this.parseOSXVersion(t)):this.system.Windows?(this.system.OSName="Windows",this.parseWindowsVersion(t)):this.system.Linux?(this.system.OSName="Linux",this.parseLinuxVersion(t)):this.system.iOS?(this.system.OSName="iOS",this.parseIOSVersion(t)):this.system.Android&&(this.system.OSName="Android",this.parseAndroidVersion(t))},parseBrowser:function(t){if(this.browser.Version={},this.browser.Safari=/Version\/([\d\.]+) Safari\//.test(t),this.browser.Safari&&(this.browser.Name="Safari",this.browser.Vendor="Apple",this.browser.Version.versionString=RegExp.$1),this.browser.Chrome=/Chrome\/([\d\.]+) Safari\//.test(t),this.browser.Chrome&&(this.browser.Name="Chrome",this.browser.Vendor="Google",this.browser.Version.versionString=RegExp.$1),this.browser.Opera=/Opera\/[\d\.]+/.test(t),this.browser.Opera){this.browser.Name="Opera",this.browser.Vendor="Opera Software";/Version\/([\d\.]+)/.test(t);this.browser.Version.versionString=RegExp.$1}if(this.browser.Firefox=/Gecko\/[\d\.]+ Firefox\/([\d\.]+)/.test(t),this.browser.Firefox&&(this.browser.Name="Firefox",this.browser.Vendor="Mozilla Foundation",this.browser.Version.versionString=RegExp.$1),this.browser.Edge=/Edge\/(.*)/.test(t),this.browser.Edge){var e=/Edge\/(.*)/.exec(t);this.browser.Name="Edge",this.browser.Chrome=!1,this.browser.Vendor="Microsoft",this.browser.Version.versionString=e[1]}if(this.browser.Explorer=/MSIE ([\d\.]+)/.test(t),this.browser.Explorer)this.browser.Name="Internet Explorer",this.browser.Vendor="Microsoft",this.browser.Version.versionString=RegExp.$1;else{var n=/\Mozilla\/5.0 \(([^)]+)\) like Gecko/,i=n.exec(t);if(i){n=/rv:(.*)/;var r=n.exec(i[1]);this.browser.Explorer=!0,this.browser.Name="Internet Explorer",this.browser.Vendor="Microsoft",this.browser.Version.versionString=r?r[1]:"unknown"}}this.system.iOS?(this.browser.IsMobileVersion=!0,this.browser.MobileSafari=/Version\/([\d\.]+) Mobile/.test(t),this.browser.MobileSafari&&(this.browser.Name="Mobile Safari",this.browser.Vendor="Apple",this.browser.Version.versionString=RegExp.$1),this.browser.Android=!1):this.system.Android?(this.browser.IsMobileVersion=!0,this.browser.Android=/Version\/([\d\.]+) Mobile/.test(t),this.browser.MobileSafari?(this.browser.Name="Android Browser",this.browser.Vendor="Google",this.browser.Version.versionString=RegExp.$1):(this.browser.Chrome=/Chrome\/([\d\.]+)/.test(t),this.browser.Name="Chrome",this.browser.Vendor="Google",this.browser.Version.versionString=RegExp.$1),this.browser.Safari=!1):this.browser.IsMobileVersion=!1,this.parseBrowserVersion(t)},parseBrowserVersion:function(t){/([\d]+)\.([\d]+)\.*([\d]*)/.test(this.browser.Version.versionString)&&(this.browser.Version.major=Number(RegExp.$1),this.browser.Version.minor=Number(RegExp.$2),this.browser.Version.revision=RegExp.$3?Number(RegExp.$3):0)},parseOSXVersion:function(t){var e=/Mac OS X (\d+_\d+_*\d*)/.test(t)?RegExp.$1:"";switch(this.system.Version={},""!=e?/(\d+)_(\d+)_*(\d*)/.test(e)&&(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0):(e=/Mac OS X (\d+\.\d+\.*\d*)/.test(t)?RegExp.$1:"Unknown",/(\d+)\.(\d+)\.*(\d*)/.test(e)&&(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0)),this.system.Version.major||(this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.revision=0),this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision,this.system.Version.minor){case 0:this.system.Version.name="Cheetah";break;case 1:this.system.Version.name="Puma";break;case 2:this.system.Version.name="Jaguar";break;case 3:this.system.Version.name="Panther";break;case 4:this.system.Version.name="Tiger";break;case 5:this.system.Version.name="Leopard";break;case 6:this.system.Version.name="Snow Leopard";break;case 7:this.system.Version.name="Lion";break;case 8:this.system.Version.name="Mountain Lion"}},parseWindowsVersion:function(t){if(this.system.Version={},/NT (\d+)\.(\d*)/.test(t)){this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=0,this.system.Version.stringValue="NT "+this.system.Version.major+"."+this.system.Version.minor;var e=this.system.Version.major,n=this.system.Version.minor;5==e?this.system.Version.name=0==n?"2000":"XP":6==e&&(0==n?this.system.Version.name="Vista":1==n?this.system.Version.name="7":2==n&&(this.system.Version.name="8"))}else this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.name="Unknown",this.system.Version.stringValue="Unknown"},parseLinuxVersion:function(t){this.system.Version={},this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.revision=0,this.system.Version.name="",this.system.Version.stringValue="Unknown distribution"},parseIOSVersion:function(t){this.system.Version={},/iPhone OS (\d+)_(\d+)_*(\d*)/i.test(t)?(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0,this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision,this.system.Version.name="iOS"):(this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.name="Unknown",this.system.Version.stringValue="Unknown")},parseAndroidVersion:function(t){this.system.Version={},/Android (\d+)\.(\d+)\.*(\d*)/.test(t)?(this.system.Version.major=Number(RegExp.$1),this.system.Version.minor=Number(RegExp.$2),this.system.Version.revision=RegExp.$3?Number(RegExp.$3):0,this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision):(this.system.Version.major=0,this.system.Version.minor=0,this.system.Version.revision=0),/Build\/([a-zA-Z]+)/.test(t)?this.system.Version.name=RegExp.$1:this.system.Version.name="Unknown version",this.system.Version.stringValue=this.system.Version.major+"."+this.system.Version.minor+"."+this.system.Version.revision},getInfoString:function(){return navigator.userAgent}},{})}();bg.utils.UserAgent=e,bg.utils.userAgent=new e}(window),function(){function t(t,e,n){var i=new XMLHttpRequest;return i.open("GET",t,!0),i.addEventListener("load",function(){200===i.status?e(i):n(new Error("Error receiving data: "+i.status+", url: "+t))},!1),i.addEventListener("error",function(){n(new Error("Cannot make AJAX request. Url: "+t))},!1),i}var e=[],n=[],i=function(){function i(){}return $traceurRuntime.createClass(i,{},{GetExtension:function(t){var e=/\.([a-z0-9-_]*)$/i.exec(t);return e&&e[1].toLowerCase()||""},IsFormat:function(t,e){return null!=e.find(function(t){return t==this},i.GetExtension(t))},IsImage:function(t){return i.IsFormat(t,["jpg","jpeg","gif","png"])},IsBinary:function(t){var e=void 0!==arguments[1]?arguments[1]:["vwglb"];return i.IsFormat(t,e)},IsVideo:function(t){var e=void 0!==arguments[1]?arguments[1]:["mp4","m4v","ogg","ogv","m3u8","webm"];return i.IsFormat(t,e)},
LoadMultiple:function(t){var e=[];return t.forEach(function(t){e.push(i.Load(t))}),Promise.all(e).then(function(e){var n={};return t.forEach(function(t,i){n[t]=e[i]}),n})},Load:function(t){var e=null;switch(!0){case t.constructor===Array:e=i.LoadMultiple;break;case i.IsImage(t):e=i.LoadImage;break;case i.IsBinary(t):e=i.LoadBinary;break;case i.IsVideo(t):e=i.LoadVideo;break;case"json"==i.GetExtension(t):e=i.LoadJson;break;default:e=i.LoadText}return e(t)},LoadText:function(e){return new Promise(function(n,i){t(e,function(t){n(t.responseText)},function(t){i(t)}).send()})},LoadVideo:function(t){return new Promise(function(e,i){var r=document.createElement("video");n.push(r),r.crossOrigin="",r.autoplay=!0,r.setAttribute("playsinline",null),r.addEventListener("canplay",function(t){var i=n.indexOf(t.target);-1!=i&&n.splice(i,1),e(event.target),bg.emitImageLoadEvent(event.target)}),r.addEventListener("error",function(e){i(new Error("Error loading video: "+t))}),r.addEventListener("abort",function(e){i(new Error("Error loading video: "+t))}),r.src=t})},LoadBinary:function(e){return new Promise(function(n,i){var r=t(e,function(t){n(t.response)},function(t){i(t)});r.responseType="arraybuffer",r.send()})},LoadImage:function(t){return new Promise(function(n,i){var r=new Image;e.push(r),r.crossOrigin="",r.addEventListener("load",function(t){var i=e.indexOf(t.target);-1!=i&&e.splice(i,1),n(t.target),bg.emitImageLoadEvent(t.target)}),r.addEventListener("error",function(e){i(new Error("Error loading image: "+t))}),r.addEventListener("abort",function(e){i(new Error("Image load aborted: "+t))}),r.src=t})},LoadJson:function(e){return new Promise(function(n,i){t(e,function(t){try{n(JSON.parse(t.responseText))}catch(t){i(new Error("Error parsing JSON data"))}},function(t){i(t)}).send()})}})}();bg.utils.Resource=i}(),function(){var t=null,e=function(){function e(){}return $traceurRuntime.createClass(e,{get id(){return this._engineId},get texture(){return this._texture},get pipeline(){return this._pipeline},get polyList(){return this._polyList},get shader(){return this._shader},get colorBuffer(){return this._colorBuffer},get textureBuffer(){return this._textureBuffer},get shaderSource(){return this._shaderSource}},{Set:function(e){t=e},Get:function(){return t}})}();bg.Engine=e}(),function(){var t=function(){function t(){}return $traceurRuntime.createClass(t,{init:function(){},frame:function(t){},willDisplay:function(t,e){},display:function(t,e){},didDisplay:function(t,e){},reshape:function(t,e,n,i){},keyDown:function(t){},keyUp:function(t){},mouseUp:function(t){},mouseDown:function(t){},mouseMove:function(t){},mouseOut:function(t){},mouseDrag:function(t){},mouseWheel:function(t){},touchStart:function(t){},touchMove:function(t){},touchEnd:function(t){}},{})}();bg.LifeCycle=t}(),bg.app={},function(){var t=function(){function t(t){var e=this;if(this._domElem=t,this._domElem.style.MozUserSelect="none",this._domElem.style.WebkitUserSelect="none",this._domElem.setAttribute("onselectstart","return false"),!function(){return e._context=bg.utils.initWebGLContext(t),e._context.supported}())throw new Error("Sorry, your browser does not support WebGL.")}return $traceurRuntime.createClass(t,{get context(){return this._context},get domElement(){return this._domElem},get width(){return this._domElem.clientWidth},get height(){return this._domElem.clientHeight},screenshot:function(t,e,n){var i="",r={};e&&(n=n||e,i=this.domElement.style.cssText,r.width=this.domElement.width,r.height=this.domElement.height,this.domElement.style.cssText="top:auto;left:auto;bottom:auto;right:auto;width:"+e+"px;height:"+n+"px;",this.domElement.width=e,this.domElement.height=n,bg.app.MainLoop.singleton.windowController.reshape(e,n),bg.app.MainLoop.singleton.windowController.postRedisplay(),bg.app.MainLoop.singleton.windowController.display());var a=this.domElement.toDataURL(t);return e&&(this.domElement.style.cssText=i,this.domElement.width=r.width,this.domElement.height=r.height,bg.app.MainLoop.singleton.windowController.reshape(r.width,r.height),bg.app.MainLoop.singleton.windowController.postRedisplay(),bg.app.MainLoop.singleton.windowController.display()),a}},{})}();bg.app.Canvas=t;var e=function(){function t(t){this._context=t}return $traceurRuntime.createClass(t,{get context(){return this._context},set context(t){this._context=t}},{})}();bg.app.ContextObject=e}(),function(){bg.app.SpecialKey={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,PAGE_UP:33,PAGEDOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46};var t=function(){function t(t){this.key=t}return $traceurRuntime.createClass(t,{isSpecialKey:function(){return t.IsSpecialKey(this.key)}},{IsSpecialKey:function(t){Object.keys(bg.app.SpecialKey).some(function(e){return bg.app.SpecialKey[e]==t})}})}();bg.app.KeyboardEvent=t,bg.app.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2,NONE:-1};var e=function(){function t(){var t=void 0!==arguments[0]?arguments[0]:bg.app.MouseButton.NONE,e=void 0!==arguments[1]?arguments[1]:-1,n=void 0!==arguments[2]?arguments[2]:-1,i=void 0!==arguments[3]?arguments[3]:0;this.button=t,this.x=e,this.y=n,this.delta=i}return $traceurRuntime.createClass(t,{},{})}();bg.app.MouseEvent=e;var n=function(){function t(t){this.touches=t}return $traceurRuntime.createClass(t,{},{})}();bg.app.TouchEvent=n}(),function(){function t(){requestAnimFrame(t),i()}function e(){if(n(),window.addEventListener("resize",function(t){n()}),!p.canvas)throw new Error("Configuration error in MainLoop: no canvas defined");var t=p.canvas.domElement;t.addEventListener("mousedown",function(t){return r(t),t.preventDefault(),!1}),t.addEventListener("mousemove",function(t){return a(t),t.preventDefault(),!1}),t.addEventListener("mouseout",function(t){return s(),t.preventDefault(),!1}),t.addEventListener("mouseover",function(t){return o(t),t.preventDefault(),!1}),t.addEventListener("mouseup",function(t){return u(t),t.preventDefault(),!1}),t.addEventListener("touchstart",function(t){return h(t),t.preventDefault(),!1}),t.addEventListener("touchmove",function(t){return f(t),t.preventDefault(),!1}),t.addEventListener("touchend",function(t){return d(t),t.preventDefault(),!1});var e=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";t.addEventListener(e,function(t){return l(t),t.preventDefault(),!1}),window.addEventListener("keydown",function(t){g(t)}),window.addEventListener("keyup",function(t){m(t)}),t.oncontextmenu=function(t){return!1}}function n(){p.canvas&&p.windowController&&(p.canvas.domElement.width=p.canvas.width,p.canvas.domElement.height=p.canvas.height,p.windowController.reshape(p.canvas.width,p.canvas.height))}function i(){p.redisplay&&(-1==_&&(_=Date.now()),p.windowController.frame(Date.now()-_),p.windowController.display(),_=Date.now(),p._redisplay=p.updateMode==bg.app.FrameUpdate.AUTO)}function r(t){var e=p.canvas.domElement.getBoundingClientRect();switch(b.pos.x=t.clientX-e.left,b.pos.y=t.clientY-e.top,t.button){case bg.app.MouseButton.LEFT:b.leftButton=!0;break;case bg.app.MouseButton.MIDDLE:b.middleButton=!0;break;case bg.app.MouseButton.RIGHT:b.rightButton=!0}p.windowController.mouseDown(new bg.app.MouseEvent(t.button,b.pos.x,b.pos.y))}function a(t){var e=p.canvas.domElement.getBoundingClientRect();b.pos.x=t.clientX-e.left,b.pos.y=t.clientY-e.top;var n=new bg.app.MouseEvent(bg.app.MouseButton.NONE,b.pos.x,b.pos.y);p.windowController.mouseMove(n),b.anyButton&&p.windowController.mouseDrag(n)}function s(){p.windowController.mouseOut(new bg.app.MouseEvent(bg.app.MouseButton.NONE,b.pos.x,b.pos.y)),b.leftButton&&(b.leftButton=!1,p.windowController.mouseUp(new bg.app.MouseEvent(bg.app.MouseButton.LEFT,b.pos.x,b.pos.y))),b.middleButton&&(b.middleButton=!1,p.windowController.mouseUp(new bg.app.MouseEvent(bg.app.MouseButton.MIDDLE,b.pos.x,b.pos.y))),b.rightButton&&(p.windowController.mouseUp(new bg.app.MouseEvent(bg.app.MouseButton.RIGHT,b.pos.x,b.pos.y)),b.rightButton=!1)}function o(t){a(t)}function u(t){switch(t.button){case bg.app.MouseButton.LEFT:b.leftButton=!1;break;case bg.app.MouseButton.MIDDLE:b.middleButton=!1;break;case bg.app.MouseButton.RIGHT:b.rightButton=!1}var e=p.canvas.domElement.getBoundingClientRect();b.pos.x=t.clientX-e.left,b.pos.y=t.clientY-e.top,p.windowController.mouseUp(new bg.app.MouseEvent(t.button,b.pos.x,b.pos.y))}function l(t){var e=p.canvas.domElement.getBoundingClientRect();b.pos.x=t.clientX-e.left,b.pos.y=t.clientY-e.top;var n=t.wheelDelta?-1*t.wheelDelta:10*t.detail;p.windowController.mouseWheel(new bg.app.MouseEvent(bg.app.MouseButton.NONE,b.pos.x,b.pos.y,n))}function c(t){for(var e=p.canvas.domElement.getBoundingClientRect(),n=[],i=0;i<t.touches.length;++i){var r=t.touches[i];n.push({identifier:r.identifier,x:r.clientX-e.left,y:r.clientY-e.top,force:r.force,rotationAngle:r.rotationAngle,radiusX:r.radiusX,radiusY:r.radiusY})}return new bg.app.TouchEvent(n)}function h(t){p.windowController.touchStart(c(t))}function f(t){p.windowController.touchMove(c(t))}function d(t){p.windowController.touchEnd(c(t))}function g(t){var e=bg.app.KeyboardEvent.IsSpecialKey(t.keyCode)?t.keyCode:String.fromCharCode(t.keyCode);p.windowController.keyDown(new bg.app.KeyboardEvent(e))}function m(t){var e=bg.app.KeyboardEvent.IsSpecialKey(t.keyCode)?t.keyCode:String.fromCharCode(t.keyCode);p.windowController.keyUp(new bg.app.KeyboardEvent(e))}var p=null,b={leftButton:!1,middleButton:!1,rightButton:!1,pos:{x:-1,y:-1}};Object.defineProperty(b,"anyButton",{get:function(){return this.leftButton||this.middleButton||this.rightButton}});var _=-1,v=function(){function t(){}return $traceurRuntime.createClass(t,{},{LeftButton:function(){return b.leftButton},MiddleButton:function(){return b.middleButton},RightButton:function(){return b.rightButton},Position:function(){return b.pos}})}();bg.app.Mouse=v,bg.app.FrameUpdate={AUTO:0,MANUAL:1};var y=function(){function i(){this._canvas=null,this._windowController=null,this._updateMode=bg.app.FrameUpdate.AUTO,this._redisplay=!0}return $traceurRuntime.createClass(i,{get canvas(){return this._canvas},set canvas(t){this._canvas=new bg.app.Canvas(t)},get windowController(){return this._windowController},get updateMode(){return this._updateMode},set updateMode(t){this._updateMode=t,this._updateMode==bg.app.FrameUpdate.AUTO&&(this._redisplay=!0)},get redisplay(){return this._redisplay},get mouseButtonStatus(){return b},run:function(n){this._windowController=n,this.postRedisplay(),this.windowController.init(),e(),t()},postRedisplay:function(){this._redisplay=!0},postReshape:function(){n()}},{})}();bg.app.MainLoop={},Object.defineProperty(bg.app.MainLoop,"singleton",{get:function(){return p||(p=new y),p}})}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{postRedisplay:function(){bg.app.MainLoop.singleton.postRedisplay()},postReshape:function(){bg.app.MainLoop.singleton.postReshape()},get canvas(){return bg.app.MainLoop.singleton.canvas},get context(){return bg.app.MainLoop.singleton.canvas.context},get gl(){return bg.app.MainLoop.singleton.canvas.context.gl}},{},t)}(bg.LifeCycle);bg.app.WindowController=t}(),bg.base={},bg.s_log=[],bg.log=function(t){console.log&&console.log(t),bg.s_log.push(t)},bg.flushLog=function(){console.log&&bg.s_log.forEach(function(t){console.log(t)}),bg.s_log=[]},bg.emitImageLoadEvent=function(t){var e=new CustomEvent("bg2e:image-load",{image:t});document.dispatchEvent(e)},bg.bindImageLoadEvent=function(t){document.addEventListener("bg2e:image-load",t)},bg.Axis={NONE:0,X:1,Y:2,Z:3},function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._shader=null,this._inputVars=[]}return $traceurRuntime.createClass(e,{get inputVars(){return this._inputVars},get shader(){return this._shader},setupShaderSource:function(t){var e=this;this._shader=new bg.base.Shader(this.context),this._inputVars=[];var n=[],i=[];t.forEach(function(t){t.params.forEach(function(t){t&&("buffer"==t.role?(e._inputVars[t.target]=t.name,n.push(t.name)):"value"==t.role&&i.push(t.name))}),e._shader.addShaderSource(t.type,t.toString())}),this._shader.link(),this._shader.status?this._shader.initVars(n,i):(bg.log(this._shader.compileError),this._shader.compileErrorSource&&(bg.log("Shader source:"),bg.log(this._shader.compileErrorSource)),bg.log(this._shader.linkError))},beginDraw:function(){},setupVars:function(){},setActive:function(){this.shader.setActive(),this.beginDraw()},clearActive:function(){this.shader.clearActive()},bindPolyList:function(t){var e=this.shader;this.inputVars.vertex&&e.setInputBuffer(this.inputVars.vertex,t.vertexBuffer,3),this.inputVars.normal&&e.setInputBuffer(this.inputVars.normal,t.normalBuffer,3),this.inputVars.tex0&&e.setInputBuffer(this.inputVars.tex0,t.texCoord0Buffer,2),this.inputVars.tex1&&e.setInputBuffer(this.inputVars.tex1,t.texCoord1Buffer,2),this.inputVars.tex2&&e.setInputBuffer(this.inputVars.tex2,t.texCoord2Buffer,2),this.inputVars.color&&e.setInputBuffer(this.inputVars.color,t.colorBuffer,4),this.inputVars.tangent&&e.setInputBuffer(this.inputVars.tangent,t.tangentBuffer,3),this.setupVars()},unbind:function(){var t=this.shader;this.inputVars.vertex&&t.disableInputBuffer(this.inputVars.vertex),this.inputVars.normal&&t.disableInputBuffer(this.inputVars.normal),this.inputVars.tex0&&t.disableInputBuffer(this.inputVars.tex0),this.inputVars.tex1&&t.disableInputBuffer(this.inputVars.tex1),this.inputVars.tex2&&t.disableInputBuffer(this.inputVars.tex2),this.inputVars.color&&t.disableInputBuffer(this.inputVars.color),this.inputVars.tangent&&t.disableInputBuffer(this.inputVars.tangent)}},{},t)}(bg.app.ContextObject);bg.base.Effect=e;var n=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._frame=new bg.base.PolyList(t),this._frame.vertex=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],this._frame.texCoord0=[1,1,0,1,0,0,1,0],this._frame.index=[0,1,2,2,3,0],this._frame.build(),this.rebuildShaders()}return $traceurRuntime.createClass(n,{rebuildShaders:function(){this.setupShaderSource([this.vertexShaderSource,this.fragmentShaderSource])},get vertexShaderSource(){return this._vertexShaderSource||(this._vertexShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),this._vertexShaderSource.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,{name:"fsTexCoord",dataType:"vec2",role:"out"}]),"webgl1"==bg.Engine.Get().id&&this._vertexShaderSource.setMainBody("\n\t\t\t\t\tgl_Position = vec4(inVertex,1.0);\n\t\t\t\t\tfsTexCoord = inTex0;")),this._vertexShaderSource},get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter({name:"fsTexCoord",dataType:"vec2",role:"in"}),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tgl_FragColor = vec4(1.0,0.0,0.0,1.0);")),this._fragmentShaderSource},drawSurface:function(t){this.setActive(),this._surface=t,this.bindPolyList(this._frame),this._frame.draw(),this.unbind(),this.clearActive()}},{},e)}(e);bg.base.TextureEffect=n}(),function(){var t=function(){function t(){}return $traceurRuntime.createClass(t,{acceptType:function(t,e){return!1},load:function(t,e,n){return new Promise(function(t,e){e(new Error("Not implemented"))})}},{})}();bg.base.LoaderPlugin=t;var e=[],n=function(){function t(){}return $traceurRuntime.createClass(t,{},{RegisterPlugin:function(t){e.push(t)},Load:function(e,n){return new Promise(function(i,r){bg.utils.Resource.Load(n).then(function(i){return t.LoadData(e,n,i)}).then(function(t){i(t)}).catch(function(t){r(t)})})},LoadData:function(t,n,i){return new Promise(function(r,a){var s=null;if(e.some(function(t){if(t.acceptType(n,i))return s=t,!0}),!s)return a(new Error("No suitable plugin found for load "+n));r(s.load(t,n,i))})}})}();bg.base.Loader=n}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e);var i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT);i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,{name:"fsTexCoord",dataType:"vec2",role:"out"}]),r.addParameter([t().inputs.material.texture,{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&(i.setMainBody("\n\t\t\t\tgl_Position = vec4(inVertex,1.0);\n\t\t\t\tfsTexCoord = inTex0;"),r.setMainBody("gl_FragColor = texture2D(inTexture,fsTexCoord);")),this.setupShaderSource([i,r])}return $traceurRuntime.createClass(n,{setupVars:function(){var t=null;this._surface instanceof bg.base.Texture?t=this._surface:this._surface instanceof bg.base.RenderSurface&&(t=this._surface.getTexture(0)),t&&this.shader.setTexture("inTexture",t,bg.base.TextureUnit.TEXTURE_0)}},{},e)}(bg.base.TextureEffect);bg.base.DrawTextureEffect=e}(),function(){function t(){return bg.base.ShaderLibrary.Get()}function e(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.normal,t().inputs.buffers.tangent,t().inputs.buffers.tex0,t().inputs.buffers.tex1]),i.addParameter(t().inputs.matrix.all),i.addParameter([{name:"inLightProjectionMatrix",dataType:"mat4",role:"value"},{name:"inLightViewMatrix",dataType:"mat4",role:"value"}]),i.addParameter([{name:"fsPosition",dataType:"vec3",role:"out"},{name:"fsTex0Coord",dataType:"vec2",role:"out"},{name:"fsTex1Coord",dataType:"vec2",role:"out"},{name:"fsNormal",dataType:"vec3",role:"out"},{name:"fsTangent",dataType:"vec3",role:"out"},{name:"fsBitangent",dataType:"vec3",role:"out"},{name:"fsSurfaceToView",dataType:"vec3",role:"out"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"out"}]),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\t\tmat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.5, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.0, 0.5, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.5, 0.5, 0.5, 1.0);\n\t\t\t\t\t\n\t\t\t\t\tvec4 viewPos = inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tgl_Position = inProjectionMatrix * viewPos;\n\t\t\t\t\t\n\t\t\t\t\tfsNormal = normalize((inNormalMatrix * vec4(inNormal,1.0)).xyz);\n\t\t\t\t\tfsTangent = normalize((inNormalMatrix * vec4(inTangent,1.0)).xyz);\n\t\t\t\t\tfsBitangent = cross(fsNormal,fsTangent);\n\t\t\t\t\t\n\t\t\t\t\tfsVertexPosFromLight = ScaleMatrix * inLightProjectionMatrix * inLightViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\t\n\t\t\t\t\tfsTex0Coord = inTex0;\n\t\t\t\t\tfsTex1Coord = inTex1;\n\t\t\t\t\tfsPosition = viewPos.xyz;")),i}function n(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),r.addParameter(t().inputs.material.all),r.addParameter(t().inputs.lighting.all),r.addParameter(t().inputs.shadows.all),r.addParameter(t().inputs.colorCorrection.all),r.addParameter([{name:"fsPosition",dataType:"vec3",role:"in"},{name:"fsTex0Coord",dataType:"vec2",role:"in"},{name:"fsTex1Coord",dataType:"vec2",role:"in"},{name:"fsNormal",dataType:"vec3",role:"in"},{name:"fsTangent",dataType:"vec3",role:"in"},{name:"fsBitangent",dataType:"vec3",role:"in"},{name:"fsSurfaceToView",dataType:"vec3",role:"in"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"in"}]),r.addFunction(t().functions.materials.all),r.addFunction(t().functions.colorCorrection.all),r.addFunction(t().functions.utils.unpack),r.addFunction(t().functions.utils.random),r.addFunction(t().functions.lighting.all),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\tvec4 diffuseColor = samplerColor(inTexture,fsTex0Coord,inTextureOffset,inTextureScale);\n\t\t\t\t\tif (diffuseColor.a>=inAlphaCutoff) {\t\n\t\t\t\t\t\tvec4 lightmapColor = samplerColor(inLightMap,fsTex1Coord,inLightMapOffset,inLightMapScale);\n\t\t\t\t\t\tvec3 normalMap = samplerNormal(inNormalMap,fsTex0Coord,inNormalMapOffset,inNormalMapScale);\n\t\t\t\t\t\tnormalMap = combineNormalWithMap(fsNormal,fsTangent,fsBitangent,normalMap);\n\t\t\t\t\t\tvec4 shadowColor = vec4(1.0);\n\t\t\t\t\t\tif (inReceiveShadows) {\n\t\t\t\t\t\t\tshadowColor = getShadowColor(fsVertexPosFromLight,inShadowMap,inShadowMapSize,inShadowType,inShadowStrength,inShadowBias,inShadowColor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvec4 specular = specularColor(inSpecularColor,inShininessMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinShininessMaskChannel,inShininessMaskInvert);\n\t\t\t\t\t\tfloat lightEmission = applyTextureMask(inLightEmission,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMaskChannel,inLightEmissionMaskInvert);\n\t\t\t\t\t\tdiffuseColor = diffuseColor * inDiffuseColor * lightmapColor;\n\t\t\t\t\t\tvec4 light = getDirectionalLight(inLightAmbient,inLightDiffuse,inLightSpecular,inShininess,\n\t\t\t\t\t\t\t\t\t\t\t\t-inLightDirection,fsPosition,normalMap,\n\t\t\t\t\t\t\t\t\t\t\t\tdiffuseColor,specular,shadowColor);\n\t\t\t\t\t\t\n\t\t\t\t\t\tlight.rgb = clamp(light.rgb + (lightEmission * diffuseColor.rgb), vec3(0.0), vec3(1.0));\n\t\t\t\t\t\t// TODO: Select mode\n\t\t\t\t\t\tgl_FragColor = colorCorrection(light,inHue,inSaturation,inLightness,inBrightness,inContrast);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}")),r}var i=null,r=null,a=function(){function t(){this._hue=1,this._saturation=1,this._lightness=1,this._brightness=.5,this._contrast=.5}return $traceurRuntime.createClass(t,{set hue(t){this._hue=t},get hue(){return this._hue},set saturation(t){this._saturation=t},get saturation(){return this._saturation},set lightness(t){this._lightness=t},get lightness(){return this._lightness},set brightness(t){this._brightness=t},get brightness(){return this._brightness},set contrast(t){this._contrast=t},get contrast(){return this._contrast},apply:function(t){var e=void 0!==arguments[1]?arguments[1]:{hue:"inHue",saturation:"inSaturation",lightness:"inLightness",brightness:"inBrightness",contrast:"inContrast"};t.setValueFloat(e.hue,this._hue),t.setValueFloat(e.saturation,this._saturation),t.setValueFloat(e.lightness,this._lightness),t.setValueFloat(e.brightness,this._brightness),t.setValueFloat(e.contrast,this._contrast)}},{})}();bg.base.ColorCorrectionSettings=a;var s=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._material=null,this._light=null,this._lightTransform=bg.Matrix4.Identity(),this._shadowMap=null;var r=[e(),n()];this.setupShaderSource(r),this._colorCorrection=new bg.base.ColorCorrectionSettings}return $traceurRuntime.createClass(i,{get material(){return this._material},set material(t){this._material=t},get light(){return this._light},set light(t){this._light=t},get lightTransform(){return this._lightTransform},set lightTransform(t){this._lightTransform=t},set shadowMap(t){this._shadowMap=t},get shadowMap(){return this._shadowMap},get colorCorrection(){return this._colorCorrection},set colorCorrection(t){this._colorCorrection=t},beginDraw:function(){if(this._light){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst),n=this.shadowMap?this.shadowMap.viewMatrix:new bg.Matrix4(this._lightTransform);this.shader.setMatrix4("inLightProjectionMatrix",this.shadowMap?this.shadowMap.projection:this._light.projection);var i=this.shadowMap?this.shadowMap.shadowColor:bg.Color.Transparent();this.shader.setMatrix4("inLightViewMatrix",n),this.shader.setValueInt("inShadowType",this._shadowMap.shadowType),this.shader.setTexture("inShadowMap",this._shadowMap.texture,bg.base.TextureUnit.TEXTURE_5),this.shader.setVector2("inShadowMapSize",this._shadowMap.size),this.shader.setValueFloat("inShadowStrength",this._light.shadowStrength),this.shader.setVector4("inShadowColor",i),this.shader.setValueFloat("inShadowBias",this._light.shadowBias),this.shader.setValueInt("inCastShadows",this._light.castShadows),this.shader.setVector4("inLightAmbient",this._light.ambient),this.shader.setVector4("inLightDiffuse",this._light.diffuse),this.shader.setVector4("inLightSpecular",this._light.specular);var r=e.mult(this._lightTransform).rotation.multVector(this._light.direction).xyz;this.shader.setVector3("inLightDirection",r)}else{var a=bg.Color.Black();this.shader.setVector4("inLightAmbient",a),this.shader.setVector4("inLightDiffuse",a),this.shader.setVector4("inLightSpecular",a),this.shader.setVector3("inLightDirection",new bg.Vector3(0,0,0))}this.colorCorrection.apply(this.shader)},setupVars:function(){if(this.material){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst),this.shader.setMatrix4("inNormalMatrix",t.normalMatrix),this.shader.setMatrix4("inViewMatrixInv",t.viewMatrixInvert);var n=bg.base.TextureCache.WhiteTexture(this.context),i=bg.base.TextureCache.BlackTexture(this.context),r=bg.base.TextureCache.NormalTexture(this.context),a=this.material.texture||n,s=this.material.lightmap||n,o=this.material.normalMap||r,u=this.material.shininessMask||i,l=this.material.lightEmissionMask||n;this.shader.setVector4("inDiffuseColor",this.material.diffuse),this.shader.setVector4("inSpecularColor",this.material.specular),this.shader.setValueFloat("inShininess",this.material.shininess),this.shader.setTexture("inShininessMask",u,bg.base.TextureUnit.TEXTURE_3),this.shader.setVector4("inShininessMaskChannel",this.material.shininessMaskChannelVector),this.shader.setValueInt("inShininessMaskInvert",this.material.shininessMaskInvert),this.shader.setValueFloat("inLightEmission",this.material.lightEmission),this.shader.setTexture("inLightEmissionMask",l,bg.base.TextureUnit.TEXTURE_4),this.shader.setVector4("inLightEmissionMaskChannel",this.material.lightEmissionMaskChannelVector),this.shader.setValueInt("inLightEmissionMaskInvert",this.material.lightEmissionMaskInvert),this.shader.setTexture("inTexture",a,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setTexture("inLightMap",s,bg.base.TextureUnit.TEXTURE_1),this.shader.setVector2("inLightMapOffset",this.material.lightmapOffset),this.shader.setVector2("inLightMapScale",this.material.lightmapScale),this.shader.setTexture("inNormalMap",o,bg.base.TextureUnit.TEXTURE_2),this.shader.setVector2("inNormalMapScale",this.material.normalMapScale),this.shader.setVector2("inNormalMapOffset",this.material.normalMapOffset),this.shader.setValueInt("inReceiveShadows",this.material.receiveShadows),this.shader.setValueInt("inSelectMode",!1)}}},{},t)}(bg.base.Effect);bg.base.ForwardEffect=s}(),function(){bg.base.LightType={DIRECTIONAL:4,SPOT:1,POINT:5,DISABLED:10};var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._enabled=!0,this._type=bg.base.LightType.DIRECTIONAL,this._direction=new bg.Vector3(0,0,-1),this._ambient=new bg.Color(.2,.2,.2,1),this._diffuse=new bg.Color(.9,.9,.9,1),this._specular=bg.Color.White(),this._attenuation=new bg.Vector3(1,.5,.1),this._spotCutoff=20,this._spotExponent=30,this._shadowStrength=.7,this._cutoffDistance=-1,this._castShadows=!0,this._shadowBias=2e-5,this._projection=bg.Matrix4.Ortho(-10,10,-10,10,.5,300)}return $traceurRuntime.createClass(e,{clone:function(t){var e=new bg.base.Light(t||this.context);return e.assign(this),e},assign:function(t){this.enabled=t.enabled,this.type=t.type,this.direction.assign(t.direction),this.ambient.assign(t.ambient),this.diffuse.assign(t.diffuse),this.specular.assign(t.specular),this.attenuation.assign(t.attenuation),this.spotCutoff=t.spotCutoff,this.spotExponent=t.spotExponent,this.shadowStrength=t.shadowStrength,this.cutoffDistance=t.cutoffDistance,this.castShadows=t.castShadows,this.shadowBias=t.shadowBias},get enabled(){return this._enabled},set enabled(t){this._enabled=t},get type(){return this._type},set type(t){this._type=t},get direction(){return this._direction},set direction(t){this._direction=t},get ambient(){return this._ambient},set ambient(t){this._ambient=t},get diffuse(){return this._diffuse},set diffuse(t){this._diffuse=t},get specular(){return this._specular},set specular(t){this._specular=t},get attenuationVector(){return this._attenuation},get constantAttenuation(){return this._attenuation.x},get linearAttenuation(){return this._attenuation.y},get quadraticAttenuation(){return this._attenuation.z},set attenuationVector(t){this._attenuation=t},set constantAttenuation(t){this._attenuation.x=t},set linearAttenuation(t){this._attenuation.y=t},set quadraticAttenuation(t){this._attenuation.z=t},get cutoffDistance(){return this._cutoffDistance},set cutoffDistance(t){this._cutoffDistance=t},get spotCutoff(){return this._spotCutoff},set spotCutoff(t){this._spotCutoff=t},get spotExponent(){return this._spotExponent},set spotExponent(t){this._spotExponent=t},get shadowStrength(){return this._shadowStrength},set shadowStrength(t){this._shadowStrength=t},get castShadows(){return this._castShadows},set castShadows(t){this._castShadows=t},get shadowBias(){return this._shadowBias},set shadowBias(t){this._shadowBias=t},get projection(){return this._projection},set projection(t){this._projection=t}},{},t)}(bg.app.ContextObject);bg.base.Light=t}(),function(){function t(t,e,n){var i=null;return e&&((i=bg.base.TextureCache.Get(t).find(n))||(bg.log("Texture "+n+" not found. Loading texture"),i=new bg.base.Texture(t),i.create(),i.bind(),i.minFilter=bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST,i.magFilter=bg.base.TextureFilter.LINEAR,i.setImage(e),i.fileName=n,bg.base.TextureCache.Get(t).register(n,i))),i}function e(t){return/^(f|ht)tps?:\/\//i.test(t)}function n(t,n,i){var r=null;return n&&(e(n)||("/"!=i.slice(-1)&&(i+="/"),n=""+i+n),(r=bg.base.TextureCache.Get(t).find(n))||(r=new bg.base.Texture(t),r.create(),r.fileName=n,bg.base.TextureCache.Get(t).register(n,r),function(t,e){bg.utils.Resource.Load(t).then(function(n){e.bind(),r.minFilter=bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST,r.magFilter=bg.base.TextureFilter.LINEAR,e.fileName=t,e.setImage(n)})}(n,r))),r}function i(t){return t?t.fileName:""}function r(t){return new bg.Vector4(0==t?1:0,1==t?1:0,2==t?1:0,3==t?1:0)}bg.base.MaterialFlag={DIFFUSE:1,SPECULAR:2,SHININESS:4,LIGHT_EMISSION:8,REFRACTION_AMOUNT:16,REFLECTION_AMOUNT:32,TEXTURE:64,LIGHT_MAP:128,NORMAL_MAP:256,TEXTURE_OFFSET:512,TEXTURE_SCALE:1024,LIGHT_MAP_OFFSET:2048,LIGHT_MAP_SCALE:4096,NORMAL_MAP_OFFSET:8192,NORMAL_MAP_SCALE:16384,CAST_SHADOWS:32768,RECEIVE_SHADOWS:65536,ALPHA_CUTOFF:1<<17,SHININESS_MASK:1<<18,SHININESS_MASK_CHANNEL:1<<19,SHININESS_MASK_INVERT:1<<20,LIGHT_EMISSION_MASK:1<<21,LIGHT_EMISSION_MASK_CHANNEL:1<<22,LIGHT_EMISSION_MASK_INVERT:1<<23,REFLECTION_MASK:1<<24,REFLECTION_MASK_CHANNEL:1<<25,REFLECTION_MASK_INVERT:1<<26,CULL_FACE:1<<27};var a=function(){function t(t){this._modifierFlags=0,this._diffuse=bg.Color.White(),this._specular=bg.Color.White(),this._shininess=0,this._lightEmission=0,this._refractionAmount=0,this._reflectionAmount=0,this._texture=null,this._lightmap=null,this._normalMap=null,this._textureOffset=new bg.Vector2,this._textureScale=new bg.Vector2(1),this._lightmapOffset=new bg.Vector2,this._lightmapScale=new bg.Vector2(1),this._normalMapOffset=new bg.Vector2,this._normalMapScale=new bg.Vector2(1),this._castShadows=!0,this._receiveShadows=!0,this._alphaCutoff=.5,this._shininessMask=null,this._shininessMaskChannel=0,this._shininessMaskInvert=!1,this._lightEmissionMask=null,this._lightEmissionMaskChannel=0,this._lightEmissionMaskInvert=!1,this._reflectionMask=null,this._reflectionMaskChannel=0,this._reflectionMaskInvert=!1,this._cullFace=!0,
t&&(void 0!==t.diffuseR&&void 0!==t.diffuseG&&void 0!==t.diffuseB&&(this.diffuse=new bg.Color(t.diffuseR,t.diffuseG,t.diffuseB,t.diffuseA?t.diffuseA:1)),void 0!==t.specularR&&void 0!==t.specularG&&void 0!==t.specularB&&(this.specular=new bg.Color(t.specularR,t.specularG,t.specularB,t.specularA?t.specularA:1)),void 0!==t.shininess&&(this.shininess=t.shininess),void 0!==t.lightEmission&&(this.lightEmission=t.lightEmission),void 0!==t.refractionAmount&&(this.refractionAmount=t.refractionAmount),void 0!==t.reflectionAmount&&(this.reflectionAmount=t.reflectionAmount),void 0!==t.texture&&(this.texture=t.texture),void 0!==t.lightmap&&(this.lightmap=t.lightmap),void 0!==t.normalMap&&(this.normalMap=t.normalMap),void 0!==t.textureOffsetX&&void 0!==t.textureOffsetY&&(this.textureOffset=new bg.Vector2(t.textureOffsetX,t.textureOffsetY)),void 0!==t.textureScaleX&&void 0!==t.textureScaleY&&(this.textureScale=new bg.Vector2(t.textureScaleX,t.textureScaleY)),void 0!==t.lightmapOffsetX&&void 0!==t.lightmapOffsetY&&(this.lightmapOffset=new bg.Vector2(t.lightmapOffsetX,t.lightmapOffsetY)),void 0!==t.lightmapScaleX&&void 0!==t.lightmapScaleY&&(this.lightmapScale=new bg.Vector2(t.lightmapScaleX,t.lightmapScaleY)),void 0!==t.normalMapScaleX&&void 0!==t.normalMapScaleY&&(this.normalMapScale=new bg.Vector2(t.normalMapScaleX,t.normalMapScaleY)),void 0!==t.normalMapOffsetX&&void 0!==t.normalMapOffsetY&&(this.normalMapOffset=new bg.Vector2(t.normalMapOffsetX,t.normalMapOffsetY)),void 0!==t.castShadows&&(this.castShadows=t.castShadows),void 0!==t.receiveShadows&&(this.receiveShadows=t.receiveShadows),void 0!==t.alphaCutoff&&(this.alphaCutoff=t.alphaCutoff),void 0!==t.shininessMask&&(this.shininessMask=t.shininessMask),void 0!==t.shininessMaskChannel&&(this.shininessMaskChannel=t.shininessMaskChannel),void 0!==t.invertShininessMask&&(this.shininessMaskInvert=t.invertShininessMask),void 0!==t.lightEmissionMask&&(this.lightEmissionMask=t.lightEmissionMask),void 0!==t.lightEmissionMaskChannel&&(this.lightEmissionMaskChannel=t.lightEmissionMaskChannel),void 0!==t.invertLightEmissionMask&&(this.lightEmissionMaskInvert=t.invertLightEmissionMask),void 0!==t.reflectionMask&&(this.reflectionMask=t.reflectionMask),void 0!==t.reflectionMaskChannel&&(this.reflectionMaskChannel=t.reflectionMaskChannel),void 0!==t.invertReflectionMask&&(this.reflectionMaskInvert=t.reflectionMaskInvert))}return $traceurRuntime.createClass(t,{get modifierFlags(){return this._modifierFlags},set modifierFlags(t){this._modifierFlags=t},setEnabled:function(t){this._modifierFlags=this._modifierFlags|t},isEnabled:function(t){return 0!=(this._modifierFlags&t)},get diffuse(){return this._diffuse},get specular(){return this._specular},get shininess(){return this._shininess},get lightEmission(){return this._lightEmission},get refractionAmount(){return this._refractionAmount},get reflectionAmount(){return this._reflectionAmount},get texture(){return this._texture},get lightmap(){return this._lightmap},get normalMap(){return this._normalMap},get textureOffset(){return this._textureOffset},get textureScale(){return this._textureScale},get lightmapOffset(){return this._lightmapOffset},get lightmapScale(){return this._lightmapScale},get normalMapOffset(){return this._normalMapOffset},get normalMapScale(){return this._normalMapScale},get castShadows(){return this._castShadows},get receiveShadows(){return this._receiveShadows},get alphaCutoff(){return this._alphaCutoff},get shininessMask(){return this._shininessMask},get shininessMaskChannel(){return this._shininessMaskChannel},get shininessMaskInvert(){return this._shininessMaskInvert},get lightEmissionMask(){return this._lightEmissionMask},get lightEmissionMaskChannel(){return this._lightEmissionMaskChannel},get lightEmissionMaskInvert(){return this._lightEmissionMaskInvert},get reflectionMask(){return this._reflectionMask},get reflectionMaskChannel(){return this._reflectionMaskChannel},get reflectionMaskInvert(){return this._reflectionMaskInvert},get cullFace(){return this._cullFace},set diffuse(t){this._diffuse=t,this.setEnabled(bg.base.MaterialFlag.DIFFUSE)},set specular(t){this._specular=t,this.setEnabled(bg.base.MaterialFlag.SPECULAR)},set shininess(t){isNaN(t)||(this._shininess=t,this.setEnabled(bg.base.MaterialFlag.SHININESS))},set lightEmission(t){isNaN(t)||(this._lightEmission=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION))},set refractionAmount(t){isNaN(t)||(this._refractionAmount=t,this.setEnabled(bg.base.MaterialFlag.REFRACTION_AMOUNT))},set reflectionAmount(t){isNaN(t)||(this._reflectionAmount=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_AMOUNT))},set texture(t){this._texture=t,this.setEnabled(bg.base.MaterialFlag.TEXTURE)},set lightmap(t){this._lightmap=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_MAP)},set normalMap(t){this._normalMap=t,this.setEnabled(bg.base.MaterialFlag.NORMAL_MAP)},set textureOffset(t){this._textureOffset=t,this.setEnabled(bg.base.MaterialFlag.TEXTURE_OFFSET)},set textureScale(t){this._textureScale=t,this.setEnabled(bg.base.MaterialFlag.TEXTURE_SCALE)},set lightmapOffset(t){this._lightmapOffset=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_MAP_OFFSET)},set lightmapScale(t){this._lightmapScale=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_MAP_SCALE)},set normalMapOffset(t){this._normalMapOffset=t,this.setEnabled(bg.base.MaterialFlag.NORMAL_MAP_OFFSET)},set normalMapScale(t){this._normalMapScale=t,this.setEnabled(bg.base.MaterialFlag.NORMAL_MAP_SCALE)},set castShadows(t){this._castShadows=t,this.setEnabled(bg.base.MaterialFlag.CAST_SHADOWS)},set receiveShadows(t){this._receiveShadows=t,this.setEnabled(bg.base.MaterialFlag.RECEIVE_SHADOWS)},set alphaCutoff(t){isNaN(t)||(this._alphaCutoff=t,this.setEnabled(bg.base.MaterialFlag.ALPHA_CUTOFF))},set shininessMask(t){this._shininessMask=t,this.setEnabled(bg.base.MaterialFlag.SHININESS_MASK)},set shininessMaskChannel(t){this._shininessMaskChannel=t,this.setEnabled(bg.base.MaterialFlag.SHININESS_MASK_CHANNEL)},set shininessMaskInvert(t){this._shininessMaskInvert=t,this.setEnabled(bg.base.MaterialFlag.SHININESS_MASK_INVERT)},set lightEmissionMask(t){this._lightEmissionMask=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK)},set lightEmissionMaskChannel(t){this._lightEmissionMaskChannel=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL)},set lightEmissionMaskInvert(t){this._lightEmissionMaskInvert=t,this.setEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT)},set reflectionMask(t){this._reflectionMask=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_MASK)},set reflectionMaskChannel(t){this._reflectionMaskChannel=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL)},set reflectionMaskInvert(t){this._reflectionMaskInvert=t,this.setEnabled(bg.base.MaterialFlag.REFLECTION_MASK_INVERT)},set cullFace(t){this._cullFace=t,this.setEnabled(bg.base.MaterialFlag.CULL_FACE)},clone:function(){var e=new t;return e.assign(this),e},assign:function(t){this._modifierFlags=t._modifierFlags,this._diffuse=t._diffuse,this._specular=t._specular,this._shininess=t._shininess,this._lightEmission=t._lightEmission,this._refractionAmount=t._refractionAmount,this._reflectionAmount=t._reflectionAmount,this._texture=t._texture,this._lightmap=t._lightmap,this._normalMap=t._normalMap,this._textureOffset=t._textureOffset,this._textureScale=t._textureScale,this._lightmapOffset=t._lightmapOffset,this._lightmapScale=t._lightmapScale,this._normalMapOffset=t._normalMapOffset,this._normalMapScale=t._normalMapScale,this._castShadows=t._castShadows,this._receiveShadows=t._receiveShadows,this._alphaCutoff=t._alphaCutoff,this._shininessMask=t._shininessMask,this._shininessMaskChannel=t._shininessMaskChannel,this._shininessMaskInvert=t._shininessMaskInvert,this._lightEmissionMask=t._lightEmissionMask,this._lightEmissionMaskChannel=t._lightEmissionMaskChannel,this._lightEmissionMaskInvert=t._lightEmissionMaskInvert,this._reflectionMask=t._reflectionMask,this._reflectionMaskChannel=t._reflectionMaskChannel,this._reflectionMaskInvert=t._reflectionMaskInvert,this._cullFace=t._cullFace}},{})}();bg.base.MaterialModifier=a;var s=function(){function e(){this._diffuse=bg.Color.White(),this._specular=bg.Color.White(),this._shininess=0,this._lightEmission=0,this._refractionAmount=0,this._reflectionAmount=0,this._texture=null,this._lightmap=null,this._normalMap=null,this._textureOffset=new bg.Vector2,this._textureScale=new bg.Vector2(1),this._lightmapOffset=new bg.Vector2,this._lightmapScale=new bg.Vector2(1),this._normalMapOffset=new bg.Vector2,this._normalMapScale=new bg.Vector2(1),this._castShadows=!0,this._receiveShadows=!0,this._alphaCutoff=.5,this._shininessMask=null,this._shininessMaskChannel=0,this._shininessMaskInvert=!1,this._lightEmissionMask=null,this._lightEmissionMaskChannel=0,this._lightEmissionMaskInvert=!1,this._reflectionMask=null,this._reflectionMaskChannel=0,this._reflectionMaskInvert=!1,this._cullFace=!0}return $traceurRuntime.createClass(e,{clone:function(){var t=new e;return t.assign(this),t},assign:function(t){this._diffuse=new bg.Color(t.diffuse),this._specular=new bg.Color(t.specular),this._shininess=t.shininess,this._lightEmission=t.lightEmission,this._refractionAmount=t.refractionAmount,this._reflectionAmount=t.reflectionAmount,this._texture=t.texture,this._lightmap=t.lightmap,this._normalMap=t.normalMap,this._textureOffset=new bg.Vector2(t.textureOffset),this._textureScale=new bg.Vector2(t.textureScale),this._lightmapOffset=new bg.Vector2(t.ligthmapOffset),this._lightmapScale=new bg.Vector2(t.lightmapScale),this._normalMapOffset=new bg.Vector2(t.normalMapOffset),this._normalMapScale=new bg.Vector2(t.normalMapScale),this._castShadows=t.castShadows,this._receiveShadows=t.receiveShadows,this._alphaCutoff=t.alphaCutoff,this._shininessMask=t.shininessMask,this._shininessMaskChannel=t.shininessMaskChannel,this._shininessMaskInvert=t.shininessMaskInvert,this._lightEmissionMask=t.lightEmissionMask,this._lightEmissionMaskChannel=t.lightEmissionMaskChannel,this._lightEmissionMaskInvert=t.lightEmissionMaskInvert,this._reflectionMask=t.reflectionMask,this._reflectionMaskChannel=t.reflectionMaskChannel,this._reflectionMaskInvert=t.reflectionMaskInvert,this._cullFace=t.cullFace},get isTransparent(){return this._diffuse.a<1},get diffuse(){return this._diffuse},get specular(){return this._specular},get shininess(){return this._shininess},get lightEmission(){return this._lightEmission},get refractionAmount(){return this._refractionAmount},get reflectionAmount(){return this._reflectionAmount},get texture(){return this._texture},get lightmap(){return this._lightmap},get normalMap(){return this._normalMap},get textureOffset(){return this._textureOffset},get textureScale(){return this._textureScale},get lightmapOffset(){return this._lightmapOffset},get lightmapScale(){return this._lightmapScale},get normalMapOffset(){return this._normalMapOffset},get normalMapScale(){return this._normalMapScale},get castShadows(){return this._castShadows},get receiveShadows(){return this._receiveShadows},get alphaCutoff(){return this._alphaCutoff},get shininessMask(){return this._shininessMask},get shininessMaskChannel(){return this._shininessMaskChannel},get shininessMaskInvert(){return this._shininessMaskInvert},get lightEmissionMask(){return this._lightEmissionMask},get lightEmissionMaskChannel(){return this._lightEmissionMaskChannel},get lightEmissionMaskInvert(){return this._lightEmissionMaskInvert},get reflectionMask(){return this._reflectionMask},get reflectionMaskChannel(){return this._reflectionMaskChannel},get reflectionMaskInvert(){return this._reflectionMaskInvert},get cullFace(){return this._cullFace},set diffuse(t){this._diffuse=t},set specular(t){this._specular=t},set shininess(t){isNaN(t)||(this._shininess=t)},set lightEmission(t){isNaN(t)||(this._lightEmission=t)},set refractionAmount(t){this._refractionAmount=t},set reflectionAmount(t){this._reflectionAmount=t},set texture(t){this._texture=t},set lightmap(t){this._lightmap=t},set normalMap(t){this._normalMap=t},set textureOffset(t){this._textureOffset=t},set textureScale(t){this._textureScale=t},set lightmapOffset(t){this._lightmapOffset=t},set lightmapScale(t){this._lightmapScale=t},set normalMapOffset(t){this._normalMapOffset=t},set normalMapScale(t){this._normalMapScale=t},set castShadows(t){this._castShadows=t},set receiveShadows(t){this._receiveShadows=t},set alphaCutoff(t){isNaN(t)||(this._alphaCutoff=t)},set shininessMask(t){this._shininessMask=t},set shininessMaskChannel(t){this._shininessMaskChannel=t},set shininessMaskInvert(t){this._shininessMaskInvert=t},set lightEmissionMask(t){this._lightEmissionMask=t},set lightEmissionMaskChannel(t){this._lightEmissionMaskChannel=t},set lightEmissionMaskInvert(t){this._lightEmissionMaskInvert=t},set reflectionMask(t){this._reflectionMask=t},set reflectionMaskChannel(t){this._reflectionMaskChannel=t},set reflectionMaskInvert(t){this._reflectionMaskInvert=t},set cullFace(t){this._cullFace=t},get lightEmissionMaskChannelVector(){return r(this.lightEmissionMaskChannel)},get shininessMaskChannelVector(){return r(this.shininessMaskChannel)},get reflectionMaskChannelVector(){return r(this.reflectionMaskChannel)},copyMaterialSettings:function(t,e){e&bg.base.MaterialFlag.DIFFUSE&&(t.diffuse=this.diffuse),e&bg.base.MaterialFlag.SPECULAR&&(t.specular=this.specular),e&bg.base.MaterialFlag.SHININESS&&(t.shininess=this.shininess),e&bg.base.MaterialFlag.LIGHT_EMISSION&&(t.lightEmission=this.lightEmission),e&bg.base.MaterialFlag.REFRACTION_AMOUNT&&(t.refractionAmount=this.refractionAmount),e&bg.base.MaterialFlag.REFLECTION_AMOUNT&&(t.reflectionAmount=this.reflectionAmount),e&bg.base.MaterialFlag.TEXTURE&&(t.texture=this.texture),e&bg.base.MaterialFlag.LIGHT_MAP&&(t.lightmap=this.lightmap),e&bg.base.MaterialFlag.NORMAL_MAP&&(t.normalMap=this.normalMap),e&bg.base.MaterialFlag.TEXTURE_OFFSET&&(t.textureOffset=this.textureOffset),e&bg.base.MaterialFlag.TEXTURE_SCALE&&(t.textureScale=this.textureScale),e&bg.base.MaterialFlag.LIGHT_MAP_OFFSET&&(t.lightmapOffset=this.lightmapOffset),e&bg.base.MaterialFlag.LIGHT_MAP_SCALE&&(t.lightmapScale=this.lightmapScale),e&bg.base.MaterialFlag.NORMAL_MAP_OFFSET&&(t.normalMapOffset=this.normalMapOffset),e&bg.base.MaterialFlag.NORMAL_MAP_SCALE&&(t.normalMapScale=this.normalMapScale),e&bg.base.MaterialFlag.CAST_SHADOWS&&(t.castShadows=this.castShadows),e&bg.base.MaterialFlag.RECEIVE_SHADOWS&&(t.receiveShadows=this.receiveShadows),e&bg.base.MaterialFlag.ALPHA_CUTOFF&&(t.alphaCutoff=this.alphaCutoff),e&bg.base.MaterialFlag.SHININESS_MASK&&(t.shininessMask=this.shininessMask),e&bg.base.MaterialFlag.SHININESS_MASK_CHANNEL&&(t.shininessMaskChannel=this.shininessMaskChannel),e&bg.base.MaterialFlag.SHININESS_MASK_INVERT&&(t.shininessMaskInvert=this.shininessMaskInvert),e&bg.base.MaterialFlag.LIGHT_EMISSION_MASK&&(t.lightEmissionMask=this.lightEmissionMask),e&bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL&&(t.lightEmissionMaskChannel=this.lightEmissionMaskChannel),e&bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT&&(t.lightEmissionMaskInvert=this.lightEmissionMaskInvert),e&bg.base.MaterialFlag.REFLECTION_MASK&&(t.reflectionMask=this.reflectionMask),e&bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL&&(t.reflectionMaskChannel=this.reflectionMaskChannel),e&bg.base.MaterialFlag.REFLECTION_MASK_INVERT&&(t.reflectionMaskInvert=this.reflectionMaskInvert),e&bg.base.MaterialFlag.CULL_FACE&&(t.cullFace=this.cullFace)},applyModifier:function(t,e,i){e.isEnabled(bg.base.MaterialFlag.DIFFUSE)&&(this.diffuse=e.diffuse),e.isEnabled(bg.base.MaterialFlag.SPECULAR)&&(this.specular=e.specular),e.isEnabled(bg.base.MaterialFlag.SHININESS)&&(this.shininess=e.shininess),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION)&&(this.lightEmission=e.lightEmission),e.isEnabled(bg.base.MaterialFlag.REFRACTION_AMOUNT)&&(this.refractionAmount=e.refractionAmount),e.isEnabled(bg.base.MaterialFlag.REFLECTION_AMOUNT)&&(this.reflectionAmount=e.reflectionAmount),e.isEnabled(bg.base.MaterialFlag.TEXTURE)&&(this.texture=n(t,e.texture,i)),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP)&&(this.lightmap=n(t,e.lightmap,i)),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP)&&(this.normalMap=n(t,e.normalMap,i)),e.isEnabled(bg.base.MaterialFlag.TEXTURE_OFFSET)&&(this.textureOffset=e.textureOffset),e.isEnabled(bg.base.MaterialFlag.TEXTURE_SCALE)&&(this.textureScale=e.textureScale),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_OFFSET)&&(this.lightmapOffset=e.lightmapOffset),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_SCALE)&&(this.lightmapScale=e.lightmapScale),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_OFFSET)&&(this.normalMapOffset=e.normalMapOffset),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_SCALE)&&(this.normalMapScale=e.normalMapScale),e.isEnabled(bg.base.MaterialFlag.CAST_SHADOWS)&&(this.castShadows=e.castShadows),e.isEnabled(bg.base.MaterialFlag.RECEIVE_SHADOWS)&&(this.receiveShadows=e.receiveShadows),e.isEnabled(bg.base.MaterialFlag.ALPHA_CUTOFF)&&(this.alphaCutoff=e.alphaCutoff),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK)&&(this.shininessMask=n(t,e.shininessMask,i)),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_CHANNEL)&&(this.shininessMaskChannel=e.shininessMaskChannel),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_INVERT)&&(this.shininessMaskInvert=e.shininessMaskInvert),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK)&&(this.lightEmissionMask=n(t,e.lightEmissionMask,i)),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL)&&(this.lightEmissionMaskChannel=e.lightEmissionMaskChannel),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT)&&(this.lightEmissionMaskInvert=e.lightEmissionMaskInvert),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK)&&(this.reflectionMask=n(t,e.reflectionMask,i)),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL)&&(this.reflectionMaskChannel=e.reflectionMaskChannel),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_INVERT)&&(this.reflectionMaskInvert=e.reflectionMaskInvert),e.isEnabled(bg.base.MaterialFlag.CULL_FACE)&&(this.cullFace=e.cullFace)},getModifierWithMask:function(t){var e=new a;e.isEnabled(bg.base.MaterialFlag.DIFFUSE)&&(e.diffuse=this.diffuse),e.isEnabled(bg.base.MaterialFlag.SPECULAR)&&(e.specular=this.specular),e.isEnabled(bg.base.MaterialFlag.SHININESS)&&(e.shininess=this.shininess),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION)&&(e.lightEmission=this.lightEmission),e.isEnabled(bg.base.MaterialFlag.REFRACTION_AMOUNT)&&(e.refractionAmount=this.refractionAmount),e.isEnabled(bg.base.MaterialFlag.REFLECTION_AMOUNT)&&(e.reflectionAmount=this.reflectionAmount),e.isEnabled(bg.base.MaterialFlag.TEXTURE)&&(e.texture=i(this.texture)),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP)&&(e.lightmap=i(this.lightmap)),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP)&&(e.normalMap=i(this.normalMap)),e.isEnabled(bg.base.MaterialFlag.TEXTURE_OFFSET)&&(e.textureOffset=this.textureOffset),e.isEnabled(bg.base.MaterialFlag.TEXTURE_SCALE)&&(e.textureScale=this.textureScale),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_OFFSET)&&(e.lightmapOffset=this.lightmapOffset),e.isEnabled(bg.base.MaterialFlag.LIGHT_MAP_SCALE)&&(e.lightmapScale=this.lightmapScale),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_OFFSET)&&(e.normalMapOffset=this.normalMapOffset),e.isEnabled(bg.base.MaterialFlag.NORMAL_MAP_SCALE)&&(e.normalMapScale=this.normalMapScale),e.isEnabled(bg.base.MaterialFlag.CAST_SHADOWS)&&(e.castShadows=this.castShadows),e.isEnabled(bg.base.MaterialFlag.RECEIVE_SHADOWS)&&(e.receiveShadows=this.receiveShadows),e.isEnabled(bg.base.MaterialFlag.ALPHA_CUTOFF)&&(e.alphaCutoff=this.alphaCutoff),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK)&&(e.shininessMask=i(this.shininessMask)),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_CHANNEL)&&(e.shininessMaskChannel=this.shininessMaskChannel),e.isEnabled(bg.base.MaterialFlag.SHININESS_MASK_INVERT)&&(e.shininessMaskInvert=this.shininessMaskInvert),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK)&&(e.lightEmissionMask=i(this.lightEmissionMask)),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_CHANNEL)&&(e.lightEmissionMaskChannel=this.lightEmissionMaskChannel),e.isEnabled(bg.base.MaterialFlag.LIGHT_EMISSION_MASK_INVERT)&&(e.lightEmissionMaskInver=this.lightEmissionMaskInver),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK)&&(e.reflectionMask=i(this.reflectionMask)),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_CHANNEL)&&(e.reflectionMaskChannel=this.reflectionMaskChannel),e.isEnabled(bg.base.MaterialFlag.REFLECTION_MASK_INVERT)&&(e.reflectionMaskInvert=this.reflectionMaskInvert),e.isEnabled(bg.base.MaterialFlag.CULL_FACE)&&(e.cullFace=this.cullFace),e.setFlags(t)}},{GetMaterialWithJson:function(n,i,r){function a(t,e){return e?t?t+e:e:null}var s=new e;return void 0===i.cullFace&&(i.cullFace=!0),s.diffuse.set(i.diffuseR,i.diffuseG,i.diffuseB,i.diffuseA),s.specular.set(i.specularR,i.specularG,i.specularB,i.specularA),s.shininess=i.shininess,s.lightEmission=i.lightEmission,s.refractionAmount=i.refractionAmount,s.reflectionAmount=i.reflectionAmount,s.textureOffset.set(i.textureOffsetX,i.textureOffsetY),s.textureScale.set(i.textureScaleX,i.textureScaleY),s.lightmapOffset.set(i.lightmapOffsetX,i.lightmapOffsetY),s.lightmapScale.set(i.lightmapScaleX,i.lightmapScaleY),s.normalMapOffset.set(i.normalMapOffsetX,i.normalMapOffsetY),s.normalMapScale.set(i.normalMapScaleX,i.normalMapScaleY),s.alphaCutoff=i.alphaCutoff,s.castShadows=i.castShadows,s.receiveShadows=i.receiveShadows,s.shininessMaskChannel=i.shininessMaskChannel,s.shininessMaskInvert=i.invertShininessMask,s.lightEmissionMaskChannel=i.lightEmissionMaskChannel,s.lightEmissionMaskInvert=i.invertLightEmissionMask,s.reflectionMaskChannel=i.reflectionMaskChannel,s.reflectionMaskInvert=i.invertReflectionMask,s.cullFace=i.cullFace,r&&"/"!=r[r.length-1]&&(r+="/"),i.texture=a(r,i.texture),i.lightmap=a(r,i.lightmap),i.normalMap=a(r,i.normalMap),i.shininessMask=a(r,i.shininessMask),i.lightEmissionMask=a(r,i.lightEmissionMask),i.reflectionMask=a(r,i.reflectionMask),new Promise(function(e,r){var a=[];i.texture&&a.push(i.texture),i.lightmap&&-1==a.indexOf(i.lightmap)&&a.push(i.lightmap),i.normalMap&&-1==a.indexOf(i.normalMap)&&a.push(i.normalMap),i.shininessMask&&-1==a.indexOf(i.shininessMask)&&a.push(i.shininessMask),i.lightEmissionMask&&-1==a.indexOf(i.lightEmissionMask)&&a.push(i.lightEmissionMask),i.reflectionMask&&-1==a.indexOf(i.reflectionMask)&&a.push(i.reflectionMask),bg.utils.Resource.Load(a).then(function(r){s.texture=t(n,r[i.texture],i.texture),s.lightmap=t(n,r[i.lightmap],i.lightmap),s.normalMap=t(n,r[i.normalMap],i.normalMap),s.shininessMask=t(n,r[i.shininessMask],i.shininessMask),s.lightEmissionMask=t(n,r[i.lightEmissionMask],i.lightEmissionMask),s.reflectionMask=t(n,r[i.reflectionMask],i.reflectionMask),e(s)})})}})}();bg.base.Material=s}(),function(){var t=function(){function t(){this._matrix=new bg.Matrix4.Identity,this._stack=[],this._changed=!0}return $traceurRuntime.createClass(t,{get changed(){return this._changed},set changed(t){this._changed=t},push:function(){this._stack.push(new bg.Matrix4(this._matrix))},set:function(t){return this._matrix.assign(t),this._changed=!0,this},mult:function(t){return this._matrix.mult(t),this._changed=!0,this},identity:function(){return this._matrix.identity(),this._changed=!0,this},translate:function(t,e,n){return this._matrix.translate(t,e,n),this._changed=!0,this},rotate:function(t,e,n,i){return this._matrix.rotate(t,e,n,i),this._changed=!0,this},scale:function(t,e,n){return this._matrix.scale(t,e,n),this._changed=!0,this},perspective:function(t,e,n,i){return this._matrix.identity().perspective(t,e,n,i),this._changed=!0,this},frustum:function(t,e,n,i,r,a){return this._matrix.identity().frustum(t,e,n,i,r,a),this._changed=!0,this},ortho:function(t,e,n,i,r,a){return this._matrix.identity().ortho(t,e,n,i,r,a),this._changed=!0,this},invert:function(){return this._matrix.invert(),this._changed=!0,this},get matrix(){return this._changed=!0,this._matrix},get matrixConst(){return this._matrix},pop:function(){return this._stack.length&&(this._matrix.assign(this._stack.pop()),this._changed=!0),this._matrix}},{})}();bg.base.MatrixStack=t;var e=null,n=function(){function n(){this._modelMatrixStack=new t,this._viewMatrixStack=new t,this._projectionMatrixStack=new t,this._modelViewMatrix=new bg.Matrix4.Identity,this._normalMatrix=new bg.Matrix4.Identity}return $traceurRuntime.createClass(n,{get modelMatrixStack(){return this._modelMatrixStack},get viewMatrixStack(){return this._viewMatrixStack},get projectionMatrixStack(){return this._projectionMatrixStack},get modelViewMatrix(){return(!this._modelViewMatrix||this._modelMatrixStack.changed||this._viewMatrixStack.changed)&&(this._modelViewMatrix=new bg.Matrix4(this._viewMatrixStack._matrix),this._modelViewMatrix.mult(this._modelMatrixStack._matrix),this._modelMatrixStack.changed=!1,this._viewMatrixStack.changed=!1),this._modelViewMatrix},get normalMatrix(){return(!this._normalMatrix||this._modelMatrixStack.changed||this._viewMatrixStack.changed)&&(this._normalMatrix=new bg.Matrix4(this.modelViewMatrix),this._normalMatrix.invert(),this._normalMatrix.traspose(),this._modelMatrixStack.changed=!1),this._normalMatrix},get viewMatrixInvert(){return this._viewMatrixInvert&&!this._viewMatrixStack.changed||(this._viewMatrixInvert=new bg.Matrix4(this.viewMatrixStack.matrixConst),this._viewMatrixInvert.invert()),this._viewMatrixInvert}},{Current:function(){return e||(e=new n),e},SetCurrent:function(t){return e=t}})}();bg.base.MatrixState=n}(),function(){function t(t){t._effect&&t._effect.setActive(),t.renderSurface.setActive(),bg.Engine.Get().pipeline.setViewport(t.context,t._viewport),bg.Engine.Get().pipeline.setDepthTestEnabled(t.context,t._depthTest),bg.Engine.Get().pipeline.setCullFace(t.context,t._cullFace),bg.Engine.Get().pipeline.setBlendEnabled(t.context,t._blend),bg.Engine.Get().pipeline.setBlendMode(t.context,t._blendMode)}bg.base.ClearBuffers={COLOR:null,DEPTH:null,COLOR_DEPTH:null},bg.base.BlendMode={NORMAL:1,MULTIPLY:2,ADD:3,SUBTRACT:4,ALPHA_ADD:5,ALPHA_SUBTRACT:6},bg.base.OpacityLayer={TRANSPARENT:1,OPAQUE:2,GIZMOS:4,SELECTION:8,ALL:15,NONE:0};var e=function(){function t(t){this.initFlags(t),bg.base.ClearBuffers.COLOR_DEPTH=bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH}return $traceurRuntime.createClass(t,{initFlags:function(t){},setViewport:function(t,e){},clearBuffers:function(t,e,n){},setDepthTestEnabled:function(t,e){},setBlendEnabled:function(t,e){},setBlendMode:function(t,e){},setCullFace:function(t,e){}},{})}();bg.base.PipelineImpl=e;var n=null,i=function(e){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._opacityLayer=bg.base.OpacityLayer.ALL,this._viewport=new bg.Viewport(0,0,200,200),this._clearColor=bg.Color.Black(),this._effect=null,this._textureEffect=null,this._depthTest=!0,this._cullFace=!0,this._renderSurface=null,this._blend=!1,this._blendMode=bg.base.BlendMode.NORMAL,this._buffersToClear=bg.base.ClearBuffers.COLOR_DEPTH}return $traceurRuntime.createClass(i,{get isCurrent(){return n==this},set opacityLayer(t){this._opacityLayer=t},get opacityLayer(){return this._opacityLayer},shouldDraw:function(t){return t&&(t.isTransparent&&0!=(this._opacityLayer&bg.base.OpacityLayer.TRANSPARENT)||!t.isTransparent&&0!=(this._opacityLayer&bg.base.OpacityLayer.OPAQUE))},get effect(){return this._effect},set effect(t){this._effect=t,this._effect&&this.isCurrent&&this._effect.setActive()},get textureEffect(){return this._textureEffect||(this._textureEffect=new bg.base.DrawTextureEffect(this.context)),this._textureEffect},set textureEffect(t){this._textureEffect=t},set buffersToClear(t){this._buffersToClear=t},get buffersToClear(){return this._buffersToClear},get renderSurface(){return this._renderSurface||(this._renderSurface=new bg.base.ColorSurface(this.context),this._renderSurface.setActive()),this._renderSurface},set renderSurface(t){this._renderSurface=t,this.isCurrent&&this._renderSurface.setActive()},draw:function(t){if(this._effect&&t&&this.isCurrent){var e=this.cullFace;this._effect.bindPolyList(t),this._effect.material&&(this.cullFace=this._effect.material.cullFace),t.draw(),this._effect.unbind(),this.cullFace=e}},drawTexture:function(t){var e=this.depthTest;this.depthTest=!1,this.textureEffect.drawSurface(t),this.depthTest=e},get blend(){return this._blend},set blend(t){this._blend=t,this.isCurrent&&bg.Engine.Get().pipeline.setBlendEnabled(this.context,this._blend)},get blendMode(){return this._blendMode},set blendMode(t){this._blendMode=t,this.isCurrent&&bg.Engine.Get().pipeline.setBlendMode(this.context,this._blendMode)},get viewport(){return this._viewport},set viewport(t){this._viewport=t,this.renderSurface.resizeOnViewportChanged&&(this.renderSurface.size=new bg.Vector2(t.width,t.height)),this.isCurrent&&bg.Engine.Get().pipeline.setViewport(this.context,this._viewport)},clearBuffers:function(t){this.isCurrent&&(t=void 0!==t?t:this._buffersToClear,bg.Engine.Get().pipeline.clearBuffers(this.context,this._clearColor,t))},get clearColor(){return this._clearColor},set clearColor(t){this._clearColor=t},get depthTest(){return this._depthTest},set depthTest(t){this._depthTest=t,this.isCurrent&&bg.Engine.Get().pipeline.setDepthTestEnabled(this.context,this._depthTest)},get cullFace(){return this._cullFace},set cullFace(t){this._cullFace=t,this.isCurrent&&bg.Engine.Get().pipeline.setCullFace(this.context,this._cullFace)}},{SetCurrent:function(e){(n=e)&&t(n)},Current:function(){return n}},e)}(bg.app.ContextObject);bg.base.Pipeline=i}(),function(){function t(t){if(t.texCoord0&&t.vertex){t._tangent=[];for(var e=[],n={},i=0;i<t.index.length-2;i+=3){var r=3*t.index[i],a=3*t.index[i+1],s=3*t.index[i+2],o=2*t.index[i],u=2*t.index[i+1],l=2*t.index[i+2],c=new bg.Vector3(t.vertex[r],t.vertex[r+1],t.vertex[r+2]),h=new bg.Vector3(t.vertex[a],t.vertex[a+1],t.vertex[a+2]),f=new bg.Vector3(t.vertex[s],t.vertex[s+1],t.vertex[s+2]),d=new bg.Vector2(t.texCoord0[o],t.texCoord0[o+1]),g=new bg.Vector2(t.texCoord0[u],t.texCoord0[u+1]),m=new bg.Vector2(t.texCoord0[l],t.texCoord0[l+1]),p=new bg.Vector3(h).sub(c),b=new bg.Vector3(f).sub(c),_=g.x-d.x,v=g.y-d.y,y=m.x-d.x,E=m.y-d.y,T=1/(_*E-y*v),x=new bg.Vector3(T*(E*p.x-v*b.x),T*(E*p.y-v*b.y),T*(E*p.z-v*b.z));x.normalize(),void 0===n[r]&&(e.push(x.x),e.push(x.y),e.push(x.z),n[r]=x),void 0===n[a]&&(e.push(x.x),e.push(x.y),e.push(x.z),n[a]=x),void 0===n[s]&&(e.push(x.x),e.push(x.y),e.push(x.z),n[s]=x)}return e}}var e=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){},create:function(t){},build:function(t,e,n,i,r,a,s,o,u,l){return!1},draw:function(t,e,n,i){},destroy:function(t,e){}},{})}();bg.base.PolyListImpl=e,bg.base.DrawMode={TRIANGLES:null,TRIANGLE_FAN:null,TRIANGLE_STRIP:null};var n=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._plist=null,this._drawMode=bg.base.DrawMode.TRIANGLES,this._name="",this._groupName="",this._visible=!0,this._vertex=[],this._normal=[],this._texCoord0=[],this._texCoord1=[],this._texCoord2=[],this._color=[],this._tangent=[],this._index=[]}return $traceurRuntime.createClass(n,{clone:function(){var t=new n(this.context),e=function(t,e){t.forEach(function(t){e.push(t)})};return t.name=this.name+" clone",t.groupName=this.groupName,t.visible=this.visible,t.drawMode=this.drawMode,e(this.vertex,t.vertex),e(this.normal,t.normal),e(this.texCoord0,t.texCoord0),e(this.texCoord1,t.texCoord1),e(this.texCoord2,t.texCoord02),e(this.color,t.color),e(this.index,t.index),t.build(),t},get name(){return this._name},set name(t){this._name=t},get groupName(){return this._groupName},set groupName(t){this._groupName=t},get visible(){return this._visible},set visible(t){this._visible=t},get drawMode(){return this._drawMode},set drawMode(t){this._drawMode=t},set vertex(t){this._vertex=t},set normal(t){this._normal=t},set texCoord0(t){this._texCoord0=t},set texCoord1(t){this._texCoord1=t},set texCoord2(t){this._texCoord2=t},
set color(t){this._color=t},set index(t){this._index=t},get vertex(){return this._vertex},get normal(){return this._normal},get texCoord0(){return this._texCoord0},get texCoord1(){return this._texCoord1},get texCoord2(){return this._texCoord2},get color(){return this._color},get tangent(){return this._tangent},get index(){return this._index},get vertexBuffer(){return this._plist.vertexBuffer},get normalBuffer(){return this._plist.normalBuffer},get texCoord0Buffer(){return this._plist.tex0Buffer},get texCoord1Buffer(){return this._plist.tex1Buffer},get texCoord2Buffer(){return this._plist.tex2Buffer},get colorBuffer(){return this._plist.colorBuffer},get tangentBuffer(){return this._plist.tangentBuffer},get indexBuffer(){return this._plist.indexBuffer},build:function(){var e=bg.Engine.Get().polyList;return this._plist&&(e.destroy(this.context,this._plist),this._tangent=[]),this._tangent=t(this),this._plist=e.create(this.context),e.build(this.context,this._plist,this._vertex,this._normal,this._texCoord0,this._texCoord1,this._texCoord2,this._color,this._tangent,this._index)},draw:function(){bg.Engine.Get().polyList.draw(this.context,this._plist,this.drawMode,this.index.length)},destroy:function(){this._plist&&bg.Engine.Get().polyList.destroy(this.context,this._plist),this._plist=null,this._name="",this._vertex=[],this._normal=[],this._texCoord0=[],this._texCoord1=[],this._texCoord2=[],this._color=[],this._tangent=[],this._index=[]},applyTransform:function(t){var e=new bg.Matrix4(t),n=new bg.Matrix4(t.getMatrix3());if(this.normal.length>0&&this.normal.length!=this.vertex.length)throw new Error("Unexpected number of normal coordinates found in polyList");for(var i=0;i<this.vertex.length-2;i+=3){var r=new bg.Vector4(this.vertex[i],this.vertex[i+1],this.vertex[i+2],1);if(r=e.multVector(r),this.vertex[i]=r.x,this.vertex[i+1]=r.y,this.vertex[i+2]=r.z,this.normal.length){var a=new bg.Vector4(this.normal[i],this.normal[i+1],this.normal[i+2],1);a=n.multVector(a),this.normal[i]=a.x,this.normal[i+1]=a.y,this.normal[i+2]=a.z}}this.build()}},{},e)}(bg.app.ContextObject);bg.base.PolyList=n}(),function(){function t(){return bg.base.ShaderLibrary.Get()}function e(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex]),i.addParameter(t().inputs.matrix.all),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t")),i}function n(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\tgl_FragColor = vec4(1.0,0.0,0.0,1.0);\n\t\t\t\t")),r}var i=null,r=null,a=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t);var r=[e(),n()];this.setupShaderSource(r)}return $traceurRuntime.createClass(i,{beginDraw:function(){},setupVars:function(){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst)}},{},t)}(bg.base.Effect);bg.base.RedEffect=a}(),function(){var t=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){},create:function(t,e){},setActive:function(t,e){},readBuffer:function(t,e,n){},resize:function(t,e,n){},destroy:function(t,e){},supportType:function(t){},supportFormat:function(t){},maxColorAttachments:function(){}},{})}();bg.base.RenderSurfaceBufferImpl=t;var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._size=new bg.Vector2(256),this._renderSurface=null,this._resizeOnViewportChanged=!0}return $traceurRuntime.createClass(e,{get size(){return this._size},set size(t){this._size.x==t.x&&this._size.y==t.y||(this._size=t,this.surfaceImpl.resize(this.context,this._renderSurface,t))},get surfaceImpl(){return null},get resizeOnViewportChanged(){return this._resizeOnViewportChanged},set resizeOnViewportChanged(t){this._resizeOnViewportChanged=t},create:function(t){t||(t=e.DefaultAttachments()),this._renderSurface=this.surfaceImpl.create(this.context,t)},setActive:function(){this.surfaceImpl.setActive(this.context,this._renderSurface)},readBuffer:function(t){return this.surfaceImpl.readBuffer(this.context,this._renderSurface,t,this.size)},destroy:function(){this.surfaceImpl.destroy(this.context,this._renderSurface),this._renderSurface=null}},{DefaultAttachments:function(){return[{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]},SupportFormat:function(t){return bg.Engine.Get().colorBuffer.supportFormat(t)},SupportType:function(t){return bg.Engine.Get().colorBuffer.supportType(t)},MaxColorAttachments:function(){return bg.Engine.Get().textureBuffer.maxColorAttachments}},t)}(bg.app.ContextObject);bg.base.RenderSurface=e,bg.base.RenderSurfaceType={RGBA:null,DEPTH:null},bg.base.RenderSurfaceFormat={UNSIGNED_BYTE:null,UNSIGNED_SHORT:null,FLOAT:null,RENDERBUFFER:null};var n=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{get surfaceImpl(){return bg.Engine.Get().colorBuffer}},{MaxColorAttachments:function(){return bg.Engine.Get().colorBuffer.maxColorAttachments}},t)}(e);bg.base.ColorSurface=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{get surfaceImpl(){return bg.Engine.Get().textureBuffer},getTexture:function(){var t=void 0!==arguments[0]?arguments[0]:0;return this._renderSurface.attachments[t]&&this._renderSurface.attachments[t].texture}},{MaxColorAttachments:function(){return bg.Engine.Get().textureBuffer.maxColorAttachments}},t)}(e);bg.base.TextureSurface=i}(),function(){function t(t){Reflect.defineProperty(t,"all",{get:function(){if(!this._all){this._all=[];for(var e in t)"object"==$traceurRuntime.typeof(t[e])&&t[e].name&&this._all.push(t[e])}return this._all}})}var e=null,n=function(){function n(){var e=bg[bg.Engine.Get().id].shaderLibrary;for(var n in e)this[n]=e[n];t(this.inputs.matrix),Object.defineProperty(this.inputs.matrix,"modelViewProjection",{get:function(){return[this.model,this.view,this.projection]}}),t(this.inputs.material),t(this.inputs.lighting),t(this.inputs.shadows),t(this.inputs.colorCorrection),t(this.functions.materials),t(this.functions.colorCorrection),t(this.functions.lighting),t(this.functions.utils)}return $traceurRuntime.createClass(n,{},{Get:function(){return e||(e=new n),e}})}();bg.base.ShaderLibrary=n;var i=function(){function t(){}return $traceurRuntime.createClass(t,{header:function(t){return""},parameter:function(t,e){return e.name},func:function(t,e){return e.name}},{})}();bg.base.ShaderSourceImpl=i;var r=function(){function t(t){this._type=t,this._params=[],this._functions=[],this._requiredExtensions=[],this._header=""}return $traceurRuntime.createClass(t,{get type(){return this._type},get params(){return this._params},get header(){return this._header},get functions(){return this._functions},addParameter:function(t){t instanceof Array?this._params=$traceurRuntime.spread(this._params,t):this._params.push(t),this._params.push(null)},addFunction:function(t){t instanceof Array?this._functions=$traceurRuntime.spread(this._functions,t):this._functions.push(t)},setMainBody:function(t){this.addFunction({returnType:"void",name:"main",params:{},body:t})},appendHeader:function(t){this._header+=t+"\n"},toString:function(){var t=this,e=bg.Engine.Get().shaderSource,n=e.header(this.type)+"\n"+this._header+"\n\n";return this.params.forEach(function(i){n+=e.parameter(t.type,i)+"\n"}),this.functions.forEach(function(i){n+="\n"+e.func(t.type,i)+"\n"}),n}},{FormatSource:function(t){var e="",n=t.replace(/^\n*/,"").replace(/\n*$/,"").split("\n"),i=100;return n.forEach(function(t){var e=/(\t*)/.exec(t)[0].length;i>e&&(i=e)}),n.forEach(function(t){var n=/(\t*)/.exec(t)[0].length,r=n-i;e+=t.slice(n-r,t.length)+"\n"}),e.replace(/^\n*/,"").replace(/\n*$/,"")}})}();bg.base.ShaderSource=r}(),function(){function t(t){var e="";return t.split("\n").forEach(function(t,n){++n,e+=(n<10?"00":n<100?"0":"")+n+" | "+t+"\n"}),e}var e=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){},setActive:function(t,e){},create:function(t){},addShaderSource:function(t,e,n,i){},link:function(t,e){},initVars:function(t,e,n,i){},setInputBuffer:function(t,e,n,i,r){},setValueInt:function(t,e,n,i){},setValueFloat:function(t,e,n,i){},setValueVector2:function(t,e,n,i){},setValueVector3:function(t,e,n,i){},setValueVector4:function(t,e,n,i){},setValueVector2v:function(t,e,n,i){},setValueVector3v:function(t,e,n,i){},setValueVector4v:function(t,e,n,i){},setValueMatrix3:function(t,e,n,i,r){},setValueMatrix4:function(t,e,n,i,r){},setTexture:function(t,e,n,i,r){}},{})}();bg.base.ShaderImpl=e,bg.base.ShaderType={VERTEX:null,FRAGMENT:null};var n=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._shader=bg.Engine.Get().shader.create(t),this._linked=!1,this._compileError=null,this._linkError=null}return $traceurRuntime.createClass(n,{get shader(){return this._shader},get compileError(){return this._compileError},get compileErrorSource(){return this._compileErrorSource},get linkError(){return this._linkError},get status(){return null==this._compileError&&null==this._linkError},addShaderSource:function(e,n){return this._linked?this._compileError="Tying to attach a shader to a linked program":this._compileError||(this._compileError=bg.Engine.Get().shader.addShaderSource(this.context,this._shader,e,n),this._compileError&&(this._compileErrorSource=t(n))),null==this._compileError},link:function(){return this._linkError=null,this._linked?this._linkError="Shader already linked":(this._linkError=bg.Engine.Get().shader.link(this.context,this._shader),this._linked=null==this._linkError),this._linked},setActive:function(){bg.Engine.Get().shader.setActive(this.context,this._shader)},clearActive:function(){n.ClearActive(this.context)},initVars:function(t,e){bg.Engine.Get().shader.initVars(this.context,this._shader,t,e)},setInputBuffer:function(t,e,n){bg.Engine.Get().shader.setInputBuffer(this.context,this._shader,t,e,n)},disableInputBuffer:function(t){bg.Engine.Get().shader.disableInputBuffer(this.context,this._shader,t)},setValueInt:function(t,e){bg.Engine.Get().shader.setValueInt(this.context,this._shader,t,e)},setValueFloat:function(t,e){bg.Engine.Get().shader.setValueFloat(this.context,this._shader,t,e)},setVector2:function(t,e){bg.Engine.Get().shader.setValueVector2(this.context,this._shader,t,e)},setVector3:function(t,e){bg.Engine.Get().shader.setValueVector3(this.context,this._shader,t,e)},setVector4:function(t,e){bg.Engine.Get().shader.setValueVector4(this.context,this._shader,t,e)},setVector2Ptr:function(t,e){bg.Engine.Get().shader.setValueVector2v(this.context,this._shader,t,e)},setVector3Ptr:function(t,e){bg.Engine.Get().shader.setValueVector3v(this.context,this._shader,t,e)},setVector4Ptr:function(t,e){bg.Engine.Get().shader.setValueVector4v(this.context,this._shader,t,e)},setMatrix3:function(t,e){var n=void 0!==arguments[2]&&arguments[2];bg.Engine.Get().shader.setValueMatrix3(this.context,this._shader,t,n,e)},setMatrix4:function(t,e){var n=void 0!==arguments[2]&&arguments[2];bg.Engine.Get().shader.setValueMatrix4(this.context,this._shader,t,n,e)},setTexture:function(t,e,n){bg.Engine.Get().shader.setTexture(this.context,this._shader,t,e,n)}},{ClearActive:function(t){bg.Engine.Get().shader.setActive(t,null)}},e)}(bg.app.ContextObject);bg.base.Shader=n}(),function(){function t(){return bg.base.ShaderLibrary.Get()}function e(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,null,t().inputs.matrix.model,t().inputs.matrix.view,t().inputs.matrix.projection,null,{name:"fsTexCoord",dataType:"vec2",role:"out"}]),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\tfsTexCoord = inTex0;\n\t\t\t\t")),i}function n(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),r.addParameter([t().inputs.material.castShadows,t().inputs.material.texture,t().inputs.material.textureOffset,t().inputs.material.textureScale,t().inputs.material.alphaCutoff,null,{name:"fsTexCoord",dataType:"vec2",role:"in"}]),r.addFunction(t().functions.utils.pack),r.addFunction(t().functions.materials.samplerColor),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\n\t\t\t\tfloat alpha = samplerColor(inTexture,fsTexCoord,inTextureOffset,inTextureScale).a;\n\t\t\t\tif (inCastShadows && alpha>inAlphaCutoff) {\n\t\t\t\t\tgl_FragColor = pack(gl_FragCoord.z);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdiscard;\n\t\t\t\t}")),r}var i=null,r=null,a=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._material=null,this._light=null,this._lightTransform=null,this.setupShaderSource([e(),n()])}return $traceurRuntime.createClass(i,{get material(){return this._material},set material(t){this._material=t},get light(){return this._light},set light(t){this._light=t},get lightTransform(){return this._lightTransform},set lightTransform(t){this._lightTransform=t},setupVars:function(){if(this.material&&this.light&&this.lightTransform){var t=bg.base.MatrixState.Current();this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",this.lightTransform),this.shader.setMatrix4("inProjectionMatrix",this.light.projection),this.shader.setValueInt("inCastShadows",this.material.castShadows);var e=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context);this.shader.setTexture("inTexture",e,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setValueFloat("inAlphaCutoff",this.material.alphaCutoff)}}},{},t)}(bg.base.Effect);bg.base.ShadowMapEffect=a,bg.base.ShadowType={HARD:0,SOFT:1,STRATIFIED:2};var s=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._pipeline=new bg.base.Pipeline(t),this._pipeline.renderSurface=new bg.base.TextureSurface(t),this._pipeline.renderSurface.create(),this._pipeline.effect=new bg.base.ShadowMapEffect(t),this._matrixState=new bg.base.MatrixState,this._drawVisitor=new bg.scene.DrawVisitor(this._pipeline,this._matrixState),this._shadowMapSize=new bg.Vector2(2048),this._pipeline.viewport=new bg.Viewport(0,0,this._shadowMapSize.width,this._shadowMapSize.height),this._shadowType=bg.base.ShadowType.SOFT,this._projection=bg.Matrix4.Ortho(-15,15,-15,15,1,50),this._viewMatrix=bg.Matrix4.Identity(),this._shadowColor=bg.Color.Black()}return $traceurRuntime.createClass(e,{get size(){return this._shadowMapSize},set size(t){this._shadowMapSize=t,this._pipeline.viewport=new bg.Viewport(0,0,t.width,t.height)},get shadowType(){return this._shadowType},set shadowType(t){this._shadowType=t},get shadowColor(){return this._shadowColor},set shadowColor(t){this._shadowColor=t},get viewMatrix(){return this._viewMatrix},get projection(){return this._projection},get texture(){return this._pipeline.renderSurface.getTexture(0)},update:function(t,e,n,i){var r=bg.base.MatrixState.Current();if(bg.base.MatrixState.SetCurrent(this._matrixState),this._pipeline.effect.light=n,this._viewMatrix=new bg.Matrix4(i),n.type==bg.base.LightType.DIRECTIONAL){var a=this._viewMatrix.rotation,s=e.transform.matrix.position,o=new bg.Matrix4(e.transform.matrix),u=s.add(o.forwardVector.scale(-e.focus));window.camera=e,window.cameraTransform=e.transform.matrix,this._viewMatrix.identity().translate(u).mult(a).translate(0,0,10).invert(),n.projection=bg.Matrix4.Ortho(-e.focus,e.focus,-e.focus,e.focus,1,300*e.focus)}this._projection=n.projection,this._pipeline.effect.lightTransform=this._viewMatrix,bg.base.Pipeline.SetCurrent(this._pipeline),this._pipeline.clearBuffers(bg.base.ClearBuffers.COLOR_DEPTH),t.accept(this._drawVisitor),bg.base.MatrixState.SetCurrent(r)}},{},t)}(bg.app.ContextObject);bg.base.ShadowMap=s}(),function(){var t={},e=8,n=function(){function n(t){this._context=t,this._textures={}}return $traceurRuntime.createClass(n,{find:function(t){return this._textures[t]},register:function(t,e){e instanceof bg.base.Texture&&(this._textures[t]=e)},unregister:function(t){this._textures[t]&&delete this._textures[t]},clear:function(){this._textures={}}},{SetColorTextureSize:function(t){e=t},GetColorTextureSize:function(){return e},WhiteTexture:function(t){var i=n.Get(t),r=i.find("static-white-color-texture");return r||(r=bg.base.Texture.WhiteTexture(t,new bg.Vector2(e)),i.register("static-white-color-texture",r)),r},BlackTexture:function(t){var i=n.Get(t),r=i.find("static-black-color-texture");return r||(r=bg.base.Texture.BlackTexture(t,new bg.Vector2(e)),i.register("static-black-color-texture",r)),r},NormalTexture:function(t){var i=n.Get(t),r=i.find("static-normal-color-texture");return r||(r=bg.base.Texture.NormalTexture(t,new bg.Vector2(e)),i.register("static-normal-color-texture",r)),r},RandomTexture:function(t){var e=n.Get(t),i=e.find("static-random-color-texture");return i||(i=bg.base.Texture.RandomTexture(t,new bg.Vector2(64)),e.register("static-random-color-texture",i)),i},Get:function(e){return t[e.uuid]||(t[e.uuid]=new n(e)),t[e.uuid]}})}();bg.base.TextureCache=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{acceptType:function(t,e){return bg.utils.Resource.IsImage(t)},load:function(t,e,n){return new Promise(function(i,r){if(n){var a=bg.base.TextureCache.Get(t).find(e);a||(bg.log("Texture "+e+" not found. Loading texture"),a=new bg.base.Texture(t),a.create(),a.bind(),a.minFilter=bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST,a.magFilter=bg.base.TextureFilter.LINEAR,a.setImage(n),a.fileName=e,bg.base.TextureCache.Get(t).register(e,a)),i(a)}else r(new Error("Error loading texture image data"))})}},{},t)}(bg.base.LoaderPlugin);bg.base.TextureLoaderPlugin=i;var r=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{acceptType:function(t,e){return bg.utils.Resource.IsVideo(t)},load:function(t,e,n){return new Promise(function(i,r){if(n){var a=new bg.base.Texture(t);a.create(),a.bind(),a.setVideo(n),a.fileName=e,i(a)}else r(new Error("Error loading video texture data"))})}},{},t)}(bg.base.LoaderPlugin);bg.base.VideoTextureLoaderPlugin=r}(),function(){bg.base.TextureUnit={TEXTURE_0:0,TEXTURE_1:1,TEXTURE_2:2,TEXTURE_3:3,TEXTURE_4:4,TEXTURE_5:5,TEXTURE_6:6,TEXTURE_7:7,TEXTURE_8:8,TEXTURE_9:9,TEXTURE_10:10,TEXTURE_11:11,TEXTURE_12:12,TEXTURE_13:13,TEXTURE_14:14,TEXTURE_15:15,TEXTURE_16:16,TEXTURE_17:17,TEXTURE_18:18,TEXTURE_19:19,TEXTURE_20:20,TEXTURE_21:21,TEXTURE_22:22,TEXTURE_23:23,TEXTURE_24:24,TEXTURE_25:25,TEXTURE_26:26,TEXTURE_27:27,TEXTURE_28:28,TEXTURE_29:29,TEXTURE_30:30},bg.base.TextureWrap={REPEAT:null,CLAMP:null},bg.base.TextureFilter={NEAREST_MIPMAP_NEAREST:null,LINEAR_MIPMAP_NEAREST:null,NEAREST_MIPMAP_LINEAR:null,LINEAR_MIPMAP_LINEAR:null,NEAREST:null,LINEAR:null},bg.base.TextureTarget={TEXTURE_2D:null,CUBE_MAP:null,POSITIVE_X_FACE:null,NEGATIVE_X_FACE:null,POSITIVE_Y_FACE:null,NEGATIVE_Y_FACE:null,POSITIVE_Z_FACE:null,NEGATIVE_Z_FACE:null};var t=function(){function t(t){this.initFlags(t)}return $traceurRuntime.createClass(t,{initFlags:function(t){console.log("TextureImpl: initFlags() method not implemented")},create:function(t){return console.log("TextureImpl: create() method not implemented"),null},setActive:function(t,e){console.log("TextureImpl: setActive() method not implemented")},bind:function(t,e,n){console.log("TextureImpl: bind() method not implemented")},unbind:function(t,e){console.log("TextureImpl: unbind() method not implemented")},setTextureWrapX:function(t,e,n,i){console.log("TextureImpl: setTextureWrapX() method not implemented")},setTextureWrapY:function(t,e,n,i){console.log("TextureImpl: setTextureWrapY() method not implemented")},setImage:function(t,e,n,i,r,a,s){console.log("TextureImpl: setImage() method not implemented")},setImageRaw:function(t,e,n,i,r,a,s,o){console.log("TextureImpl: setImageRaw() method not implemented")},setVideo:function(t,e,n,i,r){console.log("TextureImpl: setVideo() method not implemented")},updateVideoData:function(t,e,n,i){console.log("TextureImpl: updateVideoData() method not implemented")},destroy:function(t,e){console.log("TextureImpl: destroy() method not implemented")}},{})}();bg.base.TextureImpl=t;var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._texture=null,this._fileName="",this._size=new bg.Vector2(0),this._target=bg.base.TextureTarget.TEXTURE_2D,this._minFilter=bg.base.TextureFilter.LINEAR,this._magFilter=bg.base.TextureFilter.LINEAR,this._wrapX=bg.base.TextureWrap.REPEAT,this._wrapY=bg.base.TextureWrap.REPEAT,this._video=null}return $traceurRuntime.createClass(e,{get texture(){return this._texture},get target(){return this._target},set target(t){this._target=t},get fileName(){return this._fileName},set fileName(t){this._fileName=t},set minFilter(t){this._minFilter=t},set magFilter(t){this._magFilter=t},get minFilter(){return this._minFilter},get magFilter(){return this._magFilter},set wrapX(t){this._wrapX=t},set wrapY(t){this._wrapY=t},get wrapX(){return this._wrapX},get wrapY(){return this._wrapY},get size(){return this._size},get video(){return this._video},create:function(){null!==this._texture&&this.destroy(),this._texture=bg.Engine.Get().texture.create(this.context)},setActive:function(t){bg.Engine.Get().texture.setActive(this.context,t)},bind:function(){bg.Engine.Get().texture.bind(this.context,this._target,this._texture)},unbind:function(){e.Unbind(this.context,this._target)},setImage:function(t,e){void 0===e&&(e=!0),this._size.width=t.width,this._size.height=t.height,bg.Engine.Get().texture.setTextureWrapX(this.context,this._target,this._texture,this._wrapX),bg.Engine.Get().texture.setTextureWrapY(this.context,this._target,this._texture,this._wrapY),bg.Engine.Get().texture.setImage(this.context,this._target,this._minFilter,this._magFilter,this._texture,t,e)},setImageRaw:function(t,e,n,i,r){i||(i=this.context.RGBA),r||(r=this.context.UNSIGNED_BYTE),this._size.width=t,this._size.height=e,bg.Engine.Get().texture.setTextureWrapX(this.context,this._target,this._texture,this._wrapX),bg.Engine.Get().texture.setTextureWrapY(this.context,this._target,this._texture,this._wrapY),bg.Engine.Get().texture.setImageRaw(this.context,this._target,this._minFilter,this._magFilter,this._texture,t,e,n,i,r)},setVideo:function(t,e){void 0===e&&(e=!0),this._size.width=t.videoWidth,this._size.height=t.videoHeight,bg.Engine.Get().texture.setVideo(this.context,this._target,this._texture,t,e),this._video=t},destroy:function(){bg.Engine.Get().texture.destroy(this.context,this._texture),this._texture=null,this._minFilter=null,this._magFilter=null,this._fileName=""},valid:function(){return null!==this._texture},update:function(){bg.Engine.Get().texture.updateVideoData(this.context,this._target,this._texture,this._video)}},{ColorTexture:function(t,e,n){var i=new bg.base.Texture(t);i.create(),i.bind();for(var r=n.width*n.height*4,a=[],s=0;s<r;s+=4)a[s]=255*e.r,a[s+1]=255*e.g,a[s+2]=255*e.b,a[s+3]=255*e.a;return a=new Uint8Array(a),i.minFilter=bg.base.TextureFilter.NEAREST,i.magFilter=bg.base.TextureFilter.NEAREST,i.setImageRaw(n.width,n.height,a),i.unbind(),i},WhiteTexture:function(t,n){return e.ColorTexture(t,bg.Color.White(),n)},NormalTexture:function(t,n){return e.ColorTexture(t,new bg.Color(.5,.5,1,1),n)},BlackTexture:function(t,n){return e.ColorTexture(t,bg.Color.Black(),n)},RandomTexture:function(t,e){var n=new bg.base.Texture(t);n.create(),n.bind();for(var i=e.width*e.height*4,r=[],a=0;a<i;a+=4){var s=new bg.Vector3(2*bg.Math.random()-1,2*bg.Math.random()-1,0);s.normalize(),r[a]=255*s.x,r[a+1]=255*s.y,r[a+2]=255*s.z,r[a+3]=1}return r=new Uint8Array(r),n.minFilter=bg.base.TextureFilter.NEAREST,n.magFilter=bg.base.TextureFilter.NEAREST,n.setImageRaw(e.width,e.height,r),n.unbind(),n},SetActive:function(t,e){bg.Engine.Get().texture.setActive(t,e)},Unbind:function(t,e){e||(e=bg.base.TextureTarget.TEXTURE_2D),bg.Engine.Get().texture.unbind(t,e)}},t)}(bg.app.ContextObject);bg.base.Texture=e}(),function(){bg.Math={PI:3.141592653589793,DEG_TO_RAD:.01745329251994,RAD_TO_DEG:57.29577951308233,PI_2:1.5707963267948966,PI_4:.785398163397448,TWO_PI:6.283185307179586,EPSILON:1e-7,Array:Float32Array,FLOAT_MAX:3.402823e38,checkZero:function(t){return t>-this.EPSILON&&t<this.EPSILON?0:t},equals:function(t,e){return Math.abs(t-e)<this.EPSILON},degreesToRadians:function(t){return Math.fround(this.checkZero(t*this.DEG_TO_RAD))},radiansToDegrees:function(t){return Math.fround(this.checkZero(t*this.RAD_TO_DEG))},sin:function(t){return Math.fround(this.checkZero(Math.sin(t)))},cos:function(t){return Math.fround(this.checkZero(Math.cos(t)))},tan:function(t){return Math.fround(this.checkZero(Math.tan(t)))},cotan:function(t){return Math.fround(this.checkZero(1/this.tan(t)))},atan:function(t){return Math.fround(this.checkZero(Math.atan(t)))},atan2:function(t,e){return Math.fround(this.checkZero(Math.atan2f(t,e)))},random:function(){return Math.random()},max:function(t,e){return Math.fround(Math.max(t,e))},min:function(t,e){return Math.fround(Math.min(t,e))},abs:function(t){return Math.fround(Math.abs(t))},sqrt:function(t){return Math.fround(Math.sqrt(t))},lerp:function(t,e,n){return Math.fround((1-n)*t+n*e)},square:function(t){return Math.fround(t*t)}};var t=function(){function t(t){this._target=t}return $traceurRuntime.createClass(t,{get target(){return this._target},set target(t){this._target=t},apply:function(){console.log("WARNING: MatrixStrategy::apply() not overloaded by the child class.")}},{})}();bg.MatrixStrategy=t}(),function(){var t=function(){function t(){var t=void 0!==arguments[0]?arguments[0]:1,e=void 0!==arguments[1]?arguments[1]:0,n=void 0!==arguments[2]?arguments[2]:0,i=void 0!==arguments[3]?arguments[3]:0,r=void 0!==arguments[4]?arguments[4]:1,a=void 0!==arguments[5]?arguments[5]:0,s=void 0!==arguments[6]?arguments[6]:0,o=void 0!==arguments[7]?arguments[7]:0,u=void 0!==arguments[8]?arguments[8]:1;this._m=new bg.Math.Array(9),"number"==typeof t?(this._m[0]=t,this._m[1]=e,this._m[2]=n,this._m[3]=i,this._m[4]=r,this._m[5]=a,this._m[6]=s,this._m[7]=o,this._m[8]=u):this.assign(t)}return $traceurRuntime.createClass(t,{get m(){return this._m},get m00(){return this._m[0]},get m01(){return this._m[1]},get m02(){return this._m[2]},get m10(){return this._m[3]},get m11(){return this._m[4]},get m12(){return this._m[5]},get m20(){return this._m[6]},get m21(){return this._m[7]},get m22(){return this._m[8]},set m00(t){this._m[0]=t},set m01(t){this._m[1]=t},set m02(t){this._m[2]=t},set m10(t){this._m[3]=t},set m11(t){this._m[4]=t},set m12(t){this._m[5]=t},set m20(t){this._m[6]=t},set m21(t){this._m[7]=t},set m22(t){this._m[8]=t},zero:function(){return this._m[0]=this._m[1]=this._m[2]=this._m[3]=this._m[4]=this._m[5]=this._m[6]=this._m[7]=this._m[8]=0,this},identity:function(){return this._m[0]=1,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=1,this._m[5]=0,this._m[6]=0,this._m[7]=0,this._m[8]=1,this},isZero:function(){return 0==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&0==this._m[4]&&0==this._m[5]&&0==this._m[6]&&0==this._m[7]&&0==this._m[8]},isIdentity:function(){return 1==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&1==this._m[4]&&0==this._m[5]&&0==this._m[6]&&0==this._m[7]&&1==this._m[8]},row:function(t){return new bg.Vector3(this._m[3*t],this._m[3*t+1],this._m[3*t+2])},setRow:function(t,e){return this._m[3*t]=e._v[0],this._m[3*t+1]=e._v[1],this._m[3*t+2]=e._v[2],this},get length(){return this._m.length},traspose:function(){var t=new bg.Vector3(this._m[0],this._m[3],this._m[6]),e=new bg.Vector3(this._m[1],this._m[4],this._m[7]),n=new bg.Vector3(this._m[2],this._m[5],this._m[8]);return this.setRow(0,t),this.setRow(1,e),this.setRow(2,n),this},elemAtIndex:function(t){return this._m[t]},assign:function(t){return 9==t.length?(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=t._m[3],this._m[4]=t._m[4],this._m[5]=t._m[5],this._m[6]=t._m[6],this._m[7]=t._m[7],this._m[8]=t._m[8]):16==t.length&&(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=t._m[4],this._m[4]=t._m[5],this._m[5]=t._m[6],this._m[6]=t._m[8],this._m[7]=t._m[9],this._m[8]=t._m[10]),this},equals:function(t){return this._m[0]==t._m[0]&&this._m[1]==t._m[1]&&this._m[2]==t._m[2]&&this._m[3]==t._m[3]&&this._m[4]==t._m[4]&&this._m[5]==t._m[5]&&this._m[6]==t._m[6]&&this._m[7]==t._m[7]&&this._m[8]==t._m[8]},notEquals:function(t){return this._m[0]!=t._m[0]||this._m[1]!=t._m[1]||this._m[2]!=t._m[2]&&this._m[3]!=t._m[3]||this._m[4]!=t._m[4]||this._m[5]!=t._m[5]&&this._m[6]!=t._m[6]||this._m[7]!=t._m[7]||this._m[8]!=t._m[8]},mult:function(t){if("number"==typeof t)this._m[0]*=t,this._m[1]*=t,this._m[2]*=t,this._m[3]*=t,this._m[4]*=t,this._m[5]*=t,this._m[6]*=t,this._m[7]*=t,this._m[8]*=t;else{var e=this._m,n=t._m,i=new bg.Math.Array(9);i[0]=n[0]*e[0]+n[1]*e[1]+n[2]*e[2],i[1]=n[0]*e[1]+n[1]*e[4]+n[2]*e[7],i[2]=n[0]*e[2]+n[1]*e[5]+n[2]*e[8],i[3]=n[3]*e[0]+n[4]*e[3]+n[5]*e[6],i[4]=n[3]*e[1]+n[4]*e[4]+n[5]*e[7],i[5]=n[3]*e[2]+n[4]*e[5]+n[5]*e[8],i[6]=n[6]*e[0]+n[7]*e[3]+n[8]*e[6],i[7]=n[6]*e[1]+n[7]*e[4]+n[8]*e[7],i[8]=n[6]*e[2]+n[7]*e[5]+n[8]*e[8],this._m=i}return this},isNan:function(){return!(Math.isNaN(_m[0])||Math.isNaN(_m[1])||Math.isNaN(_m[2])||Math.isNaN(_m[3])||Math.isNaN(_m[4])||Math.isNaN(_m[5])||Math.isNaN(_m[6])||Math.isNaN(_m[7])||Math.isNaN(_m[8]))},toString:function(){return"["+this._m[0]+", "+this._m[1]+", "+this._m[2]+"]\n ["+this._m[3]+", "+this._m[4]+", "+this._m[5]+"]\n ["+this._m[6]+", "+this._m[7]+", "+this._m[8]+"]"}},{Identity:function(){return new bg.Matrix3(1,0,0,0,1,0,0,0,1)}})}();bg.Matrix3=t;var e=function(){function t(){var t=void 0!==arguments[0]?arguments[0]:0,e=void 0!==arguments[1]?arguments[1]:0,n=void 0!==arguments[2]?arguments[2]:0,i=void 0!==arguments[3]?arguments[3]:0,r=void 0!==arguments[4]?arguments[4]:0,a=void 0!==arguments[5]?arguments[5]:0,s=void 0!==arguments[6]?arguments[6]:0,o=void 0!==arguments[7]?arguments[7]:0,u=void 0!==arguments[8]?arguments[8]:0,l=void 0!==arguments[9]?arguments[9]:0,c=void 0!==arguments[10]?arguments[10]:0,h=void 0!==arguments[11]?arguments[11]:0,f=void 0!==arguments[12]?arguments[12]:0,d=void 0!==arguments[13]?arguments[13]:0,g=void 0!==arguments[14]?arguments[14]:0,m=void 0!==arguments[15]?arguments[15]:0;this._m=new bg.Math.Array(16),"number"==typeof t?(this._m[0]=t,this._m[1]=e,this._m[2]=n,this._m[3]=i,this._m[4]=r,this._m[5]=a,this._m[6]=s,this._m[7]=o,this._m[8]=u,this._m[9]=l,this._m[10]=c,this._m[11]=h,this._m[12]=f,this._m[13]=d,this._m[14]=g,this._m[15]=m):this.assign(t)}return $traceurRuntime.createClass(t,{get m(){return this._m},get m00(){return this._m[0]},get m01(){return this._m[1]},get m02(){return this._m[2]},get m03(){return this._m[3]},get m10(){return this._m[4]},get m11(){return this._m[5]},get m12(){return this._m[6]},get m13(){return this._m[7]},get m20(){return this._m[8]},get m21(){return this._m[9]},get m22(){return this._m[10]},get m23(){return this._m[11]},get m30(){return this._m[12]},get m31(){return this._m[13]},get m32(){return this._m[14]},get m33(){return this._m[15]},set m00(t){this._m[0]=t},set m01(t){this._m[1]=t},set m02(t){this._m[2]=t},set m03(t){this._m[3]=t},set m10(t){this._m[4]=t},set m11(t){this._m[5]=t},set m12(t){this._m[6]=t},set m13(t){this._m[7]=t},set m20(t){this._m[8]=t},set m21(t){
this._m[9]=t},set m22(t){this._m[10]=t},set m23(t){this._m[11]=t},set m30(t){this._m[12]=t},set m31(t){this._m[13]=t},set m32(t){this._m[14]=t},set m33(t){this._m[15]=t},zero:function(){return this._m[0]=0,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=0,this._m[5]=0,this._m[6]=0,this._m[7]=0,this._m[8]=0,this._m[9]=0,this._m[10]=0,this._m[11]=0,this._m[12]=0,this._m[13]=0,this._m[14]=0,this._m[15]=0,this},identity:function(){return this._m[0]=1,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=0,this._m[5]=1,this._m[6]=0,this._m[7]=0,this._m[8]=0,this._m[9]=0,this._m[10]=1,this._m[11]=0,this._m[12]=0,this._m[13]=0,this._m[14]=0,this._m[15]=1,this},isZero:function(){return 0==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&0==this._m[4]&&0==this._m[5]&&0==this._m[6]&&0==this._m[7]&&0==this._m[8]&&0==this._m[9]&&0==this._m[10]&&0==this._m[11]&&0==this._m[12]&&0==this._m[13]&&0==this._m[14]&&0==this._m[15]},isIdentity:function(){return 1==this._m[0]&&0==this._m[1]&&0==this._m[2]&&0==this._m[3]&&0==this._m[4]&&1==this._m[5]&&0==this._m[6]&&0==this._m[7]&&0==this._m[8]&&0==this._m[9]&&1==this._m[10]&&0==this._m[11]&&0==this._m[12]&&0==this._m[13]&&0==this._m[14]&&1==this._m[15]},row:function(t){return new bg.Vector4(this._m[4*t],this._m[4*t+1],this._m[4*t+2],this._m[4*t+3])},setRow:function(t,e){return this._m[4*t]=e._v[0],this._m[4*t+1]=e._v[1],this._m[4*t+2]=e._v[2],this._m[4*t+3]=e._v[3],this},get length(){return this._m.length},getMatrix3:function(){return new bg.Matrix3(this._m[0],this._m[1],this._m[2],this._m[4],this._m[5],this._m[6],this._m[8],this._m[9],this._m[10])},perspective:function(t,e,n,i){return this.assign(bg.Matrix4.Perspective(t,e,n,i)),this},frustum:function(t,e,n,i,r,a){return this.assign(bg.Matrix4.Frustum(t,e,n,i,r,a)),this},ortho:function(t,e,n,i,r,a){return this.assign(bg.Matrix4.Ortho(t,e,n,i,r,a)),this},lookAt:function(t,e,n){return this.assign(bg.Matrix4.LookAt(t,e,n)),this},translate:function(t,e,n){return this.mult(bg.Matrix4.Translation(t,e,n)),this},rotate:function(t,e,n,i){return this.mult(bg.Matrix4.Rotation(t,e,n,i)),this},scale:function(t,e,n){return this.mult(bg.Matrix4.Scale(t,e,n)),this},elemAtIndex:function(t){return this._m[t]},assign:function(t){return 9==t.length?(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=0,this._m[4]=t._m[3],this._m[5]=t._m[4],this._m[6]=t._m[5],this._m[7]=0,this._m[8]=t._m[6],this._m[9]=t._m[7],this._m[10]=t._m[8],this._m[11]=0,this._m[12]=0,this._m[13]=0,this._m[14]=0,this._m[15]=1):16==t.length&&(this._m[0]=t._m[0],this._m[1]=t._m[1],this._m[2]=t._m[2],this._m[3]=t._m[3],this._m[4]=t._m[4],this._m[5]=t._m[5],this._m[6]=t._m[6],this._m[7]=t._m[7],this._m[8]=t._m[8],this._m[9]=t._m[9],this._m[10]=t._m[10],this._m[11]=t._m[11],this._m[12]=t._m[12],this._m[13]=t._m[13],this._m[14]=t._m[14],this._m[15]=t._m[15]),this},equals:function(t){return this._m[0]==t._m[0]&&this._m[1]==t._m[1]&&this._m[2]==t._m[2]&&this._m[3]==t._m[3]&&this._m[4]==t._m[4]&&this._m[5]==t._m[5]&&this._m[6]==t._m[6]&&this._m[7]==t._m[7]&&this._m[8]==t._m[8]&&this._m[9]==t._m[9]&&this._m[10]==t._m[10]&&this._m[11]==t._m[11]&&this._m[12]==t._m[12]&&this._m[13]==t._m[13]&&this._m[14]==t._m[14]&&this._m[15]==t._m[15]},notEquals:function(t){return this._m[0]!=t._m[0]||this._m[1]!=t._m[1]||this._m[2]!=t._m[2]||this._m[3]!=t._m[3]||this._m[4]!=t._m[4]||this._m[5]!=t._m[5]||this._m[6]!=t._m[6]||this._m[7]!=t._m[7]||this._m[8]!=t._m[8]||this._m[9]!=t._m[9]||this._m[10]!=t._m[10]||this._m[11]!=t._m[11]||this._m[12]!=t._m[12]||this._m[13]!=t._m[13]||this._m[14]!=t._m[14]||this._m[15]!=t._m[15]},mult:function(t){if("number"==typeof t)return this._m[0]*=t,this._m[1]*=t,this._m[2]*=t,this._m[3]*=t,this._m[4]*=t,this._m[5]*=t,this._m[6]*=t,this._m[7]*=t,this._m[8]*=t,this._m[9]*=t,this._m[10]*=t,this._m[11]*=t,this._m[12]*=t,this._m[13]*=t,this._m[14]*=t,this._m[15]*=t,this;var e=this._m,n=t._m,i=new bg.Math.Array(16);return i[0]=n[0]*e[0]+n[1]*e[4]+n[2]*e[8]+n[3]*e[12],i[1]=n[0]*e[1]+n[1]*e[5]+n[2]*e[9]+n[3]*e[13],i[2]=n[0]*e[2]+n[1]*e[6]+n[2]*e[10]+n[3]*e[14],i[3]=n[0]*e[3]+n[1]*e[7]+n[2]*e[11]+n[3]*e[15],i[4]=n[4]*e[0]+n[5]*e[4]+n[6]*e[8]+n[7]*e[12],i[5]=n[4]*e[1]+n[5]*e[5]+n[6]*e[9]+n[7]*e[13],i[6]=n[4]*e[2]+n[5]*e[6]+n[6]*e[10]+n[7]*e[14],i[7]=n[4]*e[3]+n[5]*e[7]+n[6]*e[11]+n[7]*e[15],i[8]=n[8]*e[0]+n[9]*e[4]+n[10]*e[8]+n[11]*e[12],i[9]=n[8]*e[1]+n[9]*e[5]+n[10]*e[9]+n[11]*e[13],i[10]=n[8]*e[2]+n[9]*e[6]+n[10]*e[10]+n[11]*e[14],i[11]=n[8]*e[3]+n[9]*e[7]+n[10]*e[11]+n[11]*e[15],i[12]=n[12]*e[0]+n[13]*e[4]+n[14]*e[8]+n[15]*e[12],i[13]=n[12]*e[1]+n[13]*e[5]+n[14]*e[9]+n[15]*e[13],i[14]=n[12]*e[2]+n[13]*e[6]+n[14]*e[10]+n[15]*e[14],i[15]=n[12]*e[3]+n[13]*e[7]+n[14]*e[11]+n[15]*e[15],this._m=i,this},multVector:function(t){"object"==$traceurRuntime.typeof(t)&&t._v&&t._v.length>=3&&(t=t._v);var e=t[0],n=t[1],i=t[2];return new bg.Vector4(this._m[0]*e+this._m[4]*n+this._m[8]*i+1*this._m[12],this._m[1]*e+this._m[5]*n+this._m[9]*i+1*this._m[13],this._m[2]*e+this._m[6]*n+this._m[10]*i+1*this._m[14],this._m[3]*e+this._m[7]*n+this._m[11]*i+1*this._m[15])},invert:function(){var t=this._m[0],e=this._m[1],n=this._m[2],i=this._m[3],r=this._m[4],a=this._m[5],s=this._m[6],o=this._m[7],u=this._m[8],l=this._m[9],c=this._m[10],h=this._m[11],f=this._m[12],d=this._m[13],g=this._m[14],m=this._m[15],p=t*a-e*r,b=t*s-n*r,_=t*o-i*r,v=e*s-n*a,y=e*o-i*a,E=n*o-i*s,T=u*d-l*f,x=u*g-c*f,S=u*m-h*f,w=l*g-c*d,M=l*m-h*d,C=c*m-h*g,R=p*C-b*M+_*w+v*S-y*x+E*T;return R?(R=1/R,this._m[0]=(a*C-s*M+o*w)*R,this._m[1]=(n*M-e*C-i*w)*R,this._m[2]=(d*E-g*y+m*v)*R,this._m[3]=(c*y-l*E-h*v)*R,this._m[4]=(s*S-r*C-o*x)*R,this._m[5]=(t*C-n*S+i*x)*R,this._m[6]=(g*_-f*E-m*b)*R,this._m[7]=(u*E-c*_+h*b)*R,this._m[8]=(r*M-a*S+o*T)*R,this._m[9]=(e*S-t*M-i*T)*R,this._m[10]=(f*y-d*_+m*p)*R,this._m[11]=(l*_-u*y-h*p)*R,this._m[12]=(a*x-r*w-s*T)*R,this._m[13]=(t*w-e*x+n*T)*R,this._m[14]=(d*b-f*v-g*p)*R,this._m[15]=(u*v-l*b+c*p)*R,this):(this.zero(),this)},traspose:function(){var t=new bg.Vector4(this._m[0],this._m[4],this._m[8],this._m[12]),e=new bg.Vector4(this._m[1],this._m[5],this._m[9],this._m[13]),n=new bg.Vector4(this._m[2],this._m[6],this._m[10],this._m[14]),i=new bg.Vector4(this._m[3],this._m[7],this._m[11],this._m[15]);return this.setRow(0,t),this.setRow(1,e),this.setRow(2,n),this.setRow(3,i),this},get rotation(){return new bg.Matrix4(this._m[0],this._m[1],this._m[2],0,this._m[4],this._m[5],this._m[6],0,this._m[8],this._m[9],this._m[10],0,0,0,0,1)},get position(){return new bg.Vector3(this._m[12],this._m[13],this._m[14])},transformDirection:function(t){var e=new bg.Vector3(t),n=new bg.Matrix4(this);return n.setRow(3,new bg.Vector4(0,0,0,1)),e.assign(n.multVector(e).xyz),e.normalize(),e},get forwardVector(){return this.transformDirection(new bg.Vector3(0,0,1))},get rightVector(){return this.transformDirection(new bg.Vector3(1,0,0))},get upVector(){return this.transformDirection(new bg.Vector3(0,1,0))},get backwardVector(){return this.transformDirection(new bg.Vector3(0,0,-1))},get leftVector(){return this.transformDirection(new bg.Vector3(-1,0,0))},get downVector(){return this.transformDirection(new bg.Vector3(0,-1,0))},isNan:function(){return Number.isNaN(this._m[0])||Number.isNaN(this._m[1])||Number.isNaN(this._m[2])||Number.isNaN(this._m[3])||Number.isNaN(this._m[4])||Number.isNaN(this._m[5])||Number.isNaN(this._m[6])||Number.isNaN(this._m[7])||Number.isNaN(this._m[8])||Number.isNaN(this._m[9])||Number.isNaN(this._m[10])||Number.isNaN(this._m[11])||Number.isNaN(this._m[12])||Number.isNaN(this._m[13])||Number.isNaN(this._m[14])||Number.isNaN(this._m[15])},getOrthoValues:function(){return[(1+get23())/get22(),-(1-get23())/get22(),(1-get13())/get11(),-(1+get13())/get11(),-(1+get03())/get00(),(1-get03())/get00()]},getPerspectiveValues:function(){return[get23()/(get22()-1),get23()/(get22()+1),near*(get12()-1)/get11(),near*(get12()+1)/get11(),near*(get02()-1)/get00(),near*(get02()+1)/get00()]},toString:function(){return"["+this._m[0]+", "+this._m[1]+", "+this._m[2]+", "+this._m[3]+"]\n ["+this._m[4]+", "+this._m[5]+", "+this._m[6]+", "+this._m[7]+"]\n ["+this._m[8]+", "+this._m[9]+", "+this._m[10]+", "+this._m[11]+"]\n ["+this._m[12]+", "+this._m[13]+", "+this._m[14]+", "+this._m[15]+"]"}},{Unproject:function(t,e,n,i,r,a){var s=new bg.Matrix4(r);s.mult(i),s.invert();var o=new bg.Vector4((t-a.y)/a.width*2-1,(e-a.x)/a.height*2-1,2*n-1,1),u=new bg.Vector4(s.multVector(o));return 0==u.z?u.set(0):u.set(u.x/u.w,u.y/u.w,u.z/u.w,u.w/u.w),u},Identity:function(){return new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},Perspective:function(t,e,n,i){var r=bg.Math.tan(t*bg.Math.PI/360)*n,a=r*e;return bg.Matrix4.Frustum(-a,a,-r,r,n,i)},Frustum:function(t,e,n,i,r,a){var s=new bg.Matrix4,o=e-t,u=i-n,l=a-r;return s.setRow(0,new bg.Vector4(2*r/o,0,0,0)),s.setRow(1,new bg.Vector4(0,2*r/u,0,0)),s.setRow(2,new bg.Vector4((e+t)/o,(i+n)/u,-(a+r)/l,-1)),s.setRow(3,new bg.Vector4(0,0,-a*r*2/l,0)),s},Ortho:function(t,e,n,i,r,a){var s=new bg.Matrix4,o=e-t,u=i-n,l=a-r;return s._m[0]=2/o,s._m[1]=0,s._m[2]=0,s._m[3]=0,s._m[4]=0,s._m[5]=2/u,s._m[6]=0,s._m[7]=0,s._m[8]=0,s._m[9]=0,s._m[10]=-2/l,s._m[11]=0,s._m[12]=-(t+e)/o,s._m[13]=-(i+n)/u,s._m[14]=-(a+r)/l,s._m[15]=1,s},LookAt:function(t,e,n){var i=new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),r=new bg.Vector3(e);r.sub(t);var a=new bg.Vector3(n);r.normalize();var s=new bg.Vector3(r);return s.cross(a),a.assign(s),a.cross(r),i.set00(s.x),i.set10(s.y),i.set20(s.z),i.set01(a.x),i.set11(a.y),i.set21(a.z),i.set02(-r.x),i.set12(-r.y),i.set22(-r.z),i.setRow(3,new vwgl.Vector4(-t.x,-t.y,-t.z,1)),i},Translation:function(t,e,n){return"object"==$traceurRuntime.typeof(t)&&t._v&&t._v.length>=3&&(e=t._v[1],n=t._v[2],t=t._v[0]),new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,t,e,n,1)},Rotation:function(t,e,n,i){var r=new bg.Vector3(e,n,i);r.normalize();var a=(new bg.Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),bg.Math.cos(t)),s=1-a,o=bg.Math.sin(t);return new bg.Matrix4(r.x*r.x*s+a,r.x*r.y*s+r.z*o,r.x*r.z*s-r.y*o,0,r.y*r.x*s-r.z*o,r.y*r.y*s+a,r.y*r.z*s+r.x*o,0,r.z*r.x*s+r.y*o,r.z*r.y*s-r.x*o,r.z*r.z*s+a,0,0,0,0,1)},Scale:function(t,e,n){return"object"==$traceurRuntime.typeof(t)&&t._v&&t._v.length>=3&&(t=t._v[0],e=t._v[1],n=t._v[2]),new bg.Matrix4(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1)}})}();bg.Matrix4=e}(),function(){var t=function(){function t(t){this._v=t}return $traceurRuntime.createClass(t,{get v(){return this._v},get length(){return this._v.length},get x(){return this._v[0]},set x(t){this._v[0]=t},get y(){return this._v[1]},set y(t){this._v[1]=t},magnitude:function(){for(var t=0,e=0;e<this._v.length;++e){var n=this._v[e];t+=bg.Math.square(n)}return bg.Math.sqrt(t)}},{MinComponents:function(t,e){var n=Math.min(t.length,e.length),i=null;switch(n){case 2:i=new bg.Vector2;break;case 3:i=new bg.Vector3;break;case 4:i=new bg.Vector4}for(var r=0;r<n;++r)i._v[r]=t._v[r]<e._v[r]?t._v[r]:e._v[r];return i},MaxComponents:function(t,e){var n=Math.min(t.length,e.length),i=null;switch(n){case 2:i=new bg.Vector2;break;case 3:i=new bg.Vector3;break;case 4:i=new bg.Vector4}for(var r=0;r<n;++r)i._v[r]=t._v[r]>e._v[r]?t._v[r]:e._v[r];return i}})}();bg.VectorBase=t,bg.Vector=t;var e=function(t){function e(){var t=void 0!==arguments[0]?arguments[0]:0,n=arguments[1];$traceurRuntime.superConstructor(e).call(this,new bg.Math.Array(2)),t instanceof e?(this._v[0]=t._v[0],this._v[1]=t._v[1]):(void 0===n&&(n=t),this._v[0]=t,this._v[1]=n)}return $traceurRuntime.createClass(e,{distance:function(t){return new bg.Vector2(this._v[0]-t._v[0],this._v[1]-t._v[1]).magnitude()},normalize:function(){var t=this.magnitude();return this._v[0]=this._v[0]/t,this._v[1]=this._v[1]/t,this},add:function(t){return this._v[0]+=t._v[0],this._v[1]+=t._v[1],this},sub:function(t){return this._v[0]-=t._v[0],this._v[1]-=t._v[1],this},dot:function(t){return this._v[0]*t._v[0]+this._v[1]*t._v[1]},scale:function(t){return this._v[0]*=t,this._v[1]*=t,this},elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1]},set:function(t,e){void 0===e&&(e=t),this._v[0]=t,this._v[1]=e},get width(){return this._v[0]},get height(){return this._v[1]},set width(t){this._v[0]=t},set height(t){this._v[1]=t},get aspectRatio(){return this._v[0]/this._v[1]},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])},toString:function(){return"["+this._v+"]"}},{Add:function(t,n){return new e(t.x+n.x,t.y+n.y)},Sub:function(t,n){return new e(t.x-n.x,t.y-n.y)}},t)}(t);bg.Vector2=e;var n=function(t){function n(){var t=void 0!==arguments[0]?arguments[0]:0,i=void 0!==arguments[1]?arguments[1]:0,r=void 0!==arguments[2]?arguments[2]:0;$traceurRuntime.superConstructor(n).call(this,new bg.Math.Array(3)),t instanceof e?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=i):t instanceof n?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2]):(void 0===i&&(i=t),void 0===r&&(r=i),this._v[0]=t,this._v[1]=i,this._v[2]=r)}return $traceurRuntime.createClass(n,{get z(){return this._v[2]},set z(t){this._v[2]=t},normalize:function(){var t=this.magnitude();return this._v[0]=this._v[0]/t,this._v[1]=this._v[1]/t,this._v[2]=this._v[2]/t,this},distance:function(t){return new bg.Vector3(this._v[0]-t._v[0],this._v[1]-t._v[1],this._v[2]-t._v[2]).magnitude()},add:function(t){return this._v[0]+=t._v[0],this._v[1]+=t._v[1],this._v[2]+=t._v[2],this},sub:function(t){return this._v[0]-=t._v[0],this._v[1]-=t._v[1],this._v[2]-=t._v[2],this},dot:function(t){return this._v[0]*t._v[0]+this._v[1]*t._v[1]+this._v[2]*t._v[2]},scale:function(t){return this._v[0]*=t,this._v[1]*=t,this._v[2]*=t,this},cross:function(t){var e=this._v[1]*t._v[2]-this._v[2]*t._v[1],n=this._v[2]*t._v[0]-this._v[0]*t._v[2],i=this._v[0]*t._v[1]-this._v[1]*t._v[0];return this._v[0]=e,this._v[1]=n,this._v[2]=i,this},elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]&&this._v[2]==t._v[2]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]||this._v[2]!=t._v[2]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],t._v.length>=3&&(this._v[2]=t._v[2])},set:function(t,e,n){this._v[0]=t,this._v[1]=void 0===e?t:e,this._v[2]=void 0===e?t:void 0===n?e:n},get width(){return this._v[0]},get height(){return this._v[1]},get depth(){return this._v[2]},set width(t){this._v[0]=t},set height(t){this._v[1]=t},set depth(t){this._v[2]=t},get xy(){return new bg.Vector2(this._v[0],this._v[1])},get yz(){return new bg.Vector2(this._v[1],this._v[2])},get xz(){return new bg.Vector2(this._v[0],this._v[2])},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])||isNaN(this._v[2])},toString:function(){return"["+this._v+"]"}},{Add:function(t,e){return new n(t.x+e.x,t.y+e.y,t.z+e.z)},Sub:function(t,e){return new n(t.x-e.x,t.y-e.y,t.z-e.z)}},t)}(t);bg.Vector3=n;var i=function(t){function i(){var t=void 0!==arguments[0]?arguments[0]:0,r=void 0!==arguments[1]?arguments[1]:0,a=void 0!==arguments[2]?arguments[2]:0,s=void 0!==arguments[3]?arguments[3]:0;$traceurRuntime.superConstructor(i).call(this,new bg.Math.Array(4)),t instanceof e?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=r,this._v[3]=a):t instanceof n?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=r):t instanceof i?(this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=t._v[3]):(void 0===r&&(r=t),void 0===a&&(a=r),void 0===s&&(s=a),this._v[0]=t,this._v[1]=r,this._v[2]=a,this._v[3]=s)}return $traceurRuntime.createClass(i,{get z(){return this._v[2]},set z(t){this._v[2]=t},get w(){return this._v[3]},set w(t){this._v[3]=t},normalize:function(){var t=this.magnitude();return this._v[0]=this._v[0]/t,this._v[1]=this._v[1]/t,this._v[2]=this._v[2]/t,this._v[3]=this._v[3]/t,this},distance:function(t){return new bg.Vector4(this._v[0]-t._v[0],this._v[1]-t._v[1],this._v[2]-t._v[2],this._v[3]-t._v[3]).magnitude()},add:function(t){return this._v[0]+=t._v[0],this._v[1]+=t._v[1],this._v[2]+=t._v[2],this._v[3]+=t._v[3],this},sub:function(t){return this._v[0]-=t._v[0],this._v[1]-=t._v[1],this._v[2]-=t._v[2],this._v[3]-=t._v[3],this},dot:function(t){return this._v[0]*t._v[0]+this._v[1]*t._v[1]+this._v[2]*t._v[2]+this._v[3]*t._v[3]},scale:function(t){return this._v[0]*=t,this._v[1]*=t,this._v[2]*=t,this._v[3]*=t,this},elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]&&this._v[2]==t._v[2]&&this._v[3]==t._v[3]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]||this._v[2]!=t._v[2]||this._v[3]!=t._v[3]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],t._v.length>=3&&(this._v[2]=t._v[2]),4==t._v.length&&(this._v[3]=t._v[3])},set:function(t,e,n,i){this._v[0]=t,this._v[1]=void 0===e?t:e,this._v[2]=void 0===e?t:void 0===n?e:n,this._v[3]=void 0===e?t:void 0===n?e:void 0===i?n:i},get r(){return this._v[0]},get g(){return this._v[1]},get b(){return this._v[2]},get a(){return this._v[3]},set r(t){this._v[0]=t},set g(t){this._v[1]=t},set b(t){this._v[2]=t},set a(t){this._v[3]=t},get xy(){return new bg.Vector2(this._v[0],this._v[1])},get yz(){return new bg.Vector2(this._v[1],this._v[2])},get xz(){return new bg.Vector2(this._v[0],this._v[2])},get xyz(){return new bg.Vector3(this._v[0],this._v[1],this._v[2])},get width(){return this._v[2]},get height(){return this._v[3]},set width(t){this._v[2]=t},set height(t){this._v[3]=t},get aspectRatio(){return 0!=this._v[3]?this._v[2]/this._v[3]:1},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])||isNaN(this._v[2])||isNaN(this._v[3])},toString:function(){return"["+this._v+"]"}},{Add:function(t,e){return new i(t.x+e.x,t.y+e.y,t.z+e.z,t.w+e.w)},Sub:function(t,e){return new i(t.x-e.x,t.y-e.y,t.z-e.z,t.w-e.w)},Yellow:function(){return new bg.Vector4(1,1,0,1)},Orange:function(){return new bg.Vector4(1,.5,0,1)},Red:function(){return new bg.Vector4(1,0,0,1)},Violet:function(){return new bg.Vector4(.5,0,1,1)},Blue:function(){return new bg.Vector4(0,0,1,1)},Green:function(){return new bg.Vector4(0,1,0,1)},White:function(){return new bg.Vector4(1,1,1,1)},LightGray:function(){return new bg.Vector4(.8,.8,.8,1)},Gray:function(){return new bg.Vector4(.5,.5,.5,1)},DarkGray:function(){return new bg.Vector4(.2,.2,.2,1)},Black:function(){return new bg.Vector4(0,0,0,1)},Brown:function(){return new bg.Vector4(.4,.2,0,1)},Transparent:function(){return new bg.Vector4(0,0,0,0)}},t)}(t);bg.Vector4=i,bg.Size2D=e,bg.Size3D=n,bg.Position2D=e,bg.Viewport=i,bg.Color=i;var r=function(t){function e(){var t=void 0!==arguments[0]?arguments[0]:0,n=void 0!==arguments[1]?arguments[1]:0,i=void 0!==arguments[2]?arguments[2]:0,r=void 0!==arguments[3]?arguments[3]:0,a=void 0!==arguments[4]?arguments[4]:0,s=void 0!==arguments[5]?arguments[5]:0;$traceurRuntime.superConstructor(e).call(this,new bg.Math.Array(6)),this._v[0]=t,this._v[1]=n,this._v[2]=i,this._v[3]=r,this._v[4]=a,this._v[5]=s}return $traceurRuntime.createClass(e,{elemAtIndex:function(t){return this._v[t]},equals:function(t){return this._v[0]==t._v[0]&&this._v[1]==t._v[1]&&this._v[2]==t._v[2]&&this._v[3]==t._v[3]&&this._v[4]==t._v[4]&&this._v[5]==t._v[5]},notEquals:function(t){return this._v[0]!=t._v[0]||this._v[1]!=t._v[1]||this._v[2]!=t._v[2]||this._v[3]!=t._v[3]||this._v[4]!=t._v[4]||this._v[5]!=t._v[5]},assign:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=t._v[3],this._v[4]=t._v[4],this._v[5]=t._v[5]},set:function(t,e,n,i,r,a){this._v[0]=t,this._v[1]=void 0===e?t:e,this._v[2]=void 0===e?t:n,this._v[3]=void 0===e?t:i,this._v[4]=void 0===e?t:r,this._v[5]=void 0===e?t:a},get left(){return this._v[0]},get right(){return this._v[1]},get bottom(){return this._v[2]},get top(){return this._v[3]},get back(){return this._v[4]},get front(){return this._v[5]},set left(t){this._v[0]=t},set right(t){this._v[1]=t},set bottom(t){this._v[2]=t},set top(t){this._v[3]=t},set back(t){this._v[4]=t},set front(t){this._v[5]=t},get width(){return Math.abs(this._v[1]-this._v[0])},get height(){return Math.abs(this._v[3]-this._v[2])},get depth(){return Math.abs(this._v[5]-this._v[4])},isNan:function(){return isNaN(this._v[0])||isNaN(this._v[1])||isNaN(this._v[2])||isNaN(this._v[3])||isNaN(this._v[4])||isNaN(this._v[5])},toString:function(){return"["+this._v+"]"},isInBounds:function(t){return t.x>=this._v[0]&&t.x<=this._v[1]&&t.y>=this._v[2]&&t.y<=this._v[3]&&t.z>=this._v[4]&&t.z<=this._v[5]}},{},t)}(t);bg.Bounds=r;var a=function(t){function e(t,n,i,r){$traceurRuntime.superConstructor(e).call(this),void 0===t?this.zero():void 0===n?t._v&&t._v.lenght>=4?this.clone(t):t._m&&9==t._m.length?this.initWithMatrix3(t):t._m&&16==t._m.length?this.initWithMatrix4(t):this.zero():void 0!==t&&void 0!==n&&void 0!==i&&void 0!==r?this.initWithValues(t,n,i,r):this.zero()}return $traceurRuntime.createClass(e,{initWithValues:function(t,e,n,i){return this._v[0]=e*bg.Math.sin(t/2),this._v[1]=n*bg.Math.sin(t/2),this._v[2]=i*bg.Math.sin(t/2),this._v[3]=bg.Math.cos(t/2),this},clone:function(t){this._v[0]=t._v[0],this._v[1]=t._v[1],this._v[2]=t._v[2],this._v[3]=t._v[3]},initWithMatrix3:function(t){var e=bg.Math.sqrt(1+t._m[0]+t._m[4]+t._m[8])/2,n=4*e;this._v[0]=(t._m[7]-t._m[5])/e,this._v[1]=(t._m[2]-t._m[6])/n,this._v[2]=(t._m[3]-t._m[1])/n,this._v[3]=e},initWithMatrix4:function(t){var e=bg.Math.sqrt(1+t._m[0]+t._m[5]+t._m[10])/2,n=4*e;this._v[0]=(t._m[9]-t._m[6])/e,this._v[1]=(t._m[2]-t._m[8])/n,this._v[2]=(t._m[4]-t._m[1])/n,this._v[3]=e},getMatrix4:function(){var t=bg.Matrix4.Identity(),e=this._v;return t.setRow(0,new bg.Vector4(1-2*e[1]*e[1]-2*e[2]*e[2],2*e[0]*e[1]-2*e[2]*e[3],2*e[0]*e[2]+2*e[1]*e[3],0)),t.setRow(1,new bg.Vector4(2*e[0]*e[1]+2*e[2]*e[3],1-2*e[0]*e[0]-2*e[2]*e[2],2*e[1]*e[2]-2*e[0]*e[3],0)),t.setRow(2,new bg.Vector4(2*e[0]*e[2]-2*e[1]*e[3],2*e[1]*e[2]+2*e[0]*e[3],1-2*e[0]*e[0]-2*e[1]*e[1],0)),t},getMatrix3:function(){var t=bg.Matrix3.Identity(),e=this._v;return t.setRow(0,new bg.Vector3(1-2*e[1]*e[1]-2*e[2]*e[2],2*e[0]*e[1]-2*e[2]*e[3],2*e[0]*e[2]+2*e[1]*e[3])),t.setRow(1,new bg.Vector3(2*e[0]*e[1]+2*e[2]*e[3],1-2*e[0]*e[0]-2*e[2]*e[2],2*e[1]*e[2]-2*e[0]*e[3])),t.setRow(2,new bg.Vector3(2*e[0]*e[2]-2*e[1]*e[3],2*e[1]*e[2]+2*e[0]*e[3],1-2*e[0]*e[0]-2*e[1]*e[1])),t}},{MakeWithMatrix:function(t){return new e(t)}},t)}(i);bg.Quaternion=a}(),bg.physics={},function(){bg.physics.IntersectionType={NONE:0,POINT:1,LLINE:2};var t=function(){function t(){this._type=null,this._p0=null,this._p1=null}return $traceurRuntime.createClass(t,{get type(){return this._type},get point(){return this._p0},get endPoint(){return this._p1},intersects:function(){return!1}},{RayToPlane:function(t,e){return new bg.physics.RayToPlaneIntersection(t,e)}})}();bg.physics.Intersection=t;var e=function(t){function e(t,n){$traceurRuntime.superConstructor(e).call(this),this._ray=null,this._p0=null,this._type=bg.physics.IntersectionType.POINT;var i=new bg.Vector3(n.origin),r=new bg.Vector3(n.normal),a=new bg.Vector3(t.start),s=new bg.Vector3(t.vector),o=i.sub(a).dot(r),u=s.dot(r);if(0!=u){var l=o/u;l>t.magnitude||(this._ray=bg.physics.Ray.RayWithVector(t.vector,t.start,l),this._p0=this._ray.end)}}return $traceurRuntime.createClass(e,{get ray(){return this._ray},intersects:function(){return null!=this._ray&&null!=this._p0}},{},t)}(bg.physics.Intersection);bg.physics.RayToPlaneIntersection=e}(),function(){var t=function(){function t(){this._transform=bg.Matrix4.Identity()}return $traceurRuntime.createClass(t,{get transform(){return this._transform},set transform(t){this._transform=t},applyTransform:function(t){},calculateTransform:function(){}},{})}();bg.physics.Joint=t,bg.physics.LinkTransformOrder={TRANSLATE_ROTATE:1,ROTATE_TRANSLATE:0};var e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._offset=new bg.Vector3,this._eulerRotation=new bg.Vector3,this._transformOrder=bg.physics.LinkTransformOrder.TRANSLATE_ROTATE}return $traceurRuntime.createClass(e,{applyTransform:function(t){t.mult(this.transform)},assign:function(t){this.yaw=t.yaw,this.pitch=t.pitch,this.roll=t.roll,this.offset.assign(t.offset),this.transformOrder=t.transformOrder},get offset(){return this._offset},set offset(t){this._offset=t,this.calculateTransform()},get eulerRotation(){return this._eulerRotation},set eulerRotation(t){this._eulerRotation=t,this.calculateTransform()},get yaw(){return this._eulerRotation.x},get pitch(){return this._eulerRotation.y},get roll(){return this._eulerRotation.z},set yaw(t){this._eulerRotation.x=t,this.calculateTransform()},set pitch(t){this._eulerRotation.y=t,this.calculateTransform()},set roll(t){this._eulerRotation.z=t,this.calculateTransform()},get transformOrder(){return this._transformOrder},set transformOrder(t){this._transformOrder=t,this.calculateTransform()},multTransform:function(t){switch(this.transformOrder){case bg.physics.LinkTransformOrder.TRANSLATE_ROTATE:t.translate(this.offset.x,this.offset.y,this.offset.z),this.multRotation(t);break;case bg.physics.LinkTransformOrder.TRANSLATE_ROTATE:this.multRotation(t),t.translate(this.offset.x,this.offset.y,this.offset.z)}},multRotation:function(t){t.rotate(this.eulerRotation.z,0,0,1).rotate(this.eulerRotation.y,0,1,0).rotate(this.eulerRotation.x,1,0,0)},calculateTransform:function(){this.transform.identity(),this.multTransform(this.transform)},deserialize:function(t){}},{},t)}(t);bg.physics.LinkJoint=e}(),function(){var t=function(){function t(t,e,n){if(t=t instanceof bg.Vector3&&t,e=e instanceof bg.Vector3&&e,n=n instanceof bg.Vector3&&n,t&&!e)this._normal=new bg.Vector3(t),this._origin=new bg.Vector3(0);else if(t&&e&&!n)this._normal=new bg.Vector3(t),this._origin=new bg.Vector3(e);else if(t&&e&&n){var i=new bg.Vector3(t);i.sub(e);var r=new bg.Vector3(n);r.sub(t),this._origin=new bg.Vector3(p1),this._normal=new bg.Vector3(i),this._normal.cross(r).normalize()}else this._origin=new bg.Vector3(0),this._normal=new bg.Vector3(0,1,0)}return $traceurRuntime.createClass(t,{get normal(){return this._normal},set normal(t){this._normal.assign(t)},get origin(){return this._origin},set origin(t){this._origin.assign(t)},toString:function(){return"P0: "+this._origin.toString()+", normal:"+this._normal.toString()},valid:function(){return!this._origin.isNan()&&!this._normal.isNan()},assign:function(t){return this._origin.assign(t._origin),this._normal.assign(t._normal),this},equals:function(t){return this._origin.equals(t._origin)&&this._normal.equals(t._normal)}},{})}();bg.physics.Plane=t}(),function(){function t(t){t._vector=new bg.Vector3(t._end),t._vector.sub(t._start),t._magnitude=t._vector.magnitude(),t._vector.normalize()}var e=function(){function e(e,n){this._start=e||new bg.Vector3,this._end=n||new bg.Vector3(1),t(this)}return $traceurRuntime.createClass(e,{setWithPoints:function(e,n){return this._start.assign(e),this._end.assign(n),t(),this},setWithVector:function(e,n,i){this._start.assign(n),this._end.assign(n);var r=new bg.Vector3(e);return r.normalize().scale(i),this._end.add(r),t(this),this},setWithScreenPoint:function(e,n,i,r){var a=bg.Matrix4.Unproject(e.x,e.y,0,i,n,r),s=bg.Matrix4.Unproject(e.x,e.y,1,i,n,r);return this._start=a.xyz,this._end=s.xyz,t(this),this},assign:function(t){this._start.assign(t.start),this._end.assign(t.end),this._vector.assign(t.vector),this._magnitude.assign(t.magnitude)},get start(){return this._start},set start(e){this._start.assign(e),t(this)},get end(){return this._end},set end(t){this._end.assign(t)},get vector(){return this._vector},get magnitude(){return this._magnitude},toString:function(){return"start: "+this.start.toString()+", end: "+this.end.toString()}},{RayWithPoints:function(t,n){return new e(t,n)},RayWithVector:function(t,n,i){var r=new e;return r.setWithVector(t,n,i),r},RayWithScreenPoint:function(t,n,i,r){var a=new e;return a.setWithScreenPoint(t,n,i,r),a}})}();bg.physics.Ray=e}(),bg.scene={},function(){var t={},e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._node=null}return $traceurRuntime.createClass(e,{clone:function(){return bg.log("WARNING: Component with typeid "+this.typeId+" does not implmement the clone() method."),null},get node(){return this._node},get typeId(){return this._typeId},removedFromNode:function(t){},addedToNode:function(t){},deserialize:function(t){},component:function(t){return this._node&&this._node.component(t)},get camera(){return this.component("bg.scene.Camera")},get chain(){return this.component("bg.scene.Chain")},get drawable(){return this.component("bg.scene.Drawable")},get inputJoint(){return this.component("bg.scene.InputJoint")},get outputJoint(){return this.component("bg.scene.OutputJoint")},get light(){return this.component("bg.scene.Light")},get transform(){return this.component("bg.scene.Transform")}},{Factory:function(t){}},t)}(bg.LifeCycle);bg.scene.Component=e,bg.scene.registerComponent=function(e,n,i){var r=/function (.+)\(/.exec(n.toString()),a=r&&r.length>1?r[1]:"";e[a]=n,n.prototype._typeId=i||a,t[n]=n}}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._context=t}return $traceurRuntime.createClass(e,{get context(){return this._context},set context(t){this._context=t}},{},t)}(bg.LifeCycle),e=function(t){function e(t){var n=void 0!==arguments[1]?arguments[1]:"";$traceurRuntime.superConstructor(e).call(this,t),this._name=n,this._enabled=!0,this._components={}}return $traceurRuntime.createClass(e,{cloneComponents:function(){var t=new bg.scene.Node(this.context,this.name?"copy of "+this.name:"");t.enabled=this.enabled,forEachComponent(function(e){t.addComponent(e.clone())})},get name(){return this._name},set name(t){this._name=t},get enabled(){return this._enabled},set enabled(t){this._enabled=t},addComponent:function(t){t._node&&t._node.removeComponent(t),t._node=this,this._components[t.typeId]=t,t.addedToNode(this)},removeComponent:function(t){var e="",n=null;return"string"==typeof t?(e=t,n=this.component(t)):t instanceof bg.scene.Component&&(n=t,e=t.typeId),this._components[e]==n&&null!=n&&(delete this._components[e],n.removedFromNode(this),!0)},component:function(t){return this._components[t]},forEachComponent:function(t){var e=Object.keys(this._components),n=!0,i=!1,r=void 0;try{for(var a=void 0,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;t(this._components[o],o,this._components)}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}},someComponent:function(t){var e=Object.keys(this._components),n=!0,i=!1,r=void 0;try{for(var a=void 0,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;if(t(this._components[o],o,this._components))return!0}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return!1},everyComponent:function(t){var e=Object.keys(this._components),n=!0,i=!1,r=void 0;try{for(var a=void 0,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;if(!t(this._components[o],o,this._components))return!1}}catch(t){i=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return!0},destroy:function(){var t=this;this.forEachComponent(function(e){e.removedFromNode(t)}),this._components={}},init:function(){this.forEachComponent(function(t){t.init()})},frame:function(t){this.forEachComponent(function(e){e._initialized_||(e.init(),e._initialized_=!0),e.frame(t)})},willDisplay:function(t,e){this.forEachComponent(function(n){n.willDisplay(t,e)})},display:function(t,e){this.forEachComponent(function(n){n.display(t,e)})},didDisplay:function(t,e){this.forEachComponent(function(n){n.didDisplay(t,e)})},reshape:function(t,e,n,i){this.forEachComponent(function(t){t.reshape(n,i)})},keyDown:function(t){this.forEachComponent(function(e){e.keyDown(t)})},keyUp:function(t){this.forEachComponent(function(e){e.keyUp(t)})},mouseUp:function(t){this.forEachComponent(function(e){e.mouseUp(t)})},mouseDown:function(t){this.forEachComponent(function(e){e.mouseDown(t)})},
mouseMove:function(t){this.forEachComponent(function(e){e.mouseMove(t)})},mouseOut:function(t){this.forEachComponent(function(e){e.mouseOut(t)})},mouseDrag:function(t){this.forEachComponent(function(e){e.mouseDrag(t)})},mouseWheel:function(t){this.forEachComponent(function(e){e.mouseWheel(t)})},touchStart:function(t){this.forEachComponent(function(e){e.touchStart(t)})},touchMove:function(t){this.forEachComponent(function(e){e.touchMove(t)})},touchEnd:function(t){this.forEachComponent(function(e){e.touchEnd(t)})}},{},t)}(t);bg.scene.SceneObject=e}(),function(){function t(e,n){return!(!e||!n)&&(e._parent==n||t(e._parent,n))}var e=function(e){function n(t){var e=void 0!==arguments[1]?arguments[1]:"";$traceurRuntime.superConstructor(n).call(this,t,e),this._children=[],this._parent=null}return $traceurRuntime.createClass(n,{addChild:function(t){t&&!this.isAncientOf(t)&&t!=this&&(t.parent&&t.parent.removeChild(t),this._children.push(t),t._parent=this)},removeChild:function(t){var e=this._children.indexOf(t);e>=0&&this._children.splice(e,1)},get children(){return this._children},get parent(){return this._parent},get sceneRoot(){return this._parent?this._parent.sceneRoot():this},haveChild:function(t){return-1!=this._children.indexOf(t)},isAncientOf:function(e){t(this,e)},accept:function(t){t.visit(this),this._children.forEach(function(e){e.accept(t)}),t.didVisit(this)},acceptReverse:function(t){this._parent&&this._parent.acceptReverse(t),t.visit(this)},destroy:function(){$traceurRuntime.superGet(this,n.prototype,"destroy").call(this),this._children.forEach(function(t){t.destroy()}),this._children=[]}},{},e)}(bg.scene.SceneObject);bg.scene.Node=e;var n=function(){function t(){}return $traceurRuntime.createClass(t,{visit:function(t){},didVisit:function(t){}},{})}();bg.scene.NodeVisitor=n}(),function(){var t=function(t){function i(t){$traceurRuntime.superConstructor(i).call(this,t),this._near=.1,this._far=100,this._viewport=new bg.Viewport(0,0,512,512)}return $traceurRuntime.createClass(i,{clone:function(){console.log("WARNING: ProjectionStrategy::clone() method not implemented by child class.")},get near(){return this._near},set near(t){this._near=t,apply()},get far(){return this._far},set far(t){this._far=t},get viewport(){return this._viewport},set viewport(t){this._viewport=t}},{Factory:function(t){var i=null;return t&&("PerspectiveProjectionMethod"==t.type?i=new e:"OpticalProjectionMethod"==t.type&&(i=new n),i&&i.deserialize(t)),i}},t)}(bg.MatrixStrategy);bg.scene.ProjectionStrategy=t;var e=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._fov=60}return $traceurRuntime.createClass(e,{clone:function(){var t=new e;return t.near=this.near,t.far=this.far,t.viewport=this.viewport,t.fov=this.fov,t},get fov(){return this._fov},set fov(t){this._fov=t},apply:function(){this.target&&this.target.perspective(this.fov,this.viewport.aspectRatio,this.near,this.far)},deserialize:function(t){this.near=t.near,this.far=t.far,this.fov=t.fov}},{},t)}(t);bg.scene.PerspectiveProjectionStrategy=e;var n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._focalLength=50,this._frameSize=35}return $traceurRuntime.createClass(e,{clone:function(){var t=new e;return t.near=this.near,t.far=this.far,t.viewport=this.viewport,t.focalLength=this.focalLength,t.frameSize=this.frameSize,t},get focalLength(){return this._focalLength},set focalLength(t){this._focalLength=t},get frameSize(){return this._frameSize},set frameSize(t){this._frameSize=t},apply:function(){if(this.target){var t=2*bg.Math.atan(this.frameSize/(this.focalLength/2));t=bg.Math.radiansToDegrees(t),this.target.perspective(t,this.viewport.aspectRatio,this.near,this.far)}},deserialize:function(t){this.frameSize=t.frameSize,this.focalLength=t.focalLength,this.near=t.near,this.far=t.far}},{},t)}(t);bg.scene.OpticalProjectionStrategy=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._projection=bg.Matrix4.Perspective(60,1,.1,100),this._viewport=new bg.Viewport(0,0,512,512),this._visitor=new bg.scene.TransformVisitor,this._rebuildTransform=!0,this._clearBuffers=bg.base.ClearBuffers.COLOR_DEPTH,this._focus=5,this._projectionStrategy=null}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.Camera;return t._projection=new bg.Matrix4(this._projection),t._viewport=new bg.Matrix4(this._viewport),t._projectionStrategy=this._projectionStrategy?this._projectionStrategy.clone():null,t},get projection(){return this._projection},set projection(t){this._projectionStrategy||(this._projection=t)},get viewport(){return this._viewport},set viewport(t){this._viewport=t,this._projectionStrategy&&(this._projectionStrategy.viewport=t,this._projectionStrategy.apply())},get focus(){return this._focus},set focus(t){this._focus=t},get projectionStrategy(){return this._projectionStrategy},set projectionStrategy(t){this._projectionStrategy=t,this._projectionStrategy&&(this._projectionStrategy.target=this._projection)},get clearBuffers(){return this._clearBuffers},set clearBuffers(t){this._clearBuffers=t},get modelMatrix(){return this._rebuildTransform&&this.node&&(this._visitor.matrix.identity(),this.node.acceptReverse(this._visitor),this._rebuildTransform=!1),this._visitor.matrix},get viewMatrix(){return this._viewMatrix&&!this._rebuildTransform||(this._viewMatrix=new bg.Matrix4(this.modelMatrix),this._viewMatrix.invert()),this._viewMatrix},frame:function(t){this._rebuildTransform=!0}},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,i,"bg.scene.Camera")}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).call(this)}return $traceurRuntime.createClass(e,{clone:function(){return new bg.scene.Chain},willDisplay:function(t,e){if(this.node){var n=bg.Matrix4.Identity();this.node.children.forEach(function(t){var e=t.component("bg.scene.Transform"),i=t.component("bg.scene.InputChainJoint"),r=t.component("bg.scene.OutputChainJoint");i?i.joint.applyTransform(n):n.identity(),e&&e.matrix.assign(n),r&&r.joint.applyTransform(n)})}},deserialize:function(t){}},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,t,"bg.scene.Chain");var e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._joint=new bg.physics.LinkJoint}return $traceurRuntime.createClass(e,{get joint(){return this._joint},set joint(t){this._joint=t},deserialize:function(t){}},{},t)}(bg.scene.Component);bg.scene.ChainJoint=e;var n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),t?this.joint=t:this.joint.transformOrder=bg.physics.LinkTransformOrder.ROTATE_TRANSLATE}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.InputChainJoint;return t.joint.assign(this.joint),t}},{},t)}(e);bg.scene.registerComponent(bg.scene,n,"bg.scene.InputChainJoint");var i=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),t?this.joint=t:this.joint.transformOrder=bg.physics.LinkTransformOrder.TRANSLATE_ROTATE}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.OutputChainJoint;return t.joint.assign(this.joint),t}},{},t)}(e);bg.scene.registerComponent(bg.scene,i,"bg.scene.OutputChainJoint")}(),function(){var t=function(t){function e(){var t=void 0!==arguments[0]?arguments[0]:"";$traceurRuntime.superConstructor(e).call(this),this._name=t,this._items=[]}return $traceurRuntime.createClass(e,{get name(){return this._name},set name(t){this._name=t},clone:function(t){var e=new bg.scene.Drawable;return e.name=t||"copy of "+this.name,this.forEach(function(t,n,i){e.addPolyList(t.clone(),n.clone(),i?new bg.Matrix4(i):null)}),e},instance:function(t){var e=new bg.scene.Drawable;return e.name=t||"copy of "+this.name,this.forEach(function(t,n,i){e.addPolyList(t,n.clone(),i?new bg.Matrix4(i):null)}),e},addPolyList:function(t,e){var n=void 0!==arguments[2]?arguments[2]:null;return!(!t||-1!=this.indexOf(t))&&(e=e||new bg.base.Material,this._items.push({polyList:t,material:e,transform:n}),!0)},removePolyList:function(t){var e=this.indexOf(t);e>=0&&this._items.splice(e,1)},indexOf:function(t){var e=-1;return this._items.some(function(t,n){if(t.polyList==t)return e=n,!0}),e},replacePolyList:function(t,e){return t>=0&&t<this._items.length&&(this._items[t].polyList=e,!0)},replaceMaterial:function(t,e){return t>=0&&t<this._items.length&&(this._items[t].material=e,!0)},replaceTransform:function(t,e){return t>=0&&t<this._items.length&&(this._items[t].transform=e,!0)},getPolyList:function(t){return t>=0&&t<this._items.length&&this._items[t].polyList},getMaterial:function(t){return t>=0&&t<this._items.length&&this._items[t].material},getTransform:function(t){return t>=0&&t<this._items.length&&this._items[t].transform},forEach:function(t){var e=!0,n=!1,i=void 0;try{for(var r=void 0,a=this._items[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;t(s.polyList,s.material,s.transform)}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}},some:function(t){var e=!0,n=!1,i=void 0;try{for(var r=void 0,a=this._items[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;if(t(s.polyList,s.material,s.transform))return!0}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return!1},every:function(t){var e=!0,n=!1,i=void 0;try{for(var r=void 0,a=this._items[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;if(!t(s.polyList,s.material,s.transform))return!1}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return!0},display:function(t,e){if(!t.effect)throw new Error("Could not draw component: invalid effect found.");this.node.enabled&&this.forEach(function(n,i,r){if(n.visible){var a=t.effect.material;r&&(e.modelMatrixStack.push(),e.modelMatrixStack.mult(r)),t.shouldDraw(i)&&(t.effect.material=i,t.draw(n)),r&&e.modelMatrixStack.pop(),t.effect.material=a}})},setGroupVisible:function(t){var e=void 0===arguments[1]||arguments[1];this.forEach(function(n){n.groupName==t&&(n.visible=e)})},hideGroup:function(t){this.setGroupVisible(t,!1)},showGroup:function(t){this.setGroupVisible(t,!0)},setVisibleByName:function(t){var e=void 0===arguments[1]||arguments[1];this.some(function(n){if(n.name==t)return n.visible=e,!0})},showByName:function(t){this.setVisibleByName(t,!0)},hideByName:function(t){this.setVisibleByName(t,!1)},deserialize:function(t){}},{InstanceNode:function(t){var n=new bg.scene.Node(t.context,t.name?"copy of "+t.name:"");return n.enabled=t.enabled,t.forEachComponent(function(t){var i=null;i=t instanceof e?t.instance():t.clone(),n.addComponent(i)}),n}},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,t,"bg.scene.Drawable")}(),function(){function t(t){n.push(t)}function e(t){var e=n.indexOf(t);-1!=e&&n.splice(e,1)}var n=[],i=function(i){function r(){var t=void 0!==arguments[0]?arguments[0]:null;$traceurRuntime.superConstructor(r).call(this),this._light=t,this._visitor=new bg.scene.TransformVisitor,this._rebuildTransform=!0}return $traceurRuntime.createClass(r,{clone:function(){var t=new bg.scene.Light;return t.light=this.light.clone(),t},get light(){return this._light},set light(t){this._light=t},get transform(){return this._rebuildTransform&&this.node&&(this._visitor.matrix.identity(),this.node.acceptReverse(this._visitor),this._rebuildTransform=!1),this._visitor.matrix},frame:function(t){this._rebuildTransform=!0},removedFromNode:function(t){e(this)},addedToNode:function(e){t(this)}},{GetActiveLights:function(){return n}},i)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,i,"bg.scene.Light")}(),function(){function t(t,e,n,i){var r=new bg.base.PolyList(t),a=e/2,s=n/2,o=i/2;return r.vertex=[a,-s,-o,-a,-s,-o,-a,s,-o,a,s,-o,a,-s,o,a,-s,-o,a,s,-o,a,s,o,-a,-s,o,a,-s,o,a,s,o,-a,s,o,-a,-s,-o,-a,-s,o,-a,s,o,-a,s,-o,-a,s,o,a,s,o,a,s,-o,-a,s,-o,a,-s,o,-a,-s,o,-a,-s,-o,a,-s,-o],r.normal=[0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],r.texCoord0=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],r.texCoord1=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],r.index=[0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8,12,13,14,14,15,12,16,17,18,18,19,16,20,21,22,22,23,20],r.build(),r}function e(t,e,n){var i=e/2,r=n/2,a=new bg.base.PolyList(t);return a.vertex=[-i,0,-r,i,0,-r,i,0,r,i,0,r,-i,0,r,-i,0,-r],a.normal=[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],a.texCoord0=[0,0,1,0,1,1,1,1,0,1,0,0],a.texCoord1=[0,0,1,0,1,1,1,1,0,1,0,0],a.index=[2,1,0,5,4,3],a.build(),a}function n(t,e,n,i){var r=new bg.base.PolyList(t);++n;var a,s,o=1/(i-1),u=1/(n-1),l=[],c=[],h=[],f=[];for(a=0;a<i;a++)for(s=0;s<n;s++){var d=bg.Math.sin(-bg.Math.PI_2+bg.Math.PI*a*o),g=bg.Math.cos(2*bg.Math.PI*s*u)*bg.Math.sin(bg.Math.PI*a*o),m=bg.Math.sin(2*bg.Math.PI*s*u)*bg.Math.sin(bg.Math.PI*a*o);h.push(s*u),h.push(a*o),c.push(g,d,m),l.push(g*e,d*e,m*e)}for(a=0;a<i-1;a++)for(s=0;s<n-1;s++){var p=a*n+s,b=a*n+(s+1),_=(a+1)*n+(s+1),v=(a+1)*n+s;f.push(p),f.push(v),f.push(_),f.push(_),f.push(b),f.push(p)}return r.vertex=l,r.normal=c,r.texCoord0=h,r.texCoord1=h,r.index=f,r.build(),r}function i(t,e){var n=new bg.scene.Drawable(e);return n.addPolyList(t),n}var r=function(){function r(){}return $traceurRuntime.createClass(r,{},{Cube:function(e){var n=void 0!==arguments[1]?arguments[1]:1,r=arguments[2],a=arguments[3];return r=r||n,a=a||n,i(t(e,n,r,a),"Cube")},Plane:function(t){var n=void 0!==arguments[1]?arguments[1]:1,r=arguments[2];return r=r||n,i(e(t,n,r),"Cube")},Sphere:function(t){var e=void 0!==arguments[1]?arguments[1]:1,r=void 0!==arguments[2]?arguments[2]:20,a=arguments[3];return a=a||r,i(n(t,e,r,a),"Cube")}})}();bg.scene.PrimitiveFactory=r}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),this._matrix=t||bg.Matrix4.Identity(),this._globalMatrixValid=!1,this._transformVisitor=new bg.scene.TransformVisitor}return $traceurRuntime.createClass(e,{clone:function(){var t=new bg.scene.Transform;return t.matrix=new bg.Matrix4(this.matrix),t},get matrix(){return this._matrix},set matrix(t){this._matrix=t},get globalMatrix(){return this._globalMatrixValid||(this._transformVisitor.clear(),this.node.acceptReverse(this._transformVisitor),this._globalMatrix=this._transformVisitor.matrix),this._globalMatrix},deserialize:function(t){t.transformStrategy||t.transformMatrix},willDisplay:function(t,e){this.node&&this.node.enabled&&(e.modelMatrixStack.push(),e.modelMatrixStack.mult(this.matrix))},didDisplay:function(t,e){this.node&&this.node.enabled&&e.modelMatrixStack.pop(),this._globalMatrixValid=!1}},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.scene,t,"bg.scene.Transform")}(),function(){var t=function(t){function e(t,n){$traceurRuntime.superConstructor(e).call(this),this._pipeline=t||bg.base.Pipeline.Current(),this._matrixState=n||bg.base.MatrixState.Current()}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline},get matrixState(){return this._matrixState},visit:function(t){t.willDisplay(this.pipeline,this.matrixState),t.display(this.pipeline,this.matrixState)},didVisit:function(t){t.didDisplay(this.pipeline,this.matrixState)}},{},t)}(bg.scene.NodeVisitor);bg.scene.DrawVisitor=t;var e=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._delta=0}return $traceurRuntime.createClass(e,{get delta(){return this._delta},set delta(t){this._delta=t},visit:function(t){t.frame(this.delta)}},{},t)}(bg.scene.NodeVisitor);bg.scene.FrameVisitor=e;var n=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._matrix=bg.Matrix4.Identity()}return $traceurRuntime.createClass(e,{get matrix(){return this._matrix},clear:function(){this._matrix=bg.Matrix4.Identity()},visit:function(t){var e=t.component("bg.scene.Transform");e&&this._matrix.mult(e.matrix)}},{},t)}(bg.scene.NodeVisitor);bg.scene.TransformVisitor=n;var i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{visit:function(t){this._operation&&t[this._operation](this._event)},keyDown:function(t,e){this._operation="keyDown",this._event=e,t.accept(this)},keyUp:function(t,e){this._operation="keyUp",this._event=e,t.accept(this)},mouseUp:function(t,e){this._operation="mouseUp",this._event=e,t.accept(this)},mouseDown:function(t,e){this._operation="mouseDown",this._event=e,t.accept(this)},mouseMove:function(t,e){this._operation="mouseMove",this._event=e,t.accept(this)},mouseOut:function(t,e){this._operation="mouseOut",this._event=e,t.accept(this)},mouseDrag:function(t,e){this._operation="mouseDrag",this._event=e,t.accept(this)},mouseWheel:function(t,e){this._operation="mouseWheel",this._event=e,t.accept(this)},touchStart:function(t,e){this._operation="touchStart",this._event=e,t.accept(this)},touchMove:function(t,e){this._operation="touchMove",this._event=e,t.accept(this)},touchEnd:function(t,e){this._operation="touchEnd",this._event=e,t.accept(this)}},{},t)}(bg.scene.NodeVisitor);bg.scene.InputVisitor=i;var r=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this.clear()}return $traceurRuntime.createClass(e,{get min(){return this._min},get max(){return this._max},get size(){return this._size},clear:function(){this._min=new bg.Vector3(bg.Math.FLOAT_MAX,bg.Math.FLOAT_MAX,bg.Math.FLOAT_MAX),this._max=new bg.Vector3(-bg.Math.FLOAT_MAX,-bg.Math.FLOAT_MAX,-bg.Math.FLOAT_MAX),this._size=new bg.Vector3(0,0,0)},visit:function(t){var e=bg.Matrix4.Identity();if(t.component("bg.scene.Transform")&&(e=t.component("bg.scene.Transform").globalMatrix),t.component("bg.scene.Drawable")){var n=new bg.tools.BoundingBox(t.component("bg.scene.Drawable"),new bg.Matrix4(e));this._min=bg.Vector.MinComponents(this._min,n.min),this._max=bg.Vector.MaxComponents(this._max,n.max),this._size=bg.Vector3.Sub(this._max,this._min)}}},{},t)}(bg.scene.NodeVisitor);bg.scene.BoundingBoxVisitor=r}(),function(){function t(t,e){var n=new Uint8Array(t,e,4);return n=String.fromCharCode(n[0])+String.fromCharCode(n[1])+String.fromCharCode(n[2])+String.fromCharCode(n[3])}function e(t,e){return new DataView(t,e,4).getInt32(0)}function n(t,e){return new DataView(t,e,4).getFloat32(0)}function i(t,e){for(var n={offset:0,data:[]},i=new DataView(t,e,64),r=0;r<16;++r)n.data[r]=i.getFloat32(4*r,!1);return n.offset+=64,n}function r(t,n){var i={offset:0,data:""},r=e(t,n);i.offset+=4;for(var a=new Uint8Array(t,n+4,r),s=0;s<r;++s)i.data+=String.fromCharCode(a[s]);return i.offset+=r,i}function a(t,n){var i={offset:0,data:[]},r=e(t,n);i.offset+=4;for(var a=new DataView(t,n+4,4*r),s=0;s<r;++s)i.data[s]=a.getFloat32(4*s,!1);return i.offset+=4*r,i}function s(t,n){var i={offset:0,data:[]},r=e(t,n);i.offset+=4;for(var a=new DataView(t,n+4,4*r),s=0;s<r;++s)i.data[s]=a.getInt32(4*s,!1);return i.offset+=4*r,i}function o(t,e,n){var i=new bg.physics[n.type];i.offset=new(Function.prototype.bind.apply(bg.Vector3,$traceurRuntime.spread([null],n.offset))),i.roll=n.roll,i.pitch=n.pitch,i.yaw=n.yaw;var r=new bg.scene[e](i);t.addComponent(r)}var u=function(){function u(t,e){this._context=t}return $traceurRuntime.createClass(u,{loadDrawable:function(t,e){this._jointData=null;var n=this.parseData(t);return this.createDrawable(n,e)},parseData:function(o){var u=[],l=null,c=0,h=new Uint8Array(o,0,8);c=8;var f=String.fromCharCode(h[4])+String.fromCharCode(h[5])+String.fromCharCode(h[6])+String.fromCharCode(h[7]);if(1==h[0])throw"Could not open the model file. This file has been saved as computer (little endian) format, try again saving it in network (big endian) format";if("hedr"!=f)throw"File format error. Expecting header";var d={maj:h[1],min:h[2],rev:h[3]};bg.log("vwglb file version: "+d.maj+"."+d.min+"."+d.rev+", big endian");e(o,c);c+=4;var g=t(o,c);if(c+=4,"mtrl"!=g)throw"File format error. Expecting materials definition";var m=r(o,c);if(c+=m.offset,l=JSON.parse(m.data),"proj"==t(o,c)){c+=4,c+=r(o,c).offset,n(o,c),c+=4;var p=i(o,c);c+=p.offset;var b=(p.data,i(o,c));c+=b.offset,b.data}if("join"==t(o,c)){c+=4;var _=r(o,c);c+=_.offset;var v=_.data;try{this._jointData=JSON.parse(v)}catch(t){throw new Error("VWGLB file format reader: Error parsing joint data")}}var y=t(o,c);if("plst"!=y)throw"File format error. Expecting poly list";var E=!1;c+=4;for(var T,x,S,w,M,C,R,O;!E;){y=t(o,c),c+=4;var A=null,j=null;switch(y){case"pnam":A=r(o,c),c+=A.offset,T=A.data;break;case"mnam":A=r(o,c),c+=A.offset,x=A.data;break;case"varr":var I=a(o,c);c+=I.offset,S=I.data;break;case"narr":var P=a(o,c);c+=P.offset,w=P.data;break;case"t0ar":j=a(o,c),c+=j.offset,M=j.data;break;case"t1ar":j=a(o,c),c+=j.offset,C=j.data;break;case"t2ar":j=a(o,c),c+=j.offset,R=j.data;break;case"indx":var L=s(o,c);c+=L.offset,O=L.data;break;case"plst":case"endf":var N={name:T,matName:x,vertices:S,normal:w,texcoord0:M,texcoord1:C,texcoord2:R,indices:O};u.push(N),T="",x="",S=null,w=null,M=null,C=null,R=null,O=null;break;default:throw"File format exception. Unexpected poly list member found"}E="endf"==y}var D={version:d,polyList:u,materials:{}};return l.forEach(function(t){D.materials[t.name]=t}),D},createDrawable:function(t,e){var n=this,i=new bg.scene.Drawable(this.context);i._version=t.version;var r=[];return t.polyList.forEach(function(a){var s=t.materials[a.matName],o=new bg.base.PolyList(n._context);o.name=a.name,o.vertex=a.vertices||o.vertex,o.normal=a.normal||o.normal,o.texCoord0=a.texcoord0||o.texCoord0,o.texCoord1=a.texcoord1||o.texCoord1,o.texCoord2=a.texcoord2||o.texCoord2,o.index=a.indices||o.index,o.groupName=s.groupName,o.visible=s.visible,o.build(),r.push(bg.base.Material.GetMaterialWithJson(n._context,s,e).then(function(t){i.addPolyList(o,t)}))}),Promise.all(r).then(function(){return i})},addComponents:function(t){if(this._jointData){var e=null,n=null;this._jointData.input&&(e=this._jointData.input),this._jointData.output&&this._jointData.output.length&&(n=this._jointData.output[0]),e&&o(t,"InputChainJoint",e),n&&o(t,"OutputChainJoint",n)}}},{})}(),l=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{acceptType:function(t,e){return"vwglb"==bg.utils.Resource.GetExtension(t)},load:function(t,e,n){return new Promise(function(i,r){if(n)try{var a=new u(t,n),s=e.substr(0,e.lastIndexOf("/"));a.loadDrawable(n,s).then(function(e){var n=new bg.scene.Node(t,e.name);n.addComponent(e),a.addComponents(n),i(n)})}catch(t){r(t)}else r(new Error("Error loading drawable. Data is null"))})}},{},t)}(bg.base.LoaderPlugin);bg.base.VWGLBLoaderPlugin=l}(),bg.manipulation={},function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._gizmoOpacity=.9}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline||(this._pipeline=new bg.base.Pipeline(this.context),this._pipeline.blendMode=bg.base.BlendMode.NORMAL,this._pipeline.effect=new bg.manipulation.GizmoEffect(this.context)),this._pipeline},get matrixState(){return this._matrixState||(this._matrixState=new bg.base.MatrixState),this._matrixState},get drawVisitor(){return this._drawVisitor||(this._drawVisitor=new bg.scene.DrawVisitor(this.pipeline,this.matrixState)),this._drawVisitor},get gizmoOpacity(){return this._gizmoOpacity},set gizmoOpacity(t){this._gizmoOpacity=t},get working(){return this._working},startAction:function(t,e){if(this._working=!0,this._startPoint=e,this._currentGizmoData=t,this._currentGizmoData&&this._currentGizmoData.node){var n=this._currentGizmoData.node.component("bg.manipulation.Gizmo");n&&n.beginDrag(this._currentGizmoData.action,e)}},move:function(t,e){if(this._currentGizmoData&&this._currentGizmoData.node){var n=this._currentGizmoData.node.component("bg.manipulation.Gizmo");n&&(t.y=e.viewport.height-t.y,n.drag(this._currentGizmoData.action,this._startPoint,t,e)),this._startPoint=t}},endAction:function(){if(this._currentGizmoData&&this._currentGizmoData.node){var t=this._currentGizmoData.node.component("bg.manipulation.Gizmo");t&&t.endDrag(this._currentGizmoData.action)}this._working=!1,this._startPoint=null,this._currentGizmoData=null},drawGizmos:function(t,e){var n=void 0===arguments[2]||arguments[2],i=bg.base.Pipeline.Current(),r=bg.base.MatrixState.Current();bg.base.Pipeline.SetCurrent(this.pipeline),bg.base.MatrixState.SetCurrent(this.matrixState),this.pipeline.viewport=e.viewport,this.pipeline.effect.matrixState=this.matrixState,n&&this.pipeline.clearBuffers(bg.base.ClearBuffers.DEPTH),this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix);var a=this.pipeline.opacityLayer;this.pipeline.opacityLayer=bg.base.OpacityLayer.NONE,this.pipeline.blend=!0,this.pipeline.effect.gizmoOpacity=this.gizmoOpacity,t.accept(this.drawVisitor),this.pipeline.blend=!1,this.pipeline.opacityLayer=a,i&&bg.base.Pipeline.SetCurrent(i),r&&bg.base.MatrixState.SetCurrent(r)}},{},t)}(bg.app.ContextObject);bg.manipulation.GizmoManager=t}(),function(){function t(){o[bg.webgl1.EngineId]={vertex:"\n\t\t\tattribute vec3 inVertex;\n\t\t\tattribute vec2 inTexCoord;\n\t\t\t\n\t\t\tuniform mat4 inModelMatrix;\n\t\t\tuniform mat4 inViewMatrix;\n\t\t\tuniform mat4 inProjectionMatrix;\n\t\t\t\n\t\t\tvarying vec2 fsTexCoord;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tfsTexCoord = inTexCoord;\n\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t}\n\t\t\t",fragment:"\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tuniform sampler2D inTexture;\n\t\t\tuniform float inOpacity;\n\t\t\t\n\t\t\tvarying vec2 fsTexCoord;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = vec4(texture2D(inTexture,fsTexCoord).rgb,inOpacity);\n\t\t\t}\n\t\t\t"}}function e(t){return/rotate.*fine/i.test(t.name)?bg.manipulation.GizmoAction.ROTATE_FINE:/rotate/i.test(t.name)?bg.manipulation.GizmoAction.ROTATE:/translate/i.test(t.name)?bg.manipulation.GizmoAction.TRANSLATE:void 0}function n(t,n,i){return new Promise(function(r,a){bg.base.Loader.Load(t,n).then(function(t){var n=t.component("bg.scene.Drawable"),a=[];n&&n.forEach(function(t,n){a.push({id:bg.manipulation.Selectable.GetIdentifier(),type:bg.manipulation.SelectableType.GIZMO,plist:t,material:n,action:e(t),node:i})}),r(a)}).catch(function(t){a(t)})})}function i(t,e,n,i,r){r||(r=0);var a=new bg.Vector3(n);a.sub(i).normalize();var s=new bg.Vector3(e);s.sub(i).normalize();var o=a.dot(s),u=Math.acos(o);if(u>=r||0==r){0!=r&&(u=u>=2*r?2*r:r);t.dot(a.cross(s))<0&&(u*=-1);var l=new bg.Quaternion(u,t.x,t.y,t.z);if(l.normalize(),!isNaN(l.x))return l}return new bg.Quaternion(0,0,1,0)}function r(t,e){var n=new bg.Matrix4(t.transform.matrix),i=n.rotation,r=n.position;switch(t._lastPickPoint||(t._lastPickPoint=e.ray.end,t._translateOffset=new bg.Vector3(r),t._translateOffset.sub(e.ray.end)),Math.abs(t.plane)){case bg.Axis.X:n=bg.Matrix4.Translation(r.x,e.point.y+t._translateOffset.y,e.point.z+t._translateOffset.z);break;case bg.Axis.Y:n=bg.Matrix4.Translation(e.point.x+t._translateOffset.x,r.y,e.point.z+t._translateOffset.z);break;case bg.Axis.Z:n=bg.Matrix4.Translation(e.point.x+t._translateOffset.x,e.point.y+t._translateOffset.y,r.z)}return n.mult(i),t._lastPickPoint=e.point,n}function a(t,e,n){var r=new bg.Matrix4(t.transform.matrix),a=r.rotation,s=r.position;if(t._lastPickPoint||(t._lastPickPoint=e.ray.end,t._translateOffset=new bg.Vector3(s),t._translateOffset.sub(e.ray.end)),n){var o=new bg.Matrix4(a);a=i(t.planeAxis,t._lastPickPoint,e.point,s),0==a.x&&0==a.y&&0==a.z&&1==a.w||(r=bg.Matrix4.Translation(s).mult(a.getMatrix4()).mult(o),t._lastPickPoint=e.point)}else{var u=new bg.Matrix4(a);a=i(t.planeAxis,t._lastPickPoint,e.point,s,bg.Math.degreesToRadians(22.5)),0==a.x&&0==a.y&&0==a.z&&1==a.w||(r=bg.Matrix4.Translation(s).mult(a.getMatrix4()).mult(u),t._lastPickPoint=e.point)}return r}function s(t,e){var n=e.viewMatrixStack.matrix.forwardVector,i=e.viewMatrixStack.matrix.upVector,r=new bg.Vector3(1,0,0),a=new bg.Vector3(0,1,0),s=new bg.Vector3(0,0,1),o=new bg.Vector3(-1,0,0),u=new bg.Vector3(0,-1,0),l=new bg.Vector3(0,0,-1);if(Math.acos(i.dot(a))>.9)t.plane=bg.Axis.Y;else{var c=[Math.acos(n.dot(r)),Math.acos(n.dot(a)),Math.acos(n.dot(s)),Math.acos(n.dot(o)),Math.acos(n.dot(u)),Math.acos(n.dot(l))],h=c[0],f=0;switch(c.reduce(function(t,e,n){e<h&&(f=n,h=e)}),f){case 0:t.plane=-bg.Axis.X;break;case 1:t.plane=bg.Axis.Y;break;case 2:t.plane=bg.Axis.Z;break;case 3:t.plane=bg.Axis.X;break;case 4:t.plane=-bg.Axis.Y;break;case 5:t.plane=-bg.Axis.Z}}}var o={},u=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e),t(),this._gizmoOpacity=1}return $traceurRuntime.createClass(n,{get inputVars(){return{vertex:"inVertex",tex0:"inTexCoord"}},set matrixState(t){this._matrixState=t},get matrixState(){return this._matrixState},set texture(t){this._texture=t},get texture(){return this._texture},set gizmoOpacity(t){this._gizmoOpacity=t},get gizmoOpacity(){return this._gizmoOpacity},get shader(){return this._shader||(this._shader=new bg.base.Shader(this.context),this._shader.addShaderSource(bg.base.ShaderType.VERTEX,o[bg.webgl1.EngineId].vertex),this._shader.addShaderSource(bg.base.ShaderType.FRAGMENT,o[bg.webgl1.EngineId].fragment),this._shader.link(),this._shader.status?this._shader.initVars(["inVertex","inTexCoord"],["inModelMatrix","inViewMatrix","inProjectionMatrix","inTexture","inOpacity"]):(console.log(this._shader.compileError),console.log(this._shader.linkError))),this._shader},setupVars:function(){this.shader.setMatrix4("inModelMatrix",this.matrixState.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",new bg.Matrix4(this.matrixState.viewMatrixStack.matrixConst)),this.shader.setMatrix4("inProjectionMatrix",this.matrixState.projectionMatrixStack.matrixConst),this.shader.setTexture("inTexture",this.texture,bg.base.TextureUnit.TEXTURE_0),this.shader.setValueFloat("inOpacity",this.gizmoOpacity)}},{},e)}(bg.base.Effect);bg.manipulation.GizmoEffect=u,bg.manipulation.GizmoAction={TRANSLATE:1,ROTATE:2,ROTATE_FINE:3,NONE:99};var l={},c=function(){function t(t){this._context=t,this._gizmos={}}return $traceurRuntime.createClass(t,{find:function(t){return this._gizmos[t]},register:function(t,e){this._gizmos[t]=e},unregister:function(t){this._gizmos[t]&&delete this._gizmos[t]},clear:function(){this._gizmos={}}},{Get:function(e){return l[e.uuid]||(l[e.uuid]=new t(e)),l[e.uuid]}})}();bg.manipulation.GizmoCache=c;var h=function(t){function e(t){var n=void 0===arguments[1]||arguments[1];$traceurRuntime.superConstructor(e).call(this),this._gizmoPath=t,this._offset=new bg.Vector3(0),this._visible=n,this._gizmoTransform=bg.Matrix4.Identity(),this._gizmoP=bg.Matrix4.Identity()}return $traceurRuntime.createClass(e,{clone:function(){var t=new e(this._gizmoPath);return t.offset.assign(this._offset),t.visible=this._visible,t},get offset(){return this._offset},set offset(t){this._offset=t},get visible(){return this._visible},set visible(t){this._visible=t},get gizmoTransform(){return this._gizmoTransform},beginDrag:function(t,e){},drag:function(t,e,n,i){},endDrag:function(t){},findId:function(t){var e=null;return this._gizmoItems&&this._gizmoItems.some(function(n){if(n.id.r==t.r&&n.id.g==t.g&&n.id.b==t.b&&n.id.a==t.a)return e=n,!0}),e},init:function(){var t=this;this._error||(this._gizmoItems=[],n(this.node.context,this._gizmoPath,this.node).then(function(e){t._gizmoItems=e}).catch(function(e){throw t._error=!0,e}))},frame:function(t){},display:function(t,e){if(this._gizmoItems&&this.visible){if(e.modelMatrixStack.push(),e.modelMatrixStack.set(this._gizmoP).mult(this.gizmoTransform),t.effect instanceof bg.manipulation.ColorPickEffect&&t.opacityLayer&bg.base.OpacityLayer.GIZMOS){var n=t.depthTest;t.depthTest=!1,this._gizmoItems.forEach(function(e){t.effect.pickId=new bg.Color(e.id.a/255,e.id.b/255,e.id.g/255,e.id.r/255),t.draw(e.plist)}),t.depthTest=n
}else t.effect instanceof bg.manipulation.GizmoEffect&&this._gizmoItems.forEach(function(e){t.effect.texture=e.material.texture,t.draw(e.plist)});e.modelMatrixStack.pop()}}},{},t)}(bg.scene.Component),f=function(t){function e(t){var n=void 0===arguments[1]||arguments[1];$traceurRuntime.superConstructor(e).call(this,t,n),this._plane=bg.Axis.Y,this._autoPlaneMode=!0}return $traceurRuntime.createClass(e,{get plane(){return this._plane},set plane(t){this._plane=t},get autoPlaneMode(){return this._autoPlaneMode},set autoPlaneMode(t){this._autoPlaneMode=t},get planeAxis(){switch(Math.abs(this.plane)){case bg.Axis.X:return new bg.Vector3(1,0,0);case bg.Axis.Y:return new bg.Vector3(0,1,0);case bg.Axis.Z:return new bg.Vector3(0,0,1)}},get gizmoTransform(){var t=bg.Matrix4.Identity();switch(this.plane){case bg.Axis.X:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),0,0,-1);case bg.Axis.Y:break;case bg.Axis.Z:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),1,0,0);case-bg.Axis.X:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),0,0,1);case-bg.Axis.Y:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(180),0,-1,0);case-bg.Axis.Z:return bg.Matrix4.Rotation(bg.Math.degreesToRadians(90),-1,0,0)}return t},clone:function(){var t=new e(this._gizmoPath);return t.offset.assign(this._offset),t.visible=this._visible,t},init:function(){$traceurRuntime.superGet(this,e.prototype,"init").call(this),this._gizmoP=bg.Matrix4.Translation(this.transform.matrix.position)},display:function(t,n){this._gizmoItems&&this.visible&&(this.autoPlaneMode&&s(this,n),$traceurRuntime.superGet(this,e.prototype,"display").call(this,t,n))},beginDrag:function(t,e){this._lastPickPoint=null},drag:function(t,e,n,i){if(this.transform){var s=new bg.physics.Plane(this.planeAxis),o=bg.physics.Ray.RayWithScreenPoint(n,i.projection,i.viewMatrix,i.viewport),u=bg.physics.Intersection.RayToPlane(o,s);if(u.intersects()){var l=new bg.Matrix4(this.transform.matrix);switch(this._gizmoP=bg.Matrix4.Translation(this.transform.matrix.position),t){case bg.manipulation.GizmoAction.TRANSLATE:l=r(this,u);break;case bg.manipulation.GizmoAction.ROTATE:l=a(this,u,!1);break;case bg.manipulation.GizmoAction.ROTATE_FINE:l=a(this,u,!0)}this.transform.matrix=l}}},endDrag:function(t){this._lastPickPoint=null}},{},t)}(h);bg.scene.registerComponent(bg.manipulation,h,"bg.manipulation.Gizmo"),bg.scene.registerComponent(bg.manipulation,f,"bg.manipulation.Gizmo")}(),function(){function t(){e[bg.webgl1.EngineId]={vertex:"\n\t\t\tattribute vec3 inVertex;\n\t\t\t\n\t\t\tuniform mat4 inModelMatrix;\n\t\t\tuniform mat4 inViewMatrix;\n\t\t\tuniform mat4 inProjectionMatrix;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t}\n\t\t\t",fragment:"\n\t\t\tprecision highp float;\n\t\t\t\n\t\t\tuniform vec4 inColorId;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = inColorId;\n\t\t\t}\n\t\t\t"}}var e={},n=function(n){function i(e){$traceurRuntime.superConstructor(i).call(this,e),t()}return $traceurRuntime.createClass(i,{get inputVars(){return{vertex:"inVertex"}},set matrixState(t){this._matrixState=t},get matrixState(){return this._matrixState},set pickId(t){this._pickId=t},get pickId(){return this._pickId||bg.Color.Transparent()},get shader(){return this._shader||(this._shader=new bg.base.Shader(this.context),this._shader.addShaderSource(bg.base.ShaderType.VERTEX,e[bg.webgl1.EngineId].vertex),this._shader.addShaderSource(bg.base.ShaderType.FRAGMENT,e[bg.webgl1.EngineId].fragment),this._shader.link(),this._shader.status?this._shader.initVars(["inVertex"],["inModelMatrix","inViewMatrix","inProjectionMatrix","inColorId"]):(console.log(this._shader.compileError),console.log(this._shader.linkError))),this._shader},setupVars:function(){this.shader.setMatrix4("inModelMatrix",this.matrixState.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",new bg.Matrix4(this.matrixState.viewMatrixStack.matrixConst)),this.shader.setMatrix4("inProjectionMatrix",this.matrixState.projectionMatrixStack.matrixConst),this.shader.setVector4("inColorId",this.pickId)}},{},n)}(bg.base.Effect);bg.manipulation.ColorPickEffect=n;var i=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),this._target=t}return $traceurRuntime.createClass(e,{get target(){return this._target},set target(t){this._target=t,this._result=null},get result(){return this._result},visit:function(t){var e=t.component("bg.manipulation.Selectable"),n=t.component("bg.manipulation.Gizmo");n&&!n.visible&&(n=null),this._result=this._result||e&&e.findId(this.target)||n&&n.findId(this.target)}},{},t)}(bg.scene.NodeVisitor);bg.manipulation.FindPickIdVisitor=i;var r=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline||(this._pipeline=new bg.base.Pipeline(this.context),this._pipeline.effect=new n(this.context),this._renderSurface=new bg.base.TextureSurface(this.context),this._renderSurface.create(),this._pipeline.renderSurface=this._renderSurface,this._pipeline.clearColor=new bg.Color(0,0,0,0)),this._pipeline},get matrixState(){return this._matrixState||(this._matrixState=new bg.base.MatrixState),this._matrixState},get drawVisitor(){return this._drawVisitor||(this._drawVisitor=new bg.scene.DrawVisitor(this.pipeline,this.matrixState)),this._drawVisitor},pick:function(t,e,n){var r=bg.base.Pipeline.Current(),a=bg.base.MatrixState.Current();bg.base.Pipeline.SetCurrent(this.pipeline),bg.base.MatrixState.SetCurrent(this.matrixState),this.pipeline.viewport=e.viewport,this.pipeline.effect.matrixState=this.matrixState,this.pipeline.clearBuffers(bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH),this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix);var s=this.pipeline.opacityLayer;this.pipeline.opacityLayer=bg.base.OpacityLayer.SELECTION,t.accept(this.drawVisitor),this.pipeline.opacityLayer=bg.base.OpacityLayer.GIZMOS,t.accept(this.drawVisitor),this.pipeline.opacityLayer=s;var o=this.pipeline.renderSurface.readBuffer(new bg.Viewport(n.x,n.y,1,1)),u={r:o[3],g:o[2],b:o[1],a:o[0]},l=new i(u);return t.accept(l),r&&bg.base.Pipeline.SetCurrent(r),a&&bg.base.MatrixState.SetCurrent(a),l.result}},{},t)}(bg.app.ContextObject);bg.manipulation.MousePicker=r}(),function(){function t(){255==a?(a=0,e()):++a}function e(){255==s?(s=0,n()):++s}function n(){255==o?(o=0,i()):++o}function i(){255==u?(u=0,bg.log("WARNING: Maximum number of picker identifier reached.")):++u}function r(){return t(),{r:a,g:s,b:s,a:u}}var a=0,s=0,o=0,u=0,l=!1;bg.manipulation.SelectableType={PLIST:1,GIZMO:2};var c=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this._initialized=!1,this._selectablePlist=[]}return $traceurRuntime.createClass(e,{clone:function(){return new e},buildIdentifier:function(){this._initialized=!1,this._selectablePlist=[]},findId:function(t){var e=null;return this._selectablePlist.some(function(n){if(n.id.r==t.r&&n.id.g==t.g&&n.id.b==t.b&&n.id.a==t.a)return e=n,!0}),e},frame:function(t){var e=this;!this._initialized&&this.drawable&&(this.drawable.forEach(function(t,n){var i=r();e._selectablePlist.push({id:i,type:bg.manipulation.SelectableType.PLIST,plist:t,material:n,drawable:e.drawable,node:e.node})}),this._initialized=!0)},display:function(t,e){t.effect instanceof bg.manipulation.ColorPickEffect&&t.opacityLayer&bg.base.OpacityLayer.SELECTION&&this._selectablePlist.forEach(function(e){t.effect.pickId=new bg.Color(e.id.a/255,e.id.b/255,e.id.g/255,e.id.r/255),t.draw(e.plist)})}},{SetSelectMode:function(t){l=t},GetIdentifier:function(){return r()}},t)}(bg.scene.Component);bg.scene.registerComponent(bg.manipulation,c,"bg.manipulation.Selectable")}(),function(){function t(t){var n=bg.app.Mouse.LeftButton(),i=bg.app.Mouse.MiddleButton(),r=bg.app.Mouse.RightButton();switch(!0){case n==t._rotateButtons.left&&i==t._rotateButtons.middle&&r==t._rotateButtons.right:return e.ROTATE;case n==t._panButtons.left&&i==t._panButtons.middle&&r==t._panButtons.right:return e.PAN;case n==t._zoomButtons.left&&i==t._zoomButtons.middle&&r==t._zoomButtons.right:return e.ZOOM}}var e={ROTATE:0,PAN:1,ZOOM:2},n=function(n){function i(){$traceurRuntime.superConstructor(i).call(this),this._rotateButtons={left:!0,middle:!1,right:!1},this._panButtons={left:!1,middle:!1,right:!0},this._zoomButtons={left:!1,middle:!0,right:!1},this._rotation=new bg.Vector2,this._distance=5,this._center=new bg.Vector3,this._rotationSpeed=.2,this._forward=0,this._left=0,this._wheelSpeed=1,this._minFocus=2,this._minPitch=.1,this._maxPitch=85,this._minDistance=.4,this._maxDistance=24,this._maxX=15,this._minX=-15,this._minY=.1,this._maxY=2,this._maxZ=15,this._minZ=-15}return $traceurRuntime.createClass(i,{setRotateButtons:function(t,e,n){this._rotateButtons={left:t,middle:e,right:n}},setPanButtons:function(t,e,n){this._panButtons={left:t,middle:e,right:n}},setZoomButtons:function(t,e,n){this._zoomButtons={left:t,middle:e,right:n}},get rotation(){return this._rotation},set rotation(t){this._rotation=t},get distance(){return this._distance},set distance(t){this._distance=t},get center(){return this._center},set center(t){this._center=t},get whellSpeed(){this._wheelSpeed},set wheelSpeed(t){this._wheelSpeed=t},get minCameraFocus(){return this._minFocus},set minCameraFocus(t){this._minFocus=t},get minPitch(){return this._minPitch},set minPitch(t){this._minPitch=t},get maxPitch(){return this._maxPitch},set maxPitch(t){this._maxPitch=t},get minDistance(){return this._minDistance},set minDistance(t){this._minDistance=t},get maxDistance(){return this._maxDistance},set maxDistance(t){this._maxDistance=t},frame:function(t){if(this.transform){var e=this.transform.matrix.forwardVector,n=this.transform.matrix.leftVector;e.scale(this._forward),n.scale(this._left),this._center.add(e).add(n);var i=this._rotation.x>this._minPitch?this._rotation.x:this._minPitch;i=i<this._maxPitch?i:this._maxPitch,this._rotation.x=i,this._distance=this._distance>this._minDistance?this._distance:this._minDistance,this._distance=this._distance<this._maxDistance?this._distance:this._maxDistance,this._center.x<this._minX?this._center.x=this._minX:this._center.x>this._maxX&&(this._center.x=this._maxX),this._center.y<this._minY?this._center.y=this._minY:this._center.y>this._maxY&&(this._center.y=this._maxY),this._center.z<this._minZ?this._center.z=this._minZ:this._center.z>this._maxZ&&(this._center.z=this._maxZ),this.transform.matrix.identity().translate(this._center).rotate(bg.Math.degreesToRadians(this._rotation.y),0,1,0).rotate(bg.Math.degreesToRadians(i),-1,0,0).translate(0,0,this._distance)}this.camera&&(this.camera.focus=this._distance>this._minFocus?this._distance:this._minFocus)},mouseDown:function(t){this._lastPos=new bg.Vector2(t.x,t.y)},mouseDrag:function(n){if(this.transform&&this._lastPos){var i=new bg.Vector2(this._lastPos.y-n.y,this._lastPos.x-n.x);switch(this._lastPos.set(n.x,n.y),t(this)){case e.ROTATE:i.x=-1*i.x,this._rotation.add(i.scale(.5));break;case e.PAN:var r=this.transform.matrix.upVector,a=this.transform.matrix.leftVector;r.scale(-.001*i.x*this._distance),a.scale(-.001*i.y*this._distance),this._center.add(r).add(a);break;case e.ZOOM:this._distance+=.01*i.x*this._distance}}},mouseWheel:function(t){var e=this._distance>.01?this._distance:.01;this._distance+=.001*t.delta*e*this._wheelSpeed},touchStart:function(t){this._lastTouch=t.touches},touchMove:function(t){if(this._lastTouch.length==t.touches.length&&this.transform)if(1==this._lastTouch.length){var e=this._lastTouch[0],n=t.touches[0],i=new bg.Vector2(-1*(e.y-n.y),e.x-n.x);this._rotation.add(i.scale(.5))}else if(2==this._lastTouch.length){var r=this._lastTouch[0],a=this._lastTouch[1],s=null,o=null;t.touches.forEach(function(t){t.identifier==r.identifier?s=t:t.identifier==a.identifier&&(o=t)});var u=Math.round(new bg.Vector2(r.x,r.y).sub(new bg.Vector3(a.x,a.y)).magnitude()),l=Math.round(new bg.Vector2(s.x,s.y).sub(new bg.Vector3(o.x,o.y)).magnitude()),c=new bg.Vector2(r.y-s.y,a.x-o.x),h=this.transform.matrix.upVector,f=this.transform.matrix.leftVector;h.scale(-.001*c.x*this._distance),f.scale(-.001*c.y*this._distance),this._center.add(h).add(f),this._distance+=.005*(u-l)*this._distance}this._lastTouch=t.touches}},{},n)}(bg.scene.Component),i=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{},{},t)}(bg.scene.Component),r=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{},{},t)}(bg.scene.Component);bg.scene.registerComponent(bg.manipulation,n,"bg.manipulation.OrbitCameraController"),bg.scene.registerComponent(bg.manipulation,i,"bg.manipulation.FPSCameraController"),bg.scene.registerComponent(bg.manipulation,r,"bg.manipulation.TargetCameraController")}(),bg.tools={},function(){var t=function(){function t(t,e){this._min=new bg.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._max=new bg.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._center=null,this._size=null,this._halfSize=null,this._vertexArray=[],e=e||bg.Matrix4.Identity(),t instanceof bg.scene.Drawable?this.addDrawable(t,e):t instanceof bg.scene.PolyList&&this.addPolyList(t,e)}return $traceurRuntime.createClass(t,{clear:function(){this._min=bg.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._max=bg.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._center=this._size=this._halfSize=null},get min(){return this._min},get max(){return this._max},get center(){if(!this._center){this.halfSize;this._center=bg.Vector3.Add(this.halfSize,this._min)}return this._center},get size(){return this._size||(this._size=bg.Vector3.Sub(this.max,this.min)),this._size},get halfSize(){return this._halfSize||(this._halfSize=new bg.Vector3(this.size),this._halfSize.scale(.5)),this._halfSize},addPolyList:function(t,e){this._center=this._size=this._halfSize=null;for(var n=0;n<t.vertex.length;n+=3){var i=e.multVector(new bg.Vector3(t.vertex[n],t.vertex[n+1],t.vertex[n+2]));i.x<this._min.x&&(this._min.x=i.x),i.y<this._min.y&&(this._min.y=i.y),i.z<this._min.z&&(this._min.z=i.z),i.x>this._max.x&&(this._max.x=i.x),i.z>this._max.z&&(this._max.z=i.z),i.y>this._max.y&&(this._max.y=i.y)}},addDrawable:function(t,e){var n=this;t.forEach(function(t,i,r){var a=new bg.Matrix4(e);r&&a.mult(r),n.addPolyList(t,a)})}},{})}();bg.tools.BoundingBox=t}(),bg.render={},function(){var t=function(t){function e(t){var n=void 0!==arguments[1]?arguments[1]:bg.base.OpacityLayer.ALL;$traceurRuntime.superConstructor(e).call(this,t),this._pipeline=new bg.base.Pipeline(t),this._pipeline.opacityLayer=n,this._matrixState=bg.base.MatrixState.Current(),this._drawVisitor=new bg.scene.DrawVisitor(this._pipeline,this._matrixState),this._settings={}}return $traceurRuntime.createClass(e,{get pipeline(){return this._pipeline},get opacityLayer(){return this._pipeline.opacityLayer},get drawVisitor(){return this._drawVisitor},get matrixState(){return this._matrixState},set settings(t){this._settings=t},get settings(){return this._settings},draw:function(t,e){}},{},t)}(bg.app.ContextObject);bg.render.RenderLayer=t}(),function(){bg.render.RenderPath={FORWARD:1,DEFERRED:2},bg.render.RaytracerQuality={low:{maxSamples:20,rayIncrement:.05},mid:{maxSamples:50,rayIncrement:.025},high:{maxSamples:100,rayIncrement:.0125},extreme:{maxSamples:200,rayIncrement:.0062}};var t={debug:{enabled:!1},ambientOcclusion:{enabled:!0,sampleRadius:.4,kernelSize:16,blur:2,maxDistance:300},raytracer:{enabled:!0,quality:bg.render.RaytracerQuality.mid}},e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e),this._frameVisitor=new bg.scene.FrameVisitor,this._settings=t,this._clearColor=bg.Color.Black()}return $traceurRuntime.createClass(n,{get isSupported(){return!1},create:function(){console.log("ERROR: Error creating renderer. The renderer class must implemente the create() method.")},get clearColor(){return this._clearColor},set clearColor(t){this._clearColor=t},frame:function(t,e){this._frameVisitor.delta=e,t.accept(this._frameVisitor)},display:function(t,e){this.draw(t,e)},get settings(){return this._settings}},{Create:function(t,e){var n=null;if(e==bg.render.RenderPath.DEFERRED&&(n=new bg.render.DeferredRenderer(t)),(e==bg.render.RenderPath.FORWARD||n&&!n.isSupported)&&(n=new bg.render.ForwardRenderer(t)),!n.isSupported)throw new Error("No suitable renderer found.");return n.create(),n}},e)}(bg.app.ContextObject);bg.render.Renderer=e}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inLighting",dataType:"sampler2D",role:"value"},{name:"inDiffuse",dataType:"sampler2D",role:"value"},{name:"inPositionMap",dataType:"sampler2D",role:"value"},{name:"inSSAO",dataType:"sampler2D",role:"value"},{name:"inReflection",dataType:"sampler2D",role:"value"},{name:"inMaterial",dataType:"sampler2D",role:"value"},{name:"inOpaqueDepthMap",dataType:"sampler2D",role:"value"},{name:"inViewSize",dataType:"vec2",role:"value"},{name:"inSSAOBlur",dataType:"int",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&(this._fragmentShaderSource.addFunction(t().functions.blur.blur),this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tvec4 lighting = texture2D(inLighting,fsTexCoord);\n\t\t\t\t\tvec4 diffuse = texture2D(inDiffuse,fsTexCoord);\n\t\t\t\t\tvec4 pos = texture2D(inPositionMap,fsTexCoord);\n\t\t\t\t\tvec4 ssao = blur(inSSAO,fsTexCoord,inSSAOBlur,inViewSize);\n\t\t\t\t\tvec4 reflect = texture2D(inReflection,fsTexCoord);\n\t\t\t\t\tvec4 material = texture2D(inMaterial,fsTexCoord);\n\t\t\t\t\tvec4 opaqueDepth = texture2D(inOpaqueDepthMap,fsTexCoord);\n\t\t\t\t\tif (pos.z<opaqueDepth.z && opaqueDepth.w<1.0) {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfloat reflectionAmount = material.b;\n\t\t\t\t\t\tvec3 finalColor = lighting.rgb * (1.0 - reflectionAmount);\n\t\t\t\t\t\tfinalColor += reflect.rgb * reflectionAmount;\n\t\t\t\t\t\tfinalColor *= ssao.rgb;\n\t\t\t\t\t\tgl_FragColor = vec4(finalColor,diffuse.a);\n\t\t\t\t\t}"))),this._fragmentShaderSource},setupVars:function(){this.shader.setVector2("inViewSize",new bg.Vector2(this.viewport.width,this.viewport.height)),this.shader.setTexture("inLighting",this._surface.lightingMap,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inDiffuse",this._surface.diffuseMap,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inPositionMap",this._surface.positionMap,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inSSAO",this._surface.ssaoMap,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inReflection",this._surface.reflectionMap,bg.base.TextureUnit.TEXTURE_4),this.shader.setTexture("inMaterial",this._surface.materialMap,bg.base.TextureUnit.TEXTURE_5),this.shader.setTexture("inOpaqueDepthMap",this._surface.opaqueDepthMap,bg.base.TextureUnit.TEXTURE_6),this.shader.setValueInt("inSSAOBlur",this.ssaoBlur)},set viewport(t){this._viewport=t},get viewport(){return this._viewport},set clearColor(t){this._clearColor=t},get clearColor(){return this._clearColor},set ssaoBlur(t){this._ssaoBlur=t},get ssaoBlur(){return this._ssaoBlur},get colorCorrection(){return this._colorCorrection||(this._colorCorrection={hue:1,saturation:1,lightness:1,brightness:.5,contrast:.5}),this._colorCorrection}},{},e)}(bg.base.TextureEffect);bg.render.DeferredMixEffect=e}(),function(){function t(t,e,n,i){var r=new bg.base.Pipeline(t);return r.renderSurface=n,void 0!==i?(r.opacityLayer=i,r.effect=e):r.textureEffect=e,r}function e(e){var n=e.context,i=e._surfaces,r=e._opacityLayer;e._gbufferUbyte=t(n,new bg.render.GBufferEffect(n),i.gbufferUByteSurface,r),e._gbufferFloat=t(n,new bg.render.PositionGBufferEffect(n),i.gbufferFloatSurface,r),e._shadow=t(n,new bg.render.ShadowEffect(n),i.shadowSurface,bg.base.OpacityLayer.ALL),e._lighting=t(n,new bg.render.LightingEffect(n),i.lightingSurface),e._ssao=t(n,new bg.render.SSAOEffect(n),i.ssaoSurface),e._ssao.clearColor=bg.Color.White(),e._ssrt=t(n,new bg.render.SSRTEffect(n),i.ssrtSurface);var a=e.matrixState;e.ubyteVisitor=new bg.scene.DrawVisitor(e._gbufferUbyte,a),e.floatVisitor=new bg.scene.DrawVisitor(e._gbufferFloat,a),e.shadowVisitor=new bg.scene.DrawVisitor(e._shadow,a),e._mix=t(n,new bg.render.DeferredMixEffect(n),i.mixSurface)}bg.render.SurfaceType={UNDEFINED:0,OPAQUE:1,TRANSPARENT:2};var n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._type=bg.render.SurfaceType.UNDEFINED,this._gbufferUByteSurface=null,this._gbufferFloatSurface=null,this._lightingSurface=null,this._shadowSurface=null,this._ssaoSurface=null,this._mixSurface=null,this._ssrtSurface=null,this._opaqueSurfaces=null}return $traceurRuntime.createClass(e,{createOpaqueSurfaces:function(){this._type=bg.render.SurfaceType.OPAQUE,this.createCommon()},createTransparentSurfaces:function(t){this._type=bg.render.SurfaceType.TRANSPARENT,this._opaqueSurfaces=t,this.createCommon()},resize:function(t){var e=new bg.Vector2(t.width,t.height);this._gbufferUByteSurface.size=e,this._gbufferFloatSurface.size=e,this._lightingSurface.size=e,this._shadowSurface.size=e,this._ssaoSurface.size=e,this._ssrtSurface.size=e,this._mixSurface.size=e},get type(){return this._type},get gbufferUByteSurface(){return this._gbufferUByteSurface},get gbufferFloatSurface(){return this._gbufferFloatSurface},get lightingSurface(){return this._lightingSurface},get shadowSurface(){return this._shadowSurface},get ssaoSurface(){return this._ssaoSurface},get ssrtSurface(){return this._ssrtSurface},get mixSurface(){return this._mixSurface},get diffuse(){return this._gbufferUByteSurface.getTexture(0)},get specular(){return this._gbufferUByteSurface.getTexture(1)},get normal(){return this._gbufferUByteSurface.getTexture(2)},get material(){return this._gbufferUByteSurface.getTexture(3)},get position(){return this._gbufferFloatSurface.getTexture(0)},get lighting(){return this._lightingSurface.getTexture()},get shadow(){return this._shadowSurface.getTexture()},get ambientOcclusion(){return this._ssaoSurface.getTexture()},get reflection(){return this._ssrtSurface.getTexture()},get mix(){return this._mixSurface.getTexture()},get reflectionColor(){return this._type==bg.render.SurfaceType.OPAQUE?this.lighting:this._opaqueSurfaces.lighting},get reflectionDepth(){return this._type==bg.render.SurfaceType.OPAQUE?this.position:this._opaqueSurfaces.position},get mixDepthMap(){return this._type==bg.render.SurfaceType.OPAQUE?this.position:this._opaqueSurfaces.position},createCommon:function(){var t=this.context;this._gbufferUByteSurface=new bg.base.TextureSurface(t),this._gbufferUByteSurface.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._gbufferUByteSurface.resizeOnViewportChanged=!1,this._gbufferFloatSurface=new bg.base.TextureSurface(t),this._gbufferFloatSurface.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.FLOAT},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._gbufferFloatSurface.resizeOnViewportChanged=!1,this._lightingSurface=new bg.base.TextureSurface(t),this._lightingSurface.create(),this._lightingSurface.resizeOnViewportChanged=!1,this._shadowSurface=new bg.base.TextureSurface(t),this._shadowSurface.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._shadowSurface.resizeOnViewportChanged=!1,this._ssaoSurface=new bg.base.TextureSurface(t),this._ssaoSurface.create(),this._ssaoSurface.resizeOnViewportChanged=!1,this._ssrtSurface=new bg.base.TextureSurface(t),this._ssrtSurface.create(),this._ssrtSurface.resizeOnViewportChanged=!1,this._mixSurface=new bg.base.TextureSurface(t),this._mixSurface.create(),this._mixSurface.resizeOnViewportChanged=!1}},{},t)}(bg.app.ContextObject);bg.render.DeferredRenderSurfaces=n;var i=function(t){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{createOpaque:function(){this._opacityLayer=bg.base.OpacityLayer.OPAQUE,this._surfaces=new bg.render.DeferredRenderSurfaces(this.context),this._surfaces.createOpaqueSurfaces(),e(this)},createTransparent:function(t){this._opacityLayer=bg.base.OpacityLayer.TRANSPARENT,this._surfaces=new bg.render.DeferredRenderSurfaces(this.context),this._surfaces.createTransparentSurfaces(t),e(this),this._gbufferUbyte.blend=!0,this._gbufferUbyte.setBlendMode=bg.base.BlendMode.NORMAL,this._gbufferUbyte.clearColor=bg.Color.Transparent(),this._lighting.clearColor=bg.Color.Black(),this.pipeline.clearColor=bg.Color.Transparent()},set shadowMap(t){this._shadowMap=t},get shadowMap(){return this._shadowMap},get pipeline(){return this._mix},get texture(){return this.maps.mix},draw:function(t,e){this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix),this.matrixState.modelMatrixStack.identity(),this.performDraw(t,e)},get maps(){return this._surfaces},resize:function(t){var e=t.viewport;this.maps.resize(new bg.Size2D(e.width,e.height))},performDraw:function(t,e){var n=this;bg.base.Pipeline.SetCurrent(this._gbufferUbyte),this._gbufferUbyte.viewport=e.viewport,this._gbufferUbyte.clearBuffers(),t.accept(this.ubyteVisitor),bg.base.Pipeline.SetCurrent(this._gbufferFloat),this._gbufferFloat.viewport=e.viewport,this._gbufferFloat.clearBuffers(),t.accept(this.floatVisitor),this._lighting.viewport=e.viewport,this._lighting.clearcolor=bg.Color.White(),this._shadow.viewport=e.viewport,bg.scene.Light.GetActiveLights().forEach(function(i){i.light&&i.light.enabled&&i.node&&i.node.enabled&&(i.light.type!=bg.base.LightType.DIRECTIONAL&&i.light.type!=bg.base.LightType.SPOT||(n._shadowMap.update(t,e,i.light,i.transform),bg.base.Pipeline.SetCurrent(n._shadow),n._shadow.viewport=e.viewport,n._shadow.clearBuffers(),n._shadow.effect.light=i.light,n._shadow.effect.shadowMap=n._shadowMap,t.accept(n.shadowVisitor)),bg.base.Pipeline.SetCurrent(n._lighting),n._lighting.textureEffect.light=i.light,n._lighting.textureEffect.lightTransform=i.transform,n._lighting.textureEffect.shadowMap=n.maps.shadow,n._lighting.drawTexture(n.maps))});var i=this.settings.ambientOcclusion.enabled,r=this.settings.raytracer.enabled,a=new bg.Viewport(e.viewport);if(this._ssao.textureEffect.enabled=i,this._ssao.textureEffect.settings.kernelSize=this.settings.ambientOcclusion.kernelSize,this._ssao.textureEffect.settings.sampleRadius=this.settings.ambientOcclusion.sampleRadius,this._ssao.textureEffect.settings.maxDistance=this.settings.ambientOcclusion.maxDistance,i&&(bg.base.Pipeline.SetCurrent(this._ssao),this._ssao.viewport=e.viewport,this._ssao.clearBuffers(),this._ssao.textureEffect.viewport=e.viewport,this._ssao.textureEffect.projectionMatrix=e.projection,this._ssao.drawTexture(this.maps)),bg.base.Pipeline.SetCurrent(this._ssrt),r){this._ssrt.viewport=a,this._ssrt.clearBuffers(),this._ssrt.textureEffect.quality=this.settings.raytracer.quality;var s=e.node.component("bg.scene.Transform");if(s){var o=new bg.Matrix4(e.projection);o.mult(e.viewMatrix),this._ssrt.textureEffect.cameraPosition=o.multVector(s.matrix.position).xyz}this._ssrt.textureEffect.projectionMatrix=e.projection,this._ssrt.drawTexture(this.maps)}bg.base.Pipeline.SetCurrent(this.pipeline),this.pipeline.viewport=e.viewport,this.pipeline.clearBuffers(),this.pipeline.textureEffect.viewport=e.viewport,this.pipeline.textureEffect.ssaoBlur=i?this.settings.ambientOcclusion.blur:1,this.pipeline.drawTexture({lightingMap:this.maps.lighting,diffuseMap:this.maps.diffuse,positionMap:this.maps.position,ssaoMap:i?this.maps.ambientOcclusion:bg.base.TextureCache.WhiteTexture(this.context),reflectionMap:r?this.maps.reflection:this.maps.lighting,materialMap:this.maps.material,opaqueDepthMap:this.maps.mixDepthMap})}},{},t)}(bg.render.RenderLayer);bg.render.DeferredRenderLayer=i}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t),this._size=new bg.Size2D(0)}return $traceurRuntime.createClass(e,{get isSupported(){return bg.base.RenderSurface.MaxColorAttachments()>5&&bg.base.RenderSurface.SupportFormat(bg.base.RenderSurfaceFormat.FLOAT)&&bg.base.RenderSurface.SupportType(bg.base.RenderSurfaceType.DEPTH)},get pipeline(){return this._pipeline},create:function(){var t=this.context;this._opaqueLayer=new bg.render.DeferredRenderLayer(t),this._opaqueLayer.settings=this.settings,this._opaqueLayer.createOpaque(),this._transparentLayer=new bg.render.DeferredRenderLayer(t),this._transparentLayer.settings=this.settings,this._transparentLayer.createTransparent(this._opaqueLayer.maps),this._shadowMap=new bg.base.ShadowMap(t),this._shadowMap.size=new bg.Vector2(2048),this._opaqueLayer.shadowMap=this._shadowMap,this._transparentLayer.shadowMap=this._shadowMap,this._pipeline=new bg.base.Pipeline(t),this._pipeline.textureEffect=new bg.render.RendererMixEffect(t)},draw:function(t,e){this._size.width==e.viewport.width&&this._size.height==e.viewport.height||(this._opaqueLayer.resize(e),this._transparentLayer.resize(e)),this._opaqueLayer.draw(t,e),this._transparentLayer.draw(t,e),bg.base.Pipeline.SetCurrent(this.pipeline),this.pipeline.viewport=e.viewport,this.pipeline.clearBuffers(),this.pipeline.drawTexture({opaque:this._opaqueLayer.texture,transparent:this._transparentLayer.texture,transparentNormal:this._transparentLayer.maps.normal,opaqueDepth:this._opaqueLayer.maps.position,transparentDepth:this._transparentLayer.maps.position})}},{},t)}(bg.render.Renderer);bg.render.DeferredRenderer=t}(),function(){var t=function(t){function e(t,n){$traceurRuntime.superConstructor(e).call(this,t,n),this._pipeline.effect=new bg.base.ForwardEffect(t),this._pipeline.opacityLayer=n,this._lightComponent=null,n==bg.base.OpacityLayer.TRANSPARENT&&(this._pipeline.buffersToClear=bg.base.ClearBuffers.NONE,this._pipeline.blend=!0,this._pipeline.blendMode=bg.base.BlendMode.NORMAL)}return $traceurRuntime.createClass(e,{set lightComponent(t){this._lightComponent=t},get lightComponent(){return this._lightComponent},set shadowMap(t){this._shadowMap=t},get shadowMap(){return this._shadowMap},draw:function(t,e){bg.base.Pipeline.SetCurrent(this._pipeline),this._pipeline.viewport=e.viewport,0!=e.clearBuffers&&this._pipeline.clearBuffers(),this.matrixState.projectionMatrixStack.set(e.projection),this.matrixState.viewMatrixStack.set(e.viewMatrix),this.willDraw(t,e),t.accept(this._drawVisitor),this.performDraw(t,e)},willDraw:function(t,e){this._lightComponent&&(this._pipeline.effect.light=this._lightComponent.light,this._pipeline.effect.lightTransform=this._lightComponent.transform,this._pipeline.effect.shadowMap=this._shadowMap)},performDraw:function(t,e){this._pipeline.viewport=e.viewport,t.accept(this.drawVisitor)}},{},t)}(bg.render.RenderLayer);bg.render.ForwardRenderLayer=t}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get isSupported(){return!0},create:function(){var t=this.context;this._transparentLayer=new bg.render.ForwardRenderLayer(t,bg.base.OpacityLayer.TRANSPARENT),
this._opaqueLayer=new bg.render.ForwardRenderLayer(t,bg.base.OpacityLayer.OPAQUE),this._shadowMap=new bg.base.ShadowMap(t),this._shadowMap.size=new bg.Vector2(2048)},draw:function(t,e){var n=null;bg.scene.Light.GetActiveLights().some(function(t){if(t.light&&t.light.enabled)return n=t,!0}),n&&(this._shadowMap.update(t,e,n.light,n.transform),this._opaqueLayer.lightComponent=n,this._opaqueLayer.shadowMap=this._shadowMap,this._transparentLayer.lightComponent=n,this._transparentLayer.shadowMap=this._shadowMap),this._opaqueLayer.pipeline.clearColor=this.clearColor,this._opaqueLayer.draw(t,e),this._transparentLayer.draw(t,e)}},{},t)}(bg.render.Renderer);bg.render.ForwardRenderer=t}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=null,n=null,i=null,r=null,a={gbuffer_ubyte_vertex:function(){return e||(e=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),e.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.normal,t().inputs.buffers.tangent,t().inputs.buffers.tex0,t().inputs.buffers.tex1]),e.addParameter(t().inputs.matrix.all),e.addParameter([{name:"fsPosition",dataType:"vec3",role:"out"},{name:"fsTex0Coord",dataType:"vec2",role:"out"},{name:"fsTex1Coord",dataType:"vec2",role:"out"},{name:"fsNormal",dataType:"vec3",role:"out"},{name:"fsTangent",dataType:"vec3",role:"out"},{name:"fsBitangent",dataType:"vec3",role:"out"}]),"webgl1"==bg.Engine.Get().id&&e.setMainBody("\n\t\t\t\t\tvec4 viewPos = inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tgl_Position = inProjectionMatrix * viewPos;\n\t\t\t\t\t\n\t\t\t\t\tfsNormal = normalize((inNormalMatrix  * vec4(inNormal,1.0)).xyz);\n\t\t\t\t\tfsTangent = normalize((inNormalMatrix * vec4(inTangent,1.0)).xyz);\n\t\t\t\t\tfsBitangent = cross(fsNormal,fsTangent);\n\t\t\t\t\t\n\t\t\t\t\tfsTex0Coord = inTex0;\n\t\t\t\t\tfsTex1Coord = inTex1;\n\t\t\t\t\tfsPosition = viewPos.xyz;")),e},gbuffer_ubyte_fragment:function(){return n||(n=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),n.appendHeader("#extension GL_EXT_draw_buffers : require"),n.addParameter([{name:"fsPosition",dataType:"vec3",role:"in"},{name:"fsTex0Coord",dataType:"vec2",role:"in"},{name:"fsTex1Coord",dataType:"vec2",role:"in"},{name:"fsNormal",dataType:"vec3",role:"in"},{name:"fsTangent",dataType:"vec3",role:"in"},{name:"fsBitangent",dataType:"vec3",role:"int"}]),n.addParameter(t().inputs.material.all),n.addFunction(t().functions.materials.all),"webgl1"==bg.Engine.Get().id&&n.setMainBody("\n\t\t\t\t\t\tvec4 lightMap = samplerColor(inLightMap,fsTex1Coord,inLightMapOffset,inLightMapScale);\n\t\t\t\t\t\tvec4 diffuse = samplerColor(inTexture,fsTex0Coord,inTextureOffset,inTextureScale) * inDiffuseColor * lightMap;\n\t\t\t\t\t\tif (diffuse.a>=inAlphaCutoff) {\n\t\t\t\t\t\t\tvec3 normal = samplerNormal(inNormalMap,fsTex0Coord,inNormalMapOffset,inNormalMapScale);\n\t\t\t\t\t\t\tnormal = combineNormalWithMap(fsNormal,fsTangent,fsBitangent,normal);\n\t\t\t\t\t\t\tvec4 specular = specularColor(inSpecularColor,inShininessMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinShininessMaskChannel,inShininessMaskInvert);\n\t\t\t\t\t\t\tfloat lightEmission = applyTextureMask(inLightEmission,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinLightEmissionMaskChannel,inLightEmissionMaskInvert);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfloat reflectionMask = applyTextureMask(inReflection,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinReflectionMask,fsTex0Coord,inTextureOffset,inTextureScale,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinReflectionMaskChannel,inReflectionMaskInvert);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tgl_FragData[0] = diffuse;\n\t\t\t\t\t\t\tgl_FragData[1] = specular;\n\t\t\t\t\t\t\tgl_FragData[2] = vec4(normal * 0.5 + 0.5, 1.0);\n\t\t\t\t\t\t\tgl_FragData[3] = vec4(lightEmission,inShininess/255.0,reflectionMask,float(inCastShadows));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}")),n},gbuffer_float_vertex:function(){return i||(i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,null,t().inputs.matrix.model,t().inputs.matrix.view,t().inputs.matrix.projection,null,{name:"fsPosition",dataType:"vec4",role:"out"},{name:"fsTex0Coord",dataType:"vec2",role:"out"}]),"webgl1"==bg.Engine.Get().id&&i.setMainBody("\n\t\t\t\t\tfsPosition = inViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tfsTex0Coord = inTex0;\n\t\t\t\t\t\n\t\t\t\t\tgl_Position = inProjectionMatrix * fsPosition;")),i},gbuffer_float_fragment:function(){return r||(r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),r.addParameter([t().inputs.material.texture,t().inputs.material.textureScale,t().inputs.material.textureOffset,null,{name:"fsPosition",dataType:"vec4",role:"in"},{name:"fsTex0Coord",dataType:"vec2",role:"in"}]),r.addFunction(t().functions.materials.samplerColor),"webgl1"==bg.Engine.Get().id&&r.setMainBody("\n\t\t\t\t\tfloat alpha = samplerColor(inTexture,fsTex0Coord,inTextureOffset,inTextureScale).a;\n\t\t\t\t\t// TODO: texture alpha\n\t\t\t\t\t// if (a<alphaCutoff....etc)\n\t\t\t\t\t\n\t\t\t\t\tgl_FragColor = vec4(fsPosition.xyz,gl_FragCoord.z);")),r}},s=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t);var n=[a.gbuffer_ubyte_vertex(),a.gbuffer_ubyte_fragment()];this._material=null,this.setupShaderSource(n)}return $traceurRuntime.createClass(e,{get material(){return this._material},set material(t){this._material=t},setupVars:function(){if(this.material){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst),this.shader.setMatrix4("inNormalMatrix",t.normalMatrix),this.shader.setMatrix4("inViewMatrixInv",t.viewMatrixInvert);var n=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context),i=this.material.lightmap||bg.base.TextureCache.WhiteTexture(this.context),r=this.material.normalMap||bg.base.TextureCache.NormalTexture(this.context);this.shader.setVector4("inDiffuseColor",this.material.diffuse),this.shader.setVector4("inSpecularColor",this.material.specular),this.shader.setValueFloat("inShininess",this.material.shininess),this.shader.setValueFloat("inLightEmission",this.material.lightEmission),this.shader.setValueFloat("inAlphaCutoff",this.material.alphaCutoff),this.shader.setTexture("inTexture",n,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setTexture("inLightMap",i,bg.base.TextureUnit.TEXTURE_1),this.shader.setVector2("inLightMapOffset",this.material.lightmapOffset),this.shader.setVector2("inLightMapScale",this.material.lightmapScale),this.shader.setTexture("inNormalMap",r,bg.base.TextureUnit.TEXTURE_2),this.shader.setVector2("inNormalMapScale",this.material.normalMapScale),this.shader.setVector2("inNormalMapOffset",this.material.normalMapOffset);var a=this.material.shininessMask||bg.base.TextureCache.BlackTexture(this.context),s=this.material.lightEmissionMask||bg.base.TextureCache.WhiteTexture(this.context),o=this.material.reflectionMask||bg.base.TextureCache.BlackTexture(this.context);this.shader.setTexture("inShininessMask",a,bg.base.TextureUnit.TEXTURE_3),this.shader.setVector4("inShininessMaskChannel",this.material.shininessMaskChannelVector),this.shader.setValueInt("inShininessMaskInvert",this.material.shininessMaskInvert),this.shader.setTexture("inLightEmissionMask",s,bg.base.TextureUnit.TEXTURE_4),this.shader.setVector4("inLightEmissionMaskChannel",this.material.lightEmissionMaskChannelVector),this.shader.setValueInt("inLightEmissionMaskInvert",this.material.lightEmissionMaskInvert),this.shader.setValueFloat("inReflection",this.material.reflectionAmount),this.shader.setTexture("inReflectionMask",o,bg.base.TextureUnit.TEXTURE_5),this.shader.setVector4("inReflectionMaskChannel",this.material.reflectionMaskChannelVector),this.shader.setValueInt("inReflectionMaskInvert",this.material.reflectionMaskInvert),this.shader.setValueInt("inCastShadows",this.material.castShadows)}}},{},t)}(bg.base.Effect),o=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t);var n=[a.gbuffer_float_vertex(),a.gbuffer_float_fragment()];this._material=null,this.setupShaderSource(n)}return $traceurRuntime.createClass(e,{get material(){return this._material},set material(t){this._material=t},setupVars:function(){if(this.material){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst);var n=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context);this.shader.setTexture("inTexture",n,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale)}}},{},t)}(bg.base.Effect);bg.render.PositionGBufferEffect=o,bg.render.GBufferEffect=s}(),function(){function t(t,e,n,i){bg.base.Pipeline.SetCurrent(t),t.viewport=i.viewport,t.clearBuffers(bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH),n.accept(e)}var e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t),this._pipelines={ubyte:new bg.base.Pipeline(t),float:new bg.base.Pipeline(t)};var e=new bg.base.TextureSurface(t);e.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.UNSIGNED_BYTE},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._pipelines.ubyte.effect=new bg.render.GBufferEffect(t),this._pipelines.ubyte.renderSurface=e;var i=new bg.base.TextureSurface(t);i.create([{type:bg.base.RenderSurfaceType.RGBA,format:bg.base.RenderSurfaceFormat.FLOAT},{type:bg.base.RenderSurfaceType.DEPTH,format:bg.base.RenderSurfaceFormat.RENDERBUFFER}]),this._pipelines.float.effect=new bg.render.PositionGBufferEffect(t),this._pipelines.float.renderSurface=i,this._ubyteDrawVisitor=new bg.scene.DrawVisitor(this._pipelines.ubyte,this._matrixState),this._floatDrawVisitor=new bg.scene.DrawVisitor(this._pipelines.float,this._matrixState)}return $traceurRuntime.createClass(n,{get diffuse(){return this._pipelines.ubyte.renderSurface.getTexture(0)},get specular(){return this._pipelines.ubyte.renderSurface.getTexture(1)},get normal(){return this._pipelines.ubyte.renderSurface.getTexture(2)},get material(){return this._pipelines.ubyte.renderSurface.getTexture(3)},get position(){return this._pipelines.float.renderSurface.getTexture(0)},get shadow(){return this._pipelines.ubyte.renderSurface.getTexture(4)},update:function(e,n){t(this._pipelines.ubyte,this._ubyteDrawVisitor,e,n),t(this._pipelines.float,this._floatDrawVisitor,e,n)}},{},e)}(bg.app.ContextObject);bg.render.GBufferSet=e}(),function(){function t(){return bg.base.ShaderLibrary.Get()}var e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inDiffuse",dataType:"sampler2D",role:"value"},{name:"inSpecular",dataType:"sampler2D",role:"value"},{name:"inNormal",dataType:"sampler2D",role:"value"},{name:"inMaterial",dataType:"sampler2D",role:"value"},{name:"inPosition",dataType:"sampler2D",role:"value"},{name:"inShadowMap",dataType:"sampler2D",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),this._fragmentShaderSource.addParameter(t().inputs.lighting.all),this._fragmentShaderSource.addFunction(t().functions.utils.all),this._fragmentShaderSource.addFunction(t().functions.lighting.all),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tvec4 diffuse = texture2D(inDiffuse,fsTexCoord);\n\t\t\t\t\tvec4 specular = texture2D(inSpecular,fsTexCoord);\n\t\t\t\t\tvec3 normal = texture2D(inNormal,fsTexCoord).xyz * 2.0 - 1.0;\n\t\t\t\t\tvec4 material = texture2D(inMaterial,fsTexCoord);\n\t\t\t\t\tvec4 position = texture2D(inPosition,fsTexCoord);\n\t\t\t\t\t\n\t\t\t\t\tvec4 shadowColor = texture2D(inShadowMap,fsTexCoord);\n\t\t\t\t\tfloat shininess = material.g * 255.0;\n\t\t\t\t\tgl_FragColor = getDirectionalLight(inLightAmbient,inLightDiffuse,inLightSpecular,shininess,\n\t\t\t\t\t\t\t\t\t\t-inLightDirection,position.rgb,normal,diffuse,specular,shadowColor);")),this._fragmentShaderSource},setupVars:function(){if(this.shader.setTexture("inDiffuse",this._surface.diffuse,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inSpecular",this._surface.specular,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inNormal",this._surface.normal,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inMaterial",this._surface.material,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inPosition",this._surface.position,bg.base.TextureUnit.TEXTURE_4),this.shader.setTexture("inShadowMap",this._shadowMap,bg.base.TextureUnit.TEXTURE_5),this.light){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setVector4("inLightAmbient",this._light.ambient),this.shader.setVector4("inLightDiffuse",this._light.diffuse),this.shader.setVector4("inLightSpecular",this._light.specular);var n=e.mult(this._lightTransform).rotation.multVector(this._light.direction).xyz;this.shader.setVector3("inLightDirection",n)}},get light(){return this._light},set light(t){this._light=t},get lightTransform(){return this._lightTransform},set lightTransform(t){this._lightTransform=t},get shadowMap(){return this._shadowMap},set shadowMap(t){this._shadowMap=t}},{},e)}(bg.base.TextureEffect);bg.render.LightingEffect=e}(),function(){var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inOpaque",dataType:"sampler2D",role:"value"},{name:"inTransparent",dataType:"sampler2D",role:"value"},{name:"inTransparentNormal",dataType:"sampler2D",role:"value"},{name:"inOpaqueDepth",dataType:"sampler2D",role:"value"},{name:"inTransparentDepth",dataType:"sampler2D",role:"value"},{name:"inRefractionAmount",dataType:"float",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\t\tvec4 opaque = texture2D(inOpaque,fsTexCoord);\n\t\t\t\t\t\tvec4 transparent = texture2D(inTransparent,fsTexCoord);\n\t\t\t\t\t\tvec3 normal = texture2D(inTransparentNormal,fsTexCoord).rgb * 2.0 - 1.0;\n\t\t\t\t\t\tif (transparent.a>0.0) {\n\t\t\t\t\t\t\tfloat refractionFactor = inRefractionAmount / texture2D(inTransparentDepth,fsTexCoord).z;\n\t\t\t\t\t\t\tvec2 offset = fsTexCoord - normal.xy * refractionFactor;\n\t\t\t\t\t\t\tvec4 opaqueDepth = texture2D(inOpaqueDepth,offset);\n\t\t\t\t\t\t\tvec4 transparentDepth = texture2D(inTransparentDepth,offset);\n\t\t\t\t\t\t\t//if (opaqueDepth.w>transparentDepth.w) {\n\t\t\t\t\t\t\t\topaque = texture2D(inOpaque,offset);\n\t\t\t\t\t\t\t//}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvec3 color = opaque.rgb * (1.0 - transparent.a) + transparent.rgb * transparent.a;\n\t\t\t\t\t\tgl_FragColor = vec4(color, 1.0);\n\t\t\t\t\t\t")),this._fragmentShaderSource},setupVars:function(){this.shader.setTexture("inOpaque",this._surface.opaque,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inTransparent",this._surface.transparent,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inTransparentNormal",this._surface.transparentNormal,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inOpaqueDepth",this._surface.opaqueDepth,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inTransparentDepth",this._surface.transparentDepth,bg.base.TextureUnit.TEXTURE_4),this.shader.setValueFloat("inRefractionAmount",this.settings.refractionAmount)},get settings(){return this._settings||(this._currentKernelSize=0,this._settings={refractionAmount:.01}),this._settings}},{},t)}(bg.base.TextureEffect);bg.render.RendererMixEffect=t}(),function(){function t(){return bg.base.ShaderLibrary.Get()}bg.render.ShadowType={HARD:1,SOFT:2};var e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e);var i=new bg.base.ShaderSource(bg.base.ShaderType.VERTEX),r=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT);i.addParameter([t().inputs.buffers.vertex,t().inputs.buffers.tex0,null,t().inputs.matrix.model,t().inputs.matrix.view,t().inputs.matrix.projection,{name:"inLightProjectionMatrix",dataType:"mat4",role:"value"},{name:"inLightViewMatrix",dataType:"mat4",role:"value"},null,{name:"fsTexCoord",dataType:"vec2",role:"out"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"out"}]),r.addParameter(t().inputs.shadows.all),r.addFunction(t().functions.utils.unpack),r.addFunction(t().functions.lighting.getShadowColor),r.addParameter([t().inputs.material.receiveShadows,t().inputs.material.texture,t().inputs.material.textureOffset,t().inputs.material.textureScale,t().inputs.material.alphaCutoff,null,{name:"fsTexCoord",dataType:"vec2",role:"in"},{name:"fsVertexPosFromLight",dataType:"vec4",role:"in"}]),r.addFunction(t().functions.materials.samplerColor),"webgl1"==bg.Engine.Get().id&&(i.setMainBody("\n\t\t\t\t\tmat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.5, 0.0, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.0, 0.0, 0.5, 0.0,\n\t\t\t\t\t\t\t\t\t\t\t0.5, 0.5, 0.5, 1.0);\n\t\t\t\t\t\n\t\t\t\t\tfsVertexPosFromLight = ScaleMatrix * inLightProjectionMatrix * inLightViewMatrix * inModelMatrix * vec4(inVertex,1.0);\n\t\t\t\t\tfsTexCoord = inTex0;\n\t\t\t\t\t\n\t\t\t\t\tgl_Position = inProjectionMatrix * inViewMatrix * inModelMatrix * vec4(inVertex,1.0);"),r.setMainBody("\n\t\t\t\t\tfloat alpha = samplerColor(inTexture,fsTexCoord,inTextureOffset,inTextureScale).a;\n\t\t\t\t\tif (alpha>inAlphaCutoff) {\n\t\t\t\t\t\tvec4 shadowColor = vec4(1.0);\n\t\t\t\t\t\tif (inReceiveShadows) {\n\t\t\t\t\t\t\tshadowColor = getShadowColor(fsVertexPosFromLight,inShadowMap,inShadowMapSize,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t inShadowType,inShadowStrength,inShadowBias,inShadowColor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tgl_FragColor = shadowColor;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}")),this.setupShaderSource([i,r])}return $traceurRuntime.createClass(n,{beginDraw:function(){if(this.light&&this.shadowMap){var t=bg.base.MatrixState.Current(),e=(new bg.Matrix4(t.viewMatrixStack.matrixConst),this.shadowMap.viewMatrix);this.shader.setMatrix4("inLightProjectionMatrix",this.shadowMap.projection),this.shader.setMatrix4("inLightViewMatrix",e),this.shader.setValueInt("inShadowType",this.shadowMap.shadowType),this.shader.setTexture("inShadowMap",this.shadowMap.texture,bg.base.TextureUnit.TEXTURE_1),this.shader.setVector2("inShadowMapSize",this.shadowMap.size),this.shader.setValueFloat("inShadowStrength",this.light.shadowStrength),this.shader.setVector4("inShadowColor",this.shadowMap.shadowColor),this.shader.setValueFloat("inShadowBias",this.light.shadowBias)}},setupVars:function(){if(this.material&&this.light){var t=bg.base.MatrixState.Current(),e=new bg.Matrix4(t.viewMatrixStack.matrixConst);this.shader.setMatrix4("inModelMatrix",t.modelMatrixStack.matrixConst),this.shader.setMatrix4("inViewMatrix",e),this.shader.setMatrix4("inProjectionMatrix",t.projectionMatrixStack.matrixConst);var n=this.material.texture||bg.base.TextureCache.WhiteTexture(this.context);this.shader.setTexture("inTexture",n,bg.base.TextureUnit.TEXTURE_0),this.shader.setVector2("inTextureOffset",this.material.textureOffset),this.shader.setVector2("inTextureScale",this.material.textureScale),this.shader.setValueFloat("inAlphaCutoff",this.material.alphaCutoff),this.shader.setValueInt("inReceiveShadows",this.material.receiveShadows)}},get material(){return this._material},set material(t){this._material=t},get light(){return this._light},set light(t){this._light=t},get shadowMap(){return this._shadowMap},set shadowMap(t){this._shadowMap=t}},{},e)}(bg.base.Effect);bg.render.ShadowEffect=e}(),function(){var t=64,e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{get fragmentShaderSource(){return this._fragmentShaderSource||(this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT),this._fragmentShaderSource.addParameter([{name:"inViewportSize",dataType:"vec2",role:"value"},{name:"inPositionMap",dataType:"sampler2D",role:"value"},{name:"inNormalMap",dataType:"sampler2D",role:"value"},{name:"inProjectionMatrix",dataType:"mat4",role:"value"},{name:"inRandomMap",dataType:"sampler2D",role:"value"},{name:"inRandomMapSize",dataType:"vec2",role:"value"},{name:"inSampleRadius",dataType:"float",role:"value"},{name:"inKernelOffsets",dataType:"vec3",role:"value",vec:t},{name:"inKernelSize",dataType:"int",role:"value"},{name:"inSSAOColor",dataType:"vec4",role:"value"},{name:"inEnabled",dataType:"bool",role:"value"},{name:"inMaxDistance",dataType:"float",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\tif (!inEnabled) discard;\n\t\t\t\t\telse {\n\t\t\t\t\t\tvec3 normal = texture2D(inNormalMap,fsTexCoord).xyz * 2.0 - 1.0;\n\t\t\t\t\t\tvec4 vertexPos = texture2D(inPositionMap,fsTexCoord);\n\t\t\t\t\t\tif (distance(vertexPos.xyz,vec3(0))>inMaxDistance || vertexPos.w==1.0) {\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tvec2 noiseScale = vec2(inViewportSize.x/inRandomMapSize.x,inViewportSize.y/inRandomMapSize.y);\n\t\t\t\t\t\t\tvec3 randomVector = texture2D(inRandomMap, fsTexCoord * noiseScale).xyz * 2.0 - 1.0;\n\t\t\t\t\t\t\tvec3 tangent = normalize(randomVector - normal * dot(randomVector, normal));\n\t\t\t\t\t\t\tvec3 bitangent = cross(normal,tangent);\n\t\t\t\t\t\t\tmat3 tbn = mat3(tangent, bitangent, normal);\n\n\t\t\t\t\t\t\tfloat occlusion = 0.0;\n\t\t\t\t\t\t\tfor (int i=0; i<"+t+"; ++i) {\n\t\t\t\t\t\t\t\tif (inKernelSize==i) break;\n\t\t\t\t\t\t\t\tvec3 samplePos = tbn * inKernelOffsets[i];\n\t\t\t\t\t\t\t\tsamplePos = samplePos * inSampleRadius + vertexPos.xyz;\n\n\t\t\t\t\t\t\t\tvec4 offset = inProjectionMatrix * vec4(samplePos, 1.0);\t// -w, w\n\t\t\t\t\t\t\t\toffset.xyz /= offset.w;\t// -1, 1\n\t\t\t\t\t\t\t\toffset.xyz = offset.xyz * 0.5 + 0.5;\t// 0, 1\n\n\t\t\t\t\t\t\t\tvec4 sampleRealPos = texture2D(inPositionMap, offset.xy);\n\t\t\t\t\t\t\t\tif (samplePos.z<sampleRealPos.z) {\n\t\t\t\t\t\t\t\t\tfloat dist = distance(vertexPos.xyz, sampleRealPos.xyz);\n\t\t\t\t\t\t\t\t\tocclusion += dist<inSampleRadius ? 1.0:0.0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tocclusion = 1.0 - (occlusion / float(inKernelSize));\n\t\t\t\t\t\t\tgl_FragColor = clamp(vec4(occlusion, occlusion, occlusion, 1.0) + inSSAOColor, 0.0, 1.0);\n\t\t\t\t\t\t\t//gl_FragColor = vec4(1.0, 0.0, 0.0 ,1.0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}")),this._fragmentShaderSource},setupVars:function(){this.settings.kernelSize>t&&(this.settings.kernelSize=t),this.shader.setVector2("inViewportSize",new bg.Vector2(this.viewport.width,this.viewport.height)),this.shader.setTexture("inPositionMap",this._surface.position,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inNormalMap",this._surface.normal,bg.base.TextureUnit.TEXTURE_1),this.shader.setMatrix4("inProjectionMatrix",this.projectionMatrix),this.shader.setTexture("inRandomMap",this.randomMap,bg.base.TextureUnit.TEXTURE_2),this.shader.setVector2("inRandomMapSize",this.randomMap.size),this.shader.setValueFloat("inSampleRadius",this.settings.sampleRadius),this.shader.setVector3Ptr("inKernelOffsets",this.kernelOffsets),this.shader.setValueInt("inKernelSize",this.settings.kernelSize),this.shader.setVector4("inSSAOColor",this.settings.color),this.shader.setValueInt("inEnabled",this.settings.enabled),this.shader.setValueFloat("inMaxDistance",this.settings.maxDistance)},get viewport(){return this._viewport},set viewport(t){this._viewport=t},get projectionMatrix(){return this._projectionMatrix},set projectionMatrix(t){this._projectionMatrix=t},get randomMap(){return this._randomMap||(this._randomMap=bg.base.TextureCache.RandomTexture(this.context)),this._randomMap},set randomMap(t){this._randomMap=t},get settings(){return this._settings||(this._currentKernelSize=0,this._settings={kernelSize:32,sampleRadius:.3,color:bg.Color.Black(),blur:4,maxDistance:100,enabled:!0}),this._settings},get kernelOffsets(){if(this._currentKernelSize!=this.settings.kernelSize){this._kernelOffsets=[];for(var t=0;t<3*this.settings.kernelSize;t+=3){var e=new bg.Vector3(2*bg.Math.random()-1,2*bg.Math.random()-1,bg.Math.random());e.normalize();var n=t/3/this.settings.kernelSize;n=bg.Math.lerp(.1,1,n*n),e.scale(n),this._kernelOffsets.push(e.x),this._kernelOffsets.push(e.y),this._kernelOffsets.push(e.z)}this._currentKernelSize=this.settings.kernelSize}return this._kernelOffsets}},{},e)}(bg.base.TextureEffect);bg.render.SSAOEffect=e}(),function(){bg.render.RaytracerQuality={low:{maxSamples:20,rayIncrement:.05},mid:{maxSamples:50,rayIncrement:.025},high:{maxSamples:100,rayIncrement:.0125},extreme:{maxSamples:200,rayIncrement:.0062}};var t=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{get fragmentShaderSource(){if(!this._fragmentShaderSource){this._fragmentShaderSource=new bg.base.ShaderSource(bg.base.ShaderType.FRAGMENT);var t=this.quality;this._fragmentShaderSource.addParameter([{name:"inPositionMap",dataType:"sampler2D",role:"value"},{name:"inNormalMap",dataType:"sampler2D",role:"value"},{name:"inLightingMap",dataType:"sampler2D",role:"value"},{name:"inMaterialMap",dataType:"sampler2D",role:"value"},{name:"inSamplePosMap",dataType:"sampler2D",role:"value"},{name:"inProjectionMatrix",dataType:"mat4",role:"value"},{name:"inCameraPos",dataType:"vec3",role:"value"},{name:"fsTexCoord",dataType:"vec2",role:"in"}]),"webgl1"==bg.Engine.Get().id&&this._fragmentShaderSource.setMainBody("\n\t\t\t\t\t\tvec3 normal = texture2D(inNormalMap,fsTexCoord).xyz * 2.0 - 1.0;\n\t\t\t\t\t\tvec4 vertexPos = texture2D(inPositionMap,fsTexCoord);\n\t\t\t\t\t\tvec3 cameraVector = vertexPos.xyz - inCameraPos;\n\t\t\t\t\t\tvec3 rayDirection = reflect(cameraVector,normal);\n\t\t\t\t\t\tvec4 lighting = texture2D(inLightingMap,fsTexCoord);\n\t\t\t\t\t\tvec4 material = texture2D(inMaterialMap,fsTexCoord);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfloat increment = "+t.rayIncrement+";\n\t\t\t\t\t\tvec4 result = vec4(0.0,0.0,0.0,0.0);\n\t\t\t\t\t\tif (material.b>0.0) {\t// material[2] is reflectionAmount\n\t\t\t\t\t\t\tresult = vec4(0.0,0.0,0.0,1.0);\n\t\t\t\t\t\t\tfor (float i=0.0; i<"+t.maxSamples+".0; ++i) {\n\t\t\t\t\t\t\t\tif (i=="+t.maxSamples+".0) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat radius = i * increment;\n\t\t\t\t\t\t\t\tincrement *= 1.01;\n\t\t\t\t\t\t\t\tvec3 ray = vertexPos.xyz + rayDirection * radius;\n\n\t\t\t\t\t\t\t\tvec4 offset = inProjectionMatrix * vec4(ray, 1.0);\t// -w, w\n\t\t\t\t\t\t\t\toffset.xyz /= offset.w;\t// -1, 1\n\t\t\t\t\t\t\t\toffset.xyz = offset.xyz * 0.5 + 0.5;\t// 0, 1\n\n\t\t\t\t\t\t\t\tvec4 rayActualPos = texture2D(inSamplePosMap, offset.xy);\n\t\t\t\t\t\t\t\tfloat hitDistance = rayActualPos.z - ray.z;\n\t\t\t\t\t\t\t\tif (rayActualPos.w<0.6) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (offset.x>1.0 || offset.y>1.0) {\n\t\t\t\t\t\t\t\t\tresult = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (hitDistance>0.02 && hitDistance<0.4) {\n\t\t\t\t\t\t\t\t\tresult = texture2D(inLightingMap,offset.xy);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (result.a==0.0) {\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tgl_FragColor = result;\n\t\t\t\t\t\t}")}return this._fragmentShaderSource},setupVars:function(){this.shader.setTexture("inPositionMap",this._surface.position,bg.base.TextureUnit.TEXTURE_0),this.shader.setTexture("inNormalMap",this._surface.normal,bg.base.TextureUnit.TEXTURE_1),this.shader.setTexture("inLightingMap",this._surface.reflectionColor,bg.base.TextureUnit.TEXTURE_2),this.shader.setTexture("inMaterialMap",this._surface.material,bg.base.TextureUnit.TEXTURE_3),this.shader.setTexture("inSamplePosMap",this._surface.reflectionDepth,bg.base.TextureUnit.TEXTURE_4),this.shader.setMatrix4("inProjectionMatrix",this._projectionMatrix),this.shader.setVector3("inCameraPos",this._cameraPos)},get projectionMatrix(){return this._projectionMatrix},set projectionMatrix(t){this._projectionMatrix=t},get cameraPosition(){return this._cameraPos},set cameraPosition(t){this._cameraPos=t},get quality(){return this._quality||bg.render.RaytracerQuality.low},set quality(t){this._quality&&this._quality.maxSamples==t.maxSamples&&this._quality.rayIncrement==t.rayIncrement||(this._quality=t,this._fragmentShaderSource=null,this.rebuildShaders())},get settings(){return this._settings,this._settings}},{},t)}(bg.base.TextureEffect);bg.render.SSRTEffect=t}(),bg.webgl1={},function(){var t="webgl1";bg.webgl1.EngineId=t;var e=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this,e),bg.webgl1.Extensions.Get(e),this._engineId=t,this._texture=new bg.webgl1.TextureImpl(e),this._pipeline=new bg.webgl1.PipelineImpl(e),this._polyList=new bg.webgl1.PolyListImpl(e),this._shader=new bg.webgl1.ShaderImpl(e),this._colorBuffer=new bg.webgl1.ColorRenderSurfaceImpl(e),this._textureBuffer=new bg.webgl1.TextureRenderSurfaceImpl(e),this._shaderSource=new bg.webgl1.ShaderSourceImpl}return $traceurRuntime.createClass(n,{},{},e)}(bg.Engine);bg.webgl1.Engine=e}(),function(){bg.webgl1.shaderLibrary={inputs:{},functions:{}};var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{header:function(t){return"precision highp float;\nprecision highp int;"},parameter:function(t,e){if(!e)return"\n";var n="";switch(e.role){case"buffer":n="attribute";break;case"value":n="uniform";break;case"in":case"out":n="varying"}var i="";return e.vec&&(i="["+e.vec+"]"),n+" "+e.dataType+" "+e.name+i+";"},func:function(t,e){if(!e)return"\n";var n="";for(var i in e.params)n+=e.params[i]+" "+i+",";return(e.returnType+" "+e.name+"("+n+") {").replace(",)",")")+("\n"+bg.base.ShaderSource.FormatSource(e.body)).replace(/\n/g,"\n\t")+"\n}"}},{},t)}(bg.base.ShaderSourceImpl);bg.webgl1.ShaderSourceImpl=t}(),function(){var t=null,e=function(e){function n(t){$traceurRuntime.superConstructor(n).call(this,t)}return $traceurRuntime.createClass(n,{getExtension:function(t){return this.context.getExtension(t)},get textureFloat(){return void 0===this._textureFloat&&(this._textureFloat=this.getExtension("OES_texture_float")),this._textureFloat},get depthTexture(){return void 0===this._depthTexture&&(this._depthTexture=this.getExtension("WEBGL_depth_texture")),this._depthTexture},get drawBuffers(){return void 0===this._drawBuffers&&(this._drawBuffers=this.getExtension("WEBGL_draw_buffers")),this._drawBuffers}},{Get:function(e){return t||(t=new n(e)),t}},e)}(bg.app.ContextObject);bg.webgl1.Extensions=e}(),function(){
var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){bg.base.ClearBuffers.COLOR=t.COLOR_BUFFER_BIT,bg.base.ClearBuffers.DEPTH=t.DEPTH_BUFFER_BIT},setViewport:function(t,e){t.viewport(e.x,e.y,e.width,e.height)},clearBuffers:function(t,e,n){t.clearColor(e.r,e.g,e.b,e.a),t.clear(n)},setDepthTestEnabled:function(t,e){e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)},setCullFace:function(t,e){e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE)},setBlendEnabled:function(t,e){e?t.enable(t.BLEND):t.disable(t.BLEND)},setBlendMode:function(t,e){switch(e){case bg.base.BlendMode.NORMAL:t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.MULTIPLY:t.blendFunc(t.ZERO,t.SRC_COLOR),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.ADD:t.blendFunc(t.ONE,t.ONE),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.SUBTRACT:t.blendFunc(t.ONE,t.ONE),t.blendEquation(t.FUNC_SUBTRACT);break;case bg.base.BlendMode.ALPHA_ADD:t.blendFunc(t.SRC_ALPHA,t.SRC_ALPHA),t.blendEquation(t.FUNC_ADD);break;case bg.base.BlendMode.ALPHA_SUBTRACT:t.blendFunc(t.SRC_ALPHA,t.SRC_ALPHA),t.blendEquation(t.FUNC_SUBTRACT)}}},{},t)}(bg.base.PipelineImpl);bg.webgl1.PipelineImpl=t}(),function(){function t(t,e,n,i){var r=null;return e.length&&(r=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),i),r.itemSize=n,r.numItems=e.length/n),r}function e(t,e){return e&&t.deleteBuffer(e),null}var n=function(n){function i(){$traceurRuntime.superConstructor(i).apply(this,arguments)}return $traceurRuntime.createClass(i,{initFlags:function(t){bg.base.DrawMode.TRIANGLES=t.TRIANGLES,bg.base.DrawMode.TRIANGLE_FAN=t.TRIANGLE_FAN,bg.base.DrawMode.TRIANGLE_STRIP=t.TRIANGLE_STRIP},create:function(t){return{vertexBuffer:null,normalBuffer:null,tex0Buffer:null,tex1Buffer:null,tex2Buffer:null,colorBuffer:null,tangentBuffer:null,indexBuffer:null}},build:function(e,n,i,r,a,s,o,u,l,c){return n.vertexBuffer=t(e,i,3,e.STATIC_DRAW),n.normalBuffer=t(e,r,3,e.STATIC_DRAW),n.tex0Buffer=t(e,a,2,e.STATIC_DRAW),n.tex1Buffer=t(e,s,2,e.STATIC_DRAW),n.tex2Buffer=t(e,o,2,e.STATIC_DRAW),n.colorBuffer=t(e,u,4,e.STATIC_DRAW),n.tangentBuffer=t(e,l,3,e.STATIC_DRAW),c.length>0&&(n.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),e.STATIC_DRAW),n.indexBuffer.itemSize=3,n.indexBuffer.numItems=c.length),n.vertexBuffer&&n.indexBuffer},draw:function(t,e,n,i){t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.indexBuffer),t.drawElements(n,i,t.UNSIGNED_SHORT,0)},destroy:function(t,n){t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),n.vertexBuffer=e(t,n.vertexBuffer),n.normalBuffer=e(t,n.normalBuffer),n.tex0Buffer=e(t,n.tex0Buffer),n.tex1Buffer=e(t,n.tex1Buffer),n.tex2Buffer=e(t,n.tex2Buffer),n.colorBuffer=e(t,n.colorBuffer),n.tangentBuffer=e(t,n.tangentBuffer),n.indexBuffer=e(t,n.indexBuffer)}},{},n)}(bg.base.PolyListImpl);bg.webgl1.PolyListImpl=n}(),function(){function t(){return o.drawBuffers?o.drawBuffers.MAX_COLOR_ATTACHMENTS||o.drawBuffers.MAX_COLOR_ATTACHMENTS_WEBGL:1}function e(t){switch(!0){case t.type==bg.base.RenderSurfaceType.RGBA&&t.format==bg.base.RenderSurfaceFormat.UNSIGNED_BYTE:case t.type==bg.base.RenderSurfaceType.RGBA&&t.format==bg.base.RenderSurfaceFormat.FLOAT:case t.type==bg.base.RenderSurfaceType.DEPTH&&t.format==bg.base.RenderSurfaceFormat.RENDERBUFFER:case t.type==bg.base.RenderSurfaceType.DEPTH&&t.format==bg.base.RenderSurfaceFormat.UNSIGNED_SHORT:return!0;default:return!1}}function n(t){switch(t){case bg.base.RenderSurfaceType.RGBA:return"RGBA";case bg.base.RenderSurfaceType.DEPTH:return"DEPTH";default:return"unknown"}}function i(t){switch(t){case bg.base.RenderSurfaceFormat.UNSIGNED_BYTE:return"UNSIGNED_BYTE";case bg.base.RenderSurfaceFormat.FLOAT:return"FLOAT";case bg.base.RenderSurfaceFormat.RENDERBUFFER:return"RENDERBUFFER";case bg.base.RenderSurfaceFormat.UNSIGNED_SHORT:return"UNSIGNED_SHORT";default:return"unknown"}}function r(r){var a=0,s=t(),u=null;return r.every(function(t,l){return e(t)?t.type==bg.base.RenderSurfaceType.DEPTH&&l!=r.length-1?(u="Error in attachment "+l+": Depth attachment must be specified as the last attachment. Specified at index "+l+" of "+(r.length-1),!1):(t.type==bg.base.RenderSurfaceType.RGBA&&++a,t.format!=bg.base.RenderSurfaceFormat.FLOAT||o.textureFloat?t.type!=bg.base.RenderSurfaceType.DEPTH||t.format==bg.base.RenderSurfaceFormat.RENDERBUFFER||o.depthTexture?!(a>s)||(u="Error in attachment "+l+": Maximum number of "+s+" color attachment exceeded.",!1):(u="Error in attachment "+l+": Depth texture attachment requested, but the requiered extension is not present: WEBGL_depth_texture.",!1):(u="Error in attachment "+l+": Floating point render surface requested, but the required extension is not present: OES_texture_float.",!1)):(u="Error in attachment "+l+": Invalid combination of type and format ("+n(t.type)+" is incompatible with "+i(t.format)+").",!1)}),u}function a(t,e,n,i){if(n.format==bg.base.RenderSurfaceFormat.RENDERBUFFER){var r=t.createRenderbuffer();return t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,r),t.bindRenderbuffer(t.RENDERBUFFER,null),{_renderbuffer:r}}var a=new bg.base.Texture(t),s=n.format,o=n.type;return a.create(),a.bind(),a.minFilter=bg.base.TextureFilter.LINEAR,a.magFilter=bg.base.TextureFilter.LINEAR,a.wrapX=bg.base.TextureWrap.CLAMP,a.wrapY=bg.base.TextureWrap.CLAMP,a.setImageRaw(e.width,e.height,null,o,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+i,t.TEXTURE_2D,a._texture,0),a.unbind(),a}function s(t,e,n,i){if(n.texture&&(n.texture.bind(),n.texture.setImageRaw(e.width,e.height,null,n.type,n.format),n.texture.unbind()),n.renderbuffer){var r=n.renderbuffer._renderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}}var o=null,u=function(e){function n(){$traceurRuntime.superConstructor(n).apply(this,arguments)}return $traceurRuntime.createClass(n,{initFlags:function(t){bg.base.RenderSurfaceType.RGBA=t.RGBA,bg.base.RenderSurfaceType.DEPTH=t.DEPTH_COMPONENT,bg.base.RenderSurfaceFormat.UNSIGNED_BYTE=t.UNSIGNED_BYTE,bg.base.RenderSurfaceFormat.UNSIGNED_SHORT=t.UNSIGNED_SHORT,bg.base.RenderSurfaceFormat.FLOAT=t.FLOAT,bg.base.RenderSurfaceFormat.RENDERBUFFER=t.RENDERBUFFER,o=bg.webgl1.Extensions.Get()},supportType:function(t){switch(t){case bg.base.RenderSurfaceType.RGBA:return!0;case bg.base.RenderSurfaceType.DEPTH:return null!=o.depthTexture;default:return!1}},supportFormat:function(t){switch(t){case bg.base.RenderSurfaceFormat.UNSIGNED_BYTE:case bg.base.RenderSurfaceFormat.UNSIGNED_SHORT:return!0;case bg.base.RenderSurfaceFormat.FLOAT:return null!=o.textureFloat;default:return!1}},get maxColorAttachments(){return t()}},{},e)}(bg.base.RenderSurfaceBufferImpl),l=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{create:function(t){return{}},setActive:function(t,e,n){t.bindFramebuffer(t.FRAMEBUFFER,null)},resize:function(t,e,n){},destroy:function(t,e){}},{},t)}(u);bg.webgl1.ColorRenderSurfaceImpl=l;var c=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){},create:function(t,e){var n=r(e);if(n)throw new Error(n);var i=new bg.Vector2(256),s={fbo:t.createFramebuffer(),size:i,attachments:[]};t.bindFramebuffer(t.FRAMEBUFFER,s.fbo);var u=[];return e.forEach(function(e,n){var r=a(t,i,e,n);r instanceof bg.base.Texture&&u.push(o.drawBuffers?o.drawBuffers.COLOR_ATTACHMENT0_WEBGL+n:t.COLOR_ATTACHMENT0),s.attachments.push({texture:r instanceof bg.base.Texture?r:null,renderbuffer:r instanceof bg.base.Texture?null:r,format:e.format,type:e.type})}),u.length>1&&o.drawBuffers.drawBuffersWEBGL(u),t.bindFramebuffer(t.FRAMEBUFFER,null),s},setActive:function(t,e){t.bindFramebuffer(t.FRAMEBUFFER,e.fbo)},readBuffer:function(t,e,n,i){var r=new Uint8Array(n.width*n.height*4);return t.readPixels(n.x,i.height-n.y,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,r),r},resize:function(t,e,n){e.size.width=n.width,e.size.height=n.height,e.attachments.forEach(function(e,i){s(t,n,e,i)})},destroy:function(t,e){t.bindFramebuffer(t.FRAMEBUFFER,null);var n=e&&e.attachments;e.fbo&&t.deleteFramebuffer(e.fbo),n&&n.forEach(function(e){e.texture?e.texture.destroy():e.renderbuffer&&t.deleteRenderbuffer(e.renderbuffer._renderbuffer)}),e.fbo=null,e.size=null,e.attachments=null}},{},t)}(u);bg.webgl1.TextureRenderSurfaceImpl=c}(),function(){var t={textureInput:"sampler2D",texCoord:"vec2",size:"int",samplerSize:"vec2"},e="\n\t\tvec2 texelSize = 1.0 / samplerSize;\n\t\tvec3 result = vec3(0.0);\n\t\tvec2 hlim = vec2(float(-size) * 0.5 + 0.5);\n\t\tfor (int x=0; x<25; ++x) {\n\t\t\tif (x==size) break;\n\t\t\tfor (int y=0; y<25; ++y) {\n\t\t\t\tif (y==size) break;\n\t\t\t\tvec2 offset = (hlim + vec2(float(x), float(y))) * texelSize;\n\t\t\t\tresult += texture2D(textureInput, texCoord + offset).rgb;\n\t\t\t}\n\t\t}\n\t\treturn vec4(result / float(size * size), 1.0);\n\t\t";bg.webgl1.shaderLibrary.functions.blur={gaussianBlur:{returnType:"vec4",name:"gaussianBlur",params:t,body:e},blur:{returnType:"vec4",name:"blur",params:t,body:e}}}(),function(){bg.webgl1.shaderLibrary.functions.colorCorrection={rgb2hsv:{returnType:"vec3",name:"rgb2hsv",params:{c:"vec3"},body:"\n\t\t\t\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\t\t\t\tvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n\t\t\t\tvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n\t\t\t\tfloat d = q.x - min(q.w, q.y);\n\t\t\t\tfloat e = 1.0e-10;\n\t\t\t\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);"},hsv2rgb:{returnType:"vec3",name:"hsv2rgb",params:{c:"vec3"},body:"\n\t\t\t\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\t\t\t\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\t\t\t\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);"},applyBrightness:{returnType:"vec4",name:"applyBrightness",params:{color:"vec4",brightness:"float"},body:"\n\t\t\t\t\treturn clamp(vec4(color.rgb + brightness - 0.5,1.0),0.0,1.0);\n\t\t\t\t"},applyContrast:{returnType:"vec4",name:"applyContrast",params:{color:"vec4",contrast:"float"},body:"\n\t\t\t\treturn clamp(vec4((color.rgb * max(contrast + 0.5,0.0)),1.0),0.0,1.0);"},applySaturation:{returnType:"vec4",name:"applySaturation",params:{color:"vec4",hue:"float",saturation:"float",lightness:"float"},body:"\n\t\t\t\tvec3 fragRGB = clamp(color.rgb + vec3(0.001),0.0,1.0);\n\t\t\t\tvec3 fragHSV = rgb2hsv(fragRGB);\n\t\t\t\tlightness -= 0.01;\n\t\t\t\tfloat h = hue;\n\t\t\t\tfragHSV.x *= h;\n\t\t\t\tfragHSV.yz *= vec2(saturation,lightness);\n\t\t\t\tfragHSV.x = mod(fragHSV.x, 1.0);\n\t\t\t\tfragHSV.y = mod(fragHSV.y, 1.0);\n\t\t\t\tfragHSV.z = mod(fragHSV.z, 1.0);\n\t\t\t\tfragRGB = hsv2rgb(fragHSV);\n\t\t\t\treturn clamp(vec4(hsv2rgb(fragHSV), color.w),0.0,1.0);"},colorCorrection:{returnType:"vec4",name:"colorCorrection",params:{fragColor:"vec4",hue:"float",saturation:"float",lightness:"float",brightness:"float",contrast:"float"},body:"\n\t\t\t\treturn applyContrast(applyBrightness(applySaturation(fragColor,hue,saturation,lightness),brightness),contrast);"}}}(),function(){bg.webgl1.shaderLibrary.inputs={buffers:{vertex:{name:"inVertex",dataType:"vec3",role:"buffer",target:"vertex"},normal:{name:"inNormal",dataType:"vec3",role:"buffer",target:"normal"},tangent:{name:"inTangent",dataType:"vec3",role:"buffer",target:"tangent"},tex0:{name:"inTex0",dataType:"vec2",role:"buffer",target:"tex0"},tex1:{name:"inTex1",dataType:"vec2",role:"buffer",target:"tex1"},tex2:{name:"inTex2",dataType:"vec2",role:"buffer",target:"tex2"},color:{name:"inColor",dataType:"vec4",role:"buffer",target:"color"}},matrix:{model:{name:"inModelMatrix",dataType:"mat4",role:"value"},view:{name:"inViewMatrix",dataType:"mat4",role:"value"},projection:{name:"inProjectionMatrix",dataType:"mat4",role:"value"},normal:{name:"inNormalMatrix",dataType:"mat4",role:"value"},viewInv:{name:"inViewMatrixInv",dataType:"mat4",role:"value"}},material:{diffuse:{name:"inDiffuseColor",dataType:"vec4",role:"value"},specular:{name:"inSpecularColor",dataType:"vec4",role:"value"},shininess:{name:"inShininess",dataType:"float",role:"value"},shininessMask:{name:"inShininessMask",dataType:"sampler2D",role:"value"},shininessMaskChannel:{name:"inShininessMaskChannel",dataType:"vec4",role:"value"},shininessMaskInvert:{name:"inShininessMaskInvert",dataType:"bool",role:"value"},lightEmission:{name:"inLightEmission",dataType:"float",role:"value"},lightEmissionMask:{name:"inLightEmissionMask",dataType:"sampler2D",role:"value"},lightEmissionMaskChannel:{name:"inLightEmissionMaskChannel",dataType:"vec4",role:"value"},lightEmissionMaskInvert:{name:"inLightEmissionMaskInvert",dataType:"bool",role:"value"},texture:{name:"inTexture",dataType:"sampler2D",role:"value"},textureOffset:{name:"inTextureOffset",dataType:"vec2",role:"value"},textureScale:{name:"inTextureScale",dataType:"vec2",role:"value"},alphaCutoff:{name:"inAlphaCutoff",dataType:"float",role:"value"},lightMap:{name:"inLightMap",dataType:"sampler2D",role:"value"},lightMapOffset:{name:"inLightMapOffset",dataType:"vec2",role:"value"},lightMapScale:{name:"inLightMapScale",dataType:"vec2",role:"value"},normalMap:{name:"inNormalMap",dataType:"sampler2D",role:"value"},normalMapOffset:{name:"inNormalMapOffset",dataType:"vec2",role:"value"},normalMapScale:{name:"inNormalMapScale",dataType:"vec2",role:"value"},reflection:{name:"inReflection",dataType:"float",role:"value"},reflectionMask:{name:"inReflectionMask",dataType:"sampler2D",role:"value"},reflectionMaskChannel:{name:"inReflectionMaskChannel",dataType:"vec4",role:"value"},reflectionMaskInvert:{name:"inReflectionMaskInvert",dataType:"bool",role:"value"},castShadows:{name:"inCastShadows",dataType:"bool",role:"value"},receiveShadows:{name:"inReceiveShadows",dataType:"bool",role:"value"}},lighting:{type:{name:"inLightType",dataType:"int",role:"value"},position:{name:"inLightPosition",dataType:"vec3",role:"value"},direction:{name:"inLightDirection",dataType:"vec3",role:"value"},ambient:{name:"inLightAmbient",dataType:"vec4",role:"value"},diffuse:{name:"inLightDiffuse",dataType:"vec4",role:"value"},specular:{name:"inLightSpecular",dataType:"vec4",role:"value"},attenuation:{name:"inLightAttenuation",dataType:"vec3",role:"value"},spotExponent:{name:"inSpotExponent",dataType:"float",role:"value"},spotCutoff:{name:"inSpotCutoff",dataType:"float",role:"value"},cutoffDistance:{name:"inLightCutoffDistance",dataType:"float",role:"value"},exposure:{name:"inLightExposure",dataType:"float",role:"value"},castShadows:{name:"inLightCastShadows",dataType:"bool",role:"value"}},shadows:{shadowMap:{name:"inShadowMap",dataType:"sampler2D",role:"value"},shadowMapSize:{name:"inShadowMapSize",dataType:"vec2",role:"value"},shadowStrength:{name:"inShadowStrength",dataType:"float",role:"value"},shadowColor:{name:"inShadowColor",dataType:"vec4",role:"value"},shadowBias:{name:"inShadowBias",dataType:"float",role:"value"},shadowType:{name:"inShadowType",dataType:"int",role:"value"}},colorCorrection:{hue:{name:"inHue",dataType:"float",role:"value"},saturation:{name:"inSaturation",dataType:"float",role:"value"},lightness:{name:"inLightness",dataType:"float",role:"value"},brightness:{name:"inBrightness",dataType:"float",role:"value"},contrast:{name:"inContrast",dataType:"float",role:"value"}}}}(),function(){bg.webgl1.shaderLibrary.functions.lighting={getDirectionalLight:{returnType:"vec4",name:"getDirectionalLight",params:{ambient:"vec4",diffuse:"vec4",specular:"vec4",shininess:"float",direction:"vec3",vertexPos:"vec3",normal:"vec3",matDiffuse:"vec4",matSpecular:"vec4",shadowColor:"vec4"},body:"\n\t\t\t\tvec3 color = ambient.rgb * matDiffuse.rgb;\n\t\t\t\tvec3 diffuseWeight = max(0.0, dot(normal,direction)) * diffuse.rgb;\n\t\t\t\tcolor += min(diffuseWeight,shadowColor.rgb) * matDiffuse.rgb;\n\t\t\t\tif (shininess>0.0) {\n\t\t\t\t\tvec3 eyeDirection = normalize(-vertexPos);\n\t\t\t\t\tvec3 reflectionDirection = normalize(reflect(-direction,normal));\n\t\t\t\t\tfloat specularWeight = clamp(pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininess), 0.0, 1.0);\n\t\t\t\t\tvec3 specularColor = specularWeight * pow(shadowColor.rgb,vec3(10.0));\n\t\t\t\t\tcolor += specularColor * specular.rgb * matSpecular.rgb;\n\t\t\t\t}\n\t\t\t\treturn vec4(color,1.0);"},getShadowColor:{returnType:"vec4",name:"getShadowColor",params:{vertexPosFromLight:"vec4",shadowMap:"sampler2D",shadowMapSize:"vec2",shadowType:"int",shadowStrength:"float",shadowBias:"float",shadowColor:"vec4"},body:"\n\t\t\t\tfloat visibility = 1.0;\n\t\t\t\tvec3 depth = vertexPosFromLight.xyz / vertexPosFromLight.w;\n\t\t\t\tconst float kShadowBorderOffset = 3.0;\n\t\t\t\tfloat shadowBorderOffset = kShadowBorderOffset / shadowMapSize.x;\n\t\t\t\tfloat bias = shadowBias;\n\t\t\t\tvec4 shadow = vec4(1.0);\n\t\t\t\tif (shadowType==0) {\t// hard\n\t\t\t\t\tfloat shadowDepth = unpack(texture2D(shadowMap,depth.xy));\n\t\t\t\t\tif (shadowDepth<depth.z - bias &&\n\t\t\t\t\t\t(depth.x>0.0 && depth.x<1.0 && depth.y>0.0 && depth.y<1.0))\n\t\t\t\t\t{\n\t\t\t\t\t\tvisibility = 1.0 - shadowStrength;\n\t\t\t\t\t}\n\t\t\t\t\tshadow = clamp(shadowColor + visibility,0.0,1.0);\n\t\t\t\t}\n\t\t\t\telse if (shadowType==1 || shadowType==2) {\t// soft / soft stratified (not supported on webgl, fallback to soft)\n\t\t\t\t\tvec2 poissonDisk[4];\n\t\t\t\t\tpoissonDisk[0] = vec2( -0.94201624, -0.39906216 );\n\t\t\t\t\tpoissonDisk[1] = vec2( 0.94558609, -0.76890725 );\n\t\t\t\t\tpoissonDisk[2] = vec2( -0.094184101, -0.92938870 );\n\t\t\t\t\tpoissonDisk[3] = vec2( 0.34495938, 0.29387760 );\n\t\t\t\t\t\n\t\t\t\t\tfor (int i=0; i<4; ++i) {\n\t\t\t\t\t\tfloat shadowDepth = unpack(texture2D(shadowMap, depth.xy + poissonDisk[i]/1000.0));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (shadowDepth<depth.z - bias\n\t\t\t\t\t\t\t&& (depth.x>0.0 && depth.x<1.0 && depth.y>0.0 && depth.y<1.0)) {\n\t\t\t\t\t\t\tvisibility -= (shadowStrength) * 0.25;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tshadow = clamp(shadowColor + visibility,0.0,1.0);\n\t\t\t\t}\n\t\t\t\treturn shadow;"}}}(),function(){bg.webgl1.shaderLibrary.functions.materials={samplerColor:{returnType:"vec4",name:"samplerColor",params:{sampler:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2"},body:"\n\t\t\t\treturn texture2D(sampler,uv * scale + offset);"},samplerNormal:{returnType:"vec3",name:"samplerNormal",params:{sampler:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2"},body:"\n\t\t\t\treturn normalize(samplerColor(sampler,uv,offset,scale).xyz * 2.0 - 1.0);\n\t\t\t\t"},combineNormalWithMap:{returnType:"vec3",name:"combineNormalWithMap",params:{normalCoord:"vec3",tangent:"vec3",bitangent:"vec3",normalMapValue:"vec3"},body:"\n\t\t\t\tmat3 tbnMat = mat3( tangent.x, bitangent.x, normalCoord.x,\n\t\t\t\t\t\t\ttangent.y, bitangent.y, normalCoord.y,\n\t\t\t\t\t\t\ttangent.z, bitangent.z, normalCoord.z\n\t\t\t\t\t\t);\n\t\t\t\treturn normalize(normalMapValue * tbnMat);"},applyTextureMask:{returnType:"float",name:"applyTextureMask",params:{value:"float",textureMask:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2",channelMask:"vec4",invert:"bool"},body:"\n\t\t\t\tfloat mask;\n\t\t\t\tvec4 color = samplerColor(textureMask,uv,offset,scale);\n\t\t\t\tmask = color.r * channelMask.r +\n\t\t\t\t\t\t color.g * channelMask.g +\n\t\t\t\t\t\t color.b * channelMask.b +\n\t\t\t\t\t\t color.a * channelMask.a;\n\t\t\t\tif (!invert) {\n\t\t\t\t\tmask = 1.0 - mask;\n\t\t\t\t}\n\t\t\t\treturn value * mask;"},specularColor:{returnType:"vec4",name:"specularColor",params:{specular:"vec4",shininessMask:"sampler2D",uv:"vec2",offset:"vec2",scale:"vec2",channelMask:"vec4",invert:"bool"},body:"\n\t\t\t\tfloat maskValue = applyTextureMask(1.0, shininessMask,uv,offset,scale,channelMask,invert);\n\t\t\t\treturn vec4(specular.rgb * maskValue, 1.0);"}}}(),function(){bg.webgl1.shaderLibrary.functions.utils={pack:{returnType:"vec4",name:"pack",params:{depth:"float"},body:"\n\t\t\t\tconst vec4 bitSh = vec4(256 * 256 * 256,\n\t\t\t\t\t\t\t\t\t\t256 * 256,\n\t\t\t\t\t\t\t\t\t\t256,\n\t\t\t\t\t\t\t\t\t\t1.0);\n\t\t\t\tconst vec4 bitMsk = vec4(0,\n\t\t\t\t\t\t\t\t\t\t1.0 / 256.0,\n\t\t\t\t\t\t\t\t\t\t1.0 / 256.0,\n\t\t\t\t\t\t\t\t\t\t1.0 / 256.0);\n\t\t\t\tvec4 comp = fract(depth * bitSh);\n\t\t\t\tcomp -= comp.xxyz * bitMsk;\n\t\t\t\treturn comp;"},unpack:{returnType:"float",name:"unpack",params:{color:"vec4"},body:"\n\t\t\t\tconst vec4 bitShifts = vec4(1.0 / (256.0 * 256.0 * 256.0),\n\t\t\t\t\t\t\t\t\t\t\t1.0 / (256.0 * 256.0),\n\t\t\t\t\t\t\t\t\t\t\t1.0 / 256.0,\n\t\t\t\t\t\t\t\t\t\t\t1.0);\n\t\t\t\treturn dot(color, bitShifts);"},random:{returnType:"float",name:"random",params:{seed:"vec3",i:"int"},body:"\n\t\t\t\tvec4 seed4 = vec4(seed,i);\n\t\t\t\tfloat dot_product = dot(seed4, vec4(12.9898,78.233,45.164,94.673));\n\t\t\t\treturn fract(sin(dot_product) * 43758.5453);"}}}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){bg.base.ShaderType.VERTEX=t.VERTEX_SHADER,bg.base.ShaderType.FRAGMENT=t.FRAGMENT_SHADER},setActive:function(t,e){t.useProgram(e&&e.program)},create:function(t){return{program:t.createProgram(),attribLocations:{},uniformLocations:{}}},addShaderSource:function(t,e,n,i){var r=null;if(e&&e.program){var a=t.createShader(n);t.shaderSource(a,i),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?t.attachShader(e.program,a):r=t.getShaderInfoLog(a),t.deleteShader(a)}else r="Could not attach shader. Invalid shader program";return r},link:function(t,e){var n=null;return e&&e.program?(t.linkProgram(e.program),t.getProgramParameter(e.program,t.LINK_STATUS)||(n=t.getProgramInfoLog(e.program))):n="Could not link shader. Invalid shader program",n},initVars:function(t,e,n,i){n.forEach(function(n){e.attribLocations[n]=t.getAttribLocation(e.program,n)}),i.forEach(function(n){e.uniformLocations[n]=t.getUniformLocation(e.program,n)})},setInputBuffer:function(t,e,n,i,r){if(i&&e&&e.program){var a=e.attribLocations[n];-1!=a&&(t.bindBuffer(t.ARRAY_BUFFER,i),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,r,t.FLOAT,!1,0,0))}},disableInputBuffer:function(t,e,n){t.disableVertexAttribArray(e.attribLocations[n])},setValueInt:function(t,e,n,i){t.uniform1i(e.uniformLocations[n],i)},setValueFloat:function(t,e,n,i){t.uniform1f(e.uniformLocations[n],i)},setValueVector2:function(t,e,n,i){t.uniform2fv(e.uniformLocations[n],i.v)},setValueVector3:function(t,e,n,i){t.uniform3fv(e.uniformLocations[n],i.v)},setValueVector4:function(t,e,n,i){t.uniform4fv(e.uniformLocations[n],i.v)},setValueVector2v:function(t,e,n,i){t.uniform2fv(e.uniformLocations[n],i)},setValueVector3v:function(t,e,n,i){t.uniform3fv(e.uniformLocations[n],i)},setValueVector4v:function(t,e,n,i){t.uniform4fv(e.uniformLocations[n],i)},setValueMatrix3:function(t,e,n,i,r){t.uniformMatrix3fv(e.uniformLocations[n],i,r.m)},setValueMatrix4:function(t,e,n,i,r){t.uniformMatrix4fv(e.uniformLocations[n],i,r.m)},setTexture:function(t,e,n,i,r){i.setActive(r),i.bind(),t.uniform1i(e.uniformLocations[n],r)}},{},t)}(bg.base.ShaderImpl);bg.webgl1.ShaderImpl=t}(),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{initFlags:function(t){bg.base.TextureWrap.REPEAT=t.REPEAT,bg.base.TextureWrap.CLAMP=t.CLAMP_TO_EDGE,bg.base.TextureFilter.NEAREST_MIPMAP_NEAREST=t.NEAREST_MIPMAP_NEAREST,bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST=t.LINEAR_MIPMAP_NEAREST,bg.base.TextureFilter.NEAREST_MIPMAP_LINEAR=t.NEAREST_MIPMAP_LINEAR,bg.base.TextureFilter.LINEAR_MIPMAP_LINEAR=t.LINEAR_MIPMAP_LINEAR,bg.base.TextureFilter.NEAREST=t.NEAREST,bg.base.TextureFilter.LINEAR=t.LINEAR,bg.base.TextureTarget.TEXTURE_2D=t.TEXTURE_2D,bg.base.TextureTarget.CUBE_MAP=t.TEXTURE_CUBE_MAP,bg.base.TextureTarget.POSITIVE_X_FACE=t.TEXTURE_CUBE_MAP_POSITIVE_X,bg.base.TextureTarget.NEGATIVE_X_FACE=t.TEXTURE_CUBE_MAP_NEGATIVE_X,bg.base.TextureTarget.POSITIVE_Y_FACE=t.TEXTURE_CUBE_MAP_POSITIVE_Y,bg.base.TextureTarget.NEGATIVE_Y_FACE=t.TEXTURE_CUBE_MAP_NEGATIVE_Y,bg.base.TextureTarget.POSITIVE_Z_FACE=t.TEXTURE_CUBE_MAP_POSITIVE_Z,bg.base.TextureTarget.NEGATIVE_Z_FACE=t.TEXTURE_CUBE_MAP_NEGATIVE_Z},requireMipmaps:function(t,e){return t==bg.base.TextureFilter.NEAREST_MIPMAP_NEAREST||t==bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST||t==bg.base.TextureFilter.NEAREST_MIPMAP_LINEAR||t==bg.base.TextureFilter.LINEAR_MIPMAP_LINEAR||e==bg.base.TextureFilter.NEAREST_MIPMAP_NEAREST||e==bg.base.TextureFilter.LINEAR_MIPMAP_NEAREST||e==bg.base.TextureFilter.NEAREST_MIPMAP_LINEAR||e==bg.base.TextureFilter.LINEAR_MIPMAP_LINEAR},create:function(t){return t.createTexture()},setActive:function(t,e){t.activeTexture(t.TEXTURE0+e)},bind:function(t,e,n){t.bindTexture(e,n)},unbind:function(t,e){this.bind(t,e,null)},setTextureWrapX:function(t,e,n,i){t.texParameteri(e,t.TEXTURE_WRAP_S,i)},setTextureWrapY:function(t,e,n,i){t.texParameteri(e,t.TEXTURE_WRAP_T,i)},setImage:function(t,e,n,i,r,a,s){s&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texParameteri(e,t.TEXTURE_MIN_FILTER,n),t.texParameteri(e,t.TEXTURE_MAG_FILTER,i),t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a),this.requireMipmaps(n,i)&&t.generateMipmap(e)},setImageRaw:function(t,e,n,i,r,a,s,o,u,l){u||(u=t.RGBA),l||(l=t.UNSIGNED_BYTE),l==bg.base.RenderSurfaceFormat.FLOAT&&(n=bg.base.TextureFilter.NEAREST,i=bg.base.TextureFilter.NEAREST),t.texParameteri(e,t.TEXTURE_MIN_FILTER,n),t.texParameteri(e,t.TEXTURE_MAG_FILTER,i),t.texImage2D(e,0,u,a,s,0,u,l,o),this.requireMipmaps(n,i)&&t.generateMipmap(e)},setVideo:function(t,e,n,i,r){r&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)},updateVideoData:function(t,e,n,i){t.bindTexture(e,n),t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.bindTexture(e,null)},destroy:function(t,e){t.deleteTexture(this._texture)}},{},t)}(bg.base.TextureImpl);bg.webgl1.TextureImpl=t}(),Class("paella.Video360Theta",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(t,e,n,i,r,a,s){function o(){if(u.canvasController){u.canvasController.canvas.domElement}}this.parent(t,e,"canvas",0,0,1280,720),this._streamName=s||"video360theta";var u=this;paella.player.videoContainer.disablePlayOnClick(),this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(t,e){return t.res.h-e.res.h}),this.video=null,new paella.Timer(function(t){o()},500).repeat=!0},defaultProfile:function(){return"chroma"},_setVideoElem:function(t){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)},_loadDeps:function(){return new Promise(function(t,e){window.$paella_mpd?defer.resolve(window.$paella_mpd):require(["resources/deps/bg2e.js"],function(){window.$paella_bg2e=!0,t(window.$paella_bg2e)})})},_deferredAction:function(t){var e=this;return new Promise(function(n,i){e.video?n(t()):$(e.video).bind("canplay",function(){e._ready=!0,n(t())})})},_getQualityObject:function(t,e){return{index:t,res:e.res,src:e.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(t){return this.res.w*this.res.h-t.res.w*t.res.h}}},allowZoom:function(){return!1},getVideoData:function(){var t=this,e=this;return new Promise(function(n,i){t._deferredAction(function(){n({duration:e.video.duration,currentTime:e.video.currentTime,volume:e.video.volume,paused:e.video.paused,ended:e.video.ended,res:{w:e.video.videoWidth,h:e.video.videoHeight}})})})},setPosterFrame:function(t){this._posterFrame=t},setAutoplay:function(t){this._autoplay=t,t&&this.video&&this.video.setAttribute("autoplay",t)},load:function(){var t=this;return new Promise(function(e,n){t._loadDeps().then(function(){var i=t._stream.sources[t._streamName];null===t._currentQuality&&t._videoQualityStrategy&&(t._currentQuality=t._videoQualityStrategy.getQualityIndex(i));var r=t._currentQuality<i.length?i[t._currentQuality]:null;t.video=null,r?(t.canvasController=null,buildVideo360ThetaCanvas(r,t.domElement).then(function(n){t.canvasController=n,t.video=n.video,t.video.pause(),e(r)})):n(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){var t=this;return new Promise(function(e,n){setTimeout(function(){var n=[],i=t._stream.sources[t._streamName],r=-1;i.forEach(function(e){r++,n.push(t._getQualityObject(r,e))}),e(n)},10)})},setQuality:function(t){var e=this;return new Promise(function(n){var i=e.video.paused,r=e._stream.sources[e._streamName];e._currentQuality=t<r.length?t:0;var a=e.video.currentTime;e.freeze().then(function(){return e._ready=!1,e.load()}).then(function(){i||e.play(),$(e.video).on("seeked",function(){e.unFreeze(),n(),$(e.video).off("seeked")}),e.video.currentTime=a})})},getCurrentQuality:function(){var t=this;return new Promise(function(e){e(t._getQualityObject(t._currentQuality,t._stream.sources[t._streamName][t._currentQuality]))})},play:function(){var t=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,t.video.play()})},pause:function(){var t=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,t.video.pause()})},isPaused:function(){var t=this;return this._deferredAction(function(){return t.video.paused})},duration:function(){var t=this;return this._deferredAction(function(){return t.video.duration})},setCurrentTime:function(t){var e=this;return this._deferredAction(function(){e.video.currentTime=t,$(e.video).on("seeked",function(){e.canvasController.postRedisplay(),$(e.video).off("seeked")})})},currentTime:function(){var t=this;return this._deferredAction(function(){return t.video.currentTime})},setVolume:function(t){var e=this;return this._deferredAction(function(){e.video.volume=t})},volume:function(){var t=this;return this._deferredAction(function(){return t.video.volume})},setPlaybackRate:function(t){var e=this;return this._deferredAction(function(){e.video.playbackRate=t})},playbackRate:function(){var t=this;return this._deferredAction(function(){return t.video.playbackRate})},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){var t=this;return this._deferredAction(function(){var e=document.getElementById(t.video.className+"canvas");$(e).remove()})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.Video360ThetaFactory",{isStreamCompatible:function(t){try{if(paella.ChromaVideo._loaded)return!1;if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var e in t.sources)if("video360theta"==e)return!0}catch(t){}return!1},getVideoObject:function(t,e,n){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,
new paella.Video360Theta(t,e,n.x,n.y,n.w,n.h)}}),function(){var t=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{getIndex:function(){return 10},getSubclass:function(){return"videoData"},getAlignment:function(){return"left"},getDefaultToolTip:function(){return""},checkEnabled:function(t){var e=paella.player.config.plugins.list["es.upv.paella.videoDataPlugin"],n=e&&e.excludeLocations||[],i=e&&e.excludeParentLocations||[],r=n.some(function(t){return RegExp(t,"i").test(location.href)});window!=window.parent&&(r=r||i.some(function(t){var e=RegExp(t,"i");try{return e.test(parent.location.href)}catch(t){return!1}})),t(!r)},setup:function(){var t=document.createElement("h1");t.innerHTML="",t.className="videoTitle",this.button.appendChild(t),paella.data.read("metadata","title",function(e){t.innerHTML=e})},action:function(t){},getName:function(){return"es.upv.paella.videoDataPlugin"}},{},t)}(paella.VideoOverlayButtonPlugin);paella.plugins.videoDataPlugin=new t;var e=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{read:function(t,e,n){n(paella.player.videoLoader.getMetadata()[e],!0)},write:function(t,e,n,i){i({},!0)},remove:function(t,e,n){n({},!0)}},{},t)}(paella.DataDelegate);paella.dataDelegates.VideoManifestMetadataDataDelegate=e}(),function(){function t(t){var e=document.createElement("canvas");return e.width=r,e.height=a,e.className="zoom-thumbnail",e.id="zoomContainer"+t,e}function e(){var t=document.createElement("div");return t.className="zoom-rect",t}function n(t){var e=t.player,n=t.canvas;e.captureFrame().then(function(t){n.getContext("2d").drawImage(t.source,0,0,r,a)})}function i(t){var e=t.parent,n=e.domElement,i=document.createElement("button");n.appendChild(i),i.className="videoZoomButton btn zoomIn",i.innerHTML='<i class="glyphicon glyphicon-zoom-in"></i>',$(i).on("mousedown",function(){paella.player.videoContainer.disablePlayOnClick(),t.zoomIn()}),$(i).on("mouseup",function(){setTimeout(function(){return paella.player.videoContainer.enablePlayOnClick()},10)}),i=document.createElement("button"),n.appendChild(i),i.className="videoZoomButton btn zoomOut",i.innerHTML='<i class="glyphicon glyphicon-zoom-out"></i>',$(i).on("mousedown",function(){paella.player.videoContainer.disablePlayOnClick(),t.zoomOut()}),$(i).on("mouseup",function(){setTimeout(function(){return paella.player.videoContainer.enablePlayOnClick()},10)})}var r=320,a=180,s=function(r){function a(){$traceurRuntime.superConstructor(a).apply(this,arguments)}return $traceurRuntime.createClass(a,{getIndex:function(){return 10},getSubclass:function(){return"videoZoom"},getAlignment:function(){return"right"},getDefaultToolTip:function(){return""},checkEnabled:function(t){t(!0)},setup:function(){function r(){var t=$(".videoZoomButton"),e=$(".videoZoom");this._visible?(t.show(),e.show()):(t.hide(),e.hide())}var a=this;this._thumbnails=[],this._visible=!1,paella.player.videoContainer.videoPlayers().then(function(n){n.forEach(function(n,s){n.allowZoom()&&(a._visible=n.zoomAvailable(),i.apply(a,[n]),n.supportsCaptureFrame().then(function(i){if(i){var o=document.createElement("div");o.className="zoom-container";var u=t.apply(a,[s]),l=e.apply(a);a.button.appendChild(o),o.appendChild(u),o.appendChild(l),$(o).hide(),a._thumbnails.push({player:n,thumbContainer:o,zoomRect:l,canvas:u}),r.apply(a)}}))})});var s=!1;paella.events.bind(paella.events.play,function(t){var e=function(){a._thumbnails.forEach(function(t){n(t)}),s&&setTimeout(function(){e()},2e3)};s=!0,e()}),paella.events.bind(paella.events.pause,function(t){s=!1}),paella.events.bind(paella.events.videoZoomChanged,function(t,e){a._thumbnails.some(function(t){if(t.player==e.video){if(t.player.zoom>100){$(t.thumbContainer).show();var n=100*e.video.zoomOffset.x/e.video.zoom,i=100*e.video.zoomOffset.y/e.video.zoom,r=t.zoomRect;$(r).css({left:n+"%",top:i+"%",width:1e4/e.video.zoom+"%",height:1e4/e.video.zoom+"%"})}else $(t.thumbContainer).hide();return!0}})}),paella.events.bind(paella.events.zoomAvailabilityChanged,function(t,e){a._visible=e.available,r.apply(a)})},action:function(t){},getName:function(){return"es.upv.paella.videoZoomPlugin"}},{},r)}(paella.VideoOverlayButtonPlugin);paella.plugins.videoZoomPlugin=new s;var o=function(t){function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)}return $traceurRuntime.createClass(e,{getAlignment:function(){return"right"},getSubclass:function(){return"videoZoomToolbar"},getIndex:function(){return 2030},getMinWindowSize:function(){return paella.player.config.player&&paella.player.config.player.videoZoom&&paella.player.config.player.videoZoom.minWindowSize||600},getName:function(){return"es.upv.paella.videoZoomToolbarPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Change theme")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},checkEnabled:function(t){var e=this;paella.player.videoContainer.videoPlayers().then(function(n){var i=paella.player.config.plugins.list["es.upv.paella.videoZoomToolbarPlugin"],r=i.targetStreamIndex;e.targetPlayer=n.length>r?n[r]:null,t(paella.player.config.player.videoZoom.enabled&&e.targetPlayer&&e.targetPlayer.allowZoom())})},buildContent:function(t){function e(t,e){var n=document.createElement("div");return n.className="videoZoomToolbarItem "+t,n.innerHTML='<i class="glyphicon glyphicon-'+t+'"></i>',$(n).click(e),n}var n=this;paella.events.bind(paella.events.videoZoomChanged,function(t,e){n.setText(Math.round(e.video.zoom)+"%")}),this.setText("100%"),t.appendChild(e("zoom-in",function(t){n.targetPlayer.zoomIn()})),t.appendChild(e("zoom-out",function(t){n.targetPlayer.zoomOut()}))}},{},t)}(paella.ButtonPlugin);paella.plugins.videoZoomToolbarPlugin=new o}(),Class("paella.plugins.ViewModePlugin",paella.ButtonPlugin,{buttonItems:null,buttons:[],selected_button:null,active_profiles:null,getAlignment:function(){return"right"},getSubclass:function(){return"showViewModeButton"},getIndex:function(){return 540},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.viewModePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Change video layout")},checkEnabled:function(t){this.active_profiles=this.config.activeProfiles,t(!paella.player.videoContainer.isMonostream)},closeOnMouseOut:function(){return!0},setup:function(){var t=this,e={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40};paella.events.bind(paella.events.setProfile,function(e,n){t.onProfileChange(n.profileName)}),$(this.button).keyup(function(n){t.isPopUpOpen()&&(n.keyCode==e.Up?t.selected_button>0&&(t.selected_button<t.buttons.length&&(t.buttons[t.selected_button].className="viewModeItemButton "+t.buttons[t.selected_button].data.profile),t.selected_button--,t.buttons[t.selected_button].className=t.buttons[t.selected_button].className+" selected"):n.keyCode==e.Down?t.selected_button<t.buttons.length-1&&(t.selected_button>=0&&(t.buttons[t.selected_button].className="viewModeItemButton "+t.buttons[t.selected_button].data.profile),t.selected_button++,t.buttons[t.selected_button].className=t.buttons[t.selected_button].className+" selected"):n.keyCode==e.Return&&t.onItemClick(t.buttons[t.selected_button],t.buttons[t.selected_button].data.profile,t.buttons[t.selected_button].data.profile))})},buildContent:function(t){var e=this;this.buttonItems={},paella.Profiles.loadProfileList(function(n){Object.keys(n).forEach(function(i){if(!n[i].hidden){if(e.active_profiles){var r=!1;if(e.active_profiles.forEach(function(t){t==i&&(r=!0)}),0==r)return}var a=paella.player.videoContainer.sourceData[0].sources;if(("s_p_blackboard2"!=i||0!=a.hasOwnProperty("image"))&&("chroma"!=i||a.chroma)){var s=n[i],o=e.getProfileItemButton(i,s);e.buttonItems[i]=o,t.appendChild(o),e.buttons.push(o),paella.player.selectedProfile==i&&(e.buttonItems[i].className=e.getButtonItemClass(i,!0))}}}),e.selected_button=e.buttons.length})},getProfileItemButton:function(t,e){var n=document.createElement("div");return n.className=this.getButtonItemClass(t,!1),n.id=t+"_button",n.data={profile:t,profileData:e,plugin:this},$(n).click(function(t){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),n},onProfileChange:function(t){var e=this,n=this.buttonItems[t],i=this.buttonItems;Object.keys(i).forEach(function(t){e.buttonItems[t].className=e.getButtonItemClass(t,!1)}),n&&(n.className=e.getButtonItemClass(t,!0))},onItemClick:function(t,e,n){this.buttonItems[e]&&paella.player.setProfile(e),paella.player.controls.hidePopUp(this.getName())},getButtonItemClass:function(t,e){return"viewModeItemButton "+t+(e?" selected":"")}}),paella.plugins.viewModePlugin=new paella.plugins.ViewModePlugin,Class("paella.plugins.VolumeRangePlugin",paella.ButtonPlugin,{getAlignment:function(){return"left"},getSubclass:function(){return"volumeRangeButton"},getName:function(){return"es.upv.paella.volumeRangePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Volume")},getIndex:function(){return 120},_tempMasterVolume:0,_inputMaster:null,_control_NotMyselfEvent:!0,_storedValue:!1,closeOnMouseOut:function(){return!0},checkEnabled:function(t){t(!base.userAgent.browser.IsMobileVersion)},setup:function(){var t=this;paella.events.bind(paella.events.videoUnloaded,function(e,n){t.storeVolume()}),paella.events.bind(paella.events.singleVideoReady,function(e,n){t.loadStoredVolume(n)}),paella.events.bind(paella.events.setVolume,function(e,n){t.updateVolumeOnEvent(n)})},updateVolumeOnEvent:function(t){var e=this;e._control_NotMyselfEvent?e._inputMaster=t.master:e._control_NotMyselfEvent=!0},storeVolume:function(){var t=this;paella.player.videoContainer.mainAudioPlayer().volume().then(function(e){t._tempMasterVolume=e,t._storedValue=!0})},loadStoredVolume:function(t){0==this._storedValue&&this.storeVolume(),this._tempMasterVolume&&paella.player.videoContainer.setVolume({master:this._tempMasterVolume}),this._storedValue=!1},buildContent:function(t){function e(){var t=$(o).val();i._control_NotMyselfEvent=!1,paella.player.videoContainer.setVolume({master:t})}var n=this,i=this,r=document.createElement("div");r.className="videoRangeContainer";var a=document.createElement("div");a.className="range";var s=document.createElement("div");s.className="image master";var o=document.createElement("input");i._inputMaster=o,o.type="range",o.min=0,o.max=1,o.step=.01,paella.player.videoContainer.masterVideo().volume().then(function(t){o.value=t}),$(o).bind("input",function(t){e()}),$(o).change(function(){e()}),a.appendChild(s),a.appendChild(o),r.appendChild(a),paella.events.bind(paella.events.setVolume,function(t,e){o.value=e.master,n.updateClass()}),t.appendChild(r),i.updateClass()},updateClass:function(){var t="",e=this;paella.player.videoContainer.mainAudioPlayer().volume().then(function(n){t=void 0===n?"med":0==n?"mute":n<.33?"min":n<.66?"med":"max",e.button.className=["buttonPlugin",e.getAlignment(),e.getSubclass(),t].join(" ")})}}),paella.plugins.volumeRangePlugin=new paella.plugins.VolumeRangePlugin,Class("paella.videoFactories.WebmVideoFactory",{webmCapable:function(){var t=document.createElement("video");return!!t.canPlayType&&""!==t.canPlayType('video/webm; codecs="vp8, vorbis"')},isStreamCompatible:function(t){try{if(!this.webmCapable())return!1;for(var e in t.sources)if("webm"==e)return!0}catch(t){}return!1},getVideoObject:function(t,e,n){return new paella.Html5Video(t,e,n.x,n.y,n.w,n.h,"webm")}}),Class("paella.plugins.WindowTitlePlugin",paella.EventDrivenPlugin,{_initDone:!1,getName:function(){return"es.upv.paella.windowTitlePlugin"},checkEnabled:function(t){var e=this;paella.player.videoContainer.masterVideo().duration().then(function(t){e.loadTitle()}),t(!0)},loadTitle:function(){var t=paella.player.videoLoader.getMetadata()&&paella.player.videoLoader.getMetadata().title;document.title=t||document.title,this._initDone=!0}}),paella.plugins.windowTitlePlugin=new paella.plugins.WindowTitlePlugin,Class("paella.YoutubeVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_readyPromise:null,initialize:function(t,e,n,i,r,a){this.parent(t,e,"div",n,i,r,a);var s=this;this._readyPromise=$.Deferred(),Object.defineProperty(this,"video",{get:function(){return s._youtubePlayer}})},_deferredAction:function(t){var e=this;return new Promise(function(n,i){e._readyPromise.then(function(){n(t())},function(){i()})})},_getQualityObject:function(t,e){var n=0;switch(e){case"small":n=1;break;case"medium":n=2;break;case"large":n=3;break;case"hd720":n=4;break;case"hd1080":n=5;break;case"highres":n=6}return{index:t,res:{w:null,h:null},src:null,label:e,level:n,bitrate:n,toString:function(){return this.label},shortLabel:function(){return this.label},compare:function(t){return this.level-t.level}}},_onStateChanged:function(t){console.log("On state changed")},getVideoData:function(){var t=this,e=this;return new Promise(function(n,i){var r=t._stream.sources.youtube[0];t._deferredAction(function(){var t={duration:e.video.getDuration(),currentTime:e.video.getCurrentTime(),volume:e.video.getVolume(),paused:!e._playing,ended:e.video.ended,res:{w:r.res.w,h:r.res.h}};n(t)})})},setPosterFrame:function(t){this._posterFrame=t},setAutoplay:function(t){this._autoplay=t},setRect:function(t,e){this._rect=JSON.parse(JSON.stringify(t));var n=new paella.RelativeVideoSize,i=n.percentVSize(t.top)+"%",r=n.percentWSize(t.left)+"%",a=n.percentWSize(t.width)+"%",s=n.percentVSize(t.height)+"%",o={top:i,left:r,width:a,height:s,position:"absolute"};if(e){this.disableClassName();var u=this;$("#"+this.identifier).animate(o,400,function(){u.enableClassName(),paella.events.trigger(paella.events.setComposition,{video:u})}),this.enableClassNameAfter(400)}else $("#"+this.identifier).css(o),paella.events.trigger(paella.events.setComposition,{video:this})},setVisible:function(t,e){"true"==t&&e?($("#"+this.identifier).show(),$("#"+this.identifier).animate({opacity:1},300)):"true"!=t||e?"false"==t&&e?$("#"+this.identifier).animate({opacity:0},300):"false"!=t||e||$("#"+this.identifier).hide():$("#"+this.identifier).show()},setLayer:function(t){$("#"+this.identifier).css({zIndex:t})},load:function(){var t=this,e=this;return new Promise(function(n,i){t._qualityListReadyPromise=$.Deferred(),paella.youtubePlayerVars.apiReadyPromise.then(function(){var r=t._stream.sources.youtube[0];r?(t._youtubePlayer=new YT.Player(e.identifier,{height:"390",width:"640",videoId:r.id,playerVars:{controls:0,disablekb:1},events:{onReady:function(t){e._readyPromise.resolve()},onStateChanged:function(t){console.log("state changed")},onPlayerStateChange:function(t){console.log("state changed")}}}),n()):i(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){var t=this;return new Promise(function(e,n){t._qualityListReadyPromise.then(function(n){var i=[],r=-1;t._qualities={},n.forEach(function(e){r++,t._qualities[e]=t._getQualityObject(r,e),i.push(t._qualities[e])}),e(i)})})},setQuality:function(t){var e=this;return new Promise(function(n,i){e._qualityListReadyPromise.then(function(i){for(var r in e._qualities){var a=e._qualities[r];if("object"==$traceurRuntime.typeof(a)&&a.index==t){e.video.setPlaybackQuality(a.label);break}}n()})})},getCurrentQuality:function(){var t=this;return new Promise(function(e,n){t._qualityListReadyPromise.then(function(n){e(t._qualities[t.video.getPlaybackQuality()])})})},play:function(){var t=this,e=this;return new Promise(function(n,i){e._playing=!0,e.video.playVideo(),new base.Timer(function(e){var i=t.video.getAvailableQualityLevels();i.length?(e.repeat=!1,t._qualityListReadyPromise.resolve(i),n()):e.repeat=!0},500)})},pause:function(){var t=this;return this._deferredAction(function(){t._playing=!1,t.video.pauseVideo()})},isPaused:function(){var t=this;return this._deferredAction(function(){return!t._playing})},duration:function(){var t=this;return this._deferredAction(function(){return t.video.getDuration()})},setCurrentTime:function(t){var e=this;return this._deferredAction(function(){e.video.seekTo(t)})},currentTime:function(){var t=this;return this._deferredAction(function(){return t.video.getCurrentTime()})},setVolume:function(t){var e=this;return this._deferredAction(function(){e.video.setVolume&&e.video.setVolume(100*t)})},volume:function(){var t=this;return this._deferredAction(function(){return t.video.getVolume()/100})},setPlaybackRate:function(t){var e=this;return this._deferredAction(function(){e.video.playbackRate=t})},playbackRate:function(){var t=this;return this._deferredAction(function(){return t.video.playbackRate})},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){var t=this;return this._deferredAction(function(){var e=document.getElementById(t.video.className+"canvas");$(e).remove()})},freeze:function(){var t=this;return this._deferredAction(function(){var e=document.createElement("canvas");e.id=t.video.className+"canvas",e.width=t.video.videoWidth,e.height=t.video.videoHeight,e.style.cssText=t.video.style.cssText,e.style.zIndex=2,e.getContext("2d").drawImage(t.video,0,0,16*Math.ceil(e.width/16),16*Math.ceil(e.height/16)),t.video.parentElement.appendChild(e)})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.YoutubeVideoFactory",{initYoutubeApi:function(){if(!this._initialized){var t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e),paella.youtubePlayerVars={apiReadyPromise:new $.Deferred},this._initialized=!0}},isStreamCompatible:function(t){try{for(var e in t.sources)if("youtube"==e)return!0}catch(t){}return!1},getVideoObject:function(t,e,n){return this.initYoutubeApi(),new paella.YoutubeVideo(t,e,n.x,n.y,n.w,n.h)}}),Class("paella.ZoomPlugin",paella.EventDrivenPlugin,{_zImages:null,_imageNumber:null,_isActivated:!1,_isCreated:!1,_keys:null,_ant:null,_next:null,_videoLength:null,_compChanged:!1,_restartPlugin:!1,_actualImage:null,_zoomIncr:null,_maxZoom:null,_minZoom:null,_dragMode:!1,_mouseDownPosition:null,getIndex:function(){return 20},getAlignment:function(){return"right"},getSubclass:function(){return"zoomButton"},getDefaultToolTip:function(){return base.dictionary.translate("Zoom")},getEvents:function(){return[paella.events.timeUpdate,paella.events.setComposition,paella.events.loadPlugins,paella.events.play]},onEvent:function(t,e){switch(t){case paella.events.timeUpdate:this.imageUpdate(t,e);break;case paella.events.setComposition:this.compositionChanged(t,e);break;case paella.events.loadPlugins:this.loadPlugin(t,e);break;case paella.events.play:this.exitPhotoMode()}},checkEnabled:function(t){if(paella.player.videoContainer.sourceData.length<2)return void t(!1);t(!!paella.player.videoContainer.sourceData[0].sources.hasOwnProperty("image"))},setupIcons:function(){var t=this,e=$(".zoomFrame").width(),n=document.createElement("div");n.className="arrowsLeft",n.style.display="none";var i=document.createElement("div");i.className="arrowsRight",i.style.display="none",i.style.left=e-24+"px",$(n).click(function(){t.arrowCallLeft(),event.stopPropagation()}),$(i).click(function(){t.arrowCallRight(),event.stopPropagation()});var r=document.createElement("div");r.className="iconsFrame";var a=document.createElement("button");a.className="zoomActionButton buttonZoomIn",a.style.display="none";var s=document.createElement("button");s.className="zoomActionButton buttonZoomOut",s.style.display="none";var o=document.createElement("button");o.className="zoomActionButton buttonSnapshot",o.style.display="none";var u=document.createElement("button");u.className="zoomActionButton buttonZoomOn",$(r).append(u),$(r).append(o),$(r).append(a),$(r).append(s),$(".newframe").append(r),$(".newframe").append(n),$(".newframe").append(i),$(u).click(function(){t._isActivated?(t.exitPhotoMode(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked")):(t.enterPhotoMode(),$(".zoomActionButton.buttonZoomOn").addClass("clicked")),event.stopPropagation()}),$(o).click(function(){null!=t._actualImage&&window.open(t._actualImage,"_blank"),event.stopPropagation()}),$(a).click(function(){t.zoomIn(),event.stopPropagation()}),$(s).click(function(){t.zoomOut(),event.stopPropagation()})},enterPhotoMode:function(){var t=this;$(".zoomFrame").show(),$(".zoomFrame").css("opacity","1"),this._isActivated=!0,$(".buttonSnapshot").show(),$(".buttonZoomOut").show(),$(".buttonZoomIn").show(),$(".arrowsRight").show(),$(".arrowsLeft").show(),paella.player.pause(),t._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),t._imageNumber>=t._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()},exitPhotoMode:function(){$(".zoomFrame").hide(),this._isActivated=!1,$(".buttonSnapshot").hide(),$(".buttonZoomOut").hide(),$(".buttonZoomIn").hide(),$(".arrowsRight").hide(),$(".arrowsLeft").hide(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked")},setup:function(){var t=this;t._maxZoom=t.config.maxZoom||500,t._minZoom=t.config.minZoom||100,t._zoomIncr=t.config.zoomIncr||10,this._zImages={},this._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,this._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,this._keys=Object.keys(this._zImages),this._keys=this._keys.sort(function(t,e){return t=t.slice(6),e=e.slice(6),parseInt(t)-parseInt(e)}),this._next=0,this._ant=0},loadPlugin:function(){var t=this;0==t._isCreated&&(t.createOverlay(),t.setupIcons(),$(".zoomFrame").hide(),t._isActivated=!1,t._isCreated=!0)},imageUpdate:function(t,e){var n=this,i=Math.round(e.currentTime),r=$(".zoomFrame").css("background-image");if($(".newframe").length>0){if(this._zImages.hasOwnProperty("frame_"+i)){if(r==this._zImages["frame_"+i])return;r=this._zImages["frame_"+i]}else{if(!(i>this._next||i<this._ant||n._compChanged))return;n._compChanged&&(n._compChanged=!1),r=n.returnSrc(i)}$("#photo_01").attr("src",r).load();var a=new Image;a.onload=function(){$(".zoomFrame").css("background-image","url("+r+")")},a.src=r,n._actualImage=r,n._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),n._imageNumber>=n._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()}},returnSrc:function(t){var e=0;for(i=0;i<this._keys.length;i++){var n=parseInt(this._keys[i].slice(6)),r=parseInt(this._keys[this._keys.length-1].slice(6));if(t<n)return this._next=n,this._ant=e,this._imageNumber=i-1,this._zImages["frame_"+e];if(t>r&&t<this._videoLength)return this._next=this._videoLength,this._ant=r,this._zImages["frame_"+e];e=n}},arrowCallLeft:function(){var t=this;if(t._imageNumber-1>=0){var e=t._keys[t._imageNumber-1];t._imageNumber-=1,paella.player.videoContainer.seekToTime(parseInt(e.slice(6)))}},arrowCallRight:function(){var t=this;if(t._imageNumber+1<=t._keys.length){var e=t._keys[t._imageNumber+1];t._imageNumber+=1,paella.player.videoContainer.seekToTime(parseInt(e.slice(6)))}},createOverlay:function(){var t=this,e=document.createElement("div");e.className="newframe",overlayContainer=paella.player.videoContainer.overlayContainer,overlayContainer.addElement(e,overlayContainer.getMasterRect());var n=document.createElement("div");n.className="zoomFrame",e.insertBefore(n,e.firstChild),$(n).click(function(t){t.stopPropagation()}),$(n).bind("mousewheel",function(e){e.originalEvent.wheelDelta/120>0?t.zoomIn():t.zoomOut()}),$(n).mousedown(function(e){t.mouseDown(e.clientX,e.clientY)}),$(n).mouseup(function(e){t.mouseUp()}),$(n).mouseleave(function(e){t.mouseLeave()}),$(n).mousemove(function(e){t.mouseMove(e.clientX,e.clientY)})},mouseDown:function(t,e){this._dragMode=!0,this._mouseDownPosition={x:t,y:e}},mouseUp:function(){this._dragMode=!1},mouseLeave:function(){this._dragMode=!1},mouseMove:function(t,e){if(this._dragMode){var n=($(".zoomFrame")[0],this._backgroundPosition?this._backgroundPosition:{left:0,top:0}),i=($(".zoomFrame").width(),$(".zoomFrame").height(),this._mouseDownPosition.x-t),r=this._mouseDownPosition.y-e,a=n.left+i,s=n.top+r;a=a>=0?a:0,a=a<=100?a:100,s=s>=0?s:0,s=s<=100?s:100,$(".zoomFrame").css("background-position",a+"% "+s+"%"),this._backgroundPosition={left:a,top:s},this._mouseDownPosition.x=t,this._mouseDownPosition.y=e}},zoomIn:function(){var t=this;z=$(".zoomFrame").css("background-size"),z=z.split(" "),z=parseInt(z[0]),z<t._maxZoom&&$(".zoomFrame").css("background-size",z+t._zoomIncr+"% auto")},zoomOut:function(){var t=this;z=$(".zoomFrame").css("background-size"),z=z.split(" "),z=parseInt(z[0]),z>t._minZoom&&$(".zoomFrame").css("background-size",z-t._zoomIncr+"% auto")},imageUpdateOnPause:function(t){var e=this,n=Math.round(t),i=$(".zoomFrame").css("background-image");if($(".newframe").length>0&&i!=e._actualImage){if(this._zImages.hasOwnProperty("frame_"+n)){if(i==this._zImages["frame_"+n])return;i=this._zImages["frame_"+n]}else e._compChanged&&(e._compChanged=!1),i=e.returnSrc(n);$("#photo_01").attr("src",i).load();var r=new Image;r.onload=function(){$(".zoomFrame").css("background-image","url("+i+")")},r.src=i,e._actualImage=i}},compositionChanged:function(t,e){var n=this;$(".newframe").remove(),n._isCreated=!1,paella.player.videoContainer.getMasterVideoRect().visible&&(n.loadPlugin(),paella.player.paused()&&paella.player.videoContainer.currentTime().then(function(t){n.imageUpdateOnPause(t)})),n._compChanged=!0},getName:function(){return"es.upv.paella.zoomPlugin"}}),paella.plugins.zoomPlugin=new paella.ZoomPlugin;