"use strict";var GlobalParams={video:{zIndex:1},background:{zIndex:0}},paella={};function paella_DeferredResolved(t){return new Promise(function(e){e(t)})}function paella_DeferredRejected(n){return new Promise(function(e,t){t(n)})}function paella_DeferredNotImplemented(){return paella_DeferredRejected(new Error("not implemented"))}paella.player=null,paella.version="5.2.19 - build: 6ccde2a",paella.events={play:"paella:play",pause:"paella:pause",next:"paella:next",previous:"paella:previous",seeking:"paella:seeking",seeked:"paella:seeked",timeupdate:"paella:timeupdate",timeUpdate:"paella:timeupdate",seekTo:"paella:setseek",endVideo:"paella:endvideo",seekToTime:"paella:seektotime",setTrim:"paella:settrim",setPlaybackRate:"paella:setplaybackrate",setVolume:"paella:setVolume",setComposition:"paella:setComposition",loadStarted:"paella:loadStarted",loadComplete:"paella:loadComplete",loadPlugins:"paella:loadPlugins",error:"paella:error",setProfile:"paella:setprofile",documentChanged:"paella:documentChanged",didSaveChanges:"paella:didsavechanges",controlBarWillHide:"paella:controlbarwillhide",controlBarDidHide:"paella:controlbardidhide",controlBarDidShow:"paella:controlbardidshow",hidePopUp:"paella:hidePopUp",showPopUp:"paella:showPopUp",enterFullscreen:"paella:enterFullscreen",exitFullscreen:"paella:exitFullscreen",resize:"paella:resize",videoZoomChanged:"paella:videoZoomChanged",audioLanguageChanged:"paella:audiolanguagechanged",zoomAvailabilityChanged:"paella:zoomavailabilitychanged",qualityChanged:"paella:qualityChanged",singleVideoReady:"paella:singleVideoReady",singleVideoUnloaded:"paella:singleVideoUnloaded",videoReady:"paella:videoReady",videoUnloaded:"paella:videoUnloaded",controlBarLoaded:"paella:controlBarLoaded",flashVideoEvent:"paella:flashVideoEvent",captionAdded:"paella:caption:add",captionsEnabled:"paella:caption:enabled",captionsDisabled:"paella:caption:disabled",trigger:function(e,t){$(document).trigger(e,t)},bind:function(e,n){$(document).bind(e,function(e,t){n(e,t)})},setupExternalListener:function(){window.addEventListener("message",function(e){e.data&&e.data.event&&paella.events.trigger(e.data.event,e.data.params)},!1)}},paella.events.setupExternalListener(),Class("paella.MouseManager",{targetObject:null,initialize:function(){var t=this;paella.events.bind("mouseup",function(e){t.up(e)}),paella.events.bind("mousemove",function(e){t.move(e)}),paella.events.bind("mouseover",function(e){t.over(e)})},down:function(e,t){return this.targetObject=e,this.targetObject&&this.targetObject.down&&(this.targetObject.down(t,t.pageX,t.pageY),t.cancelBubble=!0),!1},up:function(e){return this.targetObject&&this.targetObject.up&&(this.targetObject.up(e,e.pageX,e.pageY),e.cancelBubble=!0),this.targetObject=null,!1},out:function(e){return this.targetObject&&this.targetObject.out&&(this.targetObject.out(e,e.pageX,e.pageY),e.cancelBubble=!0),!1},move:function(e){return this.targetObject&&this.targetObject.move&&(this.targetObject.move(e,e.pageX,e.pageY),e.cancelBubble=!0),!1},over:function(e){return this.targetObject&&this.targetObject.over&&(this.targetObject.over(e,e.pageX,e.pageY),e.cancelBubble=!0),!1}}),paella.utils={mouseManager:new paella.MouseManager,folders:{get:function(e){if(paella.player&&paella.player.config&&paella.player.config.folders&&paella.player.config.folders[e])return paella.player.config.folders[e]},profiles:function(){return paella.utils.folders.get("profiles")||"config/profiles"},resources:function(){return paella.utils.folders.get("resources")||"resources"},skins:function(){return paella.utils.folders.get("skins")||paella.utils.folders.get("resources")+"/style"}},styleSheet:{removeById:function(e){var t=$(document.head).find("#"+e)[0];t&&document.head.removeChild(t)},remove:function(e){for(var t=document.head.getElementsByTagName("link"),n=0;n<t.length;++n)if(t[n].href){document.head.removeChild(t[n]);break}},add:function(e,t){var n=document.createElement("link");n.rel="stylesheet",n.href=e,n.type="text/css",n.media="screen",n.charset="utf-8",t&&(n.id=t),document.head.appendChild(n)},swap:function(e,t){this.remove(e),this.add(t)}},skin:{set:function(e){paella.utils.styleSheet.removeById("paellaSkin"),paella.utils.styleSheet.add(paella.utils.folders.skins()+"/style_"+e+".css"),base.cookies.set("skin",e)},restore:function(e){var t=base.cookies.get("skin");t&&""!=t?this.set(t):this.set(e)}},timeParse:{timeToSeconds:function(e){var t=0,n=0,a=0;return/([0-9]+)h/i.test(e)&&(t=60*parseInt(RegExp.$1)*60),/([0-9]+)m/i.test(e)&&(n=60*parseInt(RegExp.$1)),/([0-9]+)s/i.test(e)&&(a=parseInt(RegExp.$1)),t+n+a},secondsToTime:function(e){var t=~~(e/3600);t<10&&(t="0"+t);var n=~~(e%3600/60);n<10&&(n="0"+n);var a=Math.floor(e%60);return a<10&&(a="0"+a),t+":"+n+":"+a},secondsToText:function(e){if(e<=1)return base.dictionary.translate("1 second ago");if(e<60)return base.dictionary.translate("{0} seconds ago").replace(/\{0\}/g,e);var t=Math.round(e/60);if(t<=1)return base.dictionary.translate("1 minute ago");if(t<60)return base.dictionary.translate("{0} minutes ago").replace(/\{0\}/g,t);var n=Math.round(e/3600);if(n<=1)return base.dictionary.translate("1 hour ago");if(n<24)return base.dictionary.translate("{0} hours ago").replace(/\{0\}/g,n);var a=Math.round(e/86400);if(a<=1)return base.dictionary.translate("1 day ago");if(a<24)return base.dictionary.translate("{0} days ago").replace(/\{0\}/g,a);var i=Math.round(e/2592e3);if(i<=1)return base.dictionary.translate("1 month ago");if(i<12)return base.dictionary.translate("{0} months ago").replace(/\{0\}/g,i);var r=Math.round(e/31536e3);return r<=1?base.dictionary.translate("1 year ago"):base.dictionary.translate("{0} years ago").replace(/\{0\}/g,r)},matterhornTextDateToDate:function(e){var t=new Date;return t.setFullYear(parseInt(e.substring(0,4),10)),t.setMonth(parseInt(e.substring(5,7),10)-1),t.setDate(parseInt(e.substring(8,10),10)),t.setHours(parseInt(e.substring(11,13),10)),t.setMinutes(parseInt(e.substring(14,16),10)),t.setSeconds(parseInt(e.substring(17,19),10)),t}}},Class("paella.DataDelegate",{read:function(e,t,n){"function"==typeof n&&n({},!0)},write:function(e,t,n,a){"function"==typeof a&&a({},!0)},remove:function(e,t,n){"function"==typeof n&&n({},!0)}}),paella.dataDelegates={},Class("paella.dataDelegates.CookieDataDelegate",paella.DataDelegate,{initialize:function(){},serializeKey:function(e,t){return"object"==$traceurRuntime.typeof(t)&&(t=JSON.stringify(t)),e+"|"+t},read:function(e,t,n){var a=this.serializeKey(e,t),i=base.cookies.get(a);try{i=unescape(i),i=JSON.parse(i)}catch(e){}"function"==typeof n&&n(i,!0)},write:function(e,t,n,a){var i=this.serializeKey(e,t);"object"==$traceurRuntime.typeof(n)&&(n=JSON.stringify(n)),n=escape(n),base.cookies.set(i,n),"function"==typeof a&&a({},!0)},remove:function(e,t,n){var a=this.serializeKey(e,t);"object"==$traceurRuntime.typeof(value)&&(value=JSON.stringify(value)),base.cookies.set(a,""),"function"==typeof n&&n({},!0)}}),paella.dataDelegates.DefaultDataDelegate=paella.dataDelegates.CookieDataDelegate,Class("paella.Data",{enabled:!1,dataDelegates:{},initialize:function(e){for(var t in this.enabled=e.data.enabled,e.data.dataDelegates)try{var n=e.data.dataDelegates[t],a=new paella.dataDelegates[n];this.dataDelegates[t]=a}catch(e){base.log.debug("Warning: delegate not found - "+n)}this.dataDelegates.default||(this.dataDelegates.default=new paella.dataDelegates.DefaultDataDelegate)},read:function(e,t,n){this.getDelegate(e).read(e,t,n)},write:function(e,t,n,a){this.getDelegate(e).write(e,t,n,a)},remove:function(e,t,n){this.getDelegate(e).remove(e,t,n)},getDelegate:function(e){return this.dataDelegates[e]?this.dataDelegates[e]:this.dataDelegates.default}}),paella.data=null,Class("paella.MessageBox",{modalContainerClassName:"modalMessageContainer",frameClassName:"frameContainer",messageClassName:"messageContainer",errorClassName:"errorContainer",currentMessageBox:null,messageContainer:null,onClose:null,initialize:function(){var t=this;$(window).resize(function(e){t.adjustTop()})},showFrame:function(e,t){var n=!0,a="80%",i="80%",r=null;t&&(n=t.closeButton,a=t.width,i=t.height,r=t.onClose),this.doShowFrame(e,n,a,i,r)},doShowFrame:function(e,t,n,a,i){this.onClose=i,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close(),n||(n="80%"),a||(a="80%");var r=document.createElement("div");r.className=this.modalContainerClassName,r.style.position="fixed",r.style.top="0px",r.style.left="0px",r.style.right="0px",r.style.bottom="0px",r.style.zIndex=999999;var o=document.createElement("div");o.className=this.frameClassName,o.style.width=n,o.style.height=a,o.style.position="relative",r.appendChild(o);var l=document.createElement("iframe");l.src=e,l.setAttribute("frameborder","0"),l.style.width="100%",l.style.height="100%",o.appendChild(l),paella.player.isFullScreen()?paella.player.mainContainer.appendChild(r):$("body")[0].appendChild(r),this.currentMessageBox=r,this.messageContainer=o;this.adjustTop(),t&&this.createCloseButton()},showElement:function(e,t){var n=!0,a="60%",i="40%",r=null,o=this.messageClassName;t&&(o=t.className,n=t.closeButton,a=t.width,i=t.height,r=t.onClose),this.doShowElement(e,n,a,i,o,r)},showMessage:function(e,t){var n=!0,a="60%",i="40%",r=null,o=this.messageClassName;t&&(o=t.className,n=t.closeButton,a=t.width,i=t.height,r=t.onClose),this.doShowMessage(e,n,a,i,o,r)},doShowElement:function(e,t,n,a,i,r){this.onClose=r,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close(),i||(i=this.messageClassName),n||(n="80%"),a||(a="30%");var o=document.createElement("div");o.className=this.modalContainerClassName,o.style.position="fixed",o.style.top="0px",o.style.left="0px",o.style.right="0px",o.style.bottom="0px",o.style.zIndex=999999;var l=document.createElement("div");l.className=i,l.style.width=n,l.style.height=a,l.style.position="relative",l.appendChild(e),o.appendChild(l),$("body")[0].appendChild(o),this.currentMessageBox=o,this.messageContainer=l;this.adjustTop(),t&&this.createCloseButton()},doShowMessage:function(e,t,n,a,i,r){this.onClose=r,$("#playerContainer").addClass("modalVisible"),this.currentMessageBox&&this.close(),i||(i=this.messageClassName),n||(n="80%"),a||(a="30%");var o=document.createElement("div");o.className=this.modalContainerClassName,o.style.position="fixed",o.style.top="0px",o.style.left="0px",o.style.right="0px",o.style.bottom="0px",o.style.zIndex=999999;var l=document.createElement("div");l.className=i,l.style.width=n,l.style.height=a,l.style.position="relative",l.innerHTML=e,o.appendChild(l),$("body")[0].appendChild(o),this.currentMessageBox=o,this.messageContainer=l;this.adjustTop(),t&&this.createCloseButton()},showError:function(e,t){var n=!1,a="60%",i="20%",r=null;t&&(n=t.closeButton,a=t.width,i=t.height,r=t.onClose),this.doShowError(e,n,a,i,r)},doShowError:function(e,t,n,a,i){this.doShowMessage(e,t,n,a,this.errorClassName,i)},createCloseButton:function(){if(this.messageContainer){var t=this,e=document.createElement("div");this.messageContainer.appendChild(e),e.className="paella_messageContainer_closeButton",$(e).click(function(e){t.onCloseButtonClick()})}},adjustTop:function(){if(this.currentMessageBox){var e=$(this.messageContainer).outerHeight(),t=$(this.currentMessageBox).height()/2-e/2;this.messageContainer.style.marginTop=t+"px"}},close:function(){if(this.currentMessageBox&&this.currentMessageBox.parentNode){var e=this.currentMessageBox,t=e.parentNode;$("#playerContainer").removeClass("modalVisible"),$(e).animate({opacity:0},300,function(){t.removeChild(e)}),this.onClose&&this.onClose()}},onCloseButtonClick:function(){this.close()}}),paella.messageBox=new paella.MessageBox,paella.AntiXSS={htmlEscape:function(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlUnescape:function(e){return String(e).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}},Class("paella.Node",{identifier:"",nodeList:null,parent:null,initialize:function(e){this.nodeList={},this.identifier=e},addTo:function(e){e.addNode(this)},addNode:function(e){return(e.parent=this).nodeList[e.identifier]=e},getNode:function(e){return this.nodeList[e]},removeNode:function(e){return!!this.nodeList[e.identifier]&&(delete this.nodeList[e.identifier],!0)}}),Class("paella.DomNode",paella.Node,{domElement:null,initialize:function(e,t,n){this.parent(t),this.domElement=document.createElement(e),this.domElement.id=t,n&&$(this.domElement).css(n)},addNode:function(e){var t=this.parent(e);return this.domElement.appendChild(e.domElement),t},onresize:function(){},removeNode:function(e){this.parent(e)&&this.domElement.removeChild(e.domElement)}}),Class("paella.Button",paella.DomNode,{isToggle:!1,initialize:function(e,t,n,a){this.isToggle=a;if(this.parent("div",e,{}),this.domElement.className=t,a){var i=this;$(this.domElement).click(function(e){i.toggleIcon()})}$(this.domElement).click("click",n)},isToggled:function(){if(this.isToggle){var e=this.domElement;return/([a-zA-Z0-9_]+)_active/.test(e.className)}return!1},toggle:function(){this.toggleIcon()},toggleIcon:function(){var e=this.domElement;/([a-zA-Z0-9_]+)_active/.test(e.className)?e.className=RegExp.$1:e.className=e.className+"_active"},show:function(){$(this.domElement).show()},hide:function(){$(this.domElement).hide()},visible:function(){return this.domElement.visible()}}),Class("paella.VideoQualityStrategy",{getParams:function(){return paella.player.config.player.videoQualityStrategyParams||{}},getQualityIndex:function(e){return 0<e.length?e[e.length-1]:e}}),Class("paella.BestFitVideoQualityStrategy",paella.VideoQualityStrategy,{getQualityIndex:function(e){var t=e.length-1;if(0<e.length){var n=e[0],a=$(window).width()*$(window).height();if(n.res&&n.res.w&&n.res.h)for(var i=parseInt(n.res.w)*parseInt(n.res.h),r=Math.abs(a-i),o=0;o<e.length;++o){if(e[o].res){var l=parseInt(e[o].res.w)*parseInt(e[o].res.h),s=Math.abs(a-l);s<=r&&(r=s,t=o)}}}return t}}),Class("paella.LimitedBestFitVideoQualityStrategy",paella.VideoQualityStrategy,{getQualityIndex:function(e){var n=e.length-1,t=this.getParams();if(0<e.length){var a=$(window).height(),i=t.maxAutoQualityRes||720,r=Number.MAX_VALUE;e.forEach(function(e,t){e.res&&e.res.h<=i&&(Math.abs(a-e.res.h)<r&&(e,n=t))})}return n}}),Class("paella.VideoFactory",{isStreamCompatible:function(e){return!1},getVideoObject:function(e,t,n){return null}}),paella.videoFactory={_factoryList:[],initFactories:function(){if(paella.videoFactories){var t=this;paella.player.config.player.methods.forEach(function(e){e.enabled&&t.registerFactory(new paella.videoFactories[e.factory])}),this.registerFactory(new paella.videoFactories.EmptyVideoFactory)}},getVideoObject:function(e,t,n){0==this._factoryList.length&&this.initFactories();var a=null;return this._factoryList.some(function(e){if(e.isStreamCompatible(t))return a=e,!0})?a.getVideoObject(e,t,n):null},registerFactory:function(e){this._factoryList.push(e)}},function(){var e,t=(e=paella.DomNode,$traceurRuntime.createClass(function e(t,n){$traceurRuntime.superConstructor(e).call(this,"div",t),this._stream=n},{get stream(){return this._stream},setAutoplay:function(){return Promise.reject(new Error("no such compatible video player"))},load:function(){return Promise.reject(new Error("no such compatible video player"))},play:function(){return Promise.reject(new Error("no such compatible video player"))},pause:function(){return Promise.reject(new Error("no such compatible video player"))},isPaused:function(){return Promise.reject(new Error("no such compatible video player"))},duration:function(){return Promise.reject(new Error("no such compatible video player"))},setCurrentTime:function(e){return Promise.reject(new Error("no such compatible video player"))},currentTime:function(){return Promise.reject(new Error("no such compatible video player"))},setVolume:function(e){return Promise.reject(new Error("no such compatible video player"))},volume:function(){return Promise.reject(new Error("no such compatible video player"))},setPlaybackRate:function(e){return Promise.reject(new Error("no such compatible video player"))},playbackRate:function(){return Promise.reject(new Error("no such compatible video player"))},unload:function(){return Promise.reject(new Error("no such compatible video player"))},supportAutoplay:function(){return!1}},{},e));paella.AudioElementBase=t,paella.audioFactories={};var n=$traceurRuntime.createClass(function(){},{isStreamCompatible:function(e){return!1},getAudioObject:function(e,t){return null}},{});paella.AudioFactory=n,paella.audioFactory={_factoryList:[],initFactories:function(){if(paella.audioFactories){var t=this;paella.player.config.player.audioMethods=paella.player.config.player.audioMethods||{},paella.player.config.player.audioMethods.forEach(function(e){e.enabled&&t.registerFactory(new paella.audioFactories[e.factory])})}},getAudioObject:function(e,t){0==this._factoryList.length&&this.initFactories();var n=null;return this._factoryList.some(function(e){if(e.isStreamCompatible(t))return n=e,!0})?n.getAudioObject(e,t):null},registerFactory:function(e){this._factoryList.push(e)}}}(),function(){function a(a){var i=this;return new Promise(function(e,t){if(i._ready)e("function"!=typeof a||a());else{var n=function(){i.audio.readyState>=i.audio.HAVE_CURRENT_DATA?(i._ready=!0,e("function"!=typeof a||a())):setTimeout(n,50)};n()}})}var e,t=(e=paella.AudioElementBase,$traceurRuntime.createClass(function e(t,n){$traceurRuntime.superConstructor(e).call(this,t,n),this._streamName="audio",this._audio=document.createElement("audio"),this.domElement.appendChild(this._audio)},{get audio(){return this._audio},setAutoplay:function(e){this.audio.autoplay=e},load:function(){var e=this._stream.sources[this._streamName],t=0<e.length?e[0]:null;if(this.audio.innerText="",t){var n=this.audio.querySelector("source");return n||(n=document.createElement("source"),this.audio.appendChild(n)),n.src=t.src,t.type&&(n.type=t.type),this.audio.load(),a.apply(this,[function(){return t}])}return Promise.reject(new Error("Could not load video: invalid quality stream index"))},play:function(){var e=this;return a.apply(this,[function(){e.audio.play()}])},pause:function(){var e=this;return a.apply(this,[function(){e.audio.pause()}])},isPaused:function(){var e=this;return a.apply(this,[function(){return e.audio.paused}])},duration:function(){var e=this;return a.apply(this,[function(){return e.audio.duration}])},setCurrentTime:function(e){var t=this;return a.apply(this,[function(){t.audio.currentTime=e}])},currentTime:function(){var e=this;return a.apply(this,[function(){return e.audio.currentTime}])},setVolume:function(e){var t=this;return a.apply(this,[function(){return t.audio.volume=e}])},volume:function(){var e=this;return a.apply(this,[function(){return e.audio.volume}])},setPlaybackRate:function(e){var t=this;return a.apply(this,[function(){t.audio.playbackRate=e}])},playbackRate:function(){var e=this;return a.apply(this,[function(){return e.audio.playbackRate}])},unload:function(){return Promise.resolve()}},{},e));paella.MultiformatAudioElement=t;var n=$traceurRuntime.createClass(function(){},{isStreamCompatible:function(e){return!0},getAudioObject:function(e,t){return new paella.MultiformatAudioElement(e,t)}},{});paella.audioFactories.MultiformatAudioFactory=n}(),paella.Profiles={profileList:null,getDefaultProfile:function(){return paella.player.videoContainer.masterVideo()&&paella.player.videoContainer.masterVideo().defaultProfile()?paella.player.videoContainer.masterVideo().defaultProfile():paella.player&&paella.player.config&&paella.player.config.defaultProfile?paella.player.config.defaultProfile:void 0},loadProfile:function(n,a){var i=this.getDefaultProfile();this.loadProfileList(function(e){var t;if(e[n])t=e[n];else{if(!e[i])return base.log.debug("Error loading the default profile. Check your Paella Player configuration"),!1;t=e[i]}a(t)})},loadProfileList:function(a){var i=this;if(null==this.profileList){var e={url:paella.utils.folders.profiles()+"/profiles.json"};base.ajax.get(e,function(e,t,n){"string"==typeof e&&(e=JSON.parse(e)),i.profileList=e,a(i.profileList)},function(e,t,n){base.log.debug("Error loading video profiles. Check your Paella Player configuration")})}else a(i.profileList)}},Class("paella.RelativeVideoSize",{w:1280,h:720,proportionalHeight:function(e){return Math.floor(this.h*e/this.w)},proportionalWidth:function(e){return Math.floor(this.w*e/this.h)},percentVSize:function(e){return 100*e/this.h},percentWSize:function(e){return 100*e/this.w},aspectRatio:function(){return this.w/this.h}}),Class("paella.VideoRect",paella.DomNode,{_rect:null,initialize:function(e,t,n,a,i,r){var g=this,o=paella.player.config.player.videoZoom||{},l=(void 0===o.enabled||o.enabled)&&this.allowZoom();this.parent(t,e,l?{width:this._zoom+"%",height:"100%",position:"absolute"}:{width:"100%"});var s=document.createElement("div");if(setTimeout(function(){return g.domElement.parentElement.appendChild(s)},10),s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.style.right="0px",s.style.bottom="0px",l){var u=function(){var e=paella.player.config.player&&paella.player.config.player.videoZoom&&paella.player.config.player.videoZoom.minWindowSize||500,t=$(window).width()>=e;this._zoomAvailable!=t&&(this._zoomAvailable=t,paella.events.trigger(paella.events.zoomAvailabilityChanged,{available:t}))},c=function(e){return{x:e.originalEvent.offsetX,y:e.originalEvent.offsetY}},v=function(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},y=function(e){var t={x:this._mouseCenter.x-1.1*e.x,y:this._mouseCenter.y-1.1*e.y},n=$(this.domElement).width(),a=$(this.domElement).height(),i=this._zoom-100,r={x:t.x*i/n,y:t.y*i/a};r.x>i?r.x=i:r.x<0?r.x=0:this._mouseCenter.x=t.x,r.y>i?r.y=i:r.y<0?r.y=0:this._mouseCenter.y=t.y,$(this.domElement).css({left:"-"+r.x+"%",top:"-"+r.y+"%"}),this._zoomOffset={x:r.x,y:r.y},paella.events.trigger(paella.events.videoZoomChanged,{video:this})};this._zoomAvailable=!0,u.apply(this),$(window).resize(function(){u.apply(g)}),this._zoom=100,this._mouseCenter={x:0,y:0},this._mouseDown={x:0,y:0},this._zoomOffset={x:0,y:0},this._maxZoom=o.max||400,$(this.domElement).css({width:"100%",height:"100%",left:"0%",top:"0%"}),Object.defineProperty(this,"zoom",{get:function(){return this._zoom}}),Object.defineProperty(this,"zoomOffset",{get:function(){return this._zoomOffset}});var b=[];$(s).on("touchstart",function(e){if(g.allowZoom()&&g._zoomAvailable){b=[];for(var t=$(g.domElement).offset(),n=0;n<e.originalEvent.targetTouches.length;++n){var a=e.originalEvent.targetTouches[n];b.push({x:a.screenX-t.left,y:a.screenY-t.top})}1<b.length&&e.preventDefault()}}),$(s).on("touchmove",function(e){if(g.allowZoom()&&g._zoomAvailable){for(var t,n,a=[],i=$(g.domElement).offset(),r=0;r<e.originalEvent.targetTouches.length;++r){var o=e.originalEvent.targetTouches[r];a.push({x:o.screenX-i.left,y:o.screenY-i.top})}if(1<a.length&&1<b.length){var l=v(b[0],b[1]),s=v(a[0],a[1])-l,u=(t=b[0],{x:((n=b[1]).x-t.x)/2+t.x,y:(n.y-t.y)/2+t.y});g._mouseCenter=u,g._zoom+=s,g._zoom=g._zoom<100?100:g._zoom,g._zoom=g._zoom>g._maxZoom?g._maxZoom:g._zoom;var c=$(g.domElement).width(),d=$(g.domElement).height(),p=g._mouseCenter;$(g.domElement).css({width:g._zoom+"%",height:g._zoom+"%"});var m=g._zoom-100,h={x:p.x*m/c,y:p.y*m/d};h.x=h.x<m?h.x:m,h.y=h.y<m?h.y:m,$(g.domElement).css({left:"-"+h.x+"%",top:"-"+h.y+"%"}),g._zoomOffset={x:h.x,y:h.y},paella.events.trigger(paella.events.videoZoomChanged,{video:g}),b=a,e.preventDefault()}else if(0<a.length){var f={x:a[0].x-b[0].x,y:a[0].y-b[0].y};y.apply(g,[f]),b=a,e.preventDefault()}}}),$(s).on("touchend",function(e){g.allowZoom()&&g._zoomAvailable&&1<b.length&&e.preventDefault()}),this.zoomIn=function(){if(!(g._zoom>=g._maxZoom)&&g._zoomAvailable){g._mouseCenter||(g._mouseCenter={x:$(g.domElement).width()/2,y:$(g.domElement).height()/2}),g._zoom+=25,g._zoom=g._zoom<100?100:g._zoom,g._zoom=g._zoom>g._maxZoom?g._maxZoom:g._zoom;var e=$(g.domElement).width(),t=$(g.domElement).height(),n=g._mouseCenter;$(g.domElement).css({width:g._zoom+"%",height:g._zoom+"%"});var a=g._zoom-100,i={x:n.x*a/e,y:n.y*a/t};i.x=i.x<a?i.x:a,i.y=i.y<a?i.y:a,$(g.domElement).css({left:"-"+i.x+"%",top:"-"+i.y+"%"}),g._zoomOffset={x:i.x,y:i.y},paella.events.trigger(paella.events.videoZoomChanged,{video:g})}},this.zoomOut=function(){if(!(g._zoom<=100)&&g._zoomAvailable){g._mouseCenter||(g._mouseCenter={x:$(g.domElement).width()/2,y:$(g.domElement).height()/2}),g._zoom-=25,g._zoom=g._zoom<100?100:g._zoom,g._zoom=g._zoom>g._maxZoom?g._maxZoom:g._zoom;var e=$(g.domElement).width(),t=$(g.domElement).height(),n=g._mouseCenter;$(g.domElement).css({width:g._zoom+"%",height:g._zoom+"%"});var a=g._zoom-100,i={x:n.x*a/e,y:n.y*a/t};i.x=i.x<a?i.x:a,i.y=i.y<a?i.y:a,$(g.domElement).css({left:"-"+i.x+"%",top:"-"+i.y+"%"}),g._zoomOffset={x:i.x,y:i.y},paella.events.trigger(paella.events.videoZoomChanged,{video:g})}},$(s).on("mousewheel wheel",function(e){if(g.allowZoom()&&g._zoomAvailable){var t,n=c(e),a=(t=e.originalEvent.deltaY*(paella.utils.userAgent.Firefox?2:1),-Math.abs(t)<6?t:6*Math.sign(t));if(!(g._zoom>=g._maxZoom&&0<a)){g._zoom+=a,g._zoom=g._zoom<100?100:g._zoom,g._zoom=g._zoom>g._maxZoom?g._maxZoom:g._zoom;var i=$(g.domElement).width(),r=$(g.domElement).height();$(g.domElement).css({width:g._zoom+"%",height:g._zoom+"%"});var o=g._zoom-100,l={x:n.x*o/i,y:n.y*o/r};l.x=l.x<o?l.x:o,l.y=l.y<o?l.y:o,$(g.domElement).css({left:"-"+l.x+"%",top:"-"+l.y+"%"}),g._zoomOffset={x:l.x,y:l.y},paella.events.trigger(paella.events.videoZoomChanged,{video:g}),g._mouseCenter=n}}}),$(s).on("mousedown",function(e){g._mouseDown=c(e),g.drag=!0}),$(s).on("mousemove",function(e){if(g.allowZoom()&&g._zoomAvailable&&g.drag){paella.player.videoContainer.disablePlayOnClick();var t=c(e);y.apply(g,[{x:t.x-g._mouseDown.x,y:t.y-g._mouseDown.y}]),g._mouseDown=t}}),$(s).on("mouseup",function(e){g.allowZoom()&&g._zoomAvailable&&(g.drag=!1,setTimeout(function(){return paella.player.videoContainer.enablePlayOnClick()},10))}),$(s).on("mouseleave",function(e){g.drag=!1})}},allowZoom:function(){return!0},captureFrame:function(){return Promise.resolve(null)},supportsCaptureFrame:function(){return Promise.resolve(!1)},zoomAvailable:function(){return this.allowZoom()&&this._zoomAvailable}}),Class("paella.VideoElementBase",paella.VideoRect,{_ready:!1,_autoplay:!1,_stream:null,_videoQualityStrategy:null,initialize:function(e,t,n,a,i,r,o){this._stream=t,this.parent(e,n,a,i,r,o),Object.defineProperty(this,"ready",{get:function(){return this._ready}}),Object.defineProperty(this,"stream",{get:function(){return this._stream}}),this._stream.preview&&this.setPosterFrame(this._stream.preview)},defaultProfile:function(){return null},setVideoQualityStrategy:function(e){this._videoQualityStrategy=e},setPosterFrame:function(e){base.log.debug("TODO: implement setPosterFrame() function")},setAutoplay:function(e){this._autoplay=e},setMetadata:function(e){this._metadata=e},load:function(){return paella_DeferredNotImplemented()},supportAutoplay:function(){return!0},getVideoData:function(){return paella_DeferredNotImplemented()},play:function(){return base.log.debug("TODO: implement play() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},pause:function(){return base.log.debug("TODO: implement pause() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},isPaused:function(){return base.log.debug("TODO: implement isPaused() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},duration:function(){return base.log.debug("TODO: implement duration() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setCurrentTime:function(e){return base.log.debug("TODO: implement setCurrentTime() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},currentTime:function(){return base.log.debug("TODO: implement currentTime() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setVolume:function(e){return base.log.debug("TODO: implement setVolume() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},volume:function(){return base.log.debug("TODO: implement volume() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setPlaybackRate:function(e){return base.log.debug("TODO: implement setPlaybackRate() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},playbackRate:function(){return base.log.debug("TODO: implement playbackRate() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},getQualities:function(){return paella_DeferredNotImplemented()},setQuality:function(e){return paella_DeferredNotImplemented()},getCurrentQuality:function(){return paella_DeferredNotImplemented()},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()},goFullScreen:function(){return paella_DeferredNotImplemented()},freeze:function(){return paella_DeferredNotImplemented()},unFreeze:function(){return paella_DeferredNotImplemented()},setClassName:function(e){this.domElement.className=e},_callReadyEvent:function(){paella.events.trigger(paella.events.singleVideoReady,{sender:this})},_callUnloadEvent:function(){paella.events.trigger(paella.events.singleVideoUnloaded,{sender:this})}}),Class("paella.EmptyVideo",paella.VideoElementBase,{initialize:function(e,t,n,a,i,r){this.parent(e,t,"div",n,a,i,r)},setPosterFrame:function(e){},setAutoplay:function(e){},load:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},play:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},pause:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},isPaused:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},duration:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setCurrentTime:function(e){return paella_DeferredRejected(new Error("no such compatible video player"))},currentTime:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setVolume:function(e){return paella_DeferredRejected(new Error("no such compatible video player"))},volume:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setPlaybackRate:function(e){return paella_DeferredRejected(new Error("no such compatible video player"))},playbackRate:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},unFreeze:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},freeze:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},unload:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},getDimensions:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}}),Class("paella.videoFactories.EmptyVideoFactory",paella.VideoFactory,{isStreamCompatible:function(e){return!0},getVideoObject:function(e,t,n){return new paella.EmptyVideo(e,t,n.x,n.y,n.w,n.h)}}),Class("paella.Html5Video",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(e,t,n,a,i,r,o){var l=this;this.parent(e,t,"video",n,a,i,r),this._streamName=o||"mp4";var s=this;function u(e){(function(e){s._ready||4!=s.video.readyState||(s._ready=!0,void 0!==s._initialCurrentTipe&&(s.video.currentTime=s._initialCurrentTime,delete s._initialCurrentTime),s._callReadyEvent())}).apply(s,[e])}this._playbackRate=1,this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(e,t){return e.res.h-t.res.h}),Object.defineProperty(this,"video",{get:function(){return s.domElement}}),this.video.preload="auto",this.video.setAttribute("playsinline",""),$(this.video).bind("progress",u),$(this.video).bind("loadstart",u),$(this.video).bind("loadedmetadata",u),$(this.video).bind("canplay",u),$(this.video).bind("oncanplay",u),$(this.video).bind("timeupdate",function(e){l._resumeCurrentTime=l.video.currentTime}),$(this.video).bind("emptied",function(e){l._resumeCurrentTime&&!isNaN(l._resumeCurrentTime)&&(l.video.currentTime=l._resumeCurrentTime)}),paella.utils.userAgent.browser.Safari&&$(this.video).bind("canplay canplaythrough",function(e){l.video.currentTime=l._resumeCurrentTime})},_deferredAction:function(n){var a=this;return new Promise(function(e,t){a.ready?e(n()):$(a.video).bind("canplay",function(){a._ready=!0,e(n())})})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},captureFrame:function(){var t=this;return new Promise(function(e){e({source:t.video,width:t.video.videoWidth,height:t.video.videoHeight})})},supportsCaptureFrame:function(){return Promise.resolve(!0)},getVideoData:function(){var n=this,a=this;return new Promise(function(e,t){n._deferredAction(function(){e({duration:a.video.duration,currentTime:a.video.currentTime,volume:a.video.volume,paused:a.video.paused,ended:a.video.ended,res:{w:a.video.videoWidth,h:a.video.videoHeight}})})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){(this._autoplay=e)&&this.video&&this.video.setAttribute("autoplay",e)},load:function(){var e=this._stream.sources[this._streamName];null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(e));var t=this._currentQuality<e.length?e[this._currentQuality]:null;if(this.video.innerText="",t){var n=this.video.querySelector("source");return n||(n=document.createElement("source"),this.video.appendChild(n)),this._posterFrame&&this.video.setAttribute("poster",this._posterFrame),n.src=t.src,n.type=t.type,this.video.load(),this.video.playbackRate=this._playbackRate,this._deferredAction(function(){return t})}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},getQualities:function(){var i=this;return new Promise(function(a,e){setTimeout(function(){var t=[],e=i._stream.sources[i._streamName],n=-1;e.forEach(function(e){n++,t.push(i._getQualityObject(n,e))}),a(t)},10)})},setQuality:function(o){var l=this;return new Promise(function(e){var t=l.video.paused,n=l._stream.sources[l._streamName];l._currentQuality=o<n.length?o:0;var a=l.video.currentTime,i=l,r=function(){i.unFreeze().then(function(){e(),i.video.removeEventListener("seeked",r,!1)})};l.freeze().then(function(){return l.load()}).then(function(){t||l.play(),l.video.addEventListener("seeked",r),l.video.currentTime=a})})},getCurrentQuality:function(){var t=this;return new Promise(function(e){e(t._getQualityObject(t._currentQuality,t._stream.sources[t._streamName][t._currentQuality]))})},play:function(){var e=this;return this._deferredAction(function(){e.video.play()})},pause:function(){var e=this;return this._deferredAction(function(){e.video.pause()})},isPaused:function(){var e=this;return this._deferredAction(function(){return e.video.paused})},duration:function(){var e=this;return this._deferredAction(function(){return e.video.duration})},setCurrentTime:function(e){var t=this;return this._deferredAction(function(){t.video.currentTime=e})},currentTime:function(){var e=this;return this._deferredAction(function(){return e.video.currentTime})},setVolume:function(e){var t=this;return this._deferredAction(function(){t.video.volume=e,t.video.muted=0==e?(t.video.setAttribute("muted","muted"),!0):(t.video.removeAttribute("muted"),!1)})},volume:function(){var e=this;return this._deferredAction(function(){return e.video.volume})},setPlaybackRate:function(e){var t=this;return this._deferredAction(function(){t._playbackRate=e,t.video.playbackRate=e})},playbackRate:function(){var e=this;return this._deferredAction(function(){return e.video.playbackRate})},supportAutoplay:function(){var e=paella.utils.userAgent.system.MacOS&&13<=paella.utils.userAgent.system.Version.minor&&paella.utils.userAgent.browser.Safari,t=paella.utils.userAgent.system.iOS,n=paella.utils.userAgent.browser.Chrome&&64<=paella.utils.userAgent.browser.Version.major;return!(e||t||n)},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){var t=this;return this._deferredAction(function(){var e=document.getElementById(t.video.className+"canvas");e&&$(e).remove()})},freeze:function(){var t=this;return this._deferredAction(function(){var e=document.createElement("canvas");e.id=t.video.className+"canvas",e.width=t.video.videoWidth,e.height=t.video.videoHeight,e.style.cssText=t.video.style.cssText,e.style.zIndex=2,e.getContext("2d").drawImage(t.video,0,0,16*Math.ceil(e.width/16),16*Math.ceil(e.height/16)),t.video.parentElement.appendChild(e)})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),paella.Html5Video.IsAutoplaySupported=function(){var n=void 0!==arguments[0]&&arguments[0];return new Promise(function(t){var e=document.createElement("video");e.src="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAC+htZGF0AAACqQYF//+l3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE1NSByMjkwMSA3ZDBmZjIyIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxOCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDEgbWU9ZGlhIHN1Ym1lPTEgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MCBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTAgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9MCB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTEga2V5aW50PTMyMCBrZXlpbnRfbWluPTMyIHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByYz1jcmYgbWJ0cmVlPTAgY3JmPTQwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgcGJfcmF0aW89MS4zMCBhcT0xOjEuMDAAgAAAAJBliIQD/2iscx5avG2BdVkxRtUop8zs5zVIqfxQM03W1oVb8spYPP0yjO506xIxgVQ4iSPGOtcDZBVYGqcTatSa730A8XTpnUDpUSrpyaCe/P8eLds/XenOFYMh8UIGMBwzhVOniajqOPFOmmFC20nufGOpJw81hGhgFwCO6a8acwB0P6LNhZZoRD0y2AZMQfEA0AAHAAAACEGaIRiEP5eAANAABwDSGK8UmBURhUGyINeXiuMlXvJnPVVQKigqVGy8PAuVNiWY94iJ/jL/HeT+/usIfmc/dsQ/TV87CTfXhD8C/4xCP3V+DJP8UP3iJdT8okfAuRJF8zkPgh5/J7XzGT8o9pJ+tvlST+g3uwh1330Q9qd4IbnwOQ9dexCHf8mQfVJ57wET8acsIcn6UT6p7yoP2uQ97fFAhrNARXaou2QkEJxrmP6ZBa7TiE6Uqx04OcnChy+OrfwfRWfSYRbS2wmENdDIKUQSkggeXbLb10CIHL5BPgiBydo+HEEPILBbH9zZOdw/77EbN8euVRS/ZcjbZ/D63aLDh1MTme4vfGzFjXkw9r7U8EhcddAmwXGKjo9o53+/8Rnm1rnt6yh3hLD9/htcZnjjGcW9ZQlj6DKIGrrPo/l6C6NyeVr07mB/N6VlGb5fkLBZM42iUNiIGnMJzShmmlFtEsO0mr5CMcFiJdrZQjdIxsYwpU4xlzmD2+oPtjSLVZiDh2lHDRmHubAxXMROEt0z4GkcCYCk832HaXZSM+4vZbUwJa2ysgmfAQMTEM9gxxct7h5xLdrMnHUnB2bXMO2rEnqnnjWHyFYTrzmZTjJ3N4qP+Pv5VHYzZuAa9jnrg35h5hu/Q87uewVnjbJrtcOOm6b9lltPS6n/mkxgxSyqLJVzr/bYt039aTYyhmveJTdeiG7kLfmn9bqjXfxdfZoz53RDcxw+jP7n7TtT8BsB3jUvxe7n5Gbrm9/5QzQ3cxxl9s6ojDMDg3R7Bx//b5rwuSI84z2fuP8/nPxj/wvHNccSL3n77sCEv+AUwlVzHAFkYCkDkdRIORiUg5GJSDkYlIORgKQsjI9E1d0PUP5zV31MSkvI+AAAAAtBmkMYjP/4v5j6wQDGGK/rogCQL/+rZ+PHZ8R11ITSYLDLmXtUdt5a5V+63JHBE/z0/3cCf4av6uOAGtQmr8mCvCxwSI/c7KILm624qm/Kb4fKK5P1GWvX/S84SiSuyTIfk3zVghdRlzZpLZXgddiJjKTGb43OFQCup1nyCbjWgjmOozS6mXGEDsuoVDkSR7/Q8ErEhAZqgHJ5yCxkICvpE+HztDoOSTYiiBCW6shBKQM/Aw5DdbsGWUc/3XEIhH8HXJSDU8mZDApXSSZR+4fbKiOTUHmUgYd7HOLNG544Zy3F+ZPqxMwuGkCo/HxfLXrebdQakkweTwTqUgIDlwvPC181Z5eZ7cDTV905pDXGj/KiRAk3p+hlgHPvRW35PT4b163gUGkmIl0Ds4OBn6G64lkPsnQPNFs8AtwH4PSeYoz9s5uh/jFX0tlr7f+xzN6PuDvyOmKvYhdYK5FLAOkbJ6E/r7fxRZ1g63PPgeLsfir/0iq9K7IW+eWH4ONNCdL5oyV/TSILB+ob8z1ZWUf9p50jIFh6l64geGZ785/8OQanz95/ZPwGF03PMeYdkuH6x5Q/gcx5bg2RejM+RPQ6Vg6D43WOe+1fDKbVqr9P6Y5S9fuwD56fvq62ESHISopAae8/mbMD2la4/h/K9uSYuhxZDNszxgmQmd2kQDoEU6g46KneCXN/b9b5Ez/4iQOfBj4EuXyfp8MlAlFg8P486y4HT9H680pqN9xN164m7ReXPWHU7pw7F9Pw3FEDjQrHHnM3KfE8KWrl2JyxrdR90wr+HPPrkO5v1XT88+iU5MfGOeswl1uQxhiAGn4O62zaMJmDbSrMNY4LEV/jc+TjMQJRwOsUrW8aDyVoo87t8G+Qtfm6fOy6DNK9crM2f3KQJ0YEPc5JM0eSQsjYSFkZFIWRkUgcB1El5HwAAAAIAZ5iRCX/y4AA7liudRsNCYNGAb/ocSIJGilo13xUupVcYzmaVbkEY3nch7y9pfI1qxo3V9n9Q+r84e3e7dCfx+aLdD6S8dDaqzc6eqH9onVdingfJndPc1yaRhn4JD1jsj85o/le4m9cE2W1F8unegGNvOuknfzBmz4/Us9R+kC7xW5e9Z1Z9JsGeb/z6XkKkxiNh1C3Ns5jTVxB9x1poY49zmq+xsXNh0uy75DZf0JM9Uq8ghKrZiQDyAlHf4dqw48mtmlozgUMkh7VJ7vbIW1UNI81pRTT7C3WOOa3mw0RNjAoMLjtm1+VqQBEhHw+6VBvNTwCBkyvjU+kVMA1OU8elyGQX0xTlHRM8iPGg3CO8B5AzpOm2M7J75cG3PPGc42ztXyYzat3TyZ54CyDqZi1/Mn4B6T1fhMSD0uk5lKsOHIktX1Sfud/I3Ew+McUpwm3bxVdAy7uiGeiXWbe3cMBmCruk4yW18G6dEf9prnjcT6HUZG5bBSQGYSQscX2KCZoWxWkVS0w6IkwqdVJ+Akyey/Hl0MyrcAMI6Sgq3HMn95sBcc4ZadQLT31gNKo6qyebwmyK63HlMTK40Zj3FGuboBQ3Zsg87Jf3Gg1SDlG6fRVl2+5Cc6q+0OcUNRyCfLIG157ZHTSCwD9UpZtZDLki0BCLgAAAAhBmmQYiv+BgQDyne7dSHRhSQ/D31OEhh0h14FMQDwlvgJODIIYGxb7iHQo1mvJn3hOUUli9mTrUMuuPv/W2bsX3X7l9k7jtvT/Cuf4Kmbbhn0zmtjx7GWFyjrJfyHHxs5mxuTjdr2/drXoPhh1rb2XOnE9H3BdBqm1I+K5Sd1hYCevn6PbJcDyUHpysOZeLu+VoYklOlicG52cbxZbzvVeiS4jb+qyJoL62Ox+nSrUhOkCNMf8dz5iEi+C5iYZciyXk6gmIvSJVQDNTiO2i1a6pGORhiNVWGAMBHNHyHbmWtqB9AYbSdGR5qQzHnGF9HWaHfTzIqQMNEioRwE00KEllO+UcuPFmOs0Kl9lgy1DgKSKfGaaVFc7RNrn0nOddM6OfOG51GuoJSCnOpRjIvLAMAAAAA1NfU1+Ro9v/o+AANDABwAABedtb292AAAAbG12aGQAAAAA18kDNdfJAzUAAAPoAAAAowABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAACknRyYWsAAABcdGtoZAAAAAPXyQM118kDNQAAAAEAAAAAAAAAnwAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAOAAAACAAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAAJ8AABZEAAEAAAAAAgptZGlhAAAAIG1kaGQAAAAA18kDNdfJAzUAAV+QAAA3qlXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAG1bWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABdXN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAOAAgAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQAr/4QAaZ01ACuyiLy+AtQYBBkAAAATAAAEsI8SJZYABAAVo74OcgAAAABhzdHRzAAAAAAAAAAEAAAAFAAALIgAAABRzdHNzAAAAAAAAAAEAAAABAAAAEXNkdHAAAAAAIBAQGBAAAAAwY3R0cwAAAAAAAAAEAAAAAgAAFkQAAAABAAAhZgAAAAEAAAsiAAAAAQAAFkQAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAKHN0c3oAAAAAAAAAAAAAAAUAAANBAAAADAAAAA8AAAAMAAAADAAAACRzdGNvAAAAAAAAAAUAAAAwAAADdQAABhAAAAjPAAAKyQAAAlp0cmFrAAAAXHRraGQAAAAD18kDNdfJAzUAAAACAAAAAAAAAKMAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAABzAAAIQAABAAAAAAG+bWRpYQAAACBtZGhkAAAAANfJAzXXyQM1AACsRAAAHABVxAAAAAAAJWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABNb25vAAAAAXFtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAATVzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAAAAAAAAAAABYCAgAISCAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAAAHAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAwc3RzegAAAAAAAAAAAAAABwAAAAQAAAAEAAACiwAAArAAAAHuAAABNwAAAAQAAAAsc3RjbwAAAAAAAAAHAAADcQAAA4EAAAOFAAAGHwAACNsAAArVAAAMDAAAABpzZ3BkAQAAAHJvbGwAAAACAAAAAf//AAAAHHNiZ3AAAAAAcm9sbAAAAAEAAAAHAAAAAQAAABR1ZHRhAAAADG5hbWVNb25vAAAAb3VkdGEAAABnbWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAA6aWxzdAAAADKpdG9vAAAAKmRhdGEAAAABAAAAAEhhbmRCcmFrZSAxLjEuMiAyMDE4MDkwNTAw",e.load(),n?(e.style="position: fixed; top: 0px; right: 0px; z-index: 1000000;",document.body.appendChild(e)):e.style.display="none",e.playing=!1,e.play().then(function(e){t(!0)}).catch(function(e){t(!1)})})},Class("paella.videoFactories.Html5VideoFactory",{isStreamCompatible:function(e){try{if(0<paella.videoFactories.Html5VideoFactory.s_instances&&base.userAgent.system.iOS&&paella.utils.userAgent.system.Version.major<=10&&paella.utils.userAgent.system.Version.minor<3)return!1;for(var t in e.sources)if("mp4"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,n){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Html5Video(e,t,n.x,n.y,n.w,n.h)}}),paella.videoFactories.Html5VideoFactory.s_instances=0,Class("paella.ImageVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_currentTime:0,_duration:0,_ended:!1,_playTimer:null,_playbackRate:1,_frameArray:null,initialize:function(e,t,n,a,i,r){this.parent(e,t,"img",n,a,i,r);var o=this;this._stream.sources.image.sort(function(e,t){return e.res.h-t.res.h}),Object.defineProperty(this,"img",{get:function(){return o.domElement}}),Object.defineProperty(this,"imgStream",{get:function(){return this._stream.sources.image[this._currentQuality]}}),Object.defineProperty(this,"_paused",{get:function(){return null==this._playTimer}})},_deferredAction:function(t){var n=this;return new Promise(function(e){if(n.ready)e(t());else{e=function(){n._ready=!0,e(t())};$(n.video).bind("paella:imagevideoready",e)}})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},_loadCurrentFrame:function(){var t=this;if(this._frameArray){var n=this._frameArray[0];this._frameArray.some(function(e){if(t._currentTime<e.time)return!0;n=e.src}),this.img.src=n}},allowZoom:function(){return!1},getVideoData:function(){var e=this,n=this;return new Promise(function(t){e._deferredAction(function(){var e={duration:n._duration,currentTime:n._currentTime,volume:0,paused:n._paused,ended:n._ended,res:{w:n.imgStream.res.w,h:n.imgStream.res.h}};t(e)})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){(this._autoplay=e)&&this.video&&this.video.setAttribute("autoplay",e)},load:function(){var e=this._stream.sources.image;null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(e));var t=this._currentQuality<e.length?e[this._currentQuality]:null;if(t){for(var n in this._frameArray=[],t.frames){var a=Math.floor(Number(n.replace("frame_","")));this._frameArray.push({src:t.frames[n],time:a})}return this._frameArray.sort(function(e,t){return e.time-t.time}),this._ready=!0,this._currentTime=0,this._duration=t.duration,this._loadCurrentFrame(),paella.events.trigger("paella:imagevideoready"),this._deferredAction(function(){return t})}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},supportAutoplay:function(){return!0},getQualities:function(){var i=this;return new Promise(function(a){setTimeout(function(){var t=[],e=i._stream.sources[i._streamName],n=-1;e.forEach(function(e){n++,t.push(i._getQualityObject(n,e))}),a(t)},10)})},setQuality:function(n){var a=this;return new Promise(function(e){a._paused;var t=a._stream.sources.image;a._currentQuality=n<t.length?n:0;a._currentTime;a.load().then(function(){this._loadCurrentFrame(),e()})})},getCurrentQuality:function(){var t=this;return new Promise(function(e){e(t._getQualityObject(t._currentQuality,t._stream.sources.image[t._currentQuality]))})},play:function(){var e=this;return this._deferredAction(function(){e._playTimer=new base.Timer(function(){e._currentTime+=.25*e._playbackRate,e._loadCurrentFrame()},250),e._playTimer.repeat=!0})},pause:function(){var e=this;return this._deferredAction(function(){e._playTimer.repeat=!1,e._playTimer=null})},isPaused:function(){var e=this;return this._deferredAction(function(){return e._paused})},duration:function(){var e=this;return this._deferredAction(function(){return e._duration})},setCurrentTime:function(e){var t=this;return this._deferredAction(function(){t._currentTime=e,t._loadCurrentFrame()})},currentTime:function(){var e=this;return this._deferredAction(function(){return e._currentTime})},setVolume:function(e){return this._deferredAction(function(){})},volume:function(){return this._deferredAction(function(){return 0})},setPlaybackRate:function(e){var t=this;return this._deferredAction(function(){t._playbackRate=e})},playbackRate:function(){var e=this;return this._deferredAction(function(){return e._playbackRate})},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.img;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){return this._deferredAction(function(){})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.ImageVideoFactory",{isStreamCompatible:function(e){try{for(var t in e.sources)if("image"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,n){return new paella.ImageVideo(e,t,n.x,n.y,n.w,n.h)}}),Class("paella.BackgroundContainer",paella.DomNode,{initialize:function(e,t){this.parent("img",e,{position:"relative",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:GlobalParams.background.zIndex}),this.domElement.setAttribute("src",t),this.domElement.setAttribute("alt",""),this.domElement.setAttribute("width","100%"),this.domElement.setAttribute("height","100%")},setImage:function(e){this.domElement.setAttribute("src",e)}}),Class("paella.VideoOverlay",paella.DomNode,{size:{w:1280,h:720},initialize:function(){this.parent("div","overlayContainer",{position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden",zIndex:10}),this.domElement.setAttribute("role","main")},_generateId:function(){return Math.ceil(Date.now()*Math.random())},enableBackgroundMode:function(){this.domElement.className="overlayContainer background"},disableBackgroundMode:function(){this.domElement.className="overlayContainer"},clear:function(){this.domElement.innerText=""},getMasterRect:function(){return paella.player.videoContainer.getMasterVideoRect()},getSlaveRect:function(){return paella.player.videoContainer.getSlaveVideoRect()},addText:function(e,t,n){var a=document.createElement("div");return a.innerHTML=paella.AntiXSS.htmlEscape(e),a.className="videoOverlayText",n&&(a.style.backgroundColor="red"),this.addElement(a,t)},addElement:function(e,t){return this.domElement.appendChild(e),e.style.position="absolute",e.style.left=this.getHSize(t.left)+"%",e.style.top=this.getVSize(t.top)+"%",e.style.width=this.getHSize(t.width)+"%",e.style.height=this.getVSize(t.height)+"%",e},getLayer:function(e,t){return e=e||this._generateId(),$(this.domElement).find("#"+e)[0]||this.addLayer(e,t)},addLayer:function(e,t){t=t||10;var n=document.createElement("div");return n.className="row",n.id=e||this._generateId(),this.addElement(n,{left:0,top:0,width:1280,height:720})},removeLayer:function(e){var t=$(this.domElement).find("#"+e)[0];t&&this.domElement.removeChild(t)},removeElement:function(e){if(e)try{this.domElement.removeChild(e)}catch(e){}},getVSize:function(e){return 100*e/this.size.h},getHSize:function(e){return 100*e/this.size.w}}),function(){var e,t=(e=paella.DomNode,$traceurRuntime.createClass(function e(t,n,a,i,r){var o=new paella.RelativeVideoSize,l={top:o.percentVSize(a)+"%",left:o.percentWSize(n)+"%",width:o.percentWSize(i)+"%",height:o.percentVSize(r)+"%",position:"absolute",zIndex:GlobalParams.video.zIndex,overflow:"hidden"};$traceurRuntime.superConstructor(e).call(this,"div",t,l),this._rect={left:n,top:a,width:i,height:r},this.domElement.className="videoWrapper"},{setRect:function(e,t){this._rect=JSON.parse(JSON.stringify(e));var n=new paella.RelativeVideoSize,a={top:n.percentVSize(e.top)+"%",left:n.percentWSize(e.left)+"%",width:n.percentWSize(e.width)+"%",height:n.percentVSize(e.height)+"%",position:"absolute"};if(t){this.disableClassName();var i=this;$(this.domElement).animate(a,400,function(){i.enableClassName(),paella.events.trigger(paella.events.setComposition,{video:i})}),this.enableClassNameAfter(400)}else $(this.domElement).css(a),paella.events.trigger(paella.events.setComposition,{video:this})},getRect:function(){return this._rect},disableClassName:function(){this.classNameBackup=this.domElement.className,this.domElement.className=""},enableClassName:function(){this.domElement.className=this.classNameBackup},enableClassNameAfter:function(e){setTimeout("$('#"+this.domElement.id+"')[0].className = '"+this.classNameBackup+"'",e)},setVisible:function(e,t){"true"==e&&t?($(this.domElement).show(),$(this.domElement).animate({opacity:1},300)):"true"!=e||t?"false"==e&&t?$(this.domElement).animate({opacity:0},300):"false"!=e||t||$(this.domElement).hide():$(this.domElement).show()},setLayer:function(e){this.domElement.style.zIndex=e}},{},e));paella.VideoWrapper=t}(),Class("paella.VideoContainerBase",paella.DomNode,{_trimming:{enabled:!1,start:0,end:0},timeupdateEventTimer:null,timeupdateInterval:250,masterVideoData:null,slaveVideoData:null,currentMasterVideoData:null,currentSlaveVideoData:null,_force:!1,_playOnClickEnabled:!0,initialize:function(e){var t=this;this.parent("div",e,{position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden"}),$(this.domElement).click(function(e){t.firstClick&&base.userAgent.browser.IsMobileVersion||t.firstClick&&!t._playOnClickEnabled||paella.player.videoContainer.paused().then(function(e){t.firstClick=!0,e?paella.player.play():paella.player.pause()})}),this.domElement.addEventListener("touchstart",function(e){paella.player.controls&&paella.player.controls.restartHideTimer()})},triggerTimeupdate:function(){var t=this,n=0,a=0;this.paused().then(function(e){return n=e,t.duration()}).then(function(e){return a=e,t.currentTime()}).then(function(e){n&&!t._force||(t._force=!1,paella.events.trigger(paella.events.timeupdate,{videoContainer:t,currentTime:e,duration:a}))})},startTimeupdate:function(){var t=this;this.timeupdateEventTimer=new Timer(function(e){t.triggerTimeupdate()},this.timeupdateInterval),this.timeupdateEventTimer.repeat=!0},stopTimeupdate:function(){this.timeupdateEventTimer&&(this.timeupdateEventTimer.repeat=!1),this.timeupdateEventTimer=null},enablePlayOnClick:function(){this._playOnClickEnabled=!0},disablePlayOnClick:function(){this._playOnClickEnabled=!1},isPlayOnClickEnabled:function(){return this._playOnClickEnabled},play:function(){paella.events.trigger(paella.events.play),this.startTimeupdate()},pause:function(){paella.events.trigger(paella.events.pause),this.stopTimeupdate()},seekTo:function(t){var n=this,a=this;this.setCurrentPercent(t).then(function(e){a._force=!0,n.triggerTimeupdate(),paella.events.trigger(paella.events.seekToTime,{newPosition:e.time}),paella.events.trigger(paella.events.seekTo,{newPositionPercent:t})})},seekToTime:function(e){var n=this;this.setCurrentTime(e).then(function(e){n._force=!0,n.triggerTimeupdate();var t=100*e.time/e.duration;paella.events.trigger(paella.events.seekToTime,{newPosition:e.time}),paella.events.trigger(paella.events.seekTo,{newPositionPercent:t})})},setPlaybackRate:function(e){paella.events.trigger(paella.events.setPlaybackRate,{rate:e})},setVolume:function(e){},volume:function(){return 1},trimStart:function(){var t=this;return new Promise(function(e){e(t._trimming.start)})},trimEnd:function(){var t=this;return new Promise(function(e){e(t._trimming.end)})},trimEnabled:function(){var t=this;return new Promise(function(e){e(t._trimming.enabled)})},trimming:function(){var t=this;return new Promise(function(e){e(t._trimming)})},enableTrimming:function(){this._trimming.enabled=!0;var e=paella.captions.getActiveCaptions();void 0!==e&&paella.plugins.captionsPlugin.buildBodyContent(e._captions,"list"),paella.events.trigger(paella.events.setTrim,{trimEnabled:this._trimming.enabled,trimStart:this._trimming.start,trimEnd:this._trimming.end})},disableTrimming:function(){this._trimming.enabled=!1;var e=paella.captions.getActiveCaptions();void 0!==e&&paella.plugins.captionsPlugin.buildBodyContent(e._captions,"list"),paella.events.trigger(paella.events.setTrim,{trimEnabled:this._trimming.enabled,trimStart:this._trimming.start,trimEnd:this._trimming.end})},setTrimming:function(i,r){var o=this;return new Promise(function(n){var a=0;o.currentTime().then(function(e){return a=e,o.duration()}).then(function(e){if(e,o._trimming.start=Math.floor(i),o._trimming.end=Math.floor(r),a<o._trimming.start&&o.setCurrentTime(o._trimming.start),a>o._trimming.end&&o.setCurrentTime(o._trimming.end),o._trimming.enabled){var t=paella.captions.getActiveCaptions();void 0!==t&&paella.plugins.captionsPlugin.buildBodyContent(t._captions,"list")}paella.events.trigger(paella.events.setTrim,{trimEnabled:o._trimming.enabled,trimStart:o._trimming.start,trimEnd:o._trimming.end}),n()})})},setTrimmingStart:function(e){return this.setTrimming(e,this._trimming.end)},setTrimmingEnd:function(e){return this.setTrimming(this._trimming.start,e)},setCurrentPercent:function(i){var e=this,r=this,o=0;return new Promise(function(t){e.duration().then(function(e){return o=e,r.trimming()}).then(function(e){var t=0;if(e.enabled){var n=e.start,a=e.end;o=a-n,t=parseFloat(i*o/100)}else t=i*o/100;return r.setCurrentTime(t)}).then(function(e){t(e)})})},setCurrentTime:function(e){base.log.debug("VideoContainerBase.setCurrentTime("+e+")")},currentTime:function(){return base.log.debug("VideoContainerBase.currentTime()"),0},duration:function(){return base.log.debug("VideoContainerBase.duration()"),0},paused:function(){return base.log.debug("VideoContainerBase.paused()"),!0},setupVideo:function(e){base.log.debug("VideoContainerBase.setupVide()")},isReady:function(){return base.log.debug("VideoContainerBase.isReady()"),!0},onresize:function(){this.parent(onresize)}}),Class("paella.ProfileFrameStrategy",{valid:function(){return!0},adaptFrame:function(e,t){return t}}),Class("paella.LimitedSizeProfileFrameStrategy",paella.ProfileFrameStrategy,{adaptFrame:function(e,t){if(e.width<t.width||e.height<t.height){var n=JSON.parse(JSON.stringify(t));n.width=e.width,n.height=e.height;var a=t.width-e.width,i=t.height-e.height;return n.top=n.top+i/2,n.left=n.left+a/2,n}return t}}),function(){var e=$traceurRuntime.createClass(function(e){this._masterVideo=null,this._slaveVideos=[],this._videoStreams=[],this._audioStreams=[]},{init:function(e){var n=this;if(0==e.length)throw Error("Empty video data.");if(this._videoData=e,this._videoData.some(function(e){return"master"==e.role})||(this._videoData[0].role="master"),this._videoData.forEach(function(e,t){e.type=e.type||"video","master"==e.role?n._masterVideo=e:"video"==e.type&&n._slaveVideos.push(e),"video"==e.type?n._videoStreams.push(e):"audio"==e.type&&n._audioStreams.push(e)}),0==this._videoStreams.length)throw new Error("No video streams found. Paella Player requires at least one video stream.")},get masterVideo(){return this._masterVideo},get slaveVideos(){return this._slaveVideos},get mainSlaveVideo(){return 0<this._slaveVideos.length?this._slaveVideos[0]:null},get audioStreams(){return this._audioStreams},get isLiveStreaming(){return paella.player.isLiveStream()}},{});function d(e,t){var n=new paella.VideoWrapper(e);return n.addNode(t),this.videoWrappers.push(n),this.container.addNode(n),n}paella.StreamProvider=e;var t=function(e){function r(e){$traceurRuntime.superConstructor(r).call(this,e),this.containerId="",this.video1Id="",this.videoSlaveId="",this.backgroundId="",this.container=null,this.profileFrameStrategy=null,this.videoWrappers=[],this._players=[],this._videoPlayers=[],this._audioPlayers=[],this._audioPlayer=null,this._audioLanguage=paella.dictionary.currentLanguage(),this._volume=1,this.videoClasses={master:"video masterVideo",slave:"video slaveVideo"},this.isHidden=!1,this.logos=null,this.overlayContainer=null,this.videoSyncTimeMillis=5e3,this.currentMasterVideoRect={},this.currentSlaveVideoRect={},this._maxSyncDelay=.5,this._isMonostream=!1,this._videoQualityStrategy=null,this._sourceData=null,this._isMasterReady=!1,this._isSlaveReady=!1,this._firstLoad=!1,this._playOnLoad=!1,this._seekToOnLoad=0,this._showPosterFrame=!0,this._currentProfile=null;var t=this;this._sourceData=[],this.containerId=e+"_container",this.video1Id=e+"_master",this.videoSlaveId=e+"_slave_",this.audioId=e+"_audio_",this.backgroundId=e+"_bkg",this.logos=[],this._videoQualityStrategy=this._getQualityStrategyObject(),this.container=new paella.DomNode("div",this.containerId,{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",width:"1024px",height:"567px"}),this.container.domElement.setAttribute("role","main"),this.addNode(this.container),this.overlayContainer=new paella.VideoOverlay(this.domElement),this.container.addNode(this.overlayContainer),this.container.addNode(new paella.BackgroundContainer(this.backgroundId,paella.utils.folders.profiles()+"/resources/default_background_paella.jpg")),Object.defineProperty(this,"sourceData",{get:function(){return this._sourceData}}),new base.Timer(function(e){t.syncVideos()},t.videoSyncTimeMillis).repeat=!0;var n=paella.player.config;try{var a=n.player.profileFrameStrategy,i=new(Class.fromString(a));dynamic_cast("paella.ProfileFrameStrategy",i)&&this.setProfileFrameStrategy(i)}catch(e){}this._streamProvider=new paella.StreamProvider,Object.defineProperty(this,"ready",{get:function(){return this._isMasterReady&&this._isSlaveReady}}),Object.defineProperty(this,"isMonostream",{get:function(){return this._isMonostream}})}return $traceurRuntime.createClass(r,{_getQualityStrategyObject:function(){var a=null;return paella.player.config.player.videoQualityStrategy.split(".").forEach(function(e,t,n){a=0==t&&1<n.length?window[e]:a[e]}),new(a=a||paella.VideoQualityStrategy())},getVideoData:function(){var a=this;return new Promise(function(e){var t={master:null,slaves:[]},n=[];a.masterVideo()&&n.push(a.masterVideo().getVideoData().then(function(e){return t.master=e,Promise.resolve(e)})),a.slaveVideo()&&n.push(a.slaveVideo().getVideoData().then(function(e){return t.slaves.push(e),Promise.resolve(e)})),Promise.all(n).then(function(){e(t)})})},setVideoQualityStrategy:function(e){this._videoQualityStrategy=e,this.masterVideo()&&this.masterVideo().setVideoQualityStrategy(this._videoQualityStrategy),this.slaveVideo()&&slaveVideo.setVideoQualityStrategy(this._videoQualityStrategy)},setProfileFrameStrategy:function(e){this.profileFrameStrategy=e},getMasterVideoRect:function(){return this.currentMasterVideoRect},getSlaveVideoRect:function(){return this.currentSlaveVideoRect},setHidden:function(e){this.isHidden=e},hideVideo:function(){this.setHidden(!0)},publishVideo:function(){this.setHidden(!1)},syncVideos:function(){var i=this,e=this.masterVideo(),a=this.slaveVideo(),r=0,o=0;!this._isMonostream&&e&&e.currentTime().then(function(e){return r=e,a?a.currentTime():Promise.resolve(-1)}).then(function(e){if(-1<=e){o=e;var t=Math.abs(r-o);t>i._maxSyncDelay&&(base.log.debug("Sync videos performed, diff="+t),a.setCurrentTime(r))}var n=[];return i._audioPlayers.forEach(function(e){n.push(e.currentTime())}),Promise.all(n)}).then(function(e){e.forEach(function(e,t){var n=i._audioPlayers[t],a=Math.abs(r-e);a>i._maxSyncDelay&&(base.log.debug("Sync audio performed, diff="+a),n.setCurrentTime(e))})})},checkVideoBounds:function(e,t,n,a){var i=this,r=e.start,o=e.end,l=e.enabled;paella.events.bind(paella.events.endVideo,function(){i.setCurrentTime(0)}),l?t>=Math.floor(o)&&!n?(paella.events.trigger(paella.events.endVideo,{videoContainer:this}),this.pause()):t<r&&this.setCurrentTime(r+1):a<=t&&(paella.events.trigger(paella.events.endVideo,{videoContainer:this}),this.pause())},play:function(){var a=this;return new Promise(function(e){a._firstLoad?a._playOnLoad=!0:a._firstLoad=!0;var t=a.masterVideo(),n=a.slaveVideo();t?t.play().then(function(){n&&n.play(),a._audioPlayers.forEach(function(e){e.play()}),$traceurRuntime.superGet(a,r.prototype,"play").call(a),e()}):reject(new Error("Invalid master video"))})},pause:function(){var i=this;return new Promise(function(e,t){var n=i.masterVideo(),a=i.slaveVideo();n?n.pause().then(function(){a&&a.pause(),i._audioPlayers.forEach(function(e){e.pause()}),$traceurRuntime.superGet(i,r.prototype,"pause").call(i),e()}):t(new Error("invalid master video"))})},next:function(){0!==this._trimming.end?this.setCurrentTime(this._trimming.end):this.duration(!0).then(function(e){this.setCurrentTime(e)}),$traceurRuntime.superGet(this,r.prototype,"next").call(this)},previous:function(){this.setCurrentTime(this._trimming.start),$traceurRuntime.superGet(this,r.prototype,"previous").call(this)},setCurrentTime:function(a){var e=this;return new Promise(function(t){var n=[];e._trimming.enabled&&((a+=e._trimming.start)<e._trimming.start&&(a=e._trimming.start),a>e._trimming.end&&(a=e._trimming.end)),n.push(e.masterVideo().setCurrentTime(a)),e.slaveVideo()&&n.push(e.slaveVideo().setCurrentTime(a)),e._audioPlayers.forEach(function(e){n.push(e.setCurrentTime(a))}),Promise.all(n).then(function(){return e.duration(!1)}).then(function(e){t({time:a,duration:e})})})},currentTime:function(){var e=void 0!==arguments[0]&&arguments[0],n=this;if(!this._trimming.enabled||e)return this.masterVideo().currentTime();var a=this._trimming.start;return new Promise(function(t){n.masterVideo().currentTime().then(function(e){t(e-a)})})},setPlaybackRate:function(e){var t=this.masterVideo(),n=this.slaveVideo();t&&t.setPlaybackRate(e),n&&n.setPlaybackRate(e),$traceurRuntime.superGet(this,r.prototype,"setPlaybackRate").call(this,e)},setVolume:function(t){var n=this;return new Promise(function(e){"object"==$traceurRuntime.typeof(t)&&(t=void 0!==t.master?t.master:1),n.mainAudioPlayer().setVolume(t).then(function(){paella.events.trigger(paella.events.setVolume,{master:t}),n._volume=t,e(t)})})},volume:function(){var e=this;return new Promise(function(t){e.mainAudioPlayer().then(function(e){return e.volume()}).then(function(e){t(e)})})},masterVideo:function(){return 0<this.videoWrappers.length?this.videoWrappers[0].getNode(this.video1Id):null},slaveVideo:function(){return 1<this.videoWrappers.length?this.videoWrappers[1].getNode(this.videoSlaveId+1):null},mainAudioPlayer:function(){return this._audioPlayer},players:function(){var n=this;return new Promise(function(t){!function e(){n.masterVideo()?t(n._players):setTimeout(function(){return e()},10)}()})},videoPlayers:function(){var n=this;return new Promise(function(t){!function e(){n.masterVideo()?t(n._videoPlayers):setTimeout(function(){return e()},10)}()})},audioPlayers:function(){var n=this;return new Promise(function(t){!function e(){n.masterVideo()?t(n._audioPlayers):setTimeout(function(){return e()},10)}()})},duration:function(t){var n=this;return this.masterVideo().duration().then(function(e){return n._trimming.enabled&&!t&&(e=n._trimming.end-n._trimming.start),e})},paused:function(){return this.masterVideo().isPaused()},trimEnabled:function(){return this._trimming.enabled},trimStart:function(){return this._trimming.enabled?this._trimming.start:0},trimEnd:function(){return this._trimming.enabled?this._trimming.end:this.duration()},getQualities:function(){var e=this;return new Promise(function(t){e.masterVideo().getQualities().then(function(e){t(e)})})},setQuality:function(i){var t=this,r=[],o=[],l=this;return new Promise(function(a){t.masterVideo().getQualities().then(function(e){return r=e,t.slaveVideo()?t.slaveVideo().getQualities():paella_DeferredResolved()}).then(function(e){var t,n;o=e||[],t=i<r.length?i:r.length-1,n=i<o.length?i:o.length-1,l.masterVideo().setQuality(t).then(function(){return l.slaveVideo()?l.slaveVideo().setQuality(n):paella_DeferredResolved()}).then(function(){paella.events.trigger(paella.events.qualityChanged),a()})})})},getCurrentQuality:function(){return this.masterVideo().getCurrentQuality()},setStartTime:function(e){this.seekToTime(e)},get audioLanguage(){return this._audioLanguage},getAudioLanguages:function(){var e=this;return new Promise(function(t){var n=[];e.players().then(function(e){e.forEach(function(e){e.stream.language&&n.push(e.stream.language)}),t(n)})})},setAudioLanguage:function(a){var i=this;return new Promise(function(e){var n=!1;i.players().then(function(e){var t=[];return e.forEach(function(e){e.stream.language==a&&(n=!0,i._audioPlayer=e),t.push(e.setVolume(0))}),Promise.all(t)}).then(function(){return n||(i._audioPlayer=i.masterVideo()),i.mainAudioPlayer().setVolume(i._volume)}).then(function(){i._audioLanguage=i.mainAudioPlayer().stream.language,paella.events.trigger(paella.events.audioLanguageChanged),e()})})},setStreamData:function(e){var a=this,i=this;this._sourceData=e;var n=document.createElement("div");n.className="videoLoaderOverlay",this.overlayContainer.addElement(n,{left:0,top:0,width:1280,height:720}),this._streamProvider.init(e);var t=0<this._streamProvider.slaveVideos.length?{x:850,y:140,w:360,h:550}:{x:0,y:0,w:1280,h:720};this._isMonostream=0==this._streamProvider.slaveVideos.length;var r=this._streamProvider.masterVideo,o=this._streamProvider.audioStreams;this._players=[],this._videoPlayers=[],this._audioPlayers=[];var l=this._streamProvider.mainSlaveVideo,s=paella.videoFactory.getVideoObject(this.video1Id,r,t);this._audioPlayer=s,this._players.push(s),this._videoPlayers.push(s);var u=l?paella.videoFactory.getVideoObject(this.videoSlaveId+1,l,{x:10,y:40,w:800,h:600}):null;u&&(u.setVolume(0),this._players.push(u),this._videoPlayers.push(u)),o.forEach(function(e,t){var n=paella.audioFactory.getAudioObject(a.audioId+t,e);n&&(a._audioPlayers.push(n),a._players.push(n),a.container.addNode(n))}),s.setVideoQualityStrategy(this._videoQualityStrategy),u&&u.setVideoQualityStrategy(this._videoQualityStrategy),d.apply(this,["masterVideoWrapper",s]),0<this._streamProvider.slaveVideos.length&&d.apply(this,["slaveVideoWrapper",u]);var c=this.autoplay();return s.setAutoplay(c),u&&u.setAutoplay(c),s.load().then(function(){return 0<a._streamProvider.slaveVideos.length?u.load():paella_DeferredResolved(!0)}).then(function(){if(0<i._audioPlayers.length){var t=[];return i._audioPlayers.forEach(function(e){t.push(e.load())}),Promise.all(t)}return paella_DeferredResolved(!0)}).then(function(){$(s.video).bind("timeupdate",function(e){var t=i._trimming,n=e.currentTarget.currentTime,a=e.currentTarget.duration;t.enabled&&(n-=t.start,a=t.end-t.start),paella.events.trigger(paella.events.timeupdate,{videoContainer:i,currentTime:n,duration:a}),i.checkVideoBounds(t,e.currentTarget.currentTime,e.currentTarget.paused,a)}),i.overlayContainer.removeElement(n),i._isMasterReady=!0,i._isSlaveReady=!0;var e=paella.player.config,t=e.player.audio&&null!=e.player.audio.master?e.player.audio.master:1;return s.setVolume(t),i.setAudioLanguage(i._audioLanguage)}).then(function(){paella.events.trigger(paella.events.videoReady);var e=base.parameters.get("profile"),t=base.cookies.get("lastProfile");return e?i.setProfile(e,!1):t?i.setProfile(t,!1):i.setProfile(paella.Profiles.getDefaultProfile(),!1)})},setAutoplay:function(){var t=void 0===arguments[0]||arguments[0];return!!this.supportAutoplay()&&(this._autoplay=t,this.masterVideo()&&this.masterVideo().setAutoplay(t),this.slaveVideo()&&this.slaveVideo().setAutoplay(t),0<this._audioPlayers.lenght&&this._audioPlayers.forEach(function(e){e.setAutoplay(t)}),!0)},autoplay:function(){return this.supportAutoplay()&&("true"==base.parameters.get("autoplay")||this._streamProvider.isLiveStreaming)&&!base.userAgent.browser.IsMobileVersion},supportAutoplay:function(){var t=!1;return this.masterVideo()&&(t=this.masterVideo().supportAutoplay()),this.slaveVideo()&&t&&(t=t&&this.slaveVideo().supportAutoplay()),0<this._audioPlayers.lenght&&t&&this._audioPlayers.forEach(function(e){t=t&&e.supportAutoplay()}),t},numberOfStreams:function(){return this._sourceData.length},getMonostreamMasterProfile:function(){this.masterVideo();return{content:"presenter",visible:!0,layer:1,rect:[{aspectRatio:"1/1",left:280,top:0,width:720,height:720},{aspectRatio:"6/5",left:208,top:0,width:864,height:720},{aspectRatio:"5/4",left:190,top:0,width:900,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720},{aspectRatio:"11/8",left:145,top:0,width:990,height:720},{aspectRatio:"1.41/1",left:132,top:0,width:1015,height:720},{aspectRatio:"1.43/1",left:125,top:0,width:1029,height:720},{aspectRatio:"3/2",left:100,top:0,width:1080,height:720},{aspectRatio:"16/10",left:64,top:0,width:1152,height:720},{aspectRatio:"5/3",left:40,top:0,width:1200,height:720},{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"1.85/1",left:0,top:14,width:1280,height:692},{aspectRatio:"2.35/1",left:0,top:87,width:1280,height:544},{aspectRatio:"2.41/1",left:0,top:94,width:1280,height:531},{aspectRatio:"2.76/1",left:0,top:128,width:1280,height:463}]}},getMonostreamSlaveProfile:function(){return{content:"slides",visible:!1,layer:0,rect:[{aspectRatio:"16/9",left:0,top:0,width:0,height:0},{aspectRatio:"4/3",left:0,top:0,width:0,height:0}]}},getCurrentProfileName:function(){return this._currentProfile},setProfile:function(n,a){var i=this;return new Promise(function(t){a=!base.userAgent.browser.Explorer&&a,i.masterVideo()?paella.Profiles.loadProfile(n,function(e){i._currentProfile=n,0==i._streamProvider.slaveVideos.length&&(e.masterVideo=i.getMonostreamMasterProfile(),e.slaveVideo=i.getMonostreamSlaveProfile()),i.applyProfileWithJson(e,a),t(n)}):t()})},getProfile:function(n){return new Promise(function(t,e){paella.Profiles.loadProfile(n,function(e){t(e)})})},hideAllLogos:function(){for(var e=0;e<this.logos.length;++e){var t=this.logos[e],n=this.container.getNode(t);$(n.domElement).hide()}},showLogos:function(e){if(null!=e)for(var t=new paella.RelativeVideoSize,n=0;n<e.length;++n){var a=e[n],i=a.content,r=this.container.getNode(i),o=a.rect;r?$(r.domElement).show():(l={},(r=this.container.addNode(new paella.DomNode("img",i,l))).domElement.setAttribute("src",paella.utils.folders.profiles()+"/resources/"+i),r.domElement.setAttribute("src",paella.utils.folders.profiles()+"/resources/"+i));var l={top:t.percentVSize(o.top)+"%",left:t.percentWSize(o.left)+"%",width:t.percentWSize(o.width)+"%",height:t.percentVSize(o.height)+"%",position:"absolute",zIndex:a.zIndex};$(r.domElement).css(l)}},getClosestRect:function(e,t){var n=10,a=/([0-9\.]+)\/([0-9\.]+)/,i=e.rect[0],r=0==t.h?1.333333:t.w/t.h,o=1,l=!1;return e.rect.forEach(function(e){(l=a.exec(e.aspectRatio))&&(o=Number(l[1])/Number(l[2]));var t=Math.abs(o-r);t<n&&(n=t,i=e)}),i},applyProfileWithJson:function(m,h){var t=function(e,t){null==h&&(h=!0);var n=this.videoWrappers[0],a=1<this.videoWrappers.length?this.videoWrappers[1]:null,i=(this.masterVideo(),this.slaveVideo(),this.container.getNode(this.backgroundId)),r=e.res,o=t&&t.res,l=this.getClosestRect(m.masterVideo,e.res),s=t&&this.getClosestRect(m.slaveVideo,t.res);if(this.hideAllLogos(),this.showLogos(m.logos),dynamic_cast("paella.ProfileFrameStrategy",this.profileFrameStrategy)){var u=$(this.domElement).width(),c=($(this.domElement).height(),l.width/u),d={width:r.w*c,height:r.h*c};if(l.left=Number(l.left),l.top=Number(l.top),l.width=Number(l.width),l.height=Number(l.height),l=this.profileFrameStrategy.adaptFrame(d,l),a){var p={width:o.w*c,height:o.h*c};s.left=Number(s.left),s.top=Number(s.top),s.width=Number(s.width),s.height=Number(s.height),s=this.profileFrameStrategy.adaptFrame(p,s)}}n.setRect(l,h),this.currentMasterVideoRect=l,n.setVisible(m.masterVideo.visible,h),this.currentMasterVideoRect.visible=!!/true/i.test(m.masterVideo.visible),this.currentMasterVideoRect.layer=parseInt(m.masterVideo.layer),a&&(a.setRect(s,h),this.currentSlaveVideoRect=s,this.currentSlaveVideoRect.visible=!!/true/i.test(m.slaveVideo.visible),this.currentSlaveVideoRect.layer=parseInt(m.slaveVideo.layer),a.setVisible(m.slaveVideo.visible,h),a.setLayer(m.slaveVideo.layer)),n.setLayer(m.masterVideo.layer),i.setImage(paella.utils.folders.profiles()+"/resources/"+m.background.content)},n=this;if(this.masterVideo())if(this.slaveVideo()){var a={};this.masterVideo().getVideoData().then(function(e){return a=e,n.slaveVideo().getVideoData()}).then(function(e){t.apply(n,[a,e])})}else this.masterVideo().getVideoData().then(function(e){t.apply(n,[e])})},resizePortrail:function(){var e=1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width(),t=(new paella.RelativeVideoSize).proportionalHeight(e);this.container.domElement.style.width=e+"px",this.container.domElement.style.height=t+"px";var n=(1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height())/2-t/2;this.container.domElement.style.top=n+"px"},resizeLandscape:function(){var e=1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height(),t=(new paella.RelativeVideoSize).proportionalWidth(e);this.container.domElement.style.width=t+"px",this.container.domElement.style.height=e+"px",this.container.domElement.style.top="0px"},onresize:function(){$traceurRuntime.superGet(this,r.prototype,"onresize").call(this),(new paella.RelativeVideoSize).aspectRatio()<(1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width())/(1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height())?this.resizeLandscape():this.resizePortrail()}},{},e)}(paella.VideoContainerBase);paella.VideoContainer=t}(),Class("paella.PluginManager",{targets:null,pluginList:[],eventDrivenPlugins:[],enabledPlugins:[],setupPlugin:function(e){e.setup(),this.enabledPlugins.push(e),dynamic_cast("paella.UIPlugin",e)&&e.checkVisibility()},checkPluginsVisibility:function(){this.enabledPlugins.forEach(function(e){dynamic_cast("paella.UIPlugin",e)&&e.checkVisibility()})},initialize:function(){this.targets={};var t=this;paella.events.bind(paella.events.loadPlugins,function(e){t.loadPlugins("paella.DeferredLoadPlugin")}),new base.Timer(function(){paella.player&&paella.player.controls&&paella.player.controls.onresize()},1e3).repeat=!0},setTarget:function(e,t){t.addPlugin&&(this.targets[e]=t)},getTarget:function(e){return"eventDriven"==e?this:this.targets[e]},registerPlugin:function(e){this.importLibraries(e),this.pluginList.push(e),this.pluginList.sort(function(e,t){return e.getIndex()-t.getIndex()})},importLibraries:function(e){e.getDependencies().forEach(function(e){var t=document.createElement("script");t.type="text/javascript",t.src="javascript/"+e+".js",document.head.appendChild(t)})},loadPlugins:function(n){if(null!=n){var a=this;this.foreach(function(e,t){null!=dynamic_cast(n,e)&&t.enabled&&(base.log.debug("Load plugin ("+n+"): "+e.getName()),e.config=t,e.load(a))})}},foreach:function(a){var i=!1,r={};try{i=paella.player.config.plugins.enablePluginsByDefault}catch(e){}try{r=paella.player.config.plugins.list}catch(e){}this.pluginList.forEach(function(e){var t=e.getName(),n=r[t];n||(n={enabled:i}),a(e,n)})},addPlugin:function(r){var o=this;r.checkEnabled(function(e){if("eventDriven"==r.type&&e){paella.pluginManager.setupPlugin(r),o.eventDrivenPlugins.push(r);for(var t=r.getEvents(),n=function(e,t){r.onEvent(e.type,t)},a=0;a<t.length;++a){var i=t[a];paella.events.bind(i,n)}}})},getPlugin:function(e){for(var t=0;t<this.pluginList.length;++t)if(this.pluginList[t].getName()==e)return this.pluginList[t];return null}}),paella.pluginManager=new paella.PluginManager,Class("paella.Plugin",{type:"",initialize:function(){paella.pluginManager.registerPlugin(this)},getDependencies:function(){return[]},load:function(e){var t=e.getTarget(this.type);t&&t.addPlugin&&t.addPlugin(this)},getRootNode:function(e){return null},checkEnabled:function(e){e(!0)},setup:function(){},getIndex:function(){return 0},getName:function(){return""}}),Class("paella.FastLoadPlugin",paella.Plugin,{}),Class("paella.EarlyLoadPlugin",paella.Plugin,{}),Class("paella.DeferredLoadPlugin",paella.Plugin,{}),Class("paella.PopUpContainer",paella.DomNode,{containers:null,currentContainerId:-1,initialize:function(e,t){this.parent("div",e,{}),this.domElement.className=t,this.containers={}},hideContainer:function(e,t){var n=this.containers[e];n&&this.currentContainerId==e&&(n.identifier=e,paella.events.trigger(paella.events.hidePopUp,{container:n}),n.plugin.willHideContent(),$(n.element).hide(),n.button.className=n.button.className.replace(" selected",""),$(this.domElement).css({width:"0px"}),this.currentContainerId=-1,n.plugin.didHideContent())},showContainer:function(a,i){var r=this,o=0;function e(e){paella.events.trigger(paella.events.hidePopUp,{container:e}),e.plugin.willHideContent(),$(e.element).hide(),$(r.domElement).css({width:"0px"}),e.button.className=e.button.className.replace(" selected",""),r.currentContainerId=-1,e.plugin.didHideContent()}function t(e){if(paella.events.trigger(paella.events.showPopUp,{container:e}),e.plugin.willShowContent(),e.button.className=e.button.className+" selected",$(e.element).show(),o=$(e.element).width(),"right"==e.plugin.getAlignment()){var t=$(i.parentElement).width()-$(i).position().left-$(i).width();$(r.domElement).css({width:o+"px",right:t+"px",left:""})}else{var n=$(i).position().left;$(r.domElement).css({width:o+"px",left:n+"px",right:""})}r.currentContainerId=a,e.plugin.didShowContent()}var n=this.containers[a];n&&this.currentContainerId!=a&&-1!=this.currentContainerId?(e(this.containers[this.currentContainerId]),t(n)):n&&this.currentContainerId==a?e(n):n&&t(n)},registerContainer:function(e,t,n,a){var i={identifier:e,button:n,element:t,plugin:a};if(this.containers[e]=i,a.closeOnMouseOut&&a.closeOnMouseOut()){var r=e,o=n;$(t).mouseleave(function(e){paella.player.controls.playbackControl().hidePopUp(r,o)})}$(t).hide(),n.popUpIdentifier=e,n.sourcePlugin=a,$(n).click(function(e){this.plugin.isPopUpOpen()?paella.player.controls.playbackControl().hidePopUp(this.popUpIdentifier,this):paella.player.controls.playbackControl().showPopUp(this.popUpIdentifier,this)}),$(n).keyup(function(e){13!=e.keyCode||this.plugin.isPopUpOpen()?27==e.keyCode&&paella.player.controls.playbackControl().hidePopUp(this.popUpIdentifier,this):paella.player.controls.playbackControl().showPopUp(this.popUpIdentifier,this)}),a.containerManager=this}}),Class("paella.TimelineContainer",paella.PopUpContainer,{hideContainer:function(e,t){var n=this.containers[e];n&&this.currentContainerId==e&&(paella.events.trigger(paella.events.hidePopUp,{container:n}),n.plugin.willHideContent(),$(n.element).hide(),n.button.className=n.button.className.replace(" selected",""),this.currentContainerId=-1,$(this.domElement).css({height:"0px"}),n.plugin.didHideContent())},showContainer:function(e,t){var n=0,a=this.containers[e];if(a&&this.currentContainerId!=e&&-1!=this.currentContainerId){var i=this.containers[this.currentContainerId];i.button.className=i.button.className.replace(" selected",""),a.button.className=a.button.className+" selected",paella.events.trigger(paella.events.hidePopUp,{container:i}),i.plugin.willHideContent(),$(i.element).hide(),i.plugin.didHideContent(),paella.events.trigger(paella.events.showPopUp,{container:a}),a.plugin.willShowContent(),$(a.element).show(),this.currentContainerId=e,n=$(a.element).height(),$(this.domElement).css({height:n+"px"}),a.plugin.didShowContent()}else a&&this.currentContainerId==e?(paella.events.trigger(paella.events.hidePopUp,{container:a}),a.plugin.willHideContent(),$(a.element).hide(),a.button.className=a.button.className.replace(" selected",""),$(this.domElement).css({height:"0px"}),this.currentContainerId=-1,a.plugin.didHideContent()):a&&(paella.events.trigger(paella.events.showPopUp,{container:a}),a.plugin.willShowContent(),a.button.className=a.button.className+" selected",$(a.element).show(),this.currentContainerId=e,n=$(a.element).height(),$(this.domElement).css({height:n+"px"}),a.plugin.didShowContent())}}),Class("paella.UIPlugin",paella.DeferredLoadPlugin,{ui:null,checkVisibility:function(){var e=this.config.visibleOn||[paella.PaellaPlayer.mode.standard,paella.PaellaPlayer.mode.fullscreen,paella.PaellaPlayer.mode.embed],t=!1;e.forEach(function(e){e==paella.player.getPlayerMode()&&(t=!0)}),t?this.showUI():this.hideUI()},hideUI:function(){this.ui.setAttribute("aria-hidden","true"),$(this.ui).hide()},showUI:function(){var t=this;paella.pluginManager.enabledPlugins.forEach(function(e){e==t&&(t.ui.setAttribute("aria-hidden","false"),$(t.ui).show())})}}),Class("paella.ButtonPlugin",paella.UIPlugin,{type:"button",subclass:"",container:null,containerManager:null,getAlignment:function(){return"left"},getSubclass:function(){return"myButtonPlugin"},addSubclass:function(e){$(this.container).addClass(e)},removeSubclass:function(e){$(this.container).removeClass(e)},action:function(e){},getName:function(){return"ButtonPlugin"},getMinWindowSize:function(){return 0},buildContent:function(e){},willShowContent:function(){base.log.debug(this.getName()+" willDisplayContent")},didShowContent:function(){base.log.debug(this.getName()+" didDisplayContent")},willHideContent:function(){base.log.debug(this.getName()+" willHideContent")},didHideContent:function(){base.log.debug(this.getName()+" didHideContent")},getButtonType:function(){return paella.ButtonPlugin.type.actionButton},getText:function(){return""},setText:function(e){this.container.innerHTML=paella.AntiXSS.htmlEscape(e)},hideButton:function(){this.hideUI()},showButton:function(){this.showUI()},changeSubclass:function(e){this.subclass=e,this.container.className=this.getClassName()},getClassName:function(){return paella.ButtonPlugin.kClassName+" "+this.getAlignment()+" "+this.subclass},getContainerClassName:function(){return this.getButtonType()==paella.ButtonPlugin.type.timeLineButton?paella.ButtonPlugin.kTimeLineClassName+" "+this.getSubclass():this.getButtonType()==paella.ButtonPlugin.type.popUpButton?paella.ButtonPlugin.kPopUpClassName+" "+this.getSubclass():void 0},setToolTip:function(e){this.button.setAttribute("title",e),this.button.setAttribute("aria-label",e)},getDefaultToolTip:function(){return""},isPopUpOpen:function(){return this.button.popUpIdentifier==this.containerManager.currentContainerId}}),paella.ButtonPlugin.alignment={left:"left",right:"right"},paella.ButtonPlugin.kClassName="buttonPlugin",paella.ButtonPlugin.kPopUpClassName="buttonPluginPopUp",paella.ButtonPlugin.kTimeLineClassName="buttonTimeLine",paella.ButtonPlugin.type={actionButton:1,popUpButton:2,timeLineButton:3},paella.ButtonPlugin.buildPluginButton=function(e,t){e.subclass=e.getSubclass();var n=document.createElement("div");function a(e){paella.userTracking.log("paella:button:action",e.plugin.getName()),e.plugin.action(e)}return n.className=e.getClassName(),n.id=t,n.innerText=e.getText(),n.setAttribute("tabindex",1e3+e.getIndex()),n.setAttribute("alt",""),n.setAttribute("role","button"),(n.plugin=e).button=n,e.container=n,e.ui=n,e.setToolTip(e.getDefaultToolTip()),$(n).click(function(e){a(this)}),$(n).keyup(function(e){13==e.keyCode&&a(this)}),n},paella.ButtonPlugin.buildPluginPopUp=function(e,t,n){t.subclass=t.getSubclass();var a=document.createElement("div");return e.appendChild(a),a.className=t.getContainerClassName(),a.id=n,(a.plugin=t).buildContent(a),a},Class("paella.VideoOverlayButtonPlugin",paella.ButtonPlugin,{type:"videoOverlayButton",getSubclass:function(){return"myVideoOverlayButtonPlugin "+this.getAlignment()},action:function(e){},getName:function(){return"VideoOverlayButtonPlugin"}}),Class("paella.EventDrivenPlugin",paella.EarlyLoadPlugin,{type:"eventDriven",initialize:function(){this.parent();for(var e=this.getEvents(),t=0;t<e.length;++t){e[t]==paella.events.loadStarted&&this.onEvent(paella.events.loadStarted)}},getEvents:function(){return[]},onEvent:function(e,t){},getName:function(){return"EventDrivenPlugin"}}),function(){var i=new(Class({_formats:{},addPlugin:function(t){var n=this,e=t.ext;0==(Array.isArray&&Array.isArray(e)||e instanceof Array)&&(e=[e]),0==e.length?base.log.debug("No extension provided by the plugin "+t.getName()):(base.log.debug("New captionParser added: "+t.getName()),e.forEach(function(e){n._formats[e]=t}))},initialize:function(){paella.pluginManager.setTarget("captionParser",this)}})),r=Class(base.AsyncLoaderCallback,{initialize:function(e,t){this.name="captionSearchCallback",this.caption=e,this.text=t},load:function(n,a){var i=this;this.caption.search(this.text,function(e,t){e?a():(i.result=t,n())})}});paella.captions={parsers:{},_captions:{},_activeCaption:void 0,addCaptions:function(e){var t=e._captionsProvider+":"+e._id;this._captions[t]=e,paella.events.trigger(paella.events.captionAdded,t)},getAvailableLangs:function(){var n=[],a=this;return Object.keys(this._captions).forEach(function(e){var t=a._captions[e];n.push({id:e,lang:t._lang})}),n},getCaptions:function(e){if(e&&this._captions[e])return this._captions[e]},getActiveCaptions:function(e){return this._activeCaption},setActiveCaptions:function(e){return this._activeCaption=this.getCaptions(e),null!=this._activeCaption?paella.events.trigger(paella.events.captionsEnabled,e):paella.events.trigger(paella.events.captionsDisabled),this._activeCaption},getCaptionAtTime:function(e,t){var n=this.getCaptions(e);if(null!=n)return n.getCaptionAtTime(t)},search:function(t,e){var n=this,a=new base.AsyncLoader;this.getAvailableLangs().forEach(function(e){a.addCallback(new r(n.getCaptions(e.id),t))}),a.load(function(){var t=[];Object.keys(a.callbackArray).forEach(function(e){t=t.concat(a.getCallback(e).result)}),e&&e(!1,t)},function(){e&&e(!0)})}},Class("paella.captions.Caption",{initialize:function(e,t,n,a,i){this._id=e,this._format=t,this._url=n,this._captions=void 0,this._index=lunr(function(){this.ref("id"),this.field("content",{boost:10})}),"string"==typeof a&&(a={code:a,txt:a}),this._lang=a,this._captionsProvider="downloadCaptionsProvider",this.reloadCaptions(i)},canEdit:function(e){e(!1,!1)},goToEdit:function(){},reloadCaptions:function(n){var a=this;jQuery.ajax({url:a._url,cache:!1,type:"get",dataType:"text"}).then(function(e){var t=i._formats[a._format];null==t?(base.log.debug("Error adding captions: Format not supported!"),paella.player.videoContainer.duration(!0).then(function(e){a._captions=[{id:0,begin:0,end:e,content:base.dictionary.translate("Error! Captions format not supported.")}],n&&n(!0)})):t.parse(e,a._lang.code,function(e,t){e||(a._captions=t,a._captions.forEach(function(e){a._index.add({id:e.id,content:e.content})})),n&&n(e)})}).fail(function(e){base.log.debug("Error loading captions: "+a._url),n&&n(!0)})},getCaptions:function(){return this._captions},getCaptionAtTime:function(e){if(null!=this._captions)for(var t=0;t<this._captions.length;++t){var n=this._captions[t];if(n.begin<=e&&n.end>=e)return n}},getCaptionById:function(e){if(null!=this._captions)for(var t=0;t<this._captions.length;++t){var n=this._captions[t];if(n.id==e)return n}},search:function(e,t){var a=this,i=this;if(null==this._index)t&&t(!0,"Error. No captions found.");else{var r=[];paella.player.videoContainer.trimming().then(function(n){a._index.search(e).forEach(function(e){var t=i.getCaptionById(e.ref);n.enabled&&(t.end<n.start||t.begin>n.end)||r.push({time:t.begin,content:t.content,score:e.score})}),t&&t(!1,r)})}}}),Class("paella.CaptionParserPlugIn",paella.FastLoadPlugin,{type:"captionParser",getIndex:function(){return-1},ext:[],parse:function(e,t,n){throw new Error("paella.CaptionParserPlugIn#parse must be overridden by subclass")}})}(),function(){var a=new(Class({_plugins:[],addPlugin:function(e){this._plugins.push(e)},initialize:function(){paella.pluginManager.setTarget("SearchServicePlugIn",this)}})),i=Class(base.AsyncLoaderCallback,{initialize:function(e,t){this.name="searchCallback",this.plugin=e,this.text=t},load:function(n,a){var i=this;this.plugin.search(this.text,function(e,t){e?a():(i.result=t,n())})}});paella.searchService={search:function(t,e){var n=new base.AsyncLoader;paella.userTracking.log("paella:searchService:search",t),a._plugins.forEach(function(e){n.addCallback(new i(e,t))}),n.load(function(){var t=[];Object.keys(n.callbackArray).forEach(function(e){t=t.concat(n.getCallback(e).result)}),e&&e(!1,t)},function(){e&&e(!0)})}},Class("paella.SearchServicePlugIn",paella.FastLoadPlugin,{type:"SearchServicePlugIn",getIndex:function(){return-1},search:function(e,t){throw new Error("paella.SearchServicePlugIn#search must be overridden by subclass")}})}(),function(){var a=new(Class({_plugins:[],addPlugin:function(t){var n=this;t.checkEnabled(function(e){e&&(t.setup(),n._plugins.push(t))})},initialize:function(){paella.pluginManager.setTarget("userTrackingSaverPlugIn",this)}}));paella.userTracking={},Class("paella.userTracking.SaverPlugIn",paella.FastLoadPlugin,{type:"userTrackingSaverPlugIn",getIndex:function(){return-1},checkEnabled:function(e){e(!0)},log:function(e,t){throw new Error("paella.userTracking.SaverPlugIn#log must be overridden by subclass")}});var i={};paella.userTracking.log=function(t,n){null!=i[t]&&i[t].cancel(),i[t]=new base.Timer(function(e){a._plugins.forEach(function(e){e.log(t,n)}),delete i[t]},500)},[paella.events.play,paella.events.pause,paella.events.endVideo,paella.events.showEditor,paella.events.hideEditor,paella.events.enterFullscreen,paella.events.exitFullscreen,paella.events.loadComplete].forEach(function(n){paella.events.bind(n,function(e,t){paella.userTracking.log(n)})}),[paella.events.showPopUp,paella.events.hidePopUp].forEach(function(n){paella.events.bind(n,function(e,t){paella.userTracking.log(n,t.identifier)})}),[paella.events.captionsEnabled,paella.events.captionsDisabled].forEach(function(i){paella.events.bind(i,function(e,t){var n;if(null!=t){var a=paella.captions.getCaptions(t);n={id:t,lang:a._lang,url:a._url}}paella.userTracking.log(i,n)})}),[paella.events.setProfile].forEach(function(n){paella.events.bind(n,function(e,t){paella.userTracking.log(n,t.profileName)})}),[paella.events.seekTo,paella.events.seekToTime].forEach(function(a){paella.events.bind(a,function(e,t){var n;try{JSON.stringify(t),n=t}catch(e){}paella.userTracking.log(a,n)})}),[paella.events.setVolume,paella.events.resize,paella.events.setPlaybackRate].forEach(function(a){paella.events.bind(a,function(e,t){var n;try{JSON.stringify(t),n=t}catch(e){}paella.userTracking.log(a,n)})})}(),Class("paella.TimeControl",paella.DomNode,{initialize:function(e){this.parent("div",e,{left:"0%"}),this.domElement.className="timeControlOld",this.domElement.className="timeControl";var n=this;paella.events.bind(paella.events.timeupdate,function(e,t){n.onTimeUpdate(t)})},onTimeUpdate:function(e){e.videoContainer,e.currentTime,e.duration;this.domElement.innerText=this.secondsToHours(parseInt(e.currentTime))},secondsToHours:function(e){var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),a=e-3600*t-60*n;return t<10&&(t="0"+t),n<10&&(n="0"+n),a<10&&(a="0"+a),t+":"+n+":"+a}}),Class("paella.PlaybackBar",paella.DomNode,{playbackFullId:"",updatePlayBar:!0,timeControlId:"",_images:null,_keys:null,_prev:null,_next:null,_videoLength:null,_lastSrc:null,_aspectRatio:1.777777778,_hasSlides:null,_imgNode:null,_canvas:null,initialize:function(e){this.parent("div",e,{}),this.domElement.className="playbackBar",this.domElement.setAttribute("alt",""),this.domElement.setAttribute("aria-label","Timeline Slider"),this.domElement.setAttribute("role","slider"),this.domElement.setAttribute("aria-valuemin","0"),this.domElement.setAttribute("aria-valuemax","100"),this.domElement.setAttribute("aria-valuenow","0"),this.domElement.setAttribute("tabindex","1100"),$(this.domElement).keyup(function(n){var a=0,i=0;paella.player.videoContainer.currentTime().then(function(e){return a=e,paella.player.videoContainer.duration()}).then(function(e){var t;switch(i=e,n.keyCode){case 37:t=100*a/i-5,paella.player.videoContainer.seekTo(t);break;case 39:t=100*a/i+5,paella.player.videoContainer.seekTo(t)}})}),this.playbackFullId=e+"_full",this.timeControlId=e+"_timeControl";var t=new paella.DomNode("div",this.playbackFullId,{width:"0%"});t.domElement.className="playbackBarFull",this.addNode(t),this.addNode(new paella.TimeControl(this.timeControlId));var n=this;paella.events.bind(paella.events.timeupdate,function(e,t){n.onTimeUpdate(t)}),$(this.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(n,e),e.stopPropagation()}),$(t.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(n,e),e.stopPropagation()}),base.userAgent.browser.IsMobileVersion||($(this.domElement).bind("mousemove",function(e){n.movePassive(e),paella.utils.mouseManager.move(e)}),$(t.domElement).bind("mousemove",function(e){paella.utils.mouseManager.move(e)}),$(this.domElement).bind("mouseout",function(e){n.mouseOut(e)})),$(this.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)}),$(t.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)}),paella.player.isLiveStream()&&$(this.domElement).hide()},mouseOut:function(e){this._hasSlides?$("#divTimeImageOverlay").remove():$("#divTimeOverlay").remove()},drawTimeMarks:function(){var t=this,r={};paella.player.videoContainer.trimming().then(function(e){return r=e,t.imageSetup()}).then(function(){var a=t,i=(r.enabled?(r.end,r.start):t._videoLength,$("#playerContainer_controls_playback_playbackBar"));t.clearCanvas(),t._keys&&paella.player.config.player.slidesMarks.enabled&&t._keys.forEach(function(e){var t=parseInt(e)-r.start;if(0<t){var n=t*i.width()/a._videoLength;a.drawTimeMark(n)}})})},drawTimeMark:function(e){var t=this.getCanvasContext();t.fillStyle=paella.player.config.player.slidesMarks.color,t.fillRect(e,0,1,12)},clearCanvas:function(){this._canvas&&this.getCanvasContext().clearRect(0,0,this._canvas.width,this._canvas.height)},getCanvas:function(){if(!this._canvas){var e=$("#playerContainer_controls_playback_playbackBar"),t=document.createElement("canvas");t.className="playerContainer_controls_playback_playbackBar_canvas",t.id="playerContainer_controls_playback_playbackBar_canvas",t.width=e.width();t.height=e.height();e.prepend(t),this._canvas=document.getElementById("playerContainer_controls_playback_playbackBar_canvas")}return this._canvas},getCanvasContext:function(){return this.getCanvas().getContext("2d")},movePassive:function(f){var g=this;paella.player.videoContainer.duration();var t=0;paella.player.videoContainer.duration().then(function(e){return t=e,paella.player.videoContainer.trimming()}).then(function(e){!function(e,t){var n=$(g.domElement),a=n.offset(),i=n.width(),r=f.clientX-a.left,o=100*(r=r<0?0:r)/i*e/100;t.enabled&&(o+=t.start);var l=Math.floor((o-t.start)/3600)%24;l=("00"+l).slice(l.toString().length);var s=Math.floor((o-t.start)/60)%60;s=("00"+s).slice(s.toString().length);var u=Math.floor((o-t.start)%60),c=l+":"+s+":"+(u=("00"+u).slice(u.toString().length));if(g._hasSlides?(0==$("#divTimeImageOverlay").length?g.setupTimeImageOverlay(c,a.top,i):$("#divTimeOverlay")[0].innerText=c,g.imageUpdate(o)):0==$("#divTimeOverlay").length?g.setupTimeOnly(c,a.top,i):$("#divTimeOverlay")[0].innerText=c,g._hasSlides){var d=$("#divTimeImageOverlay").width(),p=f.clientX-d/2;f.clientX>d/2+a.left&&f.clientX<a.left+i-d/2?$("#divTimeImageOverlay").css("left",p):f.clientX<i/2?$("#divTimeImageOverlay").css("left",a.left):$("#divTimeImageOverlay").css("left",a.left+i-d)}var m=$("#divTimeOverlay").width(),h=f.clientX-m/2;f.clientX>m/2+a.left&&f.clientX<a.left+i-m/2?$("#divTimeOverlay").css("left",h):f.clientX<i/2?$("#divTimeOverlay").css("left",a.left):$("#divTimeOverlay").css("left",a.left+i-m-2),g._hasSlides&&$("#divTimeImageOverlay").css("bottom",$(".playbackControls").height())}(t,e)})},imageSetup:function(){var a=this;return new Promise(function(n){paella.player.videoContainer.duration().then(function(e){a._images={};var t=paella.initDelegate.initParams.videoLoader.frameList;t&&0!==Object.keys(t).length?(a._hasSlides=!0,a._images=t,a._videoLength=e,a._keys=Object.keys(a._images),a._keys=a._keys.sort(function(e,t){return parseInt(e)-parseInt(t)}),a._next=0,a._prev=0,n()):a._hasSlides=!1})})},imageUpdate:function(e){var t=this,n=$("#imgOverlay").attr("src");if($(t._imgNode).show(),e>this._next||e<this._prev)(n=t.getPreviewImageSrc(e))?(t._lastSrc=n,$("#imgOverlay").attr("src",n)):t.hideImg();else{if(null!=n)return;$("#imgOverlay").attr("src",t._lastSrc)}},hideImg:function(){$(this._imgNode).hide()},getPreviewImageSrc:function(e){var t=Object.keys(this._images);t.push(e),t.sort(function(e,t){return parseInt(e)-parseInt(t)});var n=t.indexOf(e)-1,a=t[n=0<n?n:0],i=t[n+2],r=t[n];return i=null==i?t.length-1:parseInt(i),this._next=i,r=null==r?0:parseInt(r),this._prev=r,a=parseInt(a),!!this._images[a]&&(this._images[a].url||this._images[a].url)},setupTimeImageOverlay:function(e,t,n){var a=document.createElement("div");a.className="divTimeImageOverlay",a.id="divTimeImageOverlay";var i=Math.round(n/10);if(a.style.width=Math.round(i*this._aspectRatio)+"px",this._hasSlides){var r=document.createElement("img");r.className="imgOverlay",r.id="imgOverlay",this._imgNode=r,a.appendChild(r)}var o=document.createElement("div");o.className="divTimeOverlay",o.style.top=t-20+"px",o.id="divTimeOverlay",o.innerText=e,a.appendChild(o),$(this.domElement).parent().append(a)},setupTimeOnly:function(e,t,n){var a=document.createElement("div");a.className="divTimeOverlay",a.style.top=t-20+"px",a.id="divTimeOverlay",a.innerText=e,$(this.domElement).parent().append(a)},playbackFull:function(){return this.getNode(this.playbackFullId)},timeControl:function(){return this.getNode(this.timeControlId)},setPlaybackPosition:function(e){this.playbackFull().domElement.style.width=e+"%"},isSeeking:function(){return!this.updatePlayBar},onTimeUpdate:function(e){if(this.updatePlayBar){var t=e.currentTime,n=e.duration;this.setPlaybackPosition(100*t/n)}},down:function(e,t,n){this.updatePlayBar=!1,this.move(e,t,n)},move:function(e,t,n){var a=$(this.domElement).width(),i=t-$(this.domElement).offset().left;i=i<0?0:a<i?100:100*i/a,this.setPlaybackPosition(i)},up:function(e,t,n){var a=$(this.domElement).width(),i=t-$(this.domElement).offset().left;i=i<0?0:a<i?100:100*i/a,paella.player.videoContainer.seekTo(i),this.updatePlayBar=!0},onresize:function(){this.drawTimeMarks()}}),Class("paella.PlaybackControl",paella.DomNode,{playbackBarId:"",pluginsContainer:null,_popUpPluginContainer:null,_timeLinePluginContainer:null,playbackPluginsWidth:0,popupPluginsWidth:0,minPlaybackBarSize:120,playbackBarInstance:null,buttonPlugins:[],addPlugin:function(r){var o=this,e="buttonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(r);var l=paella.ButtonPlugin.buildPluginButton(r,e);r.button=l,this.pluginsContainer.domElement.appendChild(l),$(l).hide(),r.checkEnabled(function(e){var t;if(e){$(r.button).show(),paella.pluginManager.setupPlugin(r);var n="buttonPlugin"+o.buttonPlugins.length;if(r.getButtonType()==paella.ButtonPlugin.type.popUpButton){t=o.popUpPluginContainer.domElement;var a=paella.ButtonPlugin.buildPluginPopUp(t,r,n+"_container");o.popUpPluginContainer.registerContainer(r.getName(),a,l,r)}else if(r.getButtonType()==paella.ButtonPlugin.type.timeLineButton){t=o.timeLinePluginContainer.domElement;var i=paella.ButtonPlugin.buildPluginPopUp(t,r,n+"_timeline");o.timeLinePluginContainer.registerContainer(r.getName(),i,l,r)}}else o.pluginsContainer.domElement.removeChild(r.button)})},initialize:function(e){this.parent("div",e,{}),this.domElement.className="playbackControls",this.playbackBarId=e+"_playbackBar";this.pluginsContainer=new paella.DomNode("div",e+"_playbackBarPlugins"),this.pluginsContainer.domElement.className="playbackBarPlugins",this.pluginsContainer.domElement.setAttribute("role","toolbar"),this.addNode(this.pluginsContainer),this.addNode(new paella.PlaybackBar(this.playbackBarId)),paella.pluginManager.setTarget("button",this),Object.defineProperty(this,"popUpPluginContainer",{get:function(){return this._popUpPluginContainer||(this._popUpPluginContainer=new paella.PopUpContainer(e+"_popUpPluginContainer","popUpPluginContainer"),this.addNode(this._popUpPluginContainer)),this._popUpPluginContainer}}),Object.defineProperty(this,"timeLinePluginContainer",{get:function(){return this._timeLinePluginContainer||(this._timeLinePluginContainer=new paella.TimelineContainer(e+"_timelinePluginContainer","timelinePluginContainer"),this.addNode(this._timeLinePluginContainer)),this._timeLinePluginContainer}})},showPopUp:function(e,t){this.popUpPluginContainer.showContainer(e,t),this.timeLinePluginContainer.showContainer(e,t)},hidePopUp:function(e,t){this.popUpPluginContainer.hideContainer(e,t),this.timeLinePluginContainer.hideContainer(e,t)},playbackBar:function(){return null==this.playbackBarInstance&&(this.playbackBarInstance=this.getNode(this.playbackBarId)),this.playbackBarInstance},onresize:function(){var e=$(this.domElement).width();base.log.debug("resize playback bar (width="+e+")");for(var t=0;t<this.buttonPlugins.length;++t){var n=this.buttonPlugins[t],a=n.getMinWindowSize();0<a&&e<a?n.hideUI():n.checkVisibility()}this.getNode(this.playbackBarId).onresize()}}),Class("paella.ControlsContainer",paella.DomNode,{playbackControlId:"",editControlId:"",isEnabled:!0,autohideTimer:null,hideControlsTimeMillis:3e3,playbackControlInstance:null,videoOverlayButtons:null,buttonPlugins:[],_hidden:!1,addPlugin:function(t){var e="videoOverlayButtonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(t);var n=paella.ButtonPlugin.buildPluginButton(t,e);this.videoOverlayButtons.domElement.appendChild(n),t.button=n,$(n).hide(),t.checkEnabled(function(e){e&&($(t.button).show(),paella.pluginManager.setupPlugin(t))})},initialize:function(e){this.parent("div",e),this.viewControlId=e+"_view",this.playbackControlId=e+"_playback",this.editControlId=e+"_editor",this.addNode(new paella.PlaybackControl(this.playbackControlId));var t=this;paella.events.bind(paella.events.showEditor,function(e){t.onShowEditor()}),paella.events.bind(paella.events.hideEditor,function(e){t.onHideEditor()}),paella.events.bind(paella.events.play,function(e){t.onPlayEvent()}),paella.events.bind(paella.events.pause,function(e){t.onPauseEvent()}),$(document).mousemove(function(e){paella.player.controls.restartHideTimer()}),paella.events.bind(paella.events.endVideo,function(e){t.onEndVideoEvent()}),paella.events.bind("keydown",function(e){t.onKeyEvent()}),this.videoOverlayButtons=new paella.DomNode("div",e+"_videoOverlayButtonPlugins"),this.videoOverlayButtons.domElement.className="videoOverlayButtonPlugins",this.videoOverlayButtons.domElement.setAttribute("role","toolbar"),this.addNode(this.videoOverlayButtons),paella.pluginManager.setTarget("videoOverlayButton",this)},onShowEditor:function(){var e=this.editControl();e&&$(e.domElement).hide()},onHideEditor:function(){var e=this.editControl();e&&$(e.domElement).show()},enterEditMode:function(){var e=this.playbackControl(),t=this.editControl();e&&t&&$(e.domElement).hide()},exitEditMode:function(){var e=this.playbackControl(),t=this.editControl();e&&t&&$(e.domElement).show()},playbackControl:function(){return null==this.playbackControlInstance&&(this.playbackControlInstance=this.getNode(this.playbackControlId)),this.playbackControlInstance},editControl:function(){return this.getNode(this.editControlId)},disable:function(){this.isEnabled=!1,this.hide()},enable:function(){this.isEnabled=!0,this.show()},isHidden:function(){return this._hidden},hide:function(){var e=this;function t(){e._doHide&&($(e.domElement).css({opacity:0}),$(e.domElement).hide(),e.domElement.setAttribute("aria-hidden","true"),e._hidden=!0,paella.events.trigger(paella.events.controlBarDidHide))}this._doHide=!0,paella.events.trigger(paella.events.controlBarWillHide),e._doHide&&(base.userAgent.browser.IsMobileVersion||base.userAgent.browser.Explorer?t():$(this.domElement).animate({opacity:0},{duration:300,complete:t}))},showPopUp:function(e){this.playbackControl().showPopUp(e)},hidePopUp:function(e){this.playbackControl().hidePopUp(e)},show:function(){this.isEnabled&&($(this.domElement).stop(),this._doHide=!1,this.domElement.style.opacity=1,this.domElement.setAttribute("aria-hidden","false"),this._hidden=!1,$(this.domElement).show(),paella.events.trigger(paella.events.controlBarDidShow))},autohideTimeout:function(){this.playbackControl().playbackBar().isSeeking()?paella.player.controls.restartHideTimer():paella.player.controls.hideControls()},hideControls:function(){var t=this;paella.player.videoContainer.paused().then(function(e){e?t.show():t.hide()})},showControls:function(){this.show()},onPlayEvent:function(){this.restartHideTimer()},onPauseEvent:function(){this.clearAutohideTimer()},onEndVideoEvent:function(){this.show(),this.clearAutohideTimer()},onKeyEvent:function(){this.restartHideTimer(),paella.player.videoContainer.paused().then(function(e){e||paella.player.controls.restartHideTimer()})},cancelHideBar:function(){this.restartTimerEvent()},restartTimerEvent:function(){var t=this;this.isHidden()&&this.showControls(),this._doHide=!1,paella.player.videoContainer.paused(function(e){e||t.restartHideTimer()})},clearAutohideTimer:function(){null!=this.autohideTimer&&(this.autohideTimer.cancel(),this.autohideTimer=null)},restartHideTimer:function(){this.showControls(),this.clearAutohideTimer();var t=this;this.autohideTimer=new base.Timer(function(e){t.autohideTimeout()},this.hideControlsTimeMillis)},onresize:function(){this.playbackControl().onresize()}}),Class("paella.LoaderContainer",paella.DomNode,{timer:null,loader:null,loaderPosition:0,initialize:function(e){this.parent("div",e,{position:"fixed",backgroundColor:"white",opacity:"0.7",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:1e4}),this.loader=this.addNode(new paella.DomNode("div","",{position:"fixed",width:"128px",height:"128px",top:"50%",left:"50%",marginLeft:"-64px",marginTop:"-64px",backgroundImage:"url("+paella.utils.folders.resources()+"/images/loader.png)"}));var n=this;paella.events.bind(paella.events.loadComplete,function(e,t){n.loadComplete(t)}),this.timer=new base.Timer(function(e){n.loaderPosition-=128,n.loader.domElement.style.backgroundPosition=n.loaderPosition+"px"},1e3),this.timer.repeat=!0},loadComplete:function(e){$(this.domElement).hide(),this.timer.repeat=!1}}),Class("paella.KeyManager",{isPlaying:!1,Keys:{Space:32,Left:37,Up:38,Right:39,Down:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},enabled:!0,initialize:function(){var n=this;paella.events.bind(paella.events.loadComplete,function(e,t){n.loadComplete(e,t)}),paella.events.bind(paella.events.play,function(e){n.onPlay()}),paella.events.bind(paella.events.pause,function(e){n.onPause()})},loadComplete:function(e,t){var n=this;paella.events.bind("keyup",function(e){n.keyUp(e)})},onPlay:function(){this.isPlaying=!0},onPause:function(){this.isPlaying=!1},keyUp:function(e){this.enabled&&(e.altKey&&e.ctrlKey?e.which==this.Keys.P?this.togglePlayPause():e.which==this.Keys.S?this.pause():e.which==this.Keys.M?this.mute():e.which==this.Keys.U?this.volumeUp():e.which==this.Keys.D&&this.volumeDown():e.which==this.Keys.Space?this.togglePlayPause():e.which==this.Keys.Up?this.volumeUp():e.which==this.Keys.Down?this.volumeDown():e.which==this.Keys.M&&this.mute())},togglePlayPause:function(){this.isPlaying?paella.player.pause():paella.player.play()},pause:function(){paella.player.pause()},mute:function(){paella.player.videoContainer.volume().then(function(e){var t=0;0==e&&(t=1),paella.player.videoContainer.setVolume({master:t,slave:0})})},volumeUp:function(){paella.player.videoContainer.volume().then(function(e){e=1<(e+=.1)?1:e,paella.player.videoContainer.setVolume({master:e,slave:0})})},volumeDown:function(){paella.player.videoContainer.volume().then(function(e){e=(e-=.1)<0?0:e,paella.player.videoContainer.setVolume({master:e,slave:0})})}}),paella.keyManager=new paella.KeyManager,Class("paella.VideoLoader",{metadata:{title:"",duration:0},streams:[],frameList:[],loadStatus:!1,codecStatus:!1,getMetadata:function(){return this.metadata},loadVideo:function(e,t){t()}}),Class("paella.AccessControl",{canRead:function(){return paella_DeferredResolved(!0)},canWrite:function(){return paella_DeferredResolved(!1)},userData:function(){return paella_DeferredResolved({username:"anonymous",name:"Anonymous",avatar:paella.utils.folders.resources()+"/images/default_avatar.png",isAnonymous:!0})},getAuthenticationUrl:function(e){var t=this._authParams.authCallbackName&&window[this._authParams.authCallbackName];return!t&&paella.player.config.auth&&(t=paella.player.config.auth.authCallbackName&&window[paella.player.config.auth.authCallbackName]),"function"==typeof t?t(e):""}}),Class("paella.PlayerBase",{config:null,playerId:"",mainContainer:null,videoContainer:null,controls:null,accessControl:null,checkCompatibility:function(){var e="";if(base.parameters.get("ignoreBrowserCheck"))return!0;if(base.userAgent.browser.IsMobileVersion)return!0;if(base.userAgent.browser.Chrome||base.userAgent.browser.Safari||base.userAgent.browser.Firefox||base.userAgent.browser.Opera||base.userAgent.browser.Edge||base.userAgent.browser.Explorer&&9<=base.userAgent.browser.Version.major)return!0;var t=base.dictionary.translate("It seems that your browser is not HTML 5 compatible");return paella.events.trigger(paella.events.error,{error:t}),e=t+'<div style="display:block;width:470px;height:140px;margin-left:auto;margin-right:auto;font-family:Verdana,sans-sherif;font-size:12px;"><a href="http://www.google.es/chrome" style="color:#004488;float:left;margin-right:20px;"><img src="'+paella.utils.folders.resources()+'images/chrome.png" style="width:80px;height:80px" alt="Google Chrome"></img><p>Google Chrome</p></a><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home" style="color:#004488;float:left;margin-right:20px;"><img src="'+paella.utils.folders.resources()+'images/explorer.png" style="width:80px;height:80px" alt="Internet Explorer 9"></img><p>Internet Explorer 9</p></a><a href="http://www.apple.com/safari/" style="float:left;margin-right:20px;color:#004488"><img src="'+paella.utils.folders.resources()+'images/safari.png" style="width:80px;height:80px" alt="Safari"></img><p>Safari 5</p></a><a href="http://www.mozilla.org/firefox/" style="float:left;color:#004488"><img src="'+paella.utils.folders.resources()+'images/firefox.png" style="width:80px;height:80px" alt="Firefox"></img><p>Firefox 12</p></a></div>',e+='<div style="margin-top:30px;"><a id="ignoreBrowserCheckLink" href="#" onclick="window.location = window.location + \'&ignoreBrowserCheck=true\'">'+base.dictionary.translate("Continue anyway")+"</a></div>",paella.messageBox.showError(e,{height:"40%"}),!1},initialize:function(e){if(null!=base.parameters.get("log")){var t=0;switch(base.parameters.get("log")){case"error":t=base.Log.kLevelError;break;case"warn":t=base.Log.kLevelWarning;break;case"debug":t=base.Log.kLevelDebug;break;case"log":case"true":t=base.Log.kLevelLog}base.log.setLevel(t)}if(this.checkCompatibility()){(paella.player=this).playerId=e,this.mainContainer=$("#"+this.playerId)[0];var n=this;paella.events.bind(paella.events.loadComplete,function(e,t){n.loadComplete(e,t)})}else base.log.debug("It seems that your browser is not HTML 5 compatible")},loadComplete:function(e,t){},auth:{login:function(e){e=e||window.location.href;var t=paella.initDelegate.initParams.accessControl.getAuthenticationUrl(e);t&&(window.location.href=t)},canRead:function(){return paella.initDelegate.initParams.accessControl.canRead()},canWrite:function(){return paella.initDelegate.initParams.accessControl.canWrite()},userData:function(){return paella.initDelegate.initParams.accessControl.userData()}}}),Class("paella.InitDelegate",{initParams:{configUrl:"config/config.json",dictionaryUrl:"localization/paella",accessControl:null,videoLoader:null},initialize:function(e){if(e)for(var t in e)this.initParams[t]=e[t]},getId:function(){return base.parameters.get("id")||"noid"},loadDictionary:function(){var e=this;return new Promise(function(a){base.ajax.get({url:e.initParams.dictionaryUrl+"_"+base.dictionary.currentLanguage()+".json"},function(e,t,n){base.dictionary.addDictionary(e),a(e)},function(e,t,n){a()})})},loadConfig:function(){var o=this;return new Promise(function(i,r){var e=o.initParams.configUrl,t={};t.url=e,base.ajax.get(t,function(e,t,n){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return void r()}base.dictionary.addDictionary(e);var a=Class.fromString(e.player.accessControlClass||"paella.AccessControl");o.initParams.accessControl=new a,i(e)},function(e,t,n){paella.messageBox.showError(base.dictionary.translate("Error! Config file not found. Please configure paella!"))})})}});var paellaPlayer=null;paella.plugins={},paella.plugins.events={},paella.initDelegate=null,Class("paella.PaellaPlayer",paella.PlayerBase,{player:null,videoIdentifier:"",loader:null,videoData:null,getPlayerMode:function(){return paella.player.isFullScreen()?paella.PaellaPlayer.mode.fullscreen:window.self!==window.top?paella.PaellaPlayer.mode.embed:paella.PaellaPlayer.mode.standard},checkFullScreenCapability:function(){var e=document.getElementById(paella.player.mainContainer.id);return!!(e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.requestFullScreen)||!(!base.userAgent.browser.IsMobileVersion||!paella.player.videoContainer.isMonostream)},addFullScreenListeners:function(){var t=this,e=function(){setTimeout(function(){paella.pluginManager.checkPluginsVisibility()},1e3);var e=document.getElementById(paella.player.mainContainer.id);paella.player.isFullScreen()?(e.style.width="100%",e.style.height="100%"):(e.style.width="",e.style.height=""),t.isFullScreen()?paella.events.trigger(paella.events.enterFullscreen):paella.events.trigger(paella.events.exitFullscreen)};this.eventFullScreenListenerAdded||(this.eventFullScreenListenerAdded=!0,document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),document.addEventListener("MSFullscreenChange",e,!1),document.addEventListener("webkitendfullscreen",e,!1))},isFullScreen:function(){var e=!0===document.webkitIsFullScreen,t=void 0!==document.msFullscreenElement&&null!==document.msFullscreenElement,n=!0===document.mozFullScreen,a=void 0!==document.fullScreenElement&&null!==document.fullScreenElement;return e||t||n||a},goFullScreen:function(){if(!this.isFullScreen())if(base.userAgent.system.iOS&&(paella.utils.userAgent.browser.Version.major<12||!paella.utils.userAgent.system.iPad))paella.player.videoContainer.masterVideo().goFullScreen();else{var e=document.getElementById(paella.player.mainContainer.id);e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.requestFullScreen&&e.requestFullScreen()}},exitFullScreen:function(){this.isFullScreen()&&(document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen()?document.msExitFullscreen():document.cancelFullScreen&&document.cancelFullScreen())},setProfile:function(t,e){this.videoContainer.setProfile(t,e).then(function(e){return paella.player.getProfile(e)}).then(function(e){paella.player.videoContainer.isMonostream||base.cookies.set("lastProfile",t),paella.events.trigger(paella.events.setProfile,{profileName:t})})},getProfile:function(e){return this.videoContainer.getProfile(e)},initialize:function(e){if(this.parent(e),this.playerId==e){this.loadPaellaPlayer()}Object.defineProperty(this,"selectedProfile",{get:function(){return this.videoContainer.getCurrentProfileName()}})},loadPaellaPlayer:function(){var n=this;this.loader=new paella.LoaderContainer("paellaPlayer_loader"),$("body")[0].appendChild(this.loader.domElement),paella.events.trigger(paella.events.loadStarted),paella.initDelegate.loadDictionary().then(function(){return paella.initDelegate.loadConfig()}).then(function(e){if(n.accessControl=paella.initDelegate.initParams.accessControl,n.onLoadConfig(e),e.skin){var t=e.skin.default||"dark";paella.utils.skin.restore(t)}})},onLoadConfig:function(e){if(paella.data=new paella.Data(e),this.config=e,this.videoIdentifier=paella.initDelegate.getId(),this.videoIdentifier){if(this.mainContainer){this.videoContainer=new paella.VideoContainer(this.playerId+"_videoContainer");var t=new paella.BestFitVideoQualityStrategy;try{var n=this.config.player.videoQualityStrategy;t=new(Class.fromString(n))}catch(e){base.log.warning("Error selecting video quality strategy: strategy not found")}this.videoContainer.setVideoQualityStrategy(t),this.mainContainer.appendChild(this.videoContainer.domElement)}$(window).resize(function(e){paella.player.onresize()}),this.onload()}paella.pluginManager.loadPlugins("paella.FastLoadPlugin")},onload:function(){var i=this,r=(this.accessControl,!1),o={};this.accessControl.canRead().then(function(e){return r=e,i.accessControl.userData()}).then(function(e){if(o=e,r)i.loadVideo(),i.videoContainer.publishVideo();else if(o.isAnonymous){var t=paella.initDelegate.initParams.accessControl.getAuthenticationUrl("player/?id="+paella.player.videoIdentifier),n="<div>"+base.dictionary.translate("You are not authorized to view this resource")+"</div>";t&&(n+='<div class="login-link"><a href="'+t+'">'+base.dictionary.translate("Login")+"</a></div>"),i.unloadAll(n)}else{var a=base.dictionary.translate("You are not authorized to view this resource");i.unloadAll(a),paella.events.trigger(paella.events.error,{error:a})}}).catch(function(e){var t=base.dictionary.translate(e);i.unloadAll(t),paella.events.trigger(paella.events.error,{error:t})})},onresize:function(){this.videoContainer.onresize(),this.controls&&this.controls.onresize();var e=paella.utils.cookies.get("lastProfile");e?this.setProfile(e,!1):this.setProfile(paella.Profiles.getDefaultProfile(),!1),paella.events.trigger(paella.events.resize,{width:$(this.videoContainer.domElement).width(),height:$(this.videoContainer.domElement).height()})},unloadAll:function(e){$("#paellaPlayer_loader")[0];this.mainContainer.innerText="",paella.messageBox.showError(e)},reloadVideos:function(e,t){this.videoContainer&&(this.videoContainer.reloadVideos(e,t),this.onresize())},loadVideo:function(){if(this.videoIdentifier){var e=this,t=paella.initDelegate.initParams.videoLoader;paella.player.videoLoader=t,this.onresize(),t.loadVideo(this.videoIdentifier,function(){e.videoContainer.setStreamData(t.streams).then(function(){paella.events.trigger(paella.events.loadComplete),e.addFullScreenListeners(),e.onresize(),e.videoContainer.autoplay()&&e.play()}).catch(function(e){console.log(e)})})}},showPlaybackBar:function(){this.controls||(this.controls=new paella.ControlsContainer(this.playerId+"_controls"),this.mainContainer.appendChild(this.controls.domElement),this.controls.onresize(),paella.events.trigger(paella.events.loadPlugins,{pluginManager:paella.pluginManager}))},isLiveStream:function(){if(void 0===this._isLiveStream){var e=paella.initDelegate.initParams.videoLoader,t=function(e,t){if(e.length>t){var n=e[t];for(var a in n.sources)if("object"==$traceurRuntime.typeof(n.sources[a]))for(var i=0;i<n.sources[a].length;++i){if(n.sources[a][i].isLiveStream)return!0}}return!1};this._isLiveStream=t(e.streams,0)||t(e.streams,1)}return this._isLiveStream},loadPreviews:function(){var e=paella.initDelegate.initParams.videoLoader.streams,t=null,n=e[0].preview;if(2<=e.length&&(t=e[1].preview),n){var a=paella.player.videoContainer.overlayContainer.getMasterRect();this.masterPreviewElem=document.createElement("img"),this.masterPreviewElem.src=n,paella.player.videoContainer.overlayContainer.addElement(this.masterPreviewElem,a)}if(t){var i=paella.player.videoContainer.overlayContainer.getSlaveRect();this.slavePreviewElem=document.createElement("img"),this.slavePreviewElem.src=t,paella.player.videoContainer.overlayContainer.addElement(this.slavePreviewElem,i)}paella.events.bind(paella.events.timeUpdate,function(e){paella.player.unloadPreviews()})},unloadPreviews:function(){this.masterPreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.masterPreviewElem),this.masterPreviewElem=null),this.slavePreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.slavePreviewElem),this.slavePreviewElem=null)},loadComplete:function(e,t){paella.pluginManager.loadPlugins("paella.EarlyLoadPlugin"),paella.player.videoContainer._autoplay&&this.play()},play:function(){if(!this.controls){this.showPlaybackBar();var e=base.parameters.get("time"),t=base.hashParams.get("time"),n=t||(e||"0s"),a=paella.utils.timeParse.timeToSeconds(n);a&&paella.player.videoContainer.setStartTime(a),paella.events.trigger(paella.events.controlBarLoaded),this.controls.onresize()}return this.videoContainer.play()},pause:function(){return this.videoContainer.pause()},playing:function(){var e=this;return new Promise(function(t){e.paused().then(function(e){t(!e)})})},paused:function(){return this.videoContainer.paused()}});var PaellaPlayer=paella.PaellaPlayer;function initPaellaEngage(e,t){t||(t=new paella.InitDelegate),paella.initDelegate=t;navigator.language||window.navigator.userLanguage;paellaPlayer=new PaellaPlayer(e,paella.initDelegate)}function DeprecatedClass(e,t,n){Class(e,n,{initialize:function(){base.log.warning(e+" is deprecated, use "+t+" instead."),this.parent.apply(this,arguments)}})}function DeprecatedFunc(e,t,n){return function(){base.log.warning(e+" is deprecated, use "+t+" instead."),n.apply(this,arguments)}}function buildChromaVideoCanvas(e,t){var n,a=new(n=bg.app.WindowController,$traceurRuntime.createClass(function e(t){$traceurRuntime.superConstructor(e).call(this),this.stream=t,this._chroma=bg.Color.White(),this._crop=new bg.Vector4(.3,.01,.3,.01),this._transform=bg.Matrix4.Identity().translate(.6,-.04,0),this._bias=.01},{get chroma(){return this._chroma},get bias(){return this._bias},get crop(){return this._crop},get transform(){return this._transform},set chroma(e){this._chroma=e},set bias(e){this._bias=e},set crop(e){this._crop=e},set transform(e){this._transform=e},get video(){return this.texture?this.texture.video:null},loaded:function(){var n=this;return new Promise(function(e){var t=function(){n.video?e(n):setTimeout(t,100)};t()})},buildShape:function(){this.plist=new bg.base.PolyList(this.gl),this.plist.vertex=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],this.plist.texCoord0=[0,0,1,0,1,1,0,1],this.plist.index=[0,1,2,2,3,0],this.plist.build()},buildShader:function(){this.shader=new bg.base.Shader(this.gl),this.shader.addShaderSource(bg.base.ShaderType.VERTEX,"\n\t\t\t\t\tattribute vec4 position;\n\t\t\t\t\tattribute vec2 texCoord;\n\t\t\t\t\tuniform mat4 inTransform;\n\t\t\t\t\tvarying vec2 vTexCoord;\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tgl_Position = inTransform * position;\n\t\t\t\t\t\tvTexCoord = texCoord;\n\t\t\t\t\t}\n\t\t\t\t"),this.shader.addShaderSource(bg.base.ShaderType.FRAGMENT,"\n\t\t\t\t\tprecision mediump float;\n\t\t\t\t\tvarying vec2 vTexCoord;\n\t\t\t\t\tuniform sampler2D inTexture;\n\t\t\t\t\tuniform vec4 inChroma;\n\t\t\t\t\tuniform float inBias;\n\t\t\t\t\tuniform vec4 inCrop;\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tvec4 result = texture2D(inTexture,vTexCoord);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif ((result.r>=inChroma.r-inBias && result.r<=inChroma.r+inBias &&\n\t\t\t\t\t\t\tresult.g>=inChroma.g-inBias && result.g<=inChroma.g+inBias &&\n\t\t\t\t\t\t\tresult.b>=inChroma.b-inBias && result.b<=inChroma.b+inBias) ||\n\t\t\t\t\t\t\t(vTexCoord.x<inCrop.x || vTexCoord.x>inCrop.z || vTexCoord.y<inCrop.w || vTexCoord.y>inCrop.y)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tgl_FragColor = result;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t"),status=this.shader.link(),this.shader.status||(console.log(this.shader.compileError),console.log(this.shader.linkError)),this.shader.initVars(["position","texCoord"],["inTransform","inTexture","inChroma","inBias","inCrop"])},init:function(){var t=this;bg.Engine.Set(new bg.webgl1.Engine(this.gl)),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),this.buildShape(),this.buildShader(),this.pipeline=new bg.base.Pipeline(this.gl),bg.base.Pipeline.SetCurrent(this.pipeline),this.pipeline.clearColor=bg.Color.Transparent(),bg.base.Loader.Load(this.gl,this.stream.src).then(function(e){t.texture=e})},frame:function(e){this.texture&&this.texture.update()},display:function(){this.pipeline.clearBuffers(bg.base.ClearBuffers.COLOR|bg.base.ClearBuffers.DEPTH),this.texture&&(this.shader.setActive(),this.shader.setInputBuffer("position",this.plist.vertexBuffer,3),this.shader.setInputBuffer("texCoord",this.plist.texCoord0Buffer,2),this.shader.setMatrix4("inTransform",this.transform),this.shader.setTexture("inTexture",this.texture||bg.base.TextureCache.WhiteTexture(this.gl),bg.base.TextureUnit.TEXTURE_0),this.shader.setVector4("inChroma",this.chroma),this.shader.setValueFloat("inBias",this.bias),this.shader.setVector4("inCrop",new bg.Vector4(this.crop.x,1-this.crop.y,1-this.crop.z,this.crop.w)),this.plist.draw(),this.shader.disableInputBuffer("position"),this.shader.disableInputBuffer("texCoord"),this.shader.clearActive())},reshape:function(e,t){var n=this.canvas.domElement;n.width=e,n.height=t,this.pipeline.viewport=new bg.Viewport(0,0,e,t)},mouseMove:function(e){this.postRedisplay()}},{},n))(e),i=bg.app.MainLoop.singleton;return i.updateMode=bg.app.FrameUpdate.AUTO,i.canvas=t,i.run(a),a.loaded()}paella.PaellaPlayer.mode={standard:"standard",fullscreen:"fullscreen",embed:"embed"},Class("paella.DefaultVideoLoader",paella.VideoLoader,{_url:null,initialize:function(t){if("object"==$traceurRuntime.typeof(t))this._data=t;else try{this._data=JSON.parse(t)}catch(e){this._url=t}},loadVideo:function(e,a){if(this._data)this.loadVideoData(this._data,a);else if(this._url){var i=this;this._url=(/\/$/.test(this._url)?this._url:this._url+"/")+e+"/",base.ajax.get({url:this._url+"data.json"},function(e,t,n){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}i._data=e,i.loadVideoData(i._data,a)},function(e,t,n){switch(n){case 401:paella.messageBox.showError(base.dictionary.translate("You are not logged in"));break;case 403:paella.messageBox.showError(base.dictionary.translate("You are not authorized to view this resource"));break;case 404:paella.messageBox.showError(base.dictionary.translate("The specified video identifier does not exist"));break;default:paella.messageBox.showError(base.dictionary.translate("Could not load the video"))}})}},loadVideoData:function(e,t){var n=this;e.metadata&&(this.metadata=e.metadata),e.streams&&e.streams.forEach(function(e){n.loadStream(e)}),e.frameList&&this.loadFrameData(e),e.captions&&this.loadCaptions(e.captions),e.blackboard&&this.loadBlackboard(e.streams[0],e.blackboard),this.streams=e.streams,this.frameList=e.frameList,this.loadStatus=0<this.streams.length,t()},loadFrameData:function(e){var n=this;if(e.frameList&&e.frameList.forEach){var a={};e.frameList.forEach(function(e){/^[a-zA-Z]+:\/\//.test(e.url)||/^data:/.test(e.url)||(e.url=n._url+e.url),!e.thumb||/^[a-zA-Z]+:\/\//.test(e.thumb)||/^data:/.test(e.thumb)||(e.thumb=n._url+e.thumb);var t=e.time;a[t]=e}),e.frameList=a}},loadStream:function(e){var a=this;for(var t in!e.preview||/^[a-zA-Z]+:\/\//.test(e.preview)||/^data:/.test(e.preview)||(e.preview=a._url+e.preview),e.sources.image&&e.sources.image.forEach(function(e){if(e.frames.forEach){var n={};e.frames.forEach(function(e){!e.src||/^[a-zA-Z]+:\/\//.test(e.src)||/^data:/.test(e.src)||(e.src=a._url+e.src),!e.thumb||/^[a-zA-Z]+:\/\//.test(e.thumb)||/^data:/.test(e.thumb)||(e.thumb=a._url+e.thumb);var t="frame_"+e.time;n[t]=e.src}),e.frames=n}}),e.sources){if(e.sources[t]){if("image"!=t)e.sources[t].forEach(function(e){"string"==typeof e.src&&null==e.src.match(/^[a-zA-Z\:]+\:\/\//gi)&&(e.src=a._url+e.src),e.type=e.mimetype})}else delete e.sources[t]}},loadCaptions:function(e){if(e)for(var t=0;t<e.length;++t){var n=e[t].url;/^[a-zA-Z]+:\/\//.test(n)||(n=this._url+n);var a=new paella.captions.Caption(t,e[t].format,n,{code:e[t].lang,txt:e[t].text});paella.captions.addCaptions(a)}},loadBlackboard:function(e,t){var n=this;e.sources.image||(e.sources.image=[]);var a={count:t.frames.length,duration:t.duration,mimetype:t.mimetype,res:t.res,frames:{}};t.frames.forEach(function(e){var t="frame_"+Math.round(e.time);/^[a-zA-Z]+:\/\//.test(e.src)||(e.src=n._url+e.src),a.frames[t]=e.src}),e.sources.image.push(a)}}),Class("paella.DefaultInitDelegate",paella.InitDelegate,{initialize:function(e,t){1==arguments.length?this.parent(e):2==arguments.length&&(this._config=e,this.parent(t))},loadConfig:function(){var n=this;return this._config?new Promise(function(e){base.dictionary.addDictionary(n._config);var t=Class.fromString(n._config.player.accessControlClass||"paella.AccessControl");n.initParams.accessControl=new t,e(n._config)}):this.parent()}}),paella.load=function(e,t){var n;t&&t.auth;if(n=paella.utils.parameters.get("video")){var a=paella.utils.parameters.get("videoSlave");a=a&&decodeURIComponent(a);var i=paella.utils.parameters.get("preview");i=i&&decodeURIComponent(i);var r=paella.utils.parameters.get("previewSlave");r=r&&decodeURIComponent(r);var o={metadata:{title:paella.utils.parameters.get("preview")||"Untitled Video"},streams:[{sources:{mp4:[{src:decodeURIComponent(n),mimetype:"video/mp4",res:{w:0,h:0}}]},preview:i}]};a&&o.streams.push({sources:{mp4:[{src:a,mimetype:"video/mp4",res:{w:0,h:0}}]},preview:r}),t.data=o}var l={videoLoader:new paella.DefaultVideoLoader(t.data||t.url)};t.configUrl&&(l.configUrl=t.configUrl),t.config?paella.initDelegate=new paella.DefaultInitDelegate(t.config,l):paella.initDelegate=new paella.DefaultInitDelegate(l),new PaellaPlayer(e,paella.initDelegate)},Class("paella.RightBarPlugin",paella.DeferredLoadPlugin,{type:"rightBarPlugin",getName:function(){return"es.upv.paella.RightBarPlugin"},buildContent:function(e){}}),Class("paella.TabBarPlugin",paella.DeferredLoadPlugin,{type:"tabBarPlugin",getName:function(){return"es.upv.paella.TabBarPlugin"},getTabName:function(){return"New Tab"},action:function(e){},buildContent:function(e){},setToolTip:function(e){this.button.setAttribute("title",e),this.button.setAttribute("aria-label",e)},getDefaultToolTip:function(){return""}}),Class("paella.ExtendedAdapter",{rightContainer:null,bottomContainer:null,rightBarPlugins:[],tabBarPlugins:[],currentTabIndex:0,bottomContainerTabs:null,bottomContainerContent:null,initialize:function(){this.rightContainer=document.createElement("div"),this.rightContainer.className="rightPluginContainer",this.bottomContainer=document.createElement("div"),this.bottomContainer.className="tabsPluginContainer";var e=document.createElement("div");e.className="tabsLabelContainer",this.bottomContainerTabs=e,this.bottomContainer.appendChild(e);var t=document.createElement("div");t.className="tabsContentContainer",this.bottomContainerContent=t,this.bottomContainer.appendChild(t),this.initPlugins()},initPlugins:function(){paella.pluginManager.setTarget("rightBarPlugin",this),paella.pluginManager.setTarget("tabBarPlugin",this)},addPlugin:function(t){var n=this;t.checkEnabled(function(e){e&&(paella.pluginManager.setupPlugin(t),"rightBarPlugin"==t.type&&(n.rightBarPlugins.push(t),n.addRightBarPlugin(t)),"tabBarPlugin"==t.type&&(n.tabBarPlugins.push(t),n.addTabPlugin(t)))})},showTab:function(e){var t=0,n=this.bottomContainer.getElementsByClassName("tabLabel"),a=this.bottomContainer.getElementsByClassName("tabContent");for(t=0;t<n.length;++t)n[t].getAttribute("tab")==e?n[t].className="tabLabel enabled":n[t].className="tabLabel disabled";for(t=0;t<a.length;++t)a[t].getAttribute("tab")==e?a[t].className="tabContent enabled":a[t].className="tabContent disabled"},addTabPlugin:function(e){var t=this,n=this.currentTabIndex,a=document.createElement("div");a.setAttribute("tab",n),a.className="tabLabel disabled",a.innerText=e.getTabName(),a.plugin=e,$(a).click(function(e){/disabled/.test(this.className)&&(t.showTab(n),this.plugin.action(this))}),$(a).keyup(function(e){13==e.keyCode&&/disabledTabItem/.test(this.className)&&(t.showTab(n),this.plugin.action(this))}),this.bottomContainerTabs.appendChild(a);var i=document.createElement("div");i.setAttribute("tab",n),i.className="tabContent disabled "+e.getSubclass(),this.bottomContainerContent.appendChild(i),e.buildContent(i),e.button=a,e.container=i,e.button.setAttribute("tabindex",3e3+e.getIndex()),e.button.setAttribute("alt",""),e.setToolTip(e.getDefaultToolTip()),void 0===this.firstTabShown&&(this.showTab(n),this.firstTabShown=!0),++this.currentTabIndex},addRightBarPlugin:function(e){var t=document.createElement("div");t.className="rightBarPluginContainer "+e.getSubclass(),this.rightContainer.appendChild(t),e.buildContent(t)}}),paella.extendedAdapter=new paella.ExtendedAdapter,Class("paella.editor.EmbedPlayer",base.AsyncLoaderCallback,{editar:null,initialize:function(){this.editor=paella.editor.instance},load:function(t,e){var n=this.editor.bottomBar.getHeight()+20,a=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:n+"px",right:a+"px",left:"20px",top:"20px"}),paella.player.mainContainer.className="paellaMainContainerEditorMode",new Timer(function(e){paella.player.controls.disable(),paella.player.onresize(),t&&t()},500)},restorePlayer:function(){$("body")[0].appendChild(paella.player.mainContainer),paella.player.controls.enable(),paella.player.mainContainer.className="",$(paella.player.mainContainer).css({position:"",width:"",bottom:"",left:"",right:"",top:""}),paella.player.onresize()},onresize:function(){var e=this.editor.bottomBar.getHeight()+20,t=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:e+"px",right:t+"px",left:"20px",top:"20px"})}}),DeprecatedClass("paella.Dictionary","base.Dictionary",base.Dictionary),paella.dictionary=base.dictionary,DeprecatedClass("paella.AsyncLoaderCallback","base.AsyncLoaderCallback",base.AsyncLoaderCallback),DeprecatedClass("paella.AjaxCallback","base.AjaxCallback",base.AjaxCallback),DeprecatedClass("paella.JSONCallback","base.JSONCallback",base.JSONCallback),DeprecatedClass("paella.DictionaryCallback","base.DictionaryCallback",base.DictionaryCallback),DeprecatedClass("paella.AsyncLoader","base.AsyncLoader",base.AsyncLoader),DeprecatedClass("paella.Timer","base.Timer",base.Timer),DeprecatedClass("paella.utils.Timer","base.Timer",base.Timer),paella.ajax={},paella.ajax.send=DeprecatedFunc("paella.ajax.send","base.ajax.send",base.ajax.send),paella.ajax.get=DeprecatedFunc("paella.ajax.get","base.ajax.get",base.ajax.get),paella.ajax.put=DeprecatedFunc("paella.ajax.put","base.ajax.put",base.ajax.put),paella.ajax.post=DeprecatedFunc("paella.ajax.post","base.ajax.post",base.ajax.post),paella.ajax.delete=DeprecatedFunc("paella.ajax.delete","base.ajax.delete",base.ajax.send),paella.ui={},paella.ui.Container=function(e){var t=document.createElement("div");return e.id&&(t.id=e.id),e.className&&(t.className=e.className),e.style&&$(t).css(e.style),t},paella.utils.ajax=base.ajax,paella.utils.cookies=base.cookies,paella.utils.parameters=base.parameters,paella.utils.require=base.require,paella.utils.importStylesheet=base.importStylesheet,paella.utils.language=base.dictionary.currentLanguage,paella.utils.uuid=base.uuid,paella.utils.userAgent=base.userAgent,paella.debug={log:function(e){base.log.warning("paella.debug.log is deprecated, use base.debug.[error/warning/debug/log] instead."),base.log.log(e)}},Class("paella.plugins.FlexSkipPlugin",paella.ButtonPlugin,{getAlignment:function(){return"left"},getName:function(){return"edu.harvard.dce.paella.flexSkipPlugin"},getIndex:function(){return 121},getSubclass:function(){return"flexSkip_Rewind_10"},formatMessage:function(){return"Rewind 10 seconds"},getDefaultToolTip:function(){return base.dictionary.translate(this.formatMessage())},getMinWindowSize:function(){return 510},checkEnabled:function(e){e(!paella.player.isLiveStream())},action:function(e){paella.player.videoContainer.currentTime().then(function(e){paella.player.videoContainer.seekToTime(e-10)})}}),paella.plugins.flexSkipPlugin=new paella.plugins.FlexSkipPlugin,Class("paella.plugins.FlexSkipForwardPlugin",paella.plugins.FlexSkipPlugin,{getIndex:function(){return 122},getName:function(){return"edu.harvard.dce.paella.flexSkipForwardPlugin"},getSubclass:function(){return"flexSkip_Forward_30"},formatMessage:function(){return"Forward 30 seconds"},action:function(e){paella.player.videoContainer.currentTime().then(function(e){paella.player.videoContainer.seekToTime(e+30)})}}),paella.plugins.flexSkipForwardPlugin=new paella.plugins.FlexSkipForwardPlugin,Class("paella.captions.parsers.WebVTTParserPlugin",paella.CaptionParserPlugIn,{ext:["vtt"],getName:function(){return"es.teltek.paella.captions.WebVTTParserPlugin"},parse:function(e,t,n){for(var a,i=[],r=e.split("\n"),o=0,l=!1,s=0;s<r.length;++s){var u=r[s].trim();/^WEBVTT/.test(u)&&void 0===a||0===u.length||(/^[0-9]+$/.test(u)||/^[0-9]+ -/.test(u))&&0===r[s-1].trim().length||(/^NOTE/.test(u)||/^STYLE/.test(u)?l=!0:/^(([0-9]{2}:)?[0-9]{2}:[0-9]{2}.[0-9]{3} --> ([0-9]{2}:)?[0-9]{2}:[0-9]{2}.[0-9]{3})/.test(u)?(l=!1,null!=a&&(i.push(a),o++),a={id:o,begin:this.parseTimeTextToSeg(u.split("--\x3e")[0]),end:this.parseTimeTextToSeg(u.split("--\x3e")[1])}):void 0===a||l||(u=(u=u.replace(/^- /,"")).replace(/<[^>]*>/g,""),void 0===a.content?a.content=u:a.content+="<p></p>"+u))}i.push(a),0<i.length?n(!1,i):n(!0)},parseTimeTextToSeg:function(e){for(var t=0,n=1,a=(e=/(([0-9]{2}:)?[0-9]{2}:[0-9]{2}.[0-9]{3})/.exec(e))[0].split(":"),i=a.length-1;0<=i;i--)n=Math.pow(60,a.length-1-i),t+=a[i]*n;return t}}),new paella.captions.parsers.WebVTTParserPlugin,paella.plugins.TrimmingTrackPlugin=Class.create(paella.editor.MainTrackPlugin,{trimmingTrack:null,trimmingData:{s:0,e:0},getTrackItems:function(){null==this.trimmingTrack&&(this.trimmingTrack={id:1,s:0,e:0},this.trimmingTrack.s=paella.player.videoContainer.trimStart(),this.trimmingTrack.e=paella.player.videoContainer.trimEnd(),this.trimmingData.s=this.trimmingTrack.s,this.trimmingData.e=this.trimmingTrack.e);var e=[];return e.push(this.trimmingTrack),e},getName:function(){return"es.upv.paella.editor.trimmingTrackPlugin"},getTools:function(){if(this.config.enableResetButton)return[{name:"reset",label:base.dictionary.translate("Reset"),hint:base.dictionary.translate("Resets the trimming bar to the default length of the video.")}]},onToolSelected:function(e){if(this.config.enableResetButton&&"reset"==e)return this.trimmingTrack={id:1,s:0,e:0},this.trimmingTrack.s=0,this.trimmingTrack.e=paella.player.videoContainer.duration(!0),!0},getTrackName:function(){return base.dictionary.translate("Trimming")},getColor:function(){return"rgb(0, 51, 107)"},onSave:function(n){paella.player.videoContainer.enableTrimming(),paella.player.videoContainer.setTrimmingStart(this.trimmingTrack.s),paella.player.videoContainer.setTrimmingEnd(this.trimmingTrack.e),this.trimmingData.s=this.trimmingTrack.s,this.trimmingData.e=this.trimmingTrack.e,paella.data.write("trimming",{id:paella.initDelegate.getId()},{start:this.trimmingTrack.s,end:this.trimmingTrack.e},function(e,t){n(t)})},onDiscard:function(e){this.trimmingTrack.s=this.trimmingData.s,this.trimmingTrack.e=this.trimmingData.e,e(!0)},allowDrag:function(){return!1},onTrackChanged:function(e,t,n){playerEnd=paella.player.videoContainer.duration(!0),t=t<0?0:t,n=n>playerEnd?playerEnd:n,this.trimmingTrack.s=t,this.trimmingTrack.e=n,this.parent(e,t,n)},contextHelpString:function(){return"es"==base.dictionary.currentLanguage()?'Utiliza la herramienta de recorte para definir el instante inicial y el instante final de la clase. Para cambiar la duración solo hay que arrastrar el inicio o el final de la pista "Recorte", en la linea de tiempo.':"Use this tool to define the start and finish time."}}),paella.plugins.trimmingTrackPlugin=new paella.plugins.TrimmingTrackPlugin,Class("paella.plugins.TrimmingLoaderPlugin",paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.trimmingPlayerPlugin"},getEvents:function(){return[paella.events.controlBarLoaded,paella.events.showEditor,paella.events.hideEditor]},onEvent:function(e,t){switch(e){case paella.events.controlBarLoaded:this.loadTrimming();break;case paella.events.showEditor:paella.player.videoContainer.disableTrimming();break;case paella.events.hideEditor:paella.player.config.trimming&&paella.player.config.trimming.enabled&&paella.player.videoContainer.enableTrimming()}},loadTrimming:function(){var e=paella.initDelegate.getId();paella.data.read("trimming",{id:e},function(e,t){if(e&&t&&0<e.end)paella.player.videoContainer.setTrimming(e.start,e.end).then(function(){return paella.player.videoContainer.enableTrimming()});else{var n=base.parameters.get("start"),a=base.parameters.get("end");n&&a&&paella.player.videoContainer.setTrimming(n,a).then(function(){return paella.player.videoContainer.enableTrimming()})}})}}),paella.plugins.trimmingLoaderPlugin=new paella.plugins.TrimmingLoaderPlugin,Class("paella.plugins.AirPlayPlugin",paella.ButtonPlugin,{_visible:!1,getIndex:function(){return 552},getAlignment:function(){return"right"},getSubclass:function(){return"AirPlayButton"},getName:function(){return"es.upv.paella.airPlayPlugin"},checkEnabled:function(e){e(window.WebKitPlaybackTargetAvailabilityEvent)},getDefaultToolTip:function(){return base.dictionary.translate("Emit to AirPlay.")},setup:function(){var t=this,e=paella.player.videoContainer.masterVideo().video;window.WebKitPlaybackTargetAvailabilityEvent&&e.addEventListener("webkitplaybacktargetavailabilitychanged",function(e){switch(e.availability){case"available":t._visible=!0;break;case"not-available":t._visible=!1}t.updateClassName()})},action:function(e){paella.player.videoContainer.masterVideo().video.webkitShowPlaybackTargetPicker()},updateClassName:function(){this.button.className=this.getButtonItemClass(!0)},getButtonItemClass:function(e){return"buttonPlugin "+this.getSubclass()+" "+this.getAlignment()+" "+(this._visible?"available":"not-available")}}),paella.plugins.airPlayPlugin=new paella.plugins.AirPlayPlugin,Class("paella.plugins.ArrowSlidesNavigator",paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.arrowSlidesNavigatorPlugin"},checkEnabled:function(e){!paella.initDelegate.initParams.videoLoader.frameList||0==Object.keys(paella.initDelegate.initParams.videoLoader.frameList).length&&paella.player.videoContainer.isMonostream?e(!1):e(!0)},setup:function(){var t=this;this._showArrowsIn=this.config.showArrowsIn||"slave",this.createOverlay(),t._frames=[];var n=paella.initDelegate.initParams.videoLoader.frameList;if(n){var e=Object.keys(n);e.length,e.map(function(e){return Number(e,10)}).sort(function(e,t){return e-t}).forEach(function(e){t._frames.push(n[e])})}},createOverlay:function(){var t=this,e=null;if(!this.arrows){this.arrows=document.createElement("div"),this.arrows.className="arrow-slide-navigator-container",this.arrows.style.marginTop="25%";var n=document.createElement("div");n.className="buttonPlugin arrowSlideNavidator nextButton right",this.arrows.appendChild(n);var a=document.createElement("div");a.className="buttonPlugin arrowSlideNavidator prevButton left",this.arrows.appendChild(a),$(n).click(function(e){t.goNextSlide(),e.stopPropagation()}),$(a).click(function(e){t.goPrevSlide(),e.stopPropagation()})}switch(t._showArrowsIn){case"full":var i=paella.player.videoContainer.overlayContainer;this.container&&i.removeElement(this.container),this.container=i.addLayer(),this.container.style.marginRight="0",this.container.style.marginLeft="0",this.arrows.style.marginTop="25%",this.container.appendChild(this.arrows);break;case"master":if(!(e=paella.player.videoContainer.masterVideo()&&paella.player.videoContainer.masterVideo().parent&&paella.player.videoContainer.masterVideo().parent.domElement))return;this.arrows&&e.removeElement(this.arrows),e.appendChild(arrows),this.arrows.style.marginTop="23%";break;case"slave":if(!(e=paella.player.videoContainer.slaveVideo()&&paella.player.videoContainer.slaveVideo().parent&&paella.player.videoContainer.slaveVideo().parent.domElement))return;e.appendChild(this.arrows),this.arrows.style.marginTop="35%"}this.hideArrows()},getCurrentRange:function(){var p=this;return new Promise(function(c){if(p._frames.length<1)c(null);else{var d=null;paella.player.videoContainer.duration().then(function(e){return e,paella.player.videoContainer.trimming()}).then(function(e){return d=e,paella.player.videoContainer.currentTime()}).then(function(u){if(!p._frames.some(function(e,t,n){if(t+1!=n.length){var a=0==t?e:p._frames[t-1],i=p._frames[t+1],r=d.enabled?a.time-d.start:a.time,o=d.enabled?e.time-d.start:e.time,l=d.enabled?i.time-d.start:i.time;if(o<u&&u<l){var s={prev:r,next:l};return r<0&&(s.prev=0<o?o:0),c(s),!0}}})){var e=p._frames[p._frames.length-2].time,t=p._frames[p._frames.length-1].time;c({prev:d.enabled?e-d.start:e,next:d.enabled?t-d.start:t})}})}})},goNextSlide:function(){this.getCurrentRange().then(function(e){console.log(e),paella.player.videoContainer.seekToTime(e.next)})},goPrevSlide:function(){this.getCurrentRange().then(function(e){console.log(e),paella.player.videoContainer.seekToTime(e.prev-1)})},showArrows:function(){$(this.arrows).show()},hideArrows:function(){$(this.arrows).hide()},getEvents:function(){return[paella.events.controlBarDidShow,paella.events.controlBarDidHide,paella.events.setComposition]},onEvent:function(e,t){switch(e){case paella.events.controlBarDidShow:this.showArrows();break;case paella.events.controlBarDidHide:this.hideArrows()}}}),paella.plugins.arrowSlidesNavigator=new paella.plugins.ArrowSlidesNavigator,function(){var e,t=(e=paella.ButtonPlugin,$traceurRuntime.createClass(function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)},{getAlignment:function(){return"right"},getSubclass:function(){return"audioLanguages"},getIndex:function(){return 2040},getMinWindowSize:function(){return 400},getName:function(){return"es.upv.paella.audioLanguage"},getDefaultToolTip:function(){return base.dictionary.translate("Set audio language")},closeOnMouseOut:function(){return!0},checkEnabled:function(t){var n=this;paella.player.videoContainer.getAudioLanguages().then(function(e){n._languages=e,t(1<e.length)})},setup:function(){var e=this;this.setLanguageLabel(),paella.events.bind(paella.events.audioLanguageChanged,function(){e.setLanguageLabel()})},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(t){var n=this;this._languages.forEach(function(e){t.appendChild(n.getItemButton(e))})},getItemButton:function(e){var t=document.createElement("div"),n=paella.player.videoContainer.mainAudioPlayer().stream.language,a=paella.dictionary.translate(e);return t.className=this.getButtonItemClass(a,e==n),t.id="laguageSelectorItem_"+e,t.innerText=a,t.data=e,$(t).click(function(e){$(".videoAudioTrackItem").removeClass("selected"),$(".videoAudioTrackItem."+this.data).addClass("selected"),paella.player.videoContainer.setAudioLanguage(this.data)}),t},setQualityLabel:function(){var t=this;paella.player.videoContainer.getCurrentQuality().then(function(e){t.setText(e.shortLabel())})},getButtonItemClass:function(e,t){return"videoAudioTrackItem "+e+(t?" selected":"")},setLanguageLabel:function(){this.setText(paella.player.videoContainer.audioLanguage)}},{},e));paella.plugins.audioLanguage=new t}(),Class("paella.BlackBoard2",paella.EventDrivenPlugin,{_blackBoardProfile:"s_p_blackboard2",_blackBoardDIV:null,_hasImages:null,_active:!1,_creationTimer:500,_zImages:null,_videoLength:null,_keys:null,_currentImage:null,_next:null,_prev:null,_lensDIV:null,_lensContainer:null,_lensWidth:null,_lensHeight:null,_conImg:null,_zoom:250,_currentZoom:null,_maxZoom:500,_mousePos:null,_containerRect:null,getName:function(){return"es.upv.paella.blackBoardPlugin"},getIndex:function(){return 10},getAlignment:function(){return"right"},getSubclass:function(){return"blackBoardButton2"},getDefaultToolTip:function(){return base.dictionary.translate("BlackBoard")},checkEnabled:function(e){e(!0)},getEvents:function(){return[paella.events.setProfile,paella.events.timeUpdate]},onEvent:function(t,n){var a=this;switch(t){case paella.events.setProfile:if(n.profileName!=a._blackBoardProfile){a._active&&(a.destroyOverlay(),a._active=!1);break}a._hasImages||paella.player.setProfile("slide_professor"),a._hasImages&&!a._active&&(a.createOverlay(),a._active=!0);break;case paella.events.timeUpdate:a._active&&a._hasImages&&paella.player.videoContainer.trimming().then(function(e){e.enabled&&(n.currentTime+=e.start),a.imageUpdate(t,n)})}},setup:function(){var t=this;if(paella.player.videoContainer.sourceData[0].sources.hasOwnProperty("image"))t._hasImages=!0,t._zImages={},t._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,t._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,t._keys=Object.keys(t._zImages),t._keys=t._keys.sort(function(e,t){return e=e.slice(6),t=t.slice(6),parseInt(e)-parseInt(t)});else if(t._hasImages=!1,paella.player.selectedProfile==t._blackBoardProfile){var e=paella.player.config.defaultProfile;paella.player.setProfile(e)}this._next=0,this._prev=0,paella.player.selectedProfile==t._blackBoardProfile&&(t.createOverlay(),t._active=!0),t._mousePos={},paella.Profiles.loadProfile(t._blackBoardProfile,function(e){t._containerRect=e.blackBoardImages})},createLens:function(){var u=this;null==u._currentZoom&&(u._currentZoom=u._zoom);var e=document.createElement("div");e.className="lensClass",u._lensDIV=e;var c=$(".conImg").offset(),d=$(".conImg").width(),p=$(".conImg").height();e.style.width=d/(u._currentZoom/100)+"px",e.style.height=p/(u._currentZoom/100)+"px",u._lensWidth=parseInt(e.style.width),u._lensHeight=parseInt(e.style.height),$(u._lensContainer).append(e),$(u._lensContainer).mousemove(function(e){var t=e.pageX-c.left,n=e.pageY-c.top;u._mousePos.x=t;var a=(u._mousePos.y=n)-u._lensHeight/2;a=(a=a<0?0:a)>p-u._lensHeight?p-u._lensHeight:a;var i=t-u._lensWidth/2;if(i=(i=i<0?0:i)>d-u._lensWidth?d-u._lensWidth:i,u._lensDIV.style.left=i+"px",u._lensDIV.style.top=a+"px",100!=u._currentZoom){var r=100*i/(d-u._lensWidth),o=100*a/(p-u._lensHeight);u._blackBoardDIV.style.backgroundPosition=r.toString()+"% "+o.toString()+"%"}else if(100==u._currentZoom){var l=100*t/d,s=100*n/p;u._blackBoardDIV.style.backgroundPosition=l.toString()+"% "+s.toString()+"%"}u._blackBoardDIV.style.backgroundSize=u._currentZoom+"%"}),$(u._lensContainer).bind("wheel mousewheel",function(e){0<(void 0!==e.originalEvent.wheelDelta?e.originalEvent.wheelDelta:-1*e.originalEvent.deltaY)&&u._currentZoom<u._maxZoom?u.reBuildLens(10):100<u._currentZoom?u.reBuildLens(-10):100==u._currentZoom&&(u._lensDIV.style.left="0px",u._lensDIV.style.top="0px"),u._blackBoardDIV.style.backgroundSize=u._currentZoom+"%"})},reBuildLens:function(e){var t=this;t._currentZoom+=e;$(".conImg").offset();var n=$(".conImg").width(),a=$(".conImg").height();if(t._lensDIV.style.width=n/(t._currentZoom/100)+"px",t._lensDIV.style.height=a/(t._currentZoom/100)+"px",t._lensWidth=parseInt(t._lensDIV.style.width),t._lensHeight=parseInt(t._lensDIV.style.height),100!=t._currentZoom){var i=t._mousePos.x,r=t._mousePos.y-t._lensHeight/2;r=(r=r<0?0:r)>a-t._lensHeight?a-t._lensHeight:r;var o=i-t._lensWidth/2;o=(o=o<0?0:o)>n-t._lensWidth?n-t._lensWidth:o,t._lensDIV.style.left=o+"px",t._lensDIV.style.top=r+"px";var l=100*o/(n-t._lensWidth),s=100*r/(a-t._lensHeight);t._blackBoardDIV.style.backgroundPosition=l.toString()+"% "+s.toString()+"%"}},destroyLens:function(){this._lensDIV&&($(this._lensDIV).remove(),this._blackBoardDIV.style.backgroundSize="100%",this._blackBoardDIV.style.opacity=0)},createOverlay:function(){var t=this,n=document.createElement("div");n.className="blackBoardDiv",t._blackBoardDIV=n,t._blackBoardDIV.style.opacity=0;var a=document.createElement("div");a.className="lensContainer",t._lensContainer=a;var e=document.createElement("img");e.className="conImg",t._conImg=e,t._currentImage&&(t._conImg.src=t._currentImage,$(t._blackBoardDIV).css("background-image","url("+t._currentImage+")")),$(a).append(e),$(t._lensContainer).mouseenter(function(){t.createLens(),t._blackBoardDIV.style.opacity=1}),$(t._lensContainer).mouseleave(function(){t.destroyLens()}),setTimeout(function(){var e=paella.player.videoContainer.overlayContainer;e.addElement(n,e.getMasterRect()),e.addElement(a,t._containerRect)},t._creationTimer)},destroyOverlay:function(){this._blackBoardDIV&&$(this._blackBoardDIV).remove(),this._lensContainer&&$(this._lensContainer).remove()},imageUpdate:function(e,t){var n=this,a=Math.round(t.currentTime),i=$(n._blackBoardDIV).css("background-image");if(0<$(n._blackBoardDIV).length){if(n._zImages.hasOwnProperty("frame_"+a)){if(i==n._zImages["frame_"+a])return;i=n._zImages["frame_"+a]}else{if(!(a>n._next||a<n._prev))return;i=n.returnSrc(a)}var r=new Image;r.onload=function(){$(n._blackBoardDIV).css("background-image","url("+i+")")},r.src=i,n._currentImage=i,n._conImg.src=n._currentImage}},returnSrc:function(e){for(var t=0,n=0;n<this._keys.length;n++){var a=parseInt(this._keys[n].slice(6)),i=parseInt(this._keys[this._keys.length-1].slice(6));if(e<a)return this._next=a,this._prev=t,this._imageNumber=n-1,this._zImages["frame_"+t];if(i<e&&e<this._videoLength)return this._next=this._videoLength,this._prev=i,this._zImages["frame_"+t];t=a}}}),paella.plugins.blackBoard2=new paella.BlackBoard2,Class("paella.plugins.BreaksPlayerPlugin",paella.EventDrivenPlugin,{breaks:null,lastEvent:0,visibleBreaks:null,getName:function(){return"es.upv.paella.breaksPlayerPlugin"},checkEnabled:function(n){var a=this;this.breaks=[],this.visibleBreaks=[],paella.data.read("breaks",{id:paella.initDelegate.getId()},function(e,t){e&&"object"==$traceurRuntime.typeof(e)&&e.breaks&&0<e.breaks.length&&(a.breaks=e.breaks),n(!0)})},getEvents:function(){return[paella.events.timeUpdate]},onEvent:function(e,t){var n=this;t.videoContainer.currentTime(!0).then(function(e){n.checkBreaks(e)})},checkBreaks:function(e){for(var t,n=0;n<this.breaks.length;++n)(t=this.breaks[n]).s<e&&t.e>e?this.areBreaksClickable()?this.avoidBreak(t):this.showBreaks(t):t.s.toFixed(0)==e.toFixed(0)&&this.avoidBreak(t);if(!this.areBreaksClickable())for(var a in this.visibleBreaks)"object"==$traceurRuntime.typeof(t)&&(t=this.visibleBreaks[a])&&(t.s>=e||t.e<=e)&&this.removeBreak(t)},areBreaksClickable:function(){return this.config.neverShow&&!(paella.editor.instance&&paella.editor.instance.isLoaded)},showBreaks:function(e){if(!this.visibleBreaks[e.s]){var t=e.name||paella.dictionary.translate("Break");e.elem=paella.player.videoContainer.overlayContainer.addText(t,{left:100,top:350,width:1080,height:40}),e.elem.className="textBreak",this.visibleBreaks[e.s]=e}},removeBreak:function(e){if(this.visibleBreaks[e.s]){var t=this.visibleBreaks[e.s].elem;paella.player.videoContainer.overlayContainer.removeElement(t),this.visibleBreaks[e.s]=null}},avoidBreak:function(e){var t=e.e+(this.config.neverShow?.01:0)-paella.player.videoContainer.trimStart();paella.player.videoContainer.seekToTime(t)}}),paella.plugins.breaksPlayerPlugin=new paella.plugins.BreaksPlayerPlugin,Class("paella.captions.parsers.DFXPParserPlugin",paella.CaptionParserPlugIn,{ext:["dfxp"],getName:function(){return"es.upv.paella.captions.DFXPParserPlugin"},parse:function(e,t,n){for(var a=[],i=this,r=$(e),o=r.attr("xml:lang"),l=r.find("div"),s=0;s<l.length;++s){var u=$(l[s]),c=u.attr("xml:lang");if(null!=c&&""!=c||(c=null==o||""==o?(base.log.debug("No xml:lang found! Using '"+t+"' lang instead."),t):o),c==t){u.find("p").each(function(e,t){var n={id:e,begin:i.parseTimeTextToSeg(t.getAttribute("begin")),end:i.parseTimeTextToSeg(t.getAttribute("end")),content:$(t).text().trim()};a.push(n)});break}}0<a.length?n(!1,a):n(!0)},parseTimeTextToSeg:function(e){var t=0;if(/^([0-9]*([.,][0-9]*)?)s/.test(e))t=parseFloat(RegExp.$1);else{var n=e.split(":"),a=parseInt(n[0]),i=parseInt(n[1]);t=parseInt(n[2])+60*i+60*a*60}return t}}),new paella.captions.parsers.DFXPParserPlugin,Class("paella.plugins.CaptionsPlugin",paella.ButtonPlugin,{_searchTimerTime:1500,_searchTimer:null,_pluginButton:null,_open:0,_parent:null,_body:null,_inner:null,_bar:null,_input:null,_select:null,_editor:null,_activeCaptions:null,_lastSel:null,_browserLang:null,_defaultBodyHeight:280,_autoScroll:!0,_searchOnCaptions:null,getAlignment:function(){return"right"},getSubclass:function(){return"captionsPluginButton"},getName:function(){return"es.upv.paella.captionsPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Subtitles")},getIndex:function(){return 509},closeOnMouseOut:function(){return!1},checkEnabled:function(e){e(!0)},showUI:function(){1<=paella.captions.getAvailableLangs().length&&this.parent()},setup:function(){var n=this;paella.captions.getAvailableLangs().length||paella.plugins.captionsPlugin.hideUI(),paella.events.bind(paella.events.captionsEnabled,function(e,t){n.onChangeSelection(t)}),paella.events.bind(paella.events.captionsDisabled,function(e,t){n.onChangeSelection(t)}),paella.events.bind(paella.events.captionAdded,function(e,t){n.onCaptionAdded(t),paella.plugins.captionsPlugin.showUI()}),paella.events.bind(paella.events.timeUpdate,function(e,t){n._searchOnCaptions&&n.updateCaptionHiglighted(t)}),paella.events.bind(paella.events.controlBarWillHide,function(e){n.cancelHideBar()}),n._activeCaptions=paella.captions.getActiveCaptions(),n._searchOnCaptions=n.config.searchOnCaptions||!1},cancelHideBar:function(){0<this._open&&paella.player.controls.cancelHideBar()},updateCaptionHiglighted:function(r){var o=this,l=null;r&&paella.player.videoContainer.trimming().then(function(e){var t=e.enabled?e.start:0,n=paella.captions.getActiveCaptions(),a=n&&n.getCaptionAtTime(r.currentTime+t),i=a&&a.id;null!=i&&((l=$(".bodyInnerContainer[sec-id='"+i+"']"))!=o._lasSel&&$(o._lasSel).removeClass("Highlight"),l&&($(l).addClass("Highlight"),o._autoScroll&&o.updateScrollFocus(i),o._lasSel=l))})},updateScrollFocus:function(e){var n=0,t=$(".bodyInnerContainer").slice(0,e);(t=t.toArray()).forEach(function(e){var t=$(e).outerHeight(!0);n+=t});var a=parseInt(n/280);$(".captionsBody").scrollTop(a*this._defaultBodyHeight)},onCaptionAdded:function(e){var t=paella.captions.getCaptions(e),n=document.createElement("option");n.text=t._lang.txt,n.value=e,this._select.add(n)},changeSelection:function(){var e=this,t=$(e._select).val();if(""==t)return $(e._body).empty(),void paella.captions.setActiveCaptions(t);paella.captions.setActiveCaptions(t),e._activeCaptions=t,e._searchOnCaptions&&e.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"),e.setButtonHideShow()},onChangeSelection:function(e){var t=this;t._activeCaptions!=e&&($(t._body).empty(),null==e?(t._select.value="",$(t._input).prop("disabled",!0)):($(t._input).prop("disabled",!1),t._select.value=e,t._searchOnCaptions&&t.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list")),t._activeCaptions=e,t.setButtonHideShow())},action:function(){var e=this;switch(e._browserLang=base.dictionary.currentLanguage(),e._autoScroll=!0,e._open){case 0:e._browserLang&&null==paella.captions.getActiveCaptions()&&e.selectDefaultBrowserLang(e._browserLang),e._open=1,paella.keyManager.enabled=!1;break;case 1:paella.keyManager.enabled=!0,e._open=0}},buildContent:function(e){var n=this;n._parent=document.createElement("div"),n._parent.className="captionsPluginContainer",n._bar=document.createElement("div"),n._bar.className="captionsBar",n._searchOnCaptions&&(n._body=document.createElement("div"),n._body.className="captionsBody",n._parent.appendChild(n._body),$(n._body).scroll(function(){n._autoScroll=!1}),n._input=document.createElement("input"),n._input.className="captionsBarInput",n._input.type="text",n._input.id="captionsBarInput",n._input.name="captionsString",n._input.placeholder=base.dictionary.translate("Search captions"),n._bar.appendChild(n._input),$(n._input).change(function(){var e=$(n._input).val();n.doSearch(e)}),$(n._input).keyup(function(){var t=$(n._input).val();null!=n._searchTimer&&n._searchTimer.cancel(),n._searchTimer=new base.Timer(function(e){n.doSearch(t)},n._searchTimerTime)})),n._select=document.createElement("select"),n._select.className="captionsSelector";var t=document.createElement("option");t.text=base.dictionary.translate("None"),t.value="",n._select.add(t),paella.captions.getAvailableLangs().forEach(function(e){var t=document.createElement("option");t.text=e.lang.txt,t.value=e.id,n._select.add(t)}),n._bar.appendChild(n._select),n._parent.appendChild(n._bar),$(n._select).change(function(){n.changeSelection()}),n._editor=document.createElement("button"),n._editor.className="editorButton",n._editor.innerText="",n._bar.appendChild(n._editor),$(n._editor).prop("disabled",!0),$(n._editor).click(function(){var e=paella.captions.getActiveCaptions();paella.userTracking.log("paella:caption:edit",{id:e._captionsProvider+":"+e._id,lang:e._lang}),e.goToEdit()}),e.appendChild(n._parent)},selectDefaultBrowserLang:function(t){var n=null;paella.captions.getAvailableLangs().forEach(function(e){e.lang.code==t&&(n=e.id)}),n&&paella.captions.setActiveCaptions(n)},doSearch:function(e){var n=this,t=paella.captions.getActiveCaptions();t&&(""==e?n.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"):t.search(e,function(e,t){e||n.buildBodyContent(t,"search")}))},setButtonHideShow:function(){var e=this,t=$(".editorButton"),n=paella.captions.getActiveCaptions(),a=null;null!=n?($(e._select).width("39%"),n.canEdit(function(e,t){a=t}),a?($(t).prop("disabled",!1),$(t).show()):($(t).prop("disabled",!0),$(t).hide(),$(e._select).width("47%"))):($(t).prop("disabled",!0),$(t).hide(),$(e._select).width("47%")),e._searchOnCaptions||(a?$(e._select).width("92%"):$(e._select).width("100%"))},buildBodyContent:function(e,n){var a=this;$(a._body).empty(),e.forEach(function(t){paella.player.videoContainer.trimming().then(function(e){e.enabled&&(t.end<e.start||t.begin>e.end)||(a._inner=document.createElement("div"),a._inner.className="bodyInnerContainer",a._inner.innerText=t.content,"list"==n&&(a._inner.setAttribute("sec-begin",t.begin),a._inner.setAttribute("sec-end",t.end),a._inner.setAttribute("sec-id",t.id),a._autoScroll=!0),"search"==n&&a._inner.setAttribute("sec-begin",t.time),a._body.appendChild(a._inner),$(a._inner).hover(function(){$(this).css("background-color","rgba(250, 161, 102, 0.5)")},function(){$(this).removeAttr("style")}),$(a._inner).click(function(){var n=$(this).attr("sec-begin");paella.player.videoContainer.trimming().then(function(e){var t=e.enabled?e.start:0;paella.player.videoContainer.seekToTime(parseInt(n-t))})}))})})}}),paella.plugins.captionsPlugin=new paella.plugins.CaptionsPlugin,Class("paella.plugins.CaptionsOnScreen",paella.EventDrivenPlugin,{containerId:"paella_plugin_CaptionsOnScreen",container:null,innerContainer:null,top:null,actualPos:null,lastEvent:null,controlsPlayback:null,captions:!1,captionProvider:null,checkEnabled:function(e){e(!paella.player.isLiveStream())},setup:function(){},getEvents:function(){return[paella.events.controlBarDidHide,paella.events.resize,paella.events.controlBarDidShow,paella.events.captionsEnabled,paella.events.captionsDisabled,paella.events.timeUpdate]},onEvent:function(e,t){var n=this;switch(e){case paella.events.controlBarDidHide:if(n.lastEvent==e||0==n.captions)break;n.moveCaptionsOverlay("down");break;case paella.events.resize:if(0==n.captions)break;paella.player.controls.isHidden()?n.moveCaptionsOverlay("down"):n.moveCaptionsOverlay("top");break;case paella.events.controlBarDidShow:if(n.lastEvent==e||0==n.captions)break;n.moveCaptionsOverlay("top");break;case paella.events.captionsEnabled:n.buildContent(t),n.captions=!0,paella.player.controls.isHidden()?n.moveCaptionsOverlay("down"):n.moveCaptionsOverlay("top");break;case paella.events.captionsDisabled:n.hideContent(),n.captions=!1;break;case paella.events.timeUpdate:n.captions&&n.updateCaptions(t)}n.lastEvent=e},buildContent:function(e){var t=this;t.captionProvider=e,null==t.container?(t.container=document.createElement("div"),t.container.className="CaptionsOnScreen",t.container.id=t.containerId,t.innerContainer=document.createElement("div"),t.innerContainer.className="CaptionsOnScreenInner",t.container.appendChild(t.innerContainer),null==t.controlsPlayback&&(t.controlsPlayback=$("#playerContainer_controls_playback")),paella.player.videoContainer.domElement.appendChild(t.container)):$(t.container).show()},updateCaptions:function(a){var i=this;this.captions&&paella.player.videoContainer.trimming().then(function(e){var t=e.enabled?e.start:0,n=paella.captions.getActiveCaptions().getCaptionAtTime(a.currentTime+t);i.innerContainer.innerText=n?($(i.container).show(),n.content):""})},hideContent:function(){$(this.container).hide()},moveCaptionsOverlay:function(e){var t=this;if(null==t.controlsPlayback&&(t.controlsPlayback=$("#playerContainer_controls_playback")),"down"==e){t.controlsPlayback.offset().top;t.innerContainer.style.bottom=50-t.container.offsetHeight+"px"}if("top"==e){var n=t.controlsPlayback.offset().top;n-=t.innerContainer.offsetHeight+10,t.innerContainer.style.bottom=0-n+"px"}},getIndex:function(){return 1050},getName:function(){return"es.upv.paella.overlayCaptionsPlugin"}}),new paella.plugins.CaptionsOnScreen,Class("paella.ChromaVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(e,t,n,a,i,r,o){this.parent(e,t,"canvas",n,a,i,r),this._streamName=o||"chroma";var l=this;this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(e,t){return e.res.h-t.res.h}),this.video=null,new paella.Timer(function(e){!function(){if(l.canvasController){var e=l.canvasController.canvas.domElement;l.canvasController.reshape($(e).width(),$(e).height())}}()},500).repeat=!0},defaultProfile:function(){return"chroma"},_setVideoElem:function(e){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)},_loadDeps:function(){return new Promise(function(e,t){window.$paella_mpd?defer.resolve(window.$paella_mpd):require(["resources/deps/bg2e.js"],function(){window.$paella_bg2e=!0,e(window.$paella_bg2e)})})},_deferredAction:function(n){var a=this;return new Promise(function(e,t){a.video?e(n()):$(a.video).bind("canplay",function(){a._ready=!0,e(n())})})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},allowZoom:function(){return!1},getVideoData:function(){var n=this,a=this;return new Promise(function(e,t){n._deferredAction(function(){e({duration:a.video.duration,currentTime:a.video.currentTime,volume:a.video.volume,paused:a.video.paused,ended:a.video.ended,res:{w:a.video.videoWidth,h:a.video.videoHeight}})})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){(this._autoplay=e)&&this.video&&this.video.setAttribute("autoplay",e)},load:function(){var i=this;return new Promise(function(n,a){i._loadDeps().then(function(){var e=i._stream.sources[i._streamName];null===i._currentQuality&&i._videoQualityStrategy&&(i._currentQuality=i._videoQualityStrategy.getQualityIndex(e));var t=i._currentQuality<e.length?e[i._currentQuality]:null;i.video=null,t?(i.canvasController=null,buildChromaVideoCanvas(t,i.domElement).then(function(e){i.canvasController=e,i.video=e.video,i.video.pause(),t.crop&&(i.canvasController.crop=new bg.Vector4(t.crop.left,t.crop.top,t.crop.right,t.crop.bottom)),t.displacement&&(i.canvasController.transform=bg.Matrix4.Translation(t.displacement.x,t.displacement.y,0)),t.chromaColor&&(i.canvasController.chroma=new bg.Color(t.chromaColor[0],t.chromaColor[1],t.chromaColor[2],t.chromaColor[3])),t.chromaBias&&(i.canvasController.bias=t.chromaBias),n(t)})):a(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){var i=this;return new Promise(function(a,e){setTimeout(function(){var t=[],e=i._stream.sources[i._streamName],n=-1;e.forEach(function(e){n++,t.push(i._getQualityObject(n,e))}),a(t)},10)})},setQuality:function(i){var r=this;return new Promise(function(e){var t=r.video.paused,n=r._stream.sources[r._streamName];r._currentQuality=i<n.length?i:0;var a=r.video.currentTime;r.freeze().then(function(){return r._ready=!1,r.load()}).then(function(){t||r.play(),$(r.video).on("seeked",function(){r.unFreeze(),e(),$(r.video).off("seeked")}),r.video.currentTime=a})})},getCurrentQuality:function(){var t=this;return new Promise(function(e){e(t._getQualityObject(t._currentQuality,t._stream.sources[t._streamName][t._currentQuality]))})},play:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,e.video.play()})},pause:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,e.video.pause()})},isPaused:function(){var e=this;return this._deferredAction(function(){return e.video.paused})},duration:function(){var e=this;return this._deferredAction(function(){return e.video.duration})},setCurrentTime:function(e){var t=this;return this._deferredAction(function(){t.video.currentTime=e,$(t.video).on("seeked",function(){t.canvasController.postRedisplay(),$(t.video).off("seeked")})})},currentTime:function(){var e=this;return this._deferredAction(function(){return e.video.currentTime})},setVolume:function(e){var t=this;return this._deferredAction(function(){t.video.volume=e})},volume:function(){var e=this;return this._deferredAction(function(){return e.video.volume})},setPlaybackRate:function(e){var t=this;return this._deferredAction(function(){t.video.playbackRate=e})},playbackRate:function(){var e=this;return this._deferredAction(function(){return e.video.playbackRate})},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){var t=this;return this._deferredAction(function(){var e=document.getElementById(t.video.className+"canvas");$(e).remove()})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.ChromaVideoFactory",{isStreamCompatible:function(e){try{if(paella.ChromaVideo._loaded)return!1;if(0<paella.videoFactories.Html5VideoFactory.s_instances&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("chroma"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,n){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,new paella.ChromaVideo(e,t,n.x,n.y,n.w,n.h)}}),Class("paella.plugins.CommentsPlugin",paella.TabBarPlugin,{divPublishComment:null,divComments:null,publishCommentTextArea:null,publishCommentButtons:null,canPublishAComment:!1,comments:[],commentsTree:[],domElement:null,getSubclass:function(){return"showCommentsTabBar"},getName:function(){return"es.upv.paella.commentsPlugin"},getTabName:function(){return base.dictionary.translate("Comments")},checkEnabled:function(e){e(!0)},getIndex:function(){return 40},getDefaultToolTip:function(){return base.dictionary.translate("Comments")},action:function(e){this.loadContent()},buildContent:function(e){this.domElement=e,this.canPublishAComment=paella.initDelegate.initParams.accessControl.permissions.canWrite,this.loadContent()},loadContent:function(){this.divRoot=this.domElement,this.divRoot.innerText="",this.divPublishComment=document.createElement("div"),this.divPublishComment.className="CommentPlugin_Publish",this.divPublishComment.id="CommentPlugin_Publish",this.divComments=document.createElement("div"),this.divComments.className="CommentPlugin_Comments",this.divComments.id="CommentPlugin_Comments",this.canPublishAComment&&(this.divRoot.appendChild(this.divPublishComment),this.createPublishComment()),this.divRoot.appendChild(this.divComments),this.reloadComments()},createPublishComment:function(){var e,t,n,a,i=this,r=this.divPublishComment.id+"_entry";(e=document.createElement("div")).id=r,e.className="comments_entry",(t=document.createElement("img")).className="comments_entry_silhouette",t.style.width="48px",t.src=paella.initDelegate.initParams.accessControl.userData.avatar,t.id=r+"_silhouette",e.appendChild(t),(n=document.createElement("div")).className="comments_entry_container",n.id=r+"_textarea_container",e.appendChild(n),this.publishCommentTextArea=document.createElement("textarea"),this.publishCommentTextArea.id=r+"_textarea",this.publishCommentTextArea.onclick=function(){paella.keyManager.enabled=!1},this.publishCommentTextArea.onblur=function(){paella.keyManager.enabled=!0},n.appendChild(this.publishCommentTextArea),this.publishCommentButtons=document.createElement("div"),this.publishCommentButtons.id=r+"_buttons_area",n.appendChild(this.publishCommentButtons),(a=document.createElement("button")).id=r+"_btnAddComment",a.className="publish",a.onclick=function(){""!=i.publishCommentTextArea.value.replace(/\s/g,"")&&i.addComment()},a.innerText=base.dictionary.translate("Publish"),this.publishCommentButtons.appendChild(a),n.commentsTextArea=this.publishCommentTextArea,n.commentsBtnAddComment=a,n.commentsBtnAddCommentToInstant=this.btnAddCommentToInstant,this.divPublishComment.appendChild(e)},addComment:function(){var n=this,e=paella.AntiXSS.htmlEscape(n.publishCommentTextArea.value),t=new Date;this.comments.push({id:base.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"normal",value:e,created:t});var a={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},a,function(e,t){t&&n.loadContent()})},addReply:function(e,t){var n=this,a=document.getElementById(t),i=paella.AntiXSS.htmlEscape(a.value),r=new Date;paella.keyManager.enabled=!0,this.comments.push({id:base.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"reply",parent:e,value:i,created:r});var o={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},o,function(e,t){t&&n.reloadComments()})},reloadComments:function(){var l=this;l.commentsTree=[],l.comments=[],this.divComments.innerText="",paella.data.read("comments",{id:paella.initDelegate.getId()},function(e,t){var n,a,i;if(e&&"object"==$traceurRuntime.typeof(e)&&e.allComments&&0<e.allComments.length){l.comments=e.allComments;var r={};for(n=0;n<e.allComments.length;++n)a=e.allComments[n].value,"reply"!==e.allComments[n].mode&&((i={}).id=e.allComments[n].id,i.userName=e.allComments[n].userName,i.mode=e.allComments[n].mode,i.value=a,i.created=e.allComments[n].created,i.replies=[],l.commentsTree.push(i),r[i.id]=l.commentsTree.length-1);for(n=0;n<e.allComments.length;++n)if(a=e.allComments[n].value,"reply"===e.allComments[n].mode){(i={}).id=e.allComments[n].id,i.userName=e.allComments[n].userName,i.mode=e.allComments[n].mode,i.value=a,i.created=e.allComments[n].created;var o=r[e.allComments[n].parent];l.commentsTree[o].replies.push(i)}l.displayComments()}})},displayComments:function(){for(var e=0;e<this.commentsTree.length;++e){var t=this.commentsTree[e],n=this.createACommentEntry(t);this.divComments.appendChild(n)}},createACommentEntry:function(t){var e,a,n,i,r=this,o=this.divPublishComment.id+"_entry"+t.id;(e=document.createElement("div")).id=o,e.className="comments_entry",(a=document.createElement("img")).className="comments_entry_silhouette",a.id=o+"_silhouette",e.appendChild(a),(n=document.createElement("div")).className="comments_entry_container",n.id=o+"_comment_container",e.appendChild(n),(i=document.createElement("div")).id=o+"_comment_metadata",n.appendChild(i);var l,s="";if(t.created){var u=new Date,c=paella.utils.timeParse.matterhornTextDateToDate(t.created);s=paella.utils.timeParse.secondsToText((u.getTime()-c.getTime())/1e3)}(l=document.createElement("div")).id=o+"_comment_value",l.className="comments_entry_comment",n.appendChild(l),l.innerText=t.value;var d=document.createElement("div");if(d.id=o+"_comment_reply",n.appendChild(d),paella.data.read("userInfo",{username:t.userName},function(e,t){if(e){a.src=e.avatar;var n="<span class='comments_entry_username'>"+e.name+" "+e.lastname+"</span>";n+="<span class='comments_entry_datepublish'>"+s+"</span>",i.innerText=n}}),1==this.canPublishAComment){var p=document.createElement("div");p.className="reply_button",p.innerText=base.dictionary.translate("Reply"),p.id=o+"_comment_reply_button",p.onclick=function(){var e=r.createAReplyEntry(t.id);this.style.display="none",this.parentElement.parentElement.appendChild(e)},d.appendChild(p)}for(var m=0;m<t.replies.length;++m){var h=r.createACommentReplyEntry(t.id,t.replies[m]);n.appendChild(h)}return e},createACommentReplyEntry:function(e,t){var n,a,i,r,o=this.divPublishComment.id+"_entry_"+e+"_reply_"+t.id;(n=document.createElement("div")).id=o,n.className="comments_entry",(a=document.createElement("img")).className="comments_entry_silhouette",a.id=o+"_silhouette",n.appendChild(a),(i=document.createElement("div")).className="comments_entry_container",i.id=o+"_comment_container",n.appendChild(i),(r=document.createElement("div")).id=o+"_comment_metadata",i.appendChild(r);var l,s="";if(t.created){var u=new Date,c=paella.utils.timeParse.matterhornTextDateToDate(t.created);s=paella.utils.timeParse.secondsToText((u.getTime()-c.getTime())/1e3)}return(l=document.createElement("div")).id=o+"_comment_value",l.className="comments_entry_comment",i.appendChild(l),l.innerText=t.value,paella.data.read("userInfo",{username:t.userName},function(e,t){if(e){a.src=e.avatar;var n="<span class='comments_entry_username'>"+e.name+" "+e.lastname+"</span>";n+="<span class='comments_entry_datepublish'>"+s+"</span>",r.innerText=n}}),n},createAReplyEntry:function(e){var t,n,a,i,r,o=this,l=this.divPublishComment.id+"_entry_"+e+"_reply";return(t=document.createElement("div")).id=l+"_entry",t.className="comments_entry",(n=document.createElement("img")).className="comments_entry_silhouette",n.style.width="48px",n.id=l+"_silhouette",n.src=paella.initDelegate.initParams.accessControl.userData.avatar,t.appendChild(n),(a=document.createElement("div")).className="comments_entry_container comments_reply_container",a.id=l+"_reply_container",t.appendChild(a),(i=document.createElement("textArea")).onclick=function(){paella.keyManager.enabled=!1},i.draggable=!1,i.id=l+"_textarea",a.appendChild(i),this.publishCommentButtons=document.createElement("div"),this.publishCommentButtons.id=l+"_buttons_area",a.appendChild(this.publishCommentButtons),(r=document.createElement("button")).id=l+"_btnAddComment",r.className="publish",r.onclick=function(){""!=i.value.replace(/\s/g,"")&&o.addReply(e,i.id)},r.innerText=base.dictionary.translate("Reply"),this.publishCommentButtons.appendChild(r),t}}),paella.plugins.commentsPlugin=new paella.plugins.CommentsPlugin,Class("paella.plugins.DescriptionPlugin",paella.TabBarPlugin,{getSubclass:function(){return"showDescriptionTabBar"},getName:function(){return"es.upv.paella.descriptionPlugin"},getTabName:function(){return"Descripción"},domElement:null,buildContent:function(e){this.domElement=e,this.loadContent()},action:function(e){this.loadContent()},loadContent:function(){var t=this.domElement;t.innerText="Loading...",new paella.Timer(function(e){t.innerText="Loading done"},2e3)}}),paella.plugins.descriptionPlugin=new paella.plugins.DescriptionPlugin,Class("paella.plugins.extendedTabAdapterPlugin",paella.ButtonPlugin,{currentUrl:null,currentMaster:null,currentSlave:null,availableMasters:[],availableSlaves:[],showWidthRes:null,getAlignment:function(){return"right"},getSubclass:function(){return"extendedTabAdapterPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 550},getName:function(){return"es.upv.paella.extendedTabAdapterPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Extended Tab Adapter")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(e){e.appendChild(paella.extendedAdapter.bottomContainer)}}),new paella.plugins.extendedTabAdapterPlugin,Class("paella.plugins.FootPrintsPlugin",paella.ButtonPlugin,{INTERVAL_LENGTH:5,inPosition:0,outPosition:0,canvas:null,footPrintsTimer:null,footPrintsData:{},getAlignment:function(){return"right"},getSubclass:function(){return"footPrints"},getIndex:function(){return 590},getDefaultToolTip:function(){return base.dictionary.translate("Show statistics")},getName:function(){return"es.upv.paella.footprintsPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},setup:function(){var t=this;switch(paella.events.bind(paella.events.timeUpdate,function(e){t.onTimeUpdate()}),this.config.skin){case"custom":this.fillStyle=this.config.fillStyle,this.strokeStyle=this.config.strokeStyle;break;case"dark":this.fillStyle="#727272",this.strokeStyle="#424242";break;case"light":default:this.fillStyle="#d8d8d8",this.strokeStyle="#ffffff"}},checkEnabled:function(e){e(!paella.player.isLiveStream())},buildContent:function(e){var t=document.createElement("div");t.className="footPrintsContainer",this.canvas=document.createElement("canvas"),this.canvas.id="footPrintsCanvas",this.canvas.className="footPrintsCanvas",t.appendChild(this.canvas),e.appendChild(t)},onTimeUpdate:function(){var n=this,a=-1;paella.player.videoContainer.currentTime().then(function(e){return a=e,paella.player.videoContainer.trimming()}).then(function(e){var t=Math.round(a+(e.enabled?e.start:0));n.inPosition<=t&&t<=n.inPosition+n.INTERVAL_LENGTH?(n.outPosition=t,n.inPosition+n.INTERVAL_LENGHT===n.outPosition&&(n.trackFootPrint(n.inPosition,n.outPosition),n.inPosition=n.outPosition)):(n.trackFootPrint(n.inPosition,n.outPosition),n.inPosition=t,n.outPosition=t)})},trackFootPrint:function(e,t){var n={in:e,out:t};paella.data.write("footprints",{id:paella.initDelegate.getId()},n)},willShowContent:function(){var t=this;this.loadFootprints(),this.footPrintsTimer=new base.Timer(function(e){t.loadFootprints()},5e3),this.footPrintsTimer.repeat=!0},didHideContent:function(){null!=this.footPrintsTimer&&(this.footPrintsTimer.cancel(),this.footPrintsTimer=null)},loadFootprints:function(){var c=this;paella.data.read("footprints",{id:paella.initDelegate.getId()},function(s,e){var u={};paella.player.videoContainer.duration().then(function(e){for(var t=Math.floor(paella.player.videoContainer.trimStart()),n=-1,a=0,i=0;i<s.length;i++){var r=s[i].position-t;if(r<e){var o=s[i].views;if(r-1!=n)for(var l=n+1;l<r;l++)u[l]=a;a=u[n=r]=o}}c.drawFootPrints(u)})})},drawFootPrints:function(e){if(this.canvas){var t,n=Object.keys(e).length,a=this.canvas.getContext("2d"),i=20;for(t=0;t<n;++t)e[t]>i&&(i=e[t]);for(this.canvas.setAttribute("width",n),this.canvas.setAttribute("height",i),a.clearRect(0,0,this.canvas.width,this.canvas.height),a.fillStyle=this.fillStyle,a.strokeStyle=this.strokeStyle,a.lineWidth=2,a.webkitImageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,t=0;t<n-1;++t)a.beginPath(),a.moveTo(t,i),a.lineTo(t,i-e[t]),a.lineTo(t+1,i-e[t+1]),a.lineTo(t+1,i),a.closePath(),a.fill(),a.beginPath(),a.moveTo(t,i-e[t]),a.lineTo(t+1,i-e[t+1]),a.closePath(),a.stroke()}}}),paella.plugins.footPrintsPlugin=new paella.plugins.FootPrintsPlugin,Class("paella.plugins.FrameCaptionsSearchPlugIn",paella.SearchServicePlugIn,{getName:function(){return"es.upv.paella.frameCaptionsSearchPlugin"},search:function(e,t){var n=RegExp(e,"i"),a=[];for(var i in paella.player.videoLoader.frameList){var r=paella.player.videoLoader.frameList[i];"object"==$traceurRuntime.typeof(r)&&n.test(r.caption)&&a.push({time:i,content:r.caption,score:0})}t&&t(!1,a)}}),new paella.plugins.FrameCaptionsSearchPlugIn,Class("paella.plugins.FrameControlPlugin",paella.ButtonPlugin,{frames:null,highResFrames:null,currentFrame:null,navButtons:null,buttons:[],contx:null,_img:null,_searchTimer:null,_searchTimerTime:250,getAlignment:function(){return"right"},getSubclass:function(){return"frameControl"},getIndex:function(){return 510},getMinWindowSize:function(){return 450},getName:function(){return"es.upv.paella.frameControlPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},getDefaultToolTip:function(){return base.dictionary.translate("Navigate by slides")},checkEnabled:function(e){null==paella.initDelegate.initParams.videoLoader.frameList?e(!1):0===paella.initDelegate.initParams.videoLoader.frameList.length?e(!1):0==Object.keys(paella.initDelegate.initParams.videoLoader.frameList).length?e(!1):e(!0)},setup:function(){this._showFullPreview=this.config.showFullPreview||"auto";var i,r=this,o=1,l=0,s=-1,u=13,c=27,d=37,p=39;$(this.button).keyup(function(e){var t=Math.floor(r.contx.offsetWidth/100),n=r.buttons.length%t,a=Math.floor(r.buttons.length/t);r.isPopUpOpen()&&(e.keyCode==d?0<s&&(r.buttons[s].className=i,a<o&&(l=t-n),--s==t*(o-1)-1-l&&0!=s&&(r.navButtons.left.scrollContainer.scrollLeft-=105*t,--o),this.hiResFrame&&r.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||r.buttons[s].frameControl.onMouseOver(null,r.buttons[s].frameData),i=r.buttons[s].className,r.buttons[s].className="frameControlItem selected"):e.keyCode==p?s<r.buttons.length-1&&(0<=s&&(r.buttons[s].className=i),1==o&&(l=0),++s==t*o-l&&(r.navButtons.left.scrollContainer.scrollLeft+=105*t,++o),this.hiResFrame&&r.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||r.buttons[s].frameControl.onMouseOver(null,r.buttons[s].frameData),i=r.buttons[s].className,r.buttons[s].className="frameControlItem selected"):e.keyCode==u?(r.buttons[s].frameControl.onClick(null,r.buttons[s].frameData),i="frameControlItem current"):e.keyCode==c&&r.removeHiResFrame())})},buildContent:function(e){var n=this,a=this;this.frames=[];var t=document.createElement("div");t.className="frameControlContainer",a.contx=t;var i=document.createElement("div");i.className="frameControlContent",this.navButtons={left:document.createElement("div"),right:document.createElement("div")},this.navButtons.left.className="frameControl navButton left",this.navButtons.right.className="frameControl navButton right";var r=this.getFrame(null);e.appendChild(this.navButtons.left),e.appendChild(t),t.appendChild(i),e.appendChild(this.navButtons.right),this.navButtons.left.scrollContainer=t,$(this.navButtons.left).click(function(e){this.scrollContainer.scrollLeft-=100}),this.navButtons.right.scrollContainer=t,$(this.navButtons.right).click(function(e){this.scrollContainer.scrollLeft+=100}),i.appendChild(r);var o=$(r).outerWidth(!0);i.innerText="",$(window).mousemove(function(e){($(i).offset().top>e.pageY||!$(i).is(":visible")||$(i).offset().top+$(i).height()<e.pageY)&&a.removeHiResFrame()});var l,s=paella.initDelegate.initParams.videoLoader.frameList;if(s){var u=Object.keys(s);l=u.length,u.map(function(e){return Number(e,10)}).sort(function(e,t){return e-t}).forEach(function(e){var t=a.getFrame(s[e]);i.appendChild(t,"frameContrlItem_"+l),a.frames.push(t)})}$(i).css({width:l*o+"px"}),paella.events.bind(paella.events.setTrim,function(e,t){n.updateFrameVisibility(t.trimEnabled,t.trimStart,t.trimEnd)}),paella.player.videoContainer.trimming().then(function(e){n.updateFrameVisibility(e.enabled,e.start,e.end)}),paella.events.bind(paella.events.timeupdate,function(e,t){return n.onTimeUpdate(t.currentTime)})},showHiResFrame:function(e,t){var n=document.createElement("div"),a=document.createElement("div"),i=document.createElement("img");(this._img=i).className="frameHiRes",i.setAttribute("src",e),i.setAttribute("style","width: 100%;"),$(a).append(i),$(n).append(a),n.setAttribute("style","display: table;"),a.setAttribute("style","display: table-cell; vertical-align:middle;");var r=document.createElement("p");r.className="frameCaption",r.innerText=t||"",n.append(r),this._caption=r;var o=paella.player.videoContainer.overlayContainer;switch(this._showFullPreview){case"auto":1==(l=paella.initDelegate.initParams.videoLoader.streams).length?o.addElement(n,o.getMasterRect()):2<=l.length&&o.addElement(n,o.getSlaveRect()),o.enableBackgroundMode(),this.hiResFrame=n;break;case"master":o.addElement(n,o.getMasterRect()),o.enableBackgroundMode(),this.hiResFrame=n;break;case"slave":var l;2<=(l=paella.initDelegate.initParams.videoLoader.streams).length&&(o.addElement(n,o.getSlaveRect()),o.enableBackgroundMode(),this.hiResFrame=n)}},removeHiResFrame:function(){var e=paella.player.videoContainer.overlayContainer;this.hiResFrame&&e.removeElement(this.hiResFrame),e.disableBackgroundMode(),this._img=null},updateFrameVisibility:function(e,t,n){var a;if(e)for(a=0;a<this.frames.length;++a){var i=this.frames[a],r=i.frameData;r.time<t?this.frames.length>a+1&&this.frames[a+1].frameData.time>t?$(i).show():$(i).hide():r.time>n?$(i).hide():$(i).show()}else for(a=0;a<this.frames.length;++a)$(this.frames[a]).show()},getFrame:function(e,t){var n=document.createElement("div");if(n.className="frameControlItem",t&&(n.id=t),e){this.buttons.push(n),n.frameData=e,n.frameControl=this;var a=e.thumb?e.thumb:e.url,i=paella.utils.timeParse.secondsToTime(e.time);n.innerHTML='<img src="'+a+'" alt="" class="frameControlImage" title="'+i+'" aria-label="'+i+'"></img>',base.userAgent.browser.IsMobileVersion||$(n).mouseover(function(e){this.frameControl.onMouseOver(e,this.frameData)}),$(n).mouseout(function(e){this.frameControl.onMouseOut(e,this.frameData)}),$(n).click(function(e){this.frameControl.onClick(e,this.frameData)})}return n},onMouseOver:function(e,t){var n=paella.initDelegate.initParams.videoLoader.frameList[t.time];if(n){var a=n.url;this._img?(this._img.setAttribute("src",a),this._caption.innerText=n.caption||""):this.showHiResFrame(a,n.caption)}null!=this._searchTimer&&this._searchTimer.cancel()},onMouseOut:function(e,t){var n=this;n._searchTimer=new base.Timer(function(e){n.removeHiResFrame()},n._searchTimerTime)},onClick:function(e,n){paella.player.videoContainer.trimming().then(function(e){var t=e.enabled?n.time-e.start:n.time;0<t?paella.player.videoContainer.seekToTime(t+1):paella.player.videoContainer.seekToTime(0)})},onTimeUpdate:function(a){var i=this;paella.player.videoContainer.trimming().then(function(e){var t=null;e.enabled&&(a+=e.start);for(var n=0;n<i.frames.length&&(i.frames[n].frameData&&i.frames[n].frameData.time<=a);++n)t=i.frames[n];i.currentFrame!=t&&t&&(i.currentFrame&&(i.currentFrame.className="frameControlItem"),i.currentFrame=t,i.currentFrame.className="frameControlItem current")})}}),paella.plugins.frameControlPlugin=new paella.plugins.FrameControlPlugin,Class("paella.plugins.FullScreenPlugin",paella.ButtonPlugin,{_reload:null,getIndex:function(){return 551},getAlignment:function(){return"right"},getSubclass:function(){return"showFullScreenButton"},getName:function(){return"es.upv.paella.fullScreenButtonPlugin"},checkEnabled:function(e){e(paella.player.checkFullScreenCapability())},getDefaultToolTip:function(){return base.dictionary.translate("Go Fullscreen")},setup:function(){var t=this;this._reload=!!this.config.reloadOnFullscreen&&this.config.reloadOnFullscreen.enabled,this._keepUserQuality=!this.config.reloadOnFullscreen||this.config.reloadOnFullscreen.keepUserSelection,paella.events.bind(paella.events.enterFullscreen,function(e){t.onEnterFullscreen()}),paella.events.bind(paella.events.exitFullscreen,function(e){t.onExitFullscreen()})},action:function(e){var n=this;if(paella.player.isFullScreen())paella.player.exitFullScreen();else{if((!paella.player.checkFullScreenCapability()||base.userAgent.browser.Explorer)&&window.location!==window.parent.location){var a=window.location.href;return paella.player.pause(),void paella.player.videoContainer.currentTime().then(function(e){var t=n.secondsToHours(e);window.open(a+"&time="+t.h+"h"+t.m+"m"+t.s+"s&autoplay=true")})}paella.player.goFullScreen()}paella.player.config.player.reloadOnFullscreen&&!paella.utils.userAgent.system.iOS&&setTimeout(function(){n._reload&&paella.player.videoContainer.setQuality(null).then(function(){})},1e3)},secondsToHours:function(e){var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),a=Math.floor(e-3600*t-60*n),i={};return t<10&&(t="0"+t),n<10&&(n="0"+n),a<10&&(a="0"+a),i.h=t,i.m=n,i.s=a,i},onEnterFullscreen:function(){this.setToolTip(base.dictionary.translate("Exit Fullscreen")),this.button.className=this.getButtonItemClass(!0)},onExitFullscreen:function(){this.setToolTip(base.dictionary.translate("Go Fullscreen")),this.button.className=this.getButtonItemClass(!1),setTimeout(function(){paella.player.onresize()},100)},getButtonItemClass:function(e){return"buttonPlugin "+this.getAlignment()+" "+this.getSubclass()+(e?" active":"")}}),paella.plugins.fullScreenPlugin=new paella.plugins.FullScreenPlugin,Class("paella.plugins.HelpPlugin",paella.ButtonPlugin,{getIndex:function(){return 509},getAlignment:function(){return"right"},getSubclass:function(){return"helpButton"},getName:function(){return"es.upv.paella.helpPlugin"},getMinWindowSize:function(){return 650},getDefaultToolTip:function(){return base.dictionary.translate("Show help")+" ("+base.dictionary.translate("Paella version:")+" "+paella.version+")"},checkEnabled:function(e){e(0<(this.config&&this.config.langs||[]).length)},action:function(e){var t=base.dictionary.currentLanguage(),n=this.config&&this.config.langs||[],a=n.indexOf(t);a<0&&(a=0);var i="resources/style/help/help_"+n[a]+".html";base.userAgent.browser.IsMobileVersion?window.open(i):paella.messageBox.showFrame(i)}}),paella.plugins.helpPlugin=new paella.plugins.HelpPlugin,Class("paella.HLSPlayer",paella.Html5Video,{initialize:function(e,t,n,a,i,r){this.parent(e,t,n,a,i,r,"hls")},_loadDeps:function(){return new Promise(function(t,e){window.$paella_hls?t(window.$paella_hls):require(["resources/deps/hls.min.js"],function(e){window.$paella_hls=e,t(window.$paella_hls)})})},allowZoom:function(){return!0},load:function(){var n=this;if(this._posterFrame&&this.video.setAttribute("poster",this._posterFrame),base.userAgent.system.iOS||base.userAgent.browser.Safari)return this.parent();var i=this;return new Promise(function(e,t){var a=n._stream.sources.hls;a&&0<a.length?(a=a[0],n._loadDeps().then(function(n){n.isSupported()&&(i._hls=new n,i._hls.loadSource(a.src),i._hls.attachMedia(i.video),i._hls.config.capLevelToPlayerSize=!0,i._hls.on(n.Events.LEVEL_SWITCHED,function(e,t){i.qualityIndex=t.level,i.setQuality(t.level)}),i._hls.on(n.Events.ERROR,function(e,t){if(t.fatal)switch(t.type){case n.ErrorTypes.NETWORK_ERROR:base.log.error("paella.HLSPlayer: Fatal network error encountered, try to recover"),i._hls.startLoad();break;case n.ErrorTypes.MEDIA_ERROR:base.log.error("paella.HLSPlayer: Fatal media error encountered, try to recover"),i._hls.recoverMediaError();break;default:base.log.error("paella.HLSPlayer: Fatal Error. Can not recover"),i._hls.destroy()}}),i._hls.on(n.Events.MANIFEST_PARSED,function(){i._deferredAction(function(){e()})}))})):t(new Error("Invalid source"))})},getQualities:function(){var t=this;if(base.userAgent.system.iOS||base.userAgent.browser.Safari)return new Promise(function(e,t){e([{index:0,res:"",src:"",toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(e){return 0}}])});var n=this;return new Promise(function(e){t._qualities||(n._qualities=[],n._hls.levels.forEach(function(e,t){n._qualities.push(n._getQualityObject(t,{index:t,res:{w:e.width,h:e.height},bitrate:e.bitrate}))})),e(n._qualities)})},printQualityes:function(){var n=this;return new Promise(function(t,e){n.getCurrentQuality().then(function(e){return n.getNextQuality()}).then(function(e){t()})})},setQuality:function(e){if(base.userAgent.system.iOS||base.userAgent.browser.Safari)return Promise.resolve();if(null===e)return Promise.resolve();try{this.qualityIndex=e,this._hls.nextLevel=e}catch(e){}return Promise.resolve()},getNextQuality:function(){var a=this;return new Promise(function(e,t){var n=a._hls.nextLevel;e(a._qualities[n])})},getCurrentQuality:function(){var a=this;return base.userAgent.system.iOS||base.userAgent.browser.Safari?Promise.resolve(0):(this.getNextQuality(),new Promise(function(e,t){var n=null==a.qualityIndex?a._hls.currentLevel:a.qualityIndex;e(a._qualities[n])}))}}),Class("paella.videoFactories.HLSVideoFactory",{isStreamCompatible:function(e){void 0===paella.videoFactories.HLSVideoFactory.s_instances&&(paella.videoFactories.HLSVideoFactory.s_instances=0);try{if(0<paella.videoFactories.HLSVideoFactory.s_instances&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("hls"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,n){return++paella.videoFactories.HLSVideoFactory.s_instances,new paella.HLSPlayer(e,t,n.x,n.y,n.w,n.h)}}),function(){var e,t=(e=paella.VideoOverlayButtonPlugin,$traceurRuntime.createClass(function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)},{getIndex:function(){return 0},getSubclass:function(){return"legal"},getAlignment:function(){return paella.player.config.plugins.list[this.getName()].position},getDefaultToolTip:function(){return""},checkEnabled:function(e){var t=paella.player.config.plugins.list[this.getName()];this._label=t.label,this._url=t.legalUrl,e(!0)},setup:function(){var e=document.createElement("a");e.innerText=this._label,e.className="",this.button.appendChild(e)},action:function(e){window.open(this._url)},getName:function(){return"es.upv.paella.legalPlugin"}},{},e));paella.plugins.legalPlugin=new t}(),Class("paella.LiveStreamIndicator",paella.VideoOverlayButtonPlugin,{isEditorVisible:function(){return null!=paella.editor.instance},getIndex:function(){return 10},getSubclass:function(){return"liveIndicator"},getAlignment:function(){return"right"},getDefaultToolTip:function(){return base.dictionary.translate("This video is a live stream")},checkEnabled:function(e){e(paella.player.isLiveStream())},setup:function(){},action:function(e){paella.messageBox.showMessage(base.dictionary.translate("Live streaming mode: This is a live video, so, some capabilities of the player are disabled"))},getName:function(){return"es.upv.paella.liveStreamingIndicatorPlugin"}}),paella.plugins.liveStreamIndicator=new paella.LiveStreamIndicator,Class("paella.MpegDashVideo",paella.Html5Video,{_posterFrame:null,_player:null,initialize:function(e,t,n,a,i,r){this.parent(e,t,n,a,i,r)},_loadDeps:function(){return new Promise(function(e,t){window.$paella_mpd?e(window.$paella_mpd):require(["resources/deps/dash.all.js"],function(){window.$paella_mpd=!0,e(window.$paella_mpd)})})},_getQualityObject:function(e,t,n){var a=n.length,i=Math.round(100*t/a),r=0==t?"min":t==a-1?"max":i+"%";return{index:t,res:{w:null,h:null},bitrate:e.bitrate,src:null,toString:function(){return i},shortLabel:function(){return r},compare:function(e){return this.bitrate-e.bitrate}}},load:function(){var n=this,i=this;return new Promise(function(a,e){var t=n._stream.sources.mpd;t&&0<t.length?(t=t[0],n._loadDeps().then(function(){var n=dashjs.MediaPlayer().create();n.initialize(i.video,t.src,!0),n.getDebug().setLogToBrowserConsole(!1),(i._player=n).on(dashjs.MediaPlayer.events.STREAM_INITIALIZED,function(e,t){n.getBitrateInfoListFor("video");i._deferredAction(function(){i._firstPlay||(i._player.pause(),i._firstPlay=!0),a()})})})):e(new Error("Invalid source"))})},supportAutoplay:function(){return!0},getQualities:function(){var a=this;return new Promise(function(e){a._deferredAction(function(){a._qualities||(a._qualities=[],a._player.getBitrateInfoListFor("video").sort(function(e,t){return e.bitrate-t.bitrate}).forEach(function(e,t,n){a._qualities.push(a._getQualityObject(e,t,n))}),a.autoQualityIndex=a._qualities.length,a._qualities.push({index:a.autoQualityIndex,res:{w:null,h:null},bitrate:-1,src:null,toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(e){return this.bitrate-e.bitrate}})),e(a._qualities)})})},setQuality:function(t){var i=this;return new Promise(function(n,e){var a=i._player.getQualityFor("video");t==i.autoQualityIndex?(i._player.setAutoSwitchQuality(!0),n()):t!=a?(i._player.setAutoSwitchQuality(!1),i._player.off(dashjs.MediaPlayer.events.METRIC_CHANGED),i._player.on(dashjs.MediaPlayer.events.METRIC_CHANGED,function(e,t){"metricchanged"==e.type&&a!=i._player.getQualityFor("video")&&(a=i._player.getQualityFor("video"),n())}),i._player.setQualityFor("video",t)):n()})},getCurrentQuality:function(){var a=this;return new Promise(function(e,t){if(a._player.getAutoSwitchQuality())e({index:a.autoQualityIndex,res:{w:null,h:null},bitrate:-1,src:null,toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(e){return this.bitrate-e.bitrate}});else{var n=a._player.getQualityFor("video");e(a._getQualityObject(a._qualities[n],n,a._player.getBitrateInfoListFor("video")))}})},unFreeze:function(){return paella_DeferredNotImplemented()},freeze:function(){return paella_DeferredNotImplemented()},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}}),Class("paella.videoFactories.MpegDashVideoFactory",{isStreamCompatible:function(e){try{if(base.userAgent.system.iOS)return!1;for(var t in e.sources)if("mpd"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,n){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.MpegDashVideo(e,t,n.x,n.y,n.w,n.h)}}),Class("paella.plugins.MultipleQualitiesPlugin",paella.ButtonPlugin,{_available:[],getAlignment:function(){return"right"},getSubclass:function(){return"showMultipleQualitiesPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 550},getName:function(){return"es.upv.paella.multipleQualitiesPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Change video quality")},closeOnMouseOut:function(){return!0},checkEnabled:function(t){var n=this;paella.player.videoContainer.getQualities().then(function(e){n._available=e,t(1<e.length)})},setup:function(){var t=this;this.setQualityLabel(),paella.events.bind(paella.events.qualityChanged,function(e){t.setQualityLabel()})},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(t){var n=this;this._available.forEach(function(e){e.shortLabel();t.appendChild(n.getItemButton(e))})},getItemButton:function(a){var i=document.createElement("div"),r=this;return paella.player.videoContainer.getCurrentQuality().then(function(e,t){var n=a.shortLabel();i.className=r.getButtonItemClass(n,a.index==e),i.id=n,i.innerText=n,i.data=a,$(i).click(function(e){$(".multipleQualityItem").removeClass("selected"),$(".multipleQualityItem."+this.data.toString()).addClass("selected"),paella.player.videoContainer.setQuality(this.data.index).then(function(){paella.player.controls.hidePopUp(r.getName()),r.setQualityLabel()})})}),i},setQualityLabel:function(){var t=this;paella.player.videoContainer.getCurrentQuality().then(function(e){t.setText(e.shortLabel())})},getButtonItemClass:function(e,t){return"multipleQualityItem "+e+(t?" selected":"")}}),paella.plugins.multipleQualitiesPlugin=new paella.plugins.MultipleQualitiesPlugin,Class("paella.plugins.PIPModePlugin",paella.ButtonPlugin,{getIndex:function(){return 551},getAlignment:function(){return"right"},getSubclass:function(){return"PIPModeButton"},getName:function(){return"es.upv.paella.pipModePlugin"},checkEnabled:function(e){var t=paella.player.videoContainer.masterVideo().video;t&&t.webkitSetPresentationMode?e(!0):e(!1)},getDefaultToolTip:function(){return base.dictionary.translate("Set picture-in-picture mode.")},setup:function(){},action:function(e){var t=paella.player.videoContainer.masterVideo().video;"picture-in-picture"==t.webkitPresentationMode?t.webkitSetPresentationMode("inline"):t.webkitSetPresentationMode("picture-in-picture")}}),paella.plugins.pipModePlugin=new paella.plugins.PIPModePlugin,Class("paella.plugins.PlayPauseButtonPlugin",paella.ButtonPlugin,{playSubclass:"playButton",pauseSubclass:"pauseButton",getAlignment:function(){return"left"},getSubclass:function(){return this.playSubclass},getName:function(){return"es.upv.paella.playPauseButtonPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Play")},getIndex:function(){return 110},checkEnabled:function(e){e(!paella.player.isLiveStream()||base.userAgent.system.Android||base.userAgent.system.iOS)},setup:function(){var t=this;paella.player.playing()&&this.changeSubclass(t.pauseSubclass),paella.events.bind(paella.events.play,function(e){t.changeSubclass(t.pauseSubclass),t.setToolTip(paella.dictionary.translate("Pause"))}),paella.events.bind(paella.events.pause,function(e){t.changeSubclass(t.playSubclass),t.setToolTip(paella.dictionary.translate("Play"))})},action:function(e){paella.player.videoContainer.paused().then(function(e){e?paella.player.play():paella.player.pause()})}}),paella.plugins.playPauseButtonPlugn=new paella.plugins.PlayPauseButtonPlugin,Class("paella.plugins.PlayButtonOnScreen",paella.EventDrivenPlugin,{containerId:"paella_plugin_PlayButtonOnScreen",container:null,enabled:!0,isPlaying:!1,showIcon:!0,firstPlay:!1,checkEnabled:function(e){e(!0)},getIndex:function(){return 1010},getName:function(){return"es.upv.paella.playButtonOnScreenPlugin"},setup:function(){var i=this;this.container=document.createElement("div"),this.container.className="playButtonOnScreen",this.container.id=this.containerId,this.container.style.width="100%",this.container.style.height="100%",paella.player.videoContainer.domElement.appendChild(this.container),$(this.container).click(function(e){i.onPlayButtonClick()});var r=document.createElement("canvas");function e(){var e=jQuery(i.container).innerWidth(),t=jQuery(i.container).innerHeight(),n=(r.width=e)<(r.height=t)?e/3:t/3,a=r.getContext("2d");a.translate((e-n)/2,(t-n)/2),a.beginPath(),a.arc(n/2,n/2,n/2,0,2*Math.PI,!0),a.closePath(),a.strokeStyle="white",a.lineWidth=10,a.stroke(),a.fillStyle="#8f8f8f",a.fill(),a.beginPath(),a.moveTo(n/3,n/4),a.lineTo(3*n/4,n/2),a.lineTo(n/3,3*n/4),a.lineTo(n/3,n/4),a.closePath(),a.fillStyle="white",a.fill(),a.stroke()}r.className="playButtonOnScreenIcon",this.container.appendChild(r),paella.events.bind(paella.events.resize,e),e()},getEvents:function(){return[paella.events.endVideo,paella.events.play,paella.events.pause,paella.events.timeUpdate]},onEvent:function(e,t){switch(e){case paella.events.endVideo:this.endVideo();break;case paella.events.play:this.isPlaying=!0,this.showIcon=!1;break;case paella.events.pause:this.isPlaying=!1;break;case paella.events.timeUpdate:this.isPlaying=!0,this.showIcon=!1}this.checkStatus()},onPlayButtonClick:function(){this.firstPlay=!0,this.checkStatus()},endVideo:function(){this.isPlaying=!1,this.checkStatus()},checkStatus:function(){this.enabled&&this.isPlaying||!this.enabled||!this.showIcon?$(this.container).hide():$(this.container).show()}}),new paella.plugins.PlayButtonOnScreen,Class("paella.plugins.PlaybackRate",paella.ButtonPlugin,{buttonItems:null,buttons:[],selected_button:null,defaultRate:null,_domElement:null,available_rates:null,getAlignment:function(){return"left"},getSubclass:function(){return"showPlaybackRateButton"},getIndex:function(){return 140},getMinWindowSize:function(){return 500},getName:function(){return"es.upv.paella.playbackRatePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Set playback rate")},checkEnabled:function(e){e(!base.userAgent.browser.IsMobileVersion&&null!=dynamic_cast("paella.Html5Video",paella.player.videoContainer.masterVideo()))},closeOnMouseOut:function(){return!0},setup:function(){this.defaultRate=1,this.available_rates=this.config.availableRates||[.75,1,1.25,1.5]},buildContent:function(t){var n=this;n._domElement=t,this.buttonItems={},this.available_rates.forEach(function(e){t.appendChild(n.getItemButton(e+"x",e))})},getItemButton:function(e,t){var n=document.createElement("div");return n.className=1==t?this.getButtonItemClass(e,!0):this.getButtonItemClass(e,!1),n.id=e+"_button",n.innerText=e,n.data={label:e,rate:t,plugin:this},$(n).click(function(e){this.data.plugin.onItemClick(this,this.data.label,this.data.rate)}),n},onItemClick:function(e,t,n){paella.player.videoContainer.setPlaybackRate(n),this.setText(t),paella.player.controls.hidePopUp(this.getName());for(var a=this._domElement.children,i=0;i<a.length;i++)a[i].className=this.getButtonItemClass(i,!1);e.className=this.getButtonItemClass(i,!0)},getText:function(){return"1x"},getProfileItemButton:function(e,t){var n=document.createElement("div");return n.className=this.getButtonItemClass(e,!1),n.id=e+"_button",n.data={profile:e,profileData:t,plugin:this},$(n).click(function(e){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),n},getButtonItemClass:function(e,t){return"playbackRateItem "+e+(t?" selected":"")}}),paella.plugins.playbackRate=new paella.plugins.PlaybackRate,Class("paella.plugins.RatePlugin",paella.ButtonPlugin,{buttonItems:null,buttons:[],selected_button:null,score:0,count:0,myScore:0,canVote:!1,scoreContainer:{header:null,rateButtons:null},getAlignment:function(){return"right"},getSubclass:function(){return"rateButtonPlugin"},getIndex:function(){return 540},getMinWindowSize:function(){return 500},getName:function(){return"es.upv.paella.ratePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Rate this video")},checkEnabled:function(n){var a=this;paella.data.read("rate",{id:paella.initDelegate.getId()},function(e,t){e&&"object"==$traceurRuntime.typeof(e)&&(a.score=Number(e.mean).toFixed(1),a.count=e.count,a.myScore=e.myScore,a.canVote=e.canVote),n(t)})},setup:function(){},setScore:function(e){this.score=e,this.updateScore()},closeOnMouseOut:function(){return!0},updateHeader:function(){var e=base.dictionary.translate("Not rated");0<this.count&&(e='<i class="glyphicon glyphicon-star"></i>',e+=" "+this.score+", "+this.count+" "+base.dictionary.translate("votes")),this.scoreContainer.header.innerHTML="\n\t\t<div>\n\t\t\t<h4>"+base.dictionary.translate("Video score")+":</h4>\n\t\t\t<h5>\n\t\t\t\t"+e+"\n\t\t\t</h5>\n\t\t\t</h4>\n\t\t\t<h4>"+base.dictionary.translate("Vote:")+"</h4>\n\t\t</div>\n\t\t"},updateRateButtons:function(){if(this.scoreContainer.rateButtons.className="rateButtons",this.buttons=[],this.canVote){this.scoreContainer.rateButtons.innerText="";for(var e=0;e<5;++e){var t=this.getStarButton(e+1);this.buttons.push(t),this.scoreContainer.rateButtons.appendChild(t)}}else this.scoreContainer.rateButtons.innerHTML="<h5>"+base.dictionary.translate("Login to vote")+"</h5>";this.updateVote()},buildContent:function(e){this._domElement=e;var t=document.createElement("div");e.appendChild(t),t.className="rateContainerHeader",this.scoreContainer.header=t,this.updateHeader();var n=document.createElement("div");this.scoreContainer.rateButtons=n,e.appendChild(n),this.updateRateButtons()},getStarButton:function(e){var t=this,n=document.createElement("i");return n.data={score:e,active:!1},n.className="starButton glyphicon glyphicon-star-empty",$(n).click(function(e){t.vote(this.data.score)}),n},vote:function(e){var n=this;this.myScore=e;var t={mean:this.score,count:this.count,myScore:e,canVote:this.canVote};paella.data.write("rate",{id:paella.initDelegate.getId()},t,function(e){paella.data.read("rate",{id:paella.initDelegate.getId()},function(e,t){e&&"object"==$traceurRuntime.typeof(e)&&(n.score=Number(e.mean).toFixed(1),n.count=e.count,n.myScore=e.myScore,n.canVote=e.canVote),n.updateHeader(),n.updateRateButtons()})})},updateVote:function(){var n=this;this.buttons.forEach(function(e,t){e.className=t<n.myScore?"starButton glyphicon glyphicon-star":"starButton glyphicon glyphicon-star-empty"})}}),paella.plugins.ratePlugin=new paella.plugins.RatePlugin,Class("paella.RTMPVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_duration:0,_paused:!0,_flashId:null,_swfContainer:null,_flashVideo:null,_volume:1,initialize:function(e,t,n,a,i,r){this.parent(e,t,"div",n,a,i,r),this._flashId=e+"Movie";var l=this;this._stream.sources.rtmp.sort(function(e,t){return e.res.h-t.res.h});var o=function(e,t){t=t.split(",");for(var n={},a=0;a<t.length;++a){var i=t[a].split(":"),r=i[0],o=i[1];"NaN"==o?o=NaN:/^true$/i.test(o)?o=!0:/^false$/i.test(o)?o=!1:isNaN(parseFloat(o))||(o=parseFloat(o)),n[r]=o}!function(e,t){if("loadedmetadata"==e||"pause"==e||l._isReady||(l._isReady=!0,l._duration=t.duration,$(l.swfContainer).trigger("paella:flashvideoready")),"progress"==e){try{l.flashVideo.setVolume(l._volume)}catch(e){}base.log.debug("Flash video event: "+e+", progress: "+l.flashVideo.currentProgress())}else"ended"==e?(base.log.debug("Flash video event: "+e),paella.events.trigger(paella.events.pause),paella.player.controls.showControls()):base.log.debug("Flash video event: "+e)}(e,n)};paella.events.bind(paella.events.flashVideoEvent,function(e,t){l.flashId==t.source&&o(t.eventName,t.values)}),Object.defineProperty(this,"swfContainer",{get:function(){return l._swfContainer}}),Object.defineProperty(this,"flashId",{get:function(){return l._flashId}}),Object.defineProperty(this,"flashVideo",{get:function(){return l._flashVideo}})},_createSwfObject:function(e,t){var n=this.identifier,a=document.createElement("div");if(this.domElement.appendChild(a),a.id=n+"Movie",this._swfContainer=a,swfobject.hasFlashPlayerVersion("9.0.0"))swfobject.embedSWF(e,a.id,"100%","100%","9.0.0","",t,{wmode:"transparent"},null,function(e){if(0==e.success){var t=document.createElement("div"),n=document.createElement("h3");n.innerText=base.dictionary.translate("Flash player problem");var a=document.createElement("div");a.innerHTML=base.dictionary.translate("A problem occurred trying to load flash player.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>")+"<br>"+base.dictionary.translate("If the problem presist, contact us.");var i=document.createElement("a");i.setAttribute("href","http://www.adobe.com/go/getflash"),i.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',t.appendChild(n),t.appendChild(a),t.appendChild(i),paella.messageBox.showError(t.innerHTML)}});else{var i=document.createElement("div"),r=document.createElement("h3");r.innerText=base.dictionary.translate("Flash player needed");var o=document.createElement("div");o.innerHTML=base.dictionary.translate("You need at least Flash player 9 installed.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>");var l=document.createElement("a");l.setAttribute("href","http://www.adobe.com/go/getflash"),l.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',i.appendChild(r),i.appendChild(o),i.appendChild(l),paella.messageBox.showError(i.innerHTML)}return $("#"+a.id)[0]},_deferredAction:function(n){var a=this;return new Promise(function(e,t){a.ready?e(n()):$(a.swfContainer).bind("paella:flashvideoready",function(){a._ready=!0,e(n())})})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},getVideoData:function(){var n=this,a=this;return new Promise(function(t,e){n._deferredAction(function(){var e={duration:a.flashVideo.duration(),currentTime:a.flashVideo.getCurrentTime(),volume:a.flashVideo.getVolume(),paused:a._paused,ended:a._ended,res:{w:a.flashVideo.getWidth(),h:a.flashVideo.getHeight()}};t(e)})})},setPosterFrame:function(e){if(null==this._posterFrame){this._posterFrame=e;var t=document.createElement("img");t.src=e,t.className="videoPosterFrameImage",t.alt="poster frame",this.domElement.appendChild(t),this._posterFrameElement=t}},setAutoplay:function(e){this._autoplay=e},load:function(){var e=this._stream.sources.rtmp;null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(e));var t,n=this._currentQuality<e.length?e[this._currentQuality]:null;if(n){if((t=n).src&&"object"==$traceurRuntime.typeof(t.src)&&t.src.server&&t.src.stream){var a=!1;void 0===n.src.requiresSubscription&&paella.player.config.player.rtmpSettings?a=paella.player.config.player.rtmpSettings.requiresSubscription||!1:n.src.requiresSubscription&&(a=n.src.requiresSubscription);var i={};return this._autoplay&&(i.autoplay=this._autoplay),"true"==base.parameters.get("debug")&&(i.debugMode=!0),i.playerId=this.flashId,i.isLiveStream=void 0!==n.isLiveStream&&n.isLiveStream,i.server=n.src.server,i.stream=n.src.stream,i.subscribe=a,paella.player.config.player.rtmpSettings&&void 0!==paella.player.config.player.rtmpSettings.bufferTime&&(i.bufferTime=paella.player.config.player.rtmpSettings.bufferTime),this._flashVideo=this._createSwfObject("resources/deps/player_streaming.swf",i),$(this.swfContainer).trigger("paella:flashvideoready"),this._deferredAction(function(){return n})}return paella_DeferredRejected(new Error("Invalid video data"))}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},getQualities:function(){var i=this;return new Promise(function(a,e){setTimeout(function(){var t=[],e=i._stream.sources.rtmp,n=-1;e.forEach(function(e){n++,t.push(i._getQualityObject(n,e))}),a(t)},50)})},setQuality:function(a){var i=this;return a=null!=a?a:0,new Promise(function(e,t){i._paused;var n=i._stream.sources.rtmp;if(i._currentQuality=a<n.length?a:0,n[a].isLiveStream)return e();i._currentTime;i.load().then(function(){e()})})},getCurrentQuality:function(){var n=this;return new Promise(function(e,t){e(n._getQualityObject(n._currentQuality,n._stream.sources.rtmp[n._currentQuality]))})},play:function(){var e=this;return this._deferredAction(function(){e._posterFrameElement&&(e._posterFrameElement.parentNode.removeChild(e._posterFrameElement),e._posterFrameElement=null),e._paused=!1,e.flashVideo.play()})},pause:function(){var e=this;return this._deferredAction(function(){e._paused=!0,e.flashVideo.pause()})},isPaused:function(){var e=this;return this._deferredAction(function(){return e._paused})},duration:function(){var e=this;return this._deferredAction(function(){return e.flashVideo.duration()})},setCurrentTime:function(t){var n=this;return this._deferredAction(function(){var e=n.flashVideo.duration();n.flashVideo.seekTo(100*t/e)})},currentTime:function(){var e=this;return this._deferredAction(function(){return e.flashVideo.getCurrentTime()})},setVolume:function(e){var t=this;return this._volume=e,this._deferredAction(function(){t.flashVideo.setVolume(e)})},volume:function(){var e=this;return this._deferredAction(function(){return e.flashVideo.getVolume()})},setPlaybackRate:function(e){var t=this;return this._deferredAction(function(){t._playbackRate=e})},playbackRate:function(){var e=this;return this._deferredAction(function(){return e._playbackRate})},goFullScreen:function(){return paella_DeferredNotImplemented()},unFreeze:function(){return this._deferredAction(function(){})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.RTMPVideoFactory",{isStreamCompatible:function(e){try{if(base.userAgent.system.iOS||base.userAgent.system.Android)return!1;for(var t in e.sources)if("rtmp"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,n){return new paella.RTMPVideo(e,t,n.x,n.y,n.w,n.h)}}),Class("paella.plugins.CaptionsSearchPlugIn",paella.SearchServicePlugIn,{getName:function(){return"es.upv.paella.search.captionsSearchPlugin"},search:function(e,t){paella.captions.search(e,t)}}),new paella.plugins.CaptionsSearchPlugIn,Class("paella.plugins.SearchPlugin",paella.ButtonPlugin,{_open:!1,_sortDefault:"time",_colorSearch:!1,_localImages:null,_searchTimer:null,_searchTimerTime:1500,_searchBody:null,getAlignment:function(){return"right"},getSubclass:function(){return"searchButton"},getMinWindowSize:function(){return 550},getName:function(){return"es.upv.paella.searchPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Search")},getIndex:function(){return 510},closeOnMouseOut:function(){return!0},checkEnabled:function(e){e(!0)},setup:function(){var t=this;$(".searchButton").click(function(e){t._open?t._open=!1:(t._open=!0,setTimeout(function(){$("#searchBarInput").focus()},0))}),t._localImages=paella.initDelegate.initParams.videoLoader.frameList,t._colorSearch=t.config.colorSearch||!1,t._sortDefault=t.config.sortType||"time",paella.events.bind(paella.events.controlBarWillHide,function(e){t._open&&paella.player.controls.cancelHideBar()})},prettyTime:function(e){var t=Math.floor(e/3600)%24;t=("00"+t).slice(t.toString().length);var n=Math.floor(e/60)%60;n=("00"+n).slice(n.toString().length);var a=Math.floor(e%60);return t+":"+n+":"+(a=("00"+a).slice(a.toString().length))},search:function(e,t){paella.searchService.search(e,t)},getPreviewImage:function(e){var t=Object.keys(this._localImages);t.push(e),t.sort(function(e,t){return parseInt(e)-parseInt(t)});var n=t.indexOf(e)-1,a=t[n=0<n?n:0];return a=parseInt(a),this._localImages[a].url},createLoadingElement:function(e){var t=document.createElement("div");t.className="loader";t.innerHTML='<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve"><path fill="#000" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z"><animateTransform attributeType="xml"attributeName="transform"type="rotate"from="0 25 25"to="360 25 25"dur="0.6s"repeatCount="indefinite"/></path></svg>',e.appendChild(t);var n=document.createElement("p");n.className="sBodyText",n.innerText=base.dictionary.translate("Searching")+"...",e.appendChild(n)},createNotResultsFound:function(e){var t=document.createElement("div");t.className="noResults",t.innerText=base.dictionary.translate("Sorry! No results found."),e.appendChild(t)},doSearch:function(e,l){var s=this;$(l).empty(),s.createLoadingElement(l),s.search(e,function(e,t){if($(l).empty(),!e)if(0==t.length)s.createNotResultsFound(l);else for(var n=0;n<t.length;n++){"score"==s._sortDefault&&t.sort(function(e,t){return t.score-e.score}),"time"==s._sortDefault&&t.sort(function(e,t){return e.time-t.time});var a=document.createElement("div");a.className="sBodyInnerContainer",s._colorSearch&&(t[n].score<=.3&&$(a).addClass("redScore"),.7<=t[n].score&&$(a).addClass("greenScore"));var i=document.createElement("div");i.className="TimePicContainer";var r=document.createElement("img");r.className="sBodyPicture",r.src=s.getPreviewImage(t[n].time);var o=document.createElement("p");o.className="sBodyText",o.innerHTML="<span class='timeSpan'>"+s.prettyTime(t[n].time)+"</span>"+paella.AntiXSS.htmlEscape(t[n].content),i.appendChild(r),a.appendChild(i),a.appendChild(o),l.appendChild(a),a.setAttribute("sec",t[n].time),$(a).hover(function(){$(this).css("background-color","#faa166")},function(){$(this).removeAttr("style")}),$(a).click(function(){var e=$(this).attr("sec");paella.player.videoContainer.seekToTime(e),paella.player.play()})}})},buildContent:function(e){var n=this,t=document.createElement("div");t.className="searchPluginContainer";var a=document.createElement("div");a.className="searchBody",t.appendChild(a),n._searchBody=a;var i=document.createElement("div");i.className="searchBar",t.appendChild(i);var r=document.createElement("input");r.className="searchBarInput",r.type="text",r.id="searchBarInput",r.name="searchString",r.placeholder=base.dictionary.translate("Search"),i.appendChild(r),$(r).change(function(){var e=$(r).val();null!=n._searchTimer&&n._searchTimer.cancel(),""!=e&&n.doSearch(e,a)}),$(r).keyup(function(e){if(13!=e.keyCode){var t=$(r).val();null!=n._searchTimer&&n._searchTimer.cancel(),""!=t?n._searchTimer=new base.Timer(function(e){n.doSearch(t,a)},n._searchTimerTime):$(n._searchBody).empty()}}),$(r).focus(function(){paella.keyManager.enabled=!1}),$(r).focusout(function(){paella.keyManager.enabled=!0}),e.appendChild(t)}}),paella.plugins.searchPlugin=new paella.plugins.SearchPlugin,Class("paella.plugins.SocialPlugin",paella.ButtonPlugin,{buttonItems:null,socialMedia:null,getAlignment:function(){return"right"},getSubclass:function(){return"showSocialPluginButton"},getIndex:function(){return 560},getMinWindowSize:function(){return 600},getName:function(){return"es.upv.paella.socialPlugin"},checkEnabled:function(e){e(!0)},getDefaultToolTip:function(){return base.dictionary.translate("Share this video")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buttons:[],selected_button:null,closeOnMouseOut:function(){return!0},initialize:function(){if(this.parent(),"es"==base.dictionary.currentLanguage()){base.dictionary.addDictionary({"Custom size:":"Tamaño personalizado:","Choose your embed size. Copy the text and paste it in your html page.":"Elija el tamaño del video a embeber. Copie el texto y péguelo en su página html.","Width:":"Ancho:","Height:":"Alto:"})}},setup:function(){var t=this,n=13,a=38,i=40;$(this.button).keyup(function(e){t.isPopUpOpen()&&(e.keyCode==a?0<t.selected_button&&(t.selected_button<t.buttons.length&&(t.buttons[t.selected_button].className="socialItemButton "+t.buttons[t.selected_button].data.mediaData),t.selected_button--,t.buttons[t.selected_button].className=t.buttons[t.selected_button].className+" selected"):e.keyCode==i?t.selected_button<t.buttons.length-1&&(0<=t.selected_button&&(t.buttons[t.selected_button].className="socialItemButton "+t.buttons[t.selected_button].data.mediaData),t.selected_button++,t.buttons[t.selected_button].className=t.buttons[t.selected_button].className+" selected"):e.keyCode==n&&t.onItemClick(t.buttons[t.selected_button].data.mediaData))})},buildContent:function(n){var a=this;this.buttonItems={},this.socialMedia=["facebook","twitter","embed"],this.socialMedia.forEach(function(e){var t=a.getSocialMediaItemButton(e);a.buttonItems[a.socialMedia.indexOf(e)]=t,n.appendChild(t),a.buttons.push(t)}),this.selected_button=this.buttons.length},getSocialMediaItemButton:function(e){var t=document.createElement("div");return t.className="socialItemButton "+e,t.id=e+"_button",t.data={mediaData:e,plugin:this},$(t).click(function(e){this.data.plugin.onItemClick(this.data.mediaData)}),t},onItemClick:function(e){var t=this.getVideoUrl();switch(e){case"twitter":window.open("http://twitter.com/home?status="+t);break;case"facebook":window.open("http://www.facebook.com/sharer.php?u="+t);break;case"embed":this.embedPress()}paella.player.controls.hidePopUp(this.getName())},getVideoUrl:function(){return document.location.href},embedPress:function(){var e=document.location.protocol+"//"+document.location.host,t=document.location.pathname.split("/");0<t.length&&(t[t.length-1]="embed.html");var n=paella.initDelegate.getId(),a=e+t.join("/")+"?id="+n,i="<div id='embedContent' style='text-align:left; font-size:14px; color:black;'><div id=''>"+("<div style='display:inline-block;'>     <div class='embedSizeButton' style='width:110px; height:73px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 620x349 </span></div>    <div class='embedSizeButton' style='width:100px; height:65px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 540x304 </span></div>    <div class='embedSizeButton' style='width:90px;  height:58px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 460x259 </span></div>    <div class='embedSizeButton' style='width:80px;  height:50px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 380x214 </span></div>    <div class='embedSizeButton' style='width:70px;  height:42px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 300x169 </span></div></div><div style='display:inline-block; vertical-align:bottom; margin-left:10px;'>    <div>"+base.dictionary.translate("Custom size:")+"</div>    <div>"+base.dictionary.translate("Width:")+" <input id='social_embed_width-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div>    <div>"+base.dictionary.translate("Height:")+" <input id='social_embed_height-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div></div>")+"</div> <div id=''>"+base.dictionary.translate("Choose your embed size. Copy the text and paste it in your html page.")+"</div> <div id=''><textarea id='social_embed-textarea' class='social_embed-textarea' rows='4' cols='1' style='font-size:12px; width:95%; overflow:auto; margin-top:5px; color:black;'></textarea></div>  </div>";paella.messageBox.showMessage(i,{closeButton:!0,width:"750px",height:"210px",onClose:function(){}});var r=$("#social_embed_width-input")[0],o=$("#social_embed_height-input")[0];r.onkeyup=function(e){var t=parseInt(r.value),n=parseInt(o.value);isNaN(t)?r.value="":$("#social_embed-textarea")[0].value=t<300?"Embed width too low. The minimum value is a width of 300.":(isNaN(n)&&(n=(t/(16/9)).toFixed(),o.value=n),'<iframe allowfullscreen src="'+a+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+t+'" height="'+n+'"></iframe>')};for(var l=$(".embedSizeButton"),s=0;s<l.length;s+=1){l[s].onclick=function(e){var t=e.target?e.target.textContent:e.toElement.textContent;if(t){var n=t.trim().split("x");r.value=n[0],o.value=n[1],$("#social_embed-textarea")[0].value='<iframe allowfullscreen src="'+a+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+n[0]+'" height="'+n[1]+'"></iframe>'}}}}}),paella.plugins.socialPlugin=new paella.plugins.SocialPlugin;var MyTabBarExamplePlugin=Class.create(paella.TabBarPlugin,{getSubclass:function(){return"test"},getTabName:function(){return"TabBar Example"},getName:function(){return"es.upv.paella.test.tabBarExamplePlugin"},buildContent:function(e){e.innerHTML="<p>This is a Paella Extended tab bar plugin</p>"}});function buildVideo360Canvas(e,t){var n,a=new(n=bg.app.WindowController,$traceurRuntime.createClass(function e(t){$traceurRuntime.superConstructor(e).call(this),this.stream=t},{get video(){return this.texture?this.texture.video:null},loaded:function(){var n=this;return new Promise(function(e){var t=function(){n.video?e(n):setTimeout(t,100)};t()})},buildScene:function(){var a=this;this._root=new bg.scene.Node(this.gl,"Root node"),bg.base.Loader.RegisterPlugin(new bg.base.TextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VWGLBLoaderPlugin),bg.base.Loader.Load(this.gl,this.stream.src).then(function(e){a.texture=e;var t=bg.scene.PrimitiveFactory.Sphere(a.gl,1,50),n=new bg.scene.Node(a.gl);n.addComponent(t),t.getMaterial(0).texture=e,t.getMaterial(0).lightEmission=1,t.getMaterial(0).lightEmissionMaskInvert=!0,t.getMaterial(0).cullFace=!1,a._root.addChild(n),a.postRedisplay()});var e=new bg.scene.Node(this.gl,"Light");this._root.addChild(e),this._camera=new bg.scene.Camera;var t=new bg.scene.Node("Camera");t.addComponent(this._camera),t.addComponent(new bg.scene.Transform);var n=new bg.manipulation.OrbitCameraController;t.addComponent(n),n.maxPitch=90,n.minPitch=-90,n.maxDistance=0,n.minDistace=0,this._root.addChild(t)},init:function(){bg.Engine.Set(new bg.webgl1.Engine(this.gl)),this.buildScene(),this._renderer=bg.render.Renderer.Create(this.gl,bg.render.RenderPath.FORWARD),this._inputVisitor=new bg.scene.InputVisitor},frame:function(e){this.texture&&this.texture.update(),this._renderer.frame(this._root,e)},display:function(){this._renderer.display(this._root,this._camera)},reshape:function(e,t){this._camera.viewport=new bg.Viewport(0,0,e,t),this._camera.projection.perspective(60,this._camera.viewport.aspectRatio,.1,100)},mouseDown:function(e){this._inputVisitor.mouseDown(this._root,e)},mouseDrag:function(e){this._inputVisitor.mouseDrag(this._root,e),this.postRedisplay()},mouseWheel:function(e){this._inputVisitor.mouseWheel(this._root,e),this.postRedisplay()},touchStart:function(e){this._inputVisitor.touchStart(this._root,e)},touchMove:function(e){this._inputVisitor.touchMove(this._root,e),this.postRedisplay()},mouseUp:function(e){this._inputVisitor.mouseUp(this._root,e)},mouseMove:function(e){this._inputVisitor.mouseMove(this._root,e)},mouseOut:function(e){this._inputVisitor.mouseOut(this._root,e)},touchEnd:function(e){this._inputVisitor.touchEnd(this._root,e)}},{},n))(e),i=bg.app.MainLoop.singleton;return i.updateMode=bg.app.FrameUpdate.AUTO,i.canvas=t,i.run(a),a.loaded()}function buildVideo360ThetaCanvas(e,t){function S(e,t,n){var a,i,r,o,l,s,u=(a=((e+90)/180-1)*Math.PI,i=(.5-t/180)*Math.PI,new bg.Vector3(Math.cos(i)*Math.cos(a),Math.cos(i)*Math.sin(a),Math.sin(i))),c=(r=Math.sin(-.5*Math.PI)*u.z+Math.cos(-.5*Math.PI)*u.x,o=u.y,l=Math.cos(-.5*Math.PI)*u.z-Math.sin(-.5*Math.PI)*u.x,(s=l)<-1?s=-1:1<l&&(s=1),new bg.Vector2(Math.atan2(o,r),Math.acos(s)/Math.PI)),d=.784888888888881,p=.55555555555556,m=0===n?.883*c.y*Math.cos(c.x)*.5+.25:.883*(1-c.y)*Math.cos(-1*c.x+Math.PI)*.5+.75,h=0===n?d*c.y*Math.sin(c.x)+p:d*(1-c.y)*Math.sin(-1*c.x+Math.PI)+p;return new bg.Vector2(m,h)}var n,a=new(n=bg.app.WindowController,$traceurRuntime.createClass(function e(t){$traceurRuntime.superConstructor(e).call(this),this.stream=t},{get video(){return this.texture?this.texture.video:null},loaded:function(){var n=this;return new Promise(function(e){var t=function(){n.video?e(n):setTimeout(t,100)};t()})},buildScene:function(){var a=this;this._root=new bg.scene.Node(this.gl,"Root node"),bg.base.Loader.RegisterPlugin(new bg.base.TextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VideoTextureLoaderPlugin),bg.base.Loader.RegisterPlugin(new bg.base.VWGLBLoaderPlugin),bg.base.Loader.Load(this.gl,this.stream.src).then(function(e){a.texture=e;var t=function(e){var t=new bg.scene.Node(e),n=new bg.scene.Drawable;t.addComponent(n);for(var u=new bg.base.PolyList(e),a=[],i=[],r=[],o=0;o<=180;o+=5){for(var l=0;l<=360;l+=5)a.push(new bg.Vector3(Math.sin(Math.PI*o/180)*Math.sin(Math.PI*l/180)*1,1*Math.cos(Math.PI*o/180),Math.sin(Math.PI*o/180)*Math.cos(Math.PI*l/180)*1)),i.push(new bg.Vector3(0,0,-1));for(var s=0;s<=180;s+=5)r.push(S(s,o,0));for(var c=180;c<=360;c+=5)r.push(S(c,o,1))}function d(e,t,n,a,i,r,o,l,s){u.vertex.push(e.x),u.vertex.push(e.y),u.vertex.push(e.z),u.vertex.push(t.x),u.vertex.push(t.y),u.vertex.push(t.z),u.vertex.push(n.x),u.vertex.push(n.y),u.vertex.push(n.z),u.normal.push(a.x),u.normal.push(a.y),u.normal.push(a.z),u.normal.push(i.x),u.normal.push(i.y),u.normal.push(i.z),u.normal.push(r.x),u.normal.push(r.z),u.normal.push(r.z),u.texCoord0.push(o.x),u.texCoord0.push(o.y),u.texCoord0.push(l.x),u.texCoord0.push(l.y),u.texCoord0.push(s.x),u.texCoord0.push(s.y),u.index.push(u.index.length),u.index.push(u.index.length),u.index.push(u.index.length)}for(var p=0;p<36;p++)for(var m=0;m<72;m++){var h=73*p+m,f=m<36?74*p+m:74*p+m+1;r[f+0],r[f+1],r[f+74],r[f+1],r[f+75],r[f+74];var g=a[h+0],v=i[h+0],y=r[f+0],b=a[h+1],A=i[h+1],_=r[f+1],C=a[h+73],w=i[h+73],P=r[f+74],E=a[h+74],T=i[h+74],k=r[f+75];d(g,b,C,v,A,w,y,_,P),d(b,E,C,A,T,w,_,k,P)}u.build(),n.addPolyList(u);var x=bg.Matrix4.Scale(-1,1,1);return t.addComponent(new bg.scene.Transform(x)),t}(a.gl),n=t.component("bg.scene.Drawable");n.getMaterial(0).texture=e,n.getMaterial(0).lightEmission=1,n.getMaterial(0).lightEmissionMaskInvert=!0,n.getMaterial(0).cullFace=!1,a._root.addChild(t),a.postRedisplay()});var e=new bg.scene.Node(this.gl,"Light");this._root.addChild(e),this._camera=new bg.scene.Camera;var t=new bg.scene.Node("Camera");t.addComponent(this._camera),t.addComponent(new bg.scene.Transform);var n=new bg.manipulation.OrbitCameraController;t.addComponent(n),n.maxPitch=90,n.minPitch=-90,n.maxDistance=0,n.minDistace=0,this._root.addChild(t)},init:function(){bg.Engine.Set(new bg.webgl1.Engine(this.gl)),this.buildScene(),this._renderer=bg.render.Renderer.Create(this.gl,bg.render.RenderPath.FORWARD),this._inputVisitor=new bg.scene.InputVisitor},frame:function(e){this.texture&&this.texture.update(),this._renderer.frame(this._root,e)},display:function(){this._renderer.display(this._root,this._camera)},reshape:function(e,t){this._camera.viewport=new bg.Viewport(0,0,e,t),this._camera.projection.perspective(60,this._camera.viewport.aspectRatio,.1,100)},mouseDown:function(e){this._inputVisitor.mouseDown(this._root,e)},mouseDrag:function(e){this._inputVisitor.mouseDrag(this._root,e),this.postRedisplay()},mouseWheel:function(e){this._inputVisitor.mouseWheel(this._root,e),this.postRedisplay()},touchStart:function(e){this._inputVisitor.touchStart(this._root,e)},touchMove:function(e){this._inputVisitor.touchMove(this._root,e),this.postRedisplay()},mouseUp:function(e){this._inputVisitor.mouseUp(this._root,e)},mouseMove:function(e){this._inputVisitor.mouseMove(this._root,e)},mouseOut:function(e){this._inputVisitor.mouseOut(this._root,e)},touchEnd:function(e){this._inputVisitor.touchEnd(this._root,e)}},{},n))(e),i=bg.app.MainLoop.singleton;return i.updateMode=bg.app.FrameUpdate.AUTO,i.canvas=t,i.run(a),a.loaded()}function onYouTubeIframeAPIReady(){paella.youtubePlayerVars.apiReadyPromise.resolve()}new MyTabBarExamplePlugin,Class("paella.plugins.VideoLoadTestPlugin",paella.EventDrivenPlugin,{startTime:0,endTime:0,initialize:function(){if(this.parent(),this.startTime=Date.now(),"es"==base.dictionary.currentLanguage()){base.dictionary.addDictionary({"Video loaded in {0} seconds":"Video cargado en {0} segundos"})}},getName:function(){return"es.upv.paella.test.videoLoadPlugin"},checkEnabled:function(e){e(!0)},getEvents:function(){return[paella.events.loadComplete]},onEvent:function(e,t){switch(e){case paella.events.loadComplete:this.onLoadComplete()}},onLoadComplete:function(){this.endTime=Date.now();var e=(this.endTime-this.startTime)/1e3;this.showOverlayMessage(base.dictionary.translate("Video loaded in {0} seconds").replace(/\{0\}/g,e))},showOverlayMessage:function(e){var t=paella.player.videoContainer.overlayContainer,n=document.createElement("div");n.className="videoLoadTestOverlay";var a=document.createElement("div");a.className="btn",a.innerText="X",a.onclick=function(){t.removeElement(n)};var i=document.createElement("div");i.className="videoLoadTest",i.innerHTML=e,i.appendChild(a),n.appendChild(i),t.addElement(n,{left:40,top:50,width:430,height:80})}}),paella.plugins.videoLoadTestPlugin=new paella.plugins.VideoLoadTestPlugin,Class("paella.plugins.ThemeChooserPlugin",paella.ButtonPlugin,{currentUrl:null,currentMaster:null,currentSlave:null,availableMasters:[],availableSlaves:[],getAlignment:function(){return"right"},getSubclass:function(){return"themeChooserPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 600},getName:function(){return"es.upv.paella.themeChooserPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Change theme")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},checkEnabled:function(e){paella.player.config.skin&&paella.player.config.skin.available&&paella.player.config.skin.available instanceof Array&&0<paella.player.config.skin.available.length?e(!0):e(!1)},buildContent:function(n){var a=this;paella.player.config.skin.available.forEach(function(t){var e=document.createElement("div");e.className="themebutton",e.innerText=t.replace("-"," ").replace("_"," "),$(e).click(function(e){paella.utils.skin.set(t),paella.player.controls.hidePopUp(a.getName())}),n.appendChild(e)})}}),paella.plugins.themeChooserPlugin=new paella.plugins.ThemeChooserPlugin,paella.plugins.translectures={},Class("paella.captions.translectures.Caption",paella.captions.Caption,{initialize:function(e,t,n,a,i,r){this.parent(e,t,n,a,r),this._captionsProvider="translecturesCaptionsProvider",this._editURL=i},canEdit:function(e){e(!1,null!=this._editURL&&""!=this._editURL)},goToEdit:function(){var t=this;paella.player.auth.userData().then(function(e){1==e.isAnonymous?t.askForAnonymousOrLoginEdit():t.doEdit()})},doEdit:function(){window.location.href=this._editURL},doLoginAndEdit:function(){paella.player.auth.login(this._editURL)},askForAnonymousOrLoginEdit:function(){var e=this,t=document.createElement("div");t.className="translecturesCaptionsMessageBox";var n=document.createElement("div");n.className="title",n.innerText=base.dictionary.translate("You are trying to modify the transcriptions, but you are not Logged in!"),t.appendChild(n);var a=document.createElement("div");a.className="authMethodsContainer",t.appendChild(a);var i=document.createElement("div");i.className="authMethod",a.appendChild(i);var r=document.createElement("a");r.href="#",r.style.color="#004488",i.appendChild(r);var o=document.createElement("img");o.src="resources/style/caption_mlangs_anonymous.png",o.alt="Anonymous",o.style.height="100px",r.appendChild(o);var l=document.createElement("p");l.innerText=base.dictionary.translate("Continue editing the transcriptions anonymously"),r.appendChild(l),$(r).click(function(){e.doEdit()}),(i=document.createElement("div")).className="authMethod",a.appendChild(i),(r=document.createElement("a")).href="#",r.style.color="#004488",i.appendChild(r),(o=document.createElement("img")).src="resources/style/caption_mlangs_lock.png",o.alt="Login",o.style.height="100px",r.appendChild(o),(l=document.createElement("p")).innerText=base.dictionary.translate("Log in and edit the transcriptions"),r.appendChild(l),$(r).click(function(){e.doLoginAndEdit()}),paella.messageBox.showElement(t)}}),Class("paella.plugins.translectures.CaptionsPlugIn",paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.translecture.captionsPlugin"},getEvents:function(){return[]},onEvent:function(e,t){},checkEnabled:function(i){var r=this,o=paella.player.videoIdentifier;if(null==this.config.tLServer||null==this.config.tLdb)base.log.warning(this.getName()+" plugin not configured!"),i(!1);else{var l=(this.config.tLServer+"/langs?db=${tLdb}&id=${videoId}").replace(/\$\{videoId\}/gi,o).replace(/\$\{tLdb\}/gi,this.config.tLdb);base.ajax.get({url:l},function(e,t,n,a){0==e.scode?e.langs.forEach(function(e){var t,n=(r.config.tLServer+"/dfxp?format=1&pol=0&db=${tLdb}&id=${videoId}&lang=${tl.lang.code}").replace(/\$\{videoId\}/gi,o).replace(/\$\{tLdb\}/gi,r.config.tLdb).replace(/\$\{tl.lang.code\}/gi,e.code);r.config.tLEdit&&(t=r.config.tLEdit.replace(/\$\{videoId\}/gi,o).replace(/\$\{tLdb\}/gi,r.config.tLdb).replace(/\$\{tl.lang.code\}/gi,e.code));var a=e.value;switch(e.type){case 0:a+=" ("+paella.dictionary.translate("Auto")+")";break;case 1:a+=" ("+paella.dictionary.translate("Under review")+")"}var i=new paella.captions.translectures.Caption(e.code,"dfxp",n,{code:e.code,txt:a},t);paella.captions.addCaptions(i)}):base.log.debug("Error getting available captions from translectures: "+l),i(!1)},function(e,t,n){base.log.debug("Error getting available captions from translectures: "+l),i(!1)})}}}),new paella.plugins.translectures.CaptionsPlugIn,new(Class(paella.userTracking.SaverPlugIn,{type:"userTrackingSaverPlugIn",getName:function(){return"es.upv.paella.usertracking.elasticsearchSaverPlugin"},checkEnabled:function(e){this._url=this.config.url,this._index=this.config.index||"paellaplayer",this._type=this.config.type||"usertracking";var t=!0;null==this._url&&(t=!1,base.log.debug("No ElasticSearch URL found in config file. Disabling ElasticSearch PlugIn")),e(t)},log:function(n,e){var a=this,i=e;"object"!=$traceurRuntime.typeof(i)&&(i={value:i});var r=0;paella.player.videoContainer.currentTime().then(function(e){return r=e,paella.player.videoContainer.paused()}).then(function(e){var t={date:new Date,video:paella.initDelegate.getId(),playing:!e,time:parseInt(r+paella.player.videoContainer.trimStart()),event:n,params:i};paella.ajax.post({url:a._url+"/"+a._index+"/"+a._type+"/",params:JSON.stringify(t)})})}})),new(Class(paella.userTracking.SaverPlugIn,{getName:function(){return"es.upv.paella.usertracking.GoogleAnalyticsSaverPlugin"},checkEnabled:function(e){var t,n,a,i,r,o=this.config.trackingID,l=this.config.domain||"auto";o?(base.log.debug("Google Analitycs Enabled"),t=window,n=document,a="__gaTracker",t.GoogleAnalyticsObject=a,t[a]=t[a]||function(){(t[a].q=t[a].q||[]).push(arguments)},t[a].l=1*new Date,i=n.createElement("script"),r=n.getElementsByTagName("script")[0],i.async=1,i.src="//www.google-analytics.com/analytics.js",r.parentNode.insertBefore(i,r),__gaTracker("create",o,l),__gaTracker("send","pageview"),e(!0)):(base.log.debug("No Google Tracking ID found in config file. Disabling Google Analitycs PlugIn"),e(!1))},log:function(e,t){if(void 0===this.config.category||!0===this.config.category){var n=this.config.category||"PaellaPlayer",a=e,i="";try{i=JSON.stringify(t)}catch(e){}__gaTracker("send","event",n,a,i)}}})),Class("paella.Video360",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(e,t,n,a,i,r,o){this.parent(e,t,"canvas",0,0,1280,720),this._streamName=o||"video360";var l=this;paella.player.videoContainer.disablePlayOnClick(),this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(e,t){return e.res.h-t.res.h}),this.video=null,new paella.Timer(function(e){l.canvasController&&l.canvasController.canvas.domElement},500).repeat=!0},defaultProfile:function(){return"chroma"},_setVideoElem:function(e){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)},_loadDeps:function(){return new Promise(function(e,t){window.$paella_mpd?defer.resolve(window.$paella_mpd):require(["resources/deps/bg2e.js"],function(){window.$paella_bg2e=!0,e(window.$paella_bg2e)})})},_deferredAction:function(n){var a=this;return new Promise(function(e,t){a.video?e(n()):$(a.video).bind("canplay",function(){a._ready=!0,e(n())})})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},allowZoom:function(){return!1},getVideoData:function(){var n=this,a=this;return new Promise(function(e,t){n._deferredAction(function(){e({duration:a.video.duration,currentTime:a.video.currentTime,volume:a.video.volume,paused:a.video.paused,ended:a.video.ended,res:{w:a.video.videoWidth,h:a.video.videoHeight}})})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){(this._autoplay=e)&&this.video&&this.video.setAttribute("autoplay",e)},load:function(){var i=this;return new Promise(function(n,a){i._loadDeps().then(function(){var e=i._stream.sources[i._streamName];null===i._currentQuality&&i._videoQualityStrategy&&(i._currentQuality=i._videoQualityStrategy.getQualityIndex(e));var t=i._currentQuality<e.length?e[i._currentQuality]:null;i.video=null,t?(i.canvasController=null,buildVideo360Canvas(t,i.domElement).then(function(e){i.canvasController=e,i.video=e.video,i.video.pause(),n(t)})):a(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){var i=this;return new Promise(function(a,e){setTimeout(function(){var t=[],e=i._stream.sources[i._streamName],n=-1;e.forEach(function(e){n++,t.push(i._getQualityObject(n,e))}),a(t)},10)})},setQuality:function(i){var r=this;return new Promise(function(e){var t=r.video.paused,n=r._stream.sources[r._streamName];r._currentQuality=i<n.length?i:0;var a=r.video.currentTime;r.freeze().then(function(){return r._ready=!1,r.load()}).then(function(){t||r.play(),$(r.video).on("seeked",function(){r.unFreeze(),e(),$(r.video).off("seeked")}),r.video.currentTime=a})})},getCurrentQuality:function(){var t=this;return new Promise(function(e){e(t._getQualityObject(t._currentQuality,t._stream.sources[t._streamName][t._currentQuality]))})},play:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,e.video.play()})},pause:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,e.video.pause()})},isPaused:function(){var e=this;return this._deferredAction(function(){return e.video.paused})},duration:function(){var e=this;return this._deferredAction(function(){return e.video.duration})},setCurrentTime:function(e){var t=this;return this._deferredAction(function(){t.video.currentTime=e,$(t.video).on("seeked",function(){t.canvasController.postRedisplay(),$(t.video).off("seeked")})})},currentTime:function(){var e=this;return this._deferredAction(function(){return e.video.currentTime})},setVolume:function(e){var t=this;return this._deferredAction(function(){t.video.volume=e})},volume:function(){var e=this;return this._deferredAction(function(){return e.video.volume})},setPlaybackRate:function(e){var t=this;return this._deferredAction(function(){t.video.playbackRate=e})},playbackRate:function(){var e=this;return this._deferredAction(function(){return e.video.playbackRate})},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){var t=this;return this._deferredAction(function(){var e=document.getElementById(t.video.className+"canvas");$(e).remove()})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.Video360Factory",{isStreamCompatible:function(e){try{if(paella.ChromaVideo._loaded)return!1;if(0<paella.videoFactories.Html5VideoFactory.s_instances&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("video360"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,n){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Video360(e,t,n.x,n.y,n.w,n.h)}}),Class("paella.Video360Theta",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(e,t,n,a,i,r,o){this.parent(e,t,"canvas",0,0,1280,720),this._streamName=o||"video360theta";var l=this;paella.player.videoContainer.disablePlayOnClick(),this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(e,t){return e.res.h-t.res.h}),this.video=null,new paella.Timer(function(e){l.canvasController&&l.canvasController.canvas.domElement},500).repeat=!0},defaultProfile:function(){return"chroma"},_setVideoElem:function(e){$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)},_loadDeps:function(){return new Promise(function(e,t){window.$paella_mpd?defer.resolve(window.$paella_mpd):require(["resources/deps/bg2e.js"],function(){window.$paella_bg2e=!0,e(window.$paella_bg2e)})})},_deferredAction:function(n){var a=this;return new Promise(function(e,t){a.video?e(n()):$(a.video).bind("canplay",function(){a._ready=!0,e(n())})})},_getQualityObject:function(e,t){return{index:e,res:t.res,src:t.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(e){return this.res.w*this.res.h-e.res.w*e.res.h}}},allowZoom:function(){return!1},getVideoData:function(){var n=this,a=this;return new Promise(function(e,t){n._deferredAction(function(){e({duration:a.video.duration,currentTime:a.video.currentTime,volume:a.video.volume,paused:a.video.paused,ended:a.video.ended,res:{w:a.video.videoWidth,h:a.video.videoHeight}})})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){(this._autoplay=e)&&this.video&&this.video.setAttribute("autoplay",e)},load:function(){var i=this;return new Promise(function(n,a){i._loadDeps().then(function(){var e=i._stream.sources[i._streamName];null===i._currentQuality&&i._videoQualityStrategy&&(i._currentQuality=i._videoQualityStrategy.getQualityIndex(e));var t=i._currentQuality<e.length?e[i._currentQuality]:null;i.video=null,t?(i.canvasController=null,buildVideo360ThetaCanvas(t,i.domElement).then(function(e){i.canvasController=e,i.video=e.video,i.video.pause(),n(t)})):a(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){var i=this;return new Promise(function(a,e){setTimeout(function(){var t=[],e=i._stream.sources[i._streamName],n=-1;e.forEach(function(e){n++,t.push(i._getQualityObject(n,e))}),a(t)},10)})},setQuality:function(i){var r=this;return new Promise(function(e){var t=r.video.paused,n=r._stream.sources[r._streamName];r._currentQuality=i<n.length?i:0;var a=r.video.currentTime;r.freeze().then(function(){return r._ready=!1,r.load()}).then(function(){t||r.play(),$(r.video).on("seeked",function(){r.unFreeze(),e(),$(r.video).off("seeked")}),r.video.currentTime=a})})},getCurrentQuality:function(){var t=this;return new Promise(function(e){e(t._getQualityObject(t._currentQuality,t._stream.sources[t._streamName][t._currentQuality]))})},play:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.AUTO,e.video.play()})},pause:function(){var e=this;return this._deferredAction(function(){bg.app.MainLoop.singleton.updateMode=bg.app.FrameUpdate.MANUAL,e.video.pause()})},isPaused:function(){var e=this;return this._deferredAction(function(){return e.video.paused})},duration:function(){var e=this;return this._deferredAction(function(){return e.video.duration})},setCurrentTime:function(e){var t=this;return this._deferredAction(function(){t.video.currentTime=e,$(t.video).on("seeked",function(){t.canvasController.postRedisplay(),$(t.video).off("seeked")})})},currentTime:function(){var e=this;return this._deferredAction(function(){return e.video.currentTime})},setVolume:function(e){var t=this;return this._deferredAction(function(){t.video.volume=e})},volume:function(){var e=this;return this._deferredAction(function(){return e.video.volume})},setPlaybackRate:function(e){var t=this;return this._deferredAction(function(){t.video.playbackRate=e})},playbackRate:function(){var e=this;return this._deferredAction(function(){return e.video.playbackRate})},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){var t=this;return this._deferredAction(function(){var e=document.getElementById(t.video.className+"canvas");$(e).remove()})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.Video360ThetaFactory",{isStreamCompatible:function(e){try{if(paella.ChromaVideo._loaded)return!1;if(0<paella.videoFactories.Html5VideoFactory.s_instances&&base.userAgent.system.iOS)return!1;for(var t in e.sources)if("video360theta"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,n){return paella.ChromaVideo._loaded=!0,++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Video360Theta(e,t,n.x,n.y,n.w,n.h)}}),function(){var e,t=(e=paella.VideoOverlayButtonPlugin,$traceurRuntime.createClass(function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)},{getIndex:function(){return 10},getSubclass:function(){return"videoData"},getAlignment:function(){return"left"},getDefaultToolTip:function(){return""},checkEnabled:function(e){var t=paella.player.config.plugins.list["es.upv.paella.videoDataPlugin"],n=t&&t.excludeLocations||[],a=t&&t.excludeParentLocations||[],i=n.some(function(e){return RegExp(e,"i").test(location.href)});window!=window.parent&&(i=i||a.some(function(e){var t=RegExp(e,"i");try{return t.test(parent.location.href)}catch(e){return!1}})),e(!i)},setup:function(){var t=document.createElement("h1");t.innerText="",t.className="videoTitle",this.button.appendChild(t),paella.data.read("metadata","title",function(e){t.innerHTML=e})},action:function(e){},getName:function(){return"es.upv.paella.videoDataPlugin"}},{},e));paella.plugins.videoDataPlugin=new t;var n,a=(n=paella.DataDelegate,$traceurRuntime.createClass(function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)},{read:function(e,t,n){n(paella.player.videoLoader.getMetadata()[t],!0)},write:function(e,t,n,a){a({},!0)},remove:function(e,t,n){n({},!0)}},{},n));paella.dataDelegates.VideoManifestMetadataDataDelegate=a}(),function(){var e,t=(e=paella.VideoOverlayButtonPlugin,$traceurRuntime.createClass(function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)},{getIndex:function(){return 10},getSubclass:function(){return"videoZoom"},getAlignment:function(){return"right"},getDefaultToolTip:function(){return""},checkEnabled:function(e){e(!0)},setup:function(){var o=this;function l(){var e=$(".videoZoomButton"),t=$(".videoZoom");this._visible?(e.show(),t.show()):(e.hide(),t.hide())}this._thumbnails=[],this._visible=!1,paella.player.videoContainer.videoPlayers().then(function(e){e.forEach(function(i,r){i.allowZoom()&&(o._visible=i.zoomAvailable(),function(e){var t=e.parent.domElement,n=document.createElement("button");t.appendChild(n),n.className="videoZoomButton btn zoomIn",n.innerHTML='<i class="glyphicon glyphicon-zoom-in"></i>',$(n).on("mousedown",function(){paella.player.videoContainer.disablePlayOnClick(),e.zoomIn()}),$(n).on("mouseup",function(){setTimeout(function(){return paella.player.videoContainer.enablePlayOnClick()},10)}),n=document.createElement("button"),t.appendChild(n),n.className="videoZoomButton btn zoomOut",n.innerHTML='<i class="glyphicon glyphicon-zoom-out"></i>',$(n).on("mousedown",function(){paella.player.videoContainer.disablePlayOnClick(),e.zoomOut()}),$(n).on("mouseup",function(){setTimeout(function(){return paella.player.videoContainer.enablePlayOnClick()},10)})}.apply(o,[i]),i.supportsCaptureFrame().then(function(e){if(e){var t=document.createElement("div");t.className="zoom-container";var n=function(e){var t=document.createElement("canvas");return t.width=320,t.height=180,t.className="zoom-thumbnail",t.id="zoomContainer"+e,t}.apply(o,[r]),a=function(){var e=document.createElement("div");return e.className="zoom-rect",e}.apply(o);o.button.appendChild(t),t.appendChild(n),t.appendChild(a),$(t).hide(),o._thumbnails.push({player:i,thumbContainer:t,zoomRect:a,canvas:n}),l.apply(o)}}))})});var n=!1;paella.events.bind(paella.events.play,function(e){var t=function(){o._thumbnails.forEach(function(e){var t,n,a;n=(t=e).player,a=t.canvas,n.captureFrame().then(function(e){a.getContext("2d").drawImage(e.source,0,0,320,180)})}),n&&setTimeout(function(){t()},2e3)};n=!0,t()}),paella.events.bind(paella.events.pause,function(e){n=!1}),paella.events.bind(paella.events.videoZoomChanged,function(e,i){o._thumbnails.some(function(e){if(e.player==i.video){if(100<e.player.zoom){$(e.thumbContainer).show();var t=100*i.video.zoomOffset.x/i.video.zoom,n=100*i.video.zoomOffset.y/i.video.zoom,a=e.zoomRect;$(a).css({left:t+"%",top:n+"%",width:1e4/i.video.zoom+"%",height:1e4/i.video.zoom+"%"})}else $(e.thumbContainer).hide();return!0}})}),paella.events.bind(paella.events.zoomAvailabilityChanged,function(e,t){o._visible=t.available,l.apply(o)})},action:function(e){},getName:function(){return"es.upv.paella.videoZoomPlugin"}},{},e));paella.plugins.videoZoomPlugin=new t;var n,a=(n=paella.ButtonPlugin,$traceurRuntime.createClass(function e(){$traceurRuntime.superConstructor(e).apply(this,arguments)},{getAlignment:function(){return"right"},getSubclass:function(){return"videoZoomToolbar"},getIndex:function(){return 2030},getMinWindowSize:function(){return paella.player.config.player&&paella.player.config.player.videoZoom&&paella.player.config.player.videoZoom.minWindowSize||600},getName:function(){return"es.upv.paella.videoZoomToolbarPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Change theme")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},checkEnabled:function(n){var a=this;paella.player.videoContainer.videoPlayers().then(function(e){var t=paella.player.config.plugins.list["es.upv.paella.videoZoomToolbarPlugin"].targetStreamIndex;a.targetPlayer=e.length>t?e[t]:null,n(paella.player.config.player.videoZoom.enabled&&a.targetPlayer&&a.targetPlayer.allowZoom())})},buildContent:function(e){var n=this;function t(e,t){var n=document.createElement("div");return n.className="videoZoomToolbarItem "+e,n.innerHTML='<i class="glyphicon glyphicon-'+e+'"></i>',$(n).click(t),n}paella.events.bind(paella.events.videoZoomChanged,function(e,t){n.setText(Math.round(t.video.zoom)+"%")}),this.setText("100%"),e.appendChild(t("zoom-in",function(e){n.targetPlayer.zoomIn()})),e.appendChild(t("zoom-out",function(e){n.targetPlayer.zoomOut()}))}},{},n));paella.plugins.videoZoomToolbarPlugin=new a}(),Class("paella.plugins.ViewModePlugin",paella.ButtonPlugin,{buttonItems:null,buttons:[],selected_button:null,active_profiles:null,getAlignment:function(){return"right"},getSubclass:function(){return"showViewModeButton"},getIndex:function(){return 540},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.viewModePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Change video layout")},checkEnabled:function(e){this.active_profiles=this.config.activeProfiles,e(!paella.player.videoContainer.isMonostream)},closeOnMouseOut:function(){return!0},setup:function(){var n=this,t=13,a=38,i=40;paella.events.bind(paella.events.setProfile,function(e,t){n.onProfileChange(t.profileName)}),$(this.button).keyup(function(e){n.isPopUpOpen()&&(e.keyCode==a?0<n.selected_button&&(n.selected_button<n.buttons.length&&(n.buttons[n.selected_button].className="viewModeItemButton "+n.buttons[n.selected_button].data.profile),n.selected_button--,n.buttons[n.selected_button].className=n.buttons[n.selected_button].className+" selected"):e.keyCode==i?n.selected_button<n.buttons.length-1&&(0<=n.selected_button&&(n.buttons[n.selected_button].className="viewModeItemButton "+n.buttons[n.selected_button].data.profile),n.selected_button++,n.buttons[n.selected_button].className=n.buttons[n.selected_button].className+" selected"):e.keyCode==t&&n.onItemClick(n.buttons[n.selected_button],n.buttons[n.selected_button].data.profile,n.buttons[n.selected_button].data.profile))})},buildContent:function(o){var l=this;this.buttonItems={},paella.Profiles.loadProfileList(function(r){Object.keys(r).forEach(function(t){if(!r[t].hidden){if(l.active_profiles){var n=!1;if(l.active_profiles.forEach(function(e){e==t&&(n=!0)}),0==n)return}var e=paella.player.videoContainer.sourceData[0].sources;if(("s_p_blackboard2"!=t||0!=e.hasOwnProperty("image"))&&("chroma"!=t||e.chroma)){var a=r[t],i=l.getProfileItemButton(t,a);l.buttonItems[t]=i,o.appendChild(i),l.buttons.push(i),paella.player.selectedProfile==t&&(l.buttonItems[t].className=l.getButtonItemClass(t,!0))}}}),l.selected_button=l.buttons.length})},getProfileItemButton:function(e,t){var n=document.createElement("div");return n.className=this.getButtonItemClass(e,!1),n.id=e+"_button",n.data={profile:e,profileData:t,plugin:this},$(n).click(function(e){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),n},onProfileChange:function(e){var t=this,n=this.buttonItems[e],a=this.buttonItems;Object.keys(a).forEach(function(e){t.buttonItems[e].className=t.getButtonItemClass(e,!1)}),n&&(n.className=t.getButtonItemClass(e,!0))},onItemClick:function(e,t,n){this.buttonItems[t]&&paella.player.setProfile(t),paella.player.controls.hidePopUp(this.getName())},getButtonItemClass:function(e,t){return"viewModeItemButton "+e+(t?" selected":"")}}),paella.plugins.viewModePlugin=new paella.plugins.ViewModePlugin,Class("paella.plugins.VolumeRangePlugin",paella.ButtonPlugin,{getAlignment:function(){return"left"},getSubclass:function(){return"volumeRangeButton"},getName:function(){return"es.upv.paella.volumeRangePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Volume")},getIndex:function(){return 120},_tempMasterVolume:0,_inputMaster:null,_control_NotMyselfEvent:!0,_storedValue:!1,closeOnMouseOut:function(){return!0},checkEnabled:function(e){e(!base.userAgent.browser.IsMobileVersion)},setup:function(){var n=this;paella.events.bind(paella.events.videoUnloaded,function(e,t){n.storeVolume()}),paella.events.bind(paella.events.singleVideoReady,function(e,t){n.loadStoredVolume(t)}),paella.events.bind(paella.events.setVolume,function(e,t){n.updateVolumeOnEvent(t)})},updateVolumeOnEvent:function(e){this._control_NotMyselfEvent?this._inputMaster=e.master:this._control_NotMyselfEvent=!0},storeVolume:function(){var t=this;paella.player.videoContainer.mainAudioPlayer().volume().then(function(e){t._tempMasterVolume=e,t._storedValue=!0})},loadStoredVolume:function(e){0==this._storedValue&&this.storeVolume(),this._tempMasterVolume&&paella.player.videoContainer.setVolume({master:this._tempMasterVolume}),this._storedValue=!1},buildContent:function(e){var n=this,t=this,a=document.createElement("div");a.className="videoRangeContainer";var i=document.createElement("div");i.className="range";var r=document.createElement("div");r.className="image master";var o=document.createElement("input");function l(){var e=$(o).val();t._control_NotMyselfEvent=!1,paella.player.videoContainer.setVolume({master:e})}(t._inputMaster=o).type="range",o.min=0,o.max=1,o.step=.01,paella.player.videoContainer.masterVideo().volume().then(function(e){o.value=e}),$(o).bind("input",function(e){l()}),$(o).change(function(){l()}),i.appendChild(r),i.appendChild(o),a.appendChild(i),paella.events.bind(paella.events.setVolume,function(e,t){o.value=t.master,n.updateClass()}),e.appendChild(a),t.updateClass()},updateClass:function(){var t="",n=this;paella.player.videoContainer.mainAudioPlayer().volume().then(function(e){t=void 0===e?"med":0==e?"mute":e<.33?"min":e<.66?"med":"max",n.button.className=["buttonPlugin",n.getAlignment(),n.getSubclass(),t].join(" ")})}}),paella.plugins.volumeRangePlugin=new paella.plugins.VolumeRangePlugin,Class("paella.videoFactories.WebmVideoFactory",{webmCapable:function(){var e=document.createElement("video");return!!e.canPlayType&&""!==e.canPlayType('video/webm; codecs="vp8, vorbis"')},isStreamCompatible:function(e){try{if(!this.webmCapable())return!1;for(var t in e.sources)if("webm"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,n){return new paella.Html5Video(e,t,n.x,n.y,n.w,n.h,"webm")}}),Class("paella.plugins.WindowTitlePlugin",paella.EventDrivenPlugin,{_initDone:!1,getName:function(){return"es.upv.paella.windowTitlePlugin"},checkEnabled:function(e){var t=this;paella.player.videoContainer.masterVideo().duration().then(function(e){t.loadTitle()}),e(!0)},loadTitle:function(){var e=paella.player.videoLoader.getMetadata()&&paella.player.videoLoader.getMetadata().title;document.title=e||document.title,this._initDone=!0}}),paella.plugins.windowTitlePlugin=new paella.plugins.WindowTitlePlugin,Class("paella.YoutubeVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_readyPromise:null,initialize:function(e,t,n,a,i,r){this.parent(e,t,"div",n,a,i,r);var o=this;this._readyPromise=$.Deferred(),Object.defineProperty(this,"video",{get:function(){return o._youtubePlayer}})},_deferredAction:function(n){var a=this;return new Promise(function(e,t){a._readyPromise.then(function(){e(n())},function(){t()})})},_getQualityObject:function(e,t){var n=0;switch(t){case"small":n=1;break;case"medium":n=2;break;case"large":n=3;break;case"hd720":n=4;break;case"hd1080":n=5;break;case"highres":n=6}return{index:e,res:{w:null,h:null},src:null,label:t,level:n,bitrate:n,toString:function(){return this.label},shortLabel:function(){return this.label},compare:function(e){return this.level-e.level}}},_onStateChanged:function(e){console.log("On state changed")},getVideoData:function(){var a=this,i=this;return new Promise(function(t,e){var n=a._stream.sources.youtube[0];a._deferredAction(function(){var e={duration:i.video.getDuration(),currentTime:i.video.getCurrentTime(),volume:i.video.getVolume(),paused:!i._playing,ended:i.video.ended,res:{w:n.res.w,h:n.res.h}};t(e)})})},setPosterFrame:function(e){this._posterFrame=e},setAutoplay:function(e){this._autoplay=e},setRect:function(e,t){this._rect=JSON.parse(JSON.stringify(e));var n=new paella.RelativeVideoSize,a={top:n.percentVSize(e.top)+"%",left:n.percentWSize(e.left)+"%",width:n.percentWSize(e.width)+"%",height:n.percentVSize(e.height)+"%",position:"absolute"};if(t){this.disableClassName();var i=this;$("#"+this.identifier).animate(a,400,function(){i.enableClassName(),paella.events.trigger(paella.events.setComposition,{video:i})}),this.enableClassNameAfter(400)}else $("#"+this.identifier).css(a),paella.events.trigger(paella.events.setComposition,{video:this})},setVisible:function(e,t){"true"==e&&t?($("#"+this.identifier).show(),$("#"+this.identifier).animate({opacity:1},300)):"true"!=e||t?"false"==e&&t?$("#"+this.identifier).animate({opacity:0},300):"false"!=e||t||$("#"+this.identifier).hide():$("#"+this.identifier).show()},setLayer:function(e){$("#"+this.identifier).css({zIndex:e})},load:function(){var a=this,i=this;return new Promise(function(t,n){a._qualityListReadyPromise=$.Deferred(),paella.youtubePlayerVars.apiReadyPromise.then(function(){var e=a._stream.sources.youtube[0];e?(a._youtubePlayer=new YT.Player(i.identifier,{height:"390",width:"640",videoId:e.id,playerVars:{controls:0,disablekb:1},events:{onReady:function(e){i._readyPromise.resolve()},onStateChanged:function(e){console.log("state changed")},onPlayerStateChange:function(e){console.log("state changed")}}}),t()):n(new Error("Could not load video: invalid quality stream index"))})})},getQualities:function(){var i=this;return new Promise(function(a,e){i._qualityListReadyPromise.then(function(e){var t=[],n=-1;i._qualities={},e.forEach(function(e){n++,i._qualities[e]=i._getQualityObject(n,e),t.push(i._qualities[e])}),a(t)})})},setQuality:function(i){var r=this;return new Promise(function(a,e){r._qualityListReadyPromise.then(function(e){for(var t in r._qualities){var n=r._qualities[t];if("object"==$traceurRuntime.typeof(n)&&n.index==i){r.video.setPlaybackQuality(n.label);break}}a()})})},getCurrentQuality:function(){var n=this;return new Promise(function(t,e){n._qualityListReadyPromise.then(function(e){t(n._qualities[n.video.getPlaybackQuality()])})})},play:function(){var a=this,t=this;return new Promise(function(n,e){t._playing=!0,t.video.playVideo(),new base.Timer(function(e){var t=a.video.getAvailableQualityLevels();t.length?(e.repeat=!1,a._qualityListReadyPromise.resolve(t),n()):e.repeat=!0},500)})},pause:function(){var e=this;return this._deferredAction(function(){e._playing=!1,e.video.pauseVideo()})},isPaused:function(){var e=this;return this._deferredAction(function(){return!e._playing})},duration:function(){var e=this;return this._deferredAction(function(){return e.video.getDuration()})},setCurrentTime:function(e){var t=this;return this._deferredAction(function(){t.video.seekTo(e)})},currentTime:function(){var e=this;return this._deferredAction(function(){return e.video.getCurrentTime()})},setVolume:function(e){var t=this;return this._deferredAction(function(){t.video.setVolume&&t.video.setVolume(100*e)})},volume:function(){var e=this;return this._deferredAction(function(){return e.video.getVolume()/100})},setPlaybackRate:function(e){var t=this;return this._deferredAction(function(){t.video.playbackRate=e})},playbackRate:function(){var e=this;return this._deferredAction(function(){return e.video.playbackRate})},goFullScreen:function(){var t=this;return this._deferredAction(function(){var e=t.video;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()})},unFreeze:function(){var t=this;return this._deferredAction(function(){var e=document.getElementById(t.video.className+"canvas");$(e).remove()})},freeze:function(){var t=this;return this._deferredAction(function(){var e=document.createElement("canvas");e.id=t.video.className+"canvas",e.width=t.video.videoWidth,e.height=t.video.videoHeight,e.style.cssText=t.video.style.cssText,e.style.zIndex=2,e.getContext("2d").drawImage(t.video,0,0,16*Math.ceil(e.width/16),16*Math.ceil(e.height/16)),t.video.parentElement.appendChild(e)})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.YoutubeVideoFactory",{initYoutubeApi:function(){if(!this._initialized){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),paella.youtubePlayerVars={apiReadyPromise:new $.Deferred},this._initialized=!0}},isStreamCompatible:function(e){try{for(var t in e.sources)if("youtube"==t)return!0}catch(e){}return!1},getVideoObject:function(e,t,n){return this.initYoutubeApi(),new paella.YoutubeVideo(e,t,n.x,n.y,n.w,n.h)}}),Class("paella.ZoomPlugin",paella.EventDrivenPlugin,{_zImages:null,_imageNumber:null,_isActivated:!1,_isCreated:!1,_keys:null,_ant:null,_next:null,_videoLength:null,_compChanged:!1,_restartPlugin:!1,_actualImage:null,_zoomIncr:null,_maxZoom:null,_minZoom:null,_dragMode:!1,_mouseDownPosition:null,getIndex:function(){return 20},getAlignment:function(){return"right"},getSubclass:function(){return"zoomButton"},getDefaultToolTip:function(){return base.dictionary.translate("Zoom")},getEvents:function(){return[paella.events.timeUpdate,paella.events.setComposition,paella.events.loadPlugins,paella.events.play]},onEvent:function(e,t){switch(e){case paella.events.timeUpdate:this.imageUpdate(e,t);break;case paella.events.setComposition:this.compositionChanged(e,t);break;case paella.events.loadPlugins:this.loadPlugin(e,t);break;case paella.events.play:this.exitPhotoMode()}},checkEnabled:function(e){paella.player.videoContainer.sourceData.length<2?e(!1):paella.player.videoContainer.sourceData[0].sources.hasOwnProperty("image")?e(!0):e(!1)},setupIcons:function(){var e=this,t=$(".zoomFrame").width(),n=document.createElement("div");n.className="arrowsLeft",n.style.display="none";var a=document.createElement("div");a.className="arrowsRight",a.style.display="none",a.style.left=t-24+"px",$(n).click(function(){e.arrowCallLeft(),event.stopPropagation()}),$(a).click(function(){e.arrowCallRight(),event.stopPropagation()});var i=document.createElement("div");i.className="iconsFrame";var r=document.createElement("button");r.className="zoomActionButton buttonZoomIn",r.style.display="none";var o=document.createElement("button");o.className="zoomActionButton buttonZoomOut",o.style.display="none";var l=document.createElement("button");l.className="zoomActionButton buttonSnapshot",l.style.display="none";var s=document.createElement("button");s.className="zoomActionButton buttonZoomOn",$(i).append(s),$(i).append(l),$(i).append(r),$(i).append(o),$(".newframe").append(i),$(".newframe").append(n),$(".newframe").append(a),$(s).click(function(){e._isActivated?(e.exitPhotoMode(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked")):(e.enterPhotoMode(),$(".zoomActionButton.buttonZoomOn").addClass("clicked")),event.stopPropagation()}),$(l).click(function(){null!=e._actualImage&&window.open(e._actualImage,"_blank"),event.stopPropagation()}),$(r).click(function(){e.zoomIn(),event.stopPropagation()}),$(o).click(function(){e.zoomOut(),event.stopPropagation()})},enterPhotoMode:function(){$(".zoomFrame").show(),$(".zoomFrame").css("opacity","1"),this._isActivated=!0,$(".buttonSnapshot").show(),$(".buttonZoomOut").show(),$(".buttonZoomIn").show(),$(".arrowsRight").show(),$(".arrowsLeft").show(),paella.player.pause(),this._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),this._imageNumber>=this._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()},exitPhotoMode:function(){$(".zoomFrame").hide(),this._isActivated=!1,$(".buttonSnapshot").hide(),$(".buttonZoomOut").hide(),$(".buttonZoomIn").hide(),$(".arrowsRight").hide(),$(".arrowsLeft").hide(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked")},setup:function(){var e=this;e._maxZoom=e.config.maxZoom||500,e._minZoom=e.config.minZoom||100,e._zoomIncr=e.config.zoomIncr||10,this._zImages={},this._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,this._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,this._keys=Object.keys(this._zImages),this._keys=this._keys.sort(function(e,t){return e=e.slice(6),t=t.slice(6),parseInt(e)-parseInt(t)}),this._next=0,this._ant=0},loadPlugin:function(){var e=this;0==e._isCreated&&(e.createOverlay(),e.setupIcons(),$(".zoomFrame").hide(),e._isActivated=!1,e._isCreated=!0)},imageUpdate:function(e,t){var n=this,a=Math.round(t.currentTime),i=$(".zoomFrame").css("background-image");if(0<$(".newframe").length){if(this._zImages.hasOwnProperty("frame_"+a)){if(i==this._zImages["frame_"+a])return;i=this._zImages["frame_"+a]}else{if(!(a>this._next||a<this._ant||n._compChanged))return;n._compChanged&&(n._compChanged=!1),i=n.returnSrc(a)}$("#photo_01").attr("src",i).load();var r=new Image;r.onload=function(){$(".zoomFrame").css("background-image","url("+i+")")},r.src=i,n._actualImage=i,n._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),n._imageNumber>=n._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()}},returnSrc:function(e){var t=0;for(i=0;i<this._keys.length;i++){var n=parseInt(this._keys[i].slice(6)),a=parseInt(this._keys[this._keys.length-1].slice(6));if(e<n)return this._next=n,this._ant=t,this._imageNumber=i-1,this._zImages["frame_"+t];if(a<e&&e<this._videoLength)return this._next=this._videoLength,this._ant=a,this._zImages["frame_"+t];t=n}},arrowCallLeft:function(){if(0<=this._imageNumber-1){var e=this._keys[this._imageNumber-1];this._imageNumber-=1,paella.player.videoContainer.seekToTime(parseInt(e.slice(6)))}},arrowCallRight:function(){var e=this;if(e._imageNumber+1<=e._keys.length){var t=e._keys[e._imageNumber+1];e._imageNumber+=1,paella.player.videoContainer.seekToTime(parseInt(t.slice(6)))}},createOverlay:function(){var t=this,e=document.createElement("div");e.className="newframe",overlayContainer=paella.player.videoContainer.overlayContainer,overlayContainer.addElement(e,overlayContainer.getMasterRect());var n=document.createElement("div");n.className="zoomFrame",e.insertBefore(n,e.firstChild),$(n).click(function(e){e.stopPropagation()}),$(n).bind("mousewheel",function(e){0<e.originalEvent.wheelDelta/120?t.zoomIn():t.zoomOut()}),$(n).mousedown(function(e){t.mouseDown(e.clientX,e.clientY)}),$(n).mouseup(function(e){t.mouseUp()}),$(n).mouseleave(function(e){t.mouseLeave()}),$(n).mousemove(function(e){t.mouseMove(e.clientX,e.clientY)})},mouseDown:function(e,t){this._dragMode=!0,this._mouseDownPosition={x:e,y:t}},mouseUp:function(){this._dragMode=!1},mouseLeave:function(){this._dragMode=!1},mouseMove:function(e,t){if(this._dragMode){$(".zoomFrame")[0];var n=this._backgroundPosition?this._backgroundPosition:{left:0,top:0},a=($(".zoomFrame").width(),$(".zoomFrame").height(),this._mouseDownPosition.x-e),i=this._mouseDownPosition.y-t,r=n.left+a,o=n.top+i;r=(r=0<=r?r:0)<=100?r:100,o=(o=0<=o?o:0)<=100?o:100,$(".zoomFrame").css("background-position",r+"% "+o+"%"),this._backgroundPosition={left:r,top:o},this._mouseDownPosition.x=e,this._mouseDownPosition.y=t}},zoomIn:function(){z=$(".zoomFrame").css("background-size"),z=z.split(" "),z=parseInt(z[0]),z<this._maxZoom&&$(".zoomFrame").css("background-size",z+this._zoomIncr+"% auto")},zoomOut:function(){z=$(".zoomFrame").css("background-size"),z=z.split(" "),z=parseInt(z[0]),z>this._minZoom&&$(".zoomFrame").css("background-size",z-this._zoomIncr+"% auto")},imageUpdateOnPause:function(e){var t=this,n=Math.round(e),a=$(".zoomFrame").css("background-image");if(0<$(".newframe").length&&a!=t._actualImage){if(this._zImages.hasOwnProperty("frame_"+n)){if(a==this._zImages["frame_"+n])return;a=this._zImages["frame_"+n]}else t._compChanged&&(t._compChanged=!1),a=t.returnSrc(n);$("#photo_01").attr("src",a).load();var i=new Image;i.onload=function(){$(".zoomFrame").css("background-image","url("+a+")")},i.src=a,t._actualImage=a}},compositionChanged:function(e,t){var n=this;$(".newframe").remove(),n._isCreated=!1,paella.player.videoContainer.getMasterVideoRect().visible&&(n.loadPlugin(),paella.player.paused()&&paella.player.videoContainer.currentTime().then(function(e){n.imageUpdateOnPause(e)})),n._compChanged=!0},getName:function(){return"es.upv.paella.zoomPlugin"}}),paella.plugins.zoomPlugin=new paella.ZoomPlugin;